(self["webpackChunkzulip"] = self["webpackChunkzulip"] || []).push([["node_modules_moment-mini_locale_sync_recursive_-static_js_channel_js"],{

/***/ "./node_modules/moment-mini/locale sync recursive ^\\.\\/.*$":
/*!********************************************************!*\
  !*** ./node_modules/moment-mini/locale/ sync ^\.\/.*$ ***!
  \********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./locale": "./node_modules/moment-mini/locale/locale.js",
	"./locale.js": "./node_modules/moment-mini/locale/locale.js"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./node_modules/moment-mini/locale sync recursive ^\\.\\/.*$";

/***/ }),

/***/ "./static/js/favicon_font_url!=!./node_modules/url-loader/dist/cjs.js!./node_modules/font-subset-loader2/index.js?glyphs=0123456789KMGT∞!./node_modules/source-sans/TTF/SourceSans3-Bold.ttf":
/*!***************************************************************************************************************************************************************************************************!*\
  !*** ./static/js/favicon_font_url!=!./node_modules/url-loader/dist/cjs.js!./node_modules/font-subset-loader2/index.js?glyphs=0123456789KMGT∞!./node_modules/source-sans/TTF/SourceSans3-Bold.ttf ***!
  \***************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("data:font/ttf;base64,AAEAAAALAIAAAwAwR1BPU8Fu3XIAAAC8AAF1AE9TLzJguIl/AAF1vAAAAGBjbWFwVtMAKAABdhwAAAFqZ2x5Zqg8nCgAAXeIAAAF7GhlYWQcXd4OAAF9dAAAADZoaGVhBx8BqQABfawAAAAkaG10eCSKAsMAAX3QAAAAQGxvY2EL+go+AAF+EAAAACJtYXhwABYANgABfjQAAAAgbmFtZeZt9BgAAX5UAAAKH3Bvc3QBPwEfAAGIdAAAAEIAAQAAAAoBmAXyAARERkxUABpjeXJsACxncmVrAHpsYXRuAKAABAAAAAD//wAEAAAAEwAmADkAFgADQkdSIAAkTUtEIAAyU1JCIABAAAD//wAEAAEAFAAnADoAAP//AAQAAgAVACgAOwAA//8ABAADABYAKQA8AAD//wAEAAQAFwAqAD0ACgABUEdSIAAYAAD//wAEAAUAGAArAD4AAP//AAQABgAZACwAPwBGAAtBUFBIAFRBVEggAGJBWkUgAHBDSFAgAH5DUlQgAIxJUFBIAJpOQVYgAKhOU00gALZTS1MgAMRTTEEgANJUUksgAOAAAP//AAQABwAaAC0AQAAA//8ABAAIABsALgBBAAD//wAEAAkAHAAvAEIAAP//AAQACgAdADAAQwAA//8ABAALAB4AMQBEAAD//wAEAAwAHwAyAEUAAP//AAQADQAgADMARgAA//8ABAAOACEANABHAAD//wAEAA8AIgA1AEgAAP//AAQAEAAjADYASQAA//8ABAARACQANwBKAAD//wAEABIAJQA4AEsATGtlcm4Bymtlcm4B0Gtlcm4B1mtlcm4B3Gtlcm4B4mtlcm4B6Gtlcm4B7mtlcm4B9Gtlcm4B+mtlcm4CAGtlcm4CBmtlcm4CDGtlcm4CEmtlcm4CGGtlcm4CHmtlcm4CJGtlcm4CKmtlcm4CMGtlcm4CNm1hcmsCPG1hcmsCTm1hcmsCYG1hcmsCcm1hcmsChG1hcmsClm1hcmsCqG1hcmsCum1hcmsCzG1hcmsC3m1hcmsC8G1hcmsDAm1hcmsDFG1hcmsDJm1hcmsDOG1hcmsDSm1hcmsDXG1hcmsDbm1hcmsDgG1rbWsDkm1rbWsDmG1rbWsDnm1rbWsDpG1rbWsDqm1rbWsDsG1rbWsDtm1rbWsDvG1rbWsDwm1rbWsDyG1rbWsDzm1rbWsD1G1rbWsD2m1rbWsD4G1rbWsD5m1rbWsD7G1rbWsD8m1rbWsD+G1rbWsD/nNpemUEBHNpemUECHNpemUEDHNpemUEEHNpemUEFHNpemUEGHNpemUEHHNpemUEIHNpemUEJHNpemUEKHNpemUELHNpemUEMHNpemUENHNpemUEOHNpemUEPHNpemUEQHNpemUERHNpemUESHNpemUETAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAEACAAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAcAAAABAAIAAwAEAAUABgAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwAAAAEABwBMAAAASAAAAEQAAABAAAAAPAAAADgAAAA0AAAAMAAAACwAAAAoAAAAJAAAACAAAAAcAAAAGAAAABQAAAAQAAAADAAAAAgAAAAEAAAAZAAAAAAAAAAAAAkAFAAcACQALAA0ADwARABMAFQABAAAAAEAaAAEAAAAAQw2AAQAAAABDYAABAAAAAEOKgAEAAAAARdUAAQAAAABF9gABAAAAAEYIgAGAQAAARmEAAkACAARG2Ybbht2G34bhhuOG5YbnhumG64bthu+G8YbzhvWG94b5gABG8Yb+gABAAwBjgBgAAAFmgAABaAAAAWaAAAFmgAABaAAAAWaAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFmgAABaAAAAWaAAAFmgAABZoAAAWaAAAFoAAABZoAAAWaAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWaAAAFoAAABZoAAAWaAAAFoAAABZoAAAWgAAAFmgAABaAAAAWaAAAFoAAABZoAAAWgAAAFmgAABZoAAAWaAAAFmgAABZoAAAWaAgsEJAQqBDAENgQ8BEIESAROBFQEWgRgBGYEbARyBHgEfgR4BIQEigSQBJYEnASiBKgErgS0BLoEwATGBMwE0gTYBN4EwATkBOQE6gTwBPYE/ATGBPwFAgUIBQ4FFAUaBSAFJgUsBTIFOAU+BCQEJAVEBCQFSgQwBDAFSgVQBDwEPAVWBVwESAViBWgEVARUBW4EWgRgBGYFdAV6BXoFgAWGBGwEcgWMBYwFkgWYBHgFngWkBaoFsAR4BbYEkASQBbwElgXCBJYFyAXOBdQEMARyBdoF4AXmBYYFmASuBdoF7AWkBFQErgXyBfgErgVcBK4F/gS6BLoGBAS6BMAExgYKBNIE0gYQBhYGHAYiBigGLgY0BOoE8AY6BkAGQAZGBkwE9gT8BPwE/AZSBMYGWAZeBSAGZAZqBMwExgTYBRQFFAZwBnYGdgZ8BoIGiAT8Bo4GlAYQBoIGmgagBqYGrAayBrgGmga+BsQGygYWBhYG0AUyBtYGFga+BMwEzAbcBtwG3AbcBuIFIAboBsoG7gb0BvoHAAYWBhYGmgcGBRoEwATABwwHEgcSBxgHHgTwByQHKgcwBzAHNgc2BPYHPAT8BPwHQgYWB0gGWAZqB04HVAYQB1oGEAUIB2AFMgdmBQ4HbAZMBwAHcgd4B34HhAd4B4oE/AUaBhYGFgdIBSYHkAbEBTgGvgdIB5YHnAeiB5wHqAeuB7QHugfAB8YHxgfMB9IHzAfMB8wEcgfMBhYH2AfeB94GFgS6BgoEugS6BLoH5AYWB+oH6gY6BkAGQAZGBigH8AboB/YEYAR4B/wIAgTeBoIFIAgICA4HigYoBRoIFATGBqYIGgS6CCAIJggsBqYGoAgyBx4IMgdOCDgEugf8CD4IRAR4CEoIUAS0B/YEPAhWCFwIYgR4BVwIaAhuCHQIegiABH4ETgRUCIYEeAf2CIwErgVEBFoEeAS6BhwE0giSB/wImATGCJ4ILAikCKoG7gZqCLAExgTGB0gFIAUgBMYIVghiBhYEugiSCJgGlAUaCLYIvAjCCMgIzgjUCNoI4AjmCOwI8gj4CP4JBAjCCQoJEAjyCRYJHAjCCSIJKAkuCTQJLgk6CSIJIglACLYJRgjCCUwJUglYCM4IzgleCWQI2glqCOYI5glwCOwI8gj4CXYJfAl8CYIJiAj+CQQJjgmOCZQJmgmgCV4JpgmsCMIJEAlkCWQJlAjCCY4IwgkECaYJsglMCQQJuAkWCb4JxAnKCdAJuAkuCV4I5gmICcoJ1gnWCWQJiAncCeIJ3AncCdwJBAncCSIJ6AnuCNQJLgjgCaAI5gjyCP4J9An6CQoJNAjCCLYKAAjOCgYKDAoSCMIKGAoeCSIKJAjyCioKMAk0CTQKNglMCgYKEgo8BNgKQgABAAACBgABAAACogABAR0CogABATECogABAVkCogABAUUCogABASICogABASECogABAW0CogABAVACogABAJgCogABAWQCogABAT8CogABAJkCogABAX8CogABAVICogABAVYCogABATsCogABATYCogABASYCogABARQCogABAUwCogABARYCogABAZUCogABARwCogABAQUCogABARsCogABARQCBgABATkC1AABARYCBgABARQC1AABAQwCBgABAPEC1AABAQ8CBgABAIoCywABATcC1AABAI8C1AABAbsCBgABATkCBgABASQCBgABAPkCBgABAOkCBgABAKsCkQABAR0CBgABAQcCBgABAYUCBgABAQECBgABAQoCBgABAPUCBgABAR0DNwABAhsCogABAeYCogABASIDNwABARECogABASACogABAQsCogABAJgDNwABAKwCogABALMCogABAK0CogABAN8CoAABAO8CogABAWsCogABAVYDNwABAVUCogABAhECogABARkCogABAQwCogABAgoCogABAVcCogABAUwDNwABAWACogABAU0CogABAQACogABARoCogABAWYCogABAS4CogABAUMCogABASgCogABAWMCogABARgCogABARQCswABAZYCBgABAQwCswABAQACBgABAR4CBgABAPICBgABAIoCswABAIoCBgABAKYCywABAIwCBgABALIC1AABAKsC1AABANYC1AABAO8C1AABARYCswABARUCBgABAbICBgABANgCBgABAaICBgABAR0CswABARMB9gABARkCBgABASgC1AABAK0C1AABAOECBgABAOICBgABAQMCBgABAQICBgABAQUCBgABAH0CBgABAT8CBgABANsCBgABAPYCBgABAOcCBgABAPgCBgABATwCBgABATEC1AABAaIC1AABASAC1AABAP0CBgABANMCBgABANICBgABATICBgABAKgCBgABAScC1AABASICBgABAMcCBgABAI8CBgABAQ0CBgABALAC1AABAJECBgABANUC1AABAbcCBgABAgYCBgABAYQCBgABASACBgABAXMCBgABAXEC1AABAQAC1AABAPECBgABASUCBgABANMC1AABAKoCkQABAZQCkQABAVIC1AABAVwCwgABARMC1AABAR4C1AABANcC1AABAN8C1AABAOEC1AABAIcC1AABAQIC1AABAOUC1AABAHwC1AABARYC1AABAIgCBgABAMcCogABAMcDNwABAR4CswABASsCBgABARoCBgABAIoC1AABAKYCBgABASoCogABASgCBgABAS0C1AABAQkC1AABATECBgABASEC1AABAPAC1AABAUECBgABASoCBgABAScCBgABAXECkQABAQkCBgABAPoCBgABAU0CkQABAQwC1AABAYICBgABAbUCogABAVYCqgABAU0CqgABAUYCogABATQCogABAbICogABAQcCogABAd8CogABAOIC0gABAQYCogABAX4CBgABASMCBgABAQsCBgABAQ4CBgABAXwCBgABARwCBgABAP0CMgABAR4CMgABATECMgABASgCMgABAQwCMgABAQ0CMgABAUACMgABATcCMgABAJgCMgABAT0CMgABASsCMgABAJkCMgABAVcCMgABATsCMgABASwCMgABATMCMgABAQ4CMgABAPUCMgABAPgCMgABAWgCMgABAQACMgABAOcCMgABAP0CxwABAcYCMgABAbkCMgABATwCMgABAbcCMgABAQwCxwABAPsCMgABAPYCMgABAJcCxwABAKwCMgABALMCMgABAK0CMgABAN8CMgABAO8CMgABAUUCMgABATECxwABATQCMgABATICMgABAOICMgABAb0CMgABAQQCMgABAUECMgABARMCMgABAOwCMgABATkCMgABAOQCMgABAPkCMgABAMcCMgABAMcCxwABASICMgABARwCMgABATgCMgABATUCMgABARICLQABAXoCMgABATcCLQABATACLQABAPsCLQABAYUCMgABAaoCMgABANkCUwABAQMCMgABAccCMgABAM0CzQABASECBgABFD4UTAABAAwAIgAFAAAAegAAAIAAAAB6AAAAegAAAIAAMQBwAHYAfABwAIIAiACOAJQAmgCgAKYArACyALgAvgB2AHwAxADEAMQAfADKAMoA0ACaANYA3ADcANwA1gDiAOgA7gD0APoBAAEGAQwBEgEYAPQA+gEeAR4BHgD6ASQBJAEqAAEAAAIGAAEAAAKiAAEB7QKiAAECDQKiAAECUAKiAAEBzAKiAAEC3wKiAAEB6AKiAAEBogIGAAEB0AIGAAECJQIGAAEB6wIGAAEBZwIGAAECugIGAAEBwQIGAAECWgKiAAECZAKiAAEBvgKiAAECIAIGAAECFAIGAAECKAIGAAEBtAIGAAEBiwKiAAEBuAIyAAEB0QIyAAECKAIyAAEBzwIyAAEBlAIyAAECfwIyAAEBpgIyAAECNgIyAAECPAIyAAEBewIyAAEB1wIGAAETYBNoAAEADAAWAAIAAAA0AAAANAAUADAANgA8AEIASABOAFQAWgBgAGYAbAByAHgAPAB+AGAAhACKAJAAlgABAAAAAAABAVwAAAABASwAAAABARgAAAABARQAAAABAQYAAAABAQwAAAABANoAAAABAOkAAAABAPwAAAABASAAAAABAQIAAAABAM4AAAABAPYAAAABATEAAAABAPQAAAABAPgAAAABAOIAAAABASEAAAABEuITBAABAAwAbgAYAAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AAAEdgAABHYAAAR2AgkEGgQgBCYEIAQsBDIEOAQ+BEQESgRQBFYEXARiBGgEbgR0BHoEgASGBFAEjASSBJgEngSkBKoEsAS2BLwEwgTIBM4E1ATaBOAE5gTsBPIE+AS8BP4FBAUKBRAFFgS8BRwFIgUoBS4FNAQaBBoEGgQaBBoEGgQaBBoFOgQmBUAFRgQsBCwELAQsBCwELAQsBUwFTAUcBFYEOAQ4BEQERAREBEQERAREBEQFUgRKBCAFWAVYBV4FZARiBGIFagVwBGgEaARoBGgEaARoBGgFdgRoBXwFggWIBGgEaASGBIYEUARQBFAEUARQBFAFjgRQBZQFmgSABD4FoAWmBawFsgQ4BaYFuAWmBb4FxAXKBJ4F0AXWBRYEngSqBKoEqgSqBKoEqgSqBdwEqgSwBLYEwgTCBMIEwgTCBMIEwgXiBeIF6AXuBe4E2gTaBNoE2gTaBNoE2gX0BNoF+gTgBgAGBgYGBgwGEgT4BPgGGAYYBLwEvAS8BLwEvAS8BLwGHgYkBioFHAYwBjYEhgS8BMgFFgUWBLwEvAS8BLwEvAS8BjwGQgZIBk4GVAZaBegEwgZOBmAGZgZIBk4GbAZOBRwGcgSGBngGfgS8BoQGfgaKBhgE+AaQBpYGnAaQBIYFHATCBqIGqAZyBPgF+gXuBLwGrgS8BrQE1AYYBn4Guga6BOwGwAbGBswG0gbYBt4G3gbkBioG6gbwBhgGGAb2BXwEVgYkBvwHAgcIBw4HDgcUBxoFCgT4ByAHJgTgBfoHLAcyBwIGtAc4Bz4EjAdEBBoE+ASGB0oFIgbeB1AHVgdcBFYHYgU0B2gFNAUKBYIHbgd0BLwHegZaBroGAAYABgAGuga6BroGAAa6B4AHhgT4BPgE+AT4BPgE+AT4BPgE+AeMB4wHjAeMB4wHjAeMB4wEqgSABe4E2geSB5gHmAeeBw4HpAQ+B6oHsAe2B7wEjAfCBNoEjAfIBngEVgfOBJ4HwgSGB9QH2gSGBBoFggfgB+YH7AcCB/IH+AfCB/4HtgfsCAQE1AgKBPgEvAQyCBAHsARECBYIHATCBaAHRAgKBG4IIggKB0oIKAgKBqIILgS2B1AINAgECAQIBAgECAQIBAgECAQIOggKB0QIOgS8BLwEvAS8BLwEvAS8BeIF4gUWCEAIEAhGCEYIRghGCEYIRghGBVIIFgZ4BFYEVghMB6oHRAdECFIIWAgKCAoICggKCAoICggKCF4HRAXoCBYIZAgKBVgGogaiCAoICggKCAoICggKCGoICghwCHYESgW+CAoIfAiCCIgIjgh8BqgIfAcgCJQFygYSBb4ImgeGBhIGuga6BroGuga6BroGuga6BroIWAeGCEAIoAimCDQHsARECBwFoAVYCKwEbgiyBRwIuAi+AAEAAP/qAAEBHf/qAAEBO//qAAEBXP/qAAEBLP/qAAEAn//qAAEBbf/qAAEBUP/qAAEAmP/qAAEBCf/qAAEBTP/qAAEBIP/qAAEBf//qAAEBWf/qAAEBVv/qAAEAof/qAAEBSf9RAAEBR//qAAEBGP/qAAEBFP/qAAEBE//qAAEBlv/qAAEBEv/qAAEBBf/qAAEBGv/qAAEBAP/qAAEBJP/qAAEBBv/qAAEBFv/qAAEBDP/qAAEApP/qAAEA+v9BAAEBKP/qAAEAiv/qAAEAU/9DAAEBJf/qAAEAo//qAAEBs//qAAEBHv/qAAEAiP9DAAEBrP9DAAEAh//qAAEA2v/qAAEA6f/qAAEBB//qAAEBhf/qAAEBAf/qAAEA5P8/AAEA8//qAAEB8v/qAAEBT//qAAEB+P/qAAEBLP8iAAEArP/qAAEBNP/qAAEBYf/qAAEBdv/qAAEBRv/qAAEBRv/VAAEBWf8iAAEBGf/qAAEBAv/qAAECCv/qAAEBYP/qAAEAof9RAAEBGf9RAAEBV//qAAEAmf9RAAEBNP9RAAEBO/9RAAEA///qAAEBOf/qAAEBGf9DAAEAtf/qAAEBY//qAAEBGP9DAAEBlP/qAAEBFP8iAAEA+//qAAEBJ/9DAAEAsf/qAAEAb/9DAAEAxv/qAAEAv//qAAEA6v/sAAEA7//qAAEBHv9DAAEBFv8iAAEBFf/qAAEBsv/qAAEAzv/qAAEBov/qAAEBKv/qAAEBDv/qAAEAkf9DAAEAj/9DAAEA8/9DAAEA1/9DAAEA+P9DAAEBA/9DAAEAy//qAAEA0//qAAEBJ//qAAEBIv/qAAEBiv/qAAEA9v9DAAEB/f/qAAEBqv9DAAEB/f/YAAEA9v/qAAEA1P/qAAEBA/9BAAEBE/9DAAEAx//qAAEAg/9DAAEBlP80AAEAsv9DAAEBiP9DAAEA8P/qAAEBA//qAAEBt//qAAEBs/9DAAEB/v/qAAEBaf/qAAEBtv/qAAEBc//qAAEBcf9DAAEApv/qAAEAs/9DAAEAtP9DAAEBCv/qAAEA5v87AAEAzf9nAAEA6f9DAAEBfP/qAAEBd/9DAAEBMv/qAAEBDf/qAAEA5//qAAEA6f9VAAEBCv+WAAEAw//qAAEAzf/qAAEA5f/qAAEAfP/qAAEAq/9DAAEBWf9DAAEA5P/qAAEBEf/qAAEAsv/qAAEAq//qAAEA1v/sAAEAlP9DAAEBYv/qAAEBN//qAAEAr/9KAAEBBf9KAAEA3P9KAAEArf/qAAEBOf9KAAEBS//qAAEArf9KAAEBcP9KAAEBD/9KAAEBcf9KAAEA2P9KAAEBFP9KAAEAh/9KAAEA/f/qAAEBMf/qAAEBQv/qAAEA4v/qAAEBPf/qAAEBJ/9RAAEA9f/qAAEBaP/qAAEA/P/qAAEBzf/qAAEA+P/qAAEAl//qAAEBUv/qAAEBQf/qAAEBMf9RAAEBOf8iAAEBvf/qAAEBRf/qAAEAs/9TAAEBAv9RAAEAs/9RAAEBFP9RAAEBCv9RAAEBRP/qAAEA+/9DAAEA+f9RAAEBK//qAAEBEP/qAAEBNv/qAAEA6P/qAAEAbP9DAAEBIf/qAAEM3AziAAEADAASAAEAAAAmAA8AJgAsADIAOAA+AEQASgBQAFYAXABiAEoAaABuAHQAAQAAAPkAAQCZAWAAAQCPAkgAAQGuAkgAAQCrAOAAAQCPAW8AAQCS/5UAAQCSANQAAQDiAPYAAQCtAPgAAQDpAPgAAQD2AR0AAQCKAW8AAQCZASUAAQEhAPkAAQx4DH4AAQAMABIAAQAAABYABwAWABwAIgAoAC4ANAA6AAEAAAHxAAEB5AKCAAECIQKWAAEBcwHxAAEBrwH7AAEBuQH8AAEB5wIaAAEBlwHxAAEMPgxGAAEADAAWAAIAAABoAAAAaAAuAGQAagBwAHYAfACCAIgAjgCUAJoAoACmAKwAsgC4AL4AxACOAMoA0AC+ANYAoADcAOIA4gDoAO4A9AD6AQABBgEMARIBGAEeASQBKgEqATABNgE8AUIBSAD6AU4AAQAAAAAAAQHrAAAAAQGWAAAAAQCXAAAAAQFWAAAAAQFMAAAAAQF4AAAAAQFkAAAAAQCFAAAAAQEWAAAAAQGcAAAAAQEHAAAAAQEiAAAAAQHdAAAAAQEEAAAAAQFjAAAAAQD7AAAAAQCxAAAAAQGwAAAAAQDYAAAAAQEUAAAAAQD4AAAAAQDHAAAAAQEVAAAAAQG5AAAAAQEdAAAAAQDGAAAAAQGYAAAAAQGBAAAAAQEYAAAAAQCmAAAAAQGkAAAAAQFaAAAAAQCRAAAAAQExAAAAAQDpAAAAAQD6AAAAAQGfAAAAAQDkAAAAAQE5AAAAAQEhAAAAAQJyCzwAAQAMAY4AYAAAAZwAAAGiAAABnAAAAZwAAAGiAAABnAAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAZwAAAGiAAABnAAAAZwAAAGcAAABnAAAAaIAAAGcAAABnAAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABnAAAAaIAAAGcAAABnAAAAaIAAAGcAAABogAAAZwAAAGiAAABnAAAAaIAAAGcAAABogAAAZwAAAGcAAABnAAAAZwAAAGcAAABnAAMACYALAAyACwAMgA4ADgAPgBEAEoAUABWAAEAAAIGAAEAAAKiAAEAAALjAAEAAAKzAAEAAAM3AAEAAALSAAEAAAMUAAEAAAL2AAEAAALfAAEAAANSAAEAAALhAAEAAgAACW4AAQACAAA0AgABAAIAAEX+AAEAAgAAV54AAQACAABbegABAAIAAG/WAAEAAgAAhMYAAQACAACfSgABAAIAALN0AAEAAgAAx1wAAQACAADXzgABAAIAAOsmAAEAAgAA/goAAQACAAERQgABAAIAASOAAAEAAgABNToAAQACAAFGRgACAAgI/AkYAAAJGgkeAB0JIQkoACIJOAk4ACoJSglOACsJUAlRADAJXglpADIJbAmNAD4AAQILAAIAAwAEAAUABgAHAAgACQAKAAsADAANAA4ADwAQABEAEgATABQAFQAWABcAGAAZABoAGwAcAB0AHgAfACAAIQAiACMAJAAlACYAJwAoACkAKgArACwALQAuAC8AMAAxADIAMwA0ADUAPABBAEIAUABTAFUAXQBjAGQAagBvAHAAeQB6AIMAhQCUAJkAmwCcAKAAowCnAKoAqwCsAK0ArgCyALkAuwC8AMIAxwDQANIA0wDUANUA1gDXAPUA9gD8AQEBCAEKASUBJgEnASkBKgErASwBLQEuAS8BMAExATIBMwE0ATUBNgE3ATgBQgFDAUoBTwFQAV4BYQFjAWsBdwF8AX0BhgGPAZEBoAGoAawBrQGwAbUBuAG5AboBuwG8AcABxwHKAcsB0QHWAd8B4QHiAeMB5AHlAeYB/QIFAgYCDAIRAhICGgIzAjQCNQI2AjcCOQI6AjsCPAI9Aj4CPwJAAkECQgJDAk0CTgJPAlACUQJSAlMCVAJVAlYCVwJYAlkCWgJbAl0CXgJfAmACYQJiAmMCZAJlAmYCZwJoAmkCagJrAmwCbQJuAnACcQJyAnMCdAJ1AnYCdwJ4AnkCegJ7AnwCfQJ+An8CgAKBAoICgwKEAoUChgKHAogCiQKKAosCjAKNAo4CjwKQApECkgKTApQClQKWApcCmAKZApoCmwKcAp0CngKfAqACoQKiAqMCpAKlAqYCpwKoAqkCtAK6Ar8CwgLDAsQCxQLGAs0C0QLSAuEC4wLqAu8C8AL+AwADAQMKAw4DEQMSAxMDFAMYAxkDGgMdAx4DIgM9Az4DPwNAA0EDQgNDA0QDRQNGA0cDSANJA0oDSwNMA00DTgNPA1ADUQNSA1MDVANVA1YDVwNYA1oDWwNdA14EZwRqBGwEbQRvBHEEdQR6BH0EfgSCBIQEhQSGBIsEjQSXBJgEmQSlBKYErQSvBLIEtQS4BLoEuwS9BL8EwwTIBMsEzATQBNIE0wTUBNkE5gTnBPME9AUABQQFBQUQBRIFFQUWBSMFJgXaBdsF3AXdBd4F3wXgBeEF4gXjBeQF5QXmBecF6AXpBeoF6wXsBe0F7gXvBfAF8QXyBfMF+gX/BgAGDgYRBhMGGwYhBiIGKAYtBi4GNwY4BkEGUgZXBlkGWgZeBmEGZQZoBmkGagZrBmwGcAZ3BnkGegaABoUGjgaRBpIGkwaUBpUGtAa1BrsGwAbHBskG5AblBuYG6AbpBuoG6wbsBu0G7gbvBvAG8QbyBvMG9Ab1BvYG9wcBBwIHAwcJBw4HEAcRBxMHFAcVBxYHGAcZBxoHGwccBx0HHgcgByEHIwclBygHLgc1BzgHOgc7Bz0HPwdDB0gHUAdSB1MHVAdlB2cHcwd0B3sHfQeEB4UIMAhICPsAAQAFCSkJKgktCVIJUwABADEABAAMABAAEQAVABgAGgAeACYAKgArAC8AMgA0AFwAowC9AL4AvwDCAMYBNQFDAWoBsAHMAc0BzgHRAdUCdAJ1BdwF5AXoBekF7QXwBfIGGgZhBnsGfAZ9BoAGhAb0BwII+wABAAIJOQk6AAEAFAAEAAYAFAAVAB4AIAAuAC8AMAB6ANQB4wJfApQF3AXsBe0GOAaSCPsAAgAFCSsJLAAACS8JNwACCT0JRAALCUYJSQATCU8JTwAXAAIAgQACADgAAAA8AD0ANwA/AEAAOQBTAFMAOwBVAFUAPABdAF0APQBjAGcAPgBqAGsAQwBtAHAARQB5AHoASQCDAIMASwCFAIUATACPAJEATQCUAJUAUACXAJgAUgCcAJwAVACgAKAAVQCqAK4AVgCzALQAWwC7AL8AXQDCAMMAYgDFAMcAZADQANAAZwDTANcAaAD1APkAbQD8AP0AcgEAAQAAdAEIAQgAdQEKAQoAdgElAScAdwEpATgAegFDAUYAigFKAUsAjgFNAU4AkAFeAV4AkgFhAWEAkwFjAWMAlAFrAWsAlQFyAXQAlgF3AXgAmQF6AX0AmwGGAYYAnwGPAY8AoAGRAZEAoQGbAZ0AogGgAaEApQGjAaQApwGnAagAqQGsAa0AqwG4AbwArQHBAcIAsgHKAc4AtAHRAdIAuQHUAdYAuwHfAd8AvgHhAeYAvwH9Af0AxQIFAgkAxgIMAg0AywIQAhAAzQIaAhoAzgIzAjcAzwI5AkMA1AJOAlsA3wJdAqkA7QK0ArcBOgK6ArsBPgK9Ar4BQALDAskBQgLNAtABSQLhAuEBTQLjAuYBTgLqAusBUgLtAu4BVAL+Av4BVgMAAwEBVwMKAwoBWQMRAxQBWgMZAxoBXgMhAyEBYAMyAzIBYQM9A0ABYgNCA1gBZgNaA1oBfQNeA14BfgXaBfYBfwX6BfsBnAX9Bf4BngYRBhEBoAYTBhMBoQYbBhsBogYhBiUBowYoBikBqAYrBi4BqgY3BjgBrgZBBkEBsAZNBk8BsQZSBlMBtAZVBlYBtgZaBloBuAZeBl4BuQZoBmwBugZxBnIBvwZ5Bn0BwQaABoEBxgaDBoUByAaOBo4BywaRBpUBzAa0BrgB0Qa7BrwB1ga/Br8B2AbHBscB2QbJBskB2gbkBuYB2wboBvcB3gcCBwYB7gcJBwoB8wcMBw0B9QcRBxEB9wcTBxYB+AcZBxsB/AcdBx4B/wcgByECAQcjByMCAwclByUCBAcoBygCBQgnCCcCBghICEgCBwj7CPsCCAABAAEJRQABAA8ADQAdAB8AIQAnACsALQAuAC8ANQKDAocDCgXlCPsAAQABCS4AAQAHABAAFgAqADAF6AXuCPsAAQACCTsJPAABAC4AAgAGAAoAEAAWABwAIAAkACoAMAB5AHoA0wDUATYBhgGnAagB4gHjAjkCTgJdAl8CbAJtAn8ClAKVArQCxgLjAwADGQXaBd4F4gXoBe4GNwY4BpEGkgb1BwMI+wABAAwJAgkGCQcJCAkJCQ4JEAkSCRQJGAkaCRsAAShWAAQAAAEhAkwCXgKIAo4CrAKyArgCvgLEAsoC0ALWAtwC5gL4AyIDTATyBPgE/gUEBQoFEAUWBTQFOgVABUYFTAVSBVgFXgVkBYYFjAWSBZgFngWkBaoFsAW2BbwFwgXIBc4F2AXeBeQF6gXwBfYF/AYCBggGDgYUBhoGIAYmBiwGMgY4Bj4GRAZKBlAGVgZoBm4GdAZ6BoAGhgaMBpIGmAaeBqQGqgawBrYGvAbCBsgGzgbUBtoG4AbmBuwG8gb4Bv4HBAcKBxAHFgccByIHKAgSC7wL3g64Dr4OxBDaEUARRhFMEVIRaBFuEXQRehPcFkIWSBZOFnAWkhaYFp4WwBbGFswW0hbsF04XbBdyF5AXlhecF6IXwBfGF8wYIhgwGEIYWBhmGHgYphjMGOIY+BkGGSwZUhl0GX4ZiBmOGaQZuhnIGdYZ5BnyGgAaDhocGioaUBp2GpwawhroGw4bNBtaG3AbhhucG7IbyBveG/QcChwgHDYcPBxGHEwcUhxYHF4caBxuHHQcfhyIHJIcmByeHNgc3hzkHOoc9Bz6HQAdBh1AHUYdTB1SHWAdZh1sH2IfaB9uH3Qfeh+MH5IfvB/aH/QgEiAwIF4gdCCGIJwgqiDQIO4hDCEuIUghdiGQIaYh9CJCIkgiTiJUInoinCKiIqgiriK0JHYlBCUWJSglLiVEJVYlaCV+JZQlmiW4Jb4lxCXKJdwl8iX4Jg4mJCZKJmAmZiaIJqYmuCa+JtQm5icMJyInPCduJ7AnzigMKCooMCg6KEQABAGdAA8BngAgAZ8AIAGgAA8ACgGbABQBnAAEAZ0ALAGeAEQBnwBEAaAALAGhACwBowATAaYABAMYAAQAAQgp//AABwGbADwBnQA8AZ4AUAGfADwBoAA8AaEAPAGjADwAAQgp//AAAQgaACQAAQgp/98AAQgaACQAAQgaACQAAQgp//sAAQgp//AAAQgp//AAAgVsABAFbgAQAAQBnQAPAZ4AIAGfACABoAAPAAoBmwAUAZwABAGdACwBngBEAZ8ARAGgACwBoQAsAaMAEwGmAAQDGAAEAAoBmwAUAZwABAGdACwBngBEAZ8ARAGgACwBoQAsAaMAEwGmAAQDGAAEAGkAAv/dAAv/fwAc/+QAIv/0ADb/3QA3/90AOP/dADn/3QA6/90AO//dADz/3QA9/90APv/dAD//3QBA/90AQf/dAEL/3QBD/90ARP/dAEX/3QBG/90AR//dAEj/3QBJ/90ASv/dAEv/3QBM/90ATf/dAE7/3QBP/90AU//dAJ7/fwCf/38AoP9/ANP/3QE1/90BPf/dAUT/5AFF/+QBRv/kAUf/5AFI/+QBSf/kAUr/5AFL/+QBTP/kAU3/5AFO/+QBT//kAVD/5AFR/+QBUv/kAVP/5AFU/+QBVf/kAVb/5AFX/+QBWP/kAVn/5AFa/+QBW//kAVz/5AFd/+QBXv/kAV//5AFg/+QBYf/kAYj/9AGJ//QBiv/0AYv/9AGM//QBjf/0AY7/9AGQ//QCSP/kAuP/5ALk/+QC5f/kAub/5ALn/+QC6P/kAun/5ALq/+QC6//kAuz/5ALt/+QC7v/kAu//5ALw/+QC8f/kAvL/5ALz/+QC9P/kAvX/5AL2/+QC9//kAvj/5AL5/+QC+v/kAvv/5AL8/+QC/f/kAv7/5AL//+QAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AABwGbADwBnQA8AZ4AUAGfADwBoAA8AaEAPAGjADwAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AAAQgp//AACAGbAFkBnQBZAZ4AYAGfAGoBoABJAaEAUAGjAGAFuwAAAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAEIGgAkAAECnwAoAAECnwAoAAECnwAoAAICnwAoCOUAOAABAp8AKAABAp8AKAABAp8AKAABCCn/3wABCCn/3wABCCn/3wABCCn/3wABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAABCBoAJAAEADP/7gJw/+4I6//uCOz/7gABBbv/8AABBbv/8AABBbv/8AABBbv/8AABBbv/8AABBbv/8AABCCn/+wABCCn/+wABCCn/+wABCCn/+wABCCn/+wABCCn/+wABCCn/+wABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/8AABCCn/+wABCCn/8AA6ABX/5AAX/+YAGP/4ABr/5AA1/94A7v/kAO//5ADw/+QA8f/kAPL/5ADz/+QA9P/kAPX/5AD2/+QBEP/mARH/+AES//gBE//4ART/+AEV/+QBFv/kARf/5AEY/+QBGf/kARr/5AEb/+QBHP/kAS7/5AEz/+YCLf/eAi7/3gIv/94CMP/eAjH/3gIy/94CN//eAjj/3gJA/94CnP/eAp3/3gKs/+QFcv/cBXf/5gV5/+YFh//2BYj/9gWJ//YFjP/2BY3/9gWs/9QFs//cBbX/3AW2/9wI5f/mCOf/5gjp/+YJqP/cCan/3ADqABX/7AAX/+4AGv/kABz/9gAeAAgAHwAIACAACAAi//YAKgAIACwACAAxAAIAMgACAO7/7ADv/+wA8P/sAPH/7ADy/+wA8//sAPT/7AD1/+wA9v/sARD/7gEV/+QBFv/kARf/5AEY/+QBGf/kARr/5AEb/+QBHP/kAS7/7AEz/+4BRP/2AUX/9gFG//YBR//2AUj/9gFJ//YBSv/2AUv/9gFM//YBTf/2AU7/9gFP//YBUP/2AVH/9gFS//YBU//2AVT/9gFV//YBVv/2AVf/9gFY//YBWf/2AVr/9gFb//YBXP/2AV3/9gFe//YBX//2AWD/9gFh//YBZgAIAWcACAFoAAgBaQAIAWoACAFrAAgBbAAIAW0ACAFuAAgBbwAIAXAACAFxAAgBcgAIAXMACAF0AAgBdQAIAXYACAF3AAgBeAAIAXkACAF6AAgBewAIAXwACAF9AAgBfgAIAX8ACAGAAAgBgQAIAYIACAGDAAgBhAAIAYUACAGI//YBif/2AYr/9gGL//YBjP/2AY3/9gGO//YBjwAIAZD/9gGRAAgBzAAIAc0ACAHOAAgBzwAIAdAACAHRAAgB0gAIAdMACAHUAAgB1QAIAdYACAHXAAgB2AAIAdkACAHaAAgB2wAIAdwACAHdAAgB3gAIAd8ACAHgAAgB4QAIAeQACAHmAAgB5wAIAegACAHpAAgB6gAIAesACAIgAAICIQACAiIAAgIjAAICJAACAkj/9gJJAAgCSwAIAk8ACAJTAAgCVQAIAlYACAJXAAgCWAAIAlkACAJaAAgCZAAIAmUACAJnAAgCfwAIAoAACAKBAAgCggAIApgAAgKbAAICrP/sAsYACALHAAgCyAAIAskACALKAAgCywAIAswACALNAAgCzgAIAs8ACALQAAgC0QAIAtIACALTAAgC1AAIAtUACALWAAgC1wAIAtgACALZAAgC2gAIAtsACALcAAgC3QAIAt4ACALfAAgC4AAIAuEACALiAAgC4//2AuT/9gLl//YC5v/2Auf/9gLo//YC6f/2Aur/9gLr//YC7P/2Au3/9gLu//YC7//2AvD/9gLx//YC8v/2AvP/9gL0//YC9f/2Avb/9gL3//YC+P/2Avn/9gL6//YC+//2Avz/9gL9//YC/v/2Av//9gMBAAgDAgAIAwMACAMEAAgDBQAIAwYACAMHAAgDCAAIAwkACAWH/94FiP/eBYn/3gWM/94Fjf/eBY7/7gXGAAYIKf/wAAgBmwBZAZ0AWQGeAGABnwBqAaAASQGhAFABowBgBbsAAAC2AAv/7AAU/+wAFf/kABf/5gAY//YAGv/cABz/9QAh//sAIv/2AC//7gAx//oAMv/6ADP/5wA1AAEAnv/sAJ//7ACg/+wA5f/sAOb/7ADn/+wA6P/sAOn/7ADq/+wA6//sAOz/7ADu/+QA7//kAPD/5ADx/+QA8v/kAPP/5AD0/+QA9f/kAPb/5AEQ/+YBEf/2ARL/9gET//YBFP/2ARX/3AEW/9wBF//cARj/3AEZ/9wBGv/cARv/3AEc/9wBLv/kATP/5gFE//UBRf/1AUb/9QFH//UBSP/1AUn/9QFK//UBS//1AUz/9QFN//UBTv/1AU//9QFQ//UBUf/1AVL/9QFT//UBVP/1AVX/9QFW//UBV//1AVj/9QFZ//UBWv/1AVv/9QFc//UBXf/1AV7/9QFf//UBYP/1AWH/9QGH//sBiP/2AYn/9gGK//YBi//2AYz/9gGN//YBjv/2AZD/9gH9//sB/v/uAf//7gIA/+4CAf/uAgL/7gID/+4CBP/uAgX/7gIG/+4CIP/6AiH/+gIi//oCI//6AiT/+gItAAECLgABAi8AAQIwAAECMQABAjIAAQI3AAECOAABAkAAAQJI//UCcP/nAo7/7gKP/+4CkP/uApH/7gKS/+4CmP/6Apv/+gKcAAECnQABAqv/7gKs/+QCr//7ArD/+wKx//sCsv/7ArP/+wLj//UC5P/1AuX/9QLm//UC5//1Auj/9QLp//UC6v/1Auv/9QLs//UC7f/1Au7/9QLv//UC8P/1AvH/9QLy//UC8//1AvT/9QL1//UC9v/1Avf/9QL4//UC+f/1Avr/9QL7//UC/P/1Av3/9QL+//UC///1Axf/+wV3//YFef/2BYP/8QWF//EFhwACBYgAAgWJAAIFjAACBY0AAgWO//gFqv/eBaz/6AXG//EFx//mCEj/+wjl//YI5//2COn/9gjr/+cI7P/nCZz/+wmd//sAAQgp//AAAQgp//AAhQAL/9gAFf/sABf/+AAa//AAG//4ABz/7AAl//YANf/kAJ7/2ACf/9gAoP/YAO7/7ADv/+wA8P/sAPH/7ADy/+wA8//sAPT/7AD1/+wA9v/sARD/+AEV//ABFv/wARf/8AEY//ABGf/wARr/8AEb//ABHP/wAR3/+AEe//gBH//4ASD/+AEh//gBIv/4AS7/7AEw//gBM//4AUT/7AFF/+wBRv/sAUf/7AFI/+wBSf/sAUr/7AFL/+wBTP/sAU3/7AFO/+wBT//sAVD/7AFR/+wBUv/sAVP/7AFU/+wBVf/sAVb/7AFX/+wBWP/sAVn/7AFa/+wBW//sAVz/7AFd/+wBXv/sAV//7AFg/+wBYf/sAar/9gGr//YBrP/2Aa3/9gIt/+QCLv/kAi//5AIw/+QCMf/kAjL/5AI3/+QCOP/kAkD/5AJI/+wCY//2Anr/9gKL//YCjP/2Apz/5AKd/+QCrP/sAuP/7ALk/+wC5f/sAub/7ALn/+wC6P/sAun/7ALq/+wC6//sAuz/7ALt/+wC7v/sAu//7ALw/+wC8f/sAvL/7ALz/+wC9P/sAvX/7AL2/+wC9//sAvj/7AL5/+wC+v/sAvv/7AL8/+wC/f/sAv7/7AL//+wFa//EBWz/xAVv/8QFev/EBXv/xAWH//AFiP/wBYn/8AWM//AFjf/wBaj/7AXGABsFxwAECaT/xAml/8QAGQAV/+wAF//uABr/4gDu/+wA7//sAPD/7ADx/+wA8v/sAPP/7AD0/+wA9f/sAPb/7AEQ/+4BFf/iARb/4gEX/+IBGP/iARn/4gEa/+IBG//iARz/4gEu/+wBM//uAqz/7AWs//IAAQgaACQAAQgaACQAAQgp//AABQV3/8QFef/ECOX/xAjn/8QI6f/EAAEIGgAkAAEIGgAkAAEIKf/wAJgAC/+3ABv/9gAc/+MAIv/2ACX//gAu//YAMQAFADIABAA1//YAnv+3AJ//twCg/7cBHf/2AR7/9gEf//YBIP/2ASH/9gEi//YBMP/2AUT/4wFF/+MBRv/jAUf/4wFI/+MBSf/jAUr/4wFL/+MBTP/jAU3/4wFO/+MBT//jAVD/4wFR/+MBUv/jAVP/4wFU/+MBVf/jAVb/4wFX/+MBWP/jAVn/4wFa/+MBW//jAVz/4wFd/+MBXv/jAV//4wFg/+MBYf/jAYj/9gGJ//YBiv/2AYv/9gGM//YBjf/2AY7/9gGQ//YBqv/+Aav//gGs//4Brf/+AfT/9gH1//YB9v/2Aff/9gH4//YB+f/2Afr/9gH7//YCIAAFAiEABAIiAAQCIwAEAiQABAIt//YCLv/2Ai//9gIw//YCMf/2AjL/9gI3//YCOP/2AkD/9gJI/+MCY//+Anr//gKK//YCi//+Aoz//gKYAAUCmwAFApz/9gKd//YC4//jAuT/4wLl/+MC5v/jAuf/4wLo/+MC6f/jAur/4wLr/+MC7P/jAu3/4wLu/+MC7//jAvD/4wLx/+MC8v/jAvP/4wL0/+MC9f/jAvb/4wL3/+MC+P/jAvn/4wL6/+MC+//jAvz/4wL9/+MC/v/jAv//4wVr/6gFbP+oBW//qAV2ABgFd//wBXgAGAV5//AFev+oBXv/qAV8ABgFg//sBYX/7AWH/+QFiP/kBYn/5AWM/+QFjf/kBY7/9AWo/+gFqgAEBcYAIAjkABgI5f/wCOYAGAjn//AI6AAYCOn/8AjqABgJpP+oCaX/qACZAAv/twAb//YAHP/jACL/9gAl//4ALv/2ADEABQAyAAQANf/2AJ7/twCf/7cAoP+3AR3/9gEe//YBH//2ASD/9gEh//YBIv/2ATD/9gFE/+MBRf/jAUb/4wFH/+MBSP/jAUn/4wFK/+MBS//jAUz/4wFN/+MBTv/jAU//4wFQ/+MBUf/jAVL/4wFT/+MBVP/jAVX/4wFW/+MBV//jAVj/4wFZ/+MBWv/jAVv/4wFc/+MBXf/jAV7/4wFf/+MBYP/jAWH/4wGI//YBif/2AYr/9gGL//YBjP/2AY3/9gGO//YBkP/2Aar//gGr//4BrP/+Aa3//gH0//YB9f/2Afb/9gH3//YB+P/2Afn/9gH6//YB+//2AiAABQIhAAQCIgAEAiMABAIkAAQCLf/2Ai7/9gIv//YCMP/2AjH/9gIy//YCN//2Ajj/9gJA//YCSP/jAmP//gJ6//4Civ/2Aov//gKM//4CmAAFApsABQKc//YCnf/2AuP/4wLk/+MC5f/jAub/4wLn/+MC6P/jAun/4wLq/+MC6//jAuz/4wLt/+MC7v/jAu//4wLw/+MC8f/jAvL/4wLz/+MC9P/jAvX/4wL2/+MC9//jAvj/4wL5/+MC+v/jAvv/4wL8/+MC/f/jAv7/4wL//+MFa/+oBWz/qAVv/6gFdgAYBXf/8AV4ABgFef/wBXr/qAV7/6gFfAAYBYP/7AWF/+wFh//kBYj/5AWJ/+QFjP/kBY3/5AWO//QFqP/oBaoABAXGACAIKf/7COQAGAjl//AI5gAYCOf/8AjoABgI6f/wCOoAGAmk/6gJpf+oAAEIKf/7AAEIKf/wAAgBmwBZAZ0AWQGeAGABnwBqAaAASQGhAFABowBgBbsAAAAIAZsAWQGdAFkBngBgAZ8AagGgAEkBoQBQAaMAYAW7AAAAAQgp//AAAQgp//AACAGbAFkBnQBZAZ4AYAGfAGoBoABJAaEAUAGjAGAFuwAAAAEIKf/wAAEIKf/wAAEIKf/7AAYAM//uAnD/7gWs/8AFx//LCOv/7gjs/+4AGAAV/+wAM//uAO7/7ADv/+wA8P/sAPH/7ADy/+wA8//sAPT/7AD1/+wA9v/sAS7/7AJw/+4CrP/sBXf/3AV5/9wFrP/uBcb/2QXH/8kI5f/cCOf/3Ajp/9wI6//uCOz/7gAHBWv/ugVs/7oFb/+6BXr/ugV7/7oJpP+6CaX/ugABACsAGAAHAZ0AKAGeACgBnwAoAaAAKAGhACgBowAoCPQAGAABCPQAGAABCPQAGAABCPQAGAAHAZsAPAGdADwBngBQAZ8APAGgADwBoQA8AaMAPAABCCn/8AABCCn/8AAVA0X/zQNi/+wDz/+sA9H/rAPb/8QD3P/EA93/xAPe/8QD6v/wA+v/8APsABQD7f/cA/L/9wPz//cD9AAsA///rAQB/6wEJf+sBCf/rARO/80Fu//PAAMD7AAAA/IAAAPzAAAABAPsABAD8v/4A/P/+AP0ABQABQPsAAQD8gAEA/MABAP0ABQD9QAUAAMD7AAEA/IABAPzAAQABAPs//gD8v/4A/P/+AP0//sACwPb/9QD3P/UA93/1APe/9QD6//wA+wAFAPt/9oD8v/zA/P/8wP0ABgD9QAoAAkD2//aA9z/2gPd/9oD3v/aA+wAKAPyAAcD8wAHA/QAPAP1ADwABQPsABQD8gAEA/MABAP0ACgD9QAoAAUD7AAMA/L/+wPz//sD9AAYA/UAGAADA+wAAAPyAAAD8wAAAAkD2//aA9z/2gPd/9oD3v/aA+wAKAPyAAcD8wAHA/QAPAP1ADwACQPb/9oD3P/aA93/2gPe/9oD7AAoA/IABwPzAAcD9AA8A/UAPAAIA+r/+gPr//oD7AAoA/IAAgPzAAID9AAsBWsAAAVuAAUAAgVuAAUFuf/6AAIFbAAQBW4AEAABBbn/4wAFBXf//AV5//wI5f/8COf//Ajp//wABQV3//wFef/8COX//Ajn//wI6f/8AAMD7AAAA/IAAAPzAAAAAwPsAAAD8gAAA/MAAAADA+wAAAPyAAAD8wAAAAMD7AAAA/IAAAPzAAAAAwPsAAAD8gAAA/MAAAADA+wAAAPyAAAD8wAAAAMD7AAAA/IAAAPzAAAAAwPsAAAD8gAAA/MAAAAJA9v/2gPc/9oD3f/aA97/2gPsACgD8gAHA/MABwP0ADwD9QA8AAkD2//aA9z/2gPd/9oD3v/aA+wAKAPyAAcD8wAHA/QAPAP1ADwACQPb/9oD3P/aA93/2gPe/9oD7AAoA/IABwPzAAcD9AA8A/UAPAAJA9v/2gPc/9oD3f/aA97/2gPsACgD8gAHA/MABwP0ADwD9QA8AAkD2//aA9z/2gPd/9oD3v/aA+wAKAPyAAcD8wAHA/QAPAP1ADwACQPb/9oD3P/aA93/2gPe/9oD7AAoA/IABwPzAAcD9AA8A/UAPAAJA9v/2gPc/9oD3f/aA97/2gPsACgD8gAHA/MABwP0ADwD9QA8AAkD2//aA9z/2gPd/9oD3v/aA+wAKAPyAAcD8wAHA/QAPAP1ADwABQV3/+wFef/sCOX/7Ajn/+wI6f/sAAUFd//sBXn/7Ajl/+wI5//sCOn/7AAFBXf/7AV5/+wI5f/sCOf/7Ajp/+wABQV3/+wFef/sCOX/7Ajn/+wI6f/sAAUFd//sBXn/7Ajl/+wI5//sCOn/7AAFBXf/7AV5/+wI5f/sCOf/7Ajp/+wABQV3//wFef/8COX//Ajn//wI6f/8AAUFd//8BXn//Ajl//wI5//8COn//AAFBXf//AV5//wI5f/8COf//Ajp//wABQV3//wFef/8COX//Ajn//wI6f/8AAEDUv/3AAIFu//IB3r/tAABBbn/3wABBbv/3QABBbn/3wABBbn/3wACBbv/yAd6/7QAAQW7/90AAQTcAGkAAgW7/8gHev+0AAIFu//IB3r/tAACBbv/yAd6/7QAAQW5/98AAQW5/98ADgV0/6wFdf+sBXb/wAV3/7AFeP/ABXn/sAV8/8AI5P/ACOX/sAjm/8AI5/+wCOj/wAjp/7AI6v/AAAEFu//dAAEFu//dAAEFuf/jAAIFbAAQBW4AEAABBbn/4wABBbn/4wABBaP/+wAOBXQABwV1AAcFdgAbBXcABwV4ABsFeQAHBXwAGwjkABsI5QAHCOYAGwjnAAcI6AAbCOkABwjqABsAAQW5/+MAAQTp/+cAAQTp/+cAAwS5ACgFbAAQBW4AEAABBbn/4wABBbn/3wB9AB7/+AAf//gAIP/4ACr/+AAs//gBZv/4AWf/+AFo//gBaf/4AWr/+AFr//gBbP/4AW3/+AFu//gBb//4AXD/+AFx//gBcv/4AXP/+AF0//gBdf/4AXb/+AF3//gBeP/4AXn/+AF6//gBe//4AXz/+AF9//gBfv/4AX//+AGA//gBgf/4AYL/+AGD//gBhP/4AYX/+AGP//gBkf/4Acz/+AHN//gBzv/4Ac//+AHQ//gB0f/4AdL/+AHT//gB1P/4AdX/+AHW//gB1//4Adj/+AHZ//gB2v/4Adv/+AHc//gB3f/4Ad7/+AHf//gB4P/4AeH/+AHk//gB5v/4Aef/+AHo//gB6f/4Aer/+AHr//gCSf/4Akv/+AJP//gCU//4AlX/+AJW//gCV//4Alj/+AJZ//gCWv/4AmT/+AJl//gCZ//4An//+AKA//gCgf/4AoL/+ALG//gCx//4Asj/+ALJ//gCyv/4Asv/+ALM//gCzf/4As7/+ALP//gC0P/4AtH/+ALS//gC0//4AtT/+ALV//gC1v/4Atf/+ALY//gC2f/4Atr/+ALb//gC3P/4At3/+ALe//gC3//4AuD/+ALh//gC4v/4AwH/+AMC//gDA//4AwT/+AMF//gDBv/4Awf/+AMI//gDCf/4BSL/7AW5/+MAAQUl/+wAAQUZABIAAQW5/+MAAQW5/+MABAVC//YFQ//uBUT/5gVI/+QAAQVC//AACgVB//YFQv/qBUP/9AVE//YFRf/YBUb/9gVH//QFSP/aBUr/7AhH/9oABwVC//YFQ//2BUT/7gVG//YFSP/uBUr/9ghH/+4ABgVC/+wFQ//2BUT/9gVG//YFSP/sBUr/7gAHBUL/3AVD//YFRP/uBUb/9gVI/+QFSv/uCEf/8AAHBUL/5gVD/+4FRP/uBUb/9gVI/9wFSv/mCEf/7gALBUH/5AVC//QFQ//sBUT/7AVF/54FRv/qBUf/4gVI//QFSf/iBUr/7AhH/8gABQVC/+QFRP/2BUj/5AVK/+QIR//uAAQFQv/sBUP/9gVE/+4FSP/kAAUFWP/8BVn/9gVa/+4FXP/4BV7/3AADBVj/8AVa//gFXv/sAAkFV//2BVj/4gVZ//YFWv/0BVv/9gVc//QFXv+qBWD/9ghH/90ABwVY/+YFWf/2BVr/7gVc/+4FXv/cBWD/7QhH/+4ABwVY/+QFWf/2BVr/9AVc//QFXv/iBWD/9AhH//QACAVX//gFWP/iBVn/9gVa/+4FXP/uBV7/2gVg/+4IR//mAAYFWP/kBVn/9gVa/+4FXP/uBV7/2gVg//YACwVX/+QFWP/sBVn/5gVa/+YFW/+oBVz/5AVd//YFXv/sBV//4AVg//YIR//cAAYFWP/kBVn/9gVa//YFXP/2BV7/5AVg/+4ABQVY/+wFWf/2BVr/9gVc//YFXv/iABMDNAAhAzUAGwM2ABgDNwAbAzkAGAM6ABQDPAAYA20AIQN4//cDeQAbA4D/9wOBABsDiv/3A4sAGwOW//MDlwAYA58AFAOn//MDqAAYABMDNAAhAzUAGwM2ABgDNwAbAzkAGAM6ABQDPAAYA20AIQN4//cDeQAbA4D/9wOBABsDiv/3A4sAGwOW//MDlwAYA58AFAOn//MDqAAYAAEHQP/wAAEHQP/wAAEHQP/wAAkBmwAoAZ0ALwGeAC8BnwAvAaAALwGhAC8BowAvAaoALwIEAAIACARr/9gEcv/sBJD/7AS5/9wEwP/cBN7/3Ac5/9wHQP/wAAEHQP/wAAEHQP/wAAEHQP/wAAEFbAANAHAFa/+gBWz/oAVv/6AFev+gBXv/oAXa/+AF3P/qBeD/6gXj/5gF6P/qBer/6gXs/+gF8//xBfT/4AX1/+AF9v/gBff/4AX4/+AF+f/gBfr/4AX7/+AF/P/gBf3/4AX+/+AF///gBgD/4AYB/+AGAv/gBgP/4AYE/+AGBf/gBgb/4AYH/+AGCP/gBgn/4AYK/+AGC//gBgz/4AYN/+AGEf/gBhb/6gYX/+oGGP/qBhn/6gYa/+oGG//qBjr/6gY7/+oGPP/qBj3/6gY+/+oGP//qBkD/6gZB/+oGQv/qBkP/6gZc/5gGXf+YBl7/mAZ7/+oGfP/qBn3/6gZ+/+oGf//qBoD/6gaB/+oGgv/qBoP/6gaE/+oGhf/qBob/6gaH/+oGiP/qBon/6gaK/+oGi//qBoz/6gaN/+oGjv/qBo//6gaQ/+oGkf/gBpP/6gaV/+oGlv/qBpf/6gaY/+oGmf/qBpr/6gaj/+gGpP/oBqX/6Aam/+gGp//oBqj/6Aap/+gGqv/oBqv/6Abc//EG3f/xBt7/8Qbf//EG4P/xBuH/8Qbm//EG5//xBu//8Qb0/+AG/P/gBv//6gmk/6AJpf+gACMF2v/mBeP/oQX0/+YF9f/mBfb/5gX3/+YF+P/mBfn/5gX6/+YF+//mBfz/5gX9/+YF/v/mBf//5gYA/+YGAf/mBgL/5gYD/+YGBP/mBgX/5gYG/+YGB//mBgj/5gYJ/+YGCv/mBgv/5gYM/+YGDf/mBhH/5gZc/6EGXf+hBl7/oQaR/+YG9P/mBvz/5gAEB0//2gdX/9oHYP/aB27/2gAEB0//2gdX/9oHYP/aB27/2gABBbv/2AAFBbn/8AdP//QHV//2B2D/9gdu//QABAdP/9oHV//aB2D/2gdu/9oABAdP/+4HV//uB2D/7gdu/+4ABQW5//AHT//0B1f/9gdg//YHbv/0AAUFuf/wB0//9AdX//YHYP/2B27/9AABBbv/2AAHBaP/+wWl//sFp//7Bbn/+wW7//sFvf/7Bb//+wABBbv/2AABBbv/2AABBbv/2AAEB0//2gdX/9oHYP/aB27/2gAFBbn/8AdP//QHV//2B2D/9gdu//QAAQdz//gABQdP/+4HV//uB2D/7gdu/+4Hqf/nAAUFuf/wB0//9AdX//YHYP/2B27/9AAJB0f/1AdM/7UHT//UB1f/1Adg/9QHZf/YB27/1Ad2/7UHjv/UAAUFuf/wB0//9AdX//YHYP/2B27/9AABB57/9QAIB5j/8AeZ//YHmv/3B5v/8wed/+0Hnv/2B5///Qeg/+0ABweY/+0Hmv/2B5v/8Qec//YHnf/uB57/9Aef//QABAeY//YHmv/uB53/9gee//QAAQeY//gABQeY//YHmf/4B5z/9ged//gHnv/0AAQHmP/uB53/+wee/+4HoP/2AAkHl//uB5j/9geZ/+4Hmv/uB5v/1wec/+sHnf/0B5//9Aeg//YABQeY/+0Hmf/2B5r/9gee//UHoP/2AAYHmP/tB5n/9gea//YHnf/4B57/6weg//gADAVC/9wFQ//2BUT/8AVG//AFSP/hBUr/3QVY/+QFWf/mBVr/3QVc/90FXv+oBWD/5wAQBUH/9gVC//QFQwAEBUQABAVF/9wFRgAEBUf/8gVI/+wFSf/0BUr/9gVX//QFWP/iBV3/8gVe/+oFX//0BWD/9gAHBUP/9gVE//YFSv/4BVn/9gVa//QFXP/2BV7/9AAPBUIAEgVDAB4FRAAeBUX/7AVGAB4FR//4BVf/+AVY//YFWQAWBVoABAVbABQFXAAEBV3/+AVfAAoFYP/2AAcBmwA8AZ0APAGeAFABnwA8AaAAPAGhADwBowA8AAEBnwA4AAIFbAAQBW4AEAACBWwAEAVuABAABAKfABgCoAAsAqEAGAKiACoAAQEhAAcAFwAeACEAIgAjACYAKAApAC0ALgAvADMAewEQATMBOAFmAWcBaAFpAWoBawGHAYgBiQGKAYsBjAGNAY4BkAGRAZIBkwGUAZUBlgGXAZgBmQGaAZwBnQGeAZ8BoAGhAaMBrgGvAbABsQG+Ab8BwAHBAcIBwwHEAcUBxgHHAcgByQHKAcsB4gHmAecB6AHpAeoB6wHtAe4B7wHwAfEB8gHzAfQB9QH2AfcB+AH5AfoB+wH+Af8CAAIBAgICAwIEAgUCBgJBAk0CTgJTAlYCXQJfAmUCZgJoAmkCagJsAnUCeAJ6AoACgwKGAocCigKLAowCjgKPApACkQKSApgCmQKaApsCnAKfAqACoQKiAq8CsgKzAx0DHwMgAyQDKAMsAy0DLgMwAzEDNQM6AzsDQgNKA1IDVQNjA2gDdgN3A3gDeQN6A3sDfAN9A50DngOfA6ADoQOiA6MDpAPtA+4D7wPwA/ED9QP2A/cD+AP5BEMEagRrBHoEfQSABIoElQSZBJoEmwScBKIEqASpBLMEtAS5BMoEywTOBOcE6ATwBPME9AT1BPYFAwUUBRcFGQUqBSwFQQVCBUMFRAVFBUYFRwVIBUkFSgVXBVgFWQVaBVsFXAVdBV4FXwVgBYMFhQWiBaQFpgWoBbgFugW8Bb4F6ga0BvcHNgc3BzgHOQc8B0oHSwdOB1gHZwdoB2kHagdsB3AHcwd1B3YHdweDB5cHmAeZB5oHmwecB50HngefB6AIQghDCEQIRghICOUI6wjsCPQAAgpUAAQAAAp8CuYAEgBJAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+7/5P/a/+7/yP+3/+r/7P/a/8j/t//i/9j/7v/k//H/7P/k/+z/yP/d//b/3P/d/+T/3P/s/8oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+YAAAAA/+oAAAAAAAAAAP/qAAAAAAAAAAD/9gAAAAD/9AAAAAAAAAAA/+oAAAAA//r/7v/2/+7/7P/6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/s/9QAQP+9AAT/vf/A//EAGP/0AED/vf/x/+z/1P/2//EABP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/s/+z/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8wAGAAAAAAAAP+6AAAAAAAAABgAAAAAAAD/zAAA/+YAAP+6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAD/7gAA//gAAAAAAAAAAAAA/+wAAP/s//D/9v/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7P+wAAAAAP/7//T/7P/7//T/3wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//P/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9gAAAAAAAAAAP/TAAD/2gAA/9MAAAAAAAAAAAAA/+D/vAAAAAD/6v/L/9b/6v/Y/8j/4gAY/9j/0v/MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAEgEsAjwCQwKfAqAEXgRfBGEEYgRjBGQEpQUXBSEFcQWqB3MIFwACABECPAI8AAsCQwJDAA0CnwKfAAwCoAKgAA4EXgReAA8EXwRfAAMEYQRhABEEYgRiAAUEYwRjABAEZARkAAQEpQSlAAEFFwUXAAgFIQUhAAcFcQVxAAkFqgWqAAYHcwdzAAIIFwgXAAoAAgEvAAQABAABAAgACAABABAAEAABABIAEgABABUAFQAuABYAFgAvABcAFwAxABgAGAAzABoAGgA1ABwAHABAAB0AHQA9AB4AIAA6ACEAIQBEACIAIgArACMAIwA9ACUAJQAtACYAJwA9ACgAKQBBACoAKgA6ACsAKwBBACwALAA6AC0ALQBBAC4ALgBCAC8ALwBGADAAMAA+ADEAMQAwADIAMgAyADMAMwBHADQANAA0ADUANQA/AFQAVAAqAFgAXQABAGMAYwAqAHwAhQABAI4AjgAsAJwAnAAsAKsArAAsAL0A0gABANUA1QABANcA3AABAO4A9gAuAPcBBwAvAQgBCAAsAQkBDwAvARABEAAxAREBFAAzARUBHAA1ASMBIwAqASoBKgAvAS4BLgAuATMBMwAxATYBNgAvAUABQAABAUEBQQAvAUQBYQBAAWMBZQA9AWYBhQA6AYcBhwBEAYgBjgArAY8BjwA6AZABkAArAZEBkQA6AZIBmQA9AagBqABBAaoBrQAtAa4BsAA9AbEBsQBBAbIBtwA9Ab0BvQA9Ab4ByABBAcoBywBBAcwB4QA6AeQB5AA6AeYB6wA6AewB8wBBAfQB+wBCAfwB/AA9Af0B/QBEAf4CBgBGAgcCHwA+AiACIAAwAiECJAAyAiUCLAA0Ai0CMgA/AjMCMwA8AjQCNAA9AjUCNQBBAjcCOAA/AjoCOgA8AjsCOwBBAj8CPwBBAkACQAA/AkECQQBBAkYCRgA9AkgCSABAAkkCSQA6AksCSwA6AkwCTAA+Ak4CTgA+Ak8CTwA6AlACUQBBAlICUgA9AlMCUwA6AlQCVAA0AlUCWgA6AlsCWwA8AmMCYwAtAmQCZQA6AmYCZgA0AmcCZwA6AmgCaAA+AmkCagA9AmsCawBBAm4CbgBBAnACcABHAnECcgA9AnMCcwBBAnYCdwA+AngCeABBAnoCegAtAnsCewBBAn0CfQBBAn8CggA6AoYChgBBAogCiQBBAooCigBCAosCjAAtAo4CkgBGApUClwA+ApgCmAAwApsCmwAwApwCnQA/AqsCqwBGAqwCrAAuAq0CrQAqAq8CswBEArQCwgAiAsUCxQAiAsYC4gA6AuMC/wBAAwADAAA+AwEDCQA6AwoDEAA9AxUDFgA9AxcDFwBEAy0DLQAoAy4DLgApAzsDOwApAz8DPwA3A0kDSQA4A08DTwA5A1IDUgA2A6MDpAApBGsEawAIBG4EbgAaBHIEcgANBHkEeQAmBHoEegASBHsEewAKBH4EfgAFBIEEgQAmBIQEhAAaBIYEhgAXBIkEiQAmBJAEkAANBJIEkgAmBJUElQASBJkEmQAkBJ4EngAaBKAEoAAmBKgEqAAFBLMEtAASBLYEtgACBLcEuAAOBLkEuQAGBLsEuwAbBLwEvAAYBL0EvwAOBMAEwAALBMEEwgAOBMQExAAOBMcExwAQBMgEyAAnBMsEywAOBMwEzAADBM0EzgAOBM8EzwAQBNAE0QAOBNIE0gAJBNME0wAOBNQE1AAVBNgE2AAOBN0E3QAlBN4E3gALBN8E3wAOBOEE4gAOBOME4wAnBOQE5AAOBOUE5QATBOcE5wAjBOgE6AAOBOoE6gAOBOsE6wAbBOwE7AAYBO0E7QAOBO4E7gAQBO8E8QAOBPME9AAjBPYE9gADBPgE+AAbBP4E/gAOBQEFAgAnBQcFBwAKBQ0FDQAmBRUFFQAbBRYFFgAOBRsFGwAOBRwFHAAbBR0FHQAOBR4FHgAQBR8FHwAOBSAFIAAbBSgFKQAOBS8FLwAbBTIFMgAbBWsFbAA7BW0FbgBIBW8FbwA7BXoFewA7BYQFhAAdBYYFhgAdBYcFiQBDBYwFjQBDBzUHNQAeBzYHOAAPBzkHOQAHBzoHOgAPBzsHOwAcBzwHPAAZBz0HPwAPB0AHQAAMB0EHQgAPB0MHQwAgB0QHRQAPB0YHRgAgB0cHRwARB0gHSAAhB0kHSQAfB0sHSwAPB0wHTAAEB00HTgAPB08HTwARB1AHUQAPB1IHUgAZB1MHUwAPB1QHVAAWB1UHVgAPB1cHVwARB1gHWAAPB1kHWQAgB1sHXAAPB14HXgAMB18HXwAPB2AHYAARB2EHYgAPB2MHYwAhB2QHZAAPB2UHZQAUB2YHZgAgB2gHaAAPB2oHagAPB2sHawAcB2wHbAAZB20HbQAPB24HbgARB28HcQAPB3IHcgAgB3YHdgAEB3cHeAAPB3kHeQAcB3oHegAeB3wHfAAPB34HfgAPB38HgAAgB4EHggAhB4QHhAAcB4UHhQAPB4YHhgAeB4cHhwAfB4gHiAAPB4kHiQAeB4oHigAPB4sHiwAcB4wHjQAPB44HjgARB48HjwAcCCYIJwBFCDcINwBFCEgISABECOsI7ABHCPoI+gBICZwJnQBECaQJpQA7AAIJ6gAEAAAKCApUAA0AYQAAAAz/5v/v/7D/2/+9/9n/xAAF/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAD/9gAAAAAAAAAAAAAAAAAA//T/5P/u//H/8f/2/+T/7P/s/9z/3P/Y/7z/7v/m/+T/9P/m//T/5P/s/+z/3P/c/+7/9P/I/7z/qP/a/+X/4P/k/9j/5P+8/9z/7P/s/9z/qP/l/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2/+7/7v/2//b/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/6cAAAAAAAAAAP/EAAAAAP+7/6gAAP+gAAAAAAAAAAAAAAAA/6cAAAAA/7sAAAAAAAAAAP+g/4IAAAAAAAD/pwAA/8T/oP+oAAAAAP+7/4IAAAAA/90AAAAA/90AAAAA/8sALf/d/6v/q//L/6cALf/d/6v/yv/KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE/+7/7P/U/+7/7P/s/9gAAAAAAAQAAAAAAAAAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7P/u/9T/7v/U/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/v//mAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9gAAAAAAAAAAAAAAAAAAAAAAAAAAP/wAAAAAP/w//sAAP/kAAf/8P/2//b/5AAAAAf/8P/2AAAAAAAAAAAAAAAAAAAAAAAH/7D/+wAf//YAB/+w/+7/+//sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/ywAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//j/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/8P/2/+b/7v/n//D/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4AAD/5wAA//D/8P/wAAEADQJzA0wESwTzBPQFSAVeBXMFjgWoB54HoAekAAIADANMA0wAAwRLBEsACgTzBPMACwT0BPQADAVIBUgABwVeBV4ABgVzBXMABAWOBY4AAgWoBagACQeeB54ACAegB6AAAQekB6QABQACATgAAgACACsABAAEAEUACAAIAEUACwALAFQAEAAQAEUAEgASAEUAFAAUAC0AFQAVAC4AFgAWAEYAFwAXAC8AGAAYAEcAGQAZADIAGgAaADMAGwAbADUAHAAcAEEAHgAgAEQAIQAhAEIAIgAiAFIAJAAkAFMAJQAlAEMAKgAqAEQALAAsAEQALwAvAFYAMAAwAFcAMwAzADAANgBPACsAUwBTACsAWABdAEUAfACFAEUAngCgAFQAvQDSAEUA0wDTACsA1QDVAEUA1wDcAEUA5QDsAC0A7gD2AC4A9wEHAEYBCQEPAEYBEAEQAC8BEQEUAEcBFQEcADMBHQEiADUBKQEpAFUBKgEqAEYBLgEuAC4BMAEwADUBMwEzAC8BNQE1ACsBNgE2AEYBNwE3ADIBPQE9ACsBQAFAAEUBQQFBAEYBRAFhAEEBZgGFAEQBhwGHAEIBiAGOAFIBjwGPAEQBkAGQAFIBkQGRAEQBmwGmAFMBqQGpAFMBqgGtAEMBzAHhAEQB5AHkAEQB5gHrAEQB/QH9AEIB/gIGAFYCBwIfAFcCRwJHAFMCSAJIAEECSQJJAEQCSgJKAFMCSwJLAEQCTAJMAFcCTgJOAFcCTwJPAEQCUwJTAEQCVQJaAEQCYwJjAEMCZAJlAEQCZwJnAEQCaAJoAFcCcAJwADACdgJ3AFcCegJ6AEMCfwKCAEQCiwKMAEMCjgKSAFYClQKXAFcCqwKrAFYCrAKsAC4CrwKzAEICtALCAFgCxQLFAFgCxgLiAEQC4wL/AEEDAAMAAFcDAQMJAEQDFwMXAEIDGAMYAFMDGwMbAB4DHgMeACIDIAMgACoDIgMiAEADJQMlAB4DKAMoACgDKQMpAEADLAMsACUDLQMtACYDLgMuACcDMAMwACEDMQMxACQDNAM0AFEDOwM7ACcDPQM9ADYDPwM/ADcDRwNHACMDSQNJADgDSwNLADkDTgNOADkDTwNPADoDUQNRADkDUgNSAB8DVANXADkDWwNbAEADXgNeADkDXwNfADYDZANkADkDZwNnADkDagNzAFEDdAN1AB4DowOkACcDrwOvAB4DsAO3AFEDygPWADYD+gQBADkEFAQeADkEHwQqADYENwRCADkEZwRnAAwEawRrAA8EbQRtABwEdQR1AD8EeAR4AD8EeQR5ABcEegR6ABkEfAR8ABQEfgR+AA0EgQSBABcEiQSJABcEiwSLAD8EjASMABEEjwSPAE8EkgSSABcElQSVABkElwSXABoEmASYAD8EmQSZABUEnQSdABwEoASgABcEpASkAD8EpwSnABQEqASoAA0EqwSrABwErASsAAwEsQSyAD8EswS0ABkEtQS1ADwEuQS5AFkEugS6AD4EuwS7AF4EvAS8AF0EwATAAFsEwwTDAD4ExgTGAD4ExwTHAFAEyQTJAD4EygTKABIEzwTPAFAE0gTSAFoE1ATUAFwE1QTWAD4E2QTZAD4E2wTcAE4E3QTdAD0E3gTeAFsE5gTmAD4E6wTrAF4E7ATsAF0E7gTuAFAE8gTyAD4E9QT1ABIE+AT4AF4E+gT7ADwE/AT8AD4E/wUAAD4FBAUEABwFBgUGAAwFCQUJAAwFCwULABwFDQUNABcFDwUPABwFEAURAD4FEgUTADwFFQUVAF4FGAUYAD4FHAUcAF4FHgUeAFAFIAUgAF4FJAUkAD4FLwUvAF4FMgUyAF4FawVsAAkFbwVvAAkFegV7AAkFgwWDAGAFhAWEADsFhQWFAGAFhgWGADsFhwWJAF8FjAWNAF8F2gXaAAEF3AXcAAIF4AXgAAIF4wXjACwF6AXoAAIF6gXqAAIF7AXsAAMF7QXtAAQF7gXuAAUF7wXvAAYF8AXwAAcF8QXxADEF8gXyAAgF8wXzADQF9AYNAAEGEQYRAAEGFgYbAAIGOgZDAAIGXAZeACwGewaQAAIGkQaRAAEGkwaTAAIGlQaaAAIGowarAAMGrQa1AAQGtgbGAAUGyAbOAAUGzwbPAAYG0AbTAAcG1AbbAAgG3AbhADQG5gbnADQG6QbpAAUG7QbtAAQG7wbvADQG8gbyAAYG9Ab0AAEG9Qb1AAUG9gb2ADEG/Ab8AAEG/wb/AAIHAAcAAAUHFQcVAB0HGgcaACkHHAccAEsHHwcfAB0HIwcjAEsHJwcnAEwHKAcoAE0HKgcqACAHLgcuAEsHMQcxAE0HMgcyAB0HNQc1AAsHOQc5AA4HOwc7ABsHQwdDAEkHRgdGAEkHRwdHAEoHSAdIABgHSgdKABMHTwdPAEoHVwdXAEoHWQdZAEkHWgdaABAHXQddABYHYAdgAEoHYwdjABgHZgdmAEkHZwdnAEgHawdrABsHbgduAEoHcgdyAEkHdQd1ABMHeQd5ABsHegd6AAsHfweAAEkHgQeCABgHhAeEABsHhgeGAAsHiQeJAAsHiweLABsHjgeOAEoHjwePABsHkQeRAAQHrQevAAoISAhIAEII6wjsADAJnAmdAEIJpAmlAAkAAgC4AAQAAADEANoABAAVAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9//zwAQ/98AYP++/8//z//P/77/z//P/8//8P/wAAAAAAAAAAAAAAAA/9z/4f/8AAAAAAAA//D/y//fAAD/8AAAAAAAAP/u/9gAOP/wAAEABARgBSII9Aj4AAIAAwUiBSIAAQj0CPQAAwj4CPgAAgACAIEAAgACABIAHAAcAAMAHQAdAAgAHgAgAAoAIQAhAAQAIgAiAAUAIwAjAAgAJAAkAAYAJQAlAAcAJgAnAAgAKAApAAkAKgAqAAoAKwArAAkALAAsAAoALQAtAAkALgAuAAsALwAvAAwAMAAwAA0AMQAxAA4AMgAyAA8AMwAzABQANAA0ABAANQA1ABEANgBPABIAUwBTABIA0wDTABIBNQE1ABIBPQE9ABIBRAFhAAMBYgFiABMBYwFlAAgBZgGFAAoBhwGHAAQBiAGOAAUBjwGPAAoBkAGQAAUBkQGRAAoBkgGZAAgBmgGaABMBmwGmAAYBqAGoAAkBqQGpAAYBqgGtAAcBrgGwAAgBsQGxAAkBsgG3AAgBvQG9AAgBvgHIAAkBygHLAAkBzAHhAAoB5AHkAAoB5gHrAAoB7AHzAAkB9AH7AAsB/AH8AAgB/QH9AAQB/gIGAAwCBwIfAA0CIAIgAA4CIQIkAA8CJQIsABACLQIyABECNAI0AAgCNQI1AAkCNwI4ABECOwI7AAkCPwI/AAkCQAJAABECQQJBAAkCRgJGAAgCRwJHAAYCSAJIAAMCSQJJAAoCSgJKAAYCSwJLAAoCTAJMAA0CTgJOAA0CTwJPAAoCUAJRAAkCUgJSAAgCUwJTAAoCVAJUABACVQJaAAoCYwJjAAcCZAJlAAoCZgJmABACZwJnAAoCaAJoAA0CaQJqAAgCawJrAAkCbgJuAAkCcAJwABQCcQJyAAgCcwJzAAkCdgJ3AA0CeAJ4AAkCegJ6AAcCewJ7AAkCfQJ9AAkCfwKCAAoChgKGAAkCiAKJAAkCigKKAAsCiwKMAAcCjgKSAAwClQKXAA0CmAKYAA4CmwKbAA4CnAKdABECqwKrAAwCrgKuABMCrwKzAAQCtALCAAECxQLFAAECxgLiAAoC4wL/AAMDAAMAAA0DAQMJAAoDCgMQAAgDFQMWAAgDFwMXAAQDGAMYAAYExwTHAAIEzwTPAAIE7gTuAAIFHgUeAAIISAhIAAQI6wjsABQJnAmdAAQAAg0kAAQAAA1sDioAEgBdAAD/5v/u/+T/3P/g/+b/1P/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8oAAAAA/8gAAAAAAAr/zAAQ//gAEP/6//YAEP/i//QAFAAU//H/2P/e//b/9P/cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/u/7f/2P/c/8X/rAAAAAD/4AAQAAAAEAAUAAwAAAAAAAAAAAAAAAAAAAAAAAT/5AAAAA7/3P+wABQAEAAOABQAB//wABQAEP/4//r/8AAU//b/8P/UAAT/9gAU//YAFP/u/9gAEv/1/+4ADP/uAAgAFP/6/+7/7gAc/6z/t//Y/6L/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/YAAD/0AAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/9gAAAAAAAP/2AAD/5AAA//YAAP/mAAD/+AAAAAD/8AAA/+IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAD/4AAA/+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAP/4AAD/+AAAAAD/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//T/6AAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/d/7cAAAAAAAD/xgAAAAAAAAAA/+7/9P/E/9gAAAAAAAAAAAAA/9wAAP/dAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8gAAAAAAAAAAAAAAAAAAP/m/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/6P/Q/5z/v//k/7QAAAAAAAD/2gAAAAAAAAAA//j/9P/mAAAAAAAAAAAAAAAAAAAAAAAAAAD/5P+yAAAAAAAAAAD/7v/w//gAAP/w//D/3wAA//D/5/+w/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7j/1AAAAAAAAP/n//gAAP/4//b/7v/u/9z/3P/n/9z/8P/s/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9v/s/+T/5P/n/+f/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/5AAAAAAAAAAAAAD/9v/s/+wAAAAAAAD/+//4AAD/+P/4AAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/6AAQAAAAAAAAAAAAAAAAAAAAAAAAAAP/k/+z/4gAA/+f/9AAAAA7/9gAAAAAAAAAEAAz/9v/6/+wAAAAAAAAAAAAAAAD/9gAAAAD/9v/NAAAAAAAAAAD/+AAAAAAAAAAAAAAAAAAPAAAAAP/c//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4AAAAAAAA//YAAAAA/+4AAP/4/90AAAAAAAAAEgAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/s/+wAAAAA//j/7P/0AAD/9P/mAAD/1v/e/+wAAP/0AAAAAAAA/+4AAP/wAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAP/w/+IAAAAAAAAAAAAAAAAAAAAAAAAADAAMAAAAAP/4//AAAAAAAAAAAAAAAAD/+AAA/7D/7P/s/+gAAAAAAAAAAP/0AAD/9AAAAAD/xAAAAAAAAP/IAAAAAAAAAAAAAAAA/+wAAAAA/+7/5wAAAAD/+AAA/+7/5//4/9MAAAAAAAAAAP/I/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//z/6AAAAAAAAP/4//gAAAAA/+QAAAAA/7f/+P/2/7//6gAA/9oAAAAAAAD/7AAAAAD/8P/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+AAAP/lAAD/5f/kAAD/l//s/+wAAP+aAAD/+AAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/w/9gAAAAAAAAAAAAAAAAAAAAAAAAAAP/8AAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAA//IAAAAAAAAAAAAA/9YAAP/NAAD/zQAAABL/iAAIAAAAAP98AAAAAAAAAAAAAAAA/94AAAAA/93/vf/2AAAAAAAA/8T/vf/u/+QAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAAAAAAA/+wAAAAA/3L/5wAA/8wAAAAAAAD/6AAA/+z/9gAAAAD/zgAA/+v/zgAAAAD/7v/2/+z/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAA//b/9gAAAAAAAAAAAAAAAAAAAAQAAP/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAD/8AAAAAAAAAAAAAAAAAAAAAD/3gAA/+4AAAAAAAAAAAAA/+QAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAD/5AAA/9gAAAAAAAAAAP/0/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//cAAAAAAAAAAAAAAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAD/3P/c/+wAAAAAAAAAAAAAAAAAAAAAAAD/+P/c//T/2AAAAAAAAAAAAAn/yAAAAAAAAAAEAAAAAP/s/9gAAAAAAAAAAAAAAAD/uAAAAAD/2P/sAAAAAAAAAAAAAP/QAAAAAAAA//j/7gAA/9v/7v/0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAA//YAAAAA//YAAAAAAAD/3AAA/+7/5AAAAAAAAAAAAAAAAAAAAAEAIgRnBHcEeAR7BIkEiwSMBKQErAS1BLYExgTXBNkE2gTrBO0E8gT6BQYFBwUcBR0HNQdFB0YHSQdXB1kHWgdyB3oHhgeHAAIAHwRnBGcAAgR3BHcADgR4BHgAEQR7BHsADASJBIkABwSLBIsAEQSMBIwACgSkBKQAEQSsBKwAAgS2BLYAAwTGBMYADwTXBNcABQTZBNkADwTaBNoACATrBOsABATtBO0ABATyBPIADwUGBQYAAgUHBQcADAUcBR0ABAc1BzUAAQdFB0UADQdGB0YAEAdJB0kACwdXB1cABgdZB1kAEAdaB1oACQdyB3IAEAd6B3oAAQeGB4YAAQeHB4cACwACAQkABAAEADAACAAIADAAEAAQADAAEgASADAAFQAVADMAFgAWADUAFwAXADgAGQAZADsAGgAaAD0AIQAhAC4ALwAvADIAMQAxADYANAA0ADwAWABdADAAfACFADAAvQDSADAA1QDVADAA1wDcADAA7gD2ADMA9wEHADUBCQEPADUBEAEQADgBFQEcAD0BKgEqADUBLgEuADMBMwEzADgBNgE2ADUBNwE3ADsBQAFAADABQQFBADUBhwGHAC4B/QH9AC4B/gIGADICIAIgADYCJQIsADwCVAJUADwCZgJmADwCjgKSADICmAKYADYCmwKbADYCqwKrADICrAKsADMCrwKzAC4DFwMXAC4EZwRnAFgEawRrAB8EbQRtAE8EbgRuAE4EcgRyACUEdQR1ACoEeAR4ACoEeQR5AAMEegR6AEwEewR7ACMEfAR8ACcEfgR+AB0EgQSBAAMEhASEAE4EhgSGAE0EiQSJAAMEiwSLACoEjASMAFUEjwSPAEsEkASQACUEkgSSAAMElQSVAEwElwSXACwEmASYACoEmQSZAAEEnQSdAE8EngSeAE4EoASgAAMEpASkACoEpQSlAFEEpwSnACcEqASoAB0EqwSrAE8ErASsAFgEsQSyACoEswS0AEwEtQS1ABsEtgS2AEkEuQS5AB4EugS6AFoEuwS7AEUEvAS8AC0EwATAACQEwwTDAFoExgTGAFoExwTHAAIEyATIACsEyQTJAFoEygTKACYEzATMABwEzwTPAAIE0gTSACIE1ATUAEQE1QTWAFoE1wTXAEoE2QTZAFoE2gTaACAE3QTdAEYE3gTeACQE4ATgAEoE4wTjACsE5QTlAAQE5gTmAFoE5wTnACgE6wTrAEUE7ATsAC0E7gTuAAIE8gTyAFoE8wT0ACgE9QT1ACYE9gT2ABwE+AT4AEUE+gT7ABsE/AT8AFoE/QT9AFwE/wUAAFoFAQUCACsFBAUEAE8FBgUGAFgFBwUHACMFCQUJAFgFCwULAE8FDQUNAAMFDwUPAE8FEAURAFoFEgUTABsFFQUVAEUFGAUYAFoFHAUcAEUFHgUeAAIFIAUgAEUFIgUiAAgFJAUkAFoFLwUvAEUFMgUyAEUFawVsABQFbQVuABMFbwVvABQFcgVyAAUFdAV1AEAFdgV2AD8FdwV3AAYFeAV4AD8FeQV5AAYFegV7ABQFfAV8AD8FgwWDAFQFhAWEAFAFhQWFAFQFhgWGAFAFhwWJAFIFjAWNAFIFjgWOABkFowWjAFcFpQWlAFcFpwWnAFcFqAWoAFsFqgWqAEEFrAWsAAcFswWzAAUFtQW2AAUFuQW5AFcFuwW7AFcFvQW9AFcFvwW/AFcFxgXGAEIFxwXHAEMF3AXcAC8F4AXgAC8F6AXoAC8F6gXqAC8F7AXsADEF7gXuADQF7wXvADcF8AXwADkF8QXxADoF8wXzAD4GFgYbAC8GOgZDAC8GewaQAC8GkwaTAC8GlQaaAC8GowarADEGtgbGADQGyAbOADQGzwbPADcG0AbTADkG3AbhAD4G5gbnAD4G6QbpADQG7wbvAD4G8gbyADcG9Qb1ADQG9gb2ADoG/wb/AC8HAAcAADQHNQc1AAkHOQc5AAsHOwc7AFYHPAc8AEgHQAdAAA0HQwdDACkHRgdGACkHRwdHABEHSAdIAEcHSQdJAAwHSgdKAA4HTAdMAAoHTwdPABEHUgdSAEgHVAdUAFkHVwdXABEHWQdZACkHWgdaACEHXQddABAHXgdeAA0HYAdgABEHYwdjAEcHZQdlABIHZgdmACkHZwdnAA8HawdrAFYHbAdsAEgHbgduABEHcgdyACkHcwdzABgHdQd1AA4Hdgd2AAoHeQd5AFYHegd6AAkHfweAACkHgQeCAEcHhAeEAFYHhgeGAAkHhweHAAwHiQeJAAkHiweLAFYHjgeOABEHjwePAFYHkweTABUHlAeUABYHlQeVABUHowejABoHpweoABcHqQepABUHqgeqABYHqwerABUHrAesABYHrQevAFMISAhIAC4I5AjkAD8I5QjlAAYI5gjmAD8I5wjnAAYI6AjoAD8I6QjpAAYI6gjqAD8I+gj6ABMJnAmdAC4JpAmlABQJqAmpAAUAAgyuAAQAAA12DwAAEwBVAAD/2v/d/+7/7v/E/+7/9v/e//b/3v/s//b/nP/l/+gAEP/uAB//5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+P/8wAAAAUAAAAAAAA/8T/uP/i/9P/uP/i//v/Xv/q//z/4v/i//D/zP/s//AABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/6z/qf/J/9T/mP/i/+X/qf/l/6H/0QAA/1r/j//AAAAAAAAUAAD/rP+V/8AAAP+VAAAAAP9MAAAAAP/A/9EAAAAA/9EAAAAA/8T/3f/T/+X/oQAQ/9b/zf+h/9P/5v9I/+D/0//o/+3/8f/5/9j/2P/s/4j/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAhAAD/+wAAAAAAAP/m//H/5v/w//D/8P/u/+QAAP/wAAD/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAP/2/+4AAAAAAAD/+AAAAAAAAP/2AAD/9gAAAAD/5P/iAAAAAAAAAAAAAP/s/+3/6AAQ/+7/6wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAA//oAAP/2/+YAAAAAAAAAAP/u/+7/+P/uAAD/5gAAAAD/+AAAAAAAAP/cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAA/+z/+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAQAAP/2/+b/8P/mAAAAAAAAAAD/3P/u//AAAAAAAAAADAAAAAAAAAAA//H/+gAU//H/3P/wAAAAAAAA/+wAAP/w//r/7v/S/8gAAAAA/+7/0wAAAAAAAP/x/+YAAAAA/+b/5P/s//D/9gAAAAD/2AAA/+wAAAAA//b/7AAA/+7/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9QAAAAAAAAAA//D/+gAA//r/+AAA//gAAAAK//EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/w//YAAAAAAAAAAAAAAAD/7AAAAAAAAAAA/+wAAAAAAAD/9v/cAAAAAAAAAAAAAP/4/+b/5AAAAAD/6AAAAAAAAAAA/97/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAP/2//QAAP/2AAD/9v/2AAD/+AAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//j/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/T//b/9v/2AAD/9gAAAAAAAAAAAAAAAAAAAAAACgAA/+4AAAAAAAAAAP/2AAD/6AAA//YAAAAAAAAAAAAAAAD/8v/y/+wAAAAAAAD/3AAAAAAAAAAAAAAAAAAA/+T/8v/8AAD/5AAAAAAAAAAAAAAAAAAAAAD/9AAA//YAAAAAAAAACv/2//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9P/0AAAADv/0AAwAFgAAAA7/9gAMAAT/yP/2//QAPAAAAEcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4AAAAAAAAABsAAAAUABQAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAFgAWAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/E/+4AAAAkAAAAAAAAAAD/9AAAAAD/9AAMACz/tAAAACEABAAA//j/7gAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAACwAKAAsAA8AAAAAAAAAAAAAAAAAAAAA//T/6P/2AAD/2P/2AAD/7f/2/+T/9AAA/7D/6P/cADgAAAAAAAD/7v/o/+wAAP/oAAAAAP+wAAAAAAAAAAAALAAA/+wADwA4AAAAAP/2AAD/6AA/AAAAAP/o/+wADv+cAAD/7AAAAAAADwAhAAAAAP/0AAAAAAA8ACgAAAAAAAAADwAAAAwAHAAAAAAAAAAAAAAAAAAAAAAAAAAcABQALAAsACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAA//YAAAAAAAAAAP/2AAAAAP/kAAAAAAAAAAAAAAAAAAAAAP/6AAAAAAAAAAT/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAIf/4//sAAAAA//D/5v/u/98AAP/wAAD/5P/uAAD/5wAA//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAP/nAAD/+P/mAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAA/+b/3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABP/uAAAAAAAAAAAAAP/2AAAAAP/2AAAAAP/7AAAAAP/0AAAAAAAA/+wAAAAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+wAAAAAAAAAAAAAAAAAAAAAAAAAAABQABAAPABQAAP/m//D/5v/uAAQAAAAA/9z/5gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+gAAAAAAAQAAP/wAAAAAAAA//D/5P/oABkAAAAA/+oAIQAAAAAAAP/2AAAAAP/i/+L/9AAAAAAAAAAA/+QAAAAAAAAAAAAA//EAAP/0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//UAAP/7/+QAAP/m//gAAP/4//j/5gAA//YAAAAA//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4P/cAAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAAAAAAA/+b/2AAAAAAAAAAAAAAAAP/s/8UAAAAA//kAAAAAAAD/8f/c//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/2/+oAAP/sAAD/3AAAAAD/8AAA/+wAAAAAAAD/9AAAAAAAAAAAAAAAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/q/+cAAAAAAAAAAAAAAAAAAP/4AAD/7P/sAAAAAAAAAAAAAP/0AAQAAQBiBGoEbARtBHEEfASHBIgEigSPBJMEmQSaBJsEnASgBKEEqwStBK4EuAS6BLsEvwTDBMUEyQTKBNIE0wTVBNYE2AThBOYE5wToBOkE6gTuBO8E9QT4BPsE/AT9BP8FAAUEBQUFCgUNBQ4FDwUVBRYFGAUbBR4FHwUgBS8FMAUxBTIFMwc4BzoHOwc/B0MHSgdSB1MHVQdWB1gHXQdhB2YHZwdoB2kHagduB28HdQd5B3sHfAd9B38HgAeEB4UHigeNB44HjwACAEEEagRqAAIEbARsAAgEbQRtABAEcQRxABAEfAR8AAUEhwSIAAgEigSKAAIEjwSPAA0EkwSTABAEmQSZAAsEmgScAAIEoAShABAEqwSrABAErQSuAAgEugS6AAYEuwS7AA4EvwS/AA4EwwTDABEExQTFABEEyQTJABEEygTKAAME0gTTABEE1QTWAAYE4QThAA4E5gTmABEE5wTnAAkE7gTvAA4E9QT1AAME+AT4AA4E+wT8AAYE/QT9ABEE/wUAABEFBAUFABAFCgUKABAFDQUPABAFFQUWAA4FGAUYABEFGwUbAA4FHgUgAA4FLwUwAA4FMQUxABEFMgUzAA4HOAc4AAEHOgc6AAcHOwc7AA8HPwc/AA8HQwdDABIHSgdKAAQHUgdTABIHVQdWAAcHWAdYAAEHXQddAAwHYQdhAA8HZgdmABIHZwdnAAoHaAdqAAEHbgdvAA8HdQd1AAQHeQd5AA8Hewd8AAcHfQd9ABIHfweAABIHhAeFAA8HigeKAA8HjQePAA8AAgD+BEUERQA+BGcEZwAlBGsEawApBG0EbQBRBG4EbgA4BHIEcgAtBHUEdQAxBHgEeAAxBHkEeQA9BHoEegBQBHsEewAsBHwEfAAvBH4EfgBDBIEEgQA9BIQEhAA4BIYEhgA3BIkEiQA9BIsEiwAxBIwEjAArBI8EjwAwBJAEkAAtBJIEkgA9BJUElQBQBJcElwA2BJgEmAAxBJkEmQA8BJ0EnQBRBJ4EngA4BKAEoAA9BKQEpAAxBKUEpQBSBKcEpwAvBKgEqABDBKsEqwBRBKwErAAlBLEEsgAxBLMEtABQBLUEtQABBLYEtgAmBLcEuAAyBLkEuQACBLoEugAIBLsEuwAMBLwEvAALBL0EvwAyBMAEwAAFBMEEwgAyBMMEwwAIBMQExAAyBMUExQAuBMYExgAIBMcExwA0BMgEyAAJBMkEyQAIBMoEygAGBMsEywAyBMwEzAAnBM0EzgAyBM8EzwA0BNAE0QAyBNIE0gAEBNME0wAyBNQE1AAKBNUE1gAIBNcE1wAqBNgE2AAyBNkE2QAIBNoE2gADBNsE3ABOBN0E3QBPBN4E3gAFBN8E3wAyBOAE4AAqBOEE4gAyBOME4wAJBOQE5AAyBOUE5QA1BOYE5gAIBOcE5wAHBOgE6AAyBOkE6QARBOoE6gAyBOsE6wAMBOwE7AALBO0E7QAyBO4E7gA0BO8E8QAyBPIE8gAIBPME9AAHBPUE9QAGBPYE9gAnBPgE+AAMBPoE+wABBPwE/AAIBP0E/QATBP4E/gAyBP8FAAAIBQEFAgAJBQMFAwA6BQQFBABRBQYFBgAlBQcFBwAsBQkFCQAlBQsFCwBRBQ0FDQA9BQ8FDwBRBRAFEQAIBRIFEwABBRUFFQAMBRYFFgAyBRgFGAAIBRsFGwAyBRwFHAAMBR0FHQAyBR4FHgA0BR8FHwAyBSAFIAAMBSQFJAAIBSUFJQBGBSgFKQAyBS8FLwAMBTIFMgAMBWsFbAANBW0FbgA5BW8FbwANBXAFcAA/BXIFcgAjBXQFdQBEBXYFdgAQBXcFdwAkBXgFeAAQBXkFeQAkBXoFewANBXwFfAAQBYMFgwAPBYQFhAAiBYUFhQAPBYYFhgAiBYcFiQAOBYwFjQAOBY4FjgA7BaMFowAgBaUFpQAgBacFpwAgBaoFqgBFBawFrABABbIFsgA/BbMFswAjBbQFtAA/BbUFtgAjBbkFuQAgBbsFuwAgBb0FvQAgBb8FvwAgBcYFxgASBdoF2gBHBeMF4wBIBe0F7QBJBfQGDQBHBhEGEQBHBlwGXgBIBpEGkQBHBq0GtQBJBu0G7QBJBvQG9ABHBvwG/ABHBzUHNQAUBzYHOAAzBzkHOQAVBzoHOgAzBzsHOwBLBzwHPAAfBz0HPwAzB0AHQAAYB0EHQgAzB0MHQwAcB0QHRQAzB0YHRgAcB0cHRwBBB0gHSABKB0kHSQAXB0oHSgAZB0sHSwAzB0wHTAAoB00HTgAzB08HTwBBB1AHUQAzB1IHUgAfB1MHUwAzB1QHVAAeB1UHVgAzB1cHVwBBB1gHWAAzB1kHWQAcB1oHWgAWB1sHXAAzB10HXQAbB14HXgAYB18HXwAzB2AHYABBB2EHYgAzB2MHYwBKB2QHZAAzB2UHZQAdB2YHZgAcB2cHZwAaB2gHaAAzB2oHagAzB2sHawBLB2wHbAAfB20HbQAzB24HbgBBB28HcQAzB3IHcgAcB3MHcwBMB3UHdQAZB3YHdgAoB3cHeAAzB3kHeQBLB3oHegAUB3wHfAAzB34HfgAzB38HgAAcB4EHggBKB4QHhABLB4UHhQAzB4YHhgAUB4cHhwAXB4gHiAAzB4kHiQAUB4oHigAzB4sHiwBLB4wHjQAzB44HjgBBB48HjwBLB5EHkQBJB5QHlABCB6MHowBNB6cHqABTB6oHqgBCB6wHrABCB60HrwAhB7EHsQBUCOQI5AAQCOUI5QAkCOYI5gAQCOcI5wAkCOgI6AAQCOkI6QAkCOoI6gAQCPoI+gA5CaQJpQANCaYJpwA/CagJqQAjAAIP0AAEAAAQ1hMmABUAYAAA//r/9v/y//r/8P/w//T/7v/mAAP/9v/k/8oABP/k/+z/3P/4/+7/7v/L//j/9v/6//b/7v/k/8r/7AAM//b/5v/s/+z/6P/0/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAD/7gAAAAAAAAAAAAAAAAAA/7gAAP/2/+wAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/6P/2/+z/0v/A/+b/7P/R/8D/sP+3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAA/+4AAP/uAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/3f+0/7QAAAAA/8b/xP/d/+j/+P/c//T/3QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI//b/9gAAAAb/9v/2AAD/8v/s//QAAP+Y/8j/1P/4//T/5P/kAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9v/2AAD/+P/s//j/3P/R/9H/vQAA/+T/5P/4//QAAAAAAAAAAP/R/+z/0//u/9MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9v/YAAD/9AAAAAAAAAAAAAAAAP/uAAAAAP/g/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/8AAAAAP/2//YAAP/sAAD/3AAAAAAAAAALAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAP/s/+r/7gAE//P/3P/0/+7/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+IAAAAA/+gAAAAAAAAAAAAAAAAAAP+YAAD/6gAAAAAAAAAAAAD/6gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAP/4//z/9v/2AAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAA/6D/8f/g/+4AAP/d/97/3f/WAAoACv/RAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8r/2P/R/9P/3v+k/8n/5//s/+oAAP+I/4b/xAAA//v//P+s/93/5f/kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+8AAD/4AAA/8T/6P/0/+gAAAAAAAAAAAAA/+gACQAAAAD/1AAA/7wAAAAA/+cAAP/sAAD/6v/A/7X/tP/s/4z/wP/I/9gAAP+9AAD/vQAAAAAAAAAA/+f/2f/W/+T/1v/l/73/xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAAAAAAAAAAAAAAAAAAAAAAAA/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAD/+P/u//gAAAAAAAD/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIACgAAAAUABT/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAABJABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/4//gAAAAA/+7/+AAA//YAAAAA//j/+AAAAAAAAAAAAAAAAAAAAAAAAAAYABj/+AAAAAAAAAAkAAAAJP/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAEAAgACQAAAAAAAAAAAAAAAAAAP/s/+z/7AAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8AAQABD/+P/2AAD/7gAAAAD/+AAA//D/+AAA//YAAAAAAAAAAP/mAAAAAAAAAAAAAAAQACgAEAAUABT/9gAAAAAAAAAkAAAAJAAAAAAAAAAAAAD/9gAU//YAEAAAAAAAAABMABQAEP/7ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAAAAP/k/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAD/9gAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAA//AAAP/4AAD/+AAAAAAAAAAAAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/3f+3/7cAAAAA/7X/xP/f/+D/+P/c/9z/3QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAP+0/8j/1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/5gAAAAD/5//o/+7/9v/E/7T/tAAA/93/5wAAAAAAAAAAAAAAAP/CAAD/5gAA/+YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8P/wAAD/7v/4AAD/+AAA/9gAAP/sAAAAAP/n/+4AAAAA/+cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/s//D/+AAA/8QAAP/4//j/5wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAD/+AAAAAAAAAAA/+4AAAAA/+4AAAAAAAAAAAAA//EAAP+cAAD/+AAAAAAAAAAAAAD/4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+7/9v/xAAD/+P/xAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAA/7T/7gAAAAAAAP/a//j/2v/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/6AAAAAAAA/9z/2P/E/9D/5v+w/7z/7v/cAAAAAP97/4gAAAAA/+wAAP/I/9r/3P/k/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAU/9L/9P/u//QABAAKAAwAAAAA/+T/7AAA/+z/3AAA/+YAAP/u/+7/7P/4/+wAAP/k/8T/2AAA/6D/2P/c/8sAAP+8AAD/vAAAAAAAAAAA/+7/5P/i//j/4v/kAAAAAAAAAAQAAAAAAAAAAP/2/+QAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAA/9EAAP/4/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAA//b/9v/k//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAD/6gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAA/+r/7gAA/+oAAAAAAAD/9gAAAAAAAAAAAAD/+AAAAAAAAAAI//YAAAAAAAAAAAAAAAAAAP/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gABAIEEawRvBHAEcgRzBHQEdQR2BHkEegR9BH4EfwSABIEEggSDBIQEhQSGBI0EjgSQBJEEkgSUBJUElgSYBKIEowSoBKkEqgSvBLAEsQSyBLMEtAS3BLkEvAS9BL4EwATBBMIExATHBMgEywTMBM0EzgTPBNAE0QTUBN4E3wTgBOIE4wTkBOUE7ATwBPEE9gT3BP4FAQUCBQMFCAUJBRAFEQUUBRoFJgUnBSgFKQUqBSsFLAUuBzYHNwc5BzwHPQc+B0AHQQdCB0QHRwdIB0sHTAdNB04HTwdQB1EHVAdbB1wHXgdfB2AHYgdjB2QHbAdwB3EHdgd3B3gHfgeBB4IHgweIB4kAAgBiBGsEawAMBG8EcAAGBHIEdAAGBHYEdgAGBHkEeQAJBHoEegASBH0EfQAMBH4EfwAGBIAEgAAMBIEEgQADBIIEggAGBIMEgwADBIYEhgAGBI0EjgAGBJAEkQADBJIEkgAPBJQElAAGBJUElQASBJYElgAGBKIEogAMBKMEowAGBKgEqAAMBKkEqQADBKoEqgAGBLAEsAAGBLMEtAASBLcEtwATBLkEuQAKBLwEvAATBL0EvgAEBMAEwgAEBMQExAAEBMcExwAHBMgEyAAQBMsEywAKBMwEzQAEBM4EzgAKBM8EzwABBNAE0AAEBNEE0QABBNQE1AAEBN4E3wABBOAE4AANBOIE4gAEBOME4wAQBOQE5AAEBOUE5QABBOwE7AATBPAE8AAKBPEE8QAEBPYE9gAKBPcE9wANBP4E/gAEBQEFAgAQBQMFAwAMBQgFCAAGBQkFCQADBRAFEQAEBRQFFAAKBRoFGgABBSYFJwAEBSgFKQANBSoFKgAKBSsFKwAEBSwFLAAKBS4FLgAEBzYHNwAUBzkHOQALBzwHPAAUBz0HPgAFB0AHQgAFB0QHRAAFB0cHRwAIB0gHSAARB0sHSwALB0wHTQAFB04HTgALB08HTwACB1AHUAAFB1EHUQACB1QHVAAFB1sHXAAFB14HXwACB2AHYAAOB2IHYgAFB2MHYwARB2QHZAAFB2wHbAAUB3AHcAALB3EHcQAFB3YHdgALB3cHdwACB3gHeAAFB34HfgAFB4EHggARB4MHgwALB4gHiAAFB4kHiQACAAIBOwACAAIAGQALAAsAHAAVABUAHQAXABcAHwAZABkAIAAaABoAIQAbABsAIgAkACQAWwA2AE8AGQBTAFMAGQCeAKAAHADTANMAGQDuAPYAHQEQARAAHwEVARwAIQEdASIAIgEuAS4AHQEwATAAIgEzATMAHwE1ATUAGQE3ATcAIAE9AT0AGQGbAaYAWwGpAakAWwJHAkcAWwJKAkoAWwKsAqwAHQK0AsIAGgLFAsUAGgMYAxgAWwRnBGcAAgRoBGoAWgRrBGsAAwRsBGwAWgRtBG0AFwRuBG4AFQRvBHEAWgRyBHIABwRzBHQAWgR1BHUAUgR2BHcAWgR4BHgAUgR5BHkADwR6BHoAOwR7BHsAUAR8BHwACQR9BH0AWgR+BH4AOQR/BIAAWgSBBIEADwSCBIMAWgSEBIQAFQSFBIUAWgSGBIYAPASHBIgAWgSJBIkADwSKBIoAWgSLBIsAUgSMBIwAOgSNBI4AWgSPBI8ADQSQBJAABwSRBJEAWgSSBJIADwSTBJQAWgSVBJUAOwSWBJYAWgSXBJcAEQSYBJgAUgSZBJkACwSaBJoAWgScBJwAWgSdBJ0AFwSeBJ4AFQSfBJ8AWgSgBKAADwShBKMAWgSkBKQAUgSlBKUAPQSnBKcACQSoBKgAOQSpBKoAWgSrBKsAFwSsBKwAAgStBK0AVQSuBK4AWgSwBLAAWgSxBLIAUgSzBLQAOwS1BLUAPwS2BLYATwS3BLgAUwS5BLkAQAS6BLoAQQS7BLsAFgS8BLwAEwS9BL8AUwTABMAABgTBBMIAUwTDBMMAQQTEBMQAUwTFBMUAUQTGBMYAQQTHBMcAKgTIBMgAKwTJBMkAQQTKBMoACATLBMsAUwTMBMwAJgTNBM4AUwTPBM8AKgTQBNEAUwTSBNIABQTTBNMAUwTUBNQAEgTVBNYAQQTXBNcAJwTYBNgAUwTZBNkAQQTaBNoAKATbBNwAWQTdBN0AVwTeBN4ABgTfBN8AUwTgBOAAJwThBOIAUwTjBOMAKwTkBOQAUwTlBOUAEATmBOYAQQTnBOcAKQToBOgAUwTpBOkARwTqBOoAUwTrBOsAFgTsBOwAEwTtBO0AUwTuBO4AKgTvBPEAUwTyBPIAQQTzBPQAKQT1BPUACAT2BPYAJgT4BPgAFgT6BPsAPwT8BPwAQQT9BP0AXAT+BP4AUwT/BQAAQQUBBQIAKwUDBQMAVgUEBQQAFwUFBQUAWgUGBQYAAgUHBQcAUAUIBQgAWgUJBQkAAgUKBQoAWgULBQsAFwUMBQwAWgUNBQ0ADwUOBQ4AWgUPBQ8AFwUQBREAQQUSBRMAPwUVBRUAFgUWBRYAUwUYBRgAQQUbBRsAUwUcBRwAFgUdBR0AUwUeBR4AKgUfBR8AUwUgBSAAFgUkBSQAQQUoBSkAUwUvBS8AFgUyBTIAFgVrBWwAQwVtBW4AQgVvBW8AQwVyBXIALAV0BXUALwV2BXYALQV3BXcALgV4BXgALQV5BXkALgV6BXsAQwV8BXwALQWDBYMARQWEBYQARgWFBYUARQWGBYYARgWHBYkARAWMBY0ARAWOBY4ANwWjBaMAWAWlBaUAWAWnBacAWAWoBagAJAWsBawAIwWzBbMALAW1BbYALAW5BbkAWAW7BbsAWAW9Bb0AWAW/Bb8AWAXGBcYAMAXHBccAJQXaBdoAGAXiBeIAXgXjBeMAGwXuBe4AHgX0Bg0AGAYRBhEAGAZNBlkAXgZcBl4AGwaRBpEAGAa2BsYAHgbIBs4AHgbpBukAHgb0BvQAGAb1BvUAHgb8BvwAGAcABwAAHgc1BzUAAQc2BzgAVAc5BzkASAc6BzoAVAc7BzsAXQc8BzwAFAc9Bz8AVAdAB0AASgdBB0IAVAdDB0MADgdEB0UAVAdGB0YADgdHB0cAMgdIB0gAMwdJB0kASQdKB0oAPgdLB0sAVAdMB0wAMQdNB04AVAdPB08AMgdQB1EAVAdSB1IAFAdTB1MAVAdUB1QANQdVB1YAVAdXB1cAMgdYB1gAVAdZB1kADgdaB1oABAdbB1wAVAddB10ADAdeB14ASgdfB18AVAdgB2AAMgdhB2IAVAdjB2MAMwdkB2QAVAdlB2UANAdmB2YADgdnB2cACgdoB2gAVAdqB2oAVAdrB2sAXQdsB2wAFAdtB20AVAduB24AMgdvB3EAVAdyB3IADgdzB3MANgd1B3UAPgd2B3YAMQd3B3gAVAd5B3kAXQd6B3oAAQd7B3sATgd8B3wAVAd+B34AVAd/B4AADgeBB4IAMweEB4QAXQeFB4UAVAeGB4YAAQeHB4cASQeIB4gAVAeJB4kAAQeKB4oAVAeLB4sAXQeMB40AVAeOB44AMgePB48AXQeTB5MATAeUB5QAXweVB5UATAejB6MAOAenB6gATQepB6kATAeqB6oAXwerB6sATAesB6wAXwetB68ASwjkCOQALQjlCOUALgjmCOYALQjnCOcALgjoCOgALQjpCOkALgjqCOoALQj6CPoAQgmkCaUAQwmoCakALAACDiAABAAADqgPeAAUAFoAAAAK//b/9P/yAAb/7gAG//b/+P/uAAr/8//3/+0ACv/U/+T/7v/i//L/9v/u//b/7P/u/+z/4v/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/0AAAAAAAAAAAAAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAA/+QAAP/I/7cAAP/0/+b/2P/4/+gACAAI/93/9P/dAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/5P/UAAj/7gAIAAAAAAAAAAAAAP/s/+wAAP/s/73/+P/I/8T/+P/u//b/5v/l/9QAAAAAAAD/5P/4/+wAAAAA/8sAAAAA//b/+P/E/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/2//b/8P/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8gAAP/0AAAAAAAAAAAAAAAAAAAAAP/cAAAAAAAAAAAAAAAAAAAAAAAAAAr/+v/4/+z/4v/K//YABgAUABT/8f/Y/94AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+s/8X/rP/kAAAAAAAAAAAAAAAA/9wAAAAAAAAAAP+3AAD/+P/2//b/7gAAAAAAFAAAAAAAAP+3AAQAHAAAAAAAAAAAAAD/+v/w/9YAFP/2/+7/2P/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/s/+7/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/w//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAP/7AAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAD/7gAA//b/+AAI//YAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/u/+z/4v/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAD/9gAAAAoAAAAAAAAAAP/kAAAAAAAAAAAAAAAAAAD/+AAAAAAACgAA/+4AAAAAAAD/+P/4//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/6//sAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAP/s/+r/5P/0AAAAAAAAAAAAAP/oAAAAAAAA//AAAAAAAAD/9gAAAAAAAP/2/9oAAP/u/+oAAP/cAAD/5v/0/+7/7P/2//YAEP/m//b/7v/k/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAP/sAAAAAAAAAAAAAP/mAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oAAAAA/93/7AAA//gAAAAAAAAAAP/6AAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/w//D/9v/YAAAAAAAAAAD/3AAAAAAAAAAAAAAAAP/2AAD/9v/u/+7/5v/kAAz/8QAAAAD/7P/s//MAAAAAAAAAAAAAAAAAAP/T/+7/8f/mAAAAAAAAAAAAAP/dAAD/8AAAAAAAAAAA//gAAP/wAAAAAP/u/+7/+gA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/s/+z/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4//YAAP/nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+b/4gAA//YAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/F/7UAAP/cAAAAAAAAAAD/8AAAAAAAAAAAAAAAAP+3AAAAAP/2//b/5P/2AAAAAAAAAAAAAP++AAAAAAAAAAAAAAAAAAAAAP/d/7wAAP/k/90AAAAAAAAAAP/nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/5//w//D/3//uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4//gAAP/xAAD/7gAA//b/+AAA//gAAP/u//YAAAAA//gAAAAAAAD/+P/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAD/+AAAAAAAAAAAAAAAAP/4AAAAAAAAAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/s//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/0//k/+T/5P/kAAoAAAAAAAD/9AAAAAAAAAAAAAAAAAAAAAAAAP/cAAAAAAAAAAAAAP/uAAAAAAAAAAD/9gAA//T/9gAAAAAAAP/2//QAAAAAAAAAAAAUAAD/9v/2/8sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8P/Y/9//9gAAAAAAAAAAAAAAAAAAAAAAAAAA/98AAAAAAAAAAAAAAAAAAAAAAAAAAP/4//YAAP/fAAAAAAAA//D/+QAAAAAAAP/wAAAAAAAA//YAAAAAAAAAAAAAAAAAAgAWAxsDHAAAAx4DHwACAyUDJQAEAzADMAAFAzQDNQAGAz0DQQAIA0MDQwANA1IDUgAOA1wDXAAPA18DYQAQA2oDfQATA8oD6QAnBB8ENgBHBGgEaQBfBG4EbgBhBJcElwBiBJ4EngBjBxUHFgBkBxgHGQBmBx8HHwBoByoHKgBpB2UHZQBqAAIAIgMbAxsABQMcAxwACAMeAx4ADgMfAx8AEQMlAyUABQMwAzAACwM0AzQABQM1AzUAEQM9Az0AAwM+Az4ABgM/Az8AEwNAA0AADANBA0EADwNDA0MAEgNSA1IACQNcA1wABgNfA18AAwNgA2AADwNhA2EAEgNqA3UABQN2A30AEQPKA9YAAwPXA94ADwPfA+kAEgQfBCoAAwQrBDYAEgSXBJcAAgcVBxUABAcWBxYABwcYBxgADQcZBxkAEAcfBx8ABAcqByoACgdlB2UAAQACAMkDGwMbAFQDHgMeAEUDIAMgAEcDIgMiAEADJQMlAFQDKQMpAEADLQMtADQDLgMuAEEDLwMvAD0DMAMwADwDMQMxAD4DOwM7AEEDPQM9AEgDPgM+AEkDPwM/ACsDQANAAEoDQQNBAEsDQgNCAFgDQwNDAEwDRANEAC4DRQNFAE0DRgNGAEwDRwNHAEYDSQNJACwDSgNKAFcDSwNLAE8DTANMAEMDTQNNAEQDTgNOAE8DTwNPAC0DUANQAFADUQNRAE8DUgNSACoDUwNTAFADVANXAE8DWQNZAFkDWgNaAEkDWwNbAEADXANdAC4DXgNeAE8DXwNfAEgDYANgAEsDYQNhAEwDYgNiAE0DYwNjAFUDZANkAE8DZQNmAFADZwNnAE8DaANoAFUDaQNpAFADdAN1AFQDowOkAEEDrwOvAFQDygPWAEgD1wPeAEsD3wPpAEwD6gPrAE0D7APsAFUD7QPtAE0D7gP5AFUD+gQBAE8EAgQDAEQEBAQTAFAEFAQeAE8EHwQqAEgEKwQ2AEwENwRCAE8EQwRDAEwERQRFAE4ETgROAE0EawRrAAUEbgRuABgEcgRyAAcEeQR5ABEEegR6ACYEfAR8AAkEfgR+AAQEgQSBABEEhASEABgEhgSGACcEiQSJABEEjASMAAYEjwSPAA4EkASQAAcEkgSSABEElQSVACYElwSXABQEmQSZAAwEngSeABgEoASgABEEpQSlACkEpwSnAAkEqASoAAQEswS0ACYEvAS8ABYExwTHABAEyATIABIEygTKAAgEzATMAAIEzwTPABAE1ATUABUE4wTjABIE5QTlABME5wTnAAoE7ATsABYE7gTuABAE8wT0AAoE9QT1AAgE9gT2AAIFAQUCABIFDQUNABEFHgUeABAFawVsADgFbQVuADcFbwVvADgFcAVwAFEFcgVyACMFdAV1ACgFdgV2ABkFdwV3ABoFeAV4ABkFeQV5ABoFegV7ADgFfAV8ABkFgwWDAFIFhAWEAFMFhQWFAFIFhgWGAFMFhwWJACEFjAWNACEFjgWOABwFqgWqAEIFrAWsABsFsgWyAFEFswWzACMFtAW0AFEFtQW2ACMFxgXGAFYHFQcVAC8HGgcaADYHHAccAD8HHwcfAC8HIwcjAD8HJwcnADMHKAcoADUHKQcpADEHKgcqADAHKwcrADIHLgcuAD8HMQcxADUHMgcyAC8HNQc1AAEHPAc8ABcHQwdDAA8HRgdGAA8HRwdHAB4HSAdIAB8HTAdMAAMHTwdPAB4HUgdSABcHVwdXAB4HWQdZAA8HWgdaAB0HXQddAA0HYAdgAB4HYwdjAB8HZQdlACAHZgdmAA8HZwdnAAsHbAdsABcHbgduAB4HcgdyAA8HcwdzACQHdgd2AAMHegd6AAEHfweAAA8HgQeCAB8HhgeGAAEHiQeJAAEHjgeOAB4HkweTADkHlAeUADoHlQeVADkHowejACUHpweoADsHqQepADkHqgeqADoHqwerADkHrAesADoHrQevACII5AjkABkI5QjlABoI5gjmABkI5wjnABoI6AjoABkI6QjpABoI6gjqABkI+gj6ADcJpAmlADgJpgmnAFEJqAmpACMAAg4UAAQAAA7YED4AGgBFAAD/xP/i/8T/6v/q/+z/8P+P/8z/zP/s//AAFAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/rAAAAAAAAAAAAAAAAP9a/48AAP/RAAAAAAAA/6n/xP/0/+L/5v/Y/7L/vf/N/+UATP/u//D/0//l/+b/zf+V/6n/4P/o/+3/4P/j/+D/1v/s/8D/2P/qACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAP/cAAAAAAAA//gAAAAAAAAAAAAA//gAAP/4//gAAP/2AAAAAAAA//gAAAAA/+z/+wAAAAAAAAAQAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE/6sAAP/n/+AAAP/c/+QAAAAA//AAAP/wAAAAAAAA/90AAP/4/9UAAP/dAAAAAP/4/+QAAAAA/93/8P/4//gAAAAE/9z/3P/wAAD/y//u/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+f/4/+f/+P/w//gAAAAUAAD/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU/+z/7AAAAAAAAAAAAAD/8P/u//j/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFP/uAAAAAP/7/+4AAAAA/8wAAP/4//D/0P/Q//D/9gAA/+YAAAAAAAAAAAAA/9wAJP/4/+YAAP/cAAD/3AAA//D/5QAA/8v/9v/4AAAAAAAA//b/yAAAAAD/5v/m/9gAAAAAAAAAAP/u//r/3QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAP/uAAAAAP+s//gAAAAA/+YAAP/4AAAAAAAA/93/9v/4/8gAAP/dAAAAAAAA//AAAAAA/9P/8P/2//gAAAAQAAD/7v/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/fAAAAAP/2AAAAAAAAAAAAAAAA//AAAP/wAAD/+QAA/98AAAAA/98AAP/fAAAAAP/2//AAAAAA//YAAAAAAAAAAAAAAAAAAP/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/qAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAP/4AAAAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAA//AAAAAAAAAAAAAAAAAAAAAA//r/7v/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAAAAAAA//AAAAAAAAAAAAAA/+wAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+AAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/IAAAAAAAA/+z//P/oAAD/8AAA//j/0wAA/90AAAAAAAAAAAAA/8sAAAAAAAAAAP/4AAAAAAAAAAAAAAAAAAD/0gAAAAAAAAAAAAD/sP/uAAAAAAAAAAAAAP/0AAD/6AAA/9r/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7P/f/+YAAAAA/+YAAP/fAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+e/9gAAP/sAAAAAAAA/+r/1gAAAAD/7v/s/7z/4gAAAAAAKP/2/9z/9gAAAAD/9P/q/+oAAAAAAAAAAP/2AAD/7gAAAAD/9AAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAP/cAAAAAAAAAAAAAAAAAAAAAAAAAAD/4P/k/+AAAAAAAAAAAP+aAAD//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAD/+AAA/+AAAP/2AAAAAAAA/+QAAAAAAAAAAAAAAAAAAAAAAAD/1gAAAAAAAAAAAAQAAP98/+gAAAAAAAAAAAAA/+v/zgAA/+7/5P/k/77/9AAAAAAAAAAA/8gAAAAAAAAAAP/d/+sAAAAAAAAAAAAAAAD/zQAA/+wAAAAAAAD/8v/2AAAAAAAIAAAAAAAAAAAAAAAA/9j/5v/YAAAAKv/OAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAA/+D//P/cAAAAAAAA/+b/+AAAAAAAAAAA/+0AAAAA/+cAAP/tAAAAAAAAAAAAAAAA/+YAAAAAAAAAAAAAAAAAAP/2AAD/xf/I//kAAAAAAAAAAAAAAAD/8QAAAAAAAAAAAAAAAAAA/9wAAAAAAAAAAAAAAAAAAP/u//gAAAAA/+wAAP/cAAAAAP/wAAAAAP/sAAAAAAAAAAD/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/qAAD/5wAA/+0AAP/2AAAAAAAA/+wAAAAAAAD/9AAE/+wAAAAAAAD/+gAAAAAAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAD/9gAA/+7/5gAA/+QAAAAAAAAAAAAA/90AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAAAAD/5P/s/+gAAAAAAAAAAAAA//gAAAAA/+AAAAAAAAAAAP/0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAwAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAP/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//AAAP/2AAD/+AAA//AAAAAA/9wAAP/wAAAAAP/s//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/x//QAAAAAAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/6P/8AAAAAAAAAAAAAAAAAAAAAAAA//wAAAAAAAAAAAAAAAD/+QAAAAAAAAAAAAAAAAAAAAAAAAAA/+gAAAAAAAD/7P/s//YAAAAA/9wAAP/0AAD/9gAA/+QAFP/4AAAAAP/kAAD/wgAA//T/1gAA/8z/2P/2//L/7AAAAAD/xP/kAAD/4P/kAAAAAAAAAAAAAP/iAAD//AAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAP/yAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+gAAAAAAAAAAP/qAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAA/+oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAIAMdAx0AAAMiAyIAAQMkAyQAAgMpAykAAwMrAywABAMvAy8ABgMxAzMABwM5AzkACgM8AzwACwNFA0kADANLA0sAEQNNA04AEgNRA1EAFANUA1cAFQNZA1sAGQNeA14AHANiA2QAHQNnA2gAIAOUA5wAIgOlA8kAKwPqBAMAUAQUBB4AagQ3BEMAdQROBE4AggcXBxcAgwcbBx4AhAcgByEAiAcjByYAigcpBykAjgcrBy4AjwcwBzAAkwcyBzQAlAACADsDHQMdAAEDIgMiABIDJAMkAAUDKQMpABIDKwMrAA8DLAMsABcDLwMvAAsDMQMxAA0DMgMyAAkDMwMzAAsDOQM5ABIDPAM8AAkDRQNFAAIDRgNGAAMDRwNHAAYDSANIAAIDSQNJAAcDSwNLABADTQNNABADTgNOABUDUQNRABADVANUABADVQNVABQDVgNWABADVwNXABgDWQNZABMDWgNaABADWwNbABIDXgNeABADYgNjAAIDZANkABADZwNnABADaANoAAIDlAObABIDnAOcAA8DpQOuAAkDrwPJAAID6gP5AAID+gQDABAEFAQeABAENwRCABAEQwRDAAMETgROAAIHGwcbABkHHAccABEHHQcdABkHHgceAAQHIAchABkHIwcjABEHJAckABkHJQclAA4HJgcmABYHKQcpAAoHKwcrAAwHLAcsAAgHLQctAAoHLgcuABEHMAcwABkHMgc0ABkAAgCdAxsDGwAQAx4DHgAVAyADIAAoAyIDIgAiAyUDJQAQAygDKAA6AykDKQAiAywDLAA5Ay0DLQAuAy4DLgAvAy8DLwAfAzADMAATAzEDMQA1AzIDMgAeAzQDNAA9AzsDOwAvAz0DPQAPAz4DPgARAz8DPwAYA0ADQAAUA0EDQQAWA0IDQgAnA0MDQwAXA0QDRAAlA0UDRQAaA0YDRgAXA0cDRwAbA0gDSAAcA0kDSQAdA0oDSgBEA0sDSwAhA0wDTAAsA00DTQAgA04DTgAhA08DTwAkA1ADUAAmA1EDUQAhA1IDUgASA1MDUwAmA1QDVwAhA1gDWAAcA1kDWQA7A1oDWgARA1sDWwAiA1wDXQAlA14DXgAhA18DXwAPA2ADYAAWA2EDYQAXA2IDYgAaA2MDYwAZA2QDZAAhA2UDZgAmA2cDZwAhA2gDaAAZA2kDaQAmA2oDcwA9A3QDdQAQA6MDpAAvA68DrwAQA7ADtwA9A8EDwQAeA8oD1gAPA9cD3gAWA98D6QAXA+oD6wAaA+wD7AAZA+0D7QAaA+4D+QAZA/oEAQAhBAIEAwAgBAQEEwAmBBQEHgAhBB8EKgAPBCsENgAXBDcEQgAhBEMEQwAXBE4ETgAaBWsFbAAIBW0FbgApBW8FbwAIBXIFcgAMBXQFdQA3BXYFdgANBXcFdwAOBXgFeAANBXkFeQAOBXoFewAIBXwFfAANBYMFgwAqBYQFhAALBYUFhQAqBYYFhgALBYcFiQAJBYwFjQAJBY4FjgArBaMFowAHBaUFpQAHBacFpwAHBagFqAA+BaoFqgA/BawFrAAwBbMFswAMBbUFtgAMBbkFuQAHBbsFuwAHBb0FvQAHBb8FvwAHBcYFxgAtBxUHFQABBxYHFwAjBxgHGAADBxkHGQAjBxoHGgA2BxsHGwAjBxwHHAAFBx0HHgAjBx8HHwABByAHIQAjByIHIgA4ByMHIwAFByQHJQAjByYHJgA8BycHJwAyBygHKAAGBykHKQAxByoHKgACBysHKwBDBywHLAAEBy0HLQAjBy4HLgAFBy8HMAAjBzEHMQAGBzIHMgABBzMHMwAjBzQHNAAEB5MHkwAzB5QHlAA0B5UHlQAzB6MHowBCB6cHqABAB6kHqQAzB6oHqgA0B6sHqwAzB6wHrAA0B60HrwAKB7EHsQBBCOQI5AANCOUI5QAOCOYI5gANCOcI5wAOCOgI6AANCOkI6QAOCOoI6gANCPoI+gApCaQJpQAICagJqQAMAAIKUAAEAAALFAvSABAAUgAAAAYABAAEAAgAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+7/9P/8/+z/7v/x/+7/7P/s/+7//P/4AAT/8//c//T/7v/c/+z//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/s/+oAAP/2//EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+g//H/4P/uAAAAAAAA/+L/4v/q/9YACgAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+r/xAAJ/+j/5f+0/+f/2v/u/+r/of+0AAD/9AAA/+D/7v/s/4z/wP/I/9gAAP+8/7z/ygAAAAAAAAAAAAAAB//Y//T/7P/g/77/tP/W/+oAOP/W/+7/2f/k//b/5f/l/+L/1P/tAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9AAA/90AAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/4AAD/7v/2AAAAAAAA//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAD/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7P/2//b/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7IAAP/u/+4AAAAAAAD/9v/2//b/5AAWABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//D/5v/2//YABAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/cAAoAEv/c/8n/2v/Y/9//7v+//8kAAP/N/+7/7gAA/9z/kP+0/7f/yv/w/8j/0f/cAAAAAAAAAAAAAAAV/+7/7AAA/+r/3f/J/9j/3ABM/9j/7v/u/+4AAP/u/9j/+P/q/9IAAAAAAAAAAAAAAAD/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAR//AAGP/xAAz/7gAAAAAAAAAAAAAAAAAHAAAAAP/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//AAAP/xAAAADAAAAAAAAAAAAAD/8AAAAAAAAAAAAAAAAAAAAAAAAP/7AAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAP/4AAD/7AAA//YAAP/sAAD/6gAAAAAAAP/cAAAAAAAA/9oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAUAAAAAP/kAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2gAR/+YAGP/TAAz/2gAA/74AAP/cAAAAAAAF/+wAAP/4AAD/ywAAAAAAAAAAAAAAAAAAAAAAAAAMAAD/7AAA//AAAP/TADwADAAAAAAAAAAAAAD/5P/uAAAAAAAAAAAAAAAAAAAAAP/7AAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAD//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/o//YAAP/oAAAABgAAAAD/4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv/0AAAADQAA//P/5P/4AAD/9AAA//P/6P/uAAD/4P/uAAAAAP/o/+gAAAAA/8QAAAAQAAAAAAAAAAAAAAAAAAAAAAAA/+AAAP/0AAD/9AA1AAAAAP/S/+z/9AAA//L/9P/0/+oAAAAAAAAAAAAAAAAAAAAA//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/mAAAAAP/E/+7/5P/m//j/5P/o/9T//P/g//D/3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAP/0AAAAAAAAAAAAAP/x/94AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/0f/c/8gAAAAA/8QAAP/KAAAAAAAAAAAAAAAAAAAAAAAAAAoAEP/4/+L/9v/2//r/9gAGAAIAIAAcABwAAAFEAV0AAQFhAWEAGwJIAkgAHAMgAyEAHQMjAyMAHwMmAygAIAMqAyoAIwMtAy4AJAM2AzgAJgM6AzsAKQNCA0IAKwNEA0QALANKA0oALQNPA1AALgNTA1MAMANdA10AMQNlA2YAMgNpA2kANAN+A5MANQOdA6QASwQEBBMAUwXaBdoAYwX0Bg0AZAYRBhEAfgaRBpEAfwb0BvQAgAb8BvwAgQcaBxoAggciByIAgwcnBygAhAcxBzEAhgACAB8AHAAcAA4BRAFdAA4BYQFhAA4CSAJIAA4DIAMgAA0DKAMoAAoDLQMtAAMDLgMuAAcDOgM7AAcDQgNCAAsDRANEAAQDSgNKAAgDTwNPAAEDUANQAAUDUwNTAAUDXQNdAAQDZQNmAAUDaQNpAAUDnQOkAAcEBAQTAAUF2gXaAA8F9AYNAA8GEQYRAA8GkQaRAA8G9Ab0AA8G/Ab8AA8HGgcaAAwHIgciAAkHJwcnAAIHKAcoAAYHMQcxAAYAAgDGABUAFQA/ABcAFwBAABgAGABBABoAGgBCAC8ALwA+AO4A9gA/ARABEABAAREBFABBARUBHABCAS4BLgA/ATMBMwBAAf4CBgA+Ao4CkgA+Ap8CnwBFAqACoABGAqsCqwA+AqwCrAA/AxsDGwAhAx4DHgAlAyADIAAyAyIDIgAtAyUDJQAhAykDKQAtAywDLAAuAy0DLQAPAy4DLgARAy8DLwAsAzADMAAjAzEDMQA8AzIDMgArAzQDNAAgAzsDOwARAz0DPQAGAz4DPgAiAz8DPwAoA0ADQAAkA0EDQQAmA0IDQgAxA0MDQwAnA0QDRAAQA0UDRQAIA0YDRgAnA0cDRwAJA0gDSAAqA0kDSQAKA0sDSwAMA0wDTAAzA00DTQALA04DTgAMA08DTwAOA1ADUAAwA1EDUQAMA1IDUgAHA1MDUwAwA1QDVwAMA1gDWAAqA1kDWQANA1oDWgAiA1sDWwAtA1wDXQAQA14DXgAMA18DXwAGA2ADYAAmA2EDYQAnA2IDYgAIA2MDYwApA2QDZAAMA2UDZgAwA2cDZwAMA2gDaAApA2kDaQAwA2oDcwAgA3QDdQAhA6MDpAARA68DrwAhA7ADtwAgA8EDwQArA8oD1gAGA9cD3gAmA98D6QAnA+oD6wAIA+wD7AApA+0D7QAIA+4D+QApA/oEAQAMBAIEAwALBAQEEwAwBBQEHgAMBB8EKgAGBCsENgAnBDcEQgAMBEMEQwAnBE4ETgAIBWsFbAATBW0FbgASBW8FbwATBXIFcgAXBXcFdwA6BXkFeQA6BXoFewATBX4FfgBDBYAFgABDBYMFgwAVBYQFhAAWBYUFhQAVBYYFhgAWBYcFiQAUBYwFjQAUBY4FjgAYBaMFowA7BaUFpQA7BacFpwA7BagFqAAZBawFrABEBbMFswAXBbUFtgAXBbkFuQA7BbsFuwA7Bb0FvQA7Bb8FvwA7BdoF2gBJBeMF4wBKBe0F7QBMBe4F7gBNBe8F7wBOBfEF8QBPBfIF8gBQBfMF8wBRBfQGDQBJBhEGEQBJBlwGXgBKBmgGaABLBmsGbABLBpEGkQBJBq0GtQBMBrYGxgBNBsgGzgBNBs8GzwBOBtQG2wBQBtwG4QBRBuYG5wBRBukG6QBNBu0G7QBMBu8G7wBRBvIG8gBOBvQG9ABJBvUG9QBNBvYG9gBPBvwG/ABJBwAHAABNBxUHFQAaBxYHFwAvBxgHGAAbBxkHGQAvBxoHGgAFBxsHGwAvBxwHHAACBx0HHgAvBx8HHwAaByAHIQAvByIHIgA3ByMHIwACByQHJQAvByYHJgA2BycHJwADBygHKAAEBykHKQA0ByoHKgABBysHKwA1BywHLAAcBy0HLQAvBy4HLgACBy8HMAAvBzEHMQAEBzIHMgAaBzMHMwAvBzQHNAAcB5EHkQBMB5MHkwAeB5QHlAA4B5UHlQAeB6MHowA5B6cHqAAfB6kHqQAeB6oHqgA4B6sHqwAeB6wHrAA4B60HrwAdCCYIJwA9CDcINwA9COUI5QA6COcI5wA6COkI6QA6CPQI9ABICPgI+ABHCPoI+gASCaQJpQATCagJqQAXAAIKTgAEAAALlg04ABMARQAAAA7/9v/wABT/9v/EAA4AFP/u/7cAEv/1//AADP/u//gACP/4ABT/+v/wAAT/7gAc/9z/rP/c/73/t/+s/9j/5P+i/7j/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/kAAAAAAAA/+8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+AAAAAAAAAAA//gAAAAA//YAAP/4AAAAAAAA/+4AAAAAAAAAAAAAAAAAAP/7/+4ACP/2/+7/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAP/2/+QADAAA/+4ACv/z//YADP/2AAD/+P/uAAD/7gAAAAD/7gAA/+wAAP/iAAD/7AAA/+wAAAAAAAAAAAAAAAAAAAAK//f/7f/u//j/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAP/2/+wAAAAAAAAAAP/uAAAAAP/7AAAAAAAAAAD/5AAAAAAAAAAAAAAAAAAAAAD/7gAGAAD/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2/+T/3v/u//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAD/9wAAAAD/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/c//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/3P/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2wAAAAAAAP/c//QAAP/u/+4AAP/4//YAAAAAAAT/+P/uAAD/8AAAAAAAAAAAAAAAAAAAAAD/uP/8AA4AAAAA/+wAAAAAAAAAAAAJAAD/9v/k//j/9v/sAAD/3P/uAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/98AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACEAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAEwATAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//X/+wAAAAAAAP/wAAAAAP/2/+QAAAAA//oAAP/m//oAAP/wAAAAAP/6AAD/3AAA//AAAP/w//YAAP/o/97/+P/x/+b/zwAAAAAAAAAAAAAAAAAAAAD/7P/s//YAAP/2AAAACv/x//AAAAAAAAAAAAAA//n/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAP/2//gAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/kAAAAAAAA//YAAAAAAAAAAP/TAAAAAP/2AAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAAAAAAAAAK//YAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAh//gAAAAAACoAAAAAAAQAAAA+AAAAAP/4AAAAGAAAAAAALQAAABYAGAAkABgAKAAAACD/7AAyAEgAPAAAAAAAAP/AAAAAAAAAAAAAAAAAACoAAP/1//b/7gAA/88AAAAAAAAAIQAj/+4AAAAA//YABP/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAD/+wAAAAD/+gAAAAAAAAAA//sAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+yAAQAAP/u/6YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAA/9oAAAAAAAD/9gAA/+X/5P/2AAAAAAAA/94AAP/6/+YAAP/cAAD/5P/mAAD/8v/uAAAAAAAAAAAAAAAAAAD/7gAGAAsAAAAAAAAAAP+kAAAAAP/Y/5z/ev/l//r/4v/k/+4AAP/sAAD/7QAAAAAAAAAA/8wAAAAAAAAAAP/QAAAAAP/Z//D/7AAAAAD/+AAAAAAAAAAAAAAAAP/tAAAAAAAA/+YAAAAA/+4AAAAAAAAAAP/mAAAAAAAA/+b/uQAA/6j/tAAA/9wAAP/LAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAAAAP/0AAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/PAAAAAAAA/+QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACADYAAgAEAAAABgAHAAMAHgAhAAUANgBdAAkAZQB4ADEAegB7AEUA0gDTAEcA1gDWAEkA7QDtAEoBJgEoAEsBNQE1AE4BPQE+AE8BQgFCAFEBXgFgAFIBZgFsAFUBbgFwAFwBcgGFAF8BhwGHAHMBkQGRAHQB4QHhAHUB/AH8AHYCMwIzAHcCOgI6AHgCSQJJAHkCTQJOAHoCUQJRAHwCUwJTAH0CVgJWAH4CXwJgAH8CYgJiAIECZQJlAIICgAKAAIMChAKEAIQCiAKIAIUCiwKMAIYCkAKRAIgCrwKvAIoDAAMAAIsDCgMLAIwDDQMQAI4DFgMXAJIF2wXcAJQF3gXfAJYGDgYQAJgGEgYbAJsGIwY2AKUGOAY5ALkGkAaQALsGlAaUALwGrAasAL0G5QbnAL4G/Qb9AMEHAQcBAMIISAhIAMMAAgBFAAMAAwADAAQABAAGAAYABgAMAAcABwAPAB4AHgAEAB8AHwAHACAAIAAKACEAIQANAFAAUgAMAFQAVwADAFgAXQAGAGUAeAAMAHoAegAGAHsAewAPANIA0gAMANYA1gADAO0A7QASASYBKAADAT4BPgAMAUIBQgAGAV4BYAAKAWYBawAEAWwBbAAHAW4BcAAHAXIBhQAKAYcBhwANAZEBkQAIAeEB4QAKAfwB/AAQAjMCMwAJAjoCOgAJAkkCSQAKAk0CTQAEAk4CTgAKAlECUQABAlMCUwAEAlYCVgAIAl8CXwAEAmACYAABAmICYgABAmUCZQAEAoACgAAEAoQChAAHAogCiAABAosCjAAIApACkAAIApECkQAEAq8CrwANAwADAAAKAwoDCwAHAw0DEAAHAxYDFwAHBdsF2wACBdwF3AAFBd4F3gALBd8F3wAOBg4GEAALBhIGFQACBhYGGwAFBiMGNgALBjgGOAAFBjkGOQAOBpAGkAALBpQGlAACBqwGrAARBuUG5wARBv0G/QALBwEHAQAFCEgISAANAAIBBgACAAIAQgAEAAQABQAIAAgABQALAAsALAAQABAABQASABIABQAUABQALQAVABUACgAWABYADAAXABcADwAYABgALgAZABkAFAAaABoAFwAbABsALwAcABwAAQAeACAAMQAhACEAAgAiACIAMAAkACQANgAlACUAPQAoACkARAAqACoAMQArACsARAAsACwAMQAtAC0ARAAuAC4ABwAvAC8ACQAwADAANQAxADEADQAyADIAEAAzADMAEgA0ADQAFQA1ADUAOgA2AE8AQgBTAFMAQgBYAF0ABQB8AIUABQCeAKAALACqAKoAAwCtAK4AAwC9ANIABQDTANMAQgDVANUABQDXANwABQDlAOwALQDuAPYACgD3AQcADAEJAQ8ADAEQARAADwERARQALgEVARwAFwEdASIALwEqASoADAEuAS4ACgEwATAALwEzATMADwE1ATUAQgE2ATYADAE3ATcAFAE9AT0AQgFAAUAABQFBAUEADAFEAWEAAQFmAYUAMQGHAYcAAgGIAY4AMAGPAY8AMQGQAZAAMAGRAZEAMQGbAaYANgGoAagARAGpAakANgGqAa0APQGxAbEARAG+AcgARAHKAcsARAHMAeEAMQHkAeQAMQHmAesAMQHsAfMARAH0AfsABwH9Af0AAgH+AgYACQIHAh8ANQIgAiAADQIhAiQAEAIlAiwAFQItAjIAOgI1AjUARAI3AjgAOgI7AjsARAI/Aj8ARAJAAkAAOgJBAkEARAJHAkcANgJIAkgAAQJJAkkAMQJKAkoANgJLAksAMQJMAkwANQJOAk4ANQJPAk8AMQJQAlEARAJTAlMAMQJUAlQAFQJVAloAMQJjAmMAPQJkAmUAMQJmAmYAFQJnAmcAMQJoAmgANQJrAmsARAJuAm4ARAJwAnAAEgJzAnMARAJ2AncANQJ4AngARAJ6AnoAPQJ7AnsARAJ9An0ARAJ/AoIAMQKGAoYARAKIAokARAKKAooABwKLAowAPQKOApIACQKVApcANQKYApgADQKbApsADQKcAp0AOgKfAp8AOwKrAqsACQKsAqwACgKvArMAAgK0AsIAQwLFAsUAQwLGAuIAMQLjAv8AAQMAAwAANQMBAwkAMQMXAxcAAgMYAxgANgVrBWwAJwVtBW4AJgVvBW8AJwVwBXAAPgVyBXIAGQV0BXUAHQV2BXYAGgV3BXcAHAV4BXgAGgV5BXkAHAV6BXsAJwV8BXwAGgV+BX4AGwWABYAAGwWDBYMAMwWEBYQAPAWFBYUAMwWGBYYAPAWHBYkAMgWMBY0AMgWOBY4AIAWjBaMAOQWlBaUAOQWnBacAOQWoBagAPwWqBaoAHwWsBawAHgWyBbIAPgWzBbMAGQW0BbQAPgW1BbYAGQW5BbkAOQW7BbsAOQW9Bb0AOQW/Bb8AOQXGBcYAIQXHBccAIgXaBdoAKgXcBdwABAXgBeAABAXjBeMAKwXoBegABAXqBeoABAXsBewACAXtBe0AJQXuBe4ACwXvBe8ADgXwBfAAEQXxBfEAEwXyBfIAFgXzBfMAGAX0Bg0AKgYRBhEAKgYWBhsABAY6BkMABAZcBl4AKwZ7BpAABAaRBpEAKgaTBpMABAaVBpoABAajBqsACAatBrUAJQa2BsYACwbIBs4ACwbPBs8ADgbQBtMAEQbUBtsAFgbcBuEAGAbmBucAGAbpBukACwbtBu0AJQbvBu8AGAbyBvIADgb0BvQAKgb1BvUACwb2BvYAEwb8BvwAKgb/Bv8ABAcABwAACweRB5EAJQeTB5MAQAeUB5QAKAeVB5UAQAejB6MAKQenB6gAQQepB6kAQAeqB6oAKAerB6sAQAesB6wAKAetB68AJAgSCBIANwgXCBcAOAgYCBkANwgaCBoAOAgbCB4ANwggCCAAOAgiCCIANwglCCUANwgmCCcABggpCCkAOAgzCDMANwg1CDUANwg3CDcABgg7CDsANwhICEgAAgjkCOQAGgjlCOUAHAjmCOYAGgjnCOcAHAjoCOgAGgjpCOkAHAjqCOoAGgjrCOwAEgj0CPQAIwj4CPgANAj6CPoAJgmcCZ0AAgmkCaUAJwmmCacAPgmoCakAGQACCrgABAAAC6wNlgAWAD4AAP/tAC7/7v/w/9z/+P/4AAT/7v/uAAT/0v/oAAQAHAAQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//f/+v/4/+7/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+7/7AAAAAAAAAAAAAAAAAAA/+r/9AAAAAAAAAAAAAT/+wAAAAAAEv/4ABQACgAM/+4AC//4/+z/9QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAYACAAAAAAAAAAAAAQABAAFAAAABAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAA/+b/5v/nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/2/+7/5gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/98AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAFAAUAAAAAAAwAAAAAAAQABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2P/cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAQABAAAAAQAAAAAAAAAAAAAAAAAAAAA/+D/5P/Y//oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9v/2/+T/2P/LAAAAAAAA/+7/8AAA/+D/7P/xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sAAAAAP/2AAD/3QAAAAQAAAAA/+z/7P/w/+7/8AAE/6v/3P/n/9z/3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/u//j/+P/wAAD/+QAA//D/9v/3AAAAAAAAAAAAAAAAAAAAAAAAAAAACAAUAAAAAAAAAAAAAAAAAAAAFAAA/+wAAAAA/+z/5P/4AAAAAAAAAAAAAAAAAAAAAAAA//b/8P/s/+b/3v/m/97/5v/uAAD/8P/Y/+QAAAAAAAAAAP/u/+4AAAAAABT/9v/7//r/+v/u//r/9gAA//v/+gAAAAD/5f/LABYAAAAAAAAAAAAAAAD/9f/mAAD/zP/2//j/0P/IAAAAAP/s/+7/0P/dAAAAAAAAAAD/7QAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAAAAD/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+wAAD/xP+g/8sADAAA/+b/2/+9AAD/2QAAAAAAAAAAAAAAAAAAAAAAAAAFAAD/7wAAAAAAAAAAAAAAAAAAAAAAAP+PAAD/2AAAAAAAAAAAAAAAAAAA//cAAAAAAAD/8gAA/4j/y//a/8v/qgAAAAD/zP9U/5AAAAAAAAD/0AAA/8YAAAAAAAz/+gAAAAD/3P+x/+7/xf+y/4AAAP/u//j/3P/lAAAAAAAAAAAAAAAAAAD/9gAAAAD/1P/oAAD/lP+QAAAAAP/k/9v/lP90/7AAAAAAAAIAKAAIAA8AAAAiACIACAAkACcACQB5AHkADQB8ALoADgEIAQgATQEuAS4ATgE7ATwATwE/AT8AUQFtAW0AUgGIAY4AUwGQAZAAWgGbAaYAWwGpAasAZwGtAbwAagJGAkcAegJKAkoAfAJPAk8AfQJuAm4AfgKwArEAfwK0AsIAgQLEAsUAkALSAtIAkgLiAv8AkwMMAwwAsQMRAxQAsgMYAxgAtgXgBeEAtwXjBecAuQY3BjcAvgY6BkAAvwZCBksAxgZbBl0A0AZfBmIA0wZkBngA1wbtBu0A7Ab6BvoA7QcDBxAA7gcSBxQA/AmcCZ0A/wACAFEACAAIAAIACQAJAAUACgAKAAkACwALAAwADAAMAA8ADQANABUADgAPAAUAJAAkAAgAJQAlAAoAJgAmAA0AJwAnABMAeQB5AAUAfACCAAIAgwCDAAMAhACFAAIAhgCNAAUAjgCOAAMAjwCbAAkAnACcAAMAnQCdAAkAngCfAAwAoACgAAMAoQCjAA8ApACkABUApQClABEApgCvABUAsAC6AAUBCAEIAAMBLgEuAAkBOwE7ABUBPAE8AAkBPwE/AAkBbQFtABABmwGmAAgBqQGrAAoBrQGtAAoBrgGxAA0BsgGyABMBswGzABABtAG3ABMBuAG8ABICRgJGABMCRwJHAAoCSgJKAAgCTwJPABMCbgJuABMCsAKwAAgCsQKxABMCtALCAAcCxALEAAUCxQLFAAcC0gLSAAgC4gLiAAgC4wL/ABMDDAMMABADEQMUABIDGAMYAAgF4AXgAAEF4QXhAAQF4wXjAAsF5AXkAA4F5QXlABQF5gXnAAQGNwY3AAQGOgZAAAEGQgZDAAEGRAZLAAQGWwZbAAQGXAZdAAsGXwZhAA4GYgZiABQGZAZtABQGbgZ4AAQG7QbtAAQG+gb6ABQHAwcQAAYHEgcSAAYHEwcTAAQHFAcUAAYJnAmcAAgJnQmdABMAAgDjAAIAAgAYAAQABAAkAAgACAAkAAsACwAoABAAEAAkABIAEgAkABQAFAA3ABUAFQAFABYAFgA4ABcAFwAcABgAGAAeABoAGgAJABwAHAABAB4AIAADACEAIQAiACIAIgAjACUAJQACACoAKgADACwALAADAC8ALwAlADAAMAAtADEAMQAGADIAMgAHADMAMwAuADQANAAIADUANQAKADYATwAYAFMAUwAYAFgAXQAkAHwAhQAkAJ4AoAAoAL0A0gAkANMA0wAYANUA1QAkANcA3AAkAOUA7AA3AO4A9gAFAPcBBwA4AQkBDwA4ARABEAAcAREBFAAeARUBHAAJASoBKgA4AS4BLgAFATMBMwAcATUBNQAYATYBNgA4AT0BPQAYAUABQAAkAUEBQQA4AUQBYQABAWYBhQADAYcBhwAiAYgBjgAjAY8BjwADAZABkAAjAZEBkQADAaoBrQACAcwB4QADAeQB5AADAeYB6wADAf0B/QAiAf4CBgAlAgcCHwAtAiACIAAGAiECJAAHAiUCLAAIAi0CMgAKAjcCOAAKAkACQAAKAkgCSAABAkkCSQADAksCSwADAkwCTAAtAk4CTgAtAk8CTwADAlMCUwADAlQCVAAIAlUCWgADAmMCYwACAmQCZQADAmYCZgAIAmcCZwADAmgCaAAtAnACcAAuAnYCdwAtAnoCegACAn8CggADAosCjAACAo4CkgAlApUClwAtApgCmAAGApsCmwAGApwCnQAKAqsCqwAlAqwCrAAFAq8CswAiAsYC4gADAuMC/wABAwADAAAtAwEDCQADAxcDFwAiBWsFbAAnBW0FbgAvBW8FbwAnBXIFcgAMBXQFdQA6BXYFdgA5BXcFdwAzBXgFeAA5BXkFeQAzBXoFewAnBXwFfAA5BX4FfgAfBYAFgAAfBYMFgwAxBYQFhAAyBYUFhQAxBYYFhgAyBYcFiQAwBYwFjQAwBY4FjgA0BaMFowALBaUFpQALBacFpwALBagFqAAPBaoFqgA7BawFrAANBbMFswAMBbUFtgAMBbkFuQALBbsFuwALBb0FvQALBb8FvwALBcYFxgAOBccFxwAgBdoF2gAXBdwF3AAZBeAF4AAZBeMF4wAmBegF6AAZBeoF6gAZBewF7AApBe0F7QASBe4F7gAaBe8F7wAbBfAF8AAdBfEF8QATBfIF8gAUBfMF8wAhBfQGDQAXBhEGEQAXBhYGGwAZBjoGQwAZBlwGXgAmBnsGkAAZBpEGkQAXBpMGkwAZBpUGmgAZBqMGqwApBq0GtQASBrYGxgAaBsgGzgAaBs8GzwAbBtAG0wAdBtQG2wAUBtwG4QAhBuYG5wAhBukG6QAaBu0G7QASBu8G7wAhBvIG8gAbBvQG9AAXBvUG9QAaBvYG9gATBvcG9wA9BvwG/AAXBv8G/wAZBwAHAAAaB5EHkQASB5MHkwA2B5QHlAAVB5UHlQA2B6MHowAWB6kHqQA2B6oHqgAVB6sHqwA2B6wHrAAVB60HrwA1CBEIEQArCBIIEgAqCBMIFQArCBcIFwAsCBgIGQAqCBoIGgAsCBsIHgAqCB8IHwArCCAIIAAsCCEIIQArCCIIIgAqCCUIJQAqCCYIJwAECCkIKQAsCCsILwArCDMIMwAqCDQINAArCDUINQAqCDcINwAECDkIOgArCDsIOwAqCDwIPAArCEgISAAiCOQI5AA5COUI5QAzCOYI5gA5COcI5wAzCOgI6AA5COkI6QAzCOoI6gA5COsI7AAuCPQI9AARCPgI+AAQCPoI+gAvCRkJGQA8CZwJnQAiCaQJpQAnCagJqQAMAAIKmgAEAAAMBg4yABMARwAA/8v/5P/2/+b/8P/s/+z/6P/8/+j/7P/w/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAA//j/+AAUABgAIAAUACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAJAAkACQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAP/4AAAAAAAAAAAAAAAAAAAAAAAAAAD//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/U/8X/7P/I/+D/3P/c//n/6P/8AAD/z//L/+b/8wAA//z/8f/c//D/9gAAAAAAAAAAAAD/9v/1//v/7AAE//v/5v/4//j/+P/4//j/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2AAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/9wAAP/n//QABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8AAAAAD/7v/q/+r/9v/3/+7/7P/t//D/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+z/5P/2/+wAAAAAAAD/6AAAAAD/3AAAAAD/7v/wAAAAAAAAAAAAAAAAAAAAAAAAAAD/9AAAAAAAAAAAAAAAAAAAAAAAAAAA/+YAAAAAAAD/5AAAAAMABAAAAAT/+AAAAAD/+v/2/+7/ygAE//oADP/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/mgAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/5f/7AAAAAD/5AAA/+AAAAAA/+AAAAAAAAAAAP/2AAAAAP/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/yAAD/9gAAAAAAAAAAAAAAAAAAAAAAAP/u/+wAAAAAAAAAAAAQ/3wAAAAAAAAAAP/OAAD/3gAAAAAAAP/2AAAAAAAAAAD/5AAAAAAAAP+IAAgAEgAAAAAABAAAAAAAAP/W/9b/7P9yAAAAAAAA/80AAP/H//D/6//2/+j/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP/3AAAAAAAAAAD/vgAHAAD/+AAAABgAAAAEACD/qAAAAAAAAAAA/+gAAP/kAAAAAAAo//gAAP/cAAcABQAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAA/7cAAAAAAAD/9gAAAAD/9v/2AAD/5P/sAAD/kwAHAAX/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/w//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/z//QAAAAAAAD/7//2AAD/3QAIAAAAAAAAAAD/9gAAAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7v/z//EAAAAAAAD/9gAAAAAAAAAAAAD/8P/wAAAAAAAAAAAABwAAAAAAAAAAAAAAAAAA//gAAAAAAAAAAAAAAAAAAAAA//gAAAAAAAAABgAAAAQABAAAAAwACv/uAAAAEP/4AAD/9AAAAAD/+v/2AAAAAP/4//b/8v/i/+IAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/ywAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgA8AAUABQAAABAAEwABAB0AHQAFACMAIwAGACgAKwAHAC0ALQALAF4AZAAMALsAuwATAL0A0QAUANQA1QApANcA5AArASMBIwA5ASUBJQA6ASkBKwA7AS8BLwA+ATEBMQA/ATgBOABAAUABQABBAWIBZQBCAYYBhgBGAZIBmgBHAb4B4ABQAeMB5ABzAeYB8wB1AjQCNQCDAjkCOQCFAkECQQCGAksCSwCHAlACUACIAlICUgCJAlUCVQCKAl0CXQCLAmkCagCMAnECcQCOAngCeACPAnoCewCQAn8CfwCSAoECggCTAoUChwCVApcCmACYAq4CrgCaBd0F3QCbBegF6wCcBhwGIgCgBnkGeQCnBnsGjwCoBpIGkwC9BpUGogC/BuIG4gDNBugG6gDOBu4G7gDRBvAG8ADSBvcG9wDTBv8G/wDUCBEIFgDVCBgIGgDbCBwIJQDeCCoILwDoCDMINQDuCDkIPADxAAIAXAAFAAUABgAQABAABgARABEACAASABIABgATABMADAAdAB0ABAAqACsABAAtAC0ACgBeAGQABgC7ALsABgC9ANEABgDUANUABgDXANwAAwDdAN0ACADeAOQADAEjASMABgElASUACAEpASoABgErASsACAEvAS8ADAExATEACAE4ATgACAFAAUAABgFiAWUABAGGAYYABAHMAeAABAHjAeQABAHmAesAAQHsAewABAHtAfMACgI0AjUABAI5AjkABAJBAkEACgJLAksABAJQAlAABAJSAlIABAJVAlUACQJdAl0ABAJxAnEACQJ7AnsACQJ/An8ABAKBAoIABAKFAoUACQKGAocACgKXApcABAKYApgACgKuAq4ABAXdBd0ABQXoBegABQXpBekABwXqBeoABQXrBesACwYcBiIABQZ5BnkABQZ7Bo8ABQaSBpMABQaVBpoAAgabBpsABwacBqIACwbiBuIABQboBukABQbqBuoABwbuBu4ACwbwBvAABwb3BvcABwb/Bv8ABQgRCBEAEAgSCBIAEQgTCBMADQgUCBQADggVCBUAEQgWCBYAEggYCBgAEAgZCBkADggaCBoADwgcCBwADggdCB4AEAgfCCAAEQghCCEADwgiCCIAEggjCCQADQglCCUADggqCCoADQgrCC4AEQgvCC8ADQgzCDMADgg0CDQAEQg1CDUAEAg5CDkADgg6CDoADwg7CDsADgg8CDwAEQACANcAAgACADMACwALADUAFAAUAD4AFQAVAAIAFwAXAAMAGQAZACUAGgAaAAQAGwAbADkAHAAcABwAHgAgAD0AIQAhAB0AIgAiADwAKgAqAD0ALAAsAD0ALgAuACAALwAvACEAMQAxACMAMgAyACQAMwAzAA4ANAA0ACYANQA1AA8ANgBPADMAUABSADsAUwBTADMAngCgADUA0wDTADMA5QDsAD4A7gD2AAIBEAEQAAMBFQEcAAQBHQEiADkBLgEuAAIBMAEwADkBMwEzAAMBNQE1ADMBNwE3ACUBPQE9ADMBRAFhABwBZgGFAD0BhwGHAB0BiAGOADwBjwGPAD0BkAGQADwBkQGRAD0BzAHhAD0B4gHiACIB5AHkAD0B5gHrAD0B9AH7ACAB/QH9AB0B/gIGACECIAIgACMCIQIkACQCJQIsACYCLQIyAA8CNwI4AA8CQAJAAA8CQwJDAEQCSAJIABwCSQJJAD0CSwJLAD0CTwJPAD0CUwJTAD0CVAJUACYCVQJaAD0CZAJlAD0CZgJmACYCZwJnAD0CbwJvAEICcAJwAA4CdAJ1ACICfwKCAD0CgwKFAEYCigKKACACjgKSACECmAKYACMCmQKaACICmwKbACMCnAKdAA8CnwKfAAkCoAKgAAoCqwKrACECrAKsAAICrwKzAB0CtALCADQCxQLFADQCxgLiAD0C4wL/ABwDAQMJAD0DFwMXAB0DGgMaAEIFFAUUACcFFwUXABsFGgUaABsFawVsABUFbQVuAEMFbwVvABUFcgVyAAUFdAV1ABIFdgV2ABEFdwV3AAcFeAV4ABEFeQV5AAcFegV7ABUFfAV8ABEFfgV+AAYFgAWAAAYFgwWDAEAFhAWEADAFhQWFAEAFhgWGADAFhwWJAD8FjAWNAD8FjgWOAEUFowWjABAFpQWlABAFpwWnABAFqAWoABoFqgWqABMFrAWsAAgFswWzAAUFtQW2AAUFuQW5ABAFuwW7ABAFvQW9ABAFvwW/ABAFxgXGABQFxwXHAAsF2gXaADIF3AXcADYF4AXgADYF4wXjACkF6AXoADYF6gXqADYF7AXsADcF7QXtACoF7gXuADgF7wXvACsF8AXwACwF8QXxAC0F8gXyAC4F8wXzAC8F9AYNADIGEQYRADIGFgYbADYGOgZDADYGXAZeACkGewaQADYGkQaRADIGkwaTADYGlQaaADYGowarADcGrQa1ACoGtgbGADgGyAbOADgGzwbPACsG0AbTACwG1AbbAC4G3AbhAC8G5gbnAC8G6QbpADgG7QbtACoG7wbvAC8G8gbyACsG9Ab0ADIG9Qb1ADgG9gb2AC0G/Ab8ADIG/wb/ADYHAAcAADgHAwcQACgHEgcSACgHFAcUACgHkQeRACoHkweTABYHlAeUABcHlQeVABYHowejADEHpweoABgHqQepABYHqgeqABcHqwerABYHrAesABcHrQevADoHsQexABkIEggSAB4IFwgXAB8IGAgZAB4IGggaAB8IGwgeAB4IIAggAB8IIggiAB4IJQglAB4IJggnAAEIKQgpAB8IMwgzAB4INQg1AB4INwg3AAEIOwg7AB4ISAhIAB0I5AjkABEI5QjlAAcI5gjmABEI5wjnAAcI6AjoABEI6QjpAAcI6gjqABEI6wjsAA4I9Aj0AA0I+Aj4AAwI+gj6AEMJPQk9AEEJnAmdAB0JpAmlABUJqAmpAAUAAglwAAQAAApeC6AAEABLAAD/2P/E/8T//P/U/+D/7P/d/+j/2P/s/8QAGAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+z/2P/s/+QADv/2/+wACv/n/+z/8P/k/9//3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2//b/7P/6AAT/+//4//j/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAP/k/+wAAAAA/+4AEgAAAAD/5//0AAAAAP/2AAD/+gAAAAAAAAAA//YAAP/u/+4ABQAMAA4ABP/7//L/+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/ZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/a/9j/4f/kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAP/uAAAAAAAAAAD/9gAA//MAAAAAAAD/8P/s/+4AAAAA//j/3P/cAAAAAAAA//D/8AAAAAAAAAAA//QAAAAA/+wAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAD//AAA//D/9v/2//QABP/u/9cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/iAAAAAAAA/+oAAAAAAAAAAAAA/6AAAAAAAAAAAAAAAAAAAAAAAAD/8QAAAAAAAAAAAAAAAP+Y/+gAAP/W/+AAAAAKAAAAAAAAAAAAAAAAAAD/7P/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAD/0f/xAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/wP/K/9j/1v+0/8QAAAAAAAD/xP/W/4wAAAAAAAAAAP/0AAAAAAAA/+7/wAAAABAAAAAAAAAAAP+I/9MACQAA/8gAAAAA/7wAAP+G/+f/5f/q/+r/6v/o/8AAFAAAAAD/vAAY//T/wAAA/+f/7P/YAAAAAP/lAAD/vf/l/+T/6P/o/+z/6P/UAAAAAAAAAAAAAAAAAAD/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAAAAAAAAAAAAAAAYAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAADkAAAAAACMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAKAAAACgAAABkAGgAyADAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2//gAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAD/7AAAAAAAAAAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAACz/5AA4AAD/7gAA//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7AAA/+wAAP/u/+IAAAAAAAAAAP/y/9//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAA/+QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/g//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/4//QAAAAAAAoAAAAAAAD/+AAA/+YAAAAAAAAAAAAAAAAAAP/4/+4AAAAAAAAAAAAAAAAAAP/oAAAACgAAAAAAAAAAAAAAAP/I//YAAAAAAAQAAAAFAAAAAAAAAAD/8AAAAAD/9gAA//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAD/7gAA//YAAP/4AAAAAAAAAAAAAAAAAAAAAAAA/9AAAP/2/+QAAP/4/+f/8AAAAAD/rP+sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/iAAAAAAAAAAAAAAAA/+T/ywAAAAD/7P+7//AAAAAA//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAP/4AAD/9gAAAAAAAAAAAAIAJwAUABYAAAAsACwAAwAuADAABADlAOwABwDuAQcADwEJAQ8AKQEkASQAMAE2ATYAMQFBAUEAMgGoAagAMwHiAeIANAH0AfsANQH+Ah8APQJMAkwAXwJkAmQAYAJoAmgAYQJrAmwAYgJwAnAAZAJ0AncAZQJ9An0AaQKDAoMAagKKAooAawKOAo8AbAKSApIAbgKZApoAbwKtAq0AcQKyArMAcgLGAtEAdALTAuEAgAMBAwkAjwXsBe4AmAajBqsAmwatBsYApAbIBs4Avgb1BvUAxQcABwAAxggbCBsAxwgmCCkAyAg3CDcAzAACADUAFAAUAAQAFQAVAAgAFgAWAA4ALAAsAAwALgAuAAIALwAvAAYAMAAwAAwA5QDsAAQA7gD2AAgA9wEHAA4BCQEJAA4BCgEPAAsBJAEkAAUBNgE2AA4BQQFBAA4BqAGoAAwB4gHiAA8B9AH7AAIB/gIGAAYCBwIZAAwCGgIfAAkCTAJMAAwCZAJkAAwCaAJoAAwCawJrAAwCbAJsAAYCcAJwAAwCdAJ1AA8CdgJ3AAwCfQJ9AAwCgwKDAAwCigKKAAICjgKOAAYCjwKPAAICkgKSAAICmQKaAA8CrQKtAAUCsgKzAAYCxgLRAAwC0wLhAAwDAQMJAAwF7AXsAAMF7QXtAAcF7gXuAA0GowarAAMGrQa1AAcGtgbGAA0GyAbIAA0GyQbOAAoG9Qb1AA0HAAcAAA0IGwgbAAEIKAgoAAEAAgEbAAIAAgADAAQABAA/AAgACAA/AAsACwAmABAAEAA/ABIAEgA/ABQAFAAnABUAFQASABcAFwAUABkAGQBCABoAGgAVABsAGwBEABwAHAABAB4AIAAFACEAIQAzACIAIgA0ACQAJABFACUAJQBGACgAKQAEACoAKgAFACsAKwAEACwALAAFAC0ALQAEAC4ALgAKAC8ALwARADAAMAALADEAMQBAADIAMgBBADMAMwA2ADQANABDADUANQAtADYATwADAFAAUgA9AFMAUwADAFgAXQA/AHwAhQA/AJ4AoAAmAL0A0gA/ANMA0wADANUA1QA/ANcA3AA/AOUA7AAnAO4A9gASARABEAAUARUBHAAVAR0BIgBEASkBKQAJAS4BLgASATABMABEATMBMwAUATUBNQADATcBNwBCAT0BPQADAUABQAA/AUQBYQABAWIBYgA1AWYBhQAFAYYBhgAHAYcBhwAzAYgBjgA0AY8BjwAFAZABkAA0AZEBkQAFAZoBmgA1AZsBpgBFAagBqAAEAakBqQBFAaoBrQBGAbEBsQAEAb4ByAAEAcoBywAEAcwB4QAFAeIB4gATAeQB5AAFAeYB6wAFAewB8wAEAfQB+wAKAf0B/QAzAf4CBgARAgcCHwALAiACIABAAiECJABBAiUCLABDAi0CMgAtAjUCNQAEAjcCOAAtAjkCOQAHAjsCOwAEAj8CPwAEAkACQAAtAkECQQAEAkcCRwBFAkgCSAABAkkCSQAFAkoCSgBFAksCSwAFAkwCTAALAk4CTgALAk8CTwAFAlACUQAEAlMCUwAFAlQCVABDAlUCWgAFAl0CXgAHAmMCYwBGAmQCZQAFAmYCZgBDAmcCZwAFAmgCaAALAmsCawAEAm4CbgAEAnACcAA2AnMCcwAEAnQCdQATAnYCdwALAngCeAAEAnoCegBGAnsCewAEAn0CfQAEAn8CggAFAoYChgAEAogCiQAEAooCigAKAosCjABGAo4CkgARApUClwALApgCmABAApkCmgATApsCmwBAApwCnQAtAp8CnwANAqACoAAOAqsCqwARAqwCrAASAq4CrgA1Aq8CswAzArQCwgAvAsUCxQAvAsYC4gAFAuMC/wABAwADAAALAwEDCQAFAxcDFwAzAxgDGABFBWsFbAAMBW0FbgA3BW8FbwAMBXIFcgAXBXQFdQBJBXYFdgBIBXcFdwAZBXgFeABIBXkFeQAZBXoFewAMBXwFfABIBX4FfgAYBYAFgAAYBYMFgwAhBYQFhAA4BYUFhQAhBYYFhgA4BYcFiQAWBYwFjQAWBY4FjgAkBaMFowBHBaUFpQBHBacFpwBHBagFqAAxBaoFqgAwBawFrAAaBbMFswAXBbUFtgAXBbkFuQBHBbsFuwBHBb0FvQBHBb8FvwBHBcYFxgAuBccFxwAyBdoF2gACBdsF2wA+BdwF3AAGBd0F3wA+BeAF4AAGBeEF4QA+BeMF4wAdBeQF5wA+BegF6AAGBekF6QA+BeoF6gAGBesF6wA+BewF7AAeBe0F7QAfBe4F7gAoBe8F7wApBfAF8AAqBfEF8QArBfIF8gAsBfMF8wA7BfQGDQACBg4GEAA6BhEGEQACBhQGFQA+BhYGGwAGBhwGIAA+BiMGNgA+BjkGOQA+BjoGQwAGBkQGSwA+BlsGWwA+BlwGXgAdBl8GZwA+Bm0GegA+BnsGkAAGBpEGkQACBpMGkwAGBpUGmgAGBpsGogA+BqMGqwAeBq0GtQAfBrYGxgAoBsgGzgAoBs8GzwApBtAG0wAqBtQG2wAsBtwG4QA7BuMG5AA+BuYG5wA7BugG6AAIBukG6QAoBuoG6gA+Bu0G7QAfBu4G7gA+Bu8G7wA7BvAG8AA+BvIG8gApBvMG8wA+BvQG9AACBvUG9QAoBvYG9gArBvoG+wA+BvwG/AACBv0G/gA+Bv8G/wAGBwAHAAAoBxMHEwA+B5EHkQAfB5MHkwA8B5QHlAAiB5UHlQA8B6MHowAlB6cHqAAjB6kHqQA8B6oHqgAiB6sHqwA8B6wHrAAiB60HrwAgB7EHsQBKCBIIEgAPCBgIGQAPCBsIHgAPCCIIIgAPCCUIJQAPCCYIJwAQCDMIMwAPCDUINQAPCDcINwAQCDsIOwAPCEgISAAzCOQI5ABICOUI5QAZCOYI5gBICOcI5wAZCOgI6ABICOkI6QAZCOoI6gBICOsI7AA2CPQI9AAcCPgI+AAbCPoI+gA3CRkJGQA5CZwJnQAzCaQJpQAMCagJqQAXAAIJcAAEAAAKEAsuABAASwAA/+z/8//2/9j/+AAo/+z/9v/u/+T/9v/E//AAFP/2//wAG//s//v/zwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/EAAAAAAAAAAAAAAAAAAAAAP/2/8r/9v/2//T/9gAYAAUAFgAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/93/7gAA/8D/7QAAAAAACgAA/+v/7P+0/+wAJAAAAAAAM//lADoAAP/4/8oAAAAAAAAAAAAAAAAAAAAA/+z/7P/2/+7/9gAU/+IABv/2//j/9gAM//YACv/t//YAFP/s/+UABP/9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/+P/2/+L/+AAA/+T/9v/k/+YAAP+tAAAABP/2AAAACwAA//z/zwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/eAAAAAAAAAAAAAAAAAAAAAAAA/9P/9wAA//wAAAAWAAQAEgAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAA/9EAAAAAAAAAAAAA//YAAP/a//YAJAAAAAAAGf/4ACYAAAAA/9YACAAAAAgAAAAAAAAAAAAA//wAAAAAAAAAAAAUAAAACgAAAAAAAAAMAAAADAAAAAAAFv/2/+YABAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAD/5gAA/+j/7f/aAAAAAP/w/+4ABP/r//wACwAA//sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/2AAD/+AAAAAAAAAAAAAAAAAAAAAAAAAAA//EAAP/k/+wAAP/s//YAAAAQ/+T/5v/k/+7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/6AAD/7v/2AAD/5gAA//oAAAAAAAAAAAAAAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/sAAD/+P/sAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/+gAA//H/8AAA/+wAAAAA/+4AAAAA/9wAAP/2AAD/9AAAABQAAAAMABT/8QAAAAAAAAAAAAAAAAAAAAAAAP/mAAD/7v/s//b/+v/2AAD/5v/6/+4AAP/2/+b/8//u/+7/8P/YAAD/8QAAAAAAAP/mAAAAAP/m//D/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+wAAP/2/9j/+AAA/+z/+P/w/+QAAP/EAAAAFAAA//wAG//8AAT/zwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAAAAAP/4//gAAAAA//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+yAAAAAAAAAAAAAAAAAAAAAP/2/6z/7P/u/+z/5AAWAAQAEgAYAAAAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAD/9v/u/+4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/7T/7gAA/5z/yQAA/+4AAAAA/8j/6v+Q/7QAJAAAAAAAGP/RACoAAP/c/5z/3P/L/9wAAAAAAAAAAAAA/8T/2P/u/8n/7QAK/9r/7P/2/+f/7v/7/+T/+v/a/+4AEv+3/8r/+//IAAAAAAAAAAAAAP/NAAAAAAAAAAAAAP/u/9z/8AAAAAAAAAAAAAAAAAAAAAAAAAAA//IAAAAAAAD/9gAA/+oAAP/xAAAAAAAA/+YAEAAA//wABwAAAAT/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAD/+AAAAAAAAAAA//gAAAAAAAAAAP/2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG//v/7P/q//z/4gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/o//YAAP/oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAA/+j/8wAAAAAAAP/uAAD/9AAA/+gAEAAAAAAAFAAAABQAAAAQAAD/9AAAAAAAAAAAAAAAAAAA//UAAP/sAAD/4gAA//IAAP/2//j/9P/2//QAAP/k//QADf/oAAAAAP/EAAAABgAAAAAAAP/uAAAAAP/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQ/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFP/wAFD/7AAE/+wABAACABoAFwAbAAAAMQA1AAUBEAEiAAoBMgEzAB0BNwE3AB8CIAIyACACOwI7ADMCQAJAADQCQgJCADUCVAJUADYCVwJXADcCWgJaADgCZgJmADkCmwKcADoFogWiADwFpAWkAD0FpgWmAD4FuAW4AD8FugW6AEAFvAW8AEEFvgW+AEIF7wXzAEMGzwbhAEgG8QbyAFsG9gb2AF0I6wjsAF4AAgAvABcAFwACABgAGAAFABkAGQAIABoAGgALABsAGwAOADIAMgADADMAMwAGADQANAAJADUANQAMARABEAACAREBFAAFARUBHAALAR0BIgAOATIBMgAOATMBMwACATcBNwAIAiECJAADAiUCLAAJAi0CMgAMAjsCOwAMAkACQAAMAkICQgAMAlQCVAAJAlcCVwAMAloCWgAMAmYCZgAJApwCnAAMBaIFogAPBaQFpAAPBaYFpgAPBbgFuAAPBboFugAPBbwFvAAPBb4FvgAPBe8F7wABBfAF8AAEBfEF8QAHBfIF8gAKBfMF8wANBs8GzwABBtAG0wAEBtQG2wAKBtwG4QANBvEG8QANBvIG8gABBvYG9gAHCOsI7AAGAAIBGAACAAIAAgAEAAQAIQAIAAgAIQALAAsABAAQABAAIQASABIAIQAUABQAIwAVABUABwAWABYAJwAXABcACAAZABkANAAaABoACQAbABsACwAcABwAAQAeACAABQAhACEAPAAiACIAHwAlACUAAwAoACkAIAAqACoABQArACsAIAAsACwABQAtAC0AIAAuAC4AIgAvAC8AOQAwADAAJQAxADEAKQAyADIAKwAzADMALQA0ADQALgA1ADUACgA2AE8AAgBTAFMAAgBYAF0AIQB8AIUAIQCeAKAABAC9ANIAIQDTANMAAgDVANUAIQDXANwAIQDlAOwAIwDuAPYABwD3AQcAJwEJAQ8AJwEQARAACAEVARwACQEdASIACwEqASoAJwEuAS4ABwEwATAACwEzATMACAE1ATUAAgE2ATYAJwE3ATcANAE9AT0AAgFAAUAAIQFBAUEAJwFEAWEAAQFmAYUABQGHAYcAPAGIAY4AHwGPAY8ABQGQAZAAHwGRAZEABQGoAagAIAGqAa0AAwGxAbEAIAG+AcgAIAHKAcsAIAHMAeEABQHiAeIAKAHkAeQABQHmAesABQHsAfMAIAH0AfsAIgH9Af0APAH+AgYAOQIHAh8AJQIgAiAAKQIhAiQAKwIlAiwALgItAjIACgI1AjUAIAI3AjgACgI7AjsAIAI/Aj8AIAJAAkAACgJBAkEAIAJIAkgAAQJJAkkABQJLAksABQJMAkwAJQJOAk4AJQJPAk8ABQJQAlEAIAJTAlMABQJUAlQALgJVAloABQJfAl8ANwJiAmIANwJjAmMAAwJkAmUABQJmAmYALgJnAmcABQJoAmgAJQJrAmsAIAJuAm4AIAJwAnAALQJzAnMAIAJ0AnUAKAJ2AncAJQJ4AngAIAJ6AnoAAwJ7AnsAIAJ9An0AIAJ/AoIABQKGAoYAIAKIAokAIAKKAooAIgKLAowAAwKOApIAOQKVApcAJQKYApgAKQKZApoAKAKbApsAKQKcAp0ACgKfAp8AEAKrAqsAOQKsAqwABwKvArMAPALGAuIABQLjAv8AAQMAAwAAJQMBAwkABQMXAxcAPARFBEUANgRrBGsARARtBG0ASgR6BHoASASPBI8ARwSVBJUASASdBJ0ASgSrBKsASgSzBLQASAS5BLkAQgTdBN0ARgTlBOUASQUEBQQASgULBQsASgUPBQ8ASgVrBWwADAVtBW4AQAVvBW8ADAVwBXAAOgVyBXIAQQV0BXUAPgV2BXYAPQV3BXcAMgV4BXgAPQV5BXkAMgV6BXsADAV8BXwAPQV+BX4ADgWABYAADgWDBYMAMAWEBYQAMQWFBYUAMAWGBYYAMQWHBYkADQWMBY0ADQWOBY4AMwWoBagAEgWsBawADwWyBbIAOgWzBbMAQQW0BbQAOgW1BbYAQQXGBcYAEQXHBccAEwXaBdoAFQXbBdsAPwXcBdwAFwXdBd8APwXgBeAAFwXhBeEAPwXjBeMAFgXkBecAPwXoBegAFwXpBekAPwXqBeoAFwXrBesAPwXsBewAGAXtBe0AJAXuBe4AJgXvBe8AKgXwBfAALAXxBfEANQXyBfIALwXzBfMAGQX0Bg0AFQYRBhEAFQYUBhUAPwYWBhsAFwYcBiAAPwYjBjYAPwY5BjkAPwY6BkMAFwZEBksAPwZbBlsAPwZcBl4AFgZfBmcAPwZtBnoAPwZ7BpAAFwaRBpEAFQaTBpMAFwaVBpoAFwabBqIAPwajBqsAGAatBrUAJAa2BsYAJgbIBs4AJgbPBs8AKgbQBtMALAbUBtsALwbcBuEAGQbjBuQAPwbmBucAGQbpBukAJgbqBuoAPwbtBu0AJAbuBu4APwbvBu8AGQbwBvAAPwbyBvIAKgbzBvMAPwb0BvQAFQb1BvUAJgb2BvYANQb6BvsAPwb8BvwAFQb9Bv4APwb/Bv8AFwcABwAAJgcTBxMAPwc5BzkAQwdJB0kARQeHB4cARQeRB5EAJAeTB5MAGweUB5QAHAeVB5UAGwejB6MAHgenB6gAHQepB6kAGweqB6oAHAerB6sAGwesB6wAHAetB68AGggXCBcABggaCBoABgggCCAABggmCCcAOAgpCCkABgg3CDcAOAhICEgAPAjkCOQAPQjlCOUAMgjmCOYAPQjnCOcAMgjoCOgAPQjpCOkAMgjqCOoAPQjrCOwALQj0CPQAOwj4CPgAFAj6CPoAQAmcCZ0APAmkCaUADAmmCacAOgmoCakAQQACCKQABAAACOoJbAAJAHoAAAAYACgAKP/2ABgAIQAE/9z/9gAE/9z/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAoACj/9gAYACgAJP+Q//YAJP+Q/1gAFP/L/8j/t//0/8j/xP/M/7T/9v/q/8H/yf+c/+z/7P/A/9z/1P/2ABT/yP+e//b/6v/B/8n/nP+6ABT/9v/q/8H/yf+c/+z/5f/E/8z/tP/d/97/2v/s/7r/g/+I/2//gP/2/+7/4v/i/9z/0v/S//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//b/9v/xAAD/9v/xAAD/tAAAAAD/tAAAAAAAAP/2/+wADAAA//AAAP/sAAAAAP/q//H/yAAA/9z/2P/u/9QAAAAAAAD/2AAAAAD/6v/x/8gAAAAAAAAAAP/q//H/yAAAAAD/8AAA/+wAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+b/5P/u/9z/7P/u//b/5P/d/+z/5P/u/9z/7v/c//D/+P/c/9z/7P/s/+b/8P/u/9z/7P/P/9gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9gAAAAwAAAAA//YAAAAAAAAAAP/YAAAAAAAAAAD/7gAAAAAAAAAAAAAAAAAAAAD/2AAA/+QAAAAAAAAAAP/YAAAAAAAAAAD/9gAAAAAAAAAAAAD/5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAD/7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+T/5v/X/+b/4v/X/+T/5v/i/+b/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//YAAAAAAAD/yv/2AAD/ygAAAAAAAAAA/+4AAAAA//gAAP/mAAAAAP/u/+7/2P/4/9z/3AAA/9QAAAAAAAD/7AAAAAD/7v/u/9j/7gAAAAAAAP/u/+7/2AAAAAD/+AAA/+YAAAAA/+b/+P/uAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+P/s/+4AAAAA/+z/7AAAAAD/7AAA//D/7P/uAAD/+P/oAAAAAAAAAAAAAP/s/+4AAAAAAAD/8AAAAAAAAP/uAAD/8AAA/+4AAAAA//b/7v/2//D/8P/u//D/7v/K/+7/7gAAAAAAAAAAAAD//AAAAAD//AAA/7cAAAAA/7cAAAAAAAAAAP/YAAAAAP/wAAD/7AAAAAD/6P/g/8j/8P/LAAAAAP/EAAAAAAAAAAAAAAAA/+j/4P/I/+4AAAAAAAD/6P/g/8gAAAAA//AAAP/sAAAAAP/2//D/7gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/i/+b/5P/u/+IAAP/u/9z/7v/s/+4AAP/m/+T/7gAAAAAAAAAA//T/4v/iAAD/5P/u//QAAAAA/+j/7P/g/+z/7P/g/+j/7P/sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/90AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/6AAAAAAABAAAAAAABAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/U//wAAAAA/+z/6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/8//wAAgALBWsFcAAABXIFcgAGBXoFewAHBX0FfQAJBX8FfwAKBYMFiQALBYwFjQASBbIFtgAUB60HrwAZCPoI+gAcCaQJqQAdAAIAFQVrBWwAAQVvBW8AAQVwBXAABAVyBXIABwV6BXsAAQV9BX0ACAV/BX8ACAWDBYMABQWEBYQABgWFBYUABQWGBYYABgWHBYkAAgWMBY0AAgWyBbIABAWzBbQABwW1BbUABAW2BbYABwetB68AAwmkCaUAAQmmCacABAmoCakABwACAUYAAgACAHkACwALAFoAFAAUAFsAFQAVAC8AFgAWADEAFwAXADQAGAAYADcAGQAZAF4AGgAaAAsAGwAbAF8AHAAcAHgAHgAgACsAJQAlAAoAKgAqACsALAAsACsALwAvAC0AMQAxADIAMgAyADUAMwAzAF0ANAA0ADgANgBPAHkAUwBTAHkAngCgAFoA0wDTAHkA5QDsAFsA7gD2AC8A9wEHADEBCQEPADEBEAEQADQBEQEUADcBFQEcAAsBHQEiAF8BKgEqADEBLgEuAC8BMAEwAF8BMwEzADQBNQE1AHkBNgE2ADEBNwE3AF4BPQE9AHkBQQFBADEBRAFhAHgBYgFiAAkBZgGFACsBjwGPACsBkQGRACsBmgGaAAkBqgGtAAoBzAHhACsB4gHiAFwB5AHkACsB5gHrACsB/gIGAC0CIAIgADICIQIkADUCJQIsADgCSAJIAHgCSQJJACsCSwJLACsCTwJPACsCUwJTACsCVAJUADgCVQJaACsCYwJjAAoCZAJlACsCZgJmADgCZwJnACsCcAJwAF0CdAJ1AFwCegJ6AAoCfwKCACsCiwKMAAoCjgKSAC0CmAKYADICmQKaAFwCmwKbADICnwKfAGACoAKgAGECqwKrAC0CrAKsAC8CrgKuAAkCxgLiACsC4wL/AHgDAQMJACsDHgMeAFUDIAMgAFkDKAMoAFgDLAMsAFcDLQMtACgDLgMuAAgDLwMvACIDMAMwAFQDMQMxACMDMgMyAFYDNQM3AHMDOQM5AHEDOwM7AAgDPAM8AHADPQM9ACADPwM/AG0DRwNHAG4DSQNJAG8DSwNLACQDTANMAHcDTgNOACQDTwNPACYDUQNRACQDUgNSAFMDVANXACQDXgNeACQDXwNfACADZANkACQDZwNnACQDdgN5AHMDfgOBAHMDiAOLAHMDlAOXAHEDnAOcAHMDowOkAAgDpQOoAHADuQO6AHMDwQPBAFYDwgPDAHADygPWACAD+gQBACQEFAQeACQEHwQqACAENwRCACQEawRrAAMEbQRtAFIEbgRuAE8EcgRyAAYEeQR5ABoEegR6ABwEewR7ABIEfAR8AEkEfgR+ABAEgQSBABoEhASEAE8EhgSGAE0EiQSJABoEjASMAEYEjwSPAEoEkASQAAYEkgSSABoElQSVABwElwSXAB8EmQSZABUEnQSdAFIEngSeAE8EoASgABoEpQSlAHUEpwSnAEkEqASoABAEqwSrAFIEswS0ABwEuQS5AAEEugS6ABYEuwS7AFAEvAS8AE4EwATAAAUEwwTDABYExgTGABYExwTHABgEyATIABsEyQTJABYEygTKAEgEzATMAA4EzwTPABgE0gTSAEcE1ATUAEwE1QTWABYE1wTXAAQE2QTZABYE3QTdAAcE3gTeAAUE4ATgAAQE4wTjABsE5QTlAB0E5gTmABYE5wTnABME6wTrAFAE7ATsAE4E7gTuABgE8gTyABYE8wT0ABME9QT1AEgE9gT2AA4E+AT4AFAE/AT8ABYE/wUAABYFAQUCABsFBAUEAFIFBwUHABIFCwULAFIFDQUNABoFDwUPAFIFEAURABYFFQUVAFAFGAUYABYFHAUcAFAFHgUeABgFIAUgAFAFJAUkABYFLwUvAFAFMgUyAFAFQgVCAEEFSAVIAEQFWAVYAEAFXgVeAEMFYAVgAD8FdAV1AD0FdgV2ADoFdwV3ADwFeAV4ADoFeQV5ADwFfAV8ADoFfgV+ADsFgAWAADsFrAWsAAwF2gXaACoF3AXcACwF4AXgACwF4wXjAGcF6AXoACwF6gXqACwF7AXsAGgF7QXtAC4F7gXuADAF7wXvADMF8AXwADYF8QXxAGkF8gXyADkF8wXzAGoF9AYNACoGEQYRACoGFgYbACwGOgZDACwGXAZeAGcGewaQACwGkQaRACoGkwaTACwGlQaaACwGowarAGgGrQa1AC4GtgbGADAGyAbOADAGzwbPADMG0AbTADYG1AbbADkG3AbhAGoG5gbnAGoG6QbpADAG7QbtAC4G7wbvAGoG8gbyADMG9Ab0ACoG9Qb1ADAG9gb2AGkG/Ab8ACoG/wb/ACwHAAcAADAHFQcVACEHGgcaAGYHHAccACUHHwcfACEHIgciAHQHIwcjACUHJgcmAHIHJwcnACcHKAcoACkHKgcqAGUHLgcuACUHMQcxACkHMgcyACEHNQc1AA0HOQc5AAIHOwc7AFEHQwdDABcHRgdGABcHRwdHABkHSAdIAEsHSQdJABEHSgdKAGMHTAdMAA8HTwdPABkHVwdXABkHWQdZABcHWgdaAGIHXQddAGQHYAdgABkHYwdjAEsHZQdlAB4HZgdmABcHZwdnABQHawdrAFEHbgduABkHcgdyABcHcwdzAHYHdQd1AGMHdgd2AA8HeQd5AFEHegd6AA0HfweAABcHgQeCAEsHhAeEAFEHhgeGAA0HhweHABEHiQeJAA0HiweLAFEHjgeOABkHjwePAFEHkQeRAC4HmAeYAEIHmQeZAGwHmwebAD4HnQedAEUHngeeAGsI5AjkADoI5QjlADwI5gjmADoI5wjnADwI6AjoADoI6QjpADwI6gjqADoI6wjsAF0AAgT8AAQAAAUqBY4ABwBaAAD/3v/E/8X/6P/T/8T/9v/u/+z/7P/Y/8T/+P/wAAT/o//o/+z/+//s//D/5P/w//gAG//o/8T/xf/8//j/8P/o/8T/xf/o/98AL//s/+z/7P/oAC//6P/sACwALP/7/+z/vf/e/8T/xf/u/+j/o//o/+z/9v/uAAQABP/4//D/+/+E/73/7f/U/+7/hAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/oAAAAAAAAAAAAAAAAAAAAAAAAAAD/+gAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAA/+gAAAAA//oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAAAAAAAAAAAAAAA/+gAAAAAAAAAAAAA//QAAAAAAAAAAP/6AAAAAAAAAAAAAAAAAAAAAP/sAAX/1AAE/+z/1P/sAAUABAAE/+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+NAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/0QAA/6//4P/T/8T/3QAA/+z/6P/Q/8QAAP/wAAD/k//hAAAAFAAAABD/5AAAAAAALP/hAAD/rwAAAAD/8AAAAAD/yAAAAAAAAAAAAAD/6AAAAAD/4QAAAAAAAAAAAAD/vf/R/73/vf/0/+X/k//UAAD/6AAAAAAAAAAA//AAAP9k/73/7QAA/+4AAP/YAAAAAAAAAAAAAP/YAAAAAAAAAAAAEP/8ABD//P/qAAAAAAAAAAAAAP/oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAA/+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAAAAAAAAAAAAAAA/9EAAAAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sABj/wAAW/+z/wP/sABgAFgAW/+wAAAAAAAAAAAAAAAoACgAKAAAAAAAA/7f/2AAA/7D/7P/2AAD/6P/I/6AAAP/2AAD/j//xAAAAAAAAAAD/6AAAAAAAAP/xAAD/twAAAAD/9gAAAAD/twAAAAAAAAAAAAD/6AAAAAD/8QAAAAAAAAAAAAAAAAAAAAD/twAAAAD/j//xAAD/7P/2AAAAAAAA//YAAP97AAD/4QAA/9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/eAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAA/94AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/0AAAAAAAAAAAAAAAA/94AAAAAAAAAAAAA//QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/sABb/rAAS/+z/rP/sABYAEgAS/+wAAAAAAAAAAAAAAAoACgAKAAIABwV0BXkAAAV8BXwABgV+BX4ABwWABYAACAeTB5UACQenB6wADAjkCOoAEgACABAFdAV1AAUFdwV3AAMFeQV5AAMFfgV+AAIFgAWAAAIHkweTAAEHlAeUAAQHlQeVAAEHpweoAAYHqQepAAEHqgeqAAQHqwerAAEHrAesAAQI5QjlAAMI5wjnAAMI6QjpAAMAAgEqAAIAAgA0AAsACwA3ABQAFAA7ABcAFwA8ABgAGAA9ABkAGQA/ABoAGgBAABwAHAAyAB4AIAA4ACEAIQA1ACIAIgA2ACgAKQBVACoAKgA4ACsAKwBVACwALAA4AC0ALQBVAC4ALgA6ADUANQBWADYATwA0AFAAUgAxAFMAUwA0AJ4AoAA3ANMA0wA0AOUA7AA7ARABEAA8AREBFAA9ARUBHABAATMBMwA8ATUBNQA0ATcBNwA/AT0BPQA0AUQBYQAyAWIBYgBUAWYBhQA4AYcBhwA1AYgBjgA2AY8BjwA4AZABkAA2AZEBkQA4AZoBmgBUAagBqABVAbEBsQBVAb4ByABVAcoBywBVAcwB4QA4AeQB5AA4AeYB6wA4AewB8wBVAfQB+wA6Af0B/QA1Ai0CMgBWAjUCNQBVAjcCOABWAjsCOwBVAj8CPwBVAkACQABWAkECQQBVAkgCSAAyAkkCSQA4AksCSwA4Ak8CTwA4AlACUQBVAlMCUwA4AlUCWgA4AmQCZQA4AmcCZwA4AmsCawBVAm4CbgBVAnMCcwBVAngCeABVAnsCewBVAn0CfQBVAn8CggA4AoYChgBVAogCiQBVAooCigA6ApwCnQBWAq4CrgBUAq8CswA1AsYC4gA4AuMC/wAyAwEDCQA4AxcDFwA1AxsDGwAcAx4DHgAiAyUDJQAcAy4DLgAvAy8DLwAoAzADMAAfAzQDNAAZAzUDNwAtAzkDOQAqAzoDOgAuAzsDOwAvAzwDPAAlAz0DPQAaAz4DPgAdA0ADQAAgA0EDQQAjA0IDQgAwA0cDRwAkA0sDSwArA00DTQApA04DTgArA1EDUQArA1QDVwArA1oDWgAdA14DXgArA18DXwAaA2ADYAAjA2QDZAArA2cDZwArA2oDcwAZA3QDdQAcA3YDeQAtA34DgQAtA4gDiwAtA5QDlwAqA5wDnAAtA50DnwAuA6MDpAAvA6UDqAAlA68DrwAcA7ADtwAZA7kDugAtA8IDwwAlA8oD1gAaA9cD3gAjA/oEAQArBAIEAwApBBQEHgArBB8EKgAaBDcEQgArBGcEZwADBGsEawAGBG0EbQAYBHIEcgAMBHoEegATBHsEewAKBHwEfAAOBIwEjAAIBI8EjwAQBJAEkAAMBJUElQATBJcElwAVBJkEmQAPBJ0EnQAYBKcEpwAOBKsEqwAYBKwErAADBK0ErQBCBK8ErwBDBLMEtAATBLUEtQABBLcEuABTBLkEuQAEBLoEugARBLsEuwAXBL0EvwBTBMAEwAALBMEEwgBTBMMEwwARBMQExABTBMYExgARBMkEyQARBMsEywBTBM0EzgBTBNAE0QBTBNME0wBTBNQE1AAWBNUE1gARBNcE1wBSBNgE2ABTBNkE2QARBNoE2gAHBN4E3gALBN8E3wBTBOAE4ABSBOEE4gBTBOQE5ABTBOUE5QAUBOYE5gARBOgE6ABTBOkE6QBFBOoE6gBTBOsE6wAXBO0E7QBTBO8E8QBTBPIE8gARBPgE+AAXBPoE+wABBPwE/AARBP4E/gBTBP8FAAARBQQFBAAYBQYFBgADBQcFBwAKBQkFCQADBQsFCwAYBQ8FDwAYBRAFEQARBRIFEwABBRUFFQAXBRYFFgBTBRgFGAARBRsFGwBTBRwFHAAXBR0FHQBTBR8FHwBTBSAFIAAXBSQFJAARBSgFKQBTBS8FLwAXBTIFMgAXBWsFbABBBW8FbwBBBXEFcQBEBXMFcwBGBXoFewBBBdoF2gAzBdwF3AA5BeAF4AA5BeMF4wBMBegF6AA5BeoF6gA5BewF7ABNBe0F7QBZBe8F7wBOBfAF8ABPBfEF8QA+BfIF8gBQBfMF8wBRBfQGDQAzBhEGEQAzBhYGGwA5BjoGQwA5BlwGXgBMBnsGkAA5BpEGkQAzBpMGkwA5BpUGmgA5BqMGqwBNBq0GtQBZBs8GzwBOBtAG0wBPBtQG2wBQBtwG4QBRBuYG5wBRBu0G7QBZBu8G7wBRBvIG8gBOBvQG9AAzBvYG9gA+BvwG/AAzBv8G/wA5BxUHFQAbBxgHGAAhBxoHGgBLBxwHHAAsBx8HHwAbByMHIwAsBycHJwBYBygHKABKBykHKQAnByoHKgAeBywHLAAmBy4HLgAsBzEHMQBKBzIHMgAbBzQHNAAmBzUHNQACBzkHOQAFB0MHQwASB0YHRgASB0cHRwBXB0kHSQAJB0oHSgANB08HTwBXB1cHVwBXB1kHWQASB1oHWgBHB10HXQBJB2AHYABXB2YHZgASB2cHZwBIB24HbgBXB3IHcgASB3UHdQANB3oHegACB38HgAASB4YHhgACB4cHhwAJB4kHiQACB44HjgBXB5EHkQBZCEgISAA1CZwJnQA1CaQJpQBBAAQCSAK8AAUAAAKKAlgAAABLAooCWAAAAV4AMgEpAAACCwcDAwQDAgIE4AAC/xAAAAAAAAAAAAAAAEFEQk8AIAAwIh4EAP5wAAAEAAGQIAABnwAAAAAB8AKUAAAAIAAFAAAAAwAAAAMAAAAcAAEAAAAAAGQAAwABAAAAHAAEAEgAAAAOAAgAAgAGADkARwBLAE0AVCIe//8AAAAwAEcASwBNAFQiHv///9X/uv+3/7b/sN3xAAEAAAAAAAAAAAAAAAAAAAAAAQYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGBwgJCgsMDQ4AAAAAAAAAAAAAAAAAAQAAAAIAAwAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAFAAAAJiApQAAwAJAA8AEgAVAAA3ESERJTMvASMHNzM/ASMXAzcnAREHUAIS/qWkJykEKSkEKiCYH3pfXwFNXgAClP1sW01iYvZfOzv+nrm6/o0Bc7oAAQAu//QCRAKYAB8AAAUiLgE1ND4BMzIWFwcuASMiBhUUFjMyNjc1IzUzEQ4BAW1ZkVVXkFdHZiBNGTgqTGBcWxQmDGzuInEMTJVtbJlRMiNZFhlwYmRwCgpweP7UIS4AAQBNAAACbAKMAAwAADcRMxEzEzMDEyMDBxVNkwTCosXpoZ9MAAKM/vUBC/78/ngBE2SvAAEATQAAAq4CjAAfAAA3ETMTHgEXMz4BNxMzESM1ND4BNyMPASMvASMeAh0BTaRoChEJBAkQCmakhwcJBAQ1XFZbMwQECQYAAoz+3h07ICA7HQEi/XTvIFdXIKz5+awgV1cg7wABABkAAAITAowABwAANxEjNSEVIxHMswH6swACEHx8/fAAAAACACX/9AHrAocACwAbAAAFIiY1NDYzMhYVFAYnMj4BNTQuASMiDgEVFB4BAQhmfX1mZn19ZhkoFxcoGRgoGBgoDKqioqWloqKqciVeV1dcIiJcV1deJQAAAQBGAAAB2gJ7AAwAADc1MxEjNT4BNzMRMxVGinc0SCJsdwB3AW9bChwU/fx3AAAAAQAhAAAB5AKHABwAADc1PgI1NCYjIgYHJz4BMzIeARUUDgEHPgE7ARUlUH1HMSkiNxhNLmFDP141PWM5GTsWjgBbR3xqLC8xJxpMNDQyWj05bms4AwV8AAEAFv/0Ad8ChwApAAAXIiYnNx4BMzI2NTQuASM1MjY1NCYjIgYHJz4BMzIWFRQGBxUeARUUDgHzTW0jRB1GKC84HEpFVkAoJiI3HkosYjpieTczN0dBawwyKF0cJCckHCkWaC8mISUeGlomK1tTMUYWBBBNPjtTKwAAAAACABMAAAH4AnsACQAUAAATMzU0NjcjDgEHEzUhNRMzETMVIxWghgUBBAwaDjL+7ei0SUkBCGcfUR4aNhv+bphlAX7+jXCYAAABABf/9AHgAnsAHwAAFyImJzceATMyNjU0JiMiBgcnEyEVIwc2MzIeARUUDgH3TmwmQh1EKDE6OCwcJR1CEgFo6QshJjdbOEFqDDQlXRolMjEwMg4SKgFBfHcPKldERmQ0AAAAAgAp//QB7AKHAAsAKAAAASIGBx4BMzI2NTQmAyIuATU0PgEzMhYXBy4BIyIOAQc+ATMyFhUUDgEBExkzFAo4ISEvLx49bkVJdUM/XB5NEDccIzojAxlJHVJrOl8BJR0iSzkxNjIq/s9Bi293mEktH1gSGyVXSiAjX2VCXzQAAAABACwAAAHmAnsADQAANz4CNyE1IRUOAweWBiVKPv7jAbo5RicSBABqp5pUfFpDd3qQXQAAAwAq//QB6AKHABwAJwA0AAAFIi4BNTQ2NzUuATU0PgEzMhYVFAYHFR4BFRQOAQM2NTQmIyIGFRQWEzI2NTQuAScOARUUFgEHP2Q6Py0lMDRcO1dqMiEuQDhlHCcpJB0qPAwlMCI8KBUcOgwsTzM6ShgEHEgyNk8qX08uRxYEGU4/MlAuAX4tMCUtJCUnLP7VJygcJR0REzUdKi8AAgAi//QB5gKHAAsAKQAAExQWMzI2Ny4BIyIGEyImJzceATMyPgE3DgEjIi4BNTQ+ATMyHgEVFA4BqDAkGTMTCjciIDA9P10eThA2HCQ5JAIZSR02VTI6YDk+bkVJdQGyMiodIks5Mf4MLh5YEhslV0ofJCpXQ0JgM0GKcHaZSQADACUAcQMJAhsAHAAoADQAACUiJicjDgEjIi4BNTQ2MzIWFzM+ATMyHgEVFA4BJTI2Ny4BIyIGFRQWJTI2NTQmIyIGBx4BAkM+Xy8EGlI4ME0taVU5UBsEJl48NVYzNln+Yh8zFBY3HiMjKAGKKjA1LCFCHR8+cTk9IjoxUi9ibDclMjo0WTpIZjWFJB4hKiYdHC4DNSMsMykpKjsAAAAAAQAAAAMLxqRBKvFfDzz1AAMD6AAAAADdFA26AAAAAN0TgSIAE//0AwkCmAABAAMAAgAAAAAAAAABAAAEAP5wAAADLgAT//oDCQABAAAAAAAAAAAAAAAAAAAAEAKyAFACfgAuAmYATQL6AE0CLAAZAhAAJQIQAEYCEAAhAhAAFgIQABMCEAAXAhAAKQIQACwCEAAqAhAAIgMuACUAAAAsAFwAdgCoALoA5gD+ASoBaAGMAb4B/gIYAmYCpgL2AAAAAQAAABAANQAFAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABoBPgABAAAAAAAAAFQAAAABAAAAAAABAA0AVAABAAAAAAACAAQAYQABAAAAAAADACEAZQABAAAAAAAEABIAhgABAAAAAAAFADIAmAABAAAAAAAGABAAygABAAAAAAAHAEsA2gABAAAAAAAIAAUBJQABAAAAAAAJAAwBKgABAAAAAAALABkBNgABAAAAAAANAZQBTwABAAAAAAAOABoC4wADAAEECQAAAJoC/QADAAEECQABABoDlwADAAEECQACAAgDsQADAAEECQADAEIDuQADAAEECQAEACQD+wADAAEECQAFAGQEHwADAAEECQAGACAEgwADAAEECQAHAJYEowADAAEECQAIAAoFOQADAAEECQAJABgFQwADAAEECQALADIFWwADAAEECQANAyAFjQADAAEECQAOADQIrcKpIDIwMTAg4oCTIDIwMjEgQWRvYmUgKGh0dHA6Ly93d3cuYWRvYmUuY29tLyksIHdpdGggUmVzZXJ2ZWQgRm9udCBOYW1lIOKAmFNvdXJjZeKAmVNvdXJjZSBTYW5zIDNCb2xkMy4wNDY7QURCTztTb3VyY2VTYW5zMy1Cb2xkO0FET0JFU291cmNlIFNhbnMgMyBCb2xkVmVyc2lvbiAzLjA0Njtob3Rjb252IDEuMC4xMTg7bWFrZW90ZmV4ZSAyLjUuNjU2MDNTb3VyY2VTYW5zMy1Cb2xkU291cmNlIGlzIGEgdHJhZGVtYXJrIG9mIEFkb2JlIGluIHRoZSBVbml0ZWQgU3RhdGVzIGFuZC9vciBvdGhlciBjb3VudHJpZXMuQWRvYmVQYXVsIEQuIEh1bnRodHRwOi8vd3d3LmFkb2JlLmNvbS90eXBlVGhpcyBGb250IFNvZnR3YXJlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBTSUwgT3BlbiBGb250IExpY2Vuc2UsIFZlcnNpb24gMS4xLiBUaGlzIGxpY2Vuc2UgaXMgYXZhaWxhYmxlIHdpdGggYSBGQVEgYXQ6IGh0dHA6Ly9zY3JpcHRzLnNpbC5vcmcvT0ZMLiBUaGlzIEZvbnQgU29mdHdhcmUgaXMgZGlzdHJpYnV0ZWQgb24gYW4g4oCYQVMgSVPigJkgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIFNJTCBPcGVuIEZvbnQgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlLCBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgZ292ZXJuaW5nIHlvdXIgdXNlIG9mIHRoaXMgRm9udCBTb2Z0d2FyZS5odHRwOi8vc2NyaXB0cy5zaWwub3JnL09GTACpACAAMgAwADEAMAAgIBMAIAAyADAAMgAxACAAQQBkAG8AYgBlACAAKABoAHQAdABwADoALwAvAHcAdwB3AC4AYQBkAG8AYgBlAC4AYwBvAG0ALwApACwAIAB3AGkAdABoACAAUgBlAHMAZQByAHYAZQBkACAARgBvAG4AdAAgAE4AYQBtAGUAICAYAFMAbwB1AHIAYwBlIBkAUwBvAHUAcgBjAGUAIABTAGEAbgBzACAAMwBCAG8AbABkADMALgAwADQANgA7AEEARABCAE8AOwBTAG8AdQByAGMAZQBTAGEAbgBzADMALQBCAG8AbABkADsAQQBEAE8AQgBFAFMAbwB1AHIAYwBlACAAUwBhAG4AcwAgADMAIABCAG8AbABkAFYAZQByAHMAaQBvAG4AIAAzAC4AMAA0ADYAOwBoAG8AdABjAG8AbgB2ACAAMQAuADAALgAxADEAOAA7AG0AYQBrAGUAbwB0AGYAZQB4AGUAIAAyAC4ANQAuADYANQA2ADAAMwBTAG8AdQByAGMAZQBTAGEAbgBzADMALQBCAG8AbABkAFMAbwB1AHIAYwBlACAAaQBzACAAYQAgAHQAcgBhAGQAZQBtAGEAcgBrACAAbwBmACAAQQBkAG8AYgBlACAAaQBuACAAdABoAGUAIABVAG4AaQB0AGUAZAAgAFMAdABhAHQAZQBzACAAYQBuAGQALwBvAHIAIABvAHQAaABlAHIAIABjAG8AdQBuAHQAcgBpAGUAcwAuAEEAZABvAGIAZQBQAGEAdQBsACAARAAuACAASAB1AG4AdABoAHQAdABwADoALwAvAHcAdwB3AC4AYQBkAG8AYgBlAC4AYwBvAG0ALwB0AHkAcABlAFQAaABpAHMAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACAAaQBzACAAbABpAGMAZQBuAHMAZQBkACAAdQBuAGQAZQByACAAdABoAGUAIABTAEkATAAgAE8AcABlAG4AIABGAG8AbgB0ACAATABpAGMAZQBuAHMAZQAsACAAVgBlAHIAcwBpAG8AbgAgADEALgAxAC4AIABUAGgAaQBzACAAbABpAGMAZQBuAHMAZQAgAGkAcwAgAGEAdgBhAGkAbABhAGIAbABlACAAdwBpAHQAaAAgAGEAIABGAEEAUQAgAGEAdAA6ACAAaAB0AHQAcAA6AC8ALwBzAGMAcgBpAHAAdABzAC4AcwBpAGwALgBvAHIAZwAvAE8ARgBMAC4AIABUAGgAaQBzACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAGkAcwAgAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAG8AbgAgAGEAbgAgIBgAQQBTACAASQBTIBkAIABCAEEAUwBJAFMALAAgAFcASQBUAEgATwBVAFQAIABXAEEAUgBSAEEATgBUAEkARQBTACAATwBSACAAQwBPAE4ARABJAFQASQBPAE4AUwAgAE8ARgAgAEEATgBZACAASwBJAE4ARAAsACAAZQBpAHQAaABlAHIAIABlAHgAcAByAGUAcwBzACAAbwByACAAaQBtAHAAbABpAGUAZAAuACAAUwBlAGUAIAB0AGgAZQAgAFMASQBMACAATwBwAGUAbgAgAEYAbwBuAHQAIABMAGkAYwBlAG4AcwBlACAAZgBvAHIAIAB0AGgAZQAgAHMAcABlAGMAaQBmAGkAYwAgAGwAYQBuAGcAdQBhAGcAZQAsACAAcABlAHIAbQBpAHMAcwBpAG8AbgBzACAAYQBuAGQAIABsAGkAbQBpAHQAYQB0AGkAbwBuAHMAIABnAG8AdgBlAHIAbgBpAG4AZwAgAHkAbwB1AHIAIAB1AHMAZQAgAG8AZgAgAHQAaABpAHMAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlAC4AaAB0AHQAcAA6AC8ALwBzAGMAcgBpAHAAdABzAC4AcwBpAGwALgBvAHIAZwAvAE8ARgBMAAACAAAAAAAA/84AMgAAAAAAAAAAAAAAAAAAAAAAAAAQABAAAAAqAC4AMAA3ABMAFAAVABYAFwAYABkAGgAbABwAkgAA");

/***/ }),

/***/ "./static/js/about_zulip.js":
/*!**********************************!*\
  !*** ./static/js/about_zulip.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch": () => (/* binding */ launch)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_about_zulip_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/about_zulip.hbs */ "./static/templates/about_zulip.hbs");
/* harmony import */ var _templates_about_zulip_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_about_zulip_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());









function launch() {
    _overlays__WEBPACK_IMPORTED_MODULE_4__.open_overlay({
        name: "about-zulip",
        $overlay: jquery__WEBPACK_IMPORTED_MODULE_1___default()("#about-zulip"),
        on_close() {
            _browser_history__WEBPACK_IMPORTED_MODULE_3__.exit_overlay();
        },
    });

    new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())("#about-zulip .fa-copy");
}

function initialize() {
    const rendered_about_zulip = _templates_about_zulip_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        zulip_version: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        zulip_merge_base: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_fork:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app").append(rendered_about_zulip);
}


/***/ }),

/***/ "./static/js/activity.js":
/*!*******************************!*\
  !*** ./static/js/activity.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "ACTIVE": () => (/* binding */ ACTIVE),
/* harmony export */   "IDLE": () => (/* binding */ IDLE),
/* harmony export */   "build_user_sidebar": () => (/* binding */ build_user_sidebar),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "client_is_active": () => (/* binding */ client_is_active),
/* harmony export */   "compute_active_status": () => (/* binding */ compute_active_status),
/* harmony export */   "escape_search": () => (/* binding */ escape_search),
/* harmony export */   "get_filter_text": () => (/* binding */ get_filter_text),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initiate_search": () => (/* binding */ initiate_search),
/* harmony export */   "mark_client_active": () => (/* binding */ mark_client_active),
/* harmony export */   "mark_client_idle": () => (/* binding */ mark_client_idle),
/* harmony export */   "narrow_for_user": () => (/* binding */ narrow_for_user),
/* harmony export */   "narrow_for_user_id": () => (/* binding */ narrow_for_user_id),
/* harmony export */   "new_user_input": () => (/* binding */ new_user_input),
/* harmony export */   "redraw": () => (/* binding */ redraw),
/* harmony export */   "redraw_user": () => (/* binding */ redraw_user),
/* harmony export */   "reset_users": () => (/* binding */ reset_users),
/* harmony export */   "searching": () => (/* binding */ searching),
/* harmony export */   "send_presence_to_server": () => (/* binding */ send_presence_to_server),
/* harmony export */   "set_cursor_and_filter": () => (/* binding */ set_cursor_and_filter),
/* harmony export */   "set_new_user_input": () => (/* binding */ set_new_user_input),
/* harmony export */   "update_dom_with_unread_counts": () => (/* binding */ update_dom_with_unread_counts),
/* harmony export */   "update_presence_info": () => (/* binding */ update_presence_info),
/* harmony export */   "user_cursor": () => (/* binding */ user_cursor),
/* harmony export */   "user_filter": () => (/* binding */ user_filter)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _buddy_list__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./buddy_list */ "./static/js/buddy_list.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_cursor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./list_cursor */ "./static/js/list_cursor.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _presence__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./presence */ "./static/js/presence.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_search__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./user_search */ "./static/js/user_search.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




















let user_cursor;
let user_filter;

/*
    Helpers for detecting user activity and managing user idle states
*/

/* Broadcast "idle" to server after 5 minutes of local inactivity */
const DEFAULT_IDLE_TIMEOUT_MS = 5 * 60 * 1000;
/* Time between keep-alive pings */
const ACTIVE_PING_INTERVAL_MS = 50 * 1000;

/* Keep in sync with views.py:update_active_status_backend() */
const ACTIVE = "active";

const IDLE = "idle";

// When you open Zulip in a new browser window, client_is_active
// should be true.  When a server-initiated reload happens, however,
// it should be initialized to false.  We handle this with a check for
// whether the window is focused at initialization time.
let client_is_active = document.hasFocus && document.hasFocus();

// new_user_input is a more strict version of client_is_active used
// primarily for analytics.  We initialize this to true, to count new
// page loads, but set it to false in the onload function in reload.js
// if this was a server-initiated-reload to avoid counting a
// server-initiated reload as user activity.
let new_user_input = true;

function set_new_user_input(value) {
    new_user_input = value;
}

function get_pm_list_item(user_id) {
    return _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list.find_li({
        key: user_id,
    });
}

function set_pm_count(user_ids_string, count) {
    const $pm_li = get_pm_list_item(user_ids_string);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($pm_li, count);
}

function update_dom_with_unread_counts(counts) {
    // counts is just a data object that gets calculated elsewhere
    // Our job is to update some DOM elements.

    for (const [user_ids_string, count] of counts.pm_count) {
        // TODO: just use user_ids_string in our markup
        const is_pm = !user_ids_string.includes(",");
        if (is_pm) {
            set_pm_count(user_ids_string, count);
        }
    }
}

function clear_for_testing() {
    user_cursor = undefined;
    user_filter = undefined;
    client_is_active = false;
}

function mark_client_idle() {
    // When we become idle, we don't immediately send anything to the
    // server; instead, we wait for our next periodic update, since
    // this data is fundamentally not timely.
    client_is_active = false;
}

function redraw_user(user_id) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    const filter_text = get_filter_text();

    if (!_buddy_data__WEBPACK_IMPORTED_MODULE_3__.matches_filter(filter_text, user_id)) {
        return;
    }

    const info = _buddy_data__WEBPACK_IMPORTED_MODULE_3__.get_item(user_id);

    _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list.insert_or_move({
        key: user_id,
        item: info,
    });
}

function searching() {
    return user_filter && user_filter.searching();
}

function build_user_sidebar() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return undefined;
    }

    const filter_text = get_filter_text();

    const user_ids = _buddy_data__WEBPACK_IMPORTED_MODULE_3__.get_filtered_and_sorted_user_ids(filter_text);

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("buddy_list.populate", () => {
        _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list.populate({keys: user_ids});
    });

    return user_ids; // for testing
}

function do_update_users_for_search() {
    // Hide all the popovers but not userlist sidebar
    // when the user is searching.
    _popovers__WEBPACK_IMPORTED_MODULE_10__.hide_all_except_sidebars();
    build_user_sidebar();
    user_cursor.reset();
}

const update_users_for_search = lodash__WEBPACK_IMPORTED_MODULE_1___default().throttle(do_update_users_for_search, 50);

function compute_active_status() {
    // The overall algorithm intent for the `status` field is to send
    // `ACTIVE` (aka green circle) if we know the user is at their
    // computer, and IDLE (aka orange circle) if the user might not
    // be:
    //
    // * For the web app, we just know whether this window has focus.
    // * For the electron desktop app, we also know whether the
    //   user is active or idle elsewhere on their system.
    //
    // The check for `get_idle_on_system === undefined` is feature
    // detection; older desktop app releases never set that property.
    if (
        window.electron_bridge !== undefined &&
        window.electron_bridge.get_idle_on_system !== undefined
    ) {
        if (window.electron_bridge.get_idle_on_system()) {
            return IDLE;
        }
        return ACTIVE;
    }

    if (client_is_active) {
        return ACTIVE;
    }
    return IDLE;
}

function send_presence_to_server(want_redraw) {
    // Zulip has 2 data feeds coming from the server to the client:
    // The server_events data, and this presence feed.  Data from
    // server_events is nicely serialized, but if we've been offline
    // and not running for a while (e.g. due to suspend), we can end
    // up with inconsistent state where users appear in presence that
    // don't appear in people.js.  We handle this in 2 stages.  First,
    // here, we trigger an extra run of the clock-jump check that
    // detects whether this device just resumed from suspend.  This
    // ensures that watchdog.suspect_offline is always up-to-date
    // before we initiate a presence request.
    //
    // If we did just resume, it will also trigger an immediate
    // server_events request to the server (the success handler to
    // which will clear suspect_offline and potentially trigger a
    // reload if the device was offline for more than
    // DEFAULT_EVENT_QUEUE_TIMEOUT_SECS).
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    _channel__WEBPACK_IMPORTED_MODULE_5__.post({
        url: "/json/users/me/presence",
        data: {
            status: compute_active_status(),
            ping_only: !want_redraw,
            new_user_input,
            slim_presence: true,
        },
        success(data) {
            // Update Zephyr mirror activity warning
            if (data.zephyr_mirror_active === false) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zephyr-mirror-error").addClass("show");
            } else {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zephyr-mirror-error").removeClass("show");
            }

            new_user_input = false;

            if (want_redraw) {
                _presence__WEBPACK_IMPORTED_MODULE_11__.set_info(data.presences, data.server_timestamp);
                redraw();
            }
        },
    });
}

function mark_client_active() {
    // exported for testing
    if (!client_is_active) {
        client_is_active = true;
        send_presence_to_server(false);
    }
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("html").on("mousemove", () => {
        new_user_input = true;
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on("focus", mark_client_active);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).idle({
        idle: DEFAULT_IDLE_TIMEOUT_MS,
        onIdle: mark_client_idle,
        onActive: mark_client_active,
        keepTracking: true,
    });

    set_cursor_and_filter();

    build_user_sidebar();

    _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list.start_scroll_handler();

    function get_full_presence_list_update() {
        send_presence_to_server(true);
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(get_full_presence_list_update, ACTIVE_PING_INTERVAL_MS);

    // Let the server know we're here, but pass "false" for
    // want_redraw, since we just got all this info in page_params.
    send_presence_to_server(false);
}

function update_presence_info(user_id, info, server_time) {
    _presence__WEBPACK_IMPORTED_MODULE_11__.update_info_from_event(user_id, info, server_time);
    redraw_user(user_id);
    _pm_list__WEBPACK_IMPORTED_MODULE_9__.update_private_messages();
}

function redraw() {
    build_user_sidebar();
    user_cursor.redraw();
    _pm_list__WEBPACK_IMPORTED_MODULE_9__.update_private_messages();
}

function reset_users() {
    // Call this when we're leaving the search widget.
    build_user_sidebar();
    user_cursor.clear();
}

function narrow_for_user(opts) {
    const user_id = _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list.get_key_from_li({$li: opts.$li});
    return narrow_for_user_id({user_id});
}

function narrow_for_user_id(opts) {
    const person = _people__WEBPACK_IMPORTED_MODULE_8__.get_by_user_id(opts.user_id);
    const email = person.email;

    _narrow__WEBPACK_IMPORTED_MODULE_7__.by("pm-with", email, {trigger: "sidebar"});
    user_filter.clear_and_hide_search();
}

function keydown_enter_key() {
    const user_id = user_cursor.get_key();
    if (user_id === undefined) {
        return;
    }

    narrow_for_user_id({user_id});
    _popovers__WEBPACK_IMPORTED_MODULE_10__.hide_all();
}

function set_cursor_and_filter() {
    user_cursor = new _list_cursor__WEBPACK_IMPORTED_MODULE_6__.ListCursor({
        list: _buddy_list__WEBPACK_IMPORTED_MODULE_4__.buddy_list,
        highlight_class: "highlighted_user",
    });

    user_filter = new _user_search__WEBPACK_IMPORTED_MODULE_12__.UserSearch({
        update_list: update_users_for_search,
        reset_items: reset_users,
        on_focus: () => user_cursor.reset(),
    });

    const $input = user_filter.input_field();

    $input.on("blur", () => user_cursor.clear());

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        $elem: $input,
        handlers: {
            Enter() {
                keydown_enter_key();
                return true;
            },
            ArrowUp() {
                user_cursor.prev();
                return true;
            },
            ArrowDown() {
                user_cursor.next();
                return true;
            },
        },
    });
}

function initiate_search() {
    if (user_filter) {
        user_filter.initiate_search();
    }
}

function escape_search() {
    if (user_filter) {
        user_filter.escape_search();
    }
}

function get_filter_text() {
    if (!user_filter) {
        // This may be overly defensive, but there may be
        // situations where get called before everything is
        // fully initialized.  The empty string is a fine
        // default here.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_filter_text() is called before initialization");
        return "";
    }

    return user_filter.text();
}


/***/ }),

/***/ "./static/js/add_subscribers_pill.js":
/*!*******************************************!*\
  !*** ./static/js/add_subscribers_pill.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "create": () => (/* binding */ create),
/* harmony export */   "set_up_handlers": () => (/* binding */ set_up_handlers)
/* harmony export */ });
/* harmony import */ var _input_pill__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./input_pill */ "./static/js/input_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _pill_typeahead__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pill_typeahead */ "./static/js/pill_typeahead.js");
/* harmony import */ var _stream_pill__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_pill */ "./static/js/stream_pill.js");
/* harmony import */ var _user_group_pill__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./user_group_pill */ "./static/js/user_group_pill.js");
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");







function create_item_from_text(text, current_items) {
    const funcs = [
        _stream_pill__WEBPACK_IMPORTED_MODULE_3__.create_item_from_stream_name,
        _user_group_pill__WEBPACK_IMPORTED_MODULE_4__.create_item_from_group_name,
        _user_pill__WEBPACK_IMPORTED_MODULE_5__.create_item_from_email,
    ];
    for (const func of funcs) {
        const item = func(text, current_items);
        if (item) {
            return item;
        }
    }
    return undefined;
}

function get_text_from_item(item) {
    const funcs = [
        _stream_pill__WEBPACK_IMPORTED_MODULE_3__.get_stream_name_from_item,
        _user_group_pill__WEBPACK_IMPORTED_MODULE_4__.get_group_name_from_item,
        _user_pill__WEBPACK_IMPORTED_MODULE_5__.get_email_from_item,
    ];
    for (const func of funcs) {
        const text = func(item);
        if (text) {
            return text;
        }
    }
    return undefined;
}

function set_up_pill_typeahead({pill_widget, $pill_container, get_users}) {
    const opts = {
        user_source: get_users,
        stream: true,
        user_group: true,
        user: true,
    };
    _pill_typeahead__WEBPACK_IMPORTED_MODULE_2__.set_up($pill_container.find(".input"), pill_widget, opts);
}

function create({$pill_container, get_potential_subscribers}) {
    const pill_widget = _input_pill__WEBPACK_IMPORTED_MODULE_0__.create({
        $container: $pill_container,
        create_item_from_text,
        get_text_from_item,
    });

    function get_users() {
        const potential_subscribers = get_potential_subscribers();
        return _user_pill__WEBPACK_IMPORTED_MODULE_5__.filter_taken_users(potential_subscribers, pill_widget);
    }

    set_up_pill_typeahead({pill_widget, $pill_container, get_users});

    return pill_widget;
}

function get_pill_user_ids(pill_widget) {
    const user_ids = _user_pill__WEBPACK_IMPORTED_MODULE_5__.get_user_ids(pill_widget);
    const stream_user_ids = _stream_pill__WEBPACK_IMPORTED_MODULE_3__.get_user_ids(pill_widget);
    const group_user_ids = _user_group_pill__WEBPACK_IMPORTED_MODULE_4__.get_user_ids(pill_widget);
    return [...user_ids, ...stream_user_ids, ...group_user_ids];
}

function set_up_handlers({
    get_pill_widget,
    $parent_container,
    pill_selector,
    button_selector,
    action,
}) {
    /*
        This function handles events for any UI that looks like
        this:

            [pill-enabled input box for subscribers] [Add button]

        In an ideal world the above two widgets would be enclosed in
        a <form>...</form> section and we would have a single submit
        handler, but our current implementation of input pills has
        some magic that prevents the pills from playing nice with
        the vanilla HTML form/submit mechanism.

        So, instead, we provide this helper function to manage
        the two events needed to make it look like the widgets
        are inside an actual HTML <form> tag.

        This abstraction also automatically retrieves the user_ids
        from the input pill and sends them back to the `action`
        function passed in.

        The subscriber input-pill widgets lets you provide
        user_ids by creating pills for either:

            * single user
            * user group
            * stream (i.e. subscribed users for the stream)
    */
    function callback() {
        const pill_widget = get_pill_widget();
        const pill_user_ids = get_pill_user_ids(pill_widget);
        action({pill_user_ids});
    }

    $parent_container.on("keyup", pill_selector, (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
            callback();
        }
    });

    $parent_container.on("click", button_selector, (e) => {
        e.preventDefault();
        callback();
    });
}


/***/ }),

/***/ "./static/js/admin.js":
/*!****************************!*\
  !*** ./static/js/admin.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "launch": () => (/* binding */ launch)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_admin_tab_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings/admin_tab.hbs */ "./static/templates/settings/admin_tab.hbs");
/* harmony import */ var _templates_settings_admin_tab_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_tab_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_organization_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/organization_settings_tip.hbs */ "./static/templates/settings/organization_settings_tip.hbs");
/* harmony import */ var _templates_settings_organization_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_organization_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings */ "./static/js/settings.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_panel_menu__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./settings_panel_menu */ "./static/js/settings_panel_menu.js");
/* harmony import */ var _settings_sections__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_sections */ "./static/js/settings_sections.js");
/* harmony import */ var _settings_toggle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_toggle */ "./static/js/settings_toggle.js");


















const admin_settings_label = {
    // Organization profile
    realm_want_advertise_in_communities_directory: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Advertise organization in the Zulip communities directory",
    }),
    // Organization settings
    realm_allow_edit_history: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Enable message edit history"}),
    realm_mandatory_topics: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Require topics in stream messages"}),
    realm_notifications_stream: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New stream announcements"}),
    realm_signup_notifications_stream: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New user announcements"}),
    realm_inline_image_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Show previews of uploaded and linked images"}),
    realm_inline_url_embed_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Show previews of linked websites"}),
    realm_send_welcome_emails: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Send emails introducing Zulip to new users"}),
    realm_message_content_allowed_in_email_notifications: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Allow message content in message notification emails",
    }),
    realm_enable_spectator_access: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Allow creating web-public streams (visible to anyone on the Internet)",
    }),
    realm_digest_emails_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Send weekly digest emails to inactive users",
    }),
    realm_default_code_block_language: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Default language for code blocks"}),

    // Organization permissions
    realm_name_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Prevent users from changing their name"}),
    realm_email_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Prevent users from changing their email address",
    }),
    realm_avatar_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Prevent users from changing their avatar"}),
    realm_invite_required: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Invitations are required for joining this organization",
    }),
    realm_default_language: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Language for automated messages and invitation emails",
    }),
    realm_allow_message_editing: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Allow message editing"}),
    realm_enable_read_receipts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Enable read receipts"}),
    realm_enable_read_receipts_parens_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        defaultMessage: "Users can always disable their personal read receipts.",
    }),
};

function insert_tip_box() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }
    const tip_box = _templates_settings_organization_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2___default()({is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box")
        .find(".settings-section")
        .not("#emoji-settings")
        .not("#user-groups-admin")
        .not("#organization-auth-settings")
        .not("#admin-bot-list")
        .not("#admin-invites-list")
        .prepend(tip_box);
}

function get_realm_level_notification_settings(options) {
    const all_notifications_settings = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );

    // We remove enable_marketing_emails and enable_login_emails
    // setting from all_notification_settings, since there are no
    // realm-level defaults for these setting.
    all_notifications_settings.settings.other_email_settings = ["enable_digest_emails"];

    options.general_settings = all_notifications_settings.general_settings;
    options.notification_settings = all_notifications_settings.settings;
    options.show_push_notifications_tooltip =
        all_notifications_settings.show_push_notifications_tooltip;
}

function build_page() {
    const options = {
        custom_profile_field_types: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        full_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_org_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_available_video_chat_providers: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        giphy_rating_options: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        giphy_api_key_empty: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "",
        realm_description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_inline_image_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        server_inline_image_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_inline_url_embed_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        server_inline_url_embed_preview: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_authentication_methods: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_user_group_edit_policy: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_name_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_email_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_avatar_changes_disabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_add_custom_emoji_policy: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        can_add_emojis: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        can_create_new_bots: _settings_bots__WEBPACK_IMPORTED_MODULE_6__.can_create_new_bots(),
        realm_message_content_edit_limit_minutes: _settings_org__WEBPACK_IMPORTED_MODULE_7__.get_realm_time_limits_in_minutes(
            "realm_message_content_edit_limit_seconds",
        ),
        realm_message_content_delete_limit_minutes: _settings_org__WEBPACK_IMPORTED_MODULE_7__.get_realm_time_limits_in_minutes(
            "realm_message_content_delete_limit_seconds",
        ),
        realm_message_retention_days: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_allow_edit_history: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_allow_message_editing: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        language_list: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_default_language_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())),
        realm_default_language_code: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_waiting_period_threshold: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_notifications_stream_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_signup_notifications_stream_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_guest: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        user_can_change_logo: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        realm_icon_source: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_icon_url: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_logo_source: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_logo_url: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_night_logo_source: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_night_logo_url: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_mandatory_topics: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_send_welcome_emails: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_message_content_allowed_in_email_notifications:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_enable_spectator_access: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        settings_send_digest_emails: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_digest_emails_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_digest_weekday: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        development: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        zulip_plan_is_not_limited: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        upgrade_text_for_wide_organization_logo:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_default_external_accounts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        admin_settings_label,
        msg_edit_limit_dropdown_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        msg_delete_limit_dropdown_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        bot_creation_policy_values: _settings_bots__WEBPACK_IMPORTED_MODULE_6__.bot_creation_policy_values,
        email_address_visibility_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        can_invite_others_to_realm: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        realm_invite_required: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        can_edit_user_groups: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        policy_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_delete_own_message_policy: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        DELETE_OWN_MESSAGE_POLICY_ADMINS_ONLY:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        ..._settings_org__WEBPACK_IMPORTED_MODULE_7__.get_organization_settings_options(),
        demote_inactive_streams_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        user_list_style_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        color_scheme_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        default_view_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        settings_object: Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        display_settings: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        settings_label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        desktop_icon_count_display_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        enable_sound_select:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ||
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        email_notifications_batching_period_values:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        twenty_four_hour_time_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        create_web_public_stream_policy_values:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        disable_enable_spectator_access_setting:
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ||
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        can_sort_by_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        realm_push_notifications_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_org_type_values: _settings_org__WEBPACK_IMPORTED_MODULE_7__.get_org_type_dropdown_options(),
        realm_want_advertise_in_communities_directory:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        disable_want_advertise_in_communities_directory:
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_business_type_org:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_enable_read_receipts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    };

    if (options.realm_logo_source !== "D" && options.realm_night_logo_source === "D") {
        // If no dark theme logo is specified but a light theme one is,
        // use the light theme one.  See also similar code in realm_logo.js.
        options.realm_night_logo_url = options.realm_logo_url;
    }

    options.giphy_help_link = "/help/animated-gifs-from-giphy";
    if (options.giphy_api_key_empty) {
        options.giphy_help_link =
            "https://zulip.readthedocs.io/en/latest/production/giphy-gif-integration.html";
    }

    get_realm_level_notification_settings(options);

    const rendered_admin_tab = _templates_settings_admin_tab_hbs__WEBPACK_IMPORTED_MODULE_1___default()(options);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_content .organization-box").html(rendered_admin_tab);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_content .alert").removeClass("show");

    _settings_bots__WEBPACK_IMPORTED_MODULE_6__.update_bot_settings_tip();
    insert_tip_box();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_bot_creation_policy").val(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_email_address_visibility").val(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_digest_weekday").val(options.realm_digest_weekday);
}

function launch(section) {
    _settings__WEBPACK_IMPORTED_MODULE_5__.build_page();
    build_page();
    _settings_sections__WEBPACK_IMPORTED_MODULE_9__.reset_sections();

    _overlays__WEBPACK_IMPORTED_MODULE_4__.open_settings();
    _settings_panel_menu__WEBPACK_IMPORTED_MODULE_8__.org_settings.activate_section_or_default(section);
    _settings_toggle__WEBPACK_IMPORTED_MODULE_10__.highlight_toggle("organization");
}


/***/ }),

/***/ "./static/js/alert_words.js":
/*!**********************************!*\
  !*** ./static/js/alert_words.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_word_list": () => (/* binding */ get_word_list),
/* harmony export */   "has_alert_word": () => (/* binding */ has_alert_word),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "notifies": () => (/* binding */ notifies),
/* harmony export */   "process_message": () => (/* binding */ process_message),
/* harmony export */   "set_words": () => (/* binding */ set_words)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");




// For simplicity, we use a list for our internal
// data, since that matches what the server sends us.
let my_alert_words = [];

function set_words(words) {
    my_alert_words = words;
}

function get_word_list() {
    // Returns a array of objects
    // (with each alert_word as value and 'word' as key to the object.)
    const words = [];
    for (const word of my_alert_words) {
        words.push({word});
    }
    return words;
}

function has_alert_word(word) {
    return my_alert_words.includes(word);
}

const alert_regex_replacements = new Map([
    ["&", "&amp;"],
    ["<", "&lt;"],
    [">", "&gt;"],
    // Accept quotes with or without HTML escaping
    ['"', '(?:"|&quot;)'],
    ["'", "(?:'|&#39;)"],
]);

function process_message(message) {
    // Parsing for alert words is expensive, so we rely on the host
    // to tell us there any alert words to even look for.
    if (!message.alerted) {
        return;
    }

    for (const word of my_alert_words) {
        const clean = lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp(word).replace(/["&'<>]/g, (c) =>
            alert_regex_replacements.get(c),
        );
        const before_punctuation = "\\s|^|>|[\\(\\\".,';\\[]";
        const after_punctuation = "(?=\\s)|$|<|[\\)\\\"\\?!:.,';\\]!]";

        const regex = new RegExp(`(${before_punctuation})(${clean})(${after_punctuation})`, "ig");
        message.content = message.content.replace(
            regex,
            (match, before, word, after, offset, content) => {
                // Logic for ensuring that we don't muck up rendered HTML.
                const pre_match = content.slice(0, offset);
                // We want to find the position of the `<` and `>` only in the
                // match and the string before it. So, don't include the last
                // character of match in `check_string`. This covers the corner
                // case when there is an alert word just before `<` or `>`.
                const check_string = pre_match + match.slice(0, -1);
                const in_tag = check_string.lastIndexOf("<") > check_string.lastIndexOf(">");
                // Matched word is inside a HTML tag so don't perform any highlighting.
                if (in_tag) {
                    return before + word + after;
                }
                return before + "<span class='alert-word'>" + word + "</span>" + after;
            },
        );
    }
}

function notifies(message) {
    // We exclude ourselves from notifications when we type one of our own
    // alert words into a message, just because that can be annoying for
    // certain types of workflows where everybody on your team, including
    // yourself, sets up an alert word to effectively mention the team.
    return !_people__WEBPACK_IMPORTED_MODULE_1__.is_current_user(message.sender_email) && message.alerted;
}

const initialize = (params) => {
    my_alert_words = params.alert_words;
};


/***/ }),

/***/ "./static/js/alert_words_ui.js":
/*!*************************************!*\
  !*** ./static/js/alert_words_ui.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "loaded": () => (/* binding */ loaded),
/* harmony export */   "rerender_alert_words_ui": () => (/* binding */ rerender_alert_words_ui),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up_alert_words": () => (/* binding */ set_up_alert_words),
/* harmony export */   "show_add_alert_word_modal": () => (/* binding */ show_add_alert_word_modal)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_add_alert_word_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings/add_alert_word.hbs */ "./static/templates/settings/add_alert_word.hbs");
/* harmony import */ var _templates_settings_add_alert_word_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_add_alert_word_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_alert_word_settings_item_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/alert_word_settings_item.hbs */ "./static/templates/settings/alert_word_settings_item.hbs");
/* harmony import */ var _templates_settings_alert_word_settings_item_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_alert_word_settings_item_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());












let loaded = false;

function rerender_alert_words_ui() {
    if (!loaded) {
        return;
    }

    const words = _alert_words__WEBPACK_IMPORTED_MODULE_3__.get_word_list();
    words.sort();
    const $word_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert-words-table");

    _list_widget__WEBPACK_IMPORTED_MODULE_7__.create($word_list, words, {
        name: "alert-words-list",
        modifier(alert_word) {
            return _templates_settings_alert_word_settings_item_hbs__WEBPACK_IMPORTED_MODULE_2___default()({alert_word});
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert-word-settings"),
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert-word-settings .progressive-table-wrapper"),
    });
}

function update_alert_word_status(status_text, is_error) {
    const $alert_word_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert_word_status");
    if (is_error) {
        $alert_word_status.removeClass("alert-success").addClass("alert-danger");
    } else {
        $alert_word_status.removeClass("alert-danger").addClass("alert-success");
    }
    $alert_word_status.find(".alert_word_status_text").text(status_text);
    $alert_word_status.show();
}

function add_alert_word(e) {
    e.preventDefault();
    e.stopPropagation();

    const alert_word = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-alert-word-name").val().trim();

    if (_alert_words__WEBPACK_IMPORTED_MODULE_3__.has_alert_word(alert_word)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Alert word already exists!"}),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error"),
        );
        _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.hide_dialog_spinner();
        return;
    }

    const words_to_be_added = [alert_word];

    const data = {alert_words: JSON.stringify(words_to_be_added)};
    _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_4__.post, "/json/users/me/alert_words", data);
}

function remove_alert_word(alert_word) {
    const words_to_be_removed = [alert_word];
    _channel__WEBPACK_IMPORTED_MODULE_4__.del({
        url: "/json/users/me/alert_words",
        data: {alert_words: JSON.stringify(words_to_be_removed)},
        success() {
            update_alert_word_status(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: `Alert word "{alert_word}" removed successfully!`},
                    {alert_word},
                ),
                false,
            );
        },
        error() {
            update_alert_word_status(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error removing alert word!"}), true);
        },
    });
}

function show_add_alert_word_modal() {
    const html_body = _templates_settings_add_alert_word_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

    function add_alert_word_post_render() {
        const $add_user_group_input_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-alert-word-name");
        const $add_user_group_submit_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-alert-word .dialog_submit_button");
        $add_user_group_submit_button.prop("disabled", true);

        $add_user_group_input_element.on("input", () => {
            $add_user_group_submit_button.prop(
                "disabled",
                $add_user_group_input_element.val().trim() === "",
            );
        });
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add a new alert word"}),
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add"}),
        help_link: "/help/pm-mention-alert-notifications#alert-words",
        form_id: "add-alert-word-form",
        id: "add-alert-word",
        loading_spinner: true,
        on_click: add_alert_word,
        on_shown: () => jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-alert-word-name").trigger("focus"),
        post_render: add_alert_word_post_render,
    });
}

function set_up_alert_words() {
    // The settings page must be rendered before this function gets called.
    loaded = true;
    rerender_alert_words_ui();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#open-add-alert-word-modal").on("click", () => {
        show_add_alert_word_modal();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert-words-table").on("click", ".remove-alert-word", (event) => {
        const word = jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.currentTarget).parents("tr").find(".value").text().trim();
        remove_alert_word(word);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#alert-word-settings").on("click", ".close-alert-word-status", (event) => {
        event.preventDefault();
        const $alert = jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.currentTarget).parents(".alert");
        $alert.hide();
    });
}

function reset() {
    loaded = false;
}


/***/ }),

/***/ "./static/js/all_messages_data.js":
/*!****************************************!*\
  !*** ./static/js/all_messages_data.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "all_messages_data": () => (/* binding */ all_messages_data)
/* harmony export */ });
/* harmony import */ var _message_list_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./message_list_data */ "./static/js/message_list_data.js");


const all_messages_data = new _message_list_data__WEBPACK_IMPORTED_MODULE_0__.MessageListData({
    excludes_muted_topics: false,
});


/***/ }),

/***/ "./static/js/attachments_ui.js":
/*!*************************************!*\
  !*** ./static/js/attachments_ui.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "bytes_to_size": () => (/* binding */ bytes_to_size),
/* harmony export */   "percentage_used_space": () => (/* binding */ percentage_used_space),
/* harmony export */   "set_up_attachments": () => (/* binding */ set_up_attachments),
/* harmony export */   "update_attachments": () => (/* binding */ update_attachments)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_attachment_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_attachment.hbs */ "./static/templates/confirm_dialog/confirm_delete_attachment.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_attachment_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_attachment_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_upload_space_stats_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/upload_space_stats.hbs */ "./static/templates/settings/upload_space_stats.hbs");
/* harmony import */ var _templates_settings_upload_space_stats_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_upload_space_stats_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_uploaded_files_list_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/uploaded_files_list.hbs */ "./static/templates/settings/uploaded_files_list.hbs");
/* harmony import */ var _templates_settings_uploaded_files_list_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_uploaded_files_list_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















let attachments;
let upload_space_used;

function bytes_to_size(bytes, kb_with_1024_bytes = false) {
    const kb_size = kb_with_1024_bytes ? 1024 : 1000;
    const sizes = ["B", "KB", "MB", "GB", "TB"];
    if (bytes === 0) {
        return "0 B";
    }
    const i = Number.parseInt(Math.floor(Math.log(bytes) / Math.log(kb_size)), 10);
    let size = Math.round(bytes / Math.pow(kb_size, i));
    if (i > 0 && size < 10) {
        size = Math.round((bytes / Math.pow(kb_size, i)) * 10) / 10;
    }
    return size + " " + sizes[i];
}

function percentage_used_space(uploads_size) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === null) {
        return null;
    }
    return ((100 * uploads_size) / Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).toFixed(1);
}

function set_upload_space_stats() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === null) {
        return;
    }
    const args = {
        show_upgrade_message: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 2,
        percent_used: percentage_used_space(upload_space_used),
        upload_quota: bytes_to_size(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()), true),
    };
    const rendered_upload_stats_html = _templates_settings_upload_space_stats_hbs__WEBPACK_IMPORTED_MODULE_2___default()(args);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachment-stats-holder").html(rendered_upload_stats_html);
}

function delete_attachments(attachment, file_name) {
    const html_body = _templates_confirm_dialog_confirm_delete_attachment_hbs__WEBPACK_IMPORTED_MODULE_1___default()({file_name});

    _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete file?"}),
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete"}),
        id: "confirm_delete_file_modal",
        focus_submit_on_open: true,
        on_click: () =>
            _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_4__.del, "/json/attachments/" + attachment),
        loading_spinner: true,
    });
}

function sort_mentioned_in(a, b) {
    const a_m = a.messages[0];
    const b_m = b.messages[0];

    if (!a_m) {
        return 1;
    }
    if (!b_m) {
        return -1;
    }

    if (a_m.id > b_m.id) {
        return 1;
    } else if (a_m.id === b_m.id) {
        return 0;
    }

    return -1;
}

function render_attachments_ui() {
    set_upload_space_stats();

    const $uploaded_files_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#uploaded_files_table").expectOne();
    const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#upload_file_search");

    _list_widget__WEBPACK_IMPORTED_MODULE_7__.create($uploaded_files_table, attachments, {
        name: "uploaded-files-list",
        modifier(attachment) {
            return _templates_settings_uploaded_files_list_hbs__WEBPACK_IMPORTED_MODULE_3___default()({attachment});
        },
        filter: {
            $element: $search_input,
            predicate(item, value) {
                return item.name.toLocaleLowerCase().includes(value);
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_8__.reset_scrollbar($uploaded_files_table.closest(".progressive-table-wrapper"));
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachments-settings").expectOne(),
        init_sort: ["numeric", "create_time"],
        sort_fields: {
            mentioned_in: sort_mentioned_in,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachments-settings .progressive-table-wrapper"),
    });

    _ui__WEBPACK_IMPORTED_MODULE_8__.reset_scrollbar($uploaded_files_table.closest(".progressive-table-wrapper"));
}

function format_attachment_data(new_attachments) {
    for (const attachment of new_attachments) {
        const time = new Date(attachment.create_time);
        attachment.create_time_str = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time).time_str;
        attachment.size_str = bytes_to_size(attachment.size);
    }
}

function update_attachments(event) {
    if (attachments === undefined) {
        // If we haven't fetched attachment data yet, there's nothing to do.
        return;
    }
    if (event.op === "remove" || event.op === "update") {
        attachments = attachments.filter((a) => a.id !== event.attachment.id);
    }
    if (event.op === "add" || event.op === "update") {
        format_attachment_data([event.attachment]);
        attachments.push(event.attachment);
    }
    upload_space_used = event.upload_space_used;
    // TODO: This is inefficient and we should be able to do some sort
    // of incremental ListWidget update instead.
    render_attachments_ui();
}

function set_up_attachments() {
    // The settings page must be rendered before this function gets called.

    const $status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#delete-upload-status");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachments_loading_indicator"), {text: "Loading..."});

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#uploaded_files_table").on("click", ".remove-attachment", (e) => {
        const file_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".uploaded_file_row").attr("id");
        delete_attachments(
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".uploaded_file_row").attr("data-attachment-id"),
            file_name,
        );
    });

    _channel__WEBPACK_IMPORTED_MODULE_4__.get({
        url: "/json/attachments",
        success(data) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachments_loading_indicator"));
            format_attachment_data(data.attachments);
            attachments = data.attachments;
            upload_space_used = data.upload_space_used;
            render_attachments_ui();
        },
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#attachments_loading_indicator"));
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $status);
        },
    });
}


/***/ }),

/***/ "./static/js/avatar.js":
/*!*****************************!*\
  !*** ./static/js/avatar.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_bot_create_widget": () => (/* binding */ build_bot_create_widget),
/* harmony export */   "build_bot_edit_widget": () => (/* binding */ build_bot_edit_widget),
/* harmony export */   "build_user_avatar_widget": () => (/* binding */ build_user_avatar_widget)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_user_avatar_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_user_avatar.hbs */ "./static/templates/confirm_dialog/confirm_delete_user_avatar.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_user_avatar_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_user_avatar_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());











function build_bot_create_widget() {
    // We have to do strange gyrations with the file input to clear it,
    // where we replace it wholesale, so we generalize the file input with
    // a callback function.
    const get_file_input = function () {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot_avatar_file_input");
    };

    const $file_name_field = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot_avatar_file");
    const $input_error = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot_avatar_file_input_error");
    const $clear_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot_avatar_clear_button");
    const $upload_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot_avatar_upload_button");

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        get_file_input,
        $file_name_field,
        $input_error,
        $clear_button,
        $upload_button,
    );
}

function build_bot_edit_widget($target) {
    const get_file_input = function () {
        return $target.find(".edit_bot_avatar_file_input");
    };

    const $file_name_field = $target.find(".edit_bot_avatar_file");
    const $input_error = $target.find(".edit_bot_avatar_error");
    const $clear_button = $target.find(".edit_bot_avatar_clear_button");
    const $upload_button = $target.find(".edit_bot_avatar_upload_button");

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        get_file_input,
        $file_name_field,
        $input_error,
        $clear_button,
        $upload_button,
    );
}

function display_avatar_delete_complete() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .upload-spinner-background").css({visibility: "hidden"});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-upload-text").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").show();
}

function display_avatar_delete_started() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .upload-spinner-background").css({visibility: "visible"});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-upload-text").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").hide();
}

function build_user_avatar_widget(upload_function) {
    const get_file_input = function () {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_file_input").expectOne();
    };

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "G") {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").hide();
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        function delete_user_avatar() {
            display_avatar_delete_started();
            _channel__WEBPACK_IMPORTED_MODULE_2__.del({
                url: "/json/users/me/avatar",
                success() {
                    display_avatar_delete_complete();

                    // Need to clear input because of a small edge case
                    // where you try to upload the same image you just deleted.
                    get_file_input().val("");
                    // Rest of the work is done via the user_events -> avatar_url event we will get
                },
                error() {
                    display_avatar_delete_complete();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").show();
                },
            });
        }
        const html_body = _templates_confirm_dialog_confirm_delete_user_avatar_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_3__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete profile picture"}),
            html_body,
            on_click: delete_user_avatar,
        });
    });

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            get_file_input,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_file_input_error").expectOne(),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_upload_button").expectOne(),
            upload_function,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
    }

    return undefined;
}


/***/ }),

/***/ "./static/js/bot_data.js":
/*!*******************************!*\
  !*** ./static/js/bot_data.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add": () => (/* binding */ add),
/* harmony export */   "all_user_ids": () => (/* binding */ all_user_ids),
/* harmony export */   "deactivate": () => (/* binding */ deactivate),
/* harmony export */   "del": () => (/* binding */ del),
/* harmony export */   "get": () => (/* binding */ get),
/* harmony export */   "get_all_bots_for_current_user": () => (/* binding */ get_all_bots_for_current_user),
/* harmony export */   "get_all_bots_owned_by_user": () => (/* binding */ get_all_bots_owned_by_user),
/* harmony export */   "get_editable": () => (/* binding */ get_editable),
/* harmony export */   "get_services": () => (/* binding */ get_services),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "update": () => (/* binding */ update)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");




const bots = new Map();

const bot_fields = [
    "api_key",
    "avatar_url",
    "bot_type",
    "default_all_public_streams",
    "default_events_register_stream",
    "default_sending_stream",
    "email",
    "full_name",
    "is_active",
    "owner", // TODO: eliminate
    "owner_id",
    "user_id",
];

const services = new Map();
const services_fields = ["base_url", "interface", "config_data", "service_name", "token"];

function all_user_ids() {
    return Array.from(bots.keys());
}

function add(bot) {
    const clean_bot = lodash__WEBPACK_IMPORTED_MODULE_0___default().pick(bot, bot_fields);
    bots.set(bot.user_id, clean_bot);
    const clean_services = bot.services.map((service) => lodash__WEBPACK_IMPORTED_MODULE_0___default().pick(service, services_fields));
    services.set(bot.user_id, clean_services);
}

function deactivate(bot_id) {
    bots.get(bot_id).is_active = false;
}

function del(bot_id) {
    bots.delete(bot_id);
    services.delete(bot_id);
}

function update(bot_id, bot_update) {
    const bot = bots.get(bot_id);
    Object.assign(bot, lodash__WEBPACK_IMPORTED_MODULE_0___default().pick(bot_update, bot_fields));

    // We currently only support one service per bot.
    const service = services.get(bot_id)[0];
    if (bot_update.services !== undefined && bot_update.services.length > 0) {
        Object.assign(service, lodash__WEBPACK_IMPORTED_MODULE_0___default().pick(bot_update.services[0], services_fields));
    }
}

function get_all_bots_for_current_user() {
    const ret = [];
    for (const bot of bots.values()) {
        if (_people__WEBPACK_IMPORTED_MODULE_1__.is_my_user_id(bot.owner_id)) {
            ret.push(bot);
        }
    }
    return ret;
}

function get_editable() {
    const ret = [];
    for (const bot of bots.values()) {
        if (bot.is_active && _people__WEBPACK_IMPORTED_MODULE_1__.is_my_user_id(bot.owner_id)) {
            ret.push(bot);
        }
    }
    return ret;
}

function get_all_bots_owned_by_user(user_id) {
    const ret = [];
    for (const bot of bots.values()) {
        if (bot.owner_id === user_id && bot.is_active) {
            ret.push(bot);
        }
    }
    return ret;
}

function get(bot_id) {
    return bots.get(bot_id);
}

function get_services(bot_id) {
    return services.get(bot_id);
}

function initialize(params) {
    bots.clear();
    for (const bot of params.realm_bots) {
        add(bot);
    }
}


/***/ }),

/***/ "./static/js/browser_history.js":
/*!**************************************!*\
  !*** ./static/js/browser_history.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "exit_overlay": () => (/* binding */ exit_overlay),
/* harmony export */   "go_to_location": () => (/* binding */ go_to_location),
/* harmony export */   "old_hash": () => (/* binding */ old_hash),
/* harmony export */   "return_to_web_public_hash": () => (/* binding */ return_to_web_public_hash),
/* harmony export */   "save_old_hash": () => (/* binding */ save_old_hash),
/* harmony export */   "set_hash_before_overlay": () => (/* binding */ set_hash_before_overlay),
/* harmony export */   "state": () => (/* binding */ state),
/* harmony export */   "update": () => (/* binding */ update),
/* harmony export */   "update_hash_internally_if_required": () => (/* binding */ update_hash_internally_if_required),
/* harmony export */   "update_web_public_hash": () => (/* binding */ update_web_public_hash)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




const state = {
    is_internal_change: false,
    hash_before_overlay: null,
    old_hash: window.location.hash,
    changing_hash: false,
    // If the spectator's hash changes to a restricted hash, then we store the old hash
    // so that we can take user back to the allowed hash.
    // TODO: Store #narrow old hashes. Currently they are not stored here since, the #narrow
    // hashes are changed without calling `hashchanged` in many ways.
    spectator_old_hash: _hash_util__WEBPACK_IMPORTED_MODULE_1__.is_spectator_compatible(window.location.hash)
        ? window.location.hash
        : "#",
};

function clear_for_testing() {
    state.is_internal_change = false;
    state.hash_before_overlay = null;
    state.old_hash = "#";
}

function old_hash() {
    return state.old_hash;
}

function set_hash_before_overlay(hash) {
    state.hash_before_overlay = hash;
}

function update_web_public_hash(hash) {
    // Returns true if hash is web-public compatible.
    if (_hash_util__WEBPACK_IMPORTED_MODULE_1__.is_spectator_compatible(hash)) {
        state.spectator_old_hash = hash;
        return true;
    }
    return false;
}

function save_old_hash() {
    state.old_hash = window.location.hash;

    const was_internal_change = state.is_internal_change;
    state.is_internal_change = false;

    return was_internal_change;
}

function update(new_hash) {
    const old_hash = window.location.hash;

    if (!new_hash.startsWith("#")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("programming error: prefix hashes with #: " + new_hash);
        return;
    }

    if (old_hash === new_hash) {
        // If somebody is calling us with the same hash we already have, it's
        // probably harmless, and we just ignore it.  But it could be a symptom
        // of disorganized code that's prone to an infinite loop of repeatedly
        // assigning the same hash.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("ignoring probably-harmless call to browser_history.update: " + new_hash);
        return;
    }

    state.old_hash = old_hash;
    state.is_internal_change = true;
    window.location.hash = new_hash;
}

function exit_overlay() {
    if (_hash_util__WEBPACK_IMPORTED_MODULE_1__.is_overlay_hash(window.location.hash) && !state.changing_hash) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
        const new_hash = state.hash_before_overlay || "#";
        update(new_hash);
    }
}

function go_to_location(hash) {
    // Call this function when you WANT the hashchanged
    // function to run.
    window.location.hash = hash;
}

function update_hash_internally_if_required(hash) {
    if (window.location.hash !== hash) {
        update(hash);
    }
}

function return_to_web_public_hash() {
    window.location.hash = state.spectator_old_hash;
}


/***/ }),

/***/ "./static/js/buddy_data.js":
/*!*********************************!*\
  !*** ./static/js/buddy_data.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "compare_function": () => (/* binding */ compare_function),
/* harmony export */   "get_filtered_and_sorted_user_ids": () => (/* binding */ get_filtered_and_sorted_user_ids),
/* harmony export */   "get_item": () => (/* binding */ get_item),
/* harmony export */   "get_items_for_users": () => (/* binding */ get_items_for_users),
/* harmony export */   "get_title_data": () => (/* binding */ get_title_data),
/* harmony export */   "get_user_circle_class": () => (/* binding */ get_user_circle_class),
/* harmony export */   "info_for": () => (/* binding */ info_for),
/* harmony export */   "level": () => (/* binding */ level),
/* harmony export */   "matches_filter": () => (/* binding */ matches_filter),
/* harmony export */   "max_size_before_shrinking": () => (/* binding */ max_size_before_shrinking),
/* harmony export */   "sort_users": () => (/* binding */ sort_users),
/* harmony export */   "user_last_seen_time_status": () => (/* binding */ user_last_seen_time_status)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_fade_users__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./compose_fade_users */ "./static/js/compose_fade_users.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _presence__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./presence */ "./static/js/presence.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());














/*

   This is the main model code for building the buddy list.
   We also rely on presence.js to compute the actual presence
   for users.  We glue in other "people" data and do
   filtering/sorting of the data that we'll send into the view.

*/

const max_size_before_shrinking = 600;

const fade_config = {
    get_user_id(item) {
        return item.user_id;
    },
    fade(item) {
        item.faded = true;
    },
    unfade(item) {
        item.faded = false;
    },
};

function get_user_circle_class(user_id) {
    const status = _presence__WEBPACK_IMPORTED_MODULE_5__.get_status(user_id);

    switch (status) {
        case "active":
            return "user_circle_green";
        case "idle":
            return "user_circle_idle";
        default:
            return "user_circle_empty";
    }
}

function level(user_id) {
    if (_people__WEBPACK_IMPORTED_MODULE_4__.is_my_user_id(user_id)) {
        // Always put current user at the top.
        return 0;
    }

    const status = _presence__WEBPACK_IMPORTED_MODULE_5__.get_status(user_id);

    switch (status) {
        case "active":
            return 1;
        case "idle":
            return 2;
        default:
            return 3;
    }
}

function compare_function(a, b) {
    const level_a = level(a);
    const level_b = level(b);
    const diff = level_a - level_b;
    if (diff !== 0) {
        return diff;
    }

    // Sort equivalent PM names alphabetically
    const person_a = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(a);
    const person_b = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(b);

    const full_name_a = person_a ? person_a.full_name : "";
    const full_name_b = person_b ? person_b.full_name : "";

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(full_name_a, full_name_b);
}

function sort_users(user_ids) {
    // TODO sort by unread count first, once we support that
    user_ids.sort(compare_function);
    return user_ids;
}

function get_num_unread(user_id) {
    return _unread__WEBPACK_IMPORTED_MODULE_6__.num_unread_for_user_ids_string(user_id.toString());
}

function user_last_seen_time_status(user_id) {
    const status = _presence__WEBPACK_IMPORTED_MODULE_5__.get_status(user_id);
    if (status === "active") {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Active now"});
    }

    if (status === "idle") {
        // When we complete our presence API rewrite to have the data
        // plumbed, we may want to change this to also mention when
        // they were last active.
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Idle"});
    }

    const last_active_date = _presence__WEBPACK_IMPORTED_MODULE_5__.last_active_date(user_id);
    let last_seen;
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // We don't send presence data to clients in Zephyr mirroring realms
        last_seen = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unknown"});
    } else if (last_active_date === undefined) {
        // There are situations where the client has incomplete presence
        // history on a user.  This can happen when users are deactivated,
        // or when they just haven't been present in a long time (and we
        // may have queries on presence that go back only N weeks).
        //
        // We give this vague status for such users; we will get to
        // delete this code when we finish rewriting the presence API.
        last_seen = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "More than 2 weeks ago"});
    } else {
        last_seen = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_active_date);
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Last active: {last_seen}"}, {last_seen});
}

function info_for(user_id) {
    const user_circle_class = get_user_circle_class(user_id);
    const person = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_id);

    const status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(user_id);
    const status_text = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id);
    const user_list_style_value = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const user_list_style = {
        COMPACT: user_list_style_value === 1,
        WITH_STATUS: user_list_style_value === 2,
        WITH_AVATAR: user_list_style_value === 3,
    };

    return {
        href: _hash_util__WEBPACK_IMPORTED_MODULE_2__.pm_with_url(person.email),
        name: person.full_name,
        user_id,
        status_emoji_info,
        is_current_user: _people__WEBPACK_IMPORTED_MODULE_4__.is_my_user_id(user_id),
        num_unread: get_num_unread(user_id),
        user_circle_class,
        status_text,
        user_list_style,
    };
}

function get_title_data(user_ids_string, is_group) {
    if (is_group === true) {
        // For groups, just return a string with recipient names.
        return {
            first_line: _people__WEBPACK_IMPORTED_MODULE_4__.get_recipients(user_ids_string),
            second_line: "",
            third_line: "",
        };
    }

    // Since it's not a group, user_ids_string is a single user ID.
    const user_id = Number.parseInt(user_ids_string, 10);
    const person = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_id);

    if (person.is_bot) {
        const bot_owner = _people__WEBPACK_IMPORTED_MODULE_4__.get_bot_owner_user(person);

        if (bot_owner) {
            const bot_owner_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Owner: {name}"},
                {name: bot_owner.full_name},
            );

            return {
                first_line: person.full_name,
                second_line: bot_owner_name,
                third_line: "",
            };
        }

        // Bot does not have an owner.
        return {
            first_line: person.full_name,
            second_line: "",
            third_line: "",
        };
    }

    // For buddy list and individual PMS.  Since is_group=False, it's
    // a single, human, user.
    const last_seen = user_last_seen_time_status(user_id);
    const is_my_user = _people__WEBPACK_IMPORTED_MODULE_4__.is_my_user_id(user_id);

    // Users has a status.
    if (_user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id)) {
        return {
            first_line: person.full_name,
            second_line: _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id),
            third_line: last_seen,
            show_you: is_my_user,
        };
    }

    // Users does not have a status.
    return {
        first_line: person.full_name,
        second_line: last_seen,
        third_line: "",
        show_you: is_my_user,
    };
}

function get_item(user_id) {
    const info = info_for(user_id);
    _compose_fade_users__WEBPACK_IMPORTED_MODULE_1__.update_user_info([info], fade_config);
    return info;
}

function get_items_for_users(user_ids) {
    const user_info = user_ids.map((user_id) => info_for(user_id));
    _compose_fade_users__WEBPACK_IMPORTED_MODULE_1__.update_user_info(user_info, fade_config);
    return user_info;
}

function user_is_recently_active(user_id) {
    // return true if the user has a green/orange circle
    return level(user_id) <= 2;
}

function maybe_shrink_list(user_ids, user_filter_text) {
    if (user_ids.length <= max_size_before_shrinking) {
        return user_ids;
    }

    if (user_filter_text) {
        // If the user types something, we want to show all
        // users matching the text, even if they have not been
        // online recently.
        // For super common letters like "s", we may
        // eventually want to filter down to only users that
        // are in presence.get_user_ids().
        return user_ids;
    }

    user_ids = user_ids.filter((user_id) => user_is_recently_active(user_id));

    return user_ids;
}

function filter_user_ids(user_filter_text, user_ids) {
    // This first filter is for whether the user is eligible to be
    // displayed in the right sidebar at all.
    user_ids = user_ids.filter((user_id) => {
        const person = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_id);

        if (!person) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Got user_id in presence but not people: " + user_id);
            return false;
        }

        if (person.is_bot) {
            // Bots should never appear in the right sidebar.  This
            // case should never happen, since bots cannot have
            // presence data.
            return false;
        }

        if (_muted_users__WEBPACK_IMPORTED_MODULE_3__.is_user_muted(user_id)) {
            // Muted users are hidden from the right sidebar entirely.
            return false;
        }

        return true;
    });

    if (!user_filter_text) {
        return user_ids;
    }

    // If a query is present in "Search people", we return matches.
    user_ids = user_ids.filter((user_id) => !_people__WEBPACK_IMPORTED_MODULE_4__.is_my_user_id(user_id));

    let search_terms = user_filter_text.toLowerCase().split(/[,|]+/);
    search_terms = search_terms.map((s) => s.trim());

    const persons = user_ids.map((user_id) => _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_id));

    const user_id_dict = _people__WEBPACK_IMPORTED_MODULE_4__.filter_people_by_search_terms(persons, search_terms);

    return Array.from(user_id_dict.keys());
}

function get_filtered_user_id_list(user_filter_text) {
    let base_user_id_list;

    if (user_filter_text) {
        // If there's a filter, select from all users, not just those
        // recently active.
        base_user_id_list = _people__WEBPACK_IMPORTED_MODULE_4__.get_active_user_ids();
    } else {
        // From large realms, the user_ids in presence may exclude
        // users who have been idle more than three weeks.  When the
        // filter text is blank, we show only those recently active users.
        base_user_id_list = _presence__WEBPACK_IMPORTED_MODULE_5__.get_user_ids();

        // Always include ourselves, even if we're "unavailable".
        const my_user_id = _people__WEBPACK_IMPORTED_MODULE_4__.my_current_user_id();
        if (!base_user_id_list.includes(my_user_id)) {
            base_user_id_list = [my_user_id, ...base_user_id_list];
        }
    }

    const user_ids = filter_user_ids(user_filter_text, base_user_id_list);
    return user_ids;
}

function get_filtered_and_sorted_user_ids(user_filter_text) {
    let user_ids;
    user_ids = get_filtered_user_id_list(user_filter_text);
    user_ids = maybe_shrink_list(user_ids, user_filter_text);
    return sort_users(user_ids);
}

function matches_filter(user_filter_text, user_id) {
    // This is a roundabout way of checking a user if you look
    // too hard at it, but it should be fine for now.
    return filter_user_ids(user_filter_text, [user_id]).length === 1;
}


/***/ }),

/***/ "./static/js/buddy_list.js":
/*!*********************************!*\
  !*** ./static/js/buddy_list.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "BuddyList": () => (/* binding */ BuddyList),
/* harmony export */   "buddy_list": () => (/* binding */ buddy_list)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_presence_row_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/presence_row.hbs */ "./static/templates/presence_row.hbs");
/* harmony import */ var _templates_presence_row_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_presence_row_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_presence_rows_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/presence_rows.hbs */ "./static/templates/presence_rows.hbs");
/* harmony import */ var _templates_presence_rows_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_presence_rows_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './padded_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");











class BuddyListConf {
    container_sel = "#user_presences";
    scroll_container_sel = "#buddy_list_wrapper";
    item_sel = "li.user_sidebar_entry";
    padding_sel = "#buddy_list_wrapper_padding";

    items_to_html(opts) {
        const html = _templates_presence_rows_hbs__WEBPACK_IMPORTED_MODULE_2___default()({presence_rows: opts.items});
        return html;
    }

    item_to_html(opts) {
        const html = _templates_presence_row_hbs__WEBPACK_IMPORTED_MODULE_1___default()(opts.item);
        return html;
    }

    get_li_from_key(opts) {
        const user_id = opts.key;
        const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.container_sel);
        return $container.find(`${this.item_sel}[data-user-id='${CSS.escape(user_id)}']`);
    }

    get_key_from_li(opts) {
        return Number.parseInt(opts.$li.expectOne().attr("data-user-id"), 10);
    }

    get_data_from_keys(opts) {
        const keys = opts.keys;
        const data = _buddy_data__WEBPACK_IMPORTED_MODULE_4__.get_items_for_users(keys);
        return data;
    }

    compare_function = _buddy_data__WEBPACK_IMPORTED_MODULE_4__.compare_function;

    height_to_fill() {
        // Because the buddy list gets sized dynamically, we err on the side
        // of using the height of the entire viewport for deciding
        // how much content to render.  Even on tall monitors this should
        // still be a significant optimization for orgs with thousands of
        // users.
        const height = _message_viewport__WEBPACK_IMPORTED_MODULE_5__.height();
        return height;
    }
}

class BuddyList extends BuddyListConf {
    keys = [];

    populate(opts) {
        this.render_count = 0;
        this.$container.empty();

        // We rely on our caller to give us items
        // in already-sorted order.
        this.keys = opts.keys;

        this.fill_screen_with_content();
    }

    render_more(opts) {
        const chunk_size = opts.chunk_size;

        const begin = this.render_count;
        const end = begin + chunk_size;

        const more_keys = this.keys.slice(begin, end);

        if (more_keys.length === 0) {
            return;
        }

        const items = this.get_data_from_keys({
            keys: more_keys,
        });

        const html = this.items_to_html({
            items,
        });
        this.$container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.container_sel);
        this.$container.append(html);

        // Invariant: more_keys.length >= items.length.
        // (Usually they're the same, but occasionally keys
        // won't return valid items.  Even though we don't
        // actually render these keys, we still "count" them
        // as rendered.

        this.render_count += more_keys.length;
        this.update_padding();
    }

    get_items() {
        const $obj = this.$container.find(`${this.item_sel}`);
        return $obj.map((i, elem) => jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem));
    }

    first_key() {
        return this.keys[0];
    }

    prev_key(key) {
        const i = this.keys.indexOf(key);

        if (i <= 0) {
            return undefined;
        }

        return this.keys[i - 1];
    }

    next_key(key) {
        const i = this.keys.indexOf(key);

        if (i < 0) {
            return undefined;
        }

        return this.keys[i + 1];
    }

    maybe_remove_key(opts) {
        const pos = this.keys.indexOf(opts.key);

        if (pos < 0) {
            return;
        }

        this.keys.splice(pos, 1);

        if (pos < this.render_count) {
            this.render_count -= 1;
            const $li = this.find_li({key: opts.key});
            $li.remove();
            this.update_padding();
        }
    }

    find_position(opts) {
        const key = opts.key;
        let i;

        for (i = 0; i < this.keys.length; i += 1) {
            const list_key = this.keys[i];

            if (this.compare_function(key, list_key) < 0) {
                return i;
            }
        }

        return this.keys.length;
    }

    force_render(opts) {
        const pos = opts.pos;

        // Try to render a bit optimistically here.
        const cushion_size = 3;
        const chunk_size = pos + cushion_size - this.render_count;

        if (chunk_size <= 0) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("cannot show key at this position: " + pos);
        }

        this.render_more({
            chunk_size,
        });
    }

    find_li(opts) {
        const key = opts.key;

        // Try direct DOM lookup first for speed.
        let $li = this.get_li_from_key({
            key,
        });

        if ($li.length === 1) {
            return $li;
        }

        if (!opts.force_render) {
            // Most callers don't force us to render a list
            // item that wouldn't be on-screen anyway.
            return $li;
        }

        const pos = this.keys.indexOf(key);

        if (pos < 0) {
            // TODO: See ListCursor.get_row() for why this is
            //       a bit janky now.
            return [];
        }

        this.force_render({
            pos,
        });

        $li = this.get_li_from_key({
            key,
        });

        return $li;
    }

    insert_new_html(opts) {
        const new_key = opts.new_key;
        const html = opts.html;
        const pos = opts.pos;

        if (new_key === undefined) {
            if (pos === this.render_count) {
                this.render_count += 1;
                this.$container.append(html);
                this.update_padding();
            }
            return;
        }

        if (pos < this.render_count) {
            this.render_count += 1;
            const $li = this.find_li({key: new_key});
            $li.before(html);
            this.update_padding();
        }
    }

    insert_or_move(opts) {
        const key = opts.key;
        const item = opts.item;

        this.maybe_remove_key({key});

        const pos = this.find_position({
            key,
        });

        // Order is important here--get the new_key
        // before mutating our list.  An undefined value
        // corresponds to appending.
        const new_key = this.keys[pos];

        this.keys.splice(pos, 0, key);

        const html = this.item_to_html({item});
        this.insert_new_html({
            pos,
            html,
            new_key,
        });
    }

    fill_screen_with_content() {
        let height = this.height_to_fill();

        const elem = _ui__WEBPACK_IMPORTED_MODULE_6__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.scroll_container_sel)).expectOne()[0];

        // Add a fudge factor.
        height += 10;

        while (this.render_count < this.keys.length) {
            const padding_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.padding_sel).height();
            const bottom_offset = elem.scrollHeight - elem.scrollTop - padding_height;

            if (bottom_offset > height) {
                break;
            }

            const chunk_size = 20;

            this.render_more({
                chunk_size,
            });
        }
    }

    // This is a bit of a hack to make sure we at least have
    // an empty list to start, before we get the initial payload.
    $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.container_sel);

    start_scroll_handler() {
        // We have our caller explicitly call this to make
        // sure everything's in place.
        const $scroll_container = _ui__WEBPACK_IMPORTED_MODULE_6__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.scroll_container_sel));

        $scroll_container.on("scroll", () => {
            this.fill_screen_with_content();
        });
    }

    update_padding() {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './padded_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            shown_rows: this.render_count,
            total_rows: this.keys.length,
            content_sel: this.container_sel,
            padding_sel: this.padding_sel,
        });
    }
}

const buddy_list = new BuddyList();


/***/ }),

/***/ "./static/js/channel.js":
/*!******************************!*\
  !*** ./static/js/channel.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "del": () => (/* binding */ del),
/* harmony export */   "get": () => (/* binding */ get),
/* harmony export */   "password_changes": () => (/* binding */ password_changes),
/* harmony export */   "patch": () => (/* binding */ patch),
/* harmony export */   "post": () => (/* binding */ post),
/* harmony export */   "put": () => (/* binding */ put),
/* harmony export */   "set_password_change_in_progress": () => (/* binding */ set_password_change_in_progress),
/* harmony export */   "xhr_error_message": () => (/* binding */ xhr_error_message)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");







let password_change_in_progress = false;
let password_changes = 0;

function set_password_change_in_progress(value) {
    password_change_in_progress = value;
    if (!value) {
        password_changes += 1;
    }
}

function call(args) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() && !args.ignore_reload) {
        // If we're in the process of reloading, most HTTP requests
        // are useless, with exceptions like cleaning up our event
        // queue and blueslip (Which doesn't use channel.js).
        return undefined;
    }

    // Remember the number of completed password changes when the
    // request was initiated. This allows us to detect race
    // situations where a password change occurred before we got a
    // response that failed due to the ongoing password change.
    const orig_password_changes = password_changes;

    // Wrap the error handlers to reload the page if we get a CSRF error
    // (What probably happened is that the user logged out in another tab).
    let orig_error = args.error;
    if (orig_error === undefined) {
        orig_error = function () {};
    }
    args.error = function wrapped_error(xhr, error_type, xhn) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
            // If we're in the process of reloading the browser,
            // there's no point in running the error handler,
            // because all of our state is about to be discarded
            // anyway.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Ignoring ${args.type} ${args.url} error response while reloading`);
            return;
        }

        if (xhr.status === 401) {
            if (password_change_in_progress || orig_password_changes !== password_changes) {
                // The backend for handling password change API requests
                // will replace the user's session; this results in a
                // brief race where any API request will fail with a 401
                // error after the old session is deactivated but before
                // the new one has been propagated to the browser.  So we
                // skip our normal HTTP 401 error handling if we're in the
                // process of executing a password change.
                return;
            }

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // In theory, the spectator implementation should be
                // designed to prevent accessing widgets that would
                // make network requests not available to spectators.
                //
                // In the case that we have a bug in that logic, we
                // prefer the user experience of offering the
                // login_to_access widget over reloading the page.
                _spectators__WEBPACK_IMPORTED_MODULE_2__.login_to_access();
            } else {
                // We got logged out somehow, perhaps from another window
                // changing the user's password, or a session timeout.  We
                // could display an error message, but jumping right to
                // the login page conveys the same information with a
                // smoother relogin experience.
                window.location.replace(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            }
        } else if (xhr.status === 403) {
            try {
                if (
                    JSON.parse(xhr.responseText).code === "CSRF_FAILED" &&
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined
                ) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
                }
            } catch (error) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Unexpected 403 response from server",
                    {xhr: xhr.responseText, args},
                    error.stack,
                );
            }
        }
        orig_error(xhr, error_type, xhn);
    };
    let orig_success = args.success;
    if (orig_success === undefined) {
        orig_success = function () {};
    }
    args.success = function wrapped_success(data, textStatus, jqXHR) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
            // If we're in the process of reloading the browser,
            // there's no point in running the success handler,
            // because all of our state is about to be discarded
            // anyway.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Ignoring ${args.type} ${args.url} response while reloading`);
            return;
        }

        orig_success(data, textStatus, jqXHR);
    };

    return jquery__WEBPACK_IMPORTED_MODULE_0___default().ajax(args);
}

function get(options) {
    const args = {type: "GET", dataType: "json", ...options};
    return call(args);
}

function post(options) {
    const args = {type: "POST", dataType: "json", ...options};
    return call(args);
}

function put(options) {
    const args = {type: "PUT", dataType: "json", ...options};
    return call(args);
}

// Not called exports.delete because delete is a reserved word in JS
function del(options) {
    const args = {type: "DELETE", dataType: "json", ...options};
    return call(args);
}

function patch(options) {
    // Send a PATCH as a POST in order to work around QtWebkit
    // (Linux/Windows desktop app) not supporting PATCH body.
    if (options.processData === false) {
        // If we're submitting a FormData object, we need to add the
        // method this way
        options.data.append("method", "PATCH");
    } else {
        options.data = {...options.data, method: "PATCH"};
    }
    return post(options);
}

function xhr_error_message(message, xhr) {
    if (xhr.status.toString().charAt(0) === "4") {
        // Only display the error response for 4XX, where we've crafted
        // a nice response.
        message += ": " + JSON.parse(xhr.responseText).msg;
    }
    return message;
}


/***/ }),

/***/ "./static/js/compose.js":
/*!******************************!*\
  !*** ./static/js/compose.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "abort_video_callbacks": () => (/* binding */ abort_video_callbacks),
/* harmony export */   "abort_xhr": () => (/* binding */ abort_xhr),
/* harmony export */   "clear_compose_box": () => (/* binding */ clear_compose_box),
/* harmony export */   "clear_invites": () => (/* binding */ clear_invites),
/* harmony export */   "clear_preview_area": () => (/* binding */ clear_preview_area),
/* harmony export */   "clear_private_stream_alert": () => (/* binding */ clear_private_stream_alert),
/* harmony export */   "compute_show_video_chat_button": () => (/* binding */ compute_show_video_chat_button),
/* harmony export */   "create_message_object": () => (/* binding */ create_message_object),
/* harmony export */   "do_post_send_tasks": () => (/* binding */ do_post_send_tasks),
/* harmony export */   "empty_topic_placeholder": () => (/* binding */ empty_topic_placeholder),
/* harmony export */   "enter_with_preview_open": () => (/* binding */ enter_with_preview_open),
/* harmony export */   "finish": () => (/* binding */ finish),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "render_and_show_preview": () => (/* binding */ render_and_show_preview),
/* harmony export */   "send_message": () => (/* binding */ send_message),
/* harmony export */   "send_message_success": () => (/* binding */ send_message_success),
/* harmony export */   "update_email": () => (/* binding */ update_email),
/* harmony export */   "update_on_recipient_change": () => (/* binding */ update_on_recipient_change),
/* harmony export */   "update_video_chat_button_display": () => (/* binding */ update_video_chat_button_display),
/* harmony export */   "video_call_xhrs": () => (/* binding */ video_call_xhrs),
/* harmony export */   "zoom_token_callbacks": () => (/* binding */ zoom_token_callbacks)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_closed_ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_closed_ui */ "./static/js/compose_closed_ui.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _compose_validate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_validate */ "./static/js/compose_validate.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _echo__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./echo */ "./static/js/echo.js");
/* harmony import */ var _flatpickr__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./flatpickr */ "./static/js/flatpickr.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _reminder__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./reminder */ "./static/js/reminder.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _sent_messages__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./sent_messages */ "./static/js/sent_messages.js");
/* harmony import */ var _server_events__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./server_events */ "./static/js/server_events.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _subscriber_api__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./subscriber_api */ "./static/js/subscriber_api.js");
/* harmony import */ var _transmit__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./transmit */ "./static/js/transmit.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _upload__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./upload */ "./static/js/upload.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _zcommand__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./zcommand */ "./static/js/zcommand.js");









































// Docs: https://zulip.readthedocs.io/en/latest/subsystems/sending-messages.html

/* Track the state of the @all warning. The user must acknowledge that they are spamming the entire
   stream before the warning will go away. If they try to send before explicitly dismissing the
   warning, they will get an error message too.

   undefined: no @all/@everyone in message;
   false: user typed @all/@everyone;
   true: user clicked YES */

let uppy;

function compute_show_video_chat_button() {
    const available_providers = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === available_providers.disabled.id) {
        return false;
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === available_providers.jitsi_meet.id &&
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return false;
    }

    return true;
}

function update_video_chat_button_display() {
    const show_video_chat_button = compute_show_video_chat_button();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#below-compose-content .video_link").toggle(show_video_chat_button);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message-edit-feature-group .video_link").toggle(show_video_chat_button);
}

function clear_invites() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();
}

function clear_private_stream_alert() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();
}

function clear_preview_area() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").show();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").trigger("focus");
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .undo_markdown_preview").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .preview_message_area").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .preview_content").empty();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .markdown_preview").show();
    autosize__WEBPACK_IMPORTED_MODULE_0__["default"].update(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));
}

function update_fade() {
    if (!_compose_state__WEBPACK_IMPORTED_MODULE_8__.composing()) {
        return;
    }

    const msg_type = _compose_state__WEBPACK_IMPORTED_MODULE_8__.get_message_type();
    _compose_validate__WEBPACK_IMPORTED_MODULE_10__.warn_if_topic_resolved();
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.set_focused_recipient(msg_type);
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_all();
}

function update_on_recipient_change() {
    update_fade();
    _compose_actions__WEBPACK_IMPORTED_MODULE_5__.update_narrow_to_recipient_visibility();
}

function abort_xhr() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button").prop("disabled", false);
    uppy.cancelAll();
}

const zoom_token_callbacks = new Map();
const video_call_xhrs = new Map();

function abort_video_callbacks(edit_message_id = "") {
    zoom_token_callbacks.delete(edit_message_id);
    if (video_call_xhrs.has(edit_message_id)) {
        video_call_xhrs.get(edit_message_id).abort();
        video_call_xhrs.delete(edit_message_id);
    }
}

function empty_topic_placeholder() {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "(no topic)"});
}

function create_message_object() {
    // Topics are optional, and we provide a placeholder if one isn't given.
    let topic = _compose_state__WEBPACK_IMPORTED_MODULE_8__.topic();
    if (topic === "") {
        topic = empty_topic_placeholder();
    }

    // Changes here must also be kept in sync with echo.try_deliver_locally
    const message = {
        type: _compose_state__WEBPACK_IMPORTED_MODULE_8__.get_message_type(),
        content: _compose_state__WEBPACK_IMPORTED_MODULE_8__.message_content(),
        sender_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        queue_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        stream: "",
    };
    message.topic = "";

    if (message.type === "private") {
        // TODO: this should be collapsed with the code in composebox_typeahead.js
        const recipient = _compose_state__WEBPACK_IMPORTED_MODULE_8__.private_message_recipient();
        const emails = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(recipient);
        message.to = emails;
        message.reply_to = recipient;
        message.private_message_recipient = recipient;
        message.to_user_ids = _people__WEBPACK_IMPORTED_MODULE_18__.email_list_to_user_ids_string(emails);

        // Note: The `undefined` case is for situations like the
        // is_zephyr_mirror_realm case where users may be
        // automatically created when you try to send a private
        // message to their email address.
        if (message.to_user_ids !== undefined) {
            message.to = _people__WEBPACK_IMPORTED_MODULE_18__.user_ids_string_to_ids_array(message.to_user_ids);
        }
    } else {
        const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_8__.stream_name();
        message.stream = stream_name;
        const sub = _stream_data__WEBPACK_IMPORTED_MODULE_25__.get_sub(stream_name);
        if (sub) {
            message.stream_id = sub.stream_id;
            message.to = sub.stream_id;
        } else {
            // We should be validating streams in calling code.  We'll
            // try to fall back to stream_name here just in case the
            // user started composing to the old stream name and
            // manually entered the stream name, and it got past
            // validation. We should try to kill this code off eventually.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to send message with bad stream name: " + stream_name);
            message.to = stream_name;
        }
        message.topic = topic;
    }
    return message;
}

function clear_compose_box() {
    /* Before clearing the compose box, we reset it to the
     * default/normal size. Note that for locally echoed messages, we
     * will have already done this action before echoing the message
     * to avoid the compose box triggering "new message out of view"
     * notifications incorrectly. */
    if (_compose_ui__WEBPACK_IMPORTED_MODULE_9__.is_full_size()) {
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.make_compose_box_original_size();
    }
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").val("").trigger("focus");
    _compose_validate__WEBPACK_IMPORTED_MODULE_10__.check_overflow_text();
    _compose_validate__WEBPACK_IMPORTED_MODULE_10__.clear_topic_resolved_warning();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").removeData("draft-id");
    _compose_ui__WEBPACK_IMPORTED_MODULE_9__.autosize_textarea(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-status").hide(0);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    _compose_ui__WEBPACK_IMPORTED_MODULE_9__.hide_compose_spinner();
}

function send_message_success(local_id, message_id, locally_echoed) {
    if (!locally_echoed) {
        clear_compose_box();
    }

    _echo__WEBPACK_IMPORTED_MODULE_12__.reify_message_id(local_id, message_id);
}

function send_message(request = create_message_object()) {
    if (request.type === "private") {
        request.to = JSON.stringify(request.to);
    } else {
        request.to = JSON.stringify([request.to]);
    }

    let local_id;
    let locally_echoed;

    const message = _echo__WEBPACK_IMPORTED_MODULE_12__.try_deliver_locally(request);
    if (message) {
        // We are rendering this message locally with an id
        // like 92l99.01 that corresponds to a reasonable
        // approximation of the id we'll get from the server
        // in terms of sorting messages.
        local_id = message.local_id;
        locally_echoed = true;
    } else {
        // We are not rendering this message locally, but we
        // track the message's life cycle with an id like
        // loc-1, loc-2, loc-3,etc.
        locally_echoed = false;
        local_id = _sent_messages__WEBPACK_IMPORTED_MODULE_23__.get_new_local_id();
    }

    request.local_id = local_id;

    _sent_messages__WEBPACK_IMPORTED_MODULE_23__.start_tracking_message({
        local_id,
        locally_echoed,
    });

    request.locally_echoed = locally_echoed;

    function success(data) {
        send_message_success(local_id, data.id, locally_echoed);
    }

    function error(response) {
        // If we're not local echo'ing messages, or if this message was not
        // locally echoed, show error in compose box
        if (!locally_echoed) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                response,
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"),
            );
            return;
        }

        _echo__WEBPACK_IMPORTED_MODULE_12__.message_send_error(message.id, response);

        // We might not have updated the draft count because we assumed the
        // message would send. Ensure that the displayed count is correct.
        _drafts__WEBPACK_IMPORTED_MODULE_11__.sync_count();
    }

    _transmit__WEBPACK_IMPORTED_MODULE_28__.send_message(request, success, error);
    _server_events__WEBPACK_IMPORTED_MODULE_24__.assert_get_events_running(
        "Restarting get_events because it was not running during send",
    );

    if (locally_echoed) {
        clear_compose_box();
    }
}

function enter_with_preview_open(ctrl_pressed = false) {
    if (
        (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !ctrl_pressed) ||
        (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && ctrl_pressed)
    ) {
        // If this enter should send, we attempt to send the message.
        finish();
    } else {
        // Otherwise, we return to the normal compose state.
        clear_preview_area();
    }
}

function finish() {
    clear_preview_area();
    clear_invites();
    clear_private_stream_alert();
    _notifications__WEBPACK_IMPORTED_MODULE_17__.clear_compose_notifications();

    const message_content = _compose_state__WEBPACK_IMPORTED_MODULE_8__.message_content();

    // Skip normal validation for zcommands, since they aren't
    // actual messages with recipients; users only send them
    // from the compose box for convenience sake.
    if (_zcommand__WEBPACK_IMPORTED_MODULE_30__.process(message_content)) {
        do_post_send_tasks();
        clear_compose_box();
        return undefined;
    }

    _compose_ui__WEBPACK_IMPORTED_MODULE_9__.show_compose_spinner();

    if (!_compose_validate__WEBPACK_IMPORTED_MODULE_10__.validate()) {
        // If the message failed validation, hide compose spinner.
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.hide_compose_spinner();
        return false;
    }

    if (_reminder__WEBPACK_IMPORTED_MODULE_19__.is_deferred_delivery(message_content)) {
        _reminder__WEBPACK_IMPORTED_MODULE_19__.schedule_message();
    } else {
        send_message();
    }
    do_post_send_tasks();
    return true;
}

function do_post_send_tasks() {
    clear_preview_area();
    // TODO: Do we want to fire the event even if the send failed due
    // to a server-side error?
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(document).trigger("compose_finished.zulip");
}

function update_email(user_id, new_email) {
    let reply_to = _compose_state__WEBPACK_IMPORTED_MODULE_8__.private_message_recipient();

    if (!reply_to) {
        return;
    }

    reply_to = _people__WEBPACK_IMPORTED_MODULE_18__.update_email_in_reply_to(reply_to, user_id, new_email);

    _compose_state__WEBPACK_IMPORTED_MODULE_8__.private_message_recipient(reply_to);
}

function insert_video_call_url(url, target_textarea) {
    const link_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Click to join video call"});
    _compose_ui__WEBPACK_IMPORTED_MODULE_9__.insert_syntax_and_focus(`[${link_text}](${url})`, target_textarea);
}

function render_and_show_preview($preview_spinner, $preview_content_box, content) {
    function show_preview(rendered_content, raw_content) {
        // content is passed to check for status messages ("/me ...")
        // and will be undefined in case of errors
        let rendered_preview_html;
        if (raw_content !== undefined && _markdown__WEBPACK_IMPORTED_MODULE_14__.is_status_message(raw_content)) {
            // Handle previews of /me messages
            rendered_preview_html =
                "<p><strong>" +
                lodash__WEBPACK_IMPORTED_MODULE_2___default().escape(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) +
                "</strong>" +
                rendered_content.slice("<p>/me".length);
        } else {
            rendered_preview_html = rendered_content;
        }

        $preview_content_box.html(Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(rendered_preview_html));
        _rendered_markdown__WEBPACK_IMPORTED_MODULE_20__.update_elements($preview_content_box);
    }

    if (content.length === 0) {
        show_preview(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Nothing to preview"}));
    } else {
        if (_markdown__WEBPACK_IMPORTED_MODULE_14__.contains_backend_only_syntax(content)) {
            const $spinner = $preview_spinner.expectOne();
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
        } else {
            // For messages that don't appear to contain syntax that
            // is only supported by our backend Markdown processor, we
            // render using the frontend Markdown processor (but still
            // render server-side to ensure the preview is accurate;
            // if the `markdown.contains_backend_only_syntax` logic is
            // wrong, users will see a brief flicker of the locally
            // echoed frontend rendering before receiving the
            // authoritative backend rendering from the server).
            const message_obj = {
                raw_content: content,
            };
            _markdown__WEBPACK_IMPORTED_MODULE_14__.apply_markdown(message_obj);
        }
        _channel__WEBPACK_IMPORTED_MODULE_4__.post({
            url: "/json/messages/render",
            data: {content},
            success(response_data) {
                if (_markdown__WEBPACK_IMPORTED_MODULE_14__.contains_backend_only_syntax(content)) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($preview_spinner);
                }
                show_preview(response_data.rendered, content);
            },
            error() {
                if (_markdown__WEBPACK_IMPORTED_MODULE_14__.contains_backend_only_syntax(content)) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($preview_spinner);
                }
                show_preview(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed to generate preview"}));
            },
        });
    }
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#below-compose-content .video_link").toggle(compute_show_video_chat_button());
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(
        "#stream_message_recipient_stream,#stream_message_recipient_topic,#private_message_recipient",
    ).on("keyup", update_on_recipient_change);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(
        "#stream_message_recipient_stream,#stream_message_recipient_topic,#private_message_recipient",
    ).on("change", update_on_recipient_change);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").on("keydown", (event) => {
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.handle_keydown(event, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").expectOne());
    });
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").on("keyup", (event) => {
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.handle_keyup(event, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").expectOne());
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").on("input propertychange", () => {
        _compose_validate__WEBPACK_IMPORTED_MODULE_10__.warn_if_topic_resolved(false);
        const compose_text_length = _compose_validate__WEBPACK_IMPORTED_MODULE_10__.check_overflow_text();
        // Change compose close button tooltip as per condition.
        // We save compose text in draft only if its length is > 2.
        if (compose_text_length > 2) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_close").attr("data-tooltip-template-id", "compose_close_and_save_tooltip");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_close").attr("data-tooltip-template-id", "compose_close_tooltip");
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose form").on("submit", (e) => {
        e.preventDefault();
        finish();
    });

    _resize__WEBPACK_IMPORTED_MODULE_21__.watch_manual_resize("#compose-textarea");

    // Update position of scroll to bottom button based on
    // height of the compose box.
    const update_scroll_to_bottom_position = new ResizeObserver(() => {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#scroll-to-bottom-button-container").css("bottom", jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").outerHeight());
    });
    update_scroll_to_bottom_position.observe(document.querySelector("#compose"));

    _upload__WEBPACK_IMPORTED_MODULE_29__.feature_check(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .compose_upload_file"));

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_banners").on(
        "click",
        `.${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())} .compose_banner_action_button`,
        (event) => {
            event.preventDefault();
            _compose_validate__WEBPACK_IMPORTED_MODULE_10__.clear_wildcard_warnings();
            _compose_validate__WEBPACK_IMPORTED_MODULE_10__.set_user_acknowledged_wildcard_flag(true);
            finish();
        },
    );

    const user_not_subscribed_classname = `.${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`;
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_banners").on(
        "click",
        `${user_not_subscribed_classname} .compose_banner_action_button`,
        (event) => {
            event.preventDefault();

            const stream_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_message_recipient_stream").val();
            if (stream_name === undefined) {
                return;
            }
            const sub = _stream_data__WEBPACK_IMPORTED_MODULE_25__.get_sub(stream_name);
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_26__.sub_or_unsub(sub);
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(user_not_subscribed_classname).remove();
        },
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_banners").on(
        "click",
        `.${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())} .compose_banner_action_button`,
        (event) => {
            event.preventDefault();

            const $target = jquery__WEBPACK_IMPORTED_MODULE_1___default()(event.target).parents(".compose_banner");
            const stream_id = Number.parseInt($target.attr("data-stream-id"), 10);
            const topic_name = $target.attr("data-topic-name");

            _message_edit__WEBPACK_IMPORTED_MODULE_15__.with_first_message_id(stream_id, topic_name, (message_id) => {
                _message_edit__WEBPACK_IMPORTED_MODULE_15__.toggle_resolve_topic(message_id, topic_name);
                _compose_validate__WEBPACK_IMPORTED_MODULE_10__.clear_topic_resolved_warning(true);
            });
        },
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_banners").on(
        "click",
        `.${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())} .compose_banner_action_button`,
        (event) => {
            event.preventDefault();

            const $invite_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(event.target).parents(".compose_banner");

            const user_id = Number.parseInt($invite_row.data("user-id"), 10);
            const stream_id = Number.parseInt($invite_row.data("stream-id"), 10);

            function success() {
                $invite_row.remove();
            }

            function failure(error_msg) {
                clear_invites();
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    error_msg,
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"),
                );
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(event.target).prop("disabled", true);
            }

            function xhr_failure(xhr) {
                const error = JSON.parse(xhr.responseText);
                failure(error.msg);
            }

            const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

            _subscriber_api__WEBPACK_IMPORTED_MODULE_27__.add_user_ids_to_stream([user_id], sub, success, xhr_failure);
        },
    );

    for (const classname of Object.values(Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))) {
        const classname_selector = `.${classname}`;
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_banners").on(
            "click",
            `${classname_selector} .compose_banner_close_button`,
            (event) => {
                event.preventDefault();
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(event.target).parents(classname_selector).remove();
            },
        );
    }

    // Click event binding for "Attach files" button
    // Triggers a click on a hidden file input field

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".compose_upload_file", (e) => {
        e.preventDefault();
        e.stopPropagation();

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .file_input").trigger("click");
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".video_link", (e) => {
        e.preventDefault();
        e.stopPropagation();

        let $target_textarea;
        let edit_message_id;
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents(".message_edit_form").length === 1) {
            edit_message_id = _rows__WEBPACK_IMPORTED_MODULE_22__.id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents(".message_row"));
            $target_textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#edit_form_${CSS.escape(edit_message_id)} .message_edit_content`);
        }

        let video_call_link;
        const available_providers = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        const show_video_chat_button = compute_show_video_chat_button();

        if (!show_video_chat_button) {
            return;
        }

        if (
            available_providers.zoom &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === available_providers.zoom.id
        ) {
            abort_video_callbacks(edit_message_id);
            const key = edit_message_id || "";

            const make_zoom_call = () => {
                video_call_xhrs.set(
                    key,
                    _channel__WEBPACK_IMPORTED_MODULE_4__.post({
                        url: "/json/calls/zoom/create",
                        success(res) {
                            video_call_xhrs.delete(key);
                            insert_video_call_url(res.url, $target_textarea);
                        },
                        error(xhr, status) {
                            video_call_xhrs.delete(key);
                            if (
                                status === "error" &&
                                xhr.responseJSON &&
                                xhr.responseJSON.code === "INVALID_ZOOM_TOKEN"
                            ) {
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = false;
                            }
                            if (status !== "abort") {
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed to create video call."}),
                                );
                            }
                        },
                    }),
                );
            };

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                make_zoom_call();
            } else {
                zoom_token_callbacks.set(key, make_zoom_call);
                window.open(
                    window.location.protocol + "//" + window.location.host + "/calls/zoom/register",
                    "_blank",
                    "width=800,height=500,noopener,noreferrer",
                );
            }
        } else if (
            available_providers.big_blue_button &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === available_providers.big_blue_button.id
        ) {
            const meeting_name = (0,_compose_closed_ui__WEBPACK_IMPORTED_MODULE_6__.get_recipient_label)() + " meeting";
            _channel__WEBPACK_IMPORTED_MODULE_4__.get({
                url: "/json/calls/bigbluebutton/create",
                data: {
                    meeting_name,
                },
                success(response) {
                    insert_video_call_url(response.url, $target_textarea);
                },
            });
        } else {
            const video_call_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(100000000000000, 999999999999999);
            video_call_link = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) + "/" + video_call_id;
            insert_video_call_url(video_call_link, $target_textarea);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".time_pick", (e) => {
        e.preventDefault();
        e.stopPropagation();

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).toggleClass("has_popover");

        let $target_textarea;
        let edit_message_id;
        const compose_click_target = _compose_ui__WEBPACK_IMPORTED_MODULE_9__.get_compose_click_target(e);
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(compose_click_target).parents(".message_edit_form").length === 1) {
            edit_message_id = _rows__WEBPACK_IMPORTED_MODULE_22__.id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(compose_click_target).parents(".message_row"));
            $target_textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#edit_form_${CSS.escape(edit_message_id)} .message_edit_content`);
        } else {
            $target_textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()(compose_click_target).closest("form").find("textarea");
        }

        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).hasClass("has_popover")) {
            const on_timestamp_selection = (val) => {
                const timestr = `<time:${val}> `;
                _compose_ui__WEBPACK_IMPORTED_MODULE_9__.insert_syntax_and_focus(timestr, $target_textarea);
            };

            _flatpickr__WEBPACK_IMPORTED_MODULE_13__.show_flatpickr(
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(compose_click_target)[0],
                on_timestamp_selection,
                new Date(),
                {
                    // place the time picker above the icon and center it horizontally
                    position: "above center",
                },
            );
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".markdown_preview", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const content = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").val();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .markdown_preview").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .undo_markdown_preview").show();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .undo_markdown_preview").trigger("focus");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .preview_message_area").show();

        render_and_show_preview(
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .markdown_preview_spinner"),
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose .preview_content"),
            content,
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".undo_markdown_preview", (e) => {
        e.preventDefault();
        e.stopPropagation();

        clear_preview_area();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".expand_composebox_button", (e) => {
        e.preventDefault();
        e.stopPropagation();

        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.make_compose_box_full_size();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".narrow_to_compose_recipients", (e) => {
        e.preventDefault();
        _narrow__WEBPACK_IMPORTED_MODULE_16__.to_compose_target();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").on("click", ".collapse_composebox_button", (e) => {
        e.preventDefault();
        e.stopPropagation();

        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.make_compose_box_original_size();
    });

    uppy = _upload__WEBPACK_IMPORTED_MODULE_29__.setup_upload({
        mode: "compose",
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").on("focus", () => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_5__.update_placeholder_text();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_message_recipient_topic").on("focus", () => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_5__.update_placeholder_text();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".formatting_button", (e) => {
        const $compose_click_target = jquery__WEBPACK_IMPORTED_MODULE_1___default()(_compose_ui__WEBPACK_IMPORTED_MODULE_9__.get_compose_click_target(e));
        const $textarea = $compose_click_target.closest("form").find("textarea");
        const format_type = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).attr("data-format-type");
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.format_text($textarea, format_type);
        $textarea.trigger("focus");
        e.preventDefault();
        e.stopPropagation();
    });

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.start("stream", {topic: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())});
        } else {
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.start("stream", {});
        }
    }
}


/***/ }),

/***/ "./static/js/compose_actions.js":
/*!**************************************!*\
  !*** ./static/js/compose_actions.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_get_focus_area": () => (/* binding */ _get_focus_area),
/* harmony export */   "autosize_message_content": () => (/* binding */ autosize_message_content),
/* harmony export */   "blur_compose_inputs": () => (/* binding */ blur_compose_inputs),
/* harmony export */   "cancel": () => (/* binding */ cancel),
/* harmony export */   "clear_textarea": () => (/* binding */ clear_textarea),
/* harmony export */   "complete_starting_tasks": () => (/* binding */ complete_starting_tasks),
/* harmony export */   "expand_compose_box": () => (/* binding */ expand_compose_box),
/* harmony export */   "maybe_scroll_up_selected_message": () => (/* binding */ maybe_scroll_up_selected_message),
/* harmony export */   "on_narrow": () => (/* binding */ on_narrow),
/* harmony export */   "on_topic_narrow": () => (/* binding */ on_topic_narrow),
/* harmony export */   "quote_and_reply": () => (/* binding */ quote_and_reply),
/* harmony export */   "reply_with_mention": () => (/* binding */ reply_with_mention),
/* harmony export */   "respond_to_message": () => (/* binding */ respond_to_message),
/* harmony export */   "set_focus": () => (/* binding */ set_focus),
/* harmony export */   "start": () => (/* binding */ start),
/* harmony export */   "update_narrow_to_recipient_visibility": () => (/* binding */ update_narrow_to_recipient_visibility),
/* harmony export */   "update_placeholder_text": () => (/* binding */ update_placeholder_text)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../shared/js/fenced_code */ "./static/shared/js/fenced_code.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_pm_pill__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose_pm_pill */ "./static/js/compose_pm_pill.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _compose_validate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./compose_validate */ "./static/js/compose_validate.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_bar__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./stream_bar */ "./static/js/stream_bar.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



































function blur_compose_inputs() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_comp").find("input, textarea, button, #private_message_recipient").trigger("blur");
}

function hide_box() {
    // This is the main hook for saving drafts when closing the compose box.
    _drafts__WEBPACK_IMPORTED_MODULE_12__.update_draft();
    blur_compose_inputs();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream-message").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private-message").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".new_message_textarea").css("min-height", "");
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.clear_compose();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_comp").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_controls").show();
}

function get_focus_area(msg_type, opts) {
    // Set focus to "Topic" when narrowed to a stream+topic and "New topic" button clicked.
    if (msg_type === "stream" && opts.stream && !opts.topic) {
        return "#stream_message_recipient_topic";
    } else if (
        (msg_type === "stream" && opts.stream) ||
        (msg_type === "private" && opts.private_message_recipient)
    ) {
        if (opts.trigger === "new topic button") {
            return "#stream_message_recipient_topic";
        }
        return "#compose-textarea";
    }

    if (msg_type === "stream") {
        return "#stream_message_recipient_stream";
    }
    return "#private_message_recipient";
}

// Export for testing
const _get_focus_area = get_focus_area;

function set_focus(msg_type, opts) {
    const focus_area = get_focus_area(msg_type, opts);
    if (window.getSelection().toString() === "" || opts.trigger !== "message click") {
        const $elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(focus_area);
        $elt.trigger("focus").trigger("select");
    }
}

function show_compose_box(msg_type, opts) {
    if (msg_type === "stream") {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private-message").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream-message").show();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_toggle").addClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private_message_toggle").removeClass("active");
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private-message").show();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream-message").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_toggle").removeClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private_message_toggle").addClass("active");
    }
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-status").removeClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).hide();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").css({visibility: "visible"});
    // When changing this, edit the 42px in _maybe_autoscroll
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".new_message_textarea").css("min-height", "3em");

    set_focus(msg_type, opts);
}

function clear_textarea() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").find("input[type=text], textarea").val("");
}

function clear_box() {
    _compose__WEBPACK_IMPORTED_MODULE_6__.clear_invites();

    // TODO: Better encapsulate at-mention warnings.
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.clear_topic_resolved_warning();
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.clear_wildcard_warnings();
    _compose__WEBPACK_IMPORTED_MODULE_6__.clear_private_stream_alert();
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.set_user_acknowledged_wildcard_flag(undefined);

    _compose__WEBPACK_IMPORTED_MODULE_6__.clear_preview_area();
    clear_textarea();
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.check_overflow_text();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").removeData("draft-id");
    _compose_ui__WEBPACK_IMPORTED_MODULE_10__.autosize_textarea(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-status").hide(0);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
}

function autosize_message_content() {
    if (!_compose_ui__WEBPACK_IMPORTED_MODULE_10__.is_full_size()) {
        (0,autosize__WEBPACK_IMPORTED_MODULE_0__["default"])(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"), {
            callback() {
                maybe_scroll_up_selected_message();
            },
        });
    }
}

function expand_compose_box() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_close").show();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_controls").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_comp").show();
}

function composing_to_current_topic_narrow() {
    return (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name(), _narrow_state__WEBPACK_IMPORTED_MODULE_16__.stream() || "") &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_compose_state__WEBPACK_IMPORTED_MODULE_9__.topic(), _narrow_state__WEBPACK_IMPORTED_MODULE_16__.topic() || "")
    );
}

function composing_to_current_private_message_narrow() {
    const compose_state_recipient = _compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient();
    const narrow_state_recipient = _narrow_state__WEBPACK_IMPORTED_MODULE_16__.pm_emails_string();
    return (
        compose_state_recipient &&
        narrow_state_recipient &&
        lodash__WEBPACK_IMPORTED_MODULE_2___default().isEqual(
            compose_state_recipient
                .split(",")
                .map((s) => s.trim())
                .sort(),
            narrow_state_recipient
                .split(",")
                .map((s) => s.trim())
                .sort(),
        )
    );
}

function update_narrow_to_recipient_visibility() {
    const message_type = _compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type();
    if (message_type === "stream") {
        const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name();
        const stream_exists = Boolean(_stream_data__WEBPACK_IMPORTED_MODULE_24__.get_stream_id(stream_name));

        if (
            stream_exists &&
            !composing_to_current_topic_narrow() &&
            _compose_state__WEBPACK_IMPORTED_MODULE_9__.has_full_recipient()
        ) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".narrow_to_compose_recipients").toggleClass("invisible", false);
            return;
        }
    } else if (message_type === "private") {
        const recipients = _compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient();
        if (
            recipients &&
            !composing_to_current_private_message_narrow() &&
            _compose_state__WEBPACK_IMPORTED_MODULE_9__.has_full_recipient()
        ) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".narrow_to_compose_recipients").toggleClass("invisible", false);
            return;
        }
    }
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".narrow_to_compose_recipients").toggleClass("invisible", true);
}

function complete_starting_tasks(msg_type, opts) {
    // This is sort of a kitchen sink function, and it's called only
    // by compose.start() for now.  Having this as a separate function
    // makes testing a bit easier.

    maybe_scroll_up_selected_message();
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.start_compose(msg_type);
    _stream_bar__WEBPACK_IMPORTED_MODULE_23__.decorate(opts.stream, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream-message .message_header_stream"), true);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(document).trigger(new (jquery__WEBPACK_IMPORTED_MODULE_1___default().Event)("compose_started.zulip", opts));
    update_placeholder_text();
    update_narrow_to_recipient_visibility();
}

function maybe_scroll_up_selected_message() {
    // If the compose box is obscuring the currently selected message,
    // scroll up until the message is no longer occluded.
    if (_message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_id() === -1) {
        // If there's no selected message, there's no need to
        // scroll the compose box to avoid it.
        return;
    }
    const $selected_row = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_row();

    if ($selected_row.height() > _message_viewport__WEBPACK_IMPORTED_MODULE_15__.height() - 100) {
        // For very tall messages whose height is close to the entire
        // height of the viewport, don't auto-scroll the viewport to
        // the end of the message (since that makes it feel annoying
        // to work with very tall messages).  See #8941 for details.
        return;
    }

    const cover = $selected_row.offset().top + $selected_row.height() - jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").offset().top;
    if (cover > 0) {
        _message_viewport__WEBPACK_IMPORTED_MODULE_15__.user_initiated_animate_scroll(cover + 20);
    }
}

function fill_in_opts_from_current_narrowed_view(msg_type, opts) {
    return {
        message_type: msg_type,
        stream: "",
        topic: "",
        private_message_recipient: "",
        trigger: "unknown",

        // Set default parameters based on the current narrowed view.
        ..._narrow_state__WEBPACK_IMPORTED_MODULE_16__.set_compose_defaults(),

        // Set parameters based on provided opts, overwriting
        // those set based on current narrowed view, if necessary.
        ...opts,
    };
}

function same_recipient_as_before(msg_type, opts) {
    return (
        _compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type() === msg_type &&
        ((msg_type === "stream" &&
            opts.stream === _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name() &&
            opts.topic === _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic()) ||
            (msg_type === "private" &&
                opts.private_message_recipient === _compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient()))
    );
}

function update_placeholder_text() {
    // Change compose placeholder text only if compose box is open.
    if (!jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").is(":visible")) {
        return;
    }

    const opts = {
        message_type: _compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type(),
        stream: _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name(),
        topic: _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic(),
        private_message_recipient: _compose_pm_pill__WEBPACK_IMPORTED_MODULE_8__.get_emails(),
    };

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").attr("placeholder", _compose_ui__WEBPACK_IMPORTED_MODULE_10__.compute_placeholder_text(opts));
}

function start(msg_type, opts) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        _spectators__WEBPACK_IMPORTED_MODULE_22__.login_to_access();
        return;
    }

    // We may be able to clear it to change the recipient, so save any
    // existing content as a draft.
    _drafts__WEBPACK_IMPORTED_MODULE_12__.update_draft();

    autosize_message_content();

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return;
    }
    _notifications__WEBPACK_IMPORTED_MODULE_17__.clear_compose_notifications();
    expand_compose_box();

    opts = fill_in_opts_from_current_narrowed_view(msg_type, opts);

    // If we are invoked by a compose hotkey (c or x) or new topic
    // button, do not assume that we know what the message's topic or
    // PM recipient should be.
    if (
        opts.trigger === "compose_hotkey" ||
        opts.trigger === "new topic button" ||
        opts.trigger === "new private message"
    ) {
        opts.topic = "";
        opts.private_message_recipient = "";
    }

    const subbed_streams = _stream_data__WEBPACK_IMPORTED_MODULE_24__.subscribed_subs();
    if (
        subbed_streams.length === 1 &&
        (opts.trigger === "new topic button" ||
            (opts.trigger === "compose_hotkey" && msg_type === "stream"))
    ) {
        opts.stream = subbed_streams[0].name;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.composing() && !same_recipient_as_before(msg_type, opts)) {
        // Clear the compose box if the existing message is to a different recipient
        clear_box();
    }

    // We set the stream/topic/private_message_recipient
    // unconditionally here, which assumes the caller will have passed
    // '' or undefined for these values if they are not appropriate
    // for this message.
    //
    // TODO: Move these into a conditional on message_type, using an
    // explicit "clear" function for compose_state.
    _compose_state__WEBPACK_IMPORTED_MODULE_9__.set_stream_name(opts.stream);
    _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic(opts.topic);

    // Set the recipients with a space after each comma, so it looks nice.
    _compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient(opts.private_message_recipient.replace(/,\s*/g, ", "));

    // If the user opens the compose box, types some text, and then clicks on a
    // different stream/topic, we want to keep the text in the compose box
    if (opts.content !== undefined) {
        _compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content(opts.content);
    }

    if (opts.draft_id) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").data("draft-id", opts.draft_id);
    }

    _compose_state__WEBPACK_IMPORTED_MODULE_9__.set_message_type(msg_type);

    // Show either stream/topic fields or "You and" field.
    show_compose_box(msg_type, opts);

    // Show a warning if topic is resolved
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.warn_if_topic_resolved(true);

    // Reset the `max-height` property of `compose-textarea` so that the
    // compose-box do not cover the last messages of the current stream
    // while writing a long message.
    _resize__WEBPACK_IMPORTED_MODULE_21__.reset_compose_message_max_height();

    complete_starting_tasks(msg_type, opts);
}

function cancel() {
    // As user closes the compose box, restore the compose box max height
    if (_compose_ui__WEBPACK_IMPORTED_MODULE_10__.is_full_size()) {
        _compose_ui__WEBPACK_IMPORTED_MODULE_10__.make_compose_box_original_size();
    }

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").height(40 + "px");

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
        // Never close the compose box in narrow embedded windows, but
        // at least clear the topic and unfade.
        _compose_fade__WEBPACK_IMPORTED_MODULE_7__.clear_compose();
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
            _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        } else {
            _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic("");
        }
        return;
    }
    hide_box();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose_close").hide();
    clear_box();
    _notifications__WEBPACK_IMPORTED_MODULE_17__.clear_compose_notifications();
    _compose__WEBPACK_IMPORTED_MODULE_6__.abort_xhr();
    _compose__WEBPACK_IMPORTED_MODULE_6__.abort_video_callbacks(undefined);
    _compose_state__WEBPACK_IMPORTED_MODULE_9__.set_message_type(false);
    _compose_pm_pill__WEBPACK_IMPORTED_MODULE_8__.clear();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(document).trigger("compose_canceled.zulip");
}

function respond_to_message(opts) {
    let message;
    let msg_type;
    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_20__.is_visible()) {
        message = _recent_topics_ui__WEBPACK_IMPORTED_MODULE_19__.get_focused_row_message();
        if (message === undefined) {
            // Open empty compose with nothing pre-filled since
            // user is not focused on any table row.
            start("stream", {trigger: "recent_topics_nofocus"});
            return;
        }
    } else {
        message = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_message();

        if (message === undefined) {
            // empty narrow implementation
            if (
                !_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_pm_reply() &&
                !_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_stream_reply() &&
                !_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_topic_reply()
            ) {
                start("stream", {trigger: "empty_narrow_compose"});
                return;
            }
            const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_16__.filter();
            const first_term = current_filter.operators()[0];
            const first_operator = first_term.operator;
            const first_operand = first_term.operand;

            if (first_operator === "stream" && !_stream_data__WEBPACK_IMPORTED_MODULE_24__.is_subscribed_by_name(first_operand)) {
                start("stream", {trigger: "empty_narrow_compose"});
                return;
            }

            // Set msg_type to stream by default in the case of an empty
            // home view.
            msg_type = "stream";
            if (_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_pm_reply()) {
                msg_type = "private";
            }

            const new_opts = fill_in_opts_from_current_narrowed_view(msg_type, opts);
            start(new_opts.message_type, new_opts);
            return;
        }

        if (_message_lists__WEBPACK_IMPORTED_MODULE_14__.current.can_mark_messages_read()) {
            _unread_ops__WEBPACK_IMPORTED_MODULE_25__.notify_server_message_read(message);
        }
    }

    // Important note: A reply_type of 'personal' is for the R hotkey
    // (replying to a message's sender with a private message).  All
    // other replies can just copy message.type.
    if (opts.reply_type === "personal" || message.type === "private") {
        msg_type = "private";
    } else {
        msg_type = message.type;
    }

    let stream = "";
    let topic = "";
    let pm_recipient = "";
    if (msg_type === "stream") {
        stream = message.stream;
        topic = message.topic;
    } else {
        pm_recipient = message.reply_to;
        if (opts.reply_type === "personal") {
            // reply_to for private messages is everyone involved, so for
            // personals replies we need to set the private message
            // recipient to just the sender
            pm_recipient = _people__WEBPACK_IMPORTED_MODULE_18__.get_by_user_id(message.sender_id).email;
        } else {
            pm_recipient = _people__WEBPACK_IMPORTED_MODULE_18__.pm_reply_to(message);
        }
    }

    start(msg_type, {
        stream,
        topic,
        private_message_recipient: pm_recipient,
        trigger: opts.trigger,
    });
}

function reply_with_mention(opts) {
    respond_to_message(opts);
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_message();
    const mention = _people__WEBPACK_IMPORTED_MODULE_18__.get_mention_syntax(message.sender_full_name, message.sender_id);
    _compose_ui__WEBPACK_IMPORTED_MODULE_10__.insert_syntax_and_focus(mention);
}

function on_topic_narrow() {
    if (!_compose_state__WEBPACK_IMPORTED_MODULE_9__.composing()) {
        // If our compose box is closed, then just
        // leave it closed, assuming that the user is
        // catching up on their feed and not actively
        // composing.
        return;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name() !== _narrow_state__WEBPACK_IMPORTED_MODULE_16__.stream()) {
        // If we changed streams, then we only leave the
        // compose box open if there is content.
        if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.has_message_content()) {
            _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_message_list();
            return;
        }

        // Otherwise, avoid a mix.
        cancel();
        return;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.topic() && _compose_state__WEBPACK_IMPORTED_MODULE_9__.has_message_content()) {
        // If the user has written something to a different topic,
        // they probably want that content, so leave compose open.
        //
        // This effectively uses the heuristic of whether there is
        // content in compose to determine whether the user had firmly
        // decided to compose to the old topic or is just looking to
        // reply to what they see.
        _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_message_list();
        return;
    }

    // If we got this far, then the compose box has the correct stream
    // filled in, and either compose is empty or no topic was set, so
    // we should update the compose topic to match the new narrow.
    // See #3300 for context--a couple users specifically asked for
    // this convenience.
    _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic(_narrow_state__WEBPACK_IMPORTED_MODULE_16__.topic());
    _compose_validate__WEBPACK_IMPORTED_MODULE_11__.warn_if_topic_resolved(true);
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.set_focused_recipient("stream");
    _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_message_list();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").trigger("focus");
}

function quote_and_reply(opts) {
    const $textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea");
    const message_id = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_id();
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_message();
    const quoting_placeholder = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "[Quoting…]"});

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.has_message_content()) {
        // The user already started typing a message,
        // so we won't re-open the compose box.
        // (If you did re-open the compose box, you
        // are prone to glitches where you select the
        // text, plus it's a complicated codepath that
        // can have other unintended consequences.)

        if ($textarea.caret() !== 0) {
            // Insert a newline before quoted message if there is
            // already some content in the compose box and quoted
            // message is not being inserted at the beginning.
            $textarea.caret("\n");
        }
    } else {
        respond_to_message(opts);
    }

    _compose_ui__WEBPACK_IMPORTED_MODULE_10__.insert_syntax_and_focus(quoting_placeholder + "\n", $textarea);

    function replace_content(message) {
        // Final message looks like:
        //     @_**Iago|5** [said](link to message):
        //     ```quote
        //     message content
        //     ```
        let content = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "{username} [said]({link_to_message}):"},
            {
                username: `@_**${message.sender_full_name}|${message.sender_id}**`,
                link_to_message: `${_hash_util__WEBPACK_IMPORTED_MODULE_13__.by_conversation_and_time_url(message)}`,
            },
        );
        content += "\n";
        const fence = _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_3__.get_unused_fence(message.raw_content);
        content += `${fence}quote\n${message.raw_content}\n${fence}`;

        _compose_ui__WEBPACK_IMPORTED_MODULE_10__.replace_syntax(quoting_placeholder, content, $textarea);
        _compose_ui__WEBPACK_IMPORTED_MODULE_10__.autosize_textarea(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));
    }

    if (message && message.raw_content) {
        replace_content(message);
        return;
    }

    _channel__WEBPACK_IMPORTED_MODULE_4__.get({
        url: "/json/messages/" + message_id,
        success(data) {
            message.raw_content = data.raw_content;
            replace_content(message);
        },
    });
}

function on_narrow(opts) {
    // We use force_close when jumping between PM narrows with the "p" key,
    // so that we don't have an open compose box that makes it difficult
    // to cycle quickly through unread messages.
    if (opts.force_close) {
        // This closes the compose box if it was already open, and it is
        // basically a noop otherwise.
        cancel();
        return;
    }

    if (opts.trigger === "narrow_to_compose_target") {
        _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_message_list();
        return;
    }

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_topic_reply()) {
        on_topic_narrow();
        return;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.has_message_content()) {
        _compose_fade__WEBPACK_IMPORTED_MODULE_7__.update_message_list();
        return;
    }

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_by_pm_reply()) {
        opts = fill_in_opts_from_current_narrowed_view("private", opts);
        // Do not open compose box if an invalid recipient is present.
        if (!opts.private_message_recipient) {
            if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.composing()) {
                cancel();
            }
            return;
        }
        // Do not open compose box if organization has disabled sending
        // private messages and recipient is not a bot.
        if (
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
            opts.private_message_recipient
        ) {
            const emails = opts.private_message_recipient.split(",");
            if (emails.length !== 1 || !_people__WEBPACK_IMPORTED_MODULE_18__.get_by_email(emails[0]).is_bot) {
                // If we are navigating between private message conversations,
                // we want the compose box to close for non-bot users.
                if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.composing()) {
                    cancel();
                }
                return;
            }
        }
        start("private");
        return;
    }

    // If we got this far, then we assume the user is now in "reading"
    // mode, so we close the compose box to make it easier to use navigation
    // hotkeys and to provide more screen real estate for messages.
    cancel();
}


/***/ }),

/***/ "./static/js/compose_closed_ui.js":
/*!****************************************!*\
  !*** ./static/js/compose_closed_ui.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_recipient_label": () => (/* binding */ get_recipient_label),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "set_standard_text_for_reply_button": () => (/* binding */ set_standard_text_for_reply_button),
/* harmony export */   "update_buttons_for_private": () => (/* binding */ update_buttons_for_private),
/* harmony export */   "update_buttons_for_recent_topics": () => (/* binding */ update_buttons_for_recent_topics),
/* harmony export */   "update_buttons_for_stream": () => (/* binding */ update_buttons_for_stream),
/* harmony export */   "update_reply_recipient_label": () => (/* binding */ update_reply_recipient_label)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");










function get_recipient_label(message) {
    // TODO: This code path is bit of a type-checking disaster; we mix
    // actual message objects with fake objects containing just a
    // couple fields, both those constructed here and potentially
    // passed in.

    if (message === undefined) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_3__.current.empty()) {
            // For empty narrows where there's a clear reply target,
            // i.e. stream+topic or a single PM conversation, we label
            // the button as replying to the thread.
            if (_narrow_state__WEBPACK_IMPORTED_MODULE_5__.narrowed_to_topic()) {
                message = {
                    stream: _narrow_state__WEBPACK_IMPORTED_MODULE_5__.stream(),
                    topic: _narrow_state__WEBPACK_IMPORTED_MODULE_5__.topic(),
                };
            } else if (_narrow_state__WEBPACK_IMPORTED_MODULE_5__.pm_ids_string()) {
                // TODO: This is a total hack.  Ideally, we'd rework
                // this to not duplicate the actual compose_actions.js
                // logic for what happens when you click the button,
                // and not call into random modules with hacky fake
                // "message" objects.
                const user_ids = _people__WEBPACK_IMPORTED_MODULE_6__.user_ids_string_to_ids_array(_narrow_state__WEBPACK_IMPORTED_MODULE_5__.pm_ids_string());
                const user_ids_dicts = user_ids.map((user_id) => ({id: user_id}));
                message = {
                    display_reply_to: _message_store__WEBPACK_IMPORTED_MODULE_4__.get_pm_full_names({
                        type: "private",
                        display_recipient: user_ids_dicts,
                    }),
                };
            }
        } else {
            message = _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.selected_message();
        }
    }

    if (message) {
        if (message.stream && message.topic) {
            return "#" + message.stream + " > " + message.topic;
        } else if (message.display_reply_to) {
            return message.display_reply_to;
        }
    }
    return "";
}

function update_stream_button(btn_text, title) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_bar_compose_stream_button_big").text(btn_text);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_bar_compose_stream_button_big").prop("title", title);
}

function update_conversation_button(btn_text, title) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_bar_compose_private_button_big").text(btn_text);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_bar_compose_private_button_big").prop("title", title);
}

function update_buttons(text_stream) {
    const title_stream = text_stream + " (c)";
    const text_conversation = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New private message"});
    const title_conversation = text_conversation + " (x)";
    update_stream_button(text_stream, title_stream);
    update_conversation_button(text_conversation, title_conversation);
}

function update_buttons_for_private() {
    const text_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New stream message"});
    update_buttons(text_stream);
}

function update_buttons_for_stream() {
    const text_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New topic"});
    update_buttons(text_stream);
}

function update_buttons_for_recent_topics() {
    const text_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New stream message"});
    update_buttons(text_stream);
}

function set_reply_button_label(label) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".compose_reply_button_label").text(label);
}

function set_standard_text_for_reply_button() {
    set_reply_button_label(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Compose message"}));
}

function update_reply_recipient_label(message) {
    const recipient_label = get_recipient_label(message);
    if (recipient_label) {
        set_reply_button_label(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Message {recipient_label}"}, {recipient_label}),
        );
    } else {
        set_standard_text_for_reply_button();
    }
}

function initialize() {
    // When the message selection changes, change the label on the Reply button.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("message_selected.zulip", () => {
        if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_7__.is_visible()) {
            // message_selected events can occur with recent topics
            // open due to "All messages" loading in the background,
            // so we return without calling changing button state.
            return;
        }

        update_reply_recipient_label();
    });

    // Click handlers for buttons in the compose box.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".compose_stream_button", () => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_1__.start("stream", {trigger: "new topic button"});
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".compose_private_button", () => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_1__.start("private", {trigger: "new private message"});
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".compose_reply_button", () => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_1__.respond_to_message({trigger: "reply button"});
    });
}


/***/ }),

/***/ "./static/js/compose_fade.js":
/*!***********************************!*\
  !*** ./static/js/compose_fade.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_compose": () => (/* binding */ clear_compose),
/* harmony export */   "set_focused_recipient": () => (/* binding */ set_focused_recipient),
/* harmony export */   "start_compose": () => (/* binding */ start_compose),
/* harmony export */   "update_all": () => (/* binding */ update_all),
/* harmony export */   "update_faded_users": () => (/* binding */ update_faded_users),
/* harmony export */   "update_message_list": () => (/* binding */ update_message_list),
/* harmony export */   "update_rendered_message_groups": () => (/* binding */ update_rendered_message_groups)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _buddy_list__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./buddy_list */ "./static/js/buddy_list.js");
/* harmony import */ var _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose_fade_helper */ "./static/js/compose_fade_helper.js");
/* harmony import */ var _compose_fade_users__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose_fade_users */ "./static/js/compose_fade_users.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./floating_recipient_bar */ "./static/js/floating_recipient_bar.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());















let normal_display = false;

function set_focused_recipient(msg_type) {
    if (msg_type === undefined) {
        _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.clear_focused_recipient();
    }

    // Construct focused_recipient as a mocked up element which has all the
    // fields of a message used by util.same_recipient()
    const focused_recipient = {
        type: msg_type,
    };

    if (focused_recipient.type === "stream") {
        const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_5__.stream_name();
        focused_recipient.topic = _compose_state__WEBPACK_IMPORTED_MODULE_5__.topic();
        focused_recipient.stream = stream_name;
        const sub = _stream_data__WEBPACK_IMPORTED_MODULE_11__.get_sub(stream_name);
        if (sub) {
            focused_recipient.stream_id = sub.stream_id;
        }
    } else {
        // Normalize the recipient list so it matches the one used when
        // adding the message (see message_helper.process_new_message()).
        const reply_to = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_compose_state__WEBPACK_IMPORTED_MODULE_5__.private_message_recipient());
        focused_recipient.reply_to = reply_to;
        focused_recipient.to_user_ids = _people__WEBPACK_IMPORTED_MODULE_9__.reply_to_to_user_ids_string(reply_to);
    }

    _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.set_focused_recipient(focused_recipient);
}

function display_messages_normally() {
    const $table = _rows__WEBPACK_IMPORTED_MODULE_10__.get_table(_message_lists__WEBPACK_IMPORTED_MODULE_7__.current.table_name);
    $table.find(".recipient_row").removeClass("message-fade");

    normal_display = true;
    _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__.update();
}

function change_fade_state($elt, should_fade_group) {
    if (should_fade_group) {
        $elt.addClass("message-fade");
    } else {
        $elt.removeClass("message-fade");
    }
}

function fade_messages() {
    let i;
    let first_message;
    let $first_row;
    let should_fade_group = false;
    const visible_groups = _message_viewport__WEBPACK_IMPORTED_MODULE_8__.visible_groups(false);

    normal_display = false;

    // Update the visible messages first, before the compose box opens
    for (i = 0; i < visible_groups.length; i += 1) {
        $first_row = _rows__WEBPACK_IMPORTED_MODULE_10__.first_message_in_group(visible_groups[i]);
        first_message = _message_lists__WEBPACK_IMPORTED_MODULE_7__.current.get(_rows__WEBPACK_IMPORTED_MODULE_10__.id($first_row));
        should_fade_group = _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.should_fade_message(first_message);

        change_fade_state(jquery__WEBPACK_IMPORTED_MODULE_0___default()(visible_groups[i]), should_fade_group);
    }

    // Defer updating all message groups so that the compose box can open sooner
    setTimeout(
        (expected_msg_list, expected_recipient) => {
            const all_groups = _rows__WEBPACK_IMPORTED_MODULE_10__.get_table(_message_lists__WEBPACK_IMPORTED_MODULE_7__.current.table_name)
                .find(".recipient_row");

            if (
                _message_lists__WEBPACK_IMPORTED_MODULE_7__.current !== expected_msg_list ||
                !_compose_state__WEBPACK_IMPORTED_MODULE_5__.composing() ||
                _compose_state__WEBPACK_IMPORTED_MODULE_5__.private_message_recipient() !== expected_recipient
            ) {
                return;
            }

            should_fade_group = false;

            // Note: The below algorithm relies on the fact that all_elts is
            // sorted as it would be displayed in the message view
            for (i = 0; i < all_groups.length; i += 1) {
                const $group_elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(all_groups[i]);
                should_fade_group = _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.should_fade_message(
                    _rows__WEBPACK_IMPORTED_MODULE_10__.recipient_from_group($group_elt),
                );
                change_fade_state($group_elt, should_fade_group);
            }

            _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__.update();
        },
        0,
        _message_lists__WEBPACK_IMPORTED_MODULE_7__.current,
        _compose_state__WEBPACK_IMPORTED_MODULE_5__.private_message_recipient(),
    );
}

const user_fade_config = {
    get_user_id($li) {
        return _buddy_list__WEBPACK_IMPORTED_MODULE_2__.buddy_list.get_key_from_li({$li});
    },
    fade($li) {
        return $li.addClass("user-fade");
    },
    unfade($li) {
        return $li.removeClass("user-fade");
    },
};

function do_update_all() {
    const user_items = _buddy_list__WEBPACK_IMPORTED_MODULE_2__.buddy_list.get_items();

    if (_compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.want_normal_display()) {
        if (!normal_display) {
            display_messages_normally();
            _compose_fade_users__WEBPACK_IMPORTED_MODULE_4__.display_users_normally(user_items, user_fade_config);
        }
    } else {
        fade_messages();
        _compose_fade_users__WEBPACK_IMPORTED_MODULE_4__.fade_users(user_items, user_fade_config);
    }
}

// This one only updates the users, not both, like update_faded_messages.
// This is for when new presence information comes in, redrawing the presence
// list.
function update_faded_users() {
    const user_items = _buddy_list__WEBPACK_IMPORTED_MODULE_2__.buddy_list.get_items();

    _compose_fade_users__WEBPACK_IMPORTED_MODULE_4__.update_user_info(user_items, user_fade_config);
}

// This gets called on keyup events, hence the throttling.
const update_all = lodash__WEBPACK_IMPORTED_MODULE_1___default().debounce(do_update_all, 50);

function start_compose(msg_type) {
    set_focused_recipient(msg_type);
    do_update_all();
}

function clear_compose() {
    _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.clear_focused_recipient();
    display_messages_normally();
    update_faded_users();
}

function update_message_list() {
    if (_compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.want_normal_display()) {
        display_messages_normally();
    } else {
        fade_messages();
    }
}

function update_rendered_message_groups(message_groups, get_element) {
    if (_compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.want_normal_display()) {
        return;
    }

    // This loop is superficially similar to some code in fade_messages, but an
    // important difference here is that we look at each message individually, whereas
    // the other code takes advantage of blocks beneath recipient bars.
    for (const message_group of message_groups) {
        const $elt = get_element(message_group);
        const first_message = message_group.message_containers[0].msg;
        const should_fade = _compose_fade_helper__WEBPACK_IMPORTED_MODULE_3__.should_fade_message(first_message);
        change_fade_state($elt, should_fade);
    }
}


/***/ }),

/***/ "./static/js/compose_fade_helper.js":
/*!******************************************!*\
  !*** ./static/js/compose_fade_helper.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_focused_recipient": () => (/* binding */ clear_focused_recipient),
/* harmony export */   "set_focused_recipient": () => (/* binding */ set_focused_recipient),
/* harmony export */   "should_fade_message": () => (/* binding */ should_fade_message),
/* harmony export */   "want_normal_display": () => (/* binding */ want_normal_display),
/* harmony export */   "would_receive_message": () => (/* binding */ would_receive_message)
/* harmony export */ });
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




let focused_recipient;

function should_fade_message(message) {
    return !Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(focused_recipient, message);
}

function clear_focused_recipient() {
    focused_recipient = undefined;
}

function set_focused_recipient(recipient) {
    focused_recipient = recipient;
}

function is_pm_recipient(user_id) {
    const recipients = focused_recipient.to_user_ids.split(",");
    return recipients.includes(user_id.toString());
}

function would_receive_message(user_id) {
    if (focused_recipient.type === "stream") {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(focused_recipient.stream_id);
        if (!sub) {
            // If the stream isn't valid, there is no risk of a mix
            // yet, so we sort of "lie" and say they would receive a
            // message.
            return true;
        }

        return _stream_data__WEBPACK_IMPORTED_MODULE_0__.is_user_subscribed(focused_recipient.stream_id, user_id);
    }

    // PM, so check if the given email is in the recipients list.
    return is_pm_recipient(user_id);
}

function want_normal_display() {
    // If we're not composing show a normal display.
    if (focused_recipient === undefined) {
        return true;
    }

    // If the user really hasn't specified anything let, then we want a normal display
    if (focused_recipient.type === "stream") {
        // If a stream doesn't exist, there is no real chance of a mix, so fading
        // is just noise to the user.
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(focused_recipient.stream_id)) {
            return true;
        }

        // This is kind of debatable.  If the topic is empty, it could be that
        // the user simply hasn't started typing it yet, but disabling fading here
        // means the feature doesn't help realms where topics aren't mandatory
        // (which is most realms as of this writing).
        if (focused_recipient.topic === "") {
            return true;
        }
    }

    return focused_recipient.type === "private" && focused_recipient.reply_to === "";
}


/***/ }),

/***/ "./static/js/compose_fade_users.js":
/*!*****************************************!*\
  !*** ./static/js/compose_fade_users.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "display_users_normally": () => (/* binding */ display_users_normally),
/* harmony export */   "fade_users": () => (/* binding */ fade_users),
/* harmony export */   "update_user_info": () => (/* binding */ update_user_info)
/* harmony export */ });
/* harmony import */ var _compose_fade_helper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./compose_fade_helper */ "./static/js/compose_fade_helper.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");



function update_user_row_when_fading(li, conf) {
    const user_id = conf.get_user_id(li);
    const would_receive = _compose_fade_helper__WEBPACK_IMPORTED_MODULE_0__.would_receive_message(user_id);

    if (would_receive || _people__WEBPACK_IMPORTED_MODULE_1__.is_my_user_id(user_id)) {
        conf.unfade(li);
    } else {
        conf.fade(li);
    }
}

function fade_users(items, conf) {
    for (const li of items) {
        update_user_row_when_fading(li, conf);
    }
}

function display_users_normally(items, conf) {
    for (const li of items) {
        conf.unfade(li);
    }
}

function update_user_info(items, conf) {
    if (_compose_fade_helper__WEBPACK_IMPORTED_MODULE_0__.want_normal_display()) {
        display_users_normally(items, conf);
    } else {
        fade_users(items, conf);
    }
}


/***/ }),

/***/ "./static/js/compose_pm_pill.js":
/*!**************************************!*\
  !*** ./static/js/compose_pm_pill.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear": () => (/* binding */ clear),
/* harmony export */   "filter_taken_users": () => (/* binding */ filter_taken_users),
/* harmony export */   "get_emails": () => (/* binding */ get_emails),
/* harmony export */   "get_user_ids": () => (/* binding */ get_user_ids),
/* harmony export */   "get_user_ids_string": () => (/* binding */ get_user_ids_string),
/* harmony export */   "has_unconverted_data": () => (/* binding */ has_unconverted_data),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initialize_pill": () => (/* binding */ initialize_pill),
/* harmony export */   "set_from_emails": () => (/* binding */ set_from_emails),
/* harmony export */   "set_from_typeahead": () => (/* binding */ set_from_typeahead),
/* harmony export */   "widget": () => (/* binding */ widget)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _input_pill__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./input_pill */ "./static/js/input_pill.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());








let widget;

const pill_config = {
    show_user_status_emoji: true,
};

function initialize_pill() {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient").parent();

    const pill = _input_pill__WEBPACK_IMPORTED_MODULE_2__.create({
        $container,
        pill_config,
        create_item_from_text: _user_pill__WEBPACK_IMPORTED_MODULE_4__.create_item_from_email,
        get_text_from_item: _user_pill__WEBPACK_IMPORTED_MODULE_4__.get_email_from_item,
    });

    return pill;
}

function initialize() {
    widget = initialize_pill();

    widget.onPillCreate(() => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_1__.update_placeholder_text();
    });

    widget.onPillRemove(() => {
        _compose_actions__WEBPACK_IMPORTED_MODULE_1__.update_placeholder_text();
    });
}

function clear() {
    widget.clear();
}

function set_from_typeahead(person) {
    _user_pill__WEBPACK_IMPORTED_MODULE_4__.append_person({
        pill_widget: widget,
        person,
    });
}

function set_from_emails(value) {
    // value is something like "alice@example.com,bob@example.com"
    clear();
    widget.appendValue(value);
}

function get_user_ids() {
    return _user_pill__WEBPACK_IMPORTED_MODULE_4__.get_user_ids(widget);
}

function has_unconverted_data() {
    return _user_pill__WEBPACK_IMPORTED_MODULE_4__.has_unconverted_data(widget);
}

function get_user_ids_string() {
    const user_ids = get_user_ids();
    const sorted_user_ids = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_ids);
    const user_ids_string = sorted_user_ids.join(",");
    return user_ids_string;
}

function get_emails() {
    // return something like "alice@example.com,bob@example.com"
    const user_ids = get_user_ids();
    const emails = user_ids.map((id) => _people__WEBPACK_IMPORTED_MODULE_3__.get_by_user_id(id).email).join(",");
    return emails;
}

function filter_taken_users(persons) {
    return _user_pill__WEBPACK_IMPORTED_MODULE_4__.filter_taken_users(persons, widget);
}


/***/ }),

/***/ "./static/js/compose_state.js":
/*!************************************!*\
  !*** ./static/js/compose_state.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "composing": () => (/* binding */ composing),
/* harmony export */   "focus_in_empty_compose": () => (/* binding */ focus_in_empty_compose),
/* harmony export */   "get_message_type": () => (/* binding */ get_message_type),
/* harmony export */   "has_full_recipient": () => (/* binding */ has_full_recipient),
/* harmony export */   "has_message_content": () => (/* binding */ has_message_content),
/* harmony export */   "message_content": () => (/* binding */ message_content),
/* harmony export */   "private_message_recipient": () => (/* binding */ private_message_recipient),
/* harmony export */   "recipient_has_topics": () => (/* binding */ recipient_has_topics),
/* harmony export */   "set_message_type": () => (/* binding */ set_message_type),
/* harmony export */   "set_stream_name": () => (/* binding */ set_stream_name),
/* harmony export */   "stream_name": () => (/* binding */ stream_name),
/* harmony export */   "topic": () => (/* binding */ topic)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _compose_pm_pill__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./compose_pm_pill */ "./static/js/compose_pm_pill.js");




let message_type = false; // 'stream', 'private', or false-y

function set_message_type(msg_type) {
    message_type = msg_type;
}

function get_message_type() {
    return message_type;
}

function recipient_has_topics() {
    return message_type !== "stream";
}

function composing() {
    // This is very similar to get_message_type(), but it returns
    // a boolean.
    return Boolean(message_type);
}

function get_or_set(fieldname, keep_leading_whitespace) {
    // We can't hoist the assignment of '$elem' out of this lambda,
    // because the DOM element might not exist yet when get_or_set
    // is called.
    return function (newval) {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(fieldname)}`);
        const oldval = $elem.val();
        if (newval !== undefined) {
            $elem.val(newval);
        }
        return keep_leading_whitespace ? oldval.trimEnd() : oldval.trim();
    };
}

function stream_name() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream").val().trim();
}

function set_stream_name(newval) {
    if (newval !== undefined) {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream");
        $elem.val(newval);
    }
}

// TODO: Break out setter and getter into their own functions.
const topic = get_or_set("stream_message_recipient_topic");

// We can't trim leading whitespace in `compose_textarea` because
// of the indented syntax for multi-line code blocks.
const message_content = get_or_set("compose-textarea", true);

function focus_in_empty_compose() {
    // A user trying to press arrow keys in an empty compose is mostly
    // likely trying to navigate messages. This helper function
    // decides whether the compose box is "empty" for this purpose.
    if (!composing() || message_content() !== "") {
        return false;
    }

    const focused_element_id = document.activeElement.id;
    if (focused_element_id === "compose-textarea") {
        // Focus will be in the compose textarea after sending a
        // message; this is the most common situation.
        return true;
    }

    // If the current focus is in one of the recipient inputs, we need
    // to check whether the input is empty, to avoid accidentally
    // overriding the browser feature where the Up/Down arrow keys jump
    // you to the start/end of a non-empty text input.
    //
    // Check whether the current input element is empty for each input type.
    switch (focused_element_id) {
        case "private_message_recipient":
            return private_message_recipient().length === 0;
        case "stream_message_recipient_topic":
        case "stream_message_recipient_stream":
            return document.activeElement.value === "";
    }

    return false;
}

function private_message_recipient(value) {
    if (typeof value === "string") {
        _compose_pm_pill__WEBPACK_IMPORTED_MODULE_1__.set_from_emails(value);
        return undefined;
    }
    return _compose_pm_pill__WEBPACK_IMPORTED_MODULE_1__.get_emails();
}

function has_message_content() {
    return message_content() !== "";
}

function has_full_recipient() {
    if (message_type === "stream") {
        return stream_name() !== "" && topic() !== "";
    }
    return private_message_recipient() !== "";
}


/***/ }),

/***/ "./static/js/compose_ui.js":
/*!*********************************!*\
  !*** ./static/js/compose_ui.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "autosize_textarea": () => (/* binding */ autosize_textarea),
/* harmony export */   "compute_placeholder_text": () => (/* binding */ compute_placeholder_text),
/* harmony export */   "format_text": () => (/* binding */ format_text),
/* harmony export */   "get_compose_click_target": () => (/* binding */ get_compose_click_target),
/* harmony export */   "handle_keydown": () => (/* binding */ handle_keydown),
/* harmony export */   "handle_keyup": () => (/* binding */ handle_keyup),
/* harmony export */   "hide_compose_spinner": () => (/* binding */ hide_compose_spinner),
/* harmony export */   "insert_syntax_and_focus": () => (/* binding */ insert_syntax_and_focus),
/* harmony export */   "is_full_size": () => (/* binding */ is_full_size),
/* harmony export */   "make_compose_box_full_size": () => (/* binding */ make_compose_box_full_size),
/* harmony export */   "make_compose_box_original_size": () => (/* binding */ make_compose_box_original_size),
/* harmony export */   "replace_syntax": () => (/* binding */ replace_syntax),
/* harmony export */   "set_compose_box_top": () => (/* binding */ set_compose_box_top),
/* harmony export */   "set_full_size": () => (/* binding */ set_full_size),
/* harmony export */   "show_compose_spinner": () => (/* binding */ show_compose_spinner),
/* harmony export */   "smart_insert": () => (/* binding */ smart_insert)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var text_field_edit__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! text-field-edit */ "./node_modules/text-field-edit/index.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popover_menus__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./popover_menus */ "./static/js/popover_menus.js");
/* harmony import */ var _rtl__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rtl */ "./static/js/rtl.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");












let full_size_status = false; // true or false

// Some functions to handle the full size status explicitly
function set_full_size(is_full) {
    full_size_status = is_full;
}

function is_full_size() {
    return full_size_status;
}

function autosize_textarea($textarea) {
    // Since this supports both compose and file upload, one must pass
    // in the text area to autosize.
    if (!is_full_size()) {
        autosize__WEBPACK_IMPORTED_MODULE_0__["default"].update($textarea);
    }
}

function smart_insert($textarea, syntax) {
    function is_space(c) {
        return c === " " || c === "\t" || c === "\n";
    }

    const pos = $textarea.caret();
    const before_str = $textarea.val().slice(0, pos);
    const after_str = $textarea.val().slice(pos);

    if (
        pos > 0 &&
        // If there isn't space either at the end of the content
        // before the insert or (unlikely) at the start of the syntax,
        // add one.
        !is_space(before_str.slice(-1)) &&
        !is_space(syntax[0])
    ) {
        syntax = " " + syntax;
    }

    // If there isn't whitespace either at the end of the syntax or the
    // start of the content after the syntax, add one.
    if (
        !(
            (after_str.length > 0 && is_space(after_str[0])) ||
            (syntax.length > 0 && is_space(syntax.slice(-1)))
        )
    ) {
        syntax += " ";
    }

    // text-field-edit ensures `$textarea` is focused before inserting
    // the new syntax.
    (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.insert)($textarea[0], syntax);

    autosize_textarea($textarea);
}

function insert_syntax_and_focus(syntax, $textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea")) {
    // Generic helper for inserting syntax into the main compose box
    // where the cursor was and focusing the area.  Mostly a thin
    // wrapper around smart_insert.
    smart_insert($textarea, syntax);
}

function replace_syntax(old_syntax, new_syntax, $textarea = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea")) {
    // The following couple lines are needed to later restore the initial
    // logical position of the cursor after the replacement
    const prev_caret = $textarea.caret();
    const replacement_offset = $textarea.val().indexOf(old_syntax);

    // Replaces `old_syntax` with `new_syntax` text in the compose box. Due to
    // the way that JavaScript handles string replacements, if `old_syntax` is
    // a string it will only replace the first instance. If `old_syntax` is
    // a RegExp with a global flag, it will replace all instances.

    // We need use anonymous function for `new_syntax` to avoid JavaScript's
    // replace() function treating `$`s in new_syntax as special syntax.  See
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#Description
    // for details.

    (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.replace)($textarea[0], old_syntax, () => new_syntax, "after-replacement");

    // When replacing content in a textarea, we need to move the cursor
    // to preserve its logical position if and only if the content we
    // just added was before the current cursor position. If it was,
    // we need to move the cursor forward by the increase in the
    // length of the content after the replacement.
    if (prev_caret >= replacement_offset + old_syntax.length) {
        $textarea.caret(prev_caret + new_syntax.length - old_syntax.length);
    } else if (prev_caret > replacement_offset) {
        // In the rare case that our cursor was inside the
        // placeholder, we treat that as though the cursor was
        // just after the placeholder.
        $textarea.caret(replacement_offset + new_syntax.length + 1);
    } else {
        // Otherwise we simply restore it to it's original position
        $textarea.caret(prev_caret);
    }
}

function compute_placeholder_text(opts) {
    // Computes clear placeholder text for the compose box, depending
    // on what heading values have already been filled out.
    //
    // We return text with the stream and topic name unescaped,
    // because the caller is expected to insert this into the
    // placeholder field in a way that does HTML escaping.
    if (opts.message_type === "stream") {
        if (opts.topic) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Message #{stream_name} > {topic_name}"},
                {stream_name: opts.stream, topic_name: opts.topic},
            );
        } else if (opts.stream) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Message #{stream_name}"}, {stream_name: opts.stream});
        }
    }

    // For private messages
    if (opts.private_message_recipient) {
        const recipient_list = opts.private_message_recipient.split(",");
        const recipient_names = recipient_list
            .map((recipient) => {
                const user = _people__WEBPACK_IMPORTED_MODULE_3__.get_by_email(recipient);
                return user.full_name;
            })
            .join(", ");

        if (recipient_list.length === 1) {
            // If it's a single user, display status text if available
            const user = _people__WEBPACK_IMPORTED_MODULE_3__.get_by_email(recipient_list[0]);
            const status = _user_status__WEBPACK_IMPORTED_MODULE_6__.get_status_text(user.user_id);
            if (status) {
                return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: "Message {recipient_name} ({recipient_status})"},
                    {recipient_name: recipient_names, recipient_status: status},
                );
            }
        }
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Message {recipient_names}"}, {recipient_names});
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Compose your message here"});
}

function set_compose_box_top(set_top) {
    if (set_top) {
        // As `#compose` has `position: fixed` property, we cannot
        // make the compose-box to attain the correct height just by
        // using CSS. If that wasn't the case, we could have somehow
        // refactored the HTML so as to consider only the space below
        // below the `#navbar_alerts` as `height: 100%` of `#compose`.
        const compose_top =
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#navbar_alerts_wrapper").height() +
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".header").height() +
            Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(".header").css("paddingBottom"), 10);
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").css("top", compose_top + "px");
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").css("top", "");
    }
}

function make_compose_box_full_size() {
    set_full_size(true);

    // The autosize should be destroyed for the full size compose
    // box else it will interfere and shrink its size accordingly.
    autosize__WEBPACK_IMPORTED_MODULE_0__["default"].destroy(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").addClass("compose-fullscreen");

    // Set the `top` property of compose-box.
    set_compose_box_top(true);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".collapse_composebox_button").show();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".expand_composebox_button").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#scroll-to-bottom-button-container").removeClass("show");
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").trigger("focus");
}

function make_compose_box_original_size() {
    set_full_size(false);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").removeClass("compose-fullscreen");

    // Unset the `top` property of compose-box.
    set_compose_box_top(false);

    // Again initialise the compose textarea as it was destroyed
    // when compose box was made full screen
    (0,autosize__WEBPACK_IMPORTED_MODULE_0__["default"])(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".collapse_composebox_button").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".expand_composebox_button").show();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").trigger("focus");
}

function handle_keydown(event, $textarea) {
    // The event.key property will have uppercase letter if
    // the "Shift + <key>" combo was used or the Caps Lock
    // key was on. We turn to key to lowercase so the key bindings
    // work regardless of whether Caps Lock was on or not.
    const key = event.key.toLowerCase();
    let type;
    if (key === "b") {
        type = "bold";
    } else if (key === "i" && !event.shiftKey) {
        type = "italic";
    } else if (key === "l" && event.shiftKey) {
        type = "link";
    }

    // detect Cmd and Ctrl key
    const isCmdOrCtrl = Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ? event.metaKey : event.ctrlKey;

    if (type && isCmdOrCtrl) {
        format_text($textarea, type);
        autosize_textarea($textarea);
        event.preventDefault();
    }
}

function handle_keyup(event, $textarea) {
    // Set the rtl class if the text has an rtl direction, remove it otherwise
    _rtl__WEBPACK_IMPORTED_MODULE_5__.set_rtl_class_for_textarea($textarea);
}

function format_text($textarea, type) {
    const italic_syntax = "*";
    const bold_syntax = "**";
    const bold_and_italic_syntax = "***";
    let is_selected_text_italic = false;
    let is_inner_text_italic = false;
    const field = $textarea.get(0);
    let range = $textarea.range();
    let text = $textarea.val();
    const selected_text = range.text;

    // Remove new line and space around selected text.
    const left_trim_length = range.text.length - range.text.trimStart().length;
    const right_trim_length = range.text.length - range.text.trimEnd().length;

    field.setSelectionRange(range.start + left_trim_length, range.end - right_trim_length);
    range = $textarea.range();

    const is_selection_bold = () =>
        // First check if there are enough characters before/after selection.
        range.start >= bold_syntax.length &&
        text.length - range.end >= bold_syntax.length &&
        // And then if the characters have bold_syntax around them.
        text.slice(range.start - bold_syntax.length, range.start) === bold_syntax &&
        text.slice(range.end, range.end + bold_syntax.length) === bold_syntax;

    const is_inner_text_bold = () =>
        // Check if selected text itself has bold_syntax inside it.
        range.length > 4 &&
        selected_text.slice(0, bold_syntax.length) === bold_syntax &&
        selected_text.slice(-bold_syntax.length) === bold_syntax;

    switch (type) {
        case "bold":
            // Ctrl + B: Toggle bold syntax on selection.

            // If the selection is already surrounded by bold syntax,
            // remove it rather than adding another copy.
            if (is_selection_bold()) {
                // Remove the bold_syntax from text.
                text =
                    text.slice(0, range.start - bold_syntax.length) +
                    text.slice(range.start, range.end) +
                    text.slice(range.end + bold_syntax.length);
                (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.set)(field, text);
                field.setSelectionRange(
                    range.start - bold_syntax.length,
                    range.end - bold_syntax.length,
                );
                break;
            } else if (is_inner_text_bold()) {
                // Remove bold syntax inside the selection, if present.
                text =
                    text.slice(0, range.start) +
                    text.slice(range.start + bold_syntax.length, range.end - bold_syntax.length) +
                    text.slice(range.end);
                (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.set)(field, text);
                field.setSelectionRange(range.start, range.end - bold_syntax.length * 2);
                break;
            }

            // Otherwise, we don't have bold syntax, so we add it.
            (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.wrapSelection)(field, bold_syntax);
            break;
        case "italic":
            // Ctrl + I: Toggle italic syntax on selection. This is
            // much more complex than toggling bold syntax, because of
            // the following subtle detail: If our selection is
            // **foo**, toggling italics should add italics, since in
            // fact it's just bold syntax, even though with *foo* and
            // ***foo*** should remove italics.

            // If the text is already italic, we remove the italic_syntax from text.
            if (range.start >= 1 && text.length - range.end >= italic_syntax.length) {
                // If text has italic_syntax around it.
                const has_italic_syntax =
                    text.slice(range.start - italic_syntax.length, range.start) === italic_syntax &&
                    text.slice(range.end, range.end + italic_syntax.length) === italic_syntax;

                if (is_selection_bold()) {
                    // If text has bold_syntax around it.
                    if (
                        range.start >= 3 &&
                        text.length - range.end >= bold_and_italic_syntax.length
                    ) {
                        // If text is both bold and italic.
                        const has_bold_and_italic_syntax =
                            text.slice(range.start - bold_and_italic_syntax.length, range.start) ===
                                bold_and_italic_syntax &&
                            text.slice(range.end, range.end + bold_and_italic_syntax.length) ===
                                bold_and_italic_syntax;
                        if (has_bold_and_italic_syntax) {
                            is_selected_text_italic = true;
                        }
                    }
                } else if (has_italic_syntax) {
                    // If text is only italic.
                    is_selected_text_italic = true;
                }
            }

            if (is_selected_text_italic) {
                // If text has italic syntax around it, we remove the italic syntax.
                text =
                    text.slice(0, range.start - italic_syntax.length) +
                    text.slice(range.start, range.end) +
                    text.slice(range.end + italic_syntax.length);
                (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.set)(field, text);
                field.setSelectionRange(
                    range.start - italic_syntax.length,
                    range.end - italic_syntax.length,
                );
                break;
            } else if (
                selected_text.length > italic_syntax.length * 2 &&
                // If the selected text contains italic syntax
                selected_text.slice(0, italic_syntax.length) === italic_syntax &&
                selected_text.slice(-italic_syntax.length) === italic_syntax
            ) {
                if (is_inner_text_bold()) {
                    if (
                        selected_text.length > bold_and_italic_syntax.length * 2 &&
                        selected_text.slice(0, bold_and_italic_syntax.length) ===
                            bold_and_italic_syntax &&
                        selected_text.slice(-bold_and_italic_syntax.length) ===
                            bold_and_italic_syntax
                    ) {
                        // If selected text is both bold and italic.
                        is_inner_text_italic = true;
                    }
                } else {
                    // If selected text is only italic.
                    is_inner_text_italic = true;
                }
            }

            if (is_inner_text_italic) {
                // We remove the italic_syntax from within the selected text.
                text =
                    text.slice(0, range.start) +
                    text.slice(
                        range.start + italic_syntax.length,
                        range.end - italic_syntax.length,
                    ) +
                    text.slice(range.end);
                (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.set)(field, text);
                field.setSelectionRange(range.start, range.end - italic_syntax.length * 2);
                break;
            }

            (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.wrapSelection)(field, italic_syntax);
            break;
        case "link": {
            // Ctrl + L: Insert a link to selected text
            (0,text_field_edit__WEBPACK_IMPORTED_MODULE_7__.wrapSelection)(field, "[", "](url)");

            // Change selected text to `url` part of the syntax.
            // If <text> marks the selected region, we're mapping:
            // <text> => [text](<url>).
            const new_start = range.end + "[](".length;
            const new_end = new_start + "url".length;
            field.setSelectionRange(new_start, new_end);
            break;
        }
    }
}

function hide_compose_spinner() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button .loader").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button span").show();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button").removeClass("disable-btn");
}

function show_compose_spinner() {
    // Always use white spinner.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button .loader"), true);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button span").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-send-button").addClass("disable-btn");
}

function get_compose_click_target(e) {
    const compose_control_buttons_popover = _popover_menus__WEBPACK_IMPORTED_MODULE_4__.get_compose_control_buttons_popover();
    if (
        compose_control_buttons_popover &&
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(compose_control_buttons_popover.popper).has(e.target).length
    ) {
        return compose_control_buttons_popover.reference;
    }
    return e.target;
}


/***/ }),

/***/ "./static/js/compose_validate.js":
/*!***************************************!*\
  !*** ./static/js/compose_validate.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "check_overflow_text": () => (/* binding */ check_overflow_text),
/* harmony export */   "clear_topic_resolved_warning": () => (/* binding */ clear_topic_resolved_warning),
/* harmony export */   "clear_wildcard_warnings": () => (/* binding */ clear_wildcard_warnings),
/* harmony export */   "get_invalid_recipient_emails": () => (/* binding */ get_invalid_recipient_emails),
/* harmony export */   "needs_subscribe_warning": () => (/* binding */ needs_subscribe_warning),
/* harmony export */   "set_user_acknowledged_wildcard_flag": () => (/* binding */ set_user_acknowledged_wildcard_flag),
/* harmony export */   "set_wildcard_mention_large_stream_threshold": () => (/* binding */ set_wildcard_mention_large_stream_threshold),
/* harmony export */   "validate": () => (/* binding */ validate),
/* harmony export */   "validate_stream_message_address_info": () => (/* binding */ validate_stream_message_address_info),
/* harmony export */   "validation_error": () => (/* binding */ validation_error),
/* harmony export */   "warn_for_text_overflow_when_tries_to_send": () => (/* binding */ warn_for_text_overflow_when_tries_to_send),
/* harmony export */   "warn_if_mentioning_unsubscribed_user": () => (/* binding */ warn_if_mentioning_unsubscribed_user),
/* harmony export */   "warn_if_private_stream_is_linked": () => (/* binding */ warn_if_private_stream_is_linked),
/* harmony export */   "warn_if_topic_resolved": () => (/* binding */ warn_if_topic_resolved),
/* harmony export */   "wildcard_mention_allowed": () => (/* binding */ wildcard_mention_allowed),
/* harmony export */   "wildcard_mention_large_stream_threshold": () => (/* binding */ wildcard_mention_large_stream_threshold)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _templates_compose_banner_compose_banner_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/compose_banner/compose_banner.hbs */ "./static/templates/compose_banner/compose_banner.hbs");
/* harmony import */ var _templates_compose_banner_compose_banner_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_banner_compose_banner_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_compose_banner_not_subscribed_warning_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/compose_banner/not_subscribed_warning.hbs */ "./static/templates/compose_banner/not_subscribed_warning.hbs");
/* harmony import */ var _templates_compose_banner_not_subscribed_warning_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_banner_not_subscribed_warning_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_compose_banner_private_stream_warning_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/compose_banner/private_stream_warning.hbs */ "./static/templates/compose_banner/private_stream_warning.hbs");
/* harmony import */ var _templates_compose_banner_private_stream_warning_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_banner_private_stream_warning_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_compose_banner_wildcard_warning_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/compose_banner/wildcard_warning.hbs */ "./static/templates/compose_banner/wildcard_warning.hbs");
/* harmony import */ var _templates_compose_banner_wildcard_warning_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_banner_wildcard_warning_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_pm_pill__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose_pm_pill */ "./static/js/compose_pm_pill.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());























let user_acknowledged_wildcard = false;
let wildcard_mention;

let wildcard_mention_large_stream_threshold = 15;

function needs_subscribe_warning(user_id, stream_id) {
    // This returns true if all of these conditions are met:
    //  * the user is valid
    //  * the user is not already subscribed to the stream
    //  * the user has no back-door way to see stream messages
    //    (i.e. bots on public/private streams)
    //
    //  You can think of this as roughly answering "is there an
    //  actionable way to subscribe the user and do they actually
    //  need it?".
    //
    //  We expect the caller to already have verified that we're
    //  sending to a valid stream and trying to mention the user.

    const user = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_id);

    if (!user) {
        return false;
    }

    if (user.is_bot) {
        // Bots may receive messages on public/private streams even if they are
        // not subscribed.
        return false;
    }

    if (_stream_data__WEBPACK_IMPORTED_MODULE_13__.is_user_subscribed(stream_id, user_id)) {
        // If our user is already subscribed
        return false;
    }

    return true;
}

function warn_if_private_stream_is_linked(linked_stream) {
    // For PMs, we currently don't warn about links to private
    // streams, since you are specifically sharing the existence of
    // the private stream with someone.  One could imagine changing
    // this policy if user feedback suggested it was useful.
    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type() !== "stream") {
        return;
    }

    const compose_stream = _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_sub(_compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name());
    if (compose_stream === undefined) {
        // We have an invalid stream name, don't warn about this here as
        // we show an error to the user when they try to send the message.
        return;
    }

    // If the stream we're linking to is not invite-only, then it's
    // public, and there is no need to warn about it, since all
    // members can already see all the public streams.
    //
    // Theoretically, we could still do a warning if there are any
    // guest users subscribed to the stream we're posting to; we may
    // change this policy if user feedback suggests it'd be an
    // improvement.
    if (!linked_stream.invite_only) {
        return;
    }

    // Don't warn if subscribers list of current compose_stream is
    // a subset of linked_stream's subscribers list, because
    // everyone will be subscribed to the linked stream and so
    // knows it exists.  (But always warn Zephyr users, since
    // we may not know their stream's subscribers.)
    if (
        _peer_data__WEBPACK_IMPORTED_MODULE_11__.is_subscriber_subset(compose_stream.stream_id, linked_stream.stream_id) &&
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return;
    }

    const new_row = _templates_compose_banner_private_stream_warning_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
        banner_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        stream_name: linked_stream.name,
        classname: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_banners").append(new_row);
}

function warn_if_mentioning_unsubscribed_user(mentioned) {
    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type() !== "stream") {
        return;
    }

    // Disable for Zephyr mirroring realms, since we never have subscriber lists there
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    const user_id = mentioned.user_id;

    if (mentioned.is_broadcast) {
        return; // don't check if @all/@everyone/@stream
    }

    const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name();

    if (!stream_name) {
        return;
    }

    const sub = _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_sub(stream_name);

    if (!sub) {
        return;
    }

    if (needs_subscribe_warning(user_id, sub.stream_id)) {
        const $existing_invites_area = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`,
        );

        const existing_invites = Array.from($existing_invites_area, (user_row) =>
            Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(user_row).data("user-id"), 10),
        );

        const can_subscribe_other_users = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

        if (!existing_invites.includes(user_id)) {
            const context = {
                user_id,
                stream_id: sub.stream_id,
                banner_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                button_text: can_subscribe_other_users
                    ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribe them"})
                    : null,
                can_subscribe_other_users,
                name: mentioned.full_name,
                classname: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            };

            const new_row = _templates_compose_banner_not_subscribed_warning_hbs__WEBPACK_IMPORTED_MODULE_3___default()(context);
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_banners").append(new_row);
        }
    }
}

function clear_topic_resolved_warning() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();
}

function warn_if_topic_resolved(topic_changed) {
    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.recipient_has_topics()) {
        return;
    }
    // This function is called with topic_changed=false on every
    // keypress when typing a message, so it should not do anything
    // expensive in that case.
    //
    // Pass topic_changed=true if this function was called in response
    // to a topic being edited.
    const topic_name = _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic();

    if (!topic_changed && !_shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_1__.is_resolved(topic_name)) {
        // The resolved topic warning will only ever appear when
        // composing to a resolve topic, so we return early without
        // inspecting additional fields in this case.
        return;
    }

    const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name();
    const message_content = _compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content();
    const sub = _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_sub(stream_name);
    const $compose_banner_area = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_banners");

    if (sub && message_content !== "" && _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_1__.is_resolved(topic_name)) {
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).length) {
            // Error is already displayed; no action required.
            return;
        }

        const button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()
            ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unresolve topic"})
            : null;

        const context = {
            banner_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            stream_id: sub.stream_id,
            topic_name,
            banner_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage:
                    "You are sending a message to a resolved topic. You can send as-is or unresolve the topic first.",
            }),
            button_text,
            classname: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        };

        const new_row = _templates_compose_banner_compose_banner_hbs__WEBPACK_IMPORTED_MODULE_2___default()(context);
        $compose_banner_area.append(new_row);
    } else {
        clear_topic_resolved_warning();
    }
}

function show_wildcard_warnings(stream_id) {
    const subscriber_count = _peer_data__WEBPACK_IMPORTED_MODULE_11__.get_subscriber_count(stream_id) || 0;

    const $compose_banner_area = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_banners");
    const classname = Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const $wildcard_template = _templates_compose_banner_wildcard_warning_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
        banner_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        subscriber_count,
        stream_name: _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name(),
        wildcard_mention,
        button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Yes, send"}),
        hide_close_button: true,
        classname,
    });

    // only show one error for any number of @all or @everyone mentions
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${classname}`).length === 0) {
        $compose_banner_area.append($wildcard_template);
    }

    user_acknowledged_wildcard = false;
}

function clear_wildcard_warnings() {
    const classname = Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${classname}`).remove();
}

function set_user_acknowledged_wildcard_flag(value) {
    user_acknowledged_wildcard = value;
}

function get_invalid_recipient_emails() {
    const private_recipients = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        _compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient(),
    );
    const invalid_recipients = private_recipients.filter(
        (email) => !_people__WEBPACK_IMPORTED_MODULE_12__.is_valid_email_for_compose(email),
    );

    return invalid_recipients;
}

function check_unsubscribed_stream_for_send(stream_name, autosubscribe) {
    let result;
    if (!autosubscribe) {
        return "not-subscribed";
    }

    // In the rare circumstance of the autosubscribe option, we
    // *Synchronously* try to subscribe to the stream before sending
    // the message.  This is deprecated and we hope to remove it; see
    // #4650.
    _channel__WEBPACK_IMPORTED_MODULE_6__.post({
        url: "/json/subscriptions/exists",
        data: {stream: stream_name, autosubscribe: true},
        async: false,
        success(data) {
            if (data.subscribed) {
                result = "subscribed";
            } else {
                result = "not-subscribed";
            }
        },
        error(xhr) {
            if (xhr.status === 404) {
                result = "does-not-exist";
            } else {
                result = "error";
            }
        },
    });
    return result;
}

function wildcard_mention_allowed() {
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return true;
    }
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return false;
    }
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            return true;
        }
        const person = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        const current_datetime = new Date(Date.now());
        const person_date_joined = new Date(person.date_joined);
        const days = (current_datetime - person_date_joined) / 1000 / 86400;

        return days >= Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }
    return !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
}

function set_wildcard_mention_large_stream_threshold(value) {
    wildcard_mention_large_stream_threshold = value;
}

function validate_stream_message_mentions(stream_id) {
    const subscriber_count = _peer_data__WEBPACK_IMPORTED_MODULE_11__.get_subscriber_count(stream_id) || 0;

    // If the user is attempting to do a wildcard mention in a large
    // stream, check if they permission to do so.
    if (wildcard_mention !== null && subscriber_count > wildcard_mention_large_stream_threshold) {
        if (!wildcard_mention_allowed()) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage:
                        "You do not have permission to use wildcard mentions in this stream.",
                }),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            );
            return false;
        }

        if (user_acknowledged_wildcard === undefined || user_acknowledged_wildcard === false) {
            // user has not seen a warning message yet if undefined
            show_wildcard_warnings(stream_id);

            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled", false);
            _compose_ui__WEBPACK_IMPORTED_MODULE_10__.hide_compose_spinner();
            return false;
        }
    } else {
        // the message no longer contains @all or @everyone
        clear_wildcard_warnings();
    }
    // at this point, the user has either acknowledged the warning or removed @all / @everyone
    user_acknowledged_wildcard = undefined;

    return true;
}

function validation_error(error_type, stream_name) {
    switch (error_type) {
        case "does-not-exist":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_name);
            return false;
        case "error":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error checking subscription."}),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream"),
            );
            return false;
        case "not-subscribed": {
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).length) {
                return false;
            }
            const sub = _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_sub(stream_name);
            const new_row = _templates_compose_banner_compose_banner_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
                banner_type: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                banner_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage:
                        "You're not subscribed to this stream. You will not be notified if other users reply to your message.",
                }),
                button_text: _stream_data__WEBPACK_IMPORTED_MODULE_13__.can_toggle_subscription(sub)
                    ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribe"})
                    : null,
                classname: Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                // The message cannot be sent until the user subscribes to the stream, so
                // closing the banner would be more confusing than helpful.
                hide_close_button: true,
            });
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_banners").append(new_row);
            return false;
        }
    }
    return true;
}

function validate_stream_message_address_info(stream_name) {
    if (_stream_data__WEBPACK_IMPORTED_MODULE_13__.is_subscribed_by_name(stream_name)) {
        return true;
    }
    const autosubscribe = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined;
    const error_type = check_unsubscribed_stream_for_send(stream_name, autosubscribe);
    return validation_error(error_type, stream_name);
}

function validate_stream_message() {
    const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_9__.stream_name();
    if (stream_name === "") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Please specify a stream."}),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream"),
        );
        return false;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const topic = _compose_state__WEBPACK_IMPORTED_MODULE_9__.topic();
        // TODO: We plan to migrate the empty topic to only using the
        // `""` representation for i18n reasons, but have not yet done so.
        if (topic === "" || topic === "(no topic)") {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Topics are required in this organization."}),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_topic"),
            );
            return false;
        }
    }

    const sub = _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_sub(stream_name);
    if (!sub) {
        return validation_error("does-not-exist", stream_name);
    }

    if (!_stream_data__WEBPACK_IMPORTED_MODULE_13__.can_post_messages_in_stream(sub)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "You do not have permission to post in this stream.",
            }),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
        return false;
    }

    /* Note: This is a global and thus accessible in the functions
       below; it's important that we update this state here before
       proceeding with further validation. */
    wildcard_mention = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content());

    if (
        !validate_stream_message_address_info(stream_name) ||
        !validate_stream_message_mentions(sub.stream_id)
    ) {
        return false;
    }

    return true;
}

// The function checks whether the recipients are users of the realm or cross realm users (bots
// for now)
function validate_private_message() {
    const user_ids = _compose_pm_pill__WEBPACK_IMPORTED_MODULE_8__.get_user_ids();

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        (user_ids.length !== 1 || !_people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_ids[0]).is_bot)
    ) {
        // Unless we're composing to a bot
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Private messages are disabled in this organization."}),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient"),
        );
        return false;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.private_message_recipient().length === 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Please specify at least one valid recipient."}),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient"),
        );
        return false;
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // For Zephyr mirroring realms, the frontend doesn't know which users exist
        return true;
    }

    const invalid_recipients = get_invalid_recipient_emails();

    let context = {};
    if (invalid_recipients.length === 1) {
        context = {recipient: invalid_recipients.join(",")};
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "The recipient {recipient} is not valid."}, context),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient"),
        );
        return false;
    } else if (invalid_recipients.length > 1) {
        context = {recipients: invalid_recipients.join(",")};
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "The recipients {recipients} are not valid."}, context),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient"),
        );
        return false;
    }

    for (const user_id of user_ids) {
        if (!_people__WEBPACK_IMPORTED_MODULE_12__.is_person_active(user_id)) {
            context = {full_name: _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_id).full_name};
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You cannot send messages to deactivated users."}, context),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient"),
            );

            return false;
        }
    }

    return true;
}

function check_overflow_text() {
    // This function is called when typing every character in the
    // compose box, so it's important that it not doing anything
    // expensive.
    const text = _compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content();
    const max_length = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const $indicator = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose_limit_indicator");

    if (text.length > max_length) {
        $indicator.addClass("over_limit");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").addClass("over_limit");
        $indicator.text(text.length + "/" + max_length);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {
                    defaultMessage:
                        "Message length shouldn't be greater than {max_length} characters.",
                },
                {max_length},
            ),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled", true);
    } else if (text.length > 0.9 * max_length) {
        $indicator.removeClass("over_limit");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").removeClass("over_limit");
        $indicator.text(text.length + "/" + max_length);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled", false);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();
    } else {
        $indicator.text("");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").removeClass("over_limit");

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled", false);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();
    }

    return text.length;
}

function warn_for_text_overflow_when_tries_to_send() {
    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content().length > Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").addClass("flash");
        setTimeout(() => jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").removeClass("flash"), 1500);
        return false;
    }
    return true;
}

function validate() {
    const message_content = _compose_state__WEBPACK_IMPORTED_MODULE_9__.message_content();
    if (/^\s*$/.test(message_content)) {
        // Avoid showing an error message when "enter sends" is enabled,
        // as it is more likely that the user has hit "Enter" accidentally.
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You have nothing to send!"}),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea"),
            );
        }
        return false;
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#compose_banners .${Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).remove();

    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zephyr-mirror-error").is(":visible")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage:
                    "You need to be running Zephyr mirroring in order to send messages!",
            }),
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
        return false;
    }
    if (!warn_for_text_overflow_when_tries_to_send()) {
        return false;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_9__.get_message_type() === "private") {
        return validate_private_message();
    }
    return validate_stream_message();
}


/***/ }),

/***/ "./static/js/composebox_typeahead.js":
/*!*******************************************!*\
  !*** ./static/js/composebox_typeahead.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "broadcast_mentions": () => (/* binding */ broadcast_mentions),
/* harmony export */   "compose_automated_selection": () => (/* binding */ compose_automated_selection),
/* harmony export */   "compose_content_matcher": () => (/* binding */ compose_content_matcher),
/* harmony export */   "compose_trigger_selection": () => (/* binding */ compose_trigger_selection),
/* harmony export */   "content_highlighter": () => (/* binding */ content_highlighter),
/* harmony export */   "content_typeahead_selected": () => (/* binding */ content_typeahead_selected),
/* harmony export */   "emoji_collection": () => (/* binding */ emoji_collection),
/* harmony export */   "filter_and_sort_candidates": () => (/* binding */ filter_and_sort_candidates),
/* harmony export */   "filter_and_sort_mentions": () => (/* binding */ filter_and_sort_mentions),
/* harmony export */   "get_candidates": () => (/* binding */ get_candidates),
/* harmony export */   "get_person_suggestions": () => (/* binding */ get_person_suggestions),
/* harmony export */   "get_pm_people": () => (/* binding */ get_pm_people),
/* harmony export */   "get_sorted_filtered_items": () => (/* binding */ get_sorted_filtered_items),
/* harmony export */   "get_stream_topic_data": () => (/* binding */ get_stream_topic_data),
/* harmony export */   "handle_enter": () => (/* binding */ handle_enter),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initialize_compose_typeahead": () => (/* binding */ initialize_compose_typeahead),
/* harmony export */   "initialize_topic_edit_typeahead": () => (/* binding */ initialize_topic_edit_typeahead),
/* harmony export */   "max_num_items": () => (/* binding */ max_num_items),
/* harmony export */   "query_matches_name": () => (/* binding */ query_matches_name),
/* harmony export */   "query_matches_person": () => (/* binding */ query_matches_person),
/* harmony export */   "should_enter_send": () => (/* binding */ should_enter_send),
/* harmony export */   "slash_commands": () => (/* binding */ slash_commands),
/* harmony export */   "sort_results": () => (/* binding */ sort_results),
/* harmony export */   "split_at_cursor": () => (/* binding */ split_at_cursor),
/* harmony export */   "tokenize_compose_str": () => (/* binding */ tokenize_compose_str),
/* harmony export */   "topics_seen_for": () => (/* binding */ topics_seen_for),
/* harmony export */   "update_emoji_data": () => (/* binding */ update_emoji_data)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/typeahead */ "./static/shared/js/typeahead.js");
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose_pm_pill */ "./static/js/compose_pm_pill.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _compose_validate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_validate */ "./static/js/compose_validate.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
/* harmony import */ var _flatpickr__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./flatpickr */ "./static/js/flatpickr.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./stream_topic_history_util */ "./static/js/stream_topic_history_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



// import pygments_data from "../generated/pygments_data.json";


























// **********************************
// AN IMPORTANT NOTE ABOUT TYPEAHEADS
// **********************************
// They do not do any HTML escaping, at all.
// And your input to them is rendered as though it were HTML by
// the default highlighter.
//
// So if you are not using trusted input, you MUST use a
// highlighter that escapes (i.e. one that calls
// typeahead_helper.highlight_with_escaping).

// This is what we use for PM/compose typeaheads.
// We export it to allow tests to mock it.
const max_num_items = 8;

let emoji_collection = [];

function update_emoji_data() {
    emoji_collection = [];
    for (const emoji_dict of _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.values()) {
        const {reaction_type} = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_emoji_details_by_name(emoji_dict.name);
        if (emoji_dict.is_realm_emoji === true) {
            emoji_collection.push({
                reaction_type,
                emoji_name: emoji_dict.name,
                emoji_url: emoji_dict.url,
                is_realm_emoji: true,
            });
        } else {
            for (const alias of emoji_dict.aliases) {
                emoji_collection.push({
                    reaction_type,
                    emoji_name: alias,
                    emoji_code: emoji_dict.emoji_code,
                });
            }
        }
    }
}

function topics_seen_for(stream_name) {
    const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_15__.get_stream_id(stream_name);
    if (!stream_id) {
        return [];
    }

    // Fetch topic history from the server, in case we will need it soon.
    _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_17__.get_server_history(stream_id, () => {});
    return _stream_topic_history__WEBPACK_IMPORTED_MODULE_16__.get_recent_topic_names(stream_id);
}

function get_language_matcher(query) {
    query = query.toLowerCase();
    return function (lang) {
        return lang.includes(query);
    };
}

function query_matches_person(query, person) {
    return (
        _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, person.full_name, " ") ||
        (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() &&
            _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, _people__WEBPACK_IMPORTED_MODULE_13__.get_visible_email(person), " "))
    );
}

function query_matches_name(query, user_group_or_stream) {
    return _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, user_group_or_stream.name, " ");
}

function get_stream_or_user_group_matcher(query) {
    // Case-insensitive.
    query = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.clean_query_lowercase(query);

    return function (user_group_or_stream) {
        return query_matches_name(query, user_group_or_stream);
    };
}

function get_slash_matcher(query) {
    query = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.clean_query_lowercase(query);

    return function (item) {
        return (
            _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, item.name, " ") ||
            _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, item.aliases, " ")
        );
    };
}

function get_topic_matcher(query) {
    query = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.clean_query_lowercase(query);

    return function (topic) {
        const obj = {
            topic,
        };

        return _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.query_matches_string(query, obj.topic, " ");
    };
}

function should_enter_send(e) {
    const has_non_shift_modifier_key = e.ctrlKey || e.metaKey || e.altKey;
    const has_modifier_key = e.shiftKey || has_non_shift_modifier_key;
    let this_enter_sends;
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // With the enter_sends setting, we should send
        // the message unless the user was holding a
        // modifier key.
        this_enter_sends = !has_modifier_key && Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e);
    } else {
        // If enter_sends is not enabled, just hitting
        // Enter should add a newline, but with a
        // non-Shift modifier key held down, we should
        // send.  With Shift, we shouldn't, because
        // Shift+Enter to get a newline is a common
        // keyboard habit for folks for dealing with other
        // chat products where Enter-always-sends.
        this_enter_sends = has_non_shift_modifier_key;
    }
    return this_enter_sends;
}

function handle_enter($textarea, e) {
    // Used only if Enter doesn't send.

    // Since this Enter doesn't send, we just want to do
    // the browser's default behavior for the "Enter" key.
    // Letting the browser handle it works great if the
    // key actually pressed was Enter or Shift-Enter.

    // But the default browser behavior for Ctrl/Alt/Meta
    // + Enter is to do nothing, so we need to emulate
    // the browser behavior for "Enter" in those cases.
    //
    // We do this using caret and range from jquery-caret.
    const has_non_shift_modifier_key = e.ctrlKey || e.metaKey || e.altKey;
    if (!has_non_shift_modifier_key) {
        // Use the native browser behavior.
        return;
    }

    // To properly emulate browser "Enter", if the
    // user had selected something in the textarea,
    // we need those characters to be cleared.
    const range = $textarea.range();
    if (range.length > 0) {
        $textarea.range(range.start, range.end).range("");
    }

    // Now add the newline, remembering to resize the
    // textarea if needed.
    $textarea.caret("\n");
    _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea($textarea);
    e.preventDefault();
}

// nextFocus is set on a keydown event to indicate where we should focus on keyup.
// We can't focus at the time of keydown because we need to wait for typeahead.
// And we can't compute where to focus at the time of keyup because only the keydown
// has reliable information about whether it was a Tab or a Shift+Tab.
let $nextFocus = false;

function handle_keydown(e) {
    const key = e.key;

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e) || (key === "Tab" && !e.shiftKey)) {
        // Enter key or Tab key
        let target_sel;

        if (e.target.id) {
            target_sel = `#${CSS.escape(e.target.id)}`;
        }

        const on_stream = target_sel === "#stream_message_recipient_stream";
        const on_topic = target_sel === "#stream_message_recipient_topic";
        const on_pm = target_sel === "#private_message_recipient";
        const on_compose = target_sel === "#compose-textarea";

        if (on_compose) {
            if (key === "Tab") {
                // This if branch is only here to make Tab+Enter work on Safari,
                // which does not make <button>s tab-accessible by default
                // (even if we were to set tabindex=0).
                if (!should_enter_send(e)) {
                    // It is important that we do an immediate focus
                    // even here, rather than setting nextFocus. If
                    // the user hits Tab and then Enter without first
                    // releasing Tab, then setting nextFocus here
                    // could result in focus being moved to the "Send
                    // button" after sending the message, preventing
                    // typing a next message!
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").trigger("focus");
                    e.preventDefault();
                    e.stopPropagation();
                }
            } else {
                // Enter
                if (should_enter_send(e)) {
                    e.preventDefault();
                    if (
                        _compose_validate__WEBPACK_IMPORTED_MODULE_7__.warn_for_text_overflow_when_tries_to_send() &&
                        !jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled")
                    ) {
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").prop("disabled", true);
                        _compose__WEBPACK_IMPORTED_MODULE_3__.finish();
                    }
                    return;
                }

                handle_enter(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea"), e);
            }
        } else if (on_stream || on_topic || on_pm) {
            // We are doing the focusing on keyup to not abort the typeahead.
            if (on_stream) {
                $nextFocus = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_topic");
            } else if (on_topic) {
                $nextFocus = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea");
            } else if (on_pm) {
                $nextFocus = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea");
            }
        }
    }
}

function handle_keyup(e) {
    if (
        // Enter key or Tab key
        (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e) || (e.key === "Tab" && !e.shiftKey)) &&
        $nextFocus
    ) {
        $nextFocus.trigger("focus");
        $nextFocus = false;

        // Prevent the form from submitting
        e.preventDefault();
    }
}

function split_at_cursor(query, $input) {
    const cursor = $input.caret();
    return [query.slice(0, cursor), query.slice(cursor)];
}

function tokenize_compose_str(s) {
    // This basically finds a token like "@alic" or
    // "#Veron" as close to the end of the string as it
    // can find it.  It wants to find white space or
    // punctuation before the token, unless it's at the
    // beginning of the line.  It doesn't matter what comes
    // after the first character.
    let i = s.length;

    let min_i = s.length - 25;
    if (min_i < 0) {
        min_i = 0;
    }

    while (i > min_i) {
        i -= 1;
        switch (s[i]) {
            case "`":
            case "~":
                // Code block must start on a new line
                if (i === 2) {
                    return s;
                } else if (i > 2 && s[i - 3] === "\n") {
                    return s.slice(i - 2);
                }
                break;
            case "/":
                if (i === 0) {
                    return s;
                }
                break;
            case "#":
            case "@":
            case ":":
            case "_":
                if (i === 0) {
                    return s;
                } else if (/[\s"'(/<[{]/.test(s[i - 1])) {
                    return s.slice(i);
                }
                break;
            case ">":
                // topic_jump
                //
                // If you hit `>` immediately after completing the typeahead for mentioning a stream,
                // this will reposition the user from.  If | is the cursor, implements:
                //
                // `#**stream name** >|` => `#**stream name>|`.
                if (
                    s.slice(Math.max(0, i - 2), i) === "**" ||
                    s.slice(Math.max(0, i - 3), i) === "** "
                ) {
                    // return any string as long as its not ''.
                    return ">topic_jump";
                }
                // maybe topic_list; let's let the stream_topic_regex decide later.
                return ">topic_list";
        }
    }

    const timestamp_index = s.indexOf("<time");
    if (timestamp_index >= 0) {
        return s.slice(timestamp_index);
    }

    return "";
}

function broadcast_mentions() {
    const wildcard_mention_array = ["all", "everyone"];
    let wildcard_string = "";
    if (_compose_state__WEBPACK_IMPORTED_MODULE_5__.get_message_type() === "private") {
        wildcard_string = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Notify recipients"});
    } else {
        wildcard_string = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Notify stream"});
        wildcard_mention_array.push("stream");
    }
    return wildcard_mention_array.map((mention, idx) => ({
        special_item_text: `${mention} (${wildcard_string})`,
        email: mention,

        // Always sort above, under the assumption that names will
        // be longer and only contain "all" as a substring.
        pm_recipient_count: Number.POSITIVE_INFINITY,

        full_name: mention,
        is_broadcast: true,

        // used for sorting
        idx,
    }));
}

function filter_mention_name(current_token) {
    if (current_token.startsWith("**")) {
        current_token = current_token.slice(2);
    } else if (current_token.startsWith("*")) {
        current_token = current_token.slice(1);
    }
    if (current_token.lastIndexOf("*") !== -1) {
        return false;
    }

    // Don't autocomplete if there is a space following an '@'
    if (current_token[0] === " ") {
        return false;
    }
    return current_token;
}

function should_show_custom_query(query, items) {
    // returns true if the custom query doesn't match one of the
    // choices in the items list.
    if (!query) {
        return false;
    }
    const matched = items.some((elem) => elem.toLowerCase() === query.toLowerCase());
    return !matched;
}

const slash_commands = [
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/dark (Switch to the dark theme)"}),
        name: "dark",
        aliases: "night",
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/fixed-width (Toggle fixed width mode)"}),
        name: "fixed-width",
        aliases: "",
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/fluid-width (Toggle fluid width mode)"}),
        name: "fluid-width",
        aliases: "",
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/light (Switch to light theme)"}),
        name: "light",
        aliases: "day",
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/me is excited (Display action text)"}),
        name: "me",
        aliases: "",
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/poll Where should we go to lunch today? (Create a poll)"}),
        name: "poll",
        aliases: "",
        placeholder: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Question"}),
    },
    {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "/todo (Create a todo list)"}),
        name: "todo",
        aliases: "",
    },
];

function filter_and_sort_mentions(is_silent, query, opts) {
    opts = {
        want_broadcast: !is_silent,
        filter_pills: false,
        ...opts,
    };
    return get_person_suggestions(query, opts);
}

function get_pm_people(query) {
    const opts = {
        want_broadcast: false,
        filter_pills: true,
    };
    return get_person_suggestions(query, opts);
}

function get_person_suggestions(query, opts) {
    query = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.clean_query_lowercase(query);

    function filter_persons(all_persons) {
        let persons;

        if (opts.filter_pills) {
            persons = _compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__.filter_taken_users(all_persons);
        } else {
            persons = all_persons;
        }
        // Exclude muted users from typeaheads.
        persons = _muted_users__WEBPACK_IMPORTED_MODULE_12__.filter_muted_users(persons);

        if (opts.want_broadcast) {
            persons = persons.concat(broadcast_mentions());
        }

        return persons.filter((item) => query_matches_person(query, item));
    }

    const groups = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    const filtered_groups = groups.filter((item) => query_matches_name(query, item));

    /*
        Let's say you're on a big realm and type
        "st" in a typeahead.  Maybe there are like
        30 people named Steve/Stephanie/etc.  We don't
        want those search results to squeeze out
        groups like "staff", and we also want to
        prefer Steve Yang over Stan Adams if the
        former has sent messages recently, despite
        the latter being first alphabetically.

        Also, from a performance standpoint, we can
        save some expensive work if we get enough
        matches from the more selective group of
        people.

        Note that we don't actually guarantee that we
        won't squeeze out groups here, but we make it
        less likely by removing some users from
        consideration.  (The sorting step will favor
        persons who match on prefix to groups who
        match on prefix.)
    */
    const cutoff_length = max_num_items;

    const filtered_message_persons = filter_persons(_people__WEBPACK_IMPORTED_MODULE_13__.get_active_message_people());

    let filtered_persons;

    if (filtered_message_persons.length >= cutoff_length) {
        filtered_persons = filtered_message_persons;
    } else {
        filtered_persons = filter_persons(_people__WEBPACK_IMPORTED_MODULE_13__.get_realm_users());
    }

    return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sort_recipients({
        users: filtered_persons,
        query,
        current_stream: opts.stream,
        current_topic: opts.topic,
        groups: filtered_groups,
        max_num_items,
    });
}

function get_stream_topic_data(hacky_this) {
    const opts = {};
    const $message_row = hacky_this.$element.closest(".message_row");
    if ($message_row.length === 1) {
        // we are editing a message so we try to use it's keys.
        const msg = _message_store__WEBPACK_IMPORTED_MODULE_11__.get(_rows__WEBPACK_IMPORTED_MODULE_14__.id($message_row));
        if (msg.type === "stream") {
            opts.stream = msg.stream;
            opts.topic = msg.topic;
        }
    } else {
        opts.stream = _compose_state__WEBPACK_IMPORTED_MODULE_5__.stream_name();
        opts.topic = _compose_state__WEBPACK_IMPORTED_MODULE_5__.topic();
    }
    return opts;
}

function get_sorted_filtered_items(query) {
    /*
        This is just a "glue" function to work
        around bootstrap.  We want to control these
        three steps ourselves:

            - get data
            - filter data
            - sort data

        If we do it ourselves, we can convert some
        O(N) behavior to just O(1) time.

        For example, we want to avoid dispatching
        on completing every time through the loop, plus
        doing the same token cleanup every time.

        It's also a bit easier to debug typeahead when
        it's all one step, instead of three callbacks.

        (We did the same thing for search suggestions
        several years ago.)
    */

    const fetcher = get_candidates.bind(this);
    const big_results = fetcher(query);

    if (!big_results) {
        return false;
    }

    // We are still hacking info onto the "this" from
    // bootstrap.  Yuck.
    const completing = this.completing;
    const token = this.token;

    const opts = get_stream_topic_data(this);

    if (completing === "mention" || completing === "silent_mention") {
        return filter_and_sort_mentions(big_results.is_silent, token, opts);
    }

    return filter_and_sort_candidates(completing, big_results, token);
}

function filter_and_sort_candidates(completing, candidates, token) {
    const matcher = compose_content_matcher(completing, token);

    const small_results = candidates.filter((item) => matcher(item));

    const sorted_results = sort_results(completing, small_results, token);

    return sorted_results;
}

function get_candidates(query) {
    const split = split_at_cursor(query, this.$element);
    let current_token = tokenize_compose_str(split[0]);
    if (current_token === "") {
        return false;
    }
    const rest = split[1];

    // If the remaining content after the mention isn't a space or
    // punctuation (or end of the message), don't try to typeahead; we
    // probably just have the cursor in the middle of an
    // already-completed object.

    // We will likely want to extend this list to be more i18n-friendly.
    const terminal_symbols = ",.;?!()[]> \"'\n\t";
    if (rest !== "" && !terminal_symbols.includes(rest[0])) {
        return false;
    }

    // Start syntax highlighting autocompleter if the first three characters are ```
    const syntax_token = current_token.slice(0, 3);
    if (this.options.completions.syntax && (syntax_token === "```" || syntax_token === "~~~")) {
        // Only autocomplete if user starts typing a language after ```
        if (current_token.length === 3) {
            return false;
        }

        // If the only input is a space, don't autocomplete
        current_token = current_token.slice(3);
        if (current_token === " ") {
            return false;
        }

        // Trim the first whitespace if it is there
        if (current_token[0] === " ") {
            current_token = current_token.slice(1);
        }
        this.completing = "syntax";
        this.token = current_token;
        return Object.keys(pygments_data.langs);
    }

    // Only start the emoji autocompleter if : is directly after one
    // of the whitespace or punctuation chars we split on.
    if (this.options.completions.emoji && current_token[0] === ":") {
        // We don't want to match non-emoji emoticons such
        // as :P or :-p
        // Also, if the user has only typed a colon and nothing after,
        // no need to match yet.
        if (/^:-.?$/.test(current_token) || /^:[^+a-z]?$/.test(current_token)) {
            return false;
        }
        // Don't autocomplete if there is a space following a ':'
        if (current_token[1] === " ") {
            return false;
        }
        this.completing = "emoji";
        this.token = current_token.slice(1);
        return emoji_collection;
    }

    if (this.options.completions.mention && current_token[0] === "@") {
        current_token = current_token.slice(1);
        this.completing = "mention";
        // Silent mentions
        let is_silent = false;
        if (current_token.startsWith("_")) {
            this.completing = "silent_mention";
            is_silent = true;
            current_token = current_token.slice(1);
        }
        current_token = filter_mention_name(current_token);
        if (!current_token && typeof current_token === "boolean") {
            this.completing = null;
            return false;
        }
        this.token = current_token;
        return {is_silent};
    }

    function get_slash_commands_data() {
        const commands = slash_commands;
        return commands;
    }

    if (this.options.completions.slash && current_token[0] === "/") {
        current_token = current_token.slice(1);

        this.completing = "slash";
        this.token = current_token;
        return get_slash_commands_data();
    }

    if (this.options.completions.stream && current_token[0] === "#") {
        if (current_token.length === 1) {
            return false;
        }

        current_token = current_token.slice(1);
        if (current_token.startsWith("**")) {
            current_token = current_token.slice(2);
        }

        // Don't autocomplete if there is a space following a '#'
        if (current_token[0] === " ") {
            return false;
        }

        this.completing = "stream";
        this.token = current_token;
        return _stream_data__WEBPACK_IMPORTED_MODULE_15__.get_unsorted_subs();
    }

    if (this.options.completions.topic) {
        // Stream regex modified from marked.js
        // Matches '#**stream name** >' at the end of a split.
        const stream_regex = /#\*\*([^*>]+)\*\*\s?>$/;
        const should_jump_inside_typeahead = stream_regex.test(split[0]);
        if (should_jump_inside_typeahead) {
            this.completing = "topic_jump";
            this.token = ">";
            // We return something so that the typeahead is shown, but ultimately
            return [""];
        }

        // Matches '#**stream name>some text' at the end of a split.
        const stream_topic_regex = /#\*\*([^*>]+)>([^*]*)$/;
        const should_begin_typeahead = stream_topic_regex.test(split[0]);
        if (should_begin_typeahead) {
            this.completing = "topic_list";
            const tokens = stream_topic_regex.exec(split[0]);
            if (tokens[1]) {
                const stream_name = tokens[1];
                this.token = tokens[2] || "";

                // Don't autocomplete if there is a space following '>'
                if (this.token[0] === " ") {
                    return false;
                }

                const topic_list = topics_seen_for(stream_name);
                if (should_show_custom_query(this.token, topic_list)) {
                    topic_list.push(this.token);
                }
                return topic_list;
            }
        }
    }
    if (this.options.completions.timestamp) {
        const time_jump_regex = /<time(:([^>]*?)>?)?$/;
        if (time_jump_regex.test(split[0])) {
            this.completing = "time_jump";
            return [Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Mention a time-zone-aware time"})];
        }
    }
    return false;
}

function content_highlighter(item) {
    switch (this.completing) {
        case "emoji":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_emoji(item);
        case "mention":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_person_or_user_group(item);
        case "silent_mention":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_person_or_user_group(item);
        case "slash":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({
                primary: item.text,
            });
        case "stream":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_stream(item);
        case "syntax":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        case "topic_jump":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        case "topic_list":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        case "time_jump":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        default:
            return undefined;
    }
}

function content_typeahead_selected(item, event) {
    const pieces = split_at_cursor(this.query, this.$element);
    let beginning = pieces[0];
    let rest = pieces[1];
    const $textbox = this.$element;
    // Accepting some typeahead selections, like polls, will generate
    // placeholder text that is selected, in order to clarify for the
    // user what a given parameter is for. This object stores the
    // highlight offsets for that purpose.
    const highlight = {};

    switch (this.completing) {
        case "emoji":
            // leading and trailing spaces are required for emoji,
            // except if it begins a message or a new line.
            if (
                beginning.lastIndexOf(":") === 0 ||
                beginning.charAt(beginning.lastIndexOf(":") - 1) === " " ||
                beginning.charAt(beginning.lastIndexOf(":") - 1) === "\n"
            ) {
                beginning =
                    beginning.slice(0, -this.token.length - 1) + ":" + item.emoji_name + ": ";
            } else {
                beginning =
                    beginning.slice(0, -this.token.length - 1) + " :" + item.emoji_name + ": ";
            }
            break;
        case "silent_mention":
        case "mention": {
            const is_silent = this.completing === "silent_mention";
            beginning = beginning.slice(0, -this.token.length - 1);
            if (beginning.endsWith("@_*")) {
                beginning = beginning.slice(0, -3);
            } else if (beginning.endsWith("@*") || beginning.endsWith("@_")) {
                beginning = beginning.slice(0, -2);
            } else if (beginning.endsWith("@")) {
                beginning = beginning.slice(0, -1);
            }
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
                let user_group_mention_text = is_silent ? "@_*" : "@*";
                user_group_mention_text += item.name + "* ";
                beginning += user_group_mention_text;
                // We could theoretically warn folks if they are
                // mentioning a user group that literally has zero
                // members where we are posting to, but we don't have
                // that functionality yet, and we haven't gotten much
                // feedback on this being an actual pitfall.
            } else {
                const mention_text = _people__WEBPACK_IMPORTED_MODULE_13__.get_mention_syntax(
                    item.full_name,
                    item.user_id,
                    is_silent,
                );
                beginning += mention_text + " ";
                if (!is_silent) {
                    _compose_validate__WEBPACK_IMPORTED_MODULE_7__.warn_if_mentioning_unsubscribed_user(item);
                }
            }
            break;
        }
        case "slash":
            beginning = beginning.slice(0, -this.token.length - 1) + "/" + item.name + " ";
            if (item.placeholder) {
                beginning = beginning + item.placeholder;
                highlight.start = item.name.length + 2;
                highlight.end = highlight.start + item.placeholder.length;
            }
            break;
        case "stream":
            beginning = beginning.slice(0, -this.token.length - 1);
            if (beginning.endsWith("#*")) {
                beginning = beginning.slice(0, -2);
            }
            beginning += "#**" + item.name;
            if (event && event.key === ">") {
                // Normally, one accepts typeahead with `Tab` or `Enter`, but when completing
                // stream typeahead, we allow `>`, the delimiter for stream+topic mentions,
                // as a completion that automatically sets up stream+topic typeahead for you.
                beginning += ">";
            } else {
                beginning += "** ";
            }
            _compose_validate__WEBPACK_IMPORTED_MODULE_7__.warn_if_private_stream_is_linked(item);
            break;
        case "syntax": {
            // Isolate the end index of the triple backticks/tildes, including
            // possibly a space afterward
            const backticks = beginning.length - this.token.length;
            beginning = beginning.slice(0, backticks) + item;
            if (item === "spoiler") {
                // to add in and highlight placeholder "Header"
                const placeholder = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Header"});
                highlight.start = beginning.length + 1;
                beginning = beginning + " " + placeholder;
                highlight.end = highlight.start + placeholder.length;
            }
            // If cursor is at end of input ("rest" is empty), then
            // add a closing fence after the cursor
            // If there is more text after the cursor, then don't
            // touch "rest" (i.e. do not add a closing fence)
            if (rest === "") {
                beginning = beginning + "\n";
                rest = "\n" + beginning.slice(Math.max(0, backticks - 4), backticks).trim() + rest;
            }
            break;
        }
        case "topic_jump": {
            // Put the cursor at the end of immediately preceding stream mention syntax,
            // just before where the `**` at the end of the syntax.  This will delete that
            // final ** and set things up for the topic_list typeahead.
            const index = beginning.lastIndexOf("**");
            if (index !== -1) {
                beginning = beginning.slice(0, index) + ">";
            }
            break;
        }
        case "topic_list": {
            // Stream + topic mention typeahead; close the stream+topic mention syntax
            // with the topic and the final **.  Note that this.token.length can be 0
            // if we are completing from `**streamname>`.
            const start = beginning.length - this.token.length;
            beginning = beginning.slice(0, start) + item + "** ";
            break;
        }
        case "time_jump": {
            let timestring = beginning.slice(Math.max(0, beginning.lastIndexOf("<time:")));
            if (timestring.startsWith("<time:") && timestring.endsWith(">")) {
                timestring = timestring.slice(6, -1);
            }
            const timestamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(timestring);

            const on_timestamp_selection = (val) => {
                const datestr = val;
                beginning =
                    beginning.slice(0, Math.max(0, beginning.lastIndexOf("<time"))) +
                    `<time:${datestr}> `;
                if (rest.startsWith(">")) {
                    rest = rest.slice(1);
                }
                $textbox.val(beginning + rest);
                $textbox.caret(beginning.length, beginning.length);
                _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea($textbox);
            };
            _flatpickr__WEBPACK_IMPORTED_MODULE_9__.show_flatpickr(this.$element[0], on_timestamp_selection, timestamp);
            return beginning + rest;
        }
    }

    // Keep the cursor after the newly inserted text / selecting the
    // placeholder text, as Bootstrap will call $textbox.change() to
    // overwrite the text in the textbox.
    setTimeout(() => {
        // Select any placeholder text configured to be highlighted.
        if (highlight.start && highlight.end) {
            $textbox.range(highlight.start, highlight.end);
        } else {
            $textbox.caret(beginning.length, beginning.length);
        }
        // Also, trigger autosize to check if compose box needs to be resized.
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea($textbox);
    }, 0);
    return beginning + rest;
}

function compose_content_matcher(completing, token) {
    switch (completing) {
        case "emoji":
            return _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.get_emoji_matcher(token);
        case "slash":
            return get_slash_matcher(token);
        case "stream":
            return get_stream_or_user_group_matcher(token);
        case "syntax":
            return get_language_matcher(token);
        case "topic_list":
            return get_topic_matcher(token);
    }

    return function () {
        switch (completing) {
            case "topic_jump":
            case "time_jump":
                // these don't actually have a typeahead popover, so we return quickly here.
                return true;
            default:
                return undefined;
        }
    };
}

function sort_results(completing, matches, token) {
    switch (completing) {
        case "emoji":
            return _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.sort_emojis(matches, token);
        case "slash":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sort_slash_commands(matches, token);
        case "stream":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sort_streams(matches, token);
        case "syntax":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sort_languages(matches, token);
        case "topic_jump":
        case "time_jump":
            // topic_jump doesn't actually have a typeahead popover, so we return quickly here.
            return matches;
        case "topic_list":
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sorter(token, matches, (x) => x);
        default:
            return undefined;
    }
}

function compose_automated_selection() {
    if (this.completing === "topic_jump") {
        // automatically jump inside stream mention on typing > just after
        // a stream mention, to begin stream+topic mention typeahead (topic_list).
        return true;
    }
    return false;
}

function compose_trigger_selection(event) {
    if (this.completing === "stream" && event.key === ">") {
        // complete stream typeahead partially to immediately start the topic_list typeahead.
        return true;
    }
    return false;
}

function initialize_topic_edit_typeahead(form_field, stream_name, dropup) {
    const options = {
        fixed: true,
        dropup,
        highlighter(item) {
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        },
        sorter(items) {
            const sorted = _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sorter(this.query, items, (x) => x);
            if (sorted.length > 0 && !sorted.includes(this.query)) {
                sorted.unshift(this.query);
            }
            return sorted;
        },
        source() {
            return topics_seen_for(stream_name);
        },
        items: 5,
    };
    form_field.typeahead(options);
}

function get_header_html() {
    let tip_text = "";
    switch (this.completing) {
        case "stream":
            tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Press > for list of topics"});
            break;
        case "silent_mention":
            tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Silent mentions do not trigger notifications."});
            break;
        case "syntax":
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== null) {
                tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: "Default is {language}. Use 'text' to disable highlighting."},
                    {language: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())},
                );
                break;
            }
            return false;
        default:
            return false;
    }
    return `<em>${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(tip_text)}</em>`;
}

function initialize_compose_typeahead(selector) {
    const completions = {
        mention: true,
        emoji: true,
        silent_mention: true,
        slash: true,
        stream: true,
        syntax: true,
        topic: true,
        timestamp: true,
    };

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(selector).typeahead({
        items: max_num_items,
        dropup: true,
        fixed: true,
        // Performance note: We have trivial matcher/sorters to do
        // matching and sorting inside the `source` field to avoid
        // O(n) behavior in the number of users in the organization
        // inside the typeahead library.
        source: get_sorted_filtered_items,
        highlighter: content_highlighter,
        matcher() {
            return true;
        },
        sorter(items) {
            return items;
        },
        updater: content_typeahead_selected,
        stopAdvance: true, // Do not advance to the next field on a Tab or Enter
        completions,
        automated: compose_automated_selection,
        trigger_selection: compose_trigger_selection,
        header: get_header_html,
    });
}

function initialize() {
    update_emoji_data();

    // These handlers are at the "form" level so that they are called after typeahead
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("form#send_message_form").on("keydown", handle_keydown);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("form#send_message_form").on("keyup", handle_keyup);

    // limit number of items so the list doesn't fall off the screen
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream").typeahead({
        source() {
            return _stream_data__WEBPACK_IMPORTED_MODULE_15__.subscribed_streams();
        },
        items: 3,
        fixed: true,
        highlighter(item) {
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        },
        matcher(item) {
            // The matcher for "stream" is strictly prefix-based,
            // because we want to avoid mixing up streams.
            const q = this.query.trim().toLowerCase();
            return item.toLowerCase().startsWith(q);
        },
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_topic").typeahead({
        source() {
            const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_5__.stream_name();
            return topics_seen_for(stream_name);
        },
        items: 3,
        fixed: true,
        highlighter(item) {
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_typeahead_item({primary: item});
        },
        sorter(items) {
            const sorted = _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.sorter(this.query, items, (x) => x);
            if (sorted.length > 0 && !sorted.includes(this.query)) {
                sorted.unshift(this.query);
            }
            return sorted;
        },
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient").typeahead({
        source: get_pm_people,
        items: max_num_items,
        dropup: true,
        fixed: true,
        highlighter(item) {
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.render_person_or_user_group(item);
        },
        matcher() {
            return true;
        },
        sorter(items) {
            return items;
        },
        updater(item) {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
                for (const user_id of item.members) {
                    const user = _people__WEBPACK_IMPORTED_MODULE_13__.get_by_user_id(user_id);
                    // filter out inserted users and current user from pill insertion
                    const inserted_users = _user_pill__WEBPACK_IMPORTED_MODULE_19__.get_user_ids(_compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__.widget);
                    const current_user = _people__WEBPACK_IMPORTED_MODULE_13__.is_current_user(user.email);
                    if (!inserted_users.includes(user.user_id) && !current_user) {
                        _compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__.set_from_typeahead(user);
                    }
                }
                // clear input pill in the event no pills were added
                const pill_widget = _compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__.widget;
                if (pill_widget.clear_text !== undefined) {
                    pill_widget.clear_text();
                }
            } else {
                _compose_pm_pill__WEBPACK_IMPORTED_MODULE_4__.set_from_typeahead(item);
            }
        },
        stopAdvance: true, // Do not advance to the next field on a Tab or Enter
    });

    initialize_compose_typeahead("#compose-textarea");

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_message_recipient").on("blur", function () {
        const val = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val();
        const recipients = _typeahead_helper__WEBPACK_IMPORTED_MODULE_18__.get_cleaned_pm_recipients(val);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val(recipients.join(", "));
    });
}


/***/ }),

/***/ "./static/js/condense.js":
/*!*******************************!*\
  !*** ./static/js/condense.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_message_content_height_cache": () => (/* binding */ clear_message_content_height_cache),
/* harmony export */   "collapse": () => (/* binding */ collapse),
/* harmony export */   "condense_and_collapse": () => (/* binding */ condense_and_collapse),
/* harmony export */   "hide_message_condenser": () => (/* binding */ hide_message_condenser),
/* harmony export */   "hide_message_expander": () => (/* binding */ hide_message_expander),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "show_message_condenser": () => (/* binding */ show_message_condenser),
/* harmony export */   "show_message_expander": () => (/* binding */ show_message_expander),
/* harmony export */   "toggle_collapse": () => (/* binding */ toggle_collapse),
/* harmony export */   "un_cache_message_content_height": () => (/* binding */ un_cache_message_content_height),
/* harmony export */   "uncollapse": () => (/* binding */ uncollapse)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _message_flags__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_flags */ "./static/js/message_flags.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");








/*
This library implements two related, similar concepts:

- condensing, i.e. cutting off messages taller than about a half
  screen so that they aren't distractingly tall (and offering a button
  to uncondense them).

- Collapsing, i.e. taking a message and reducing its height to a
  single line, with a button to see the content.

*/

const _message_content_height_cache = new Map();

function show_more_link($row) {
    $row.find(".message_condenser").hide();
    $row.find(".message_expander").show();
}

function show_condense_link($row) {
    $row.find(".message_expander").hide();
    $row.find(".message_condenser").show();
}

function condense_row($row) {
    const $content = $row.find(".message_content");
    $content.addClass("condensed");
    show_more_link($row);
}

function uncondense_row($row) {
    const $content = $row.find(".message_content");
    $content.removeClass("condensed");
    show_condense_link($row);
}

function uncollapse($row) {
    // Uncollapse a message, restoring the condensed message [More] or
    // [Show less] link if necessary.
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));
    message.collapsed = false;
    _message_flags__WEBPACK_IMPORTED_MODULE_1__.save_uncollapsed(message);

    const process_row = function process_row($row) {
        const $content = $row.find(".message_content");
        $content.removeClass("collapsed");

        if (message.condensed === true) {
            // This message was condensed by the user, so re-show the
            // [More] link.
            condense_row($row);
        } else if (message.condensed === false) {
            // This message was un-condensed by the user, so re-show the
            // [Show less] link.
            uncondense_row($row);
        } else if ($content.hasClass("could-be-condensed")) {
            // By default, condense a long message.
            condense_row($row);
        } else {
            // This was a short message, no more need for a [More] link.
            $row.find(".message_expander").hide();
        }
    };

    // We also need to collapse this message in the home view
    const $home_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.home.get_row(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));

    process_row($row);
    process_row($home_row);
}

function collapse($row) {
    // Collapse a message, hiding the condensed message [More] or
    // [Show less] link if necessary.
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));
    message.collapsed = true;

    if (message.locally_echoed) {
        // Trying to collapse a locally echoed message is
        // very rare, and in our current implementation the
        // server response overwrites the flag, so we just
        // punt for now.
        return;
    }

    _message_flags__WEBPACK_IMPORTED_MODULE_1__.save_collapsed(message);

    const process_row = function process_row($row) {
        $row.find(".message_content").addClass("collapsed");
        show_more_link($row);
    };

    // We also need to collapse this message in the home view
    const $home_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.home.get_row(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));

    process_row($row);
    process_row($home_row);
}

function toggle_collapse(message) {
    if (message.is_me_message) {
        // Disabled temporarily because /me messages don't have a
        // styling for collapsing /me messages (they only recently
        // added multi-line support).  See also popovers.js.
        return;
    }

    // This function implements a multi-way toggle, to try to do what
    // the user wants for messages:
    //
    // * If the message is currently showing any [More] link, either
    //   because it was previously condensed or collapsed, fully display it.
    // * If the message is fully visible, either because it's too short to
    //   condense or because it's already uncondensed, collapse it

    const $row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get_row(message.id);
    if (!$row) {
        return;
    }

    const $content = $row.find(".message_content");
    const is_condensable = $content.hasClass("could-be-condensed");
    const is_condensed = $content.hasClass("condensed");
    if (message.collapsed) {
        if (is_condensable) {
            message.condensed = true;
            $content.addClass("condensed");
            show_message_expander($row);
            $row.find(".message_condenser").hide();
        }
        uncollapse($row);
    } else {
        if (is_condensed) {
            message.condensed = false;
            $content.removeClass("condensed");
            hide_message_expander($row);
            $row.find(".message_condenser").show();
        } else {
            collapse($row);
        }
    }
}

function clear_message_content_height_cache() {
    _message_content_height_cache.clear();
}

function un_cache_message_content_height(message_id) {
    _message_content_height_cache.delete(message_id);
}

function get_message_height(elem, message_id) {
    if (_message_content_height_cache.has(message_id)) {
        return _message_content_height_cache.get(message_id);
    }

    // shown to be ~2.5x faster than Node.getBoundingClientRect().
    const height = elem.offsetHeight;
    if (!_recent_topics_util__WEBPACK_IMPORTED_MODULE_4__.is_visible()) {
        _message_content_height_cache.set(message_id, height);
    }
    return height;
}

function hide_message_expander($row) {
    if ($row.find(".could-be-condensed").length !== 0) {
        $row.find(".message_expander").hide();
    }
}

function hide_message_condenser($row) {
    if ($row.find(".could-be-condensed").length !== 0) {
        $row.find(".message_condenser").hide();
    }
}

function show_message_expander($row) {
    if ($row.find(".could-be-condensed").length !== 0) {
        $row.find(".message_expander").show();
    }
}

function show_message_condenser($row) {
    if ($row.find(".could-be-condensed").length !== 0) {
        $row.find(".message_condenser").show();
    }
}

function condense_and_collapse(elems) {
    const height_cutoff = _message_viewport__WEBPACK_IMPORTED_MODULE_3__.height() * 0.65;

    for (const elem of elems) {
        const $content = jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).find(".message_content");

        if ($content.length !== 1) {
            // We could have a "/me did this" message or something
            // else without a `message_content` div.
            continue;
        }

        const message_id = _rows__WEBPACK_IMPORTED_MODULE_5__.id(jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem));

        if (!message_id) {
            continue;
        }

        const message = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(message_id);
        if (message === undefined) {
            continue;
        }

        const message_height = get_message_height(elem, message.id);
        const long_message = message_height > height_cutoff;
        if (long_message) {
            // All long messages are flagged as such.
            $content.addClass("could-be-condensed");
        } else {
            $content.removeClass("could-be-condensed");
        }

        // If message.condensed is defined, then the user has manually
        // specified whether this message should be expanded or condensed.
        if (message.condensed === true) {
            condense_row(jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem));
            continue;
        }

        if (message.condensed === false) {
            uncondense_row(jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem));
            continue;
        }

        if (long_message) {
            // By default, condense a long message.
            condense_row(jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem));
        } else {
            $content.removeClass("condensed");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).find(".message_expander").hide();
        }

        // Completely hide the message and replace it with a [More]
        // link if the user has collapsed it.
        if (message.collapsed) {
            $content.addClass("collapsed");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).find(".message_expander").show();
        }
    }
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_feed_container").on("click", ".message_expander", function (e) {
        // Expanding a message can mean either uncollapsing or
        // uncondensing it.
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".message_row");
        const message = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));
        const $content = $row.find(".message_content");
        if (message.collapsed) {
            // Uncollapse.
            uncollapse($row);
        } else if ($content.hasClass("condensed")) {
            // Uncondense (show the full long message).
            message.condensed = false;
            $content.removeClass("condensed");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).hide();
            $row.find(".message_condenser").show();
        }
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_feed_container").on("click", ".message_condenser", function (e) {
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".message_row");
        _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row)).condensed = true;
        condense_row($row);
        e.stopPropagation();
        e.preventDefault();
    });
}


/***/ }),

/***/ "./static/js/confirm_dialog.js":
/*!*************************************!*\
  !*** ./static/js/confirm_dialog.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "launch": () => (/* binding */ launch)
/* harmony export */ });
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



function launch(conf) {
    _dialog_widget__WEBPACK_IMPORTED_MODULE_0__.launch({
        ...conf,
        close_on_submit: true,
        focus_submit_on_open: true,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Confirm"}),
        // Used to control button colors in the template.
    });
}


/***/ }),

/***/ "./static/js/copy_and_paste.js":
/*!*************************************!*\
  !*** ./static/js/copy_and_paste.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "analyze_selection": () => (/* binding */ analyze_selection),
/* harmony export */   "copy_handler": () => (/* binding */ copy_handler),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "paste_handler": () => (/* binding */ paste_handler),
/* harmony export */   "paste_handler_converter": () => (/* binding */ paste_handler_converter)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var turndown__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! turndown */ "./node_modules/turndown/lib/turndown.browser.es.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");








function find_boundary_tr($initial_tr, iterate_row) {
    let j;
    let skip_same_td_check = false;
    let $tr = $initial_tr;

    // If the selection boundary is somewhere that does not have a
    // parent tr, we should let the browser handle the copy-paste
    // entirely on its own
    if ($tr.length === 0) {
        return undefined;
    }

    // If the selection boundary is on a table row that does not have an
    // associated message id (because the user clicked between messages),
    // then scan downwards until we hit a table row with a message id.
    // To ensure we can't enter an infinite loop, bail out (and let the
    // browser handle the copy-paste on its own) if we don't hit what we
    // are looking for within 10 rows.
    for (j = 0; !$tr.is(".message_row") && j < 10; j += 1) {
        $tr = iterate_row($tr);
    }
    if (j === 10) {
        return undefined;
    } else if (j !== 0) {
        // If we updated tr, then we are not dealing with a selection
        // that is entirely within one td, and we can skip the same td
        // check (In fact, we need to because it won't work correctly
        // in this case)
        skip_same_td_check = true;
    }
    return [_rows__WEBPACK_IMPORTED_MODULE_5__.id($tr), skip_same_td_check];
}

function construct_recipient_header($message_row) {
    const message_header_content = _rows__WEBPACK_IMPORTED_MODULE_5__.get_message_recipient_header($message_row)
        .text()
        .replace(/\s+/g, " ")
        .replace(/^\s/, "")
        .replace(/\s$/, "");
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("<p>").append(jquery__WEBPACK_IMPORTED_MODULE_0___default()("<strong>").text(message_header_content));
}

/*
The techniques we use in this code date back to
2013 and may be obsolete today (and may not have
been even the best workaround back then).

https://github.com/zulip/zulip/commit/fc0b7c00f16316a554349f0ad58c6517ebdd7ac4

The idea is that we build a temp div, let jQuery process the
selection, then restore the selection on a zero-second timer back
to the original selection.

Do not be afraid to change this code if you understand
how modern browsers deal with copy/paste.  Just test
your changes carefully.
*/
function construct_copy_div($div, start_id, end_id) {
    const copy_rows = _rows__WEBPACK_IMPORTED_MODULE_5__.visible_range(start_id, end_id);

    const $start_row = copy_rows[0];
    const $start_recipient_row = _rows__WEBPACK_IMPORTED_MODULE_5__.get_message_recipient_row($start_row);
    const start_recipient_row_id = _rows__WEBPACK_IMPORTED_MODULE_5__.id_for_recipient_row($start_recipient_row);
    let should_include_start_recipient_header = false;
    let last_recipient_row_id = start_recipient_row_id;

    for (const $row of copy_rows) {
        const recipient_row_id = _rows__WEBPACK_IMPORTED_MODULE_5__.id_for_recipient_row(_rows__WEBPACK_IMPORTED_MODULE_5__.get_message_recipient_row($row));
        // if we found a message from another recipient,
        // it means that we have messages from several recipients,
        // so we have to add new recipient's bar to final copied message
        // and wouldn't forget to add start_recipient's bar at the beginning of final message
        if (recipient_row_id !== last_recipient_row_id) {
            $div.append(construct_recipient_header($row));
            last_recipient_row_id = recipient_row_id;
            should_include_start_recipient_header = true;
        }
        const message = _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.get(_rows__WEBPACK_IMPORTED_MODULE_5__.id($row));
        const $content = jquery__WEBPACK_IMPORTED_MODULE_0___default()(message.content);
        $content.first().prepend(message.sender_full_name + ": ");
        $div.append($content);
    }

    if (should_include_start_recipient_header) {
        $div.prepend(construct_recipient_header($start_row));
    }
}

function select_div($div, selection) {
    $div.css({
        position: "absolute",
        left: "-99999px",
        // Color and background is made according to "light theme"
        // exclusively here because when copying the content
        // into, say, Gmail compose box, the styles come along.
        // This is done to avoid copying the content with dark
        // background when using the app in dark theme.
        // We can avoid other custom styles since they are wrapped
        // inside another parent such as `.message_content`.
        color: "#333",
        background: "#FFF",
    }).attr("id", "copytempdiv");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append($div);
    selection.selectAllChildren($div[0]);
}

function remove_div(div, ranges, selection) {
    window.setTimeout(() => {
        selection = window.getSelection();
        selection.removeAllRanges();

        for (const range of ranges) {
            selection.addRange(range);
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#copytempdiv").remove();
    }, 0);
}

function copy_handler() {
    // This is the main handler for copying message content via
    // `Ctrl+C` in Zulip (note that this is totally independent of the
    // "select region" copy behavior on Linux; that is handled
    // entirely by the browser, our HTML layout, and our use of the
    // no-select/auto-select CSS classes).  We put considerable effort
    // into producing a nice result that pastes well into other tools.
    // Our user-facing specification is the following:
    //
    // * If the selection is contained within a single message, we
    //   want to just copy the portion that was selected, which we
    //   implement by letting the browser handle the Ctrl+C event.
    //
    // * Otherwise, we want to copy the bodies of all messages that
    //   were partially covered by the selection.

    const selection = window.getSelection();
    const analysis = analyze_selection(selection);
    const ranges = analysis.ranges;
    const start_id = analysis.start_id;
    const end_id = analysis.end_id;
    const skip_same_td_check = analysis.skip_same_td_check;
    const $div = jquery__WEBPACK_IMPORTED_MODULE_0___default()("<div>");

    if (start_id === undefined || end_id === undefined) {
        // In this case either the starting message or the ending
        // message is not defined, so this is definitely not a
        // multi-message selection and we can let the browser handle
        // the copy.
        document.execCommand("copy");
        return;
    }

    if (!skip_same_td_check && start_id === end_id) {
        // Check whether the selection both starts and ends in the
        // same message.  If so, Let the browser handle this.
        document.execCommand("copy");
        return;
    }

    // We've now decided to handle the copy event ourselves.
    //
    // We construct a temporary div for what we want the copy to pick up.
    // We construct the div only once, rather than for each range as we can
    // determine the starting and ending point with more confidence for the
    // whole selection. When constructing for each `Range`, there is a high
    // chance for overlaps between same message ids, avoiding which is much
    // more difficult since we can get a range (start_id and end_id) for
    // each selection `Range`.
    construct_copy_div($div, start_id, end_id);

    // Select div so that the browser will copy it
    // instead of copying the original selection
    select_div($div, selection);
    document.execCommand("copy");
    remove_div($div, ranges, selection);
}

function analyze_selection(selection) {
    // Here we analyze our selection to determine if part of a message
    // or multiple messages are selected.
    //
    // Firefox and Chrome handle selection of multiple messages
    // differently. Firefox typically creates multiple ranges for the
    // selection, whereas Chrome typically creates just one.
    //
    // Our goal in the below loop is to compute and be prepared to
    // analyze the combined range of the selections, and copy their
    // full content.

    let i;
    let range;
    const ranges = [];
    let $startc;
    let $endc;
    let $initial_end_tr;
    let start_id;
    let end_id;
    let start_data;
    let end_data;
    // skip_same_td_check is true whenever we know for a fact that the
    // selection covers multiple messages (and thus we should no
    // longer consider letting the browser handle the copy event).
    let skip_same_td_check = false;

    for (i = 0; i < selection.rangeCount; i += 1) {
        range = selection.getRangeAt(i);
        ranges.push(range);

        $startc = jquery__WEBPACK_IMPORTED_MODULE_0___default()(range.startContainer);
        start_data = find_boundary_tr(
            $startc.parents(".selectable_row, .message_header").first(),
            ($row) => $row.next(),
        );
        if (start_data === undefined) {
            // Skip any selection sections that don't intersect a message.
            continue;
        }
        if (start_id === undefined) {
            // start_id is the Zulip message ID of the first message
            // touched by the selection.
            start_id = start_data[0];
        }

        $endc = jquery__WEBPACK_IMPORTED_MODULE_0___default()(range.endContainer);
        $initial_end_tr = get_end_tr_from_endc($endc);
        end_data = find_boundary_tr($initial_end_tr, ($row) => $row.prev());

        if (end_data === undefined) {
            // Skip any selection sections that don't intersect a message.
            continue;
        }
        if (end_data[0] !== undefined) {
            end_id = end_data[0];
        }

        if (start_data[1] || end_data[1]) {
            // If the find_boundary_tr call for either the first or
            // the last message covered by the selection
            skip_same_td_check = true;
        }
    }

    return {
        ranges,
        start_id,
        end_id,
        skip_same_td_check,
    };
}

function get_end_tr_from_endc($endc) {
    if ($endc.attr("id") === "bottom_whitespace" || $endc.attr("id") === "compose_close") {
        // If the selection ends in the bottom whitespace, we should
        // act as though the selection ends on the final message.
        // This handles the issue that Chrome seems to like selecting
        // the compose_close button when you go off the end of the
        // last message
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_row").last();
    }

    // Sometimes (especially when three click selecting in Chrome) the selection
    // can end in a hidden element in e.g. the next message, a date divider.
    // We can tell this is the case because the selection isn't inside a
    // `messagebox-content` div, which is where the message text itself is.
    // TODO: Ideally make it so that the selection cannot end there.
    // For now, we find find the message row directly above wherever the
    // selection ended.
    if ($endc.closest(".messagebox-content").length === 0) {
        // If the selection ends within the message following the selected
        // messages, go back to use the actual last message.
        if ($endc.parents(".message_row").length > 0) {
            const $parent_msg = $endc.parents(".message_row").first();
            return $parent_msg.prev(".message_row");
        }
        // If it's not in a .message_row, it's probably in a .message_header and
        // we can use the last message from the previous recipient_row.
        if ($endc.parents(".message_header").length > 0) {
            const $overflow_recipient_row = $endc.parents(".recipient_row").first();
            return $overflow_recipient_row.prev(".recipient_row").last(".message_row");
        }
        // If somehow we get here, do the default return.
    }

    return $endc.parents(".selectable_row").first();
}

function paste_handler_converter(paste_html) {
    const turndownService = new turndown__WEBPACK_IMPORTED_MODULE_1__["default"]();
    turndownService.addRule("headings", {
        filter: ["h1", "h2", "h3", "h4", "h5", "h6"],
        replacement(content) {
            return content;
        },
    });
    turndownService.addRule("emphasis", {
        filter: ["em", "i"],
        replacement(content) {
            return "*" + content + "*";
        },
    });
    // Checks for raw links without custom text or title.
    turndownService.addRule("links", {
        filter(node) {
            return (
                node.nodeName === "A" && node.href === node.innerHTML && node.href === node.title
            );
        },
        replacement(content) {
            return content;
        },
    });

    let markdown_text = turndownService.turndown(paste_html);

    // Checks for escaped ordered list syntax.
    markdown_text = markdown_text.replace(/^(\W* {0,3})(\d+)\\\. /gm, "$1$2. ");

    // Removes newlines before the start of a list and between list elements.
    markdown_text = markdown_text.replace(/\n+([*+-])/g, "\n$1");
    return markdown_text;
}

function paste_handler(event) {
    const clipboardData = event.originalEvent.clipboardData;
    if (!clipboardData) {
        // On IE11, ClipboardData isn't defined.  One can instead
        // access it with `window.clipboardData`, but even that
        // doesn't support text/html, so this code path couldn't do
        // anything special anyway.  So we instead just let the
        // default paste handler run on IE11.
        return;
    }

    if (clipboardData.getData) {
        const paste_html = clipboardData.getData("text/html");
        if (paste_html && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            const text = paste_handler_converter(paste_html);
            const mdImageRegex = /^!\[.*]\(.*\)$/;
            if (mdImageRegex.test(text)) {
                // This block catches cases where we are pasting an
                // image into Zulip, which is handled by upload.js.
                return;
            }
            event.preventDefault();
            event.stopPropagation();
            _compose_ui__WEBPACK_IMPORTED_MODULE_2__.insert_syntax_and_focus(text);
        }
    }
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").on("paste", paste_handler);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("paste", ".message_edit_form", paste_handler);
}


/***/ }),

/***/ "./static/js/css_variables.js":
/*!************************************!*\
  !*** ./static/js/css_variables.js ***!
  \************************************/
/***/ ((module) => {

"use strict";
/* eslint-env commonjs */



// Media query breakpoints according to Bootstrap 4.5
const xs = 0;
const sm = 576;
const md = 768;
const lg = 992;
const xl = 1200;

// Breakpoints for mobile devices used by Google Chrome as of Version 86
const ml = 425; // Mobile large
const mm = 375; // Mobile medium
const ms = 320; // Mobile small

module.exports = {
    media_breakpoints: {
        xs_min: xs + "px",
        sm_min: sm + "px",
        md_min: md + "px",
        lg_min: lg + "px",
        xl_min: xl + "px",
        ml_min: ml + "px",
        mm_min: mm + "px",
        ms_min: ms + "px",
    },

    media_breakpoints_num: {
        xs,
        sm,
        md,
        lg,
        xl,
        ml,
        mm,
        ms,
    },
};


/***/ }),

/***/ "./static/js/dark_theme.js":
/*!*********************************!*\
  !*** ./static/js/dark_theme.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default_preference_checker": () => (/* binding */ default_preference_checker),
/* harmony export */   "disable": () => (/* binding */ disable),
/* harmony export */   "enable": () => (/* binding */ enable)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());





function enable() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(":root").removeClass("color-scheme-automatic").addClass("dark-theme");

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_1__.localstorage)();
        ls.set("spectator-theme-preference", "dark");
    }
}

function disable() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(":root").removeClass("color-scheme-automatic").removeClass("dark-theme");

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_1__.localstorage)();
        ls.set("spectator-theme-preference", "light");
    }
}

function default_preference_checker() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(":root").removeClass("dark-theme").addClass("color-scheme-automatic");
}


/***/ }),

/***/ "./static/js/deprecated_feature_notice.js":
/*!************************************************!*\
  !*** ./static/js/deprecated_feature_notice.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_hotkey_deprecation_notice": () => (/* binding */ get_hotkey_deprecation_notice),
/* harmony export */   "maybe_show_deprecation_notice": () => (/* binding */ maybe_show_deprecation_notice)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");






function get_hotkey_deprecation_notice(originalHotkey, replacementHotkey) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {
            defaultMessage:
                'We\'ve replaced the "{originalHotkey}" hotkey with "{replacementHotkey}" to make this common shortcut easier to trigger.',
        },
        {originalHotkey, replacementHotkey},
    );
}

let shown_deprecation_notices = [];

function maybe_show_deprecation_notice(key) {
    let message;
    const isCmdOrCtrl = Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ? "Cmd" : "Ctrl";
    if (key === "C") {
        message = get_hotkey_deprecation_notice("C", "x");
    } else if (key === "*") {
        message = get_hotkey_deprecation_notice("*", isCmdOrCtrl + " + s");
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected deprecation notice for hotkey:", key);
        return;
    }

    // Here we handle the tracking for showing deprecation notices,
    // whether or not local storage is available.
    if (_localstorage__WEBPACK_IMPORTED_MODULE_2__.localstorage.supported()) {
        const notices_from_storage = JSON.parse(localStorage.getItem("shown_deprecation_notices"));
        if (notices_from_storage !== null) {
            shown_deprecation_notices = notices_from_storage;
        } else {
            shown_deprecation_notices = [];
        }
    }

    if (!shown_deprecation_notices.includes(key)) {
        _dialog_widget__WEBPACK_IMPORTED_MODULE_1__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deprecation notice"}),
            html_body: message,
            html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Got it"}),
            on_click() {},
            close_on_submit: true,
            focus_submit_on_open: true,
            single_footer_button: true,
        });

        shown_deprecation_notices.push(key);
        if (_localstorage__WEBPACK_IMPORTED_MODULE_2__.localstorage.supported()) {
            localStorage.setItem(
                "shown_deprecation_notices",
                JSON.stringify(shown_deprecation_notices),
            );
        }
    }
}


/***/ }),

/***/ "./static/js/dialog_widget.js":
/*!************************************!*\
  !*** ./static/js/dialog_widget.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "close_modal": () => (/* binding */ close_modal),
/* harmony export */   "hide_dialog_spinner": () => (/* binding */ hide_dialog_spinner),
/* harmony export */   "launch": () => (/* binding */ launch),
/* harmony export */   "show_dialog_spinner": () => (/* binding */ show_dialog_spinner),
/* harmony export */   "submit_api_request": () => (/* binding */ submit_api_request)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_dialog_widget_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/dialog_widget.hbs */ "./static/templates/dialog_widget.hbs");
/* harmony import */ var _templates_dialog_widget_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_dialog_widget_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());










/*
 *  Look for confirm_dialog in settings_user_groups
 *  to see an example of how to use this widget.  It's
 *  pretty simple to use!
 *
 *  Some things to note:
 *      1) We create DOM on the fly, and we remove
 *         the DOM once it's closed.
 *
 *      2) We attach the DOM for the modal to the body element
 *         to avoid interference from other elements.
 *
 *      3) For settings, we have a click handler in settings.js
 *         that will close the dialog via overlays.close_active_modal.
 *
 *      4) We assume that since this is a modal, you will
 *         only ever have one confirm dialog active at any
 *         time.
 *
 *      5) If a modal wants a loading spinner, it should pass loading_spinner: true.
 *         This will show a loading spinner when the yes button is clicked.
 *         The caller is responsible for calling hide_confirm_dialog_spinner()
 *         to hide the spinner in both success and error handlers.
 *
 *      6) If loading_spinner is used, don't hide it on `success`. This modal has a fade out
 *         animation. This causes the `Confirm` button to be shown for a split second if the
 *         spinner is hidden.
 *         Just close the modal. This will remove the whole modal from the DOM without
 *         needing to remove the spinner.
 *
 *      7) If a caller needs to run code after the modal body is added
 *          to DOM, it can do so by passing a post_render hook.
 */

function hide_dialog_spinner() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button span").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_widget_modal .modal__btn").prop("disabled", false);

    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_widget_modal .modal__spinner");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
}

function show_dialog_spinner() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button span").hide();
    // Disable both the buttons.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_widget_modal .modal__btn").prop("disabled", true);

    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_widget_modal .modal__spinner");
    const dialog_submit_button_span_width = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button span").width();
    const dialog_submit_button_span_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button span").height();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner, {
        width: dialog_submit_button_span_width,
        height: dialog_submit_button_span_height,
    });
}

// Supports a callback to be called once the modal finishes closing.
function close_modal(on_hidden_callback) {
    _overlays__WEBPACK_IMPORTED_MODULE_3__.close_modal("dialog_widget_modal", {on_hidden: on_hidden_callback});
}

function launch(conf) {
    const mandatory_fields = [
        // The html_ fields should be safe HTML. If callers
        // interpolate user data into strings, they should use
        // templates.
        "html_heading",
        "html_body",
        "on_click",
    ];

    // Optional parameters:
    // * html_submit_button: Submit button text.
    // * close_on_submit: Whether to close modal on clicking submit.
    // * focus_submit_on_open: Whether to focus submit button on open.
    // * help_link: A help link in the heading area.
    // * id: Custom id to the container element to modify styles.
    // * single_footer_button: If true, don't include the "Cancel" button.
    // * form_id: Id of the form element in the modal if it exists.
    // * validate_input: Function to validate the input of the modal.
    // * on_show: Callback to run when the modal is triggered to show.
    // * on_shown: Callback to run when the modal is shown.
    // * on_hide: Callback to run when the modal is triggered to hide.
    // * on_hidden: Callback to run when the modal is hidden.
    // * post_render: Callback to run after the modal body is added to DOM.

    for (const f of mandatory_fields) {
        if (conf[f] === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("programmer omitted " + f);
        }
    }

    const html_submit_button = conf.html_submit_button || Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save changes"});
    const html = _templates_dialog_widget_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        heading_text: conf.html_heading,
        link: conf.help_link,
        html_submit_button,
        html_body: conf.html_body,
        id: conf.id,
        single_footer_button: conf.single_footer_button,
    });
    const $dialog = jquery__WEBPACK_IMPORTED_MODULE_0___default()(html);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append($dialog);

    if (conf.post_render !== undefined) {
        conf.post_render();
    }

    const $submit_button = $dialog.find(".dialog_submit_button");
    const $send_email_checkbox = $dialog.find(".send_email");
    const $email_field = $dialog.find(".email_field");

    $email_field.hide();

    // This is used to link the submit button with the form, if present, in the modal.
    // This makes it so that submitting this form by pressing Enter on an input element
    // triggers a click on the submit button.
    if (conf.form_id) {
        $submit_button.attr("form", conf.form_id);
    }

    // Set up handlers.
    $submit_button.on("click", (e) => {
        if (conf.validate_input && !conf.validate_input(e)) {
            return;
        }
        if (conf.loading_spinner) {
            show_dialog_spinner();
        } else if (conf.close_on_submit) {
            close_modal();
        }
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error").hide();
        conf.on_click(e);
    });

    $send_email_checkbox.on("change", () => {
        if ($send_email_checkbox.is(":checked")) {
            $email_field.show();
        } else {
            $email_field.hide();
        }
    });

    _overlays__WEBPACK_IMPORTED_MODULE_3__.open_modal("dialog_widget_modal", {
        autoremove: true,
        on_show() {
            if (conf.focus_submit_on_open) {
                $submit_button.trigger("focus");
            }
            if (conf.on_show) {
                conf.on_show();
            }
        },
        on_hide: conf?.on_hide,
        on_shown: conf?.on_shown,
        on_hidden: conf?.on_hidden,
    });
}

function submit_api_request(
    request_method,
    url,
    data = {},
    {
        failure_msg_html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}),
        success_continuation,
        error_continuation,
    } = {},
) {
    show_dialog_spinner();
    request_method({
        url,
        data,
        success(reponse_data) {
            close_modal();
            if (success_continuation !== undefined) {
                success_continuation(reponse_data);
            }
        },
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(failure_msg_html, xhr, jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error"));
            hide_dialog_spinner();
            if (error_continuation !== undefined) {
                error_continuation(xhr);
            }
        },
    });
}


/***/ }),

/***/ "./static/js/drafts.js":
/*!*****************************!*\
  !*** ./static/js/drafts.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "confirm_delete_all_drafts": () => (/* binding */ confirm_delete_all_drafts),
/* harmony export */   "delete_all_drafts": () => (/* binding */ delete_all_drafts),
/* harmony export */   "draft_model": () => (/* binding */ draft_model),
/* harmony export */   "drafts_handle_events": () => (/* binding */ drafts_handle_events),
/* harmony export */   "fix_drafts_with_undefined_topics": () => (/* binding */ fix_drafts_with_undefined_topics),
/* harmony export */   "format_draft": () => (/* binding */ format_draft),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch": () => (/* binding */ launch),
/* harmony export */   "open_overlay": () => (/* binding */ open_overlay),
/* harmony export */   "remove_old_drafts": () => (/* binding */ remove_old_drafts),
/* harmony export */   "rename_stream_recipient": () => (/* binding */ rename_stream_recipient),
/* harmony export */   "restore_draft": () => (/* binding */ restore_draft),
/* harmony export */   "restore_message": () => (/* binding */ restore_message),
/* harmony export */   "set_initial_element": () => (/* binding */ set_initial_element),
/* harmony export */   "snapshot_message": () => (/* binding */ snapshot_message),
/* harmony export */   "sync_count": () => (/* binding */ sync_count),
/* harmony export */   "update_draft": () => (/* binding */ update_draft)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/subDays/index.js");
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! handlebars/runtime */ "./node_modules/handlebars/dist/cjs/handlebars.runtime.js");
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var tippy_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! tippy.js */ "./node_modules/tippy.js/dist/tippy.esm.js");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_all_drafts_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_all_drafts.hbs */ "./static/templates/confirm_dialog/confirm_delete_all_drafts.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_all_drafts_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_all_drafts_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_draft_table_body_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/draft_table_body.hbs */ "./static/templates/draft_table_body.hbs");
/* harmony import */ var _templates_draft_table_body_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_draft_table_body_hbs__WEBPACK_IMPORTED_MODULE_4__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
































function set_count(count) {
    const $drafts_li = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".top_left_drafts");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($drafts_li, count);
}

const draft_model = (function () {
    const exports = {};

    // the key that the drafts are stored under.
    const KEY = "drafts";
    const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_13__.localstorage)();
    ls.version = 1;

    function getTimestamp() {
        return Date.now();
    }

    function get() {
        return ls.get(KEY) || {};
    }
    exports.get = get;

    exports.getDraft = function (id) {
        return get()[id] || false;
    };

    function save(drafts, update_count = true) {
        ls.set(KEY, drafts);
        if (update_count) {
            set_count(Object.keys(drafts).length);
        }
    }

    exports.addDraft = function (draft, update_count = true) {
        const drafts = get();

        // use the base16 of the current time + a random string to reduce
        // collisions to essentially zero.
        const id = getTimestamp().toString(16) + "-" + Math.random().toString(16).split(/\./).pop();

        draft.updatedAt = getTimestamp();
        drafts[id] = draft;
        save(drafts, update_count);

        return id;
    };

    exports.editDraft = function (id, draft, update_timestamp = true) {
        const drafts = get();
        let changed = false;

        function check_if_equal(draft_a, draft_b) {
            return lodash__WEBPACK_IMPORTED_MODULE_2___default().isEqual(lodash__WEBPACK_IMPORTED_MODULE_2___default().omit(draft_a, ["updatedAt"]), lodash__WEBPACK_IMPORTED_MODULE_2___default().omit(draft_b, ["updatedAt"]));
        }

        if (drafts[id]) {
            changed = !check_if_equal(drafts[id], draft);
            if (update_timestamp) {
                draft.updatedAt = getTimestamp();
            }
            drafts[id] = draft;
            save(drafts);
        }
        return changed;
    };

    exports.deleteDraft = function (id) {
        const drafts = get();

        delete drafts[id];
        save(drafts);
    };

    return exports;
})();

// A one-time fix for buggy drafts that had their topics renamed to
// `undefined` when the topic was moved to another stream without
// changing the topic. The bug was introduced in
// 4c8079c49a81b08b29871f9f1625c6149f48b579 and fixed in
// aebdf6af8c6675fbd2792888d701d582c4a1110a; but servers running
// intermediate versions may have generated some bugged drafts with
// this invalid topic value.
//
// TODO/compatibility: This can be deleted once servers can no longer
// directly upgrade from Zulip 6.0beta1 and earlier development branch where the bug was present,
// since we expect bugged drafts will have either been run through
// this code or else been deleted after 30 (DRAFT_LIFETIME) days.
let fixed_buggy_drafts = false;
function fix_drafts_with_undefined_topics() {
    const data = draft_model.get();
    for (const draft_id of Object.keys(data)) {
        const draft = data[draft_id];
        if (draft.type === "stream" && draft.topic === undefined) {
            const draft = data[draft_id];
            draft.topic = "";
            draft_model.editDraft(draft_id, draft, false);
        }
    }
    fixed_buggy_drafts = true;
}

function sync_count() {
    const drafts = draft_model.get();
    set_count(Object.keys(drafts).length);
}

function delete_all_drafts() {
    const drafts = draft_model.get();
    for (const [id] of Object.entries(drafts)) {
        draft_model.deleteDraft(id);
    }
}

function confirm_delete_all_drafts() {
    const html_body = _templates_confirm_dialog_confirm_delete_all_drafts_hbs__WEBPACK_IMPORTED_MODULE_3___default()();

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_12__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete all drafts"}),
        html_body,
        on_click: delete_all_drafts,
    });
}

function rename_stream_recipient(old_stream_id, old_topic, new_stream_id, new_topic) {
    const current_drafts = draft_model.get();
    for (const draft_id of Object.keys(current_drafts)) {
        const draft = current_drafts[draft_id];
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(draft, {stream_id: old_stream_id, topic: old_topic})) {
            // If new_stream_id is undefined, that means the stream wasn't updated.
            if (new_stream_id !== undefined) {
                draft.stream_id = new_stream_id;
                // TODO: For now we need both a stream_id and stream (stream name)
                // because there can be partial input in the stream field.
                // Once we complete our UI plan to change the stream input field
                // to a dropdown_list_widget, there will no longer be the possibility
                // of invalid partial input in the stream field, and we can have the
                // drafts system ignore the legacy `stream` field, using only `stream_id`.
                // After enough drafts are autodeleted, we'd no longer have a `stream` field.
                draft.stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new_stream_id).name;
            }
            // If new_topic is undefined, that means the topic wasn't updated.
            if (new_topic !== undefined) {
                draft.topic = new_topic;
            }
            draft_model.editDraft(draft_id, draft, false);
        }
    }
}

function snapshot_message() {
    if (!_compose_state__WEBPACK_IMPORTED_MODULE_10__.composing() || _compose_state__WEBPACK_IMPORTED_MODULE_10__.message_content().length <= 2) {
        // If you aren't in the middle of composing the body of a
        // message or the message is shorter than 2 characters long, don't try to snapshot.
        return undefined;
    }

    // Save what we can.
    const message = {
        type: _compose_state__WEBPACK_IMPORTED_MODULE_10__.get_message_type(),
        content: _compose_state__WEBPACK_IMPORTED_MODULE_10__.message_content(),
    };
    if (message.type === "private") {
        const recipient = _compose_state__WEBPACK_IMPORTED_MODULE_10__.private_message_recipient();
        message.reply_to = recipient;
        message.private_message_recipient = recipient;
    } else {
        message.stream = _compose_state__WEBPACK_IMPORTED_MODULE_10__.stream_name();
        const sub = _stream_data__WEBPACK_IMPORTED_MODULE_20__.get_sub(message.stream);
        if (sub) {
            message.stream_id = sub.stream_id;
        }
        message.topic = _compose_state__WEBPACK_IMPORTED_MODULE_10__.topic();
    }
    return message;
}

function restore_message(draft) {
    // This is kinda the inverse of snapshot_message, and
    // we are essentially making a deep copy of the draft,
    // being explicit about which fields we send to the compose
    // system.
    let compose_args;

    if (draft.type === "stream") {
        compose_args = {
            type: "stream",
            stream: draft.stream,
            topic: draft.topic,
            content: draft.content,
        };
    } else {
        compose_args = {
            type: draft.type,
            private_message_recipient: draft.private_message_recipient,
            content: draft.content,
        };
    }

    return compose_args;
}

function draft_notify() {
    // Display a tooltip to notify the user about the saved draft.
    const instance = (0,tippy_js__WEBPACK_IMPORTED_MODULE_21__["default"])(".top_left_drafts .unread_count", {
        content: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Saved as draft"}),
        arrow: true,
        placement: "right",
    })[0];
    instance.show();
    function remove_instance() {
        instance.destroy();
    }
    setTimeout(remove_instance, 3000);
}

function maybe_notify(no_notify) {
    if (!no_notify) {
        draft_notify();
    }
}

function update_draft(opts = {}) {
    const no_notify = opts.no_notify || false;
    const draft = snapshot_message();

    if (draft === undefined) {
        // The user cleared the compose box, which means
        // there is nothing to save here.  Don't obliterate
        // the existing draft yet--the user may have mistakenly
        // hit delete after select-all or something.
        // Just do nothing.
        return undefined;
    }

    const draft_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").data("draft-id");

    if (draft_id !== undefined) {
        // We don't save multiple drafts of the same message;
        // just update the existing draft.
        const changed = draft_model.editDraft(draft_id, draft);
        if (changed) {
            maybe_notify(no_notify);
        }
        return draft_id;
    }

    // We have never saved a draft for this message, so add one.
    const update_count = opts.update_count === undefined ? true : opts.update_count;
    const new_draft_id = draft_model.addDraft(draft, update_count);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").data("draft-id", new_draft_id);
    maybe_notify(no_notify);

    return new_draft_id;
}

function restore_draft(draft_id) {
    const draft = draft_model.getDraft(draft_id);
    if (!draft) {
        return;
    }

    const compose_args = restore_message(draft);

    if (compose_args.type === "stream") {
        if (draft.stream !== "" && draft.topic !== "") {
            _narrow__WEBPACK_IMPORTED_MODULE_15__.activate(
                [
                    {operator: "stream", operand: compose_args.stream},
                    {operator: "topic", operand: compose_args.topic},
                ],
                {trigger: "restore draft"},
            );
        }
    } else {
        if (compose_args.private_message_recipient !== "") {
            _narrow__WEBPACK_IMPORTED_MODULE_15__.activate(
                [{operator: "pm-with", operand: compose_args.private_message_recipient}],
                {trigger: "restore draft"},
            );
        }
    }

    _overlays__WEBPACK_IMPORTED_MODULE_17__.close_overlay("drafts");
    _compose_fade__WEBPACK_IMPORTED_MODULE_9__.clear_compose();
    _compose__WEBPACK_IMPORTED_MODULE_7__.clear_preview_area();
    _compose_actions__WEBPACK_IMPORTED_MODULE_8__.start(compose_args.type, compose_args);
    _compose_ui__WEBPACK_IMPORTED_MODULE_11__.autosize_textarea(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea"));
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").data("draft-id", draft_id);
}

const DRAFT_LIFETIME = 30;

function remove_old_drafts() {
    const old_date = (0,date_fns__WEBPACK_IMPORTED_MODULE_22__["default"])(new Date(), DRAFT_LIFETIME).getTime();
    const drafts = draft_model.get();
    for (const [id, draft] of Object.entries(drafts)) {
        if (draft.updatedAt < old_date) {
            draft_model.deleteDraft(id);
        }
    }
}

function format_draft(draft) {
    const id = draft.id;
    let formatted;
    const time = new Date(draft.updatedAt);
    let time_stamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time).time_str;
    if (time_stamp === Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Today"})) {
        time_stamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time);
    }
    if (draft.type === "stream") {
        // In case there is no stream for the draft, we need a
        // single space char for proper rendering of the stream label
        const space_string = new (handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().SafeString)("&nbsp;");
        let stream_name = draft.stream.length > 0 ? draft.stream : space_string;
        if (draft.stream_id) {
            const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(draft.stream_id);
            if (sub && sub.name !== stream_name) {
                stream_name = sub.name;
                draft.stream = stream_name;
                draft_model.editDraft(id, draft);
            }
        }
        const draft_topic = draft.topic || _compose__WEBPACK_IMPORTED_MODULE_7__.empty_topic_placeholder();
        const draft_stream_color = _stream_data__WEBPACK_IMPORTED_MODULE_20__.get_color(stream_name);

        formatted = {
            draft_id: draft.id,
            is_stream: true,
            stream_name,
            stream_color: draft_stream_color,
            dark_background: Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(draft_stream_color),
            topic: draft_topic,
            raw_content: draft.content,
            time_stamp,
        };
    } else {
        const emails = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(draft.private_message_recipient);
        const recipients = _people__WEBPACK_IMPORTED_MODULE_18__.emails_to_full_names_string(emails);

        formatted = {
            draft_id: draft.id,
            is_stream: false,
            recipients,
            raw_content: draft.content,
            time_stamp,
        };
    }

    try {
        _markdown__WEBPACK_IMPORTED_MODULE_14__.apply_markdown(formatted);
    } catch (error) {
        // In the unlikely event that there is syntax in the
        // draft content which our Markdown processor is
        // unable to process, we delete the draft, so that the
        // drafts overlay can be opened without any errors.
        // We also report the exception to the server so that
        // the bug can be fixed.
        draft_model.deleteDraft(id);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Error in rendering draft.",
            {
                draft_content: draft.content,
            },
            error.stack,
        );
        return undefined;
    }

    return formatted;
}

function row_with_focus() {
    const focused_draft = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft-info-box:focus")[0];
    return jquery__WEBPACK_IMPORTED_MODULE_1___default()(focused_draft).parent(".draft-row");
}

function row_before_focus() {
    const $focused_row = row_with_focus();
    const $prev_row = $focused_row.prev(".draft-row:visible");
    // The draft modal can have two sub-sections. This handles the edge case
    // when the user moves from the second "Other drafts" section to the first
    // section which contains drafts from a particular narrow.
    if (
        $prev_row.length === 0 &&
        $focused_row.parent().attr("id") === "other-drafts" &&
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts-from-conversation").is(":visible")
    ) {
        return jquery__WEBPACK_IMPORTED_MODULE_1___default()(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts-from-conversation").children(".draft-row:visible").last());
    }

    return $prev_row;
}

function row_after_focus() {
    const $focused_row = row_with_focus();
    const $next_row = $focused_row.next(".draft-row:visible");
    // The draft modal can have two sub-sections. This handles the edge case
    // when the user moves from the first section (drafts from a particular
    // narrow) to the second section which contains the rest of the drafts.
    if (
        $next_row.length === 0 &&
        $focused_row.parent().attr("id") === "drafts-from-conversation" &&
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#other-drafts").is(":visible")
    ) {
        return jquery__WEBPACK_IMPORTED_MODULE_1___default()("#other-drafts").children(".draft-row:visible").first();
    }
    return $next_row;
}

function remove_draft($draft_row) {
    // Deletes the draft and removes it from the list
    const draft_id = $draft_row.data("draft-id");

    draft_model.deleteDraft(draft_id);

    $draft_row.remove();

    if (jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table .draft-row").length === 0) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table .no-drafts").show();
    }
    update_rendered_drafts(
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts-from-conversation .draft-row").length > 0,
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#other-drafts .draft-row").length > 0,
    );
}

function update_rendered_drafts(has_drafts_from_conversation, has_other_drafts) {
    if (has_drafts_from_conversation) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts-from-conversation").show();
    } else {
        // Since there are no relevant drafts from this conversation left, switch to the "all drafts" view and remove headers.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts-from-conversation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#other-drafts-header").hide();
    }

    if (!has_other_drafts) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#other-drafts").hide();
    }
}

function current_recipient_data() {
    // Prioritize recipients from the compose box first. If the compose
    // box isn't open, just return data from the current narrow.
    if (!_compose_state__WEBPACK_IMPORTED_MODULE_10__.composing()) {
        const stream_name = _narrow_state__WEBPACK_IMPORTED_MODULE_16__.stream();
        return {
            stream_name,
            topic: _narrow_state__WEBPACK_IMPORTED_MODULE_16__.topic(),
            private_recipients: _narrow_state__WEBPACK_IMPORTED_MODULE_16__.pm_emails_string(),
        };
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_10__.get_message_type() === "stream") {
        const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_10__.stream_name();
        return {
            stream_name,
            topic: _compose_state__WEBPACK_IMPORTED_MODULE_10__.topic(),
            private_recipients: undefined,
        };
    } else if (_compose_state__WEBPACK_IMPORTED_MODULE_10__.get_message_type() === "private") {
        return {
            stream_name: undefined,
            topic: undefined,
            private_recipients: _compose_state__WEBPACK_IMPORTED_MODULE_10__.private_message_recipient(),
        };
    }
    return {
        stream_name: undefined,
        topic: undefined,
        private_recipients: undefined,
    };
}

function filter_drafts_by_compose_box_and_recipient(drafts) {
    const {stream_name, topic, private_recipients} = current_recipient_data();
    const stream_id = stream_name ? _stream_data__WEBPACK_IMPORTED_MODULE_20__.get_stream_id(stream_name) : undefined;
    const narrow_drafts_ids = [];
    for (const [id, draft] of Object.entries(drafts)) {
        // Match by stream and topic.
        if (
            stream_id &&
            topic &&
            draft.topic &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(draft, {type: "stream", stream_id, topic})
        ) {
            narrow_drafts_ids.push(id);
        }
        // Match by only stream.
        else if (draft.type === "stream" && stream_id && !topic && draft.stream_id === stream_id) {
            narrow_drafts_ids.push(id);
        }
        // Match by private message recipient.
        else if (
            draft.type === "private" &&
            private_recipients &&
            lodash__WEBPACK_IMPORTED_MODULE_2___default().isEqual(
                draft.private_message_recipient
                    .split(",")
                    .map((s) => s.trim())
                    .sort(),
                private_recipients
                    .split(",")
                    .map((s) => s.trim())
                    .sort(),
            )
        ) {
            narrow_drafts_ids.push(id);
        }
    }
    return lodash__WEBPACK_IMPORTED_MODULE_2___default().pick(drafts, narrow_drafts_ids);
}

function launch() {
    function format_drafts(data) {
        for (const [id, draft] of Object.entries(data)) {
            draft.id = id;
        }

        const unsorted_raw_drafts = Object.values(data);

        const sorted_raw_drafts = unsorted_raw_drafts.sort(
            (draft_a, draft_b) => draft_b.updatedAt - draft_a.updatedAt,
        );

        const sorted_formatted_drafts = sorted_raw_drafts
            .map((draft_row) => format_draft(draft_row))
            .filter(Boolean);

        return sorted_formatted_drafts;
    }

    function get_header_for_narrow_drafts() {
        const {stream_name, topic, private_recipients} = current_recipient_data();
        if (private_recipients) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Drafts from conversation with {recipient}"},
                {
                    recipient: _people__WEBPACK_IMPORTED_MODULE_18__.emails_to_full_names_string(private_recipients.split(",")),
                },
            );
        }
        const recipient = topic ? `#${stream_name} > ${topic}` : `#${stream_name}`;
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Drafts from {recipient}"}, {recipient});
    }

    function render_widgets(narrow_drafts, other_drafts) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table").empty();

        const narrow_drafts_header = get_header_for_narrow_drafts();

        const rendered = _templates_draft_table_body_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
            narrow_drafts_header,
            narrow_drafts,
            other_drafts,
            draft_lifetime: DRAFT_LIFETIME,
        });
        const $drafts_table = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table");
        $drafts_table.append(rendered);
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table .draft-row").length > 0) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#drafts_table .no-drafts").hide();
            // Update possible dynamic elements.
            const $rendered_drafts = $drafts_table.find(
                ".message_content.rendered_markdown.restore-draft",
            );
            $rendered_drafts.each(function () {
                _rendered_markdown__WEBPACK_IMPORTED_MODULE_19__.update_elements(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this));
            });
        }
        update_rendered_drafts(narrow_drafts.length > 0, other_drafts.length > 0);
    }

    function setup_event_handlers() {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".restore-draft").on("click", function (e) {
            if (document.getSelection().type === "Range") {
                return;
            }

            e.stopPropagation();

            const $draft_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".draft-row");
            const $draft_id = $draft_row.data("draft-id");
            restore_draft($draft_id);
        });

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft_controls .delete-draft").on("click", function () {
            const $draft_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".draft-row");

            remove_draft($draft_row);
        });
    }

    const drafts = draft_model.get();
    const narrow_drafts = filter_drafts_by_compose_box_and_recipient(drafts);
    const other_drafts = lodash__WEBPACK_IMPORTED_MODULE_2___default().pick(
        drafts,
        lodash__WEBPACK_IMPORTED_MODULE_2___default().difference(Object.keys(drafts), Object.keys(narrow_drafts)),
    );
    const formatted_narrow_drafts = format_drafts(narrow_drafts);
    const formatted_other_drafts = format_drafts(other_drafts);

    render_widgets(formatted_narrow_drafts, formatted_other_drafts);

    // We need to force a style calculation on the newly created
    // element in order for the CSS transition to take effect.
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#draft_overlay").css("opacity");

    open_overlay();
    set_initial_element(formatted_narrow_drafts.concat(formatted_other_drafts));
    setup_event_handlers();
}

function activate_element(elem) {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft-info-box").removeClass("active");
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elem).expectOne().addClass("active");
    elem.focus();
}

function drafts_initialize_focus(event_name) {
    // If a draft is not focused in draft modal, then focus the last draft
    // if up_arrow is clicked or the first draft if down_arrow is clicked.
    if (
        (event_name !== "up_arrow" && event_name !== "down_arrow") ||
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft-info-box:focus")[0]
    ) {
        return;
    }

    const draft_arrow = draft_model.get();
    const draft_id_arrow = Object.getOwnPropertyNames(draft_arrow);
    if (draft_id_arrow.length === 0) {
        // empty drafts modal
        return;
    }

    let draft_element;
    if (event_name === "up_arrow") {
        draft_element = document.querySelectorAll(
            '[data-draft-id="' + draft_id_arrow.at(-1) + '"]',
        );
    } else if (event_name === "down_arrow") {
        draft_element = document.querySelectorAll('[data-draft-id="' + draft_id_arrow[0] + '"]');
    }
    const focus_element = draft_element[0].children[0];

    activate_element(focus_element);
}

function drafts_scroll($next_focus_draft_row) {
    if ($next_focus_draft_row[0] === undefined) {
        return;
    }
    if ($next_focus_draft_row[0].children[0] === undefined) {
        return;
    }
    activate_element($next_focus_draft_row[0].children[0]);

    // If focused draft is first draft, scroll to the top.
    if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft-info-box").first()[0].parentElement === $next_focus_draft_row[0]) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollTop = 0;
    }

    // If focused draft is the last draft, scroll to the bottom.
    if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".draft-info-box").last()[0].parentElement === $next_focus_draft_row[0]) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollTop =
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollHeight - jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list").height();
    }

    // If focused draft is cut off from the top, scroll up halfway in draft modal.
    if ($next_focus_draft_row.position().top < 55) {
        // 55 is the minimum distance from the top that will require extra scrolling.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollTop -= jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].clientHeight / 2;
    }

    // If focused draft is cut off from the bottom, scroll down halfway in draft modal.
    const dist_from_top = $next_focus_draft_row.position().top;
    const total_dist = dist_from_top + $next_focus_draft_row[0].clientHeight;
    const dist_from_bottom = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-container")[0].clientHeight - total_dist;
    if (dist_from_bottom < -4) {
        // -4 is the min dist from the bottom that will require extra scrolling.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollTop += jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].clientHeight / 2;
    }
}

function drafts_handle_events(e, event_key) {
    const draft_arrow = draft_model.get();
    const draft_id_arrow = Object.getOwnPropertyNames(draft_arrow);
    drafts_initialize_focus(event_key);

    // This detects up arrow key presses when the draft overlay
    // is open and scrolls through the drafts.
    if (event_key === "up_arrow" || event_key === "vim_up") {
        drafts_scroll(row_before_focus());
    }

    // This detects down arrow key presses when the draft overlay
    // is open and scrolls through the drafts.
    if (event_key === "down_arrow" || event_key === "vim_down") {
        drafts_scroll(row_after_focus());
    }

    const focused_draft_id = row_with_focus().data("draft-id");
    // Allows user to delete drafts with Backspace
    if ((event_key === "backspace" || event_key === "delete") && focused_draft_id !== undefined) {
        const $draft_row = row_with_focus();
        const $next_draft_row = row_after_focus();
        const $prev_draft_row = row_before_focus();
        let draft_to_be_focused_id;

        // Try to get the next draft in the list and 'focus' it
        // Use previous draft as a fallback
        if ($next_draft_row[0] !== undefined) {
            draft_to_be_focused_id = $next_draft_row.data("draft-id");
        } else if ($prev_draft_row[0] !== undefined) {
            draft_to_be_focused_id = $prev_draft_row.data("draft-id");
        }

        const new_focus_element = document.querySelectorAll(
            '[data-draft-id="' + draft_to_be_focused_id + '"]',
        );
        if (new_focus_element[0] !== undefined) {
            activate_element(new_focus_element[0].children[0]);
        }

        remove_draft($draft_row);
    }

    // This handles when pressing Enter while looking at drafts.
    // It restores draft that is focused.
    if (event_key === "enter") {
        if (Object.hasOwn(document.activeElement.parentElement.dataset, "draftId")) {
            restore_draft(focused_draft_id);
        } else {
            const first_draft = draft_id_arrow.at(-1);
            restore_draft(first_draft);
        }
    }
}

function open_overlay() {
    _overlays__WEBPACK_IMPORTED_MODULE_17__.open_overlay({
        name: "drafts",
        $overlay: jquery__WEBPACK_IMPORTED_MODULE_1___default()("#draft_overlay"),
        on_close() {
            _browser_history__WEBPACK_IMPORTED_MODULE_6__.exit_overlay();
        },
    });
}

function set_initial_element(drafts) {
    if (drafts.length > 0) {
        const curr_draft_id = drafts[0].draft_id;
        const selector = '[data-draft-id="' + curr_draft_id + '"]';
        const curr_draft_element = document.querySelectorAll(selector);
        const focus_element = curr_draft_element[0].children[0];
        activate_element(focus_element);
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".drafts-list")[0].scrollTop = 0;
    }
}

function initialize() {
    remove_old_drafts();

    if (!fixed_buggy_drafts) {
        fix_drafts_with_undefined_topics();
    }

    window.addEventListener("beforeunload", () => {
        update_draft();
    });

    set_count(Object.keys(draft_model.get()).length);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("focus", ".draft-info-box", (e) => {
        activate_element(e.target);
    });
}


/***/ }),

/***/ "./static/js/dropdown_list_widget.js":
/*!*******************************************!*\
  !*** ./static/js/dropdown_list_widget.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "DropdownListWidget": () => (/* binding */ DropdownListWidget),
/* harmony export */   "MultiSelectDropdownListWidget": () => (/* binding */ MultiSelectDropdownListWidget)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var tippy_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tippy.js */ "./node_modules/tippy.js/dist/tippy.esm.js");
/* harmony import */ var _templates_settings_dropdown_list_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/dropdown_list.hbs */ "./static/templates/settings/dropdown_list.hbs");
/* harmony import */ var _templates_settings_dropdown_list_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_dropdown_list_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");











class DropdownListWidget {
    constructor({
        widget_name,
        data,
        default_text,
        render_text = (item_name) => item_name,
        null_value = null,
        include_current_item = true,
        value,
        on_update = () => {},
    }) {
        // Initializing values
        this.widget_name = widget_name;
        this.data = data;
        this.default_text = default_text;
        this.render_text = render_text;
        this.null_value = null_value;
        this.include_current_item = include_current_item;
        this.initial_value = value;
        this.on_update = on_update;

        this.container_id = `${widget_name}_widget`;
        this.value_id = `id_${widget_name}`;

        if (value === undefined) {
            this.initial_value = null_value;
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("dropdown-list-widget: Called without a default value; using null value");
        }
    }

    render_default_text($elem) {
        $elem.text(this.default_text);
        $elem.addClass("text-warning");
        $elem.closest(".input-group").find(".dropdown_list_reset_button").hide();
    }

    render(value) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} #${CSS.escape(this.value_id)}`).data("value", value);

        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} #${CSS.escape(this.widget_name)}_name`);

        if (!value || value === this.null_value) {
            this.render_default_text($elem);
            return;
        }

        // Happy path
        const item = this.data.find((x) => x.value === value.toString());

        if (item === undefined) {
            this.render_default_text($elem);
            return;
        }

        const text = this.render_text(item.name);
        $elem.text(text);
        $elem.removeClass("text-warning");
        $elem.closest(".input-group").find(".dropdown_list_reset_button").show();
    }

    update(value) {
        this.render(value);
        this.on_update(value);
    }

    register_event_handlers() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-list-body`).on(
            "click keypress",
            ".list_item",
            (e) => {
                const $setting_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest(
                    `.${CSS.escape(this.widget_name)}_setting`,
                );
                if (e.type === "keypress") {
                    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                        $setting_elem.find(".dropdown-menu").dropdown("toggle");
                    } else {
                        return;
                    }
                }
                const value = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-value");
                this.update(value);
            },
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown_list_reset_button`).on("click", (e) => {
            this.update(this.null_value);
            e.preventDefault();
        });
    }

    setup_dropdown_widget(data) {
        const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-list-body`,
        ).expectOne();
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );
        const get_data = () => {
            if (this.include_current_item) {
                return data;
            }
            return data.filter((x) => x.value !== this.value.toString());
        };

        _list_widget__WEBPACK_IMPORTED_MODULE_4__.create($dropdown_list_body, get_data(data), {
            name: `${CSS.escape(this.widget_name)}_list`,
            modifier(item) {
                return _templates_settings_dropdown_list_hbs__WEBPACK_IMPORTED_MODULE_2___default()({item});
            },
            filter: {
                $element: $search_input,
                predicate(item, value) {
                    return item.name.toLowerCase().includes(value);
                },
            },
            $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-list-wrapper`),
        });
    }

    // Sets the focus to the ListWidget input once the dropdown button is clicked.
    dropdown_toggle_click_handler() {
        const $dropdown_toggle = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-toggle`);
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );

        $dropdown_toggle.on("click", () => {
            $search_input.val("").trigger("input");
        });
    }

    dropdown_focus_events() {
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );
        const $dropdown_menu = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.${CSS.escape(this.widget_name)}_setting .dropdown-menu`);

        const dropdown_elements = () => {
            const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                `#${CSS.escape(this.container_id)} .dropdown-list-body`,
            ).expectOne();

            return $dropdown_list_body.children().find("a");
        };

        // Rest of the key handlers are supported by our
        // bootstrap library.
        $dropdown_menu.on("keydown", (e) => {
            function trigger_element_focus($element) {
                e.preventDefault();
                e.stopPropagation();
                $element.trigger("focus");
            }

            switch (e.key) {
                case "ArrowDown": {
                    switch (e.target) {
                        case dropdown_elements().last()[0]:
                            trigger_element_focus($search_input);
                            break;
                        case $search_input[0]:
                            trigger_element_focus(dropdown_elements().first());
                            break;
                    }

                    break;
                }
                case "ArrowUp": {
                    switch (e.target) {
                        case dropdown_elements().first()[0]:
                            trigger_element_focus($search_input);
                            break;
                        case $search_input[0]:
                            trigger_element_focus(dropdown_elements().last());
                    }

                    break;
                }
                case "Tab": {
                    switch (e.target) {
                        case $search_input[0]:
                            trigger_element_focus(dropdown_elements().first());
                            break;
                        case dropdown_elements().last()[0]:
                            trigger_element_focus($search_input);
                            break;
                    }

                    break;
                }
            }
        });
    }

    setup() {
        // populate the dropdown
        const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-list-body`,
        ).expectOne();
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );
        const $dropdown_toggle = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-toggle`);

        this.setup_dropdown_widget(this.data);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-search`).on("click", (e) => {
            e.stopPropagation();
        });

        this.dropdown_toggle_click_handler();

        $dropdown_toggle.on("focus", (e) => {
            // On opening a Bootstrap Dropdown, the parent element receives focus.
            // Here, we want our search input to have focus instead.
            e.preventDefault();
            // This function gets called twice when focusing the
            // dropdown, and only in the second call is the input
            // field visible in the DOM; so the following visibility
            // check ensures we wait for the second call to focus.
            if ($dropdown_list_body.is(":visible")) {
                $search_input.trigger("focus");
            }
        });

        this.dropdown_focus_events();

        this.render(this.initial_value);
        this.register_event_handlers();
    }

    // Returns the updated value
    value() {
        let val = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} #${CSS.escape(this.value_id)}`).data(
            "value",
        );
        if (val === null) {
            val = "";
        }
        return val;
    }
}

// A widget mostly similar to `DropdownListWidget` but
// used in cases of multiple dropdown selection.
class MultiSelectDropdownListWidget extends DropdownListWidget {
    constructor({
        widget_name,
        data,
        default_text,
        null_value = null,
        on_update = () => {},
        on_close,
        value,
        limit,
    }) {
        super({
            widget_name,
            data,
            default_text,
            null_value,
            on_update,
            value,
        });

        // Initializing values specific to `MultiSelectDropdownListWidget`.
        this.limit = limit;
        this.on_close = on_close;

        // Important thing to note is that this needs to be maintained as
        // a reference type and not to deep clone it/assign it to a
        // different variable, so that it can be later referenced within
        // `list_widget` as well. The way we manage dropdown elements are
        // essentially by just modifying the values in `data_selected` variable.
        this.data_selected = []; // Populate the dropdown values selected by user.

        if (limit === undefined) {
            this.limit = 2;
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Multiselect dropdown-list-widget: Called without limit value; using 2 as the limit",
            );
        }
    }

    setup() {
        super.setup(this);
        this.initialize_dropdown_values();
    }

    initialize_dropdown_values() {
        // Stop the execution if value parameter is undefined and null_value is passed.
        if (!this.initial_value || this.initial_value === this.null_value) {
            return;
        }
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} #${CSS.escape(this.widget_name)}_name`);

        // Push values from initial valued array to `data_selected`.
        this.data_selected.push(...this.initial_value);
        this.render_button_text($elem, this.limit);
    }

    // Set the button text as per the selected data.
    render_button_text($elem, limit) {
        const items_selected = this.data_selected.length;
        let text = "";

        // Destroy the tooltip once the button text reloads.
        this.destroy_tooltip();

        if (items_selected === 0) {
            this.render_default_text($elem);
            return;
        } else if (limit >= items_selected) {
            const data_selected = this.data.filter((data) =>
                this.data_selected.includes(data.value),
            );
            text = data_selected.map((data) => data.name).toString();
        } else {
            text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "{items_selected} selected"}, {items_selected});
            this.render_tooltip();
        }

        $elem.text(text);
        $elem.removeClass("text-warning");
        $elem.closest(".input-group").find(".dropdown_list_reset_button").show();
    }

    // Override the DrodownListWidget `render` function.
    render(value) {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} #${CSS.escape(this.widget_name)}_name`);

        if (!value || value === this.null_value) {
            this.render_default_text($elem);
            return;
        }
        this.render_button_text($elem, this.limit);
    }

    dropdown_toggle_click_handler() {
        const $dropdown_toggle = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-toggle`);
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );

        $dropdown_toggle.on("click", () => {
            this.reset_dropdown_items();
            $search_input.val("").trigger("input");
        });
    }

    // Cases where a user presses any dropdown item but accidentally closes
    // the dropdown list.
    reset_dropdown_items() {
        // Clear the data selected and stop the execution once the user has
        // pressed the `reset` button.
        if (this.is_reset) {
            this.data_selected.splice(0, this.data_selected.length);
            return;
        }

        const original_items = this.checked_items ?? this.initial_value;
        const items_added = lodash__WEBPACK_IMPORTED_MODULE_1___default().difference(this.data_selected, original_items);

        // Removing the unnecessary items from dropdown.
        for (const val of items_added) {
            const index = this.data_selected.indexOf(val);
            if (index > -1) {
                this.data_selected.splice(index, 1);
            }
        }

        // Items that are removed in dropdown but should have been a part of it
        const items_removed = lodash__WEBPACK_IMPORTED_MODULE_1___default().difference(original_items, this.data_selected);
        this.data_selected.push(...items_removed);
    }

    // Override the DrodownListWidget `setup_dropdown_widget` function.
    setup_dropdown_widget(data) {
        const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-list-body`,
        ).expectOne();
        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );

        _list_widget__WEBPACK_IMPORTED_MODULE_4__.create($dropdown_list_body, data, {
            name: `${CSS.escape(this.widget_name)}_list`,
            modifier(item) {
                return _templates_settings_dropdown_list_hbs__WEBPACK_IMPORTED_MODULE_2___default()({item});
            },
            multiselect: {
                selected_items: this.data_selected,
            },
            filter: {
                $element: $search_input,
                predicate(item, value) {
                    return item.name.toLowerCase().includes(value);
                },
            },
            $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown-list-wrapper`),
        });
    }

    // Add the check mark to dropdown element passed.
    add_check_mark($element) {
        const value = $element.attr("data-value");
        const $link_elem = $element.find("a").expectOne();
        $link_elem.prepend(jquery__WEBPACK_IMPORTED_MODULE_0___default()("<i>").addClass(["fa", "fa-check"]));
        $element.addClass("checked");
        this.data_selected.push(value);
    }

    // Remove the check mark from dropdown element.
    remove_check_mark($element) {
        const $icon = $element.find("i").expectOne();
        const value = $element.attr("data-value");
        const index = this.data_selected.indexOf(value);

        if (index > -1) {
            $icon.remove();
            $element.removeClass("checked");
            this.data_selected.splice(index, 1);
        }
    }

    // Render the tooltip once the text changes to `n` selected.
    render_tooltip() {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)}`);
        const selected_items = this.data.filter((item) => this.checked_items.includes(item.value));

        (0,tippy_js__WEBPACK_IMPORTED_MODULE_5__["default"])($elem[0], {
            content: selected_items.map((item) => item.name).join(", "),
            placement: "top",
        });
    }

    destroy_tooltip() {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)}`);
        const tippy_instance = $elem[0]._tippy;
        if (!tippy_instance) {
            return;
        }

        tippy_instance.destroy();
    }

    dropdown_focus_events() {
        // Main keydown event handler which transfers the focus from one child element
        // to another.

        const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-search > input[type=text]`,
        );
        const $dropdown_menu = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.${CSS.escape(this.widget_name)}_setting .dropdown-menu`);
        const $filter_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .multiselect_btn`);

        const dropdown_elements = () => {
            const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                `#${CSS.escape(this.container_id)} .dropdown-list-body`,
            ).expectOne();

            return $dropdown_list_body.children().find("a");
        };

        $dropdown_menu.on("keydown", (e) => {
            function trigger_element_focus($element) {
                e.preventDefault();
                e.stopPropagation();
                $element.trigger("focus");
            }

            switch (e.key) {
                case "ArrowDown": {
                    switch (e.target) {
                        case dropdown_elements().last()[0]:
                            trigger_element_focus($filter_button);
                            break;
                        case jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .multiselect_btn`)[0]:
                            trigger_element_focus($search_input);
                            break;
                        case $search_input[0]:
                            trigger_element_focus(dropdown_elements().first());
                            break;
                    }

                    break;
                }
                case "ArrowUp": {
                    switch (e.target) {
                        case dropdown_elements().first()[0]:
                            trigger_element_focus($search_input);
                            break;
                        case $search_input[0]:
                            trigger_element_focus($filter_button);
                            break;
                        case jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .multiselect_btn`)[0]:
                            trigger_element_focus(dropdown_elements().last());
                            break;
                    }

                    break;
                }
                case "Tab": {
                    switch (e.target) {
                        case $search_input[0]:
                            trigger_element_focus(dropdown_elements().first());
                            break;
                        case $filter_button[0]:
                            trigger_element_focus($search_input);
                            break;
                    }

                    break;
                }
            }
        });
    }

    // Override the `register_event_handlers` function.
    register_event_handlers() {
        const $dropdown_list_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#${CSS.escape(this.container_id)} .dropdown-list-body`,
        ).expectOne();

        $dropdown_list_body.on("click keypress", ".list_item", (e) => {
            if (e.type === "keypress" && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                return;
            }

            const $element = e.target.closest("li");
            if ($element.hasClass("checked")) {
                this.remove_check_mark($element);
            } else {
                this.add_check_mark($element);
            }

            e.stopPropagation();
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .dropdown_list_reset_button`).on("click", (e) => {
            // Default back the values.
            this.is_reset = true;
            this.checked_items = undefined;

            this.update(this.null_value);
            e.preventDefault();
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(this.container_id)} .multiselect_btn`).on("click", (e) => {
            e.preventDefault();

            // Set the value to `false` to end the scope of the
            // `reset` button.
            this.is_reset = false;
            // We deep clone the values of `data_selected` to a new
            // variable. This is so because arrays are reference types
            // and modifying the parent array can change the values
            // within the child array. Here, `checked_items` copies over the
            // value and not just the reference.
            this.checked_items = lodash__WEBPACK_IMPORTED_MODULE_1___default().cloneDeep(this.data_selected);
            this.update(this.data_selected);

            // Cases when the user wants to pass a successful event after
            // the dropdown is closed.
            if (this.on_close) {
                e.stopPropagation();
                const $setting_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest(
                    `.${CSS.escape(this.widget_name)}_setting`,
                );
                $setting_elem.find(".dropdown-menu").dropdown("toggle");

                this.on_close();
            }
        });
    }

    // Returns array of values selected by user.
    value() {
        let val = this.checked_items;
        // Cases taken care of -
        // - User never pressed the filter button -> We return the initial value.
        // - User pressed the `reset` button -> We return an empty array.
        if (val === undefined) {
            val = this.is_reset ? [] : this.initial_value;
        }
        return val;
    }
}


/***/ }),

/***/ "./static/js/echo.js":
/*!***************************!*\
  !*** ./static/js/echo.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_patch_waiting_for_ack": () => (/* binding */ _patch_waiting_for_ack),
/* harmony export */   "build_display_recipient": () => (/* binding */ build_display_recipient),
/* harmony export */   "edit_locally": () => (/* binding */ edit_locally),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "insert_local_message": () => (/* binding */ insert_local_message),
/* harmony export */   "is_slash_command": () => (/* binding */ is_slash_command),
/* harmony export */   "message_send_error": () => (/* binding */ message_send_error),
/* harmony export */   "process_from_server": () => (/* binding */ process_from_server),
/* harmony export */   "reify_message_id": () => (/* binding */ reify_message_id),
/* harmony export */   "try_deliver_locally": () => (/* binding */ try_deliver_locally),
/* harmony export */   "update_message_lists": () => (/* binding */ update_message_lists)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _local_message__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./local_message */ "./static/js/local_message.js");
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _message_events__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./message_events */ "./static/js/message_events.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _recent_topics_data__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./recent_topics_data */ "./static/js/recent_topics_data.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _sent_messages__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./sent_messages */ "./static/js/sent_messages.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _transmit__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./transmit */ "./static/js/transmit.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




























// Docs: https://zulip.readthedocs.io/en/latest/subsystems/sending-messages.html

const waiting_for_id = new Map();
let waiting_for_ack = new Map();

// These retry spinner functions return true if and only if the
// spinner already is in the requested state, which can be used to
// avoid sending duplicate requests.
function show_retry_spinner($row) {
    const $retry_spinner = $row.find(".refresh-failed-message");

    if (!$retry_spinner.hasClass("rotating")) {
        $retry_spinner.toggleClass("rotating", true);
        return false;
    }
    return true;
}

function hide_retry_spinner($row) {
    const $retry_spinner = $row.find(".refresh-failed-message");

    if ($retry_spinner.hasClass("rotating")) {
        $retry_spinner.toggleClass("rotating", false);
        return false;
    }
    return true;
}

function insert_message(message) {
    // It is a little bit funny to go through the message_events
    // codepath, but it's sort of the idea behind local echo that
    // we are simulating server events before they actually arrive.
    _message_events__WEBPACK_IMPORTED_MODULE_9__.insert_new_messages([message], true);
}

function failed_message_success(message_id) {
    _message_store__WEBPACK_IMPORTED_MODULE_11__.get(message_id).failed_request = false;
    _ui__WEBPACK_IMPORTED_MODULE_23__.show_failed_message_success(message_id);
}

function resend_message(message, $row) {
    message.content = message.raw_content;
    if (show_retry_spinner($row)) {
        // retry already in in progress
        return;
    }

    // Always re-set queue_id if we've gotten a new one
    // since the time when the message object was initially created
    message.queue_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    const local_id = message.local_id;

    function on_success(data) {
        const message_id = data.id;
        const locally_echoed = true;

        hide_retry_spinner($row);

        _compose__WEBPACK_IMPORTED_MODULE_4__.send_message_success(local_id, message_id, locally_echoed);

        // Resend succeeded, so mark as no longer failed
        failed_message_success(message_id);
    }

    function on_error(response) {
        message_send_error(message.id, response);
        setTimeout(() => {
            hide_retry_spinner($row);
        }, 300);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Manual resend of message failed");
    }

    _sent_messages__WEBPACK_IMPORTED_MODULE_19__.start_resend(local_id);
    _transmit__WEBPACK_IMPORTED_MODULE_22__.send_message(message, on_success, on_error);
}

function build_display_recipient(message) {
    if (message.type === "stream") {
        return message.stream;
    }

    // Build a display recipient with the full names of each
    // recipient.  Note that it's important that use
    // util.extract_pm_recipients, which filters out any spurious
    // ", " at the end of the recipient list
    const emails = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message.private_message_recipient);

    let sender_in_display_recipients = false;
    const display_recipient = emails.map((email) => {
        email = email.trim();
        const person = _people__WEBPACK_IMPORTED_MODULE_14__.get_by_email(email);
        if (person === undefined) {
            // For unknown users, we return a skeleton object.
            //
            // This allows us to support zephyr mirroring situations
            // where the server might dynamically create users in
            // response to messages being sent to their email address.
            //
            // TODO: It might be cleaner for the web app for such
            // dynamic user creation to happen inside a separate API
            // call when the pill is constructed, and then enforcing
            // the requirement that we have an actual user object in
            // `people.js` when sending messages.
            return {
                email,
                full_name: email,
                unknown_local_echo_user: true,
            };
        }

        if (person.user_id === message.sender_id) {
            sender_in_display_recipients = true;
        }

        // NORMAL PATH
        //
        // This should match the format of display_recipient
        // objects generated by the backend code in models.py,
        // which is why we create a new object with a `.id` field
        // rather than a `.user_id` field.
        return {
            id: person.user_id,
            email: person.email,
            full_name: person.full_name,
        };
    });

    if (!sender_in_display_recipients) {
        // Ensure that the current user is included in
        // display_recipient for group PMs.
        display_recipient.push({
            id: message.sender_id,
            email: message.sender_email,
            full_name: message.sender_full_name,
        });
    }
    return display_recipient;
}

function insert_local_message(message_request, local_id_float) {
    // Shallow clone of message request object that is turned into something suitable
    // for zulip.js:add_message
    // Keep this in sync with changes to compose.create_message_object
    const message = {...message_request};

    message.raw_content = message.content;

    // NOTE: This will parse synchronously. We're not using the async pipeline
    _markdown__WEBPACK_IMPORTED_MODULE_8__.apply_markdown(message);

    message.content_type = "text/html";
    message.sender_email = _people__WEBPACK_IMPORTED_MODULE_14__.my_current_email();
    message.sender_full_name = _people__WEBPACK_IMPORTED_MODULE_14__.my_full_name();
    message.avatar_url = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    message.timestamp = Date.now() / 1000;
    message.local_id = local_id_float.toString();
    message.locally_echoed = true;
    message.id = local_id_float;
    _markdown__WEBPACK_IMPORTED_MODULE_8__.add_topic_links(message);

    waiting_for_id.set(message.local_id, message);
    waiting_for_ack.set(message.local_id, message);

    message.display_recipient = build_display_recipient(message);

    insert_message(message);
    return message;
}

function is_slash_command(content) {
    return !content.startsWith("/me") && content.startsWith("/");
}

function try_deliver_locally(message_request) {
    if (_markdown__WEBPACK_IMPORTED_MODULE_8__.contains_backend_only_syntax(message_request.content)) {
        return undefined;
    }

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_12__.active() && !_narrow_state__WEBPACK_IMPORTED_MODULE_12__.filter().can_apply_locally(true)) {
        return undefined;
    }

    if (is_slash_command(message_request.content)) {
        return undefined;
    }

    if (!_message_lists__WEBPACK_IMPORTED_MODULE_10__.current.data.fetch_status.has_found_newest()) {
        // If the current message list doesn't yet have the latest
        // messages before the one we just sent, local echo would make
        // it appear as though there were no messages between what we
        // have and the new message we just sent, when in fact we're
        // in the process of fetching those from the server.  In this
        // case, it's correct to skip local echo; we'll get the
        // message we just sent placed appropriately when we get it
        // from either server_events or message_fetch.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Skipping local echo until newest messages get loaded.");
        return undefined;
    }

    const local_id_float = _local_message__WEBPACK_IMPORTED_MODULE_7__.get_next_id_float();

    if (!local_id_float) {
        // This can happen for legit reasons.
        return undefined;
    }

    // Save a locally echoed message in drafts, so it cannot be
    // lost. It will be cleared if the message is sent successfully.
    // We ask the drafts system to not notify the user or update the
    // draft count, since that would be quite distracting in the very
    // common case that the message sends normally.
    const draft_id = _drafts__WEBPACK_IMPORTED_MODULE_6__.update_draft({no_notify: true, update_count: false});
    message_request.draft_id = draft_id;

    // Now that we've committed to delivering the message locally, we
    // shrink the compose-box if it is in the full-screen state. This
    // would have happened anyway in clear_compose_box, however, we
    // need to this operation before inserting the local message into
    // the feed. Otherwise, the out-of-view notification will be
    // always triggered on the top of compose-box, regardless of
    // whether the message would be visible after shrinking compose,
    // because compose occludes the whole screen.
    if (_compose_ui__WEBPACK_IMPORTED_MODULE_5__.is_full_size()) {
        _compose_ui__WEBPACK_IMPORTED_MODULE_5__.make_compose_box_original_size();
    }

    const message = insert_local_message(message_request, local_id_float);
    return message;
}

function edit_locally(message, request) {
    // Responsible for doing the rendering work of locally editing the
    // content of a message.  This is used in several code paths:
    // * Editing a message where a message was locally echoed but
    //   it got an error back from the server
    // * Locally echoing any content-only edits to fully sent messages
    // * Restoring the original content should the server return an
    //   error after having locally echoed content-only messages.
    // The details of what should be changed are encoded in the request.
    const raw_content = request.raw_content;
    const message_content_edited = raw_content !== undefined && message.raw_content !== raw_content;

    if (request.new_topic !== undefined || request.new_stream_id !== undefined) {
        const new_stream_id = request.new_stream_id;
        const new_topic = request.new_topic;
        _stream_topic_history__WEBPACK_IMPORTED_MODULE_21__.remove_messages({
            stream_id: message.stream_id,
            topic_name: message.topic,
            num_messages: 1,
            max_removed_msg_id: message.id,
        });

        if (new_stream_id !== undefined) {
            message.stream_id = new_stream_id;
        }
        if (new_topic !== undefined) {
            message.topic = new_topic;
        }

        _stream_topic_history__WEBPACK_IMPORTED_MODULE_21__.add_message({
            stream_id: message.stream_id,
            topic_name: message.topic,
            message_id: message.id,
        });
    }

    if (message_content_edited) {
        message.raw_content = raw_content;
        if (request.content !== undefined) {
            // This happens in the code path where message editing
            // failed and we're trying to undo the local echo.  We use
            // the saved content and flags rather than rendering; this
            // is important in case
            // markdown.contains_backend_only_syntax(message) is true.
            message.content = request.content;
            message.mentioned = request.mentioned;
            message.mentioned_me_directly = request.mentioned_me_directly;
            message.alerted = request.alerted;
        } else {
            // Otherwise, we Markdown-render the message; this resets
            // all flags, so we need to restore those flags that are
            // properties of how the user has interacted with the
            // message, and not its rendering.
            _markdown__WEBPACK_IMPORTED_MODULE_8__.apply_markdown(message);
            if (request.starred !== undefined) {
                message.starred = request.starred;
            }
            if (request.historical !== undefined) {
                message.historical = request.historical;
            }
            if (request.collapsed !== undefined) {
                message.collapsed = request.collapsed;
            }
        }
    }

    // We don't have logic to adjust unread counts, because message
    // reaching this code path must either have been sent by us or the
    // topic isn't being edited, so unread counts can't have changed.
    for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_10__.all_rendered_message_lists()) {
        msg_list.view.rerender_messages([message]);
    }
    _stream_list__WEBPACK_IMPORTED_MODULE_20__.update_streams_sidebar();
    _pm_list__WEBPACK_IMPORTED_MODULE_15__.update_private_messages();
}

function reify_message_id(local_id, server_id) {
    const message = waiting_for_id.get(local_id);
    waiting_for_id.delete(local_id);

    // reify_message_id is called both on receiving a self-sent message
    // from the server, and on receiving the response to the send request
    // Reification is only needed the first time the server id is found
    if (message === undefined) {
        return;
    }

    message.id = server_id;
    message.locally_echoed = false;

    if (message.draft_id) {
        // Delete the draft if message was locally echoed
        _drafts__WEBPACK_IMPORTED_MODULE_6__.draft_model.deleteDraft(message.draft_id);
    }

    const opts = {old_id: Number.parseFloat(local_id), new_id: server_id};

    _message_store__WEBPACK_IMPORTED_MODULE_11__.reify_message_id(opts);
    update_message_lists(opts);
    _notifications__WEBPACK_IMPORTED_MODULE_13__.reify_message_id(opts);
    _recent_topics_data__WEBPACK_IMPORTED_MODULE_17__.reify_message_id_if_available(opts);
}

function update_message_lists({old_id, new_id}) {
    if (_all_messages_data__WEBPACK_IMPORTED_MODULE_2__.all_messages_data !== undefined) {
        _all_messages_data__WEBPACK_IMPORTED_MODULE_2__.all_messages_data.change_message_id(old_id, new_id);
    }
    for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_10__.all_rendered_message_lists()) {
        msg_list.change_message_id(old_id, new_id);
        msg_list.view.change_message_id(old_id, new_id);
    }
}

function process_from_server(messages) {
    const msgs_to_rerender = [];
    const non_echo_messages = [];

    for (const message of messages) {
        // In case we get the sent message before we get the send ACK, reify here

        const local_id = message.local_id;
        const client_message = waiting_for_ack.get(local_id);
        if (client_message === undefined) {
            // For messages that weren't locally echoed, we go through
            // the "main" codepath that doesn't have to id reconciliation.
            // We simply return non-echo messages to our caller.
            non_echo_messages.push(message);
            continue;
        }

        reify_message_id(local_id, message.id);

        if (_message_store__WEBPACK_IMPORTED_MODULE_11__.get(message.id).failed_request) {
            failed_message_success(message.id);
        }

        if (client_message.content !== message.content) {
            client_message.content = message.content;
            _sent_messages__WEBPACK_IMPORTED_MODULE_19__.mark_disparity(local_id);
        }

        _message_store__WEBPACK_IMPORTED_MODULE_11__.update_booleans(client_message, message.flags);

        // We don't try to highlight alert words locally, so we have to
        // do it now.  (Note that we will indeed highlight alert words in
        // messages that we sent to ourselves, since we might want to test
        // that our alert words are set up correctly.)
        _alert_words__WEBPACK_IMPORTED_MODULE_1__.process_message(client_message);

        // Previously, the message had the "local echo" timestamp set
        // by the browser; if there was some round-trip delay to the
        // server, the actual server-side timestamp could be slightly
        // different.  This corrects the frontend timestamp to match
        // the backend.
        client_message.timestamp = message.timestamp;

        client_message.topic_links = message.topic_links;
        client_message.is_me_message = message.is_me_message;
        client_message.submessages = message.submessages;

        msgs_to_rerender.push(client_message);
        waiting_for_ack.delete(local_id);
    }

    if (msgs_to_rerender.length > 0) {
        // In theory, we could just rerender messages where there were
        // changes in either the rounded timestamp we display or the
        // message content, but in practice, there's no harm to just
        // doing it unconditionally.
        for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_10__.all_rendered_message_lists()) {
            msg_list.view.rerender_messages(msgs_to_rerender);
        }
    }

    return non_echo_messages;
}

function _patch_waiting_for_ack(data) {
    // Only for testing
    waiting_for_ack = data;
}

function message_send_error(message_id, error_response) {
    // Error sending message, show inline
    _message_store__WEBPACK_IMPORTED_MODULE_11__.get(message_id).failed_request = true;
    _ui__WEBPACK_IMPORTED_MODULE_23__.show_message_failed(message_id, error_response);
}

function abort_message(message) {
    // Remove in all lists in which it exists
    _all_messages_data__WEBPACK_IMPORTED_MODULE_2__.all_messages_data.remove([message.id]);
    for (const msg_list of [_message_lists__WEBPACK_IMPORTED_MODULE_10__.home, _message_lists__WEBPACK_IMPORTED_MODULE_10__.current]) {
        msg_list.remove_and_rerender([message.id]);
    }
}

function initialize() {
    function on_failed_action(selector, callback) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#main_div").on("click", selector, function (e) {
            e.stopPropagation();
            _popovers__WEBPACK_IMPORTED_MODULE_16__.hide_all();
            const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".message_row");
            const local_id = _rows__WEBPACK_IMPORTED_MODULE_18__.local_echo_id($row);
            // Message should be waiting for ack and only have a local id,
            // otherwise send would not have failed
            const message = waiting_for_ack.get(local_id);
            if (message === undefined) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Got resend or retry on failure request but did not find message in ack list " +
                        local_id,
                );
                return;
            }
            callback(message, $row);
        });
    }

    on_failed_action(".remove-failed-message", abort_message);
    on_failed_action(".refresh-failed-message", resend_message);
}


/***/ }),

/***/ "./static/js/emoji.js":
/*!****************************!*\
  !*** ./static/js/emoji.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "active_realm_emojis": () => (/* binding */ active_realm_emojis),
/* harmony export */   "all_realm_emojis": () => (/* binding */ all_realm_emojis),
/* harmony export */   "deactivated_emoji_name_to_code": () => (/* binding */ deactivated_emoji_name_to_code),
/* harmony export */   "emojis_by_name": () => (/* binding */ emojis_by_name),
/* harmony export */   "get_canonical_name": () => (/* binding */ get_canonical_name),
/* harmony export */   "get_emoji_codepoint": () => (/* binding */ get_emoji_codepoint),
/* harmony export */   "get_emoji_details_by_name": () => (/* binding */ get_emoji_details_by_name),
/* harmony export */   "get_emoji_details_for_rendering": () => (/* binding */ get_emoji_details_for_rendering),
/* harmony export */   "get_emoji_name": () => (/* binding */ get_emoji_name),
/* harmony export */   "get_emoticon_translations": () => (/* binding */ get_emoticon_translations),
/* harmony export */   "get_realm_emoji_url": () => (/* binding */ get_realm_emoji_url),
/* harmony export */   "get_server_realm_emoji_data": () => (/* binding */ get_server_realm_emoji_data),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "update_emojis": () => (/* binding */ update_emojis)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);


// We will get actual values when we get initialized.
let emoji_codes = {};

// `emojis_by_name` is the central data source that is supposed to be
// used by every widget in the web app for gathering data for displaying
// emojis. Emoji picker uses this data to derive data for its own use.
let emojis_by_name = new Map();

const all_realm_emojis = new Map();
const active_realm_emojis = new Map();
const deactivated_emoji_name_to_code = new Map();

let default_emoji_aliases = new Map();

// For legacy reasons we track server_realm_emoji_data,
// since our settings code builds off that format.  We
// should move it to use all_realm_emojis, which requires
// adding author_id here and then changing the settings code
// in a slightly non-trivial way.
let server_realm_emoji_data = {};

// We really want to deprecate this, too.
function get_server_realm_emoji_data() {
    return server_realm_emoji_data;
}

let emoticon_translations = [];

function build_emoticon_translations({emoticon_conversions}) {
    /*

    Please keep this as a pure function so that we can
    eventually share this code with the mobile codebase.

    Build a data structure that looks like something
    like this:

    [
        { regex: /(\:\))/g, replacement_text: ':smile:' },
        { regex: /(\(\:)/g, replacement_text: ':smile:' },
        { regex: /(\:\/)/g, replacement_text: ':confused:' },
        { regex: /(<3)/g, replacement_text: ':heart:' },
        { regex: /(\:\()/g, replacement_text: ':frown:' },
        { regex: /(\:\|)/g, replacement_text: ':expressionless:' },
        ....
    ]

        We build up this list of ~12 emoticon translations even
        if user_settings.translate_emoticons is false, since
        that setting can be flipped via live update events.
        On the other hand, we assume that emoticon_conversions
        won't change until the next reload, which is fine for
        now (and we want to avoid creating new regexes on
        every new message).
    */

    const translations = [];
    for (const [emoticon, replacement_text] of Object.entries(emoticon_conversions)) {
        const regex = new RegExp("(" + lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp(emoticon) + ")", "g");

        translations.push({
            regex,
            replacement_text,
        });
    }

    return translations;
}

const zulip_emoji = {
    id: "zulip",
    emoji_name: "zulip",
    emoji_url: "/static/generated/emoji/images/emoji/unicode/zulip.png",
    is_realm_emoji: true,
    deactivated: false,
};

function get_emoji_name(codepoint) {
    // get_emoji_name('1f384') === 'holiday_tree'
    if (Object.hasOwn(emoji_codes.codepoint_to_name, codepoint)) {
        return emoji_codes.codepoint_to_name[codepoint];
    }
    return undefined;
}

function get_emoji_codepoint(emoji_name) {
    // get_emoji_codepoint('avocado') === '1f951'
    if (Object.hasOwn(emoji_codes.name_to_codepoint, emoji_name)) {
        return emoji_codes.name_to_codepoint[emoji_name];
    }
    return undefined;
}

function get_realm_emoji_url(emoji_name) {
    // If the emoji name is a realm emoji, returns the URL for it.
    // Returns undefined for Unicode emoji.
    // get_realm_emoji_url('shrug') === '/user_avatars/2/emoji/images/31.png'

    const data = active_realm_emojis.get(emoji_name);

    if (!data) {
        // Not all emojis have URLs, plus the user
        // may have hand-typed an invalid emoji.
        // The caller can check the result for falsiness
        // and then try alternate ways of parsing the
        // emoji (in the case of Markdown) or just do
        // whatever makes sense for the caller.
        return undefined;
    }

    return data.emoji_url;
}

function build_emojis_by_name({
    realm_emojis,
    emoji_catalog,
    get_emoji_name,
    default_emoji_aliases,
}) {
    // Please keep this as a pure function so that we can
    // eventually share this code with the mobile codebase.
    const map = new Map();

    for (const codepoints of Object.values(emoji_catalog)) {
        for (const codepoint of codepoints) {
            const emoji_name = get_emoji_name(codepoint);
            if (emoji_name !== undefined) {
                const emoji_dict = {
                    name: emoji_name,
                    display_name: emoji_name,
                    aliases: default_emoji_aliases.get(codepoint),
                    is_realm_emoji: false,
                    emoji_code: codepoint,
                    has_reacted: false,
                };
                // We may later get overridden by a realm emoji.
                map.set(emoji_name, emoji_dict);
            }
        }
    }

    for (const [realm_emoji_name, realm_emoji] of realm_emojis) {
        const emoji_dict = {
            name: realm_emoji_name,
            display_name: realm_emoji_name,
            aliases: [realm_emoji_name],
            is_realm_emoji: true,
            url: realm_emoji.emoji_url,
            has_reacted: false,
        };

        // We want the realm emoji to overwrite any existing entry in this map.
        map.set(realm_emoji_name, emoji_dict);
    }

    return map;
}

function update_emojis(realm_emojis) {
    // The settings code still works with the
    // server format of the data.
    server_realm_emoji_data = realm_emojis;

    // all_realm_emojis is emptied before adding the realm-specific emoji
    // to it. This makes sure that in case of deletion, the deleted realm_emojis
    // don't persist in active_realm_emojis.
    all_realm_emojis.clear();
    active_realm_emojis.clear();

    for (const data of Object.values(realm_emojis)) {
        all_realm_emojis.set(data.id, {
            id: data.id,
            emoji_name: data.name,
            emoji_url: data.source_url,
            still_url: data.still_url,
            deactivated: data.deactivated,
        });
        if (data.deactivated !== true) {
            active_realm_emojis.set(data.name, {
                id: data.id,
                emoji_name: data.name,
                emoji_url: data.source_url,
                still_url: data.still_url,
            });
        }
    }

    // Add the special Zulip emoji as though it were a realm emoji.

    // The Zulip emoji is the only emoji that uses a string ("zulip")
    // as its ID. All other emoji use numeric IDs. This special case
    // is confusing; ideally we'd convert the Zulip emoji to be
    // implemented using the RealmEmoji infrastructure.
    all_realm_emojis.set("zulip", zulip_emoji);

    // here "zulip" is an emoji name, which is fine.
    active_realm_emojis.set("zulip", zulip_emoji);

    emojis_by_name = build_emojis_by_name({
        realm_emojis: active_realm_emojis,
        emoji_catalog: emoji_codes.emoji_catalog,
        get_emoji_name,
        default_emoji_aliases,
    });
}

// This function will provide required parameters that would
// need by template to render an emoji.
function get_emoji_details_by_name(emoji_name) {
    // To call this function you must pass an emoji name.
    if (!emoji_name) {
        throw new Error("Emoji name must be passed.");
    }

    const emoji_info = {emoji_name};

    if (active_realm_emojis.has(emoji_name)) {
        if (emoji_name === "zulip") {
            emoji_info.reaction_type = "zulip_extra_emoji";
        } else {
            emoji_info.reaction_type = "realm_emoji";
        }
        const emoji_code_info = active_realm_emojis.get(emoji_name);
        emoji_info.emoji_code = emoji_code_info.id;
        emoji_info.url = emoji_code_info.emoji_url;
        if (emoji_code_info.still_url) {
            emoji_info.still_url = emoji_code_info.still_url;
        }
    } else {
        const codepoint = get_emoji_codepoint(emoji_name);
        if (codepoint === undefined) {
            throw new Error("Bad emoji name: " + emoji_name);
        }
        emoji_info.reaction_type = "unicode_emoji";
        emoji_info.emoji_code = codepoint;
    }
    return emoji_info;
}

function get_emoji_details_for_rendering(opts) {
    if (!opts.emoji_name || !opts.emoji_code || !opts.reaction_type) {
        throw new Error("Invalid params.");
    }

    if (opts.reaction_type !== "unicode_emoji") {
        const realm_emoji = all_realm_emojis.get(opts.emoji_code);
        if (!realm_emoji) {
            throw new Error(`Cannot find realm emoji for code '${opts.emoji_code}'.`);
        }
        return {
            url: realm_emoji.emoji_url,
            still_url: realm_emoji.still_url,
            emoji_name: opts.emoji_name,
            emoji_code: opts.emoji_code,
            reaction_type: opts.reaction_type,
        };
    }
    // else
    return {
        emoji_name: opts.emoji_name,
        emoji_code: opts.emoji_code,
        reaction_type: opts.reaction_type,
    };
}

function build_default_emoji_aliases({names, get_emoji_codepoint}) {
    // Please keep this as a pure function so that we can
    // eventually share this code with the mobile codebase.

    // Create a map of codepoint -> names
    const map = new Map();

    for (const name of names) {
        const base_name = get_emoji_codepoint(name);

        if (map.has(base_name)) {
            map.get(base_name).push(name);
        } else {
            map.set(base_name, [name]);
        }
    }

    return map;
}

function initialize(params) {
    emoji_codes = params.emoji_codes;

    emoticon_translations = build_emoticon_translations({
        emoticon_conversions: emoji_codes.emoticon_conversions,
    });

    default_emoji_aliases = build_default_emoji_aliases({
        names: emoji_codes.names,
        get_emoji_codepoint,
    });

    update_emojis(params.realm_emoji);
}

function get_canonical_name(emoji_name) {
    if (active_realm_emojis.has(emoji_name)) {
        return emoji_name;
    }
    const codepoint = get_emoji_codepoint(emoji_name);
    if (codepoint === undefined) {
        // Our caller needs to handle this possibility.
        return undefined;
    }

    return get_emoji_name(codepoint);
}

function get_emoticon_translations() {
    return emoticon_translations;
}


/***/ }),

/***/ "./static/js/emoji_picker.js":
/*!***********************************!*\
  !*** ./static/js/emoji_picker.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_emoji_popover": () => (/* binding */ build_emoji_popover),
/* harmony export */   "complete_emoji_catalog": () => (/* binding */ complete_emoji_catalog),
/* harmony export */   "emoji_select_tab": () => (/* binding */ emoji_select_tab),
/* harmony export */   "hide_emoji_popover": () => (/* binding */ hide_emoji_popover),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_emoji_present_in_text": () => (/* binding */ is_emoji_present_in_text),
/* harmony export */   "navigate": () => (/* binding */ navigate),
/* harmony export */   "reactions_popped": () => (/* binding */ reactions_popped),
/* harmony export */   "rebuild_catalog": () => (/* binding */ rebuild_catalog),
/* harmony export */   "register_click_handlers": () => (/* binding */ register_click_handlers),
/* harmony export */   "toggle_emoji_popover": () => (/* binding */ toggle_emoji_popover)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/js/typeahead */ "./static/shared/js/typeahead.js");
/* harmony import */ var _templates_emoji_popover_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/emoji_popover.hbs */ "./static/templates/emoji_popover.hbs");
/* harmony import */ var _templates_emoji_popover_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_emoji_popover_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_emoji_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/emoji_popover_content.hbs */ "./static/templates/emoji_popover_content.hbs");
/* harmony import */ var _templates_emoji_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_emoji_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_emoji_popover_search_results_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/emoji_popover_search_results.hbs */ "./static/templates/emoji_popover_search_results.hbs");
/* harmony import */ var _templates_emoji_popover_search_results_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_emoji_popover_search_results_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_emoji_showcase_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/emoji_showcase.hbs */ "./static/templates/emoji_showcase.hbs");
/* harmony import */ var _templates_emoji_showcase_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_emoji_showcase_hbs__WEBPACK_IMPORTED_MODULE_5__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _reactions__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./reactions */ "./static/js/reactions.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_status_ui__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./user_status_ui */ "./static/js/user_status_ui.js");


// import emoji_codes from "../generated/emoji/emoji_codes.json";





















// Emoji picker is of fixed width and height. Update these
// whenever these values are changed in `reactions.css`.
const APPROX_HEIGHT = 375;
const APPROX_WIDTH = 255;

// The functionalities for reacting to a message with an emoji
// and composing a message with an emoji share a single widget,
// implemented as the emoji_popover.
let complete_emoji_catalog = [];

let $current_message_emoji_popover_elem;
let emoji_catalog_last_coordinates = {
    section: 0,
    index: 0,
};
let current_section = 0;
let current_index = 0;
let search_is_active = false;
const search_results = [];
let section_head_offsets = [];
let edit_message_id = null;

const EMOJI_CATEGORIES = [
    {name: "Popular", icon: "fa-star-o"},
    {name: "Smileys & Emotion", icon: "fa-smile-o"},
    {name: "People & Body", icon: "fa-thumbs-o-up"},
    {name: "Animals & Nature", icon: "fa-leaf"},
    {name: "Food & Drink", icon: "fa-cutlery"},
    {name: "Activities", icon: "fa-soccer-ball-o"},
    {name: "Travel & Places", icon: "fa-car"},
    {name: "Objects", icon: "fa-lightbulb-o"},
    {name: "Symbols", icon: "fa-hashtag"},
    {name: "Flags", icon: "fa-flag"},
    {name: "Custom", icon: "fa-cog"},
];

function get_total_sections() {
    if (search_is_active) {
        return 1;
    }
    return complete_emoji_catalog.length;
}

function get_max_index(section) {
    if (search_is_active) {
        return search_results.length;
    } else if (section >= 0 && section < get_total_sections()) {
        return complete_emoji_catalog[section].emojis.length;
    }
    return undefined;
}

function get_emoji_id(section, index) {
    let type = "emoji_picker_emoji";
    if (search_is_active) {
        type = "emoji_search_result";
    }
    const emoji_id = [type, section, index].join(",");
    return emoji_id;
}

function get_emoji_coordinates(emoji_id) {
    // Emoji id is of the following form:
    //    <emoji_type>_<section_number>_<index>.
    // See `get_emoji_id()`.
    const emoji_info = emoji_id.split(",");
    return {
        section: Number.parseInt(emoji_info[1], 10),
        index: Number.parseInt(emoji_info[2], 10),
    };
}

function show_search_results() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-emoji-map").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-category-tabs").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container").show();
    emoji_catalog_last_coordinates = {
        section: current_section,
        index: current_index,
    };
    current_section = 0;
    current_index = 0;
    search_is_active = true;
}

function show_emoji_catalog() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-emoji-map").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-category-tabs").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container").hide();
    current_section = emoji_catalog_last_coordinates.section;
    current_index = emoji_catalog_last_coordinates.index;
    search_is_active = false;
}

function rebuild_catalog() {
    const realm_emojis = _emoji__WEBPACK_IMPORTED_MODULE_8__.active_realm_emojis;

    const catalog = new Map();
    catalog.set(
        "Custom",
        Array.from(realm_emojis.keys(), (realm_emoji_name) =>
            _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.get(realm_emoji_name),
        ),
    );

    for (const [category, codepoints] of Object.entries(emoji_codes.emoji_catalog)) {
        const emojis = [];
        for (const codepoint of codepoints) {
            const name = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_emoji_name(codepoint);
            if (name !== undefined) {
                const emoji_dict = _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.get(name);
                if (emoji_dict !== undefined && emoji_dict.is_realm_emoji !== true) {
                    emojis.push(emoji_dict);
                }
            }
        }
        catalog.set(category, emojis);
    }

    const popular = [];
    for (const codepoint of _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__.popular_emojis) {
        const name = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_emoji_name(codepoint);
        if (name !== undefined) {
            const emoji_dict = _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.get(name);
            if (emoji_dict !== undefined) {
                popular.push(emoji_dict);
            }
        }
    }
    catalog.set("Popular", popular);

    const categories = EMOJI_CATEGORIES.filter((category) => catalog.has(category.name));
    complete_emoji_catalog = categories.map((category) => ({
        name: category.name,
        icon: category.icon,
        emojis: catalog.get(category.name),
    }));
}

const generate_emoji_picker_content = function (id) {
    let emojis_used = [];

    if (id !== undefined) {
        emojis_used = _reactions__WEBPACK_IMPORTED_MODULE_12__.get_emojis_used_by_user_for_message_id(id);
    }
    for (const emoji_dict of _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.values()) {
        emoji_dict.has_reacted = emoji_dict.aliases.some((alias) => emojis_used.includes(alias));
    }

    return _templates_emoji_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        message_id: id,
        emoji_categories: complete_emoji_catalog,
        is_status_emoji_popover: _user_status_ui__WEBPACK_IMPORTED_MODULE_16__.user_status_picker_open(),
    });
};

function refill_section_head_offsets($popover) {
    section_head_offsets = [];
    $popover.find(".emoji-popover-subheading").each(function () {
        section_head_offsets.push({
            section: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-section"),
            position_y: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).position().top,
        });
    });
}

function reactions_popped() {
    return $current_message_emoji_popover_elem !== undefined;
}

function hide_emoji_popover() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".has_popover").removeClass("has_popover has_emoji_popover");
    if (_user_status_ui__WEBPACK_IMPORTED_MODULE_16__.user_status_picker_open()) {
        // Re-enable clicking events for other elements after closing
        // the popover.  This is the inverse of the hack of in the
        // handler that opens the "user status modal" emoji picker.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app, .header, .modal__overlay, #set_user_status_modal").css("pointer-events", "all");
    }
    if (reactions_popped()) {
        $current_message_emoji_popover_elem.popover("destroy");
        $current_message_emoji_popover_elem.removeClass("reaction_button_visible");
        $current_message_emoji_popover_elem = undefined;
    }
}

function get_selected_emoji() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-emoji:focus")[0];
}

function get_rendered_emoji(section, index) {
    const emoji_id = get_emoji_id(section, index);
    const $emoji = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.emoji-popover-emoji[data-emoji-id='${CSS.escape(emoji_id)}']`);
    if ($emoji.length > 0) {
        return $emoji;
    }
    return undefined;
}

function is_emoji_present_in_text(text, emoji_dict) {
    // fetching emoji details to ensure emoji_code and reaction_type are present
    const emoji_info = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_emoji_details_by_name(emoji_dict.name);
    if (_shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__.is_unicode_emoji(emoji_info)) {
        // convert emoji_dict to an actual emoji character
        const parsed_emoji_code = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__.parse_unicode_emoji_code(emoji_info.emoji_code);

        return text.includes(parsed_emoji_code);
    }

    return false;
}

function filter_emojis() {
    const $elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").expectOne();
    const query = $elt.val().trim().toLowerCase();
    const message_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container").data("message-id");
    const search_results_visible = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container").is(":visible");
    if (query !== "") {
        const categories = complete_emoji_catalog;
        const search_terms = query.split(" ");
        search_results.length = 0;

        for (const category of categories) {
            if (category.name === "Popular") {
                continue;
            }
            const emojis = category.emojis;
            for (const emoji_dict of emojis) {
                for (const alias of emoji_dict.aliases) {
                    const match = search_terms.every((search_term) => alias.includes(search_term));
                    if (match) {
                        search_results.push({...emoji_dict, emoji_name: alias});
                        break; // We only need the first matching alias per emoji.
                    }
                }

                // using query instead of search_terms because it's possible multiple emojis were input
                // without being separated by spaces
                if (is_emoji_present_in_text(query, emoji_dict)) {
                    search_results.push({...emoji_dict, emoji_name: emoji_dict.name});
                }
            }
        }

        const sorted_search_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__.sort_emojis(search_results, query);
        const rendered_search_results = _templates_emoji_popover_search_results_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
            search_results: sorted_search_results,
            is_status_emoji_popover: _user_status_ui__WEBPACK_IMPORTED_MODULE_16__.user_status_picker_open(),
            message_id,
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results").html(rendered_search_results);
        _ui__WEBPACK_IMPORTED_MODULE_15__.reset_scrollbar(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container"));
        if (!search_results_visible) {
            show_search_results();
        }
    } else {
        show_emoji_catalog();
    }
}

function toggle_reaction(emoji_name, event) {
    const message_id = _message_lists__WEBPACK_IMPORTED_MODULE_9__.current.selected_id();
    const message = _message_store__WEBPACK_IMPORTED_MODULE_10__.get(message_id);
    if (!message) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("reactions: Bad message id: " + message_id);
        return;
    }

    _reactions__WEBPACK_IMPORTED_MODULE_12__.toggle_emoji_reaction(message_id, emoji_name, event);

    if (!event.shiftKey) {
        hide_emoji_popover();
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.target).closest(".reaction").toggleClass("reacted");
}

function is_composition(emoji) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(emoji).hasClass("composition");
}

function is_status_emoji(emoji) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(emoji).hasClass("status_emoji");
}

function process_enter_while_filtering(e) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
        e.preventDefault();
        const $first_emoji = get_rendered_emoji(0, 0);
        if ($first_emoji) {
            if (is_composition($first_emoji)) {
                $first_emoji.trigger("click");
            } else {
                toggle_reaction($first_emoji.attr("data-emoji-name"), e);
            }
        }
    }
}

function toggle_selected_emoji(e) {
    // Toggle the currently selected emoji.
    const selected_emoji = get_selected_emoji();

    if (selected_emoji === undefined) {
        return;
    }

    const emoji_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(selected_emoji).attr("data-emoji-name");

    toggle_reaction(emoji_name, e);
}

function round_off_to_previous_multiple(number_to_round, multiple) {
    return number_to_round - (number_to_round % multiple);
}

function reset_emoji_showcase() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-showcase-container").empty();
}

function update_emoji_showcase($focused_emoji) {
    // Don't use jQuery's data() function here. It has the side-effect
    // of converting emoji names like :100:, :1234: etc to number.
    const focused_emoji_name = $focused_emoji.attr("data-emoji-name");
    const canonical_name = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_canonical_name(focused_emoji_name);

    if (!canonical_name) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid focused_emoji_name: " + focused_emoji_name);
        return;
    }

    const focused_emoji_dict = _emoji__WEBPACK_IMPORTED_MODULE_8__.emojis_by_name.get(canonical_name);

    const emoji_dict = {
        ...focused_emoji_dict,
        name: focused_emoji_name.replace(/_/g, " "),
    };
    const rendered_showcase = _templates_emoji_showcase_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
        emoji_dict,
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-showcase-container").html(rendered_showcase);
}

function maybe_change_focused_emoji($emoji_map, next_section, next_index, preserve_scroll) {
    const $next_emoji = get_rendered_emoji(next_section, next_index);
    if ($next_emoji) {
        current_section = next_section;
        current_index = next_index;
        if (!preserve_scroll) {
            $next_emoji.trigger("focus");
        } else {
            const start = _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop();
            $next_emoji.trigger("focus");
            if (_ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop() !== start) {
                _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop(start);
            }
        }
        update_emoji_showcase($next_emoji);
        return true;
    }
    return false;
}

function maybe_change_active_section(next_section) {
    const $emoji_map = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-emoji-map");

    if (next_section >= 0 && next_section < get_total_sections()) {
        current_section = next_section;
        current_index = 0;
        const offset = section_head_offsets[current_section];
        if (offset) {
            _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop(offset.position_y);
            maybe_change_focused_emoji($emoji_map, current_section, current_index);
        }
    }
}

function get_next_emoji_coordinates(move_by) {
    let next_section = current_section;
    let next_index = current_index + move_by;
    let max_len;
    if (next_index < 0) {
        next_section = next_section - 1;
        if (next_section >= 0) {
            next_index = get_max_index(next_section) - 1;
            if (move_by === -6) {
                max_len = get_max_index(next_section);
                const prev_multiple = round_off_to_previous_multiple(max_len, 6);
                next_index = prev_multiple + current_index;
                next_index = next_index >= max_len ? prev_multiple + current_index - 6 : next_index;
            }
        }
    } else if (next_index >= get_max_index(next_section)) {
        next_section = next_section + 1;
        if (next_section < get_total_sections()) {
            next_index = 0;
            if (move_by === 6) {
                max_len = get_max_index(next_index);
                next_index = current_index % 6;
                next_index = next_index >= max_len ? max_len - 1 : next_index;
            }
        }
    }

    return {
        section: next_section,
        index: next_index,
    };
}

function change_focus_to_filter() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").trigger("focus");
    // If search is active reset current selected emoji to first emoji.
    if (search_is_active) {
        current_section = 0;
        current_index = 0;
    }
    reset_emoji_showcase();
}

function navigate(event_name, e) {
    if (
        event_name === "toggle_reactions_popover" &&
        reactions_popped() &&
        (search_is_active === false || search_results.length === 0)
    ) {
        hide_emoji_popover();
        return true;
    }

    // If search is active and results are empty then return immediately.
    if (search_is_active === true && search_results.length === 0) {
        // We don't want to prevent default for keys like Backspace and space.
        return false;
    }

    if (event_name === "enter") {
        if (is_composition(e.target) || is_status_emoji(e.target)) {
            e.target.click();
        } else {
            toggle_selected_emoji(e);
        }
        return true;
    }

    const $popover = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover").expectOne();
    const $emoji_map = $popover.find(".emoji-popover-emoji-map").expectOne();

    const $selected_emoji = get_rendered_emoji(current_section, current_index);
    const is_filter_focused = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").is(":focus");
    // special cases
    if (is_filter_focused) {
        // Move down into emoji map.
        const filter_text = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").val();
        const is_cursor_at_end = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").caret() === filter_text.length;
        if (event_name === "down_arrow" || (is_cursor_at_end && event_name === "right_arrow")) {
            $selected_emoji.trigger("focus");
            if (current_section === 0 && current_index < 6) {
                _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop(0);
            }
            update_emoji_showcase($selected_emoji);
            return true;
        }
        if (event_name === "tab") {
            $selected_emoji.trigger("focus");
            update_emoji_showcase($selected_emoji);
            return true;
        }
        return false;
    } else if (
        (current_section === 0 && current_index < 6 && event_name === "up_arrow") ||
        (current_section === 0 && current_index === 0 && event_name === "left_arrow")
    ) {
        if ($selected_emoji) {
            // In this case, we're move up into the reaction
            // filter. Here, we override the default browser
            // behavior, which in Firefox is good (preserving
            // the cursor position) and in Chrome is bad (cursor
            // goes to beginning) with something reasonable and
            // consistent (cursor goes to the end of the filter
            // string).
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").trigger("focus").caret(Number.POSITIVE_INFINITY);
            _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop(0);
            _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-search-results-container")).scrollTop(0);
            current_section = 0;
            current_index = 0;
            reset_emoji_showcase();
            return true;
        }
        return false;
    }

    switch (event_name) {
        case "tab":
        case "shift_tab":
            change_focus_to_filter();
            return true;
        case "page_up":
            maybe_change_active_section(current_section - 1);
            return true;
        case "page_down":
            maybe_change_active_section(current_section + 1);
            return true;
        case "down_arrow":
        case "up_arrow":
        case "left_arrow":
        case "right_arrow": {
            const next_coord = get_next_emoji_coordinates(
                {down_arrow: 6, up_arrow: -6, left_arrow: -1, right_arrow: 1}[event_name],
            );
            return maybe_change_focused_emoji($emoji_map, next_coord.section, next_coord.index);
        }
        default:
            return false;
    }
}

function process_keypress(e) {
    const is_filter_focused = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").is(":focus");
    const pressed_key = e.which;
    if (
        !is_filter_focused &&
        // ':' => 58, is a hotkey for toggling reactions popover.
        pressed_key !== 58 &&
        ((pressed_key >= 32 && pressed_key <= 126) || pressed_key === 8)
    ) {
        // Handle only printable characters or Backspace.
        e.preventDefault();
        e.stopPropagation();

        const $emoji_filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter");
        const old_query = $emoji_filter.val();
        let new_query = "";

        if (pressed_key === 8) {
            // Handles Backspace.
            new_query = old_query.slice(0, -1);
        } else {
            // Handles any printable character.
            const key_str = String.fromCodePoint(e.which);
            new_query = old_query + key_str;
        }

        $emoji_filter.val(new_query);
        change_focus_to_filter();
        filter_emojis();
    }
}

function emoji_select_tab($elt) {
    const scrolltop = $elt.scrollTop();
    const scrollheight = $elt.prop("scrollHeight");
    const elt_height = $elt.height();
    let currently_selected = "";
    for (const o of section_head_offsets) {
        if (scrolltop + elt_height / 2 >= o.position_y) {
            currently_selected = o.section;
        }
    }
    // Handles the corner case of the last category being
    // smaller than half of the emoji picker height.
    if (elt_height + scrolltop === scrollheight) {
        currently_selected = section_head_offsets.at(-1).section;
    }
    // Handles the corner case of the scrolling back to top.
    if (scrolltop === 0) {
        currently_selected = section_head_offsets[0].section;
    }
    if (currently_selected) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-tab-item.active").removeClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.emoji-popover-tab-item[data-tab-name="${CSS.escape(currently_selected)}"]`).addClass(
            "active",
        );
    }
}

function register_popover_events($popover) {
    const $emoji_map = $popover.find(".emoji-popover-emoji-map");

    _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).on("scroll", () => {
        emoji_select_tab(_ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map));
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").on("input", filter_emojis);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover-filter").on("keydown", process_enter_while_filtering);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover").on("keypress", process_keypress);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".emoji-popover").on("keydown", (e) => {
        // Because of cross-browser issues we need to handle Backspace
        // key separately. Firefox fires `keypress` event for Backspace
        // key but chrome doesn't so we need to trigger the logic for
        // handling Backspace in `keydown` event which is fired by both.
        if (e.which === 8) {
            process_keypress(e);
        }
    });
}

function build_emoji_popover($elt, id) {
    const template_args = {
        class: "emoji-info-popover",
    };
    let placement = _popovers__WEBPACK_IMPORTED_MODULE_11__.compute_placement($elt, APPROX_HEIGHT, APPROX_WIDTH, true);

    if (placement === "viewport_center") {
        // For legacy reasons `compute_placement` actually can
        // return `viewport_center`, but bootstrap doesn't actually
        // support that.
        placement = "left";
    }

    let template = _templates_emoji_popover_hbs__WEBPACK_IMPORTED_MODULE_2___default()(template_args);

    // if the window is mobile sized, add the `.popover-flex` wrapper to the emoji
    // popover so that it will be wrapped in flex and centered in the screen.
    if (window.innerWidth <= 768) {
        template = "<div class='popover-flex'>" + template + "</div>";
    }

    $elt.popover({
        // temporary patch for handling popover placement of `viewport_center`
        placement,
        fix_positions: true,
        template,
        title: "",
        content: generate_emoji_picker_content(id),
        html: true,
        trigger: "manual",
    });
    $elt.popover("show");

    const $popover = $elt.data("popover").$tip;
    $popover.find(".emoji-popover-filter").trigger("focus");
    $current_message_emoji_popover_elem = $elt;

    emoji_catalog_last_coordinates = {
        section: 0,
        index: 0,
    };
    show_emoji_catalog();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(() => refill_section_head_offsets($popover));
    register_popover_events($popover);
}

function toggle_emoji_popover(element, id, coming_from_actions_popover) {
    const $last_popover_elem = $current_message_emoji_popover_elem;
    _popovers__WEBPACK_IMPORTED_MODULE_11__.hide_all();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        // We want it to be the case that a user can dismiss a popover
        // by clicking on the same element that caused the popover.
        return;
    }

    const $elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(element);
    $elt.closest(".message_row").toggleClass("has_popover has_emoji_popover");
    if (id !== undefined) {
        _message_lists__WEBPACK_IMPORTED_MODULE_9__.current.select_id(id);
    }

    if (_user_status_ui__WEBPACK_IMPORTED_MODULE_16__.user_status_picker_open()) {
        build_emoji_popover($elt, id);
    } else if ($elt.data("popover") === undefined || coming_from_actions_popover) {
        // Keep the element over which the popover is based off visible.
        $elt.addClass("reaction_button_visible");
        build_emoji_popover($elt, id);
    }
    reset_emoji_showcase();
}

function register_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("click", ".emoji-popover-emoji.reaction", function (e) {
        // When an emoji is clicked in the popover,
        // if the user has reacted to this message with this emoji
        // the reaction is removed
        // otherwise, the reaction is added
        const emoji_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-emoji-name");
        toggle_reaction(emoji_name, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("click", ".emoji-popover-emoji.composition", function (e) {
        const emoji_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-emoji-name");
        const emoji_text = ":" + emoji_name + ":";
        // The following check will return false if emoji was not selected in
        // message edit form.
        if (edit_message_id !== null) {
            const $edit_message_textarea = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                `#edit_form_${CSS.escape(edit_message_id)} .message_edit_content`,
            );
            // Assign null to edit_message_id so that the selection of emoji in new
            // message composition form works correctly.
            edit_message_id = null;
            _compose_ui__WEBPACK_IMPORTED_MODULE_7__.insert_syntax_and_focus(emoji_text, $edit_message_textarea);
        } else {
            _compose_ui__WEBPACK_IMPORTED_MODULE_7__.insert_syntax_and_focus(emoji_text);
        }
        e.stopPropagation();
        hide_emoji_popover();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".emoji_map", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const compose_click_target = _compose_ui__WEBPACK_IMPORTED_MODULE_7__.get_compose_click_target(e);
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(compose_click_target).parents(".message_edit_form").length === 1) {
            // Store message id in global variable edit_message_id so that
            // its value can be further used to correctly find the message textarea element.
            edit_message_id = _rows__WEBPACK_IMPORTED_MODULE_13__.get_message_id(compose_click_target);
        } else {
            edit_message_id = null;
        }
        toggle_emoji_popover(compose_click_target);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#main_div").on("click", ".reaction_button", function (e) {
        e.stopPropagation();

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            _spectators__WEBPACK_IMPORTED_MODULE_14__.login_to_access();
            return;
        }

        const message_id = _rows__WEBPACK_IMPORTED_MODULE_13__.get_message_id(this);
        toggle_emoji_popover(this, message_id);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".emoji-popover-tab-item", function (e) {
        e.stopPropagation();
        e.preventDefault();

        const $popover = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest(".emoji-info-popover").expectOne();
        const $emoji_map = $popover.find(".emoji-popover-emoji-map");

        const offset = section_head_offsets.find(
            (o) => o.section === jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-tab-name"),
        );

        if (offset) {
            _ui__WEBPACK_IMPORTED_MODULE_15__.get_scroll_element($emoji_map).scrollTop(offset.position_y);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".emoji-popover-filter", () => {
        reset_emoji_showcase();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("mouseenter", ".emoji-popover-emoji", (e) => {
        const emoji_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).data("emoji-id");
        const emoji_coordinates = get_emoji_coordinates(emoji_id);

        const $emoji_map = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget)
            .closest(".emoji-popover")
            .expectOne()
            .find(".emoji-popover-emoji-map");
        maybe_change_focused_emoji(
            $emoji_map,
            emoji_coordinates.section,
            emoji_coordinates.index,
            true,
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#set_user_status_modal #selected_emoji", (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggle_emoji_popover(e.target);
        // Because the emoji picker gets drawn on top of the user
        // status modal, we need this hack to make clicking outside
        // the emoji picker only close the emoji picker, and not the
        // whole user status modal.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app, .header, .modal__overlay, #set_user_status_modal").css("pointer-events", "none");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("click", ".emoji-popover-emoji.status_emoji", function (e) {
        e.preventDefault();
        e.stopPropagation();
        hide_emoji_popover();
        const emoji_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-emoji-name");
        let emoji_info = {
            emoji_name,
            emoji_alt_code: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "text",
        };
        if (!emoji_info.emoji_alt_code) {
            emoji_info = {...emoji_info, ..._emoji__WEBPACK_IMPORTED_MODULE_8__.get_emoji_details_by_name(emoji_name)};
        }
        _user_status_ui__WEBPACK_IMPORTED_MODULE_16__.set_selected_emoji_info(emoji_info);
        _user_status_ui__WEBPACK_IMPORTED_MODULE_16__.update_button();
        _user_status_ui__WEBPACK_IMPORTED_MODULE_16__.toggle_clear_message_button();
    });
}

function initialize() {
    rebuild_catalog();
}


/***/ }),

/***/ "./static/js/emojisets.js":
/*!********************************!*\
  !*** ./static/js/emojisets.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "select": () => (/* binding */ select)
/* harmony export */ });
/* harmony import */ var emoji_datasource_google_blob_img_google_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! emoji-datasource-google-blob/img/google/sheets-256/64.png */ "./node_modules/emoji-datasource-google-blob/img/google/sheets-256/64.png");
/* harmony import */ var emoji_datasource_google_img_google_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! emoji-datasource-google/img/google/sheets-256/64.png */ "./node_modules/emoji-datasource-google/img/google/sheets-256/64.png");
/* harmony import */ var emoji_datasource_twitter_img_twitter_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! emoji-datasource-twitter/img/twitter/sheets-256/64.png */ "./node_modules/emoji-datasource-twitter/img/twitter/sheets-256/64.png");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




// import octopus_url from "../generated/emoji/images-google-64/1f419.png";



// import google_blob_css from "!style-loader?injectType=lazyStyleTag!css-loader!../generated/emoji-styles/google-blob-sprite.css";
// import google_css from "!style-loader?injectType=lazyStyleTag!css-loader!../generated/emoji-styles/google-sprite.css";
// import twitter_css from "!style-loader?injectType=lazyStyleTag!css-loader!../generated/emoji-styles/twitter-sprite.css";

// const emojisets = new Map([
//     ["google", {css: google_css, sheet: google_sheet}],
//     ["google-blob", {css: google_blob_css, sheet: google_blob_sheet}],
//     ["twitter", {css: twitter_css, sheet: twitter_sheet}],
// ]);
const emojisets = new Map([
    ["google", {sheet: emoji_datasource_google_img_google_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_1__}],
    ["google-blob", { sheet: emoji_datasource_google_blob_img_google_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_0__}],
    ["twitter", {sheet: emoji_datasource_twitter_img_twitter_sheets_256_64_png__WEBPACK_IMPORTED_MODULE_2__}],
]);

// For `text` emoji set we fallback to `google` emoji set
// for displaying emojis in emoji picker and typeahead.
emojisets.set("text", emojisets.get("google"));

let current_emojiset;

async function select(name) {
    const new_emojiset = emojisets.get(name);
    if (new_emojiset === current_emojiset) {
        return;
    }
    await new Promise((resolve, reject) => {
        const sheet = new Image();
        sheet.addEventListener("load", resolve);
        sheet.addEventListener("error", reject);
        sheet.src = new_emojiset.sheet;
    });
    if (current_emojiset) {
        current_emojiset.css.unuse();
    }
    new_emojiset.css.use();
    current_emojiset = new_emojiset;
}

function initialize() {
    select(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    // Load the octopus image in the background, so that the browser
    // will cache it for later use.  Note that we hardcode the octopus
    // emoji to the old Google one because it's better.
    //
    // TODO: We should probably just make this work just like the Zulip emoji.
    const octopus_image = new Image();
    octopus_image.src = octopus_url;
}


/***/ }),

/***/ "./static/js/favicon.js":
/*!******************************!*\
  !*** ./static/js/favicon.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "update_favicon": () => (/* binding */ update_favicon)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_favicon_svg_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/favicon.svg.hbs */ "./static/templates/favicon.svg.hbs");
/* harmony import */ var _templates_favicon_svg_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_favicon_svg_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _favicon_font_url_url_loader_font_subset_loader2_glyphs_0123456789KMGT_source_sans_TTF_SourceSans3_Bold_ttf__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./favicon_font_url!=!url-loader!font-subset-loader2?glyphs=0123456789KMGT∞!source-sans/TTF/SourceSans3-Bold.ttf */ "./static/js/favicon_font_url!=!./node_modules/url-loader/dist/cjs.js!./node_modules/font-subset-loader2/index.js?glyphs=0123456789KMGT∞!./node_modules/source-sans/TTF/SourceSans3-Bold.ttf");







let favicon_state;

function load_and_set_favicon(rendered_favicon) {
    favicon_state = {
        url: URL.createObjectURL(new Blob([rendered_favicon], {type: "image/svg+xml"})),
        image: new Image(),
    };

    // Without loading the SVG in an Image first, Chrome mysteriously fails to
    // render the webfont (https://crbug.com/1140920).
    favicon_state.image.src = favicon_state.url;
    favicon_state.image.addEventListener("load", set_favicon);
}

function set_favicon() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#favicon").attr("href", favicon_state.url);
}

function update_favicon(new_message_count, pm_count) {
    try {
        if (favicon_state !== undefined) {
            favicon_state.image.removeEventListener("load", set_favicon);

            // We need to remove this src so revokeObjectURL doesn't cause a
            // net::ERR_FILE_NOT_FOUND error in Chrome. This seems to be the
            // simplest way to do that without triggering an expensive network
            // request or spewing a different console error.
            favicon_state.image.src = "data:,";

            URL.revokeObjectURL(favicon_state.url);
            favicon_state = undefined;
        }

        if (new_message_count === 0 && pm_count === 0) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#favicon").attr("href", "/static/images/favicon.svg?v=4");
            return;
        }

        const pow = Math.floor(Math.log10(new_message_count) / 3);
        const suffix = ["", "K", "M", "G", "T"][pow];
        const count =
            new_message_count === 0
                ? ""
                : pow < 5
                ? `${Math.floor(new_message_count / 1e3 ** pow)}${suffix}`
                : "∞";
        const count_long = count.length > 2;
        const rendered_favicon = _templates_favicon_svg_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
            count,
            count_long,
            have_pm: pm_count !== 0,
            favicon_font_url: _favicon_font_url_url_loader_font_subset_loader2_glyphs_0123456789KMGT_source_sans_TTF_SourceSans3_Bold_ttf__WEBPACK_IMPORTED_MODULE_3__["default"],
        });

        load_and_set_favicon(rendered_favicon);
    } catch (error) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Failed to update favicon", undefined, error.stack);
    }
}


/***/ }),

/***/ "./static/js/feedback_widget.js":
/*!**************************************!*\
  !*** ./static/js/feedback_widget.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "dismiss": () => (/* binding */ dismiss),
/* harmony export */   "is_open": () => (/* binding */ is_open),
/* harmony export */   "show": () => (/* binding */ show)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_feedback_container_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/feedback_container.hbs */ "./static/templates/feedback_container.hbs");
/* harmony import */ var _templates_feedback_container_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_feedback_container_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






/*

This code lets you show something like this:

    +-----
    | TOPIC MUTES [undo] [x]
    |
    | You muted stream Foo, topic Bar.
    +-----

And then you configure the undo behavior, and
everything else is controlled by the widget.

Code-wise it's a singleton widget that controls the DOM inside
#feedback_container, which gets served up by server.

*/

const meta = {
    hide_me_time: null,
    alert_hover_state: false,
    $container: null,
    opened: false,
};

const animate = {
    maybe_close() {
        if (!meta.opened) {
            return;
        }

        if (meta.hide_me_time < Date.now() && !meta.alert_hover_state) {
            animate.fadeOut();
            return;
        }

        setTimeout(animate.maybe_close, 100);
    },
    fadeOut() {
        if (!meta.opened) {
            return;
        }

        if (meta.$container) {
            meta.$container.fadeOut(500).removeClass("show");
            meta.opened = false;
            meta.alert_hover_state = false;
        }
    },
    fadeIn() {
        if (meta.opened) {
            return;
        }

        if (meta.$container) {
            meta.$container.fadeIn(500).addClass("show");
            meta.opened = true;
            setTimeout(animate.maybe_close, 100);
        }
    },
};

function set_up_handlers() {
    if (meta.handlers_set) {
        return;
    }

    meta.handlers_set = true;

    // if the user mouses over the notification, don't hide it.
    meta.$container.on("mouseenter", () => {
        if (!meta.opened) {
            return;
        }

        meta.alert_hover_state = true;
    });

    // once the user's mouse leaves the notification, restart the countdown.
    meta.$container.on("mouseleave", () => {
        if (!meta.opened) {
            return;
        }

        meta.alert_hover_state = false;
        // add at least 2000ms but if more than that exists just keep the
        // current amount.
        meta.hide_me_time = Math.max(meta.hide_me_time, Date.now() + 2000);
    });

    meta.$container.on("click", ".exit-me", () => {
        animate.fadeOut();
    });

    meta.$container.on("click", ".feedback_undo", () => {
        if (meta.undo) {
            meta.undo();
        }
        animate.fadeOut();
    });
}

function is_open() {
    return meta.opened;
}

function dismiss() {
    animate.fadeOut();
}

function show(opts) {
    if (!opts.populate) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("programmer needs to supply populate callback.");
        return;
    }

    meta.$container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#feedback_container");

    const html = _templates_feedback_container_hbs__WEBPACK_IMPORTED_MODULE_1___default()();
    meta.$container.html(html);

    set_up_handlers();

    meta.undo = opts.on_undo;

    // add a four second delay before closing up.
    meta.hide_me_time = Date.now() + 4000;

    meta.$container.find(".feedback_title").text(opts.title_text);
    meta.$container.find(".feedback_undo").text(opts.undo_button_text);
    opts.populate(meta.$container.find(".feedback_content"));

    animate.fadeIn();
}


/***/ }),

/***/ "./static/js/fetch_status.js":
/*!***********************************!*\
  !*** ./static/js/fetch_status.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "FetchStatus": () => (/* binding */ FetchStatus)
/* harmony export */ });
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");


function max_id_for_messages(messages) {
    let max_id = 0;
    for (const msg of messages) {
        max_id = Math.max(max_id, msg.id);
    }
    return max_id;
}

class FetchStatus {
    // The FetchStatus object tracks the state of a
    // message_list_data object, whether rendered in the DOM or not,
    // and is the source of truth for whether the message_list_data
    // object has the complete history of the view or whether more
    // messages should be loaded when scrolling to the top or bottom
    // of the message feed.
    _loading_older = false;
    _loading_newer = false;
    _found_oldest = false;
    _found_newest = false;
    _history_limited = false;

    // Tracks the highest message ID that we know exist in this view,
    // but are not within the contiguous range of messages we have
    // received from the server.  Used to correctly handle a rare race
    // condition where a newly sent message races with fetching a
    // group of messages that would lead to found_newest being set
    // (described in detail below).
    _expected_max_message_id = 0;

    start_older_batch(opts) {
        this._loading_older = true;
        if (opts.update_loading_indicator) {
            _message_scroll__WEBPACK_IMPORTED_MODULE_0__.show_loading_older();
        }
    }

    finish_older_batch(opts) {
        this._loading_older = false;
        this._found_oldest = opts.found_oldest;
        this._history_limited = opts.history_limited;
        if (opts.update_loading_indicator) {
            _message_scroll__WEBPACK_IMPORTED_MODULE_0__.hide_loading_older();
        }
    }

    can_load_older_messages() {
        return !this._loading_older && !this._found_oldest;
    }

    has_found_oldest() {
        return this._found_oldest;
    }

    history_limited() {
        return this._history_limited;
    }

    start_newer_batch(opts) {
        this._loading_newer = true;
        if (opts.update_loading_indicator) {
            _message_scroll__WEBPACK_IMPORTED_MODULE_0__.show_loading_newer();
        }
    }

    finish_newer_batch(messages, opts) {
        // Returns true if and only if the caller needs to trigger an
        // additional fetch due to the race described below.
        const found_max_message_id = max_id_for_messages(messages);
        this._loading_newer = false;
        this._found_newest = opts.found_newest;
        if (opts.update_loading_indicator) {
            _message_scroll__WEBPACK_IMPORTED_MODULE_0__.hide_loading_newer();
        }
        if (this._found_newest && this._expected_max_message_id > found_max_message_id) {
            // This expected_max_message_id logic is designed to
            // resolve a subtle race condition involving newly sent
            // messages in a view that does not display the currently
            // latest messages.
            //
            // When a new message arrives matching the current view
            // and found_newest is false, we cannot add the message to
            // the view in-order without creating invalid output
            // (where two messages are display adjacent but might be
            // weeks and hundreds of messages apart in actuality).
            //
            // So we have to discard those messages.  Usually, this is
            // fine; the client will receive those when the user
            // scrolls to the bottom of the page, triggering another
            // fetch.  With that solution, a rare race is still possible,
            // with this sequence:
            //
            // 1. Client initiates GET /messages to fetch the last
            //    batch of messages in this view.  The server
            //    completes the database access and and starts sending
            //    the response with found_newest=true.
            // 1. A new message is sent matching the view, the event reaches
            //    the client.  We discard the message because found_newest=false.
            // 1. The client receives the GET /messages response, and
            //    marks found_newest=true.  As a result, it believes is has
            //    the latest messages and won't fetch more, but is missing the
            //    recently sent message.
            //
            // To address this problem, we track the highest message
            // ID among messages that were discarded due to
            // fetch_status in expected_max_message_id.  If that is
            // higher than the highest ID returned in a GET /messages
            // response with found_newest=true, we know the above race
            // has happened and trigger an additional fetch.
            this._found_newest = false;

            // Resetting our tracked last message id is an important
            // circuit-breaker for cases where the message(s) that we
            // "know" exist were deleted or moved to another topic.
            this._expected_max_message_id = 0;
            return true;
        }
        return false;
    }

    can_load_newer_messages() {
        return !this._loading_newer && !this._found_newest;
    }

    has_found_newest() {
        return this._found_newest;
    }

    update_expected_max_message_id(messages) {
        this._expected_max_message_id = Math.max(
            this._expected_max_message_id,
            max_id_for_messages(messages),
        );
    }
}


/***/ }),

/***/ "./static/js/filter.js":
/*!*****************************!*\
  !*** ./static/js/filter.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Filter": () => (/* binding */ Filter)
/* harmony export */ });
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! handlebars/runtime */ "./node_modules/handlebars/dist/cjs/handlebars.runtime.js");
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_parser'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());















function zephyr_stream_name_match(message, operand) {
    // Zephyr users expect narrowing to "social" to also show messages to /^(un)*social(.d)*$/
    // (unsocial, ununsocial, social.d, etc)
    // TODO: hoist the regex compiling out of the closure
    const m = /^(?:un)*(.+?)(?:\.d)*$/i.exec(operand);
    let base_stream_name = operand;
    if (m !== null && m[1] !== undefined) {
        base_stream_name = m[1];
    }
    const related_regexp = new RegExp(
        /^(un)*/.source + lodash__WEBPACK_IMPORTED_MODULE_1___default().escapeRegExp(base_stream_name) + /(\.d)*$/.source,
        "i",
    );
    return related_regexp.test(message.stream);
}

function zephyr_topic_name_match(message, operand) {
    // Zephyr users expect narrowing to topic "foo" to also show messages to /^foo(.d)*$/
    // (foo, foo.d, foo.d.d, etc)
    // TODO: hoist the regex compiling out of the closure
    const m = /^(.*?)(?:\.d)*$/i.exec(operand);
    const base_topic = m[1];
    let related_regexp;

    // Additionally, Zephyr users expect the empty instance and
    // instance "personal" to be the same.
    if (
        base_topic === "" ||
        base_topic.toLowerCase() === "personal" ||
        base_topic.toLowerCase() === '(instance "")'
    ) {
        related_regexp = /^(|personal|\(instance ""\))(\.d)*$/i;
    } else {
        related_regexp = new RegExp(
            /^/.source + lodash__WEBPACK_IMPORTED_MODULE_1___default().escapeRegExp(base_topic) + /(\.d)*$/.source,
            "i",
        );
    }

    return related_regexp.test(message.topic);
}

function message_in_home(message) {
    if (
        message.type === "private" ||
        message.mentioned ||
        (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined &&
            message.stream.toLowerCase() === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())())
    ) {
        return true;
    }

    // We don't display muted streams in 'All messages' view
    return !_stream_data__WEBPACK_IMPORTED_MODULE_7__.is_muted(message.stream_id);
}

function message_matches_search_term(message, operator, operand) {
    switch (operator) {
        case "has":
            switch (operand) {
                case "image":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_parser'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message);
                case "link":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_parser'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message);
                case "attachment":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_parser'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message);
                default:
                    return false; // has:something_else returns false
            }

        case "is":
            switch (operand) {
                case "private":
                    return message.type === "private";
                case "starred":
                    return message.starred;
                case "mentioned":
                    return message.mentioned;
                case "alerted":
                    return message.alerted;
                case "unread":
                    return _unread__WEBPACK_IMPORTED_MODULE_8__.message_unread(message);
                case "resolved":
                    return message.type === "stream" && _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(message.topic);
                default:
                    return false; // is:whatever returns false
            }

        case "in":
            switch (operand) {
                case "home":
                    return message_in_home(message);
                case "all":
                    return true;
                default:
                    return false; // in:whatever returns false
            }

        case "near":
            // this is all handled server side
            return true;

        case "id":
            return message.id.toString() === operand;

        case "stream": {
            if (message.type !== "stream") {
                return false;
            }

            operand = operand.toLowerCase();
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                return zephyr_stream_name_match(message, operand);
            }

            // Try to match by stream_id if have a valid sub for
            // the operand.
            const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_7__.get_stream_id(operand);
            if (stream_id) {
                return message.stream_id === stream_id;
            }

            // We need this fallback logic in case we have a message
            // loaded for a stream that we are no longer
            // subscribed to (or that was deleted).
            return message.stream.toLowerCase() === operand;
        }

        case "topic":
            if (message.type !== "stream") {
                return false;
            }

            operand = operand.toLowerCase();
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                return zephyr_topic_name_match(message, operand);
            }
            return message.topic.toLowerCase() === operand;

        case "sender":
            return _people__WEBPACK_IMPORTED_MODULE_6__.id_matches_email_operand(message.sender_id, operand);

        case "group-pm-with": {
            const operand_ids = _people__WEBPACK_IMPORTED_MODULE_6__.pm_with_operand_ids(operand);
            if (!operand_ids) {
                return false;
            }
            const user_ids = _people__WEBPACK_IMPORTED_MODULE_6__.group_pm_with_user_ids(message);
            if (!user_ids) {
                return false;
            }
            return user_ids.includes(operand_ids[0]);
            // We should also check if the current user is in the recipient list (user_ids) of the
            // message, but it is implicit by the fact that the current user has access to the message.
        }

        case "pm-with": {
            // TODO: use user_ids, not emails here
            if (message.type !== "private") {
                return false;
            }
            const operand_ids = _people__WEBPACK_IMPORTED_MODULE_6__.pm_with_operand_ids(operand);
            if (!operand_ids) {
                return false;
            }
            const user_ids = _people__WEBPACK_IMPORTED_MODULE_6__.pm_with_user_ids(message);
            if (!user_ids) {
                return false;
            }

            return lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(operand_ids, user_ids);
        }
    }

    return true; // unknown operators return true (effectively ignored)
}

class Filter {
    constructor(operators) {
        if (operators === undefined) {
            this._operators = [];
            this._sub = undefined;
        } else {
            this._operators = this.fix_operators(operators);
            if (this.has_operator("stream")) {
                this._sub = _stream_data__WEBPACK_IMPORTED_MODULE_7__.get_sub_by_name(this.operands("stream")[0]);
            }
        }
    }

    static canonicalize_operator(operator) {
        operator = operator.toLowerCase();

        if (operator === "from") {
            return "sender";
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(operator)) {
            return "topic";
        }
        return operator;
    }

    static canonicalize_term({negated = false, operator, operand}) {
        // Make negated explicitly default to false for both clarity and
        // simplifying deepEqual checks in the tests.
        operator = Filter.canonicalize_operator(operator);

        switch (operator) {
            case "has":
                // images -> image, etc.
                operand = operand.replace(/s$/, "");
                break;

            case "stream":
                operand = _stream_data__WEBPACK_IMPORTED_MODULE_7__.get_name(operand);
                break;
            case "topic":
                break;
            case "sender":
            case "pm-with":
                operand = operand.toString().toLowerCase();
                if (operand === "me") {
                    operand = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_email();
                }
                break;
            case "group-pm-with":
                operand = operand.toString().toLowerCase();
                break;
            case "search":
                // The mac app automatically substitutes regular quotes with curly
                // quotes when typing in the search bar.  Curly quotes don't trigger our
                // phrase search behavior, however.  So, we replace all instances of
                // curly quotes with regular quotes when doing a search.  This is
                // unlikely to cause any problems and is probably what the user wants.
                operand = operand
                    .toString()
                    .toLowerCase()
                    .replace(/[\u201C\u201D]/g, '"');
                break;
            default:
                operand = operand.toString().toLowerCase();
        }

        // We may want to consider allowing mixed-case operators at some point
        return {
            negated,
            operator,
            operand,
        };
    }

    /* We use a variant of URI encoding which looks reasonably
       nice and still handles unambiguously cases such as
       spaces in operands.

       This is just for the search bar, not for saving the
       narrow in the URL fragment.  There we do use full
       URI encoding to avoid problematic characters. */
    static encodeOperand(operand) {
        return operand
            .replace(/%/g, "%25")
            .replace(/\+/g, "%2B")
            .replace(/ /g, "+")
            .replace(/"/g, "%22");
    }

    static decodeOperand(encoded, operator) {
        encoded = encoded.replace(/"/g, "");
        if (["group-pm-with", "pm-with", "sender", "from"].includes(operator) === false) {
            encoded = encoded.replace(/\+/g, " ");
        }
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(encoded).trim();
    }

    // Parse a string into a list of operators (see below).
    static parse(str) {
        const operators = [];
        let search_term = [];
        let negated;
        let operator;
        let operand;
        let term;

        function maybe_add_search_terms() {
            if (search_term.length > 0) {
                operator = "search";
                const _operand = search_term.join(" ");
                term = {operator, operand: _operand, negated: false};
                operators.push(term);
                search_term = [];
            }
        }

        // Match all operands that either have no spaces, or are surrounded by
        // quotes, preceded by an optional operator that may have a space after it.
        const matches = str.match(/([^\s:]+: ?)?("[^"]+"?|\S+)/g);
        if (matches === null) {
            return operators;
        }

        for (const token of matches) {
            let operator;
            const parts = token.split(":");
            if (token[0] === '"' || parts.length === 1) {
                // Looks like a normal search term.
                search_term.push(token);
            } else {
                // Looks like an operator.
                negated = false;
                operator = parts.shift();
                if (operator[0] === "-") {
                    negated = true;
                    operator = operator.slice(1);
                }
                operand = Filter.decodeOperand(parts.join(":"), operator);

                // We use Filter.operator_to_prefix() checks if the
                // operator is known.  If it is not known, then we treat
                // it as a search for the given string (which may contain
                // a `:`), not as a search operator.
                if (Filter.operator_to_prefix(operator, negated) === "") {
                    // Put it as a search term, to not have duplicate operators
                    search_term.push(token);
                    continue;
                }
                // If any search query was present and it is followed by some other filters
                // then we must add that search filter in its current position in the
                // operators list. This is done so that the last active filter is correctly
                // detected by the `get_search_result` function (in search_suggestions.js).
                maybe_add_search_terms();
                term = {negated, operator, operand};
                operators.push(term);
            }
        }

        maybe_add_search_terms();
        return operators;
    }

    /* Convert a list of operators to a string.
   Each operator is a key-value pair like

       ['topic', 'my amazing topic']

   These are not keys in a JavaScript object, because we
   might need to support multiple operators of the same type.
*/
    static unparse(operators) {
        const parts = operators.map((elem) => {
            if (elem.operator === "search") {
                // Search terms are the catch-all case.
                // All tokens that don't start with a known operator and
                // a colon are glued together to form a search term.
                return elem.operand;
            }
            const sign = elem.negated ? "-" : "";
            if (elem.operator === "") {
                return elem.operand;
            }
            return sign + elem.operator + ":" + Filter.encodeOperand(elem.operand.toString());
        });
        return parts.join(" ");
    }

    predicate() {
        if (this._predicate === undefined) {
            this._predicate = this._build_predicate();
        }
        return this._predicate;
    }

    operators() {
        return this._operators;
    }

    public_operators() {
        const safe_to_return = this._operators.filter(
            // Filter out the embedded narrow (if any).
            (value) =>
                !(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined &&
                    value.operator === "stream" &&
                    value.operand.toLowerCase() === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()
                ),
        );
        return safe_to_return;
    }

    operands(operator) {
        return this._operators
            .filter((elem) => !elem.negated && elem.operator === operator)
            .map((elem) => elem.operand);
    }

    has_negated_operand(operator, operand) {
        return this._operators.some(
            (elem) => elem.negated && elem.operator === operator && elem.operand === operand,
        );
    }

    has_operand(operator, operand) {
        return this._operators.some(
            (elem) => !elem.negated && elem.operator === operator && elem.operand === operand,
        );
    }

    has_operator(operator) {
        return this._operators.some((elem) => {
            if (elem.negated && !["search", "has"].includes(elem.operator)) {
                return false;
            }
            return elem.operator === operator;
        });
    }

    is_search() {
        return this.has_operator("search");
    }

    is_non_huddle_pm() {
        return this.has_operator("pm-with") && this.operands("pm-with")[0].split(",").length === 1;
    }

    supports_collapsing_recipients() {
        // Determines whether a view is guaranteed, by construction,
        // to contain consecutive messages in a given topic, and thus
        // it is appropriate to collapse recipient/sender headings.
        const term_types = this.sorted_term_types();

        // All search/narrow term types, including negations, with the
        // property that if a message is in the view, then any other
        // message sharing its recipient (stream/topic or private
        // message recipient) must also be present in the view.
        const valid_term_types = new Set([
            "stream",
            "not-stream",
            "topic",
            "not-topic",
            "pm-with",
            "group-pm-with",
            "not-group-pm-with",
            "is-private",
            "not-is-private",
            "is-resolved",
            "not-is-resolved",
            "in-home",
            "in-all",
            "streams-public",
            "not-streams-public",
            "streams-web-public",
            "not-streams-web-public",
            "near",
        ]);

        for (const term of term_types) {
            if (!valid_term_types.has(term)) {
                return false;
            }
        }
        return true;
    }

    calc_can_mark_messages_read() {
        // Arguably this should match supports_collapsing_recipients.
        // We may want to standardize on that in the future.  (At
        // present, this function does not allow combining valid filters).
        const term_types = this.sorted_term_types();

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream", "topic"])) {
            return true;
        }

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["pm-with"])) {
            return true;
        }

        // TODO: Some users really hate it when Zulip marks messages as read
        // in interleaved views, so we will eventually have a setting
        // that early-exits before the subsequent checks.
        // (in which case, is_common_narrow would also need to be modified)

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream"])) {
            return true;
        }

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["is-private"])) {
            return true;
        }

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["is-mentioned"])) {
            return true;
        }

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["is-resolved"])) {
            return true;
        }

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, [])) {
            // All view
            return true;
        }

        if (term_types.length === 1 && ["in-home", "in-all"].includes(term_types[0])) {
            return true;
        }

        return false;
    }

    can_mark_messages_read() {
        if (this._can_mark_messages_read === undefined) {
            this._can_mark_messages_read = this.calc_can_mark_messages_read();
        }
        return this._can_mark_messages_read;
    }

    // This is used to control the behaviour for "exiting search",
    // given the ability to flip between displaying the search bar and the narrow description in UI
    // here we define a narrow as a "common narrow" on the basis of
    // https://paper.dropbox.com/doc/Navbar-behavior-table--AvnMKN4ogj3k2YF5jTbOiVv_AQ-cNOGtu7kSdtnKBizKXJge
    // common narrows show a narrow description and allow the user to
    // close search bar UI and show the narrow description UI.
    //
    // TODO: We likely will want to rewrite this to not piggy-back on
    // can_mark_messages_read, since that might gain some more complex behavior
    // with near: narrows.
    is_common_narrow() {
        // can_mark_messages_read tests the following filters:
        // stream, stream + topic,
        // is: private, pm-with:,
        // is: mentioned, is: resolved
        if (this.can_mark_messages_read()) {
            return true;
        }
        // that leaves us with checking:
        // is: starred
        // (which can_mark_messages_read_does not check as starred messages are always read)
        const term_types = this.sorted_term_types();

        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["is-starred"])) {
            return true;
        }
        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["streams-public"])) {
            return true;
        }
        return false;
    }

    // This is used to control the behaviour for "exiting search"
    // within a narrow (E.g. a stream/topic + search) to bring you to
    // the containing common narrow (stream/topic, in the example)
    // rather than "All messages".
    //
    // Note from tabbott: The slug-based approach may not be ideal; we
    // may be able to do better another way.
    generate_redirect_url() {
        const term_types = this.sorted_term_types();

        // this comes first because it has 3 term_types but is not a "complex filter"
        if (lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream", "topic", "search"])) {
            // if stream does not exist, redirect to All
            if (!this._sub) {
                return "#";
            }
            return (
                "/#narrow/stream/" +
                _stream_data__WEBPACK_IMPORTED_MODULE_7__.name_to_slug(this.operands("stream")[0]) +
                "/topic/" +
                this.operands("topic")[0]
            );
        }

        // eliminate "complex filters"
        if (term_types.length >= 3) {
            return "#"; // redirect to All
        }

        if (term_types[1] === "search") {
            switch (term_types[0]) {
                case "stream":
                    // if stream does not exist, redirect to All
                    if (!this._sub) {
                        return "#";
                    }
                    return (
                        "/#narrow/stream/" + _stream_data__WEBPACK_IMPORTED_MODULE_7__.name_to_slug(this.operands("stream")[0])
                    );
                case "is-private":
                    return "/#narrow/is/private";
                case "is-starred":
                    return "/#narrow/is/starred";
                case "is-mentioned":
                    return "/#narrow/is/mentioned";
                case "streams-public":
                    return "/#narrow/streams/public";
                case "pm-with":
                    return (
                        "/#narrow/pm-with/" +
                        _people__WEBPACK_IMPORTED_MODULE_6__.emails_to_slug(this.operands("pm-with").join(","))
                    );
                case "is-resolved":
                    return "/#narrow/topics/is/resolved";
                // TODO: It is ambiguous how we want to handle the 'sender' case,
                // we may remove it in the future based on design decisions
                case "sender":
                    return "/#narrow/sender/" + _people__WEBPACK_IMPORTED_MODULE_6__.emails_to_slug(this.operands("sender")[0]);
            }
        }

        return "#"; // redirect to All
    }

    get_icon() {
        // We have special icons for the simple narrows available for the via sidebars.
        const term_types = this.sorted_term_types();
        switch (term_types[0]) {
            case "in-home":
            case "in-all":
                return "home";
            case "stream":
                if (!this._sub) {
                    return "question-circle-o";
                }
                if (this._sub.invite_only) {
                    return "lock";
                }
                if (this._sub.is_web_public) {
                    return "globe";
                }
                return "hashtag";
            case "is-private":
                return "envelope";
            case "is-starred":
                return "star";
            case "is-mentioned":
                return "at";
            case "pm-with":
                return "envelope";
            case "is-resolved":
                return "check";
            default:
                return undefined;
        }
    }

    get_title() {
        // Nice explanatory titles for common views.
        const term_types = this.sorted_term_types();
        if (
            (term_types.length === 3 && lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream", "topic", "near"])) ||
            (term_types.length === 2 && lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream", "topic"])) ||
            (term_types.length === 1 && lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["stream"]))
        ) {
            if (!this._sub) {
                const search_text = this.operands("stream")[0];
                return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unknown stream #{search_text}"}, {search_text});
            }
            return this._sub.name;
        }
        if (
            (term_types.length === 2 && lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["pm-with", "near"])) ||
            (term_types.length === 1 && lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, ["pm-with"]))
        ) {
            const emails = this.operands("pm-with")[0].split(",");
            const names = emails.map((email) => {
                if (!_people__WEBPACK_IMPORTED_MODULE_6__.get_by_email(email)) {
                    return email;
                }
                return _people__WEBPACK_IMPORTED_MODULE_6__.get_by_email(email).full_name;
            });

            // We use join to handle the addition of a comma and space after every name
            // and also to ensure that we return a string and not an array so that we
            // can have the same return type as other cases.
            return names.join(", ");
        }
        if (term_types.length === 1) {
            switch (term_types[0]) {
                case "in-home":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "All messages"});
                case "in-all":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "All messages including muted streams"});
                case "streams-public":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Messages in all public streams"});
                case "is-starred":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Starred messages"});
                case "is-mentioned":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Mentions"});
                case "is-private":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Private messages"});
                case "is-resolved":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Topics marked as resolved"});
                // These cases return false for is_common_narrow, and therefore are not
                // formatted in the message view header. They are used in narrow.js to
                // update the browser title.
                case "is-alerted":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Alerted messages"});
                case "is-unread":
                    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unread messages"});
            }
        }
        /* istanbul ignore next */
        return undefined;
    }

    allow_use_first_unread_when_narrowing() {
        return this.can_mark_messages_read() || this.has_operator("is");
    }

    contains_only_private_messages() {
        return (
            (this.has_operator("is") && this.operands("is")[0] === "private") ||
            this.has_operator("pm-with") ||
            this.has_operator("group-pm-with")
        );
    }

    includes_full_stream_history() {
        return this.has_operator("stream") || this.has_operator("streams");
    }

    is_personal_filter() {
        // Whether the filter filters for user-specific data in the
        // UserMessage table, such as stars or mentions.
        //
        // Such filters should not advertise "streams:public" as it
        // will never add additional results.
        return this.has_operand("is", "mentioned") || this.has_operand("is", "starred");
    }

    can_apply_locally(is_local_echo) {
        // Since there can be multiple operators, each block should
        // just return false here.

        if (this.is_search()) {
            // The semantics for matching keywords are implemented
            // by database plugins, and we don't have JS code for
            // that, plus search queries tend to go too far back in
            // history.
            return false;
        }

        if (this.has_operator("has") && is_local_echo) {
            // The has: operators can be applied locally for messages
            // rendered by the backend; links, attachments, and images
            // are not handled properly by the local echo Markdown
            // processor.
            return false;
        }

        // TODO: It's not clear why `streams:` filters would not be
        // applicable locally.
        if (this.has_operator("streams") || this.has_negated_operand("streams", "public")) {
            return false;
        }

        // If we get this far, we're good!
        return true;
    }

    fix_operators(operators) {
        operators = this._canonicalize_operators(operators);
        operators = this._fix_redundant_is_private(operators);
        return operators;
    }

    _fix_redundant_is_private(terms) {
        if (!terms.some((term) => Filter.term_type(term) === "pm-with")) {
            return terms;
        }

        return terms.filter((term) => Filter.term_type(term) !== "is-private");
    }

    _canonicalize_operators(operators_mixed_case) {
        return operators_mixed_case.map((tuple) => Filter.canonicalize_term(tuple));
    }

    filter_with_new_params(params) {
        const terms = this._operators.map((term) => {
            const new_term = {...term};
            if (new_term.operator === params.operator && !new_term.negated) {
                new_term.operand = params.operand;
            }
            return new_term;
        });
        return new Filter(terms);
    }

    has_topic(stream_name, topic) {
        return this.has_operand("stream", stream_name) && this.has_operand("topic", topic);
    }

    sorted_term_types() {
        if (this._sorted_term_types === undefined) {
            this._sorted_term_types = this._build_sorted_term_types();
        }
        return this._sorted_term_types;
    }

    _build_sorted_term_types() {
        const terms = this._operators;
        const term_types = terms.map((term) => Filter.term_type(term));
        const sorted_terms = Filter.sorted_term_types(term_types);
        return sorted_terms;
    }

    can_bucket_by(...wanted_term_types) {
        // Examples call:
        //     filter.can_bucket_by('stream', 'topic')
        //
        // The use case of this function is that we want
        // to know if a filter can start with a bucketing
        // data structure similar to the ones we have in
        // unread.js to pre-filter ids, rather than apply
        // a predicate to a larger list of candidate ids.
        //
        // (It's for optimization, basically.)
        const all_term_types = this.sorted_term_types();
        const term_types = all_term_types.slice(0, wanted_term_types.length);

        return lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(term_types, wanted_term_types);
    }

    first_valid_id_from(msg_ids) {
        const predicate = this.predicate();

        const first_id = msg_ids.find((msg_id) => {
            const message = _message_store__WEBPACK_IMPORTED_MODULE_5__.get(msg_id);

            if (message === undefined) {
                return false;
            }

            return predicate(message);
        });

        return first_id;
    }

    update_email(user_id, new_email) {
        for (const term of this._operators) {
            switch (term.operator) {
                case "group-pm-with":
                case "pm-with":
                case "sender":
                case "from":
                    term.operand = _people__WEBPACK_IMPORTED_MODULE_6__.update_email_in_reply_to(
                        term.operand,
                        user_id,
                        new_email,
                    );
            }
        }
    }

    // Build a filter function from a list of operators.
    _build_predicate() {
        const operators = this._operators;

        if (!this.can_apply_locally()) {
            return () => true;
        }

        // FIXME: This is probably pretty slow.
        // We could turn it into something more like a compiler:
        // build JavaScript code in a string and then eval() it.

        return (message) =>
            operators.every((term) => {
                let ok = message_matches_search_term(message, term.operator, term.operand);
                if (term.negated) {
                    ok = !ok;
                }
                return ok;
            });
    }

    static term_type(term) {
        const operator = term.operator;
        const operand = term.operand;
        const negated = term.negated;

        let result = negated ? "not-" : "";

        result += operator;

        if (["is", "has", "in", "streams"].includes(operator)) {
            result += "-" + operand;
        }

        return result;
    }

    static sorted_term_types(term_types) {
        const levels = [
            "in",
            "streams-public",
            "stream",
            "topic",
            "pm-with",
            "group-pm-with",
            "sender",
            "near",
            "id",
            "is-alerted",
            "is-mentioned",
            "is-private",
            "is-starred",
            "is-unread",
            "is-resolved",
            "has-link",
            "has-image",
            "has-attachment",
            "search",
        ];

        const level = (term_type) => {
            let i = levels.indexOf(term_type);
            if (i === -1) {
                i = 999;
            }
            return i;
        };

        const compare = (a, b) => {
            const diff = level(a) - level(b);
            if (diff !== 0) {
                return diff;
            }
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a, b);
        };

        return term_types.slice().sort(compare);
    }

    static operator_to_prefix(operator, negated) {
        operator = Filter.canonicalize_operator(operator);

        if (operator === "search") {
            return negated ? "exclude" : "search for";
        }

        const verb = negated ? "exclude " : "";

        switch (operator) {
            case "stream":
                return verb + "stream";
            case "streams":
                return verb + "streams";
            case "near":
                return verb + "messages around";

            // Note: We hack around using this in "describe" below.
            case "has":
                return verb + "messages with one or more";

            case "id":
                return verb + "message ID";

            case "topic":
                return verb + "topic";

            case "sender":
                return verb + "sent by";

            case "pm-with":
                return verb + "private messages with";

            case "in":
                return verb + "messages in";

            // Note: We hack around using this in "describe" below.
            case "is":
                return verb + "messages that are";

            case "group-pm-with":
                return verb + "group private messages including";
        }
        return "";
    }

    static describe_is_operator(operator) {
        const verb = operator.negated ? "exclude " : "";
        const operand = operator.operand;
        const operand_list = ["private", "starred", "alerted", "unread"];
        if (operand_list.includes(operand)) {
            return verb + operand + " messages";
        } else if (operand === "mentioned") {
            return verb + "@-mentions";
        }
        return "invalid " + operand + " operand for is operator";
    }

    // Convert a list of operators to a human-readable description.
    static describe_unescaped(operators) {
        if (operators.length === 0) {
            return "all messages";
        }

        let parts = [];

        if (operators.length >= 2) {
            const is = (term, expected) => term.operator === expected && !term.negated;

            if (is(operators[0], "stream") && is(operators[1], "topic")) {
                const stream = operators[0].operand;
                const topic = operators[1].operand;
                const part = "stream " + stream + " > " + topic;
                parts = [part];
                operators = operators.slice(2);
            }
        }

        const more_parts = operators.map((elem) => {
            const operand = elem.operand;
            const canonicalized_operator = Filter.canonicalize_operator(elem.operator);
            if (canonicalized_operator === "is") {
                return Filter.describe_is_operator(elem);
            }
            if (canonicalized_operator === "has") {
                // search_suggestion.get_suggestions takes care that this message will
                // only be shown if the `has` operator is not at the last.
                const valid_has_operands = [
                    "image",
                    "images",
                    "link",
                    "links",
                    "attachment",
                    "attachments",
                ];
                if (!valid_has_operands.includes(operand)) {
                    return "invalid " + operand + " operand for has operator";
                }
            }
            const prefix_for_operator = Filter.operator_to_prefix(
                canonicalized_operator,
                elem.negated,
            );
            if (prefix_for_operator !== "") {
                return prefix_for_operator + " " + operand;
            }
            return "unknown operator";
        });
        return parts.concat(more_parts).join(", ");
    }

    static describe(operators) {
        return handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().Utils.escapeExpression(Filter.describe_unescaped(operators));
    }

    static is_spectator_compatible(ops) {
        for (const op of ops) {
            if (op.operand === undefined) {
                return false;
            }
            if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.allowed_web_public_narrows.includes(op.operator)) {
                return false;
            }
        }
        return true;
    }
}


/***/ }),

/***/ "./static/js/flatpickr.js":
/*!********************************!*\
  !*** ./static/js/flatpickr.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "show_flatpickr": () => (/* binding */ show_flatpickr)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/formatISO/index.js");
/* harmony import */ var flatpickr_dist_plugins_confirmDate_confirmDate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! flatpickr/dist/plugins/confirmDate/confirmDate */ "./node_modules/flatpickr/dist/plugins/confirmDate/confirmDate.js");
/* harmony import */ var flatpickr_dist_plugins_confirmDate_confirmDate__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(flatpickr_dist_plugins_confirmDate_confirmDate__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _hotkey__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hotkey */ "./static/js/hotkey.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());








function is_numeric_key(key) {
    return ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"].includes(key);
}

function show_flatpickr(element, callback, default_timestamp, options = {}) {
    const $flatpickr_input = jquery__WEBPACK_IMPORTED_MODULE_1___default()("<input>").attr("id", "#timestamp_flatpickr");

    const instance = $flatpickr_input.flatpickr({
        mode: "single",
        enableTime: true,
        clickOpens: false,
        defaultDate: default_timestamp,
        plugins: [
            new (flatpickr_dist_plugins_confirmDate_confirmDate__WEBPACK_IMPORTED_MODULE_0___default())({
                showAlways: true,
                confirmText: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Confirm"}),
                confirmIcon: "",
            }),
        ],
        positionElement: element,
        dateFormat: "Z",
        formatDate: (date) => (0,date_fns__WEBPACK_IMPORTED_MODULE_4__["default"])(date),
        disableMobile: true,
        time_24hr: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        onKeyDown(selectedDates, dateStr, instance, event) {
            if (is_numeric_key(event.key)) {
                // Don't attempt to get_keydown_hotkey for numeric inputs
                // as it would return undefined.
                return;
            }

            const hotkey = (0,_hotkey__WEBPACK_IMPORTED_MODULE_2__.get_keydown_hotkey)(event);

            if (["tab", "shift_tab"].includes(hotkey.name)) {
                const elems = [
                    instance.selectedDateElem,
                    instance.hourElement,
                    instance.minuteElement,
                    instance.amPM,
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".flatpickr-confirm")[0],
                ];
                const i = elems.indexOf(event.target);
                const n = elems.length;
                const remain = (i + (event.shiftKey ? -1 : 1)) % n;
                const target = elems[Math.floor(remain >= 0 ? remain : remain + n)];
                event.preventDefault();
                event.stopPropagation();
                target.focus();
            }

            event.stopPropagation();
        },
        ...options,
    });

    const $container = jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.innerContainer).parent();

    $container.on("keydown", (e) => {
        if (is_numeric_key(e.key)) {
            // Let users type numeric values
            return true;
        }

        const hotkey = (0,_hotkey__WEBPACK_IMPORTED_MODULE_2__.get_keydown_hotkey)(e);

        if (!hotkey) {
            return false;
        }

        if (hotkey.name === "backspace" || hotkey.name === "delete") {
            // Let backspace or delete be handled normally
            return true;
        }

        if (hotkey.name === "enter") {
            if (e.target.classList[0] === "flatpickr-day") {
                return true; // use flatpickr default implementation
            }
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).toggleClass("has_popover");
            $container.find(".flatpickr-confirm").trigger("click");
        }

        if (hotkey.name === "escape") {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).toggleClass("has_popover");
            instance.close();
            instance.destroy();
        }

        if (["tab", "shift_tab"].includes(hotkey.name)) {
            return true; // use flatpickr default implementation
        }

        if (["right_arrow", "up_arrow", "left_arrow", "down_arrow"].includes(hotkey.name)) {
            return true; // use flatpickr default implementation
        }

        e.stopPropagation();
        e.preventDefault();

        return true;
    });

    $container.on("click", ".flatpickr-confirm", () => {
        callback($flatpickr_input.val());
        instance.close();
        instance.destroy();
    });
    instance.open();
    instance.selectedDateElem.focus();

    return instance;
}


/***/ }),

/***/ "./static/js/floating_recipient_bar.js":
/*!*********************************************!*\
  !*** ./static/js/floating_recipient_bar.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "candidate_recipient_bar": () => (/* binding */ candidate_recipient_bar),
/* harmony export */   "de_clutter_dates": () => (/* binding */ de_clutter_dates),
/* harmony export */   "first_visible_message": () => (/* binding */ first_visible_message),
/* harmony export */   "get_date": () => (/* binding */ get_date),
/* harmony export */   "hide": () => (/* binding */ hide),
/* harmony export */   "relevant_recipient_bars": () => (/* binding */ relevant_recipient_bars),
/* harmony export */   "update": () => (/* binding */ update)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());








let is_floating_recipient_bar_showing = false;

function top_offset($elem) {
    return (
        $elem.offset().top -
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header").safeOuterHeight() -
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar_alerts_wrapper").height()
    );
}

function first_visible_message($bar) {
    // The first truly visible message would be computed using the
    // bottom of the floating recipient bar; but we want the date from
    // the first visible message were the floating recipient bar not
    // displayed, which will always be the first messages whose bottom
    // overlaps the floating recipient bar's space (since you ).

    const $messages = $bar.children(".message_row");
    const $frb = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar");
    const frb_top = top_offset($frb);
    const frb_bottom = frb_top + $frb.safeOuterHeight();
    let $result;

    for (const message_element of $messages) {
        // The details of this comparison function are sensitive, since we're
        // balancing between three possible bugs:
        //
        // * If we compare against the bottom of the floating
        //   recipient bar, we end up with a bug where if the floating
        //   recipient bar is just above a normal recipient bar while
        //   overlapping a series of 1-line messages, there might be 2
        //   messages occluded by the recipient bar, and we want the
        //   second one, not the first.
        //
        // * If we compare the message bottom against the top of the
        //   floating recipient bar, and the floating recipient bar is
        //   over a "Yesterday/Today" message date row, we might
        //   confusingly have the floating recipient bar display
        //   e.g. "Yesterday" even though all messages in view were
        //   actually sent "Today".
        //
        // * If the the floating recipient bar is over a
        //   between-message groups date separator or similar widget,
        //   there might be no message overlap with the floating
        //   recipient bar.
        //
        // Careful testing of these two corner cases with
        // message_viewport.scrollTop() to set precise scrolling
        // positions determines the value for date_bar_height_offset.

        let $message = jquery__WEBPACK_IMPORTED_MODULE_0___default()(message_element);
        const message_bottom = top_offset($message) + $message.safeOuterHeight();
        const date_bar_height_offset = 10;

        if (message_bottom > frb_top) {
            $result = $message;
        }

        // Important: This will break if we ever have things that are
        // not message rows inside a recipient_row block.
        $message = $message.next(".message_row");
        if (
            $message.length > 0 &&
            $result &&
            // Before returning a result, we check whether the next
            // message's top is actually below the bottom of the
            // floating recipient bar; this is different from the
            // bottom of our current message because there may be a
            // between-messages date separator row in between.
            top_offset($message) < frb_bottom - date_bar_height_offset
        ) {
            $result = $message;
        }
        if ($result) {
            return $result;
        }
    }

    // If none of the messages are visible, just take the last message.
    return $messages.last();
}

function get_date($elem) {
    const message_row = first_visible_message($elem);

    if (!message_row || !message_row.length) {
        return undefined;
    }

    const msg_id = _rows__WEBPACK_IMPORTED_MODULE_4__.id(message_row);

    if (msg_id === undefined) {
        return undefined;
    }

    const message = _message_store__WEBPACK_IMPORTED_MODULE_3__.get(msg_id);

    if (!message) {
        return undefined;
    }

    const time = new Date(message.timestamp * 1000);
    const today = new Date();
    const rendered_date = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time, undefined, today)[0].outerHTML;

    return rendered_date;
}

function relevant_recipient_bars() {
    let elems = [];

    // This line of code does a reverse traversal
    // from the selected message, which should be
    // in the visible part of the feed, but is sometimes
    // not exactly where we want.  The value we get
    // may be be too far up in the feed, but we can
    // deal with that later.
    let $first_elem = candidate_recipient_bar();

    if (!$first_elem) {
        $first_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table").find(".recipient_row").first();
    }

    if ($first_elem.length === 0) {
        return [];
    }

    elems.push($first_elem);

    const max_offset = top_offset(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose"));
    let header_height = $first_elem.find(".message_header").safeOuterHeight();

    // It's okay to overestimate header_height a bit, as we don't
    // really need an FRB for a section that barely shows.
    header_height += 10;

    function next($elem) {
        $elem = $elem.next();
        while ($elem.length !== 0 && !$elem.hasClass("recipient_row")) {
            $elem = $elem.next();
        }
        return $elem;
    }

    // Now start the forward traversal of recipient bars.
    // We'll stop when we go below the fold.
    let $elem = next($first_elem);

    while ($elem.length) {
        if (top_offset($elem) < header_height) {
            // If we are close to the top, then the prior
            // elements we found are no longer relevant,
            // because either the selected item we started
            // with in our reverse traversal was too high,
            // or there's simply not enough room to draw
            // a recipient bar without it being ugly.
            elems = [];
        }

        if (top_offset($elem) > max_offset) {
            // Out of sight, out of mind!
            // (The element is below the fold, so we stop the
            // traversal.)
            break;
        }

        elems.push($elem);
        $elem = next($elem);
    }

    if (elems.length === 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected situation--maybe viewport height is very short.");
        return [];
    }

    const items = elems.map(($elem, i) => {
        let date_html;
        let need_frb;

        if (i === 0) {
            date_html = get_date($elem);
            need_frb = top_offset($elem) < 0;
        } else {
            date_html = $elem.find(".recipient_row_date").html();
            need_frb = false;
        }

        const date_text = jquery__WEBPACK_IMPORTED_MODULE_0___default()(date_html).text();

        // Add title here to facilitate troubleshooting.
        const title = $elem.find(".message_label_clickable").last().attr("title");

        const item = {
            $elem,
            title,
            date_html,
            date_text,
            need_frb,
        };

        return item;
    });

    items[0].show_date = true;

    for (let i = 1; i < items.length; i += 1) {
        items[i].show_date = items[i].date_text !== items[i - 1].date_text;
    }

    for (const item of items) {
        if (!item.need_frb) {
            delete item.date_html;
        }
    }

    return items;
}

function candidate_recipient_bar() {
    // Find a recipient bar that is close to being onscreen
    // but above the "top".  This function is guaranteed to
    // return **some** recipient bar that is above the fold,
    // if there is one, but it may not be the optimal one if
    // our pointer is messed up.  Starting with the pointer
    // is just an optimization here, and our caller will do
    // a forward traversal and clean up as necessary.
    // In most cases we find the bottom-most of recipient
    // bars that is still above the fold.

    // Start with the pointer's current location.
    const $selected_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.selected_row();

    if ($selected_row === undefined || $selected_row.length === 0) {
        return undefined;
    }

    let $candidate = _rows__WEBPACK_IMPORTED_MODULE_4__.get_message_recipient_row($selected_row);
    if ($candidate === undefined) {
        return undefined;
    }

    while ($candidate.length) {
        if ($candidate.hasClass("recipient_row") && top_offset($candidate) < 0) {
            return $candidate;
        }
        // We cannot use .prev(".recipient_row") here, because that
        // returns nothing if the previous element is not a recipient
        // row, rather than finding the first recipient_row.
        $candidate = $candidate.prev();
    }

    return undefined;
}

function show_floating_recipient_bar() {
    if (!is_floating_recipient_bar_showing) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar").css("visibility", "visible");
        is_floating_recipient_bar_showing = true;
    }
}

let $old_source;
function replace_floating_recipient_bar(source_info) {
    const $source_recipient_bar = source_info.$elem;

    let $new_label;
    let $other_label;
    let $header;

    if ($source_recipient_bar !== $old_source) {
        if ($source_recipient_bar.children(".message_header_stream").length !== 0) {
            $new_label = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#current_label_stream");
            $other_label = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#current_label_private_message");
            $header = $source_recipient_bar.children(".message_header_stream");
        } else {
            $new_label = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#current_label_private_message");
            $other_label = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#current_label_stream");
            $header = $source_recipient_bar.children(".message_header_private_message");
        }
        $new_label.find(".message_header").replaceWith($header.clone());
        $other_label.css("display", "none");
        $new_label.css("display", "block");
        $new_label.attr("zid", _rows__WEBPACK_IMPORTED_MODULE_4__.id(_rows__WEBPACK_IMPORTED_MODULE_4__.first_message_in_group($source_recipient_bar)));

        $new_label.toggleClass("message-fade", $source_recipient_bar.hasClass("message-fade"));
        $old_source = $source_recipient_bar;
    }

    const rendered_date = source_info.date_html || "";

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar").find(".recipient_row_date").html(rendered_date);

    show_floating_recipient_bar();
}

function hide() {
    if (is_floating_recipient_bar_showing) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar").css("visibility", "hidden");
        is_floating_recipient_bar_showing = false;
    }
}

function de_clutter_dates(items) {
    for (const item of items) {
        item.$elem.find(".recipient_row_date").toggle(item.show_date);
    }
}

function update() {
    const items = relevant_recipient_bars();

    if (!items || items.length === 0) {
        hide();
        return;
    }

    de_clutter_dates(items);

    if (!items[0].need_frb) {
        hide();
        return;
    }

    replace_floating_recipient_bar(items[0]);
}


/***/ }),

/***/ "./static/js/gear_menu.js":
/*!********************************!*\
  !*** ./static/js/gear_menu.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "close": () => (/* binding */ close),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_open": () => (/* binding */ is_open),
/* harmony export */   "open": () => (/* binding */ open),
/* harmony export */   "update_org_settings_menu_item": () => (/* binding */ update_org_settings_menu_item),
/* harmony export */   "version_display_string": () => (/* binding */ version_display_string)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_gear_menu_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/gear_menu.hbs */ "./static/templates/gear_menu.hbs");
/* harmony import */ var _templates_gear_menu_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_gear_menu_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());








/*
For various historical reasons there isn't one
single chunk of code that really makes our gear
menu function.  In this comment I try to help
you know where to look for relevant code.

The module that you're reading now doesn't
actually do much of the work.

Our gear menu has these choices:

=================
hash:  Manage streams
hash:  Settings
hash:  Organization settings
link:  Usage statistics
---
link:  Help center
info:  Keyboard shortcuts
info:  Message formatting
info:  Search filters
hash:  About Zulip
---
link:  Desktop & mobile apps
link:  Integrations
link:  API documentation
link:  Sponsor Zulip
link:  Plans and pricing
---
hash:   Invite users
---
misc:  Logout
=================

Depending on settings, there may also be choices
like "Feedback" or "Debug".

The menu items get built in a server-side template called
templates/zerver/app/navbar.html.  Each item is
an HTML anchor tag with a "role" of "menuitem".

The menu itself has the selector
"settings-dropdown".

The items with the prefix of "hash:" are in-page
links:

    #streams
    #settings
    #organization
    #about-zulip
    #invite

When you click on the links there is a function
called hashchanged() in static/js/hashchange.js
that gets invoked.  (We register this as a listener
for the hashchange event.)  This function then
launches the appropriate modal for each menu item.
Look for things like subs.launch(...) or
invite.launch() in that code.

Some items above are prefixed with "link:".  Those
items, when clicked, just use the normal browser
mechanism to link to external pages, and they
have a target of "_blank".

The "info:" items use our info overlay system
in static/js/info_overlay.js.  They are dispatched
using a click handler in static/js/click_handlers.js.
The click handler uses "[data-overlay-trigger]" as
the selector and then calls browser_history.go_to_location.
*/

function update_org_settings_menu_item() {
    const $item = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin-menu-item").expectOne();
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        $item.find("span").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Manage organization"}));
    } else {
        $item.find("span").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Organization settings"}));
    }
}

function version_display_string() {
    const version = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const is_fork = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== version;

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("-dev+git")) {
        // The development environment uses this version string format.
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Zulip Server dev environment"});
    }

    if (is_fork) {
        // For forks, we want to describe the Zulip version this was
        // forked from, and that it was modified.
        const display_version = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(/\+git.*/, "")
            .replace(/-dev.*/, "-dev");
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Zulip Server {display_version} (modified)"}, {display_version});
    }

    // The below cases are all for official versions; either a
    // release, or Git commit from one of Zulip's official branches.

    if (version.includes("+git")) {
        // A version from a Zulip official maintenance branch such as 5.x.
        const display_version = version.replace(/\+git.*/, "");
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Zulip Server {display_version} (patched)"}, {display_version});
    }

    const display_version = version.replace(/\+git.*/, "").replace(/-dev.*/, "-dev");
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Zulip Server {display_version}"}, {display_version});
}

function initialize() {
    const rendered_gear_menu = _templates_gear_menu_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        realm_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_uri: new URL(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).hostname,
        is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_self_hosted: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 1,
        is_plan_limited: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 2,
        is_plan_standard: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 3,
        is_plan_standard_sponsored_for_free: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 4,
        is_business_org: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 10,
        is_education_org: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 30 || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 35,
        standard_plan_name: "Zulip Cloud Standard",
        server_needs_upgrade: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        version_display_string: version_display_string(),
        apps_page_url: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        can_invite_others_to_realm: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        corporate_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_guest: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        login_link: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ? "/devlogin/" : "/login/",
        promote_sponsoring_zulip: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_billing: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_plans: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_webathena: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar-buttons").html(rendered_gear_menu);
    update_org_settings_menu_item();
}

function open() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings-dropdown").trigger("click");
    // there are invisible li tabs, which should not be clicked.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gear-menu").find("li:not(.invisible) a").eq(0).trigger("focus");
}

function is_open() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dropdown").hasClass("open");
}

function close() {
    if (is_open()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dropdown").removeClass("open");
    }
}


/***/ }),

/***/ "./static/js/giphy.js":
/*!****************************!*\
  !*** ./static/js/giphy.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "focus_current_edit_message": () => (/* binding */ focus_current_edit_message),
/* harmony export */   "hide_giphy_popover": () => (/* binding */ hide_giphy_popover),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_giphy_enabled": () => (/* binding */ is_giphy_enabled),
/* harmony export */   "is_popped_from_edit_messsage": () => (/* binding */ is_popped_from_edit_messsage),
/* harmony export */   "update_giphy_rating": () => (/* binding */ update_giphy_rating)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_giphy_picker_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/giphy_picker.hbs */ "./static/templates/giphy_picker.hbs");
/* harmony import */ var _templates_giphy_picker_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_giphy_picker_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_giphy_picker_mobile_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/giphy_picker_mobile.hbs */ "./static/templates/giphy_picker_mobile.hbs");
/* harmony import */ var _templates_giphy_picker_mobile_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_giphy_picker_mobile_hbs__WEBPACK_IMPORTED_MODULE_3__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _css_variables__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./css_variables */ "./static/js/css_variables.js");
/* harmony import */ var _css_variables__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_css_variables__WEBPACK_IMPORTED_MODULE_6__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());














let giphy_fetch;
let search_term = "";
let gifs_grid;
let $active_popover_element;

// Only used if popover called from edit message, otherwise it is `undefined`.
let edit_message_id;

function is_popped_from_edit_messsage() {
    return $active_popover_element && edit_message_id !== undefined;
}

function focus_current_edit_message() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#edit_form_${CSS.escape(edit_message_id)} .message_edit_content`).trigger("focus");
}

function is_giphy_enabled() {
    return (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== "" &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    );
}

// Approximate width and height of
// giphy popover as computed by chrome
// + 25px;
const APPROX_HEIGHT = 350;
const APPROX_WIDTH = 300;

function update_giphy_rating() {
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ||
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === ""
    ) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".compose_gif_icon").hide();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".compose_gif_icon").show();
    }
}

function get_rating() {
    const options = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    for (const rating in Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        if (options[rating].id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            return rating;
        }
    }

    // The below should never run unless a server bug allowed a
    // `giphy_rating` value not present in `giphy_rating_options`.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid giphy_rating value: " + Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    return "g";
}

async function renderGIPHYGrid(targetEl) {
    const {renderGrid} = await Promise.all(/*! import() | giphy-sdk */[__webpack_require__.e("vendors-node_modules_giphy_js-components_dist_index_js"), __webpack_require__.e("giphy-sdk")]).then(__webpack_require__.t.bind(__webpack_require__, /*! @giphy/js-components */ "./node_modules/@giphy/js-components/dist/index.js", 23));
    const {GiphyFetch} = await Promise.all(/*! import() | giphy-sdk */[__webpack_require__.e("vendors-node_modules_giphy_js-components_dist_index_js"), __webpack_require__.e("giphy-sdk")]).then(__webpack_require__.t.bind(__webpack_require__, /*! @giphy/js-fetch-api */ "./node_modules/@giphy/js-fetch-api/dist/index.js", 23));

    if (giphy_fetch === undefined) {
        giphy_fetch = new GiphyFetch(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    }

    function fetchGifs(offset) {
        const config = {
            offset,
            limit: 25,
            rating: get_rating(),
            // We don't pass random_id here, for privacy reasons.
        };
        if (search_term === "") {
            // Get the trending gifs by default.
            return giphy_fetch.trending(config);
        }
        return giphy_fetch.search(search_term, config);
    }

    const render = () =>
        // See https://github.com/Giphy/giphy-js/blob/master/packages/components/README.md#grid
        // for detailed documentation.
        renderGrid(
            {
                width: 300,
                fetchGifs,
                columns: 3,
                gutter: 6,
                noLink: true,
                // Hide the creator attribution that appears over a
                // GIF; nice in principle but too distracting.
                hideAttribution: true,
                onGifClick(props) {
                    let $textarea = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea");
                    if (edit_message_id !== undefined) {
                        $textarea = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                            `#edit_form_${CSS.escape(edit_message_id)} .message_edit_content`,
                        );
                    }

                    _compose_ui__WEBPACK_IMPORTED_MODULE_5__.insert_syntax_and_focus(
                        `[](${props.images.downsized_medium.url})`,
                        $textarea,
                    );
                    hide_giphy_popover();
                },
                onGifVisible(gif, e) {
                    // Set tabindex for all the GIFs that
                    // are visible to the user. This allows
                    // user to navigate the GIFs using tab.
                    // TODO: Remove this after https://github.com/Giphy/giphy-js/issues/174
                    // is closed.
                    e.target.tabIndex = 0;
                },
            },
            targetEl,
        );

    // Limit the rate at which we do queries to the GIPHY API to
    // one per 300ms, in line with animation timing, basically to avoid
    // content appearing while the user is typing.
    const resizeRender = lodash__WEBPACK_IMPORTED_MODULE_1___default().throttle(render, 300);
    window.addEventListener("resize", resizeRender, false);
    const remove = render();
    return {
        remove() {
            remove();
            window.removeEventListener("resize", resizeRender, false);
        },
    };
}

async function update_grid_with_search_term() {
    if (!gifs_grid) {
        return;
    }

    const $search_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy-search-query");
    // GIPHY popover may have been hidden by the
    // time this function is called.
    if ($search_elem.length) {
        search_term = $search_elem[0].value;
        gifs_grid.remove();
        gifs_grid = await renderGIPHYGrid(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy_grid_in_popover .giphy-content")[0]);
        return;
    }

    // Set to undefined to stop searching.
    gifs_grid = undefined;
}

function hide_giphy_popover() {
    // Returns `true` if the popover was open.
    if ($active_popover_element) {
        // We need to destroy the popover because when
        // we hide it, bootstrap popover
        // library removes `giphy-content` element
        // as part of cleaning up everything inside
        // `popover-content`, so we need to reinitialize
        // the popover by destroying it.
        $active_popover_element.popover("destroy");
        $active_popover_element = undefined;
        edit_message_id = undefined;
        gifs_grid = undefined;
        return true;
    }
    return false;
}

function get_popover_content() {
    if (window.innerWidth <= _css_variables__WEBPACK_IMPORTED_MODULE_6__.media_breakpoints_num.md) {
        // Show as modal in the center for small screens.
        return _templates_giphy_picker_mobile_hbs__WEBPACK_IMPORTED_MODULE_3___default()();
    }
    return _templates_giphy_picker_hbs__WEBPACK_IMPORTED_MODULE_2___default()();
}

function get_popover_placement() {
    let placement = _popovers__WEBPACK_IMPORTED_MODULE_7__.compute_placement(
        $active_popover_element,
        APPROX_HEIGHT,
        APPROX_WIDTH,
        true,
    );

    if (placement === "viewport_center") {
        // For legacy reasons `compute_placement` actually can
        // return `viewport_center` which used to place popover in
        // the center of the screen, but bootstrap doesn't actually
        // support that and we already handle it on small screen sizes
        // by placing it in center using `popover-flex`.
        placement = "left";
    }

    return placement;
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("keydown", ".giphy-gif", Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("keydown", ".compose_gif_icon", Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#giphy_search_clear", async (e) => {
        e.stopPropagation();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy-search-query").val("");
        await update_grid_with_search_term();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".compose_gif_icon", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const compose_click_target = _compose_ui__WEBPACK_IMPORTED_MODULE_5__.get_compose_click_target(e);
        if ($active_popover_element && $active_popover_element.get()[0] === compose_click_target) {
            // Hide giphy popover if already active.
            hide_giphy_popover();
            return;
        }
        _popovers__WEBPACK_IMPORTED_MODULE_7__.hide_all();

        const $elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(compose_click_target);
        if ($elt.parents(".message_edit_form").length === 1) {
            // Store message id in global variable edit_message_id so that
            // its value can be further used to correctly find the message textarea element.
            edit_message_id = _rows__WEBPACK_IMPORTED_MODULE_8__.id($elt.parents(".message_row"));
        } else {
            edit_message_id = undefined;
        }

        $active_popover_element = $elt;
        $active_popover_element.popover({
            animation: true,
            placement: get_popover_placement(),
            html: true,
            trigger: "manual",
            template: get_popover_content(),
            /* Popovers without a content property are not displayed,
             * so we need something here; but we haven't contacted the
             * Giphy API yet to get the actual content to display. */
            content: " ",
        });

        $active_popover_element.popover("show");
        // It takes about 1s for the popover to show; So,
        // we wait for popover to display before rendering GIFs
        // in it, otherwise popover is rendered with empty content.
        const popover_observer = new MutationObserver(async () => {
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy_grid_in_popover .giphy-content").is(":visible")) {
                popover_observer.disconnect();
                gifs_grid = await renderGIPHYGrid(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy_grid_in_popover .giphy-content")[0]);
            }
        });
        const opts = {attributes: false, childList: true, characterData: false, subtree: true};
        popover_observer.observe(document, opts);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on(
            "keyup",
            "#giphy-search-query",
            // Use debounce to create a 300ms interval between
            // every search. This makes the UX of searching pleasant
            // by allowing user to finish typing before search
            // is executed.
            lodash__WEBPACK_IMPORTED_MODULE_1___default().debounce(update_grid_with_search_term, 300),
        );

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).one("compose_canceled.zulip compose_finished.zulip", () => {
            hide_giphy_popover();
        });

        // Focus on search box by default.
        // This is specially helpful for users
        // navigating via keyboard.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#giphy-search-query").trigger("focus");
    });
}


/***/ }),

/***/ "./static/js/hash_util.js":
/*!********************************!*\
  !*** ./static/js/hash_util.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "allowed_web_public_narrows": () => (/* binding */ allowed_web_public_narrows),
/* harmony export */   "build_login_link": () => (/* binding */ build_login_link),
/* harmony export */   "build_reload_url": () => (/* binding */ build_reload_url),
/* harmony export */   "by_conversation_and_time_url": () => (/* binding */ by_conversation_and_time_url),
/* harmony export */   "by_sender_url": () => (/* binding */ by_sender_url),
/* harmony export */   "by_stream_topic_url": () => (/* binding */ by_stream_topic_url),
/* harmony export */   "by_stream_url": () => (/* binding */ by_stream_url),
/* harmony export */   "current_hash_as_next": () => (/* binding */ current_hash_as_next),
/* harmony export */   "decode_operand": () => (/* binding */ decode_operand),
/* harmony export */   "encode_operand": () => (/* binding */ encode_operand),
/* harmony export */   "encode_stream_name": () => (/* binding */ encode_stream_name),
/* harmony export */   "get_current_hash_category": () => (/* binding */ get_current_hash_category),
/* harmony export */   "get_current_hash_section": () => (/* binding */ get_current_hash_section),
/* harmony export */   "get_hash_category": () => (/* binding */ get_hash_category),
/* harmony export */   "get_hash_section": () => (/* binding */ get_hash_section),
/* harmony export */   "group_edit_url": () => (/* binding */ group_edit_url),
/* harmony export */   "huddle_with_url": () => (/* binding */ huddle_with_url),
/* harmony export */   "is_create_new_stream_narrow": () => (/* binding */ is_create_new_stream_narrow),
/* harmony export */   "is_editing_group": () => (/* binding */ is_editing_group),
/* harmony export */   "is_editing_stream": () => (/* binding */ is_editing_stream),
/* harmony export */   "is_overlay_hash": () => (/* binding */ is_overlay_hash),
/* harmony export */   "is_spectator_compatible": () => (/* binding */ is_spectator_compatible),
/* harmony export */   "operators_to_hash": () => (/* binding */ operators_to_hash),
/* harmony export */   "parse_narrow": () => (/* binding */ parse_narrow),
/* harmony export */   "pm_with_url": () => (/* binding */ pm_with_url),
/* harmony export */   "search_public_streams_notice_url": () => (/* binding */ search_public_streams_notice_url),
/* harmony export */   "stream_edit_url": () => (/* binding */ stream_edit_url)
/* harmony export */ });
/* harmony import */ var _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/js/internal_url */ "./static/shared/js/internal_url.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");






function get_hash_category(hash) {
    // given "#streams/subscribed", returns "streams"
    return hash ? hash.replace(/^#/, "").split(/\//)[0] : "";
}

function get_hash_section(hash) {
    // given "#settings/profile", returns "profile"
    // given '#streams/5/social", returns "5"
    if (!hash) {
        return "";
    }

    const parts = hash.replace(/\/$/, "").split(/\//);

    return parts[1] || "";
}

function get_current_hash_category() {
    return get_hash_category(window.location.hash);
}

function get_current_hash_section() {
    return get_hash_section(window.location.hash);
}

function build_reload_url() {
    let hash = window.location.hash;
    if (hash.length !== 0 && hash[0] === "#") {
        hash = hash.slice(1);
    }
    return "+oldhash=" + encodeURIComponent(hash);
}

function encode_operand(operator, operand) {
    if (operator === "group-pm-with" || operator === "pm-with" || operator === "sender") {
        const slug = _people__WEBPACK_IMPORTED_MODULE_2__.emails_to_slug(operand);
        if (slug) {
            return slug;
        }
    }

    if (operator === "stream") {
        return encode_stream_name(operand);
    }

    return _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(operand);
}

function encode_stream_name(operand) {
    // stream_data prefixes the stream id, but it does not do the
    // URI encoding piece
    operand = _stream_data__WEBPACK_IMPORTED_MODULE_3__.name_to_slug(operand);

    return _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(operand);
}

function decode_operand(operator, operand) {
    if (operator === "group-pm-with" || operator === "pm-with" || operator === "sender") {
        const emails = _people__WEBPACK_IMPORTED_MODULE_2__.slug_to_emails(operand);
        if (emails) {
            return emails;
        }
    }

    operand = _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.decodeHashComponent(operand);

    if (operator === "stream") {
        return _stream_data__WEBPACK_IMPORTED_MODULE_3__.slug_to_name(operand);
    }

    return operand;
}

function by_stream_url(stream_id) {
    // Wrapper for web use of internal_url.by_stream_url
    return _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.by_stream_url(stream_id, _stream_data__WEBPACK_IMPORTED_MODULE_3__.maybe_get_stream_name);
}

function by_stream_topic_url(stream_id, topic) {
    // Wrapper for web use of internal_url.by_stream_topic_url
    return _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.by_stream_topic_url(stream_id, topic, _stream_data__WEBPACK_IMPORTED_MODULE_3__.maybe_get_stream_name);
}

// Encodes an operator list into the
// corresponding hash: the # component
// of the narrow URL
function operators_to_hash(operators) {
    let hash = "#";

    if (operators !== undefined) {
        hash = "#narrow";

        for (const elem of operators) {
            // Support legacy tuples.
            const operator = elem.operator;
            const operand = elem.operand;

            const sign = elem.negated ? "-" : "";
            hash +=
                "/" +
                sign +
                _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(operator) +
                "/" +
                encode_operand(operator, operand);
        }
    }

    return hash;
}

function by_sender_url(reply_to) {
    return operators_to_hash([{operator: "sender", operand: reply_to}]);
}

function pm_with_url(reply_to) {
    const slug = _people__WEBPACK_IMPORTED_MODULE_2__.emails_to_slug(reply_to);
    return "#narrow/pm-with/" + slug;
}

function huddle_with_url(user_ids_string) {
    // This method is convenient for callers
    // that have already converted emails to a comma-delimited
    // list of user_ids.  We should be careful to keep this
    // consistent with hash_util.decode_operand.
    return "#narrow/pm-with/" + user_ids_string + "-group";
}

function by_conversation_and_time_url(message) {
    const absolute_url =
        window.location.protocol +
        "//" +
        window.location.host +
        "/" +
        window.location.pathname.split("/")[1];

    const suffix = "/near/" + _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(message.id);

    if (message.type === "stream") {
        return absolute_url + by_stream_topic_url(message.stream_id, message.topic) + suffix;
    }

    return absolute_url + _people__WEBPACK_IMPORTED_MODULE_2__.pm_perma_link(message) + suffix;
}

function stream_edit_url(sub) {
    const hash = `#streams/${sub.stream_id}/${_shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(sub.name)}`;
    return hash;
}

function group_edit_url(group) {
    const hash = `#groups/${group.id}/${_shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.encodeHashComponent(group.name)}`;
    return hash;
}

function search_public_streams_notice_url(operators) {
    const public_operator = {operator: "streams", operand: "public"};
    return operators_to_hash([public_operator].concat(operators));
}

function parse_narrow(hash) {
    // This will throw an exception when passed an invalid hash
    // at the decodeHashComponent call, handle appropriately.
    let i;
    const operators = [];
    for (i = 1; i < hash.length; i += 2) {
        // We don't construct URLs with an odd number of components,
        // but the user might write one.
        let operator = _shared_js_internal_url__WEBPACK_IMPORTED_MODULE_0__.decodeHashComponent(hash[i]);
        // Do not parse further if empty operator encountered.
        if (operator === "") {
            break;
        }

        const raw_operand = hash[i + 1];

        if (!raw_operand) {
            return undefined;
        }

        let negated = false;
        if (operator[0] === "-") {
            negated = true;
            operator = operator.slice(1);
        }

        const operand = decode_operand(operator, raw_operand);
        operators.push({negated, operator, operand});
    }
    return operators;
}

function is_overlay_hash(hash) {
    // Hash changes within this list are overlays and should not unnarrow (etc.)
    const overlay_list = [
        "streams",
        "drafts",
        "groups",
        "settings",
        "organization",
        "invite",
        "keyboard-shortcuts",
        "message-formatting",
        "search-operators",
        "about-zulip",
    ];
    const main_hash = get_hash_category(hash);

    return overlay_list.includes(main_hash);
}

// this finds the stream that is actively open in the settings and focused in
// the left side.
function is_editing_stream(desired_stream_id) {
    const hash_components = window.location.hash.slice(1).split(/\//);

    if (hash_components[0] !== "streams") {
        return false;
    }

    if (!hash_components[2]) {
        return false;
    }

    // if the string casted to a number is valid, and another component
    // after exists then it's a stream name/id pair.
    const stream_id = Number.parseFloat(hash_components[1]);

    return stream_id === desired_stream_id;
}

function is_editing_group(desired_group_id) {
    const hash_components = window.location.hash.slice(1).split(/\//);

    if (hash_components[0] !== "groups") {
        return false;
    }

    if (!hash_components[2]) {
        return false;
    }

    // if the string casted to a number is valid, and another component
    // after exists then it's a stream name/id pair.
    const group_id = Number.parseFloat(hash_components[1]);

    return group_id === desired_group_id;
}

function is_create_new_stream_narrow() {
    return window.location.hash === "#streams/new";
}

const allowed_web_public_narrows = [
    "streams",
    "stream",
    "topic",
    "sender",
    "has",
    "search",
    "near",
    "id",
];

function is_spectator_compatible(hash) {
    // Defines which views are supported for spectators.
    // This implementation should agree with the similar function in zerver/lib/narrow.py.
    const web_public_allowed_hashes = [
        "",
        // full #narrow hash handled in narrow.is_spectator_compatible
        "narrow",
        // TODO/compatibility: #recent_topics was renamed to #recent
        // in 2022. We should support the old URL fragment at least
        // until one cannot directly upgrade from Zulip 5.x.
        "recent_topics",
        "recent",
        "keyboard-shortcuts",
        "message-formatting",
        "search-operators",
        "all_messages",
        "about-zulip",
    ];

    const main_hash = get_hash_category(hash);

    if (main_hash === "narrow") {
        const hash_section = get_hash_section(hash);
        if (!allowed_web_public_narrows.includes(hash_section)) {
            return false;
        }
        return true;
    }

    return web_public_allowed_hashes.includes(main_hash);
}

function current_hash_as_next() {
    return `next=/${encodeURIComponent(window.location.hash)}`;
}

function build_login_link() {
    let login_link = "/login/?" + current_hash_as_next();
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        login_link = "/devlogin/?" + current_hash_as_next();
    }
    return login_link;
}


/***/ }),

/***/ "./static/js/hashchange.js":
/*!*********************************!*\
  !*** ./static/js/hashchange.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "changehash": () => (/* binding */ changehash),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "save_narrow": () => (/* binding */ save_narrow),
/* harmony export */   "set_hash_to_default_view": () => (/* binding */ set_hash_to_default_view)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _about_zulip__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./about_zulip */ "./static/js/about_zulip.js");
/* harmony import */ var _admin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./admin */ "./static/js/admin.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./floating_recipient_bar */ "./static/js/floating_recipient_bar.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _info_overlay__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./info_overlay */ "./static/js/info_overlay.js");
/* harmony import */ var _invite__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./invite */ "./static/js/invite.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _search__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./search */ "./static/js/search.js");
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./settings */ "./static/js/settings.js");
/* harmony import */ var _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./settings_panel_menu */ "./static/js/settings_panel_menu.js");
/* harmony import */ var _settings_toggle__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./settings_toggle */ "./static/js/settings_toggle.js");
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
/* harmony import */ var _top_left_corner__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./top_left_corner */ "./static/js/top_left_corner.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_groups_settings_ui__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./user_groups_settings_ui */ "./static/js/user_groups_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());































// Read https://zulip.readthedocs.io/en/latest/subsystems/hashchange-system.html
// or locally: docs/subsystems/hashchange-system.md

function get_full_url(hash) {
    const location = window.location;

    if (hash === "" || hash.charAt(0) !== "#") {
        hash = "#" + hash;
    }

    // IE returns pathname as undefined and missing the leading /
    let pathname = location.pathname;
    if (pathname === undefined) {
        pathname = "/";
    } else if (pathname === "" || pathname.charAt(0) !== "/") {
        pathname = "/" + pathname;
    }

    // Build a full URL to not have same origin problems
    const url = location.protocol + "//" + location.host + pathname + hash;
    return url;
}

function set_hash(hash) {
    if (history.pushState) {
        const url = get_full_url(hash);
        history.pushState(null, null, url);
        _browser_history__WEBPACK_IMPORTED_MODULE_4__.update_web_public_hash(hash);
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("browser does not support pushState");
        window.location.hash = hash;
    }
}

function maybe_hide_recent_topics() {
    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_16__.is_visible()) {
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_15__.hide();
        return true;
    }
    return false;
}

function changehash(newhash) {
    if (_browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash) {
        return;
    }
    maybe_hide_recent_topics();
    _message_viewport__WEBPACK_IMPORTED_MODULE_11__.stop_auto_scrolling();
    set_hash(newhash);
}

function save_narrow(operators) {
    if (_browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash) {
        return;
    }
    const new_hash = _hash_util__WEBPACK_IMPORTED_MODULE_7__.operators_to_hash(operators);
    changehash(new_hash);
}

function show_all_message_view() {
    const coming_from_recent_topics = maybe_hide_recent_topics();
    _narrow__WEBPACK_IMPORTED_MODULE_12__.deactivate(coming_from_recent_topics);
    _top_left_corner__WEBPACK_IMPORTED_MODULE_23__.handle_narrow_deactivated();
    _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__.update();
    _search__WEBPACK_IMPORTED_MODULE_17__.update_button_visibility();
    // We need to maybe scroll to the selected message
    // once we have the proper viewport set up
    setTimeout(_navigate__WEBPACK_IMPORTED_MODULE_13__.maybe_scroll_to_selected, 0);
}

function set_hash_to_default_view() {
    window.location.hash = "";
}

function show_default_view() {
    // This function should only be called from the hashchange
    // handlers, as it does not set the hash to "".
    //
    // We only allow all_messages and recent_topics
    // to be rendered without a hash.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "recent_topics") {
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_15__.show();
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "all_messages") {
        show_all_message_view();
    } else {
        // NOTE: Setting a hash which is not rendered on
        // empty hash (like a stream narrow) will
        // introduce a bug that user will not be able to
        // go back in browser history. See
        // https://chat.zulip.org/#narrow/stream/9-issues/topic/Browser.20back.20button.20on.20RT
        // for detailed description of the issue.
        window.location.hash = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }
}

// Returns true if this function performed a narrow
function do_hashchange_normal(from_reload) {
    _message_viewport__WEBPACK_IMPORTED_MODULE_11__.stop_auto_scrolling();

    // NB: In Firefox, window.location.hash is URI-decoded.
    // Even if the URL bar says #%41%42%43%44, the value here will
    // be #ABCD.
    const hash = window.location.hash.split("/");

    switch (hash[0]) {
        case "#narrow": {
            maybe_hide_recent_topics();
            let operators;
            try {
                // TODO: Show possible valid URLs to the user.
                operators = _hash_util__WEBPACK_IMPORTED_MODULE_7__.parse_narrow(hash);
            } catch {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invalid URL"}),
                    undefined,
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#home-error"),
                    2000,
                );
            }
            if (operators === undefined) {
                // If the narrow URL didn't parse,
                // send them to default_view.
                // We cannot clear hash here since
                // it will block user from going back
                // in browser history.
                show_default_view();
                return false;
            }
            const narrow_opts = {
                change_hash: false, // already set
                trigger: "hash change",
            };
            if (from_reload) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We are narrowing as part of a reload.");
                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
                    _message_lists__WEBPACK_IMPORTED_MODULE_10__.home.pre_narrow_offset = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
                    narrow_opts.then_select_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
                    narrow_opts.then_select_offset = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
                }
            }
            _narrow__WEBPACK_IMPORTED_MODULE_12__.activate(operators, narrow_opts);
            _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_6__.update();
            return true;
        }
        case "":
        case "#":
            show_default_view();
            break;
        case "#recent_topics":
            // The URL for Recent Conversations was changed from
            // #recent_topics to #recent in 2022. Because pre-change
            // Welcome Bot messages included links to this URL, we
            // need to support the "#recent_topics" hash as an alias
            // for #recent permanently. We show the view and then
            // replace the current URL hash in a way designed to hide
            // this detail in the browser's forward/back session history.
            _recent_topics_ui__WEBPACK_IMPORTED_MODULE_15__.show();
            window.location.replace("#recent");
            break;
        case "#recent":
            _recent_topics_ui__WEBPACK_IMPORTED_MODULE_15__.show();
            break;
        case "#all_messages":
            show_all_message_view();
            break;
        case "#keyboard-shortcuts":
        case "#message-formatting":
        case "#search-operators":
        case "#drafts":
        case "#invite":
        case "#streams":
        case "#organization":
        case "#settings":
        case "#about-zulip":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("overlay logic skipped for: " + hash);
            break;
        default:
            show_default_view();
    }
    return false;
}

function do_hashchange_overlay(old_hash) {
    if (old_hash === undefined) {
        // The user opened the app with an overlay hash; we need to
        // show the user's default view behind it.
        show_default_view();
    }
    const base = _hash_util__WEBPACK_IMPORTED_MODULE_7__.get_current_hash_category();
    const old_base = _hash_util__WEBPACK_IMPORTED_MODULE_7__.get_hash_category(old_hash);
    const section = _hash_util__WEBPACK_IMPORTED_MODULE_7__.get_current_hash_section();

    if (base === "groups" && (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))) {
        // The #groups settings page is unfinished, and disabled in production.
        show_default_view();
        return;
    }

    const coming_from_overlay = _hash_util__WEBPACK_IMPORTED_MODULE_7__.is_overlay_hash(old_hash || "#");

    if ((base === "settings" || base === "organization") && !section) {
        let settings_panel_object = _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.normal_settings;
        if (base === "organization") {
            settings_panel_object = _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.org_settings;
        }
        history.replaceState(
            null,
            "",
            get_full_url(base + "/" + settings_panel_object.current_tab()),
        );
    }

    if (base === "streams" && !section) {
        history.replaceState(null, "", get_full_url("streams/subscribed"));
    }

    // Start by handling the specific case of going
    // from something like streams/all to streams_subscribed.
    //
    // In most situations we skip by this logic and load
    // the new overlay.
    if (coming_from_overlay && base === old_base) {
        if (base === "streams") {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.change_state(section);
            return;
        }

        if (base === "groups") {
            _user_groups_settings_ui__WEBPACK_IMPORTED_MODULE_24__.change_state(section);
        }

        if (base === "settings") {
            if (!section) {
                // We may be on a really old browser or somebody
                // hand-typed a hash.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("missing section for settings");
            }
            _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.normal_settings.activate_section_or_default(section);
            return;
        }

        if (base === "organization") {
            if (!section) {
                // We may be on a really old browser or somebody
                // hand-typed a hash.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("missing section for organization");
            }
            _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.org_settings.activate_section_or_default(section);
            return;
        }

        // TODO: handle other cases like internal settings
        //       changes.
        return;
    }

    // This is a special case when user clicks on a URL that makes the overlay switch
    // from org settings to user settings or user edits the URL to switch between them.
    const settings_hashes = new Set(["settings", "organization"]);
    // Ensure that we are just switching between user and org settings and the settings
    // overlay is open.
    const is_hashchange_internal =
        settings_hashes.has(base) && settings_hashes.has(old_base) && _overlays__WEBPACK_IMPORTED_MODULE_14__.settings_open();
    if (is_hashchange_internal) {
        if (base === "settings") {
            _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.normal_settings.activate_section_or_default(section);
        } else {
            _settings_panel_menu__WEBPACK_IMPORTED_MODULE_19__.org_settings.activate_section_or_default(section);
        }
        _settings_toggle__WEBPACK_IMPORTED_MODULE_20__.highlight_toggle(base);
        return;
    }

    // It's not super likely that an overlay is already open,
    // but you can jump from /settings to /streams by using
    // the browser's history menu or hand-editing the URL or
    // whatever.  If so, just close the overlays.
    if (base !== old_base) {
        _overlays__WEBPACK_IMPORTED_MODULE_14__.close_for_hash_change();
    }

    // NORMAL FLOW: basically, launch the overlay:

    if (!coming_from_overlay) {
        _browser_history__WEBPACK_IMPORTED_MODULE_4__.set_hash_before_overlay(old_hash);
    }

    if (base === "streams") {
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.launch(section);
        return;
    }

    if (base === "groups") {
        _user_groups_settings_ui__WEBPACK_IMPORTED_MODULE_24__.launch(section);
        return;
    }

    if (base === "drafts") {
        _drafts__WEBPACK_IMPORTED_MODULE_5__.launch();
        return;
    }

    if (base === "settings") {
        _settings__WEBPACK_IMPORTED_MODULE_18__.launch(section);
        return;
    }

    if (base === "organization") {
        _admin__WEBPACK_IMPORTED_MODULE_2__.launch(section);
        return;
    }

    if (base === "invite") {
        _invite__WEBPACK_IMPORTED_MODULE_9__.launch();
        return;
    }

    if (base === "keyboard-shortcuts") {
        _info_overlay__WEBPACK_IMPORTED_MODULE_8__.show("keyboard-shortcuts");
        return;
    }

    if (base === "message-formatting") {
        _info_overlay__WEBPACK_IMPORTED_MODULE_8__.show("message-formatting");
        return;
    }

    if (base === "search-operators") {
        _info_overlay__WEBPACK_IMPORTED_MODULE_8__.show("search-operators");
        return;
    }

    if (base === "about-zulip") {
        _about_zulip__WEBPACK_IMPORTED_MODULE_1__.launch();
    }
}

function hashchanged(from_reload, e) {
    const current_hash = window.location.hash;
    const old_hash = e && (e.oldURL ? new URL(e.oldURL).hash : _browser_history__WEBPACK_IMPORTED_MODULE_4__.old_hash());
    const is_hash_web_public_compatible = _browser_history__WEBPACK_IMPORTED_MODULE_4__.update_web_public_hash(current_hash);

    const was_internal_change = _browser_history__WEBPACK_IMPORTED_MODULE_4__.save_old_hash();
    if (was_internal_change) {
        return undefined;
    }

    // TODO: Migrate the `#reload` syntax to use slashes as separators
    // so that this can be part of the main switch statement.
    if (window.location.hash.startsWith("#reload")) {
        // We don't want to change narrow if app is undergoing reload.
        return undefined;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !is_hash_web_public_compatible) {
        _spectators__WEBPACK_IMPORTED_MODULE_21__.login_to_access();
        return undefined;
    }

    if (_hash_util__WEBPACK_IMPORTED_MODULE_7__.is_overlay_hash(current_hash)) {
        _browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash = true;
        do_hashchange_overlay(old_hash);
        _browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash = false;
        return undefined;
    }

    // We are changing to a "main screen" view.
    _overlays__WEBPACK_IMPORTED_MODULE_14__.close_for_hash_change();
    _browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash = true;
    const ret = do_hashchange_normal(from_reload);
    _browser_history__WEBPACK_IMPORTED_MODULE_4__.state.changing_hash = false;
    return ret;
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on("hashchange", (e) => {
        hashchanged(false, e.originalEvent);
    });
    hashchanged(true);
}


/***/ }),

/***/ "./static/js/hotkey.js":
/*!*****************************!*\
  !*** ./static/js/hotkey.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_keydown_hotkey": () => (/* binding */ get_keydown_hotkey),
/* harmony export */   "get_keypress_hotkey": () => (/* binding */ get_keypress_hotkey),
/* harmony export */   "in_content_editable_widget": () => (/* binding */ in_content_editable_widget),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "process_ctrl_enter_key": () => (/* binding */ process_ctrl_enter_key),
/* harmony export */   "process_enter_key": () => (/* binding */ process_enter_key),
/* harmony export */   "process_escape_key": () => (/* binding */ process_escape_key),
/* harmony export */   "process_hotkey": () => (/* binding */ process_hotkey),
/* harmony export */   "process_keydown": () => (/* binding */ process_keydown),
/* harmony export */   "process_keypress": () => (/* binding */ process_keypress),
/* harmony export */   "process_shift_tab_key": () => (/* binding */ process_shift_tab_key),
/* harmony export */   "process_tab_key": () => (/* binding */ process_tab_key),
/* harmony export */   "processing_text": () => (/* binding */ processing_text)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _copy_and_paste__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./copy_and_paste */ "./static/js/copy_and_paste.js");
/* harmony import */ var _deprecated_feature_notice__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./deprecated_feature_notice */ "./static/js/deprecated_feature_notice.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
/* harmony import */ var _emoji_picker__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./emoji_picker */ "./static/js/emoji_picker.js");
/* harmony import */ var _feedback_widget__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./feedback_widget */ "./static/js/feedback_widget.js");
/* harmony import */ var _gear_menu__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./gear_menu */ "./static/js/gear_menu.js");
/* harmony import */ var _giphy__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./giphy */ "./static/js/giphy.js");
/* harmony import */ var _hashchange__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./hashchange */ "./static/js/hashchange.js");
/* harmony import */ var _hotspots__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./hotspots */ "./static/js/hotspots.js");
/* harmony import */ var _lightbox__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./lightbox */ "./static/js/lightbox.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './list_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_flags__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./message_flags */ "./static/js/message_flags.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _muted_topics_ui__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./muted_topics_ui */ "./static/js/muted_topics_ui.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popover_menus__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./popover_menus */ "./static/js/popover_menus.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _reactions__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./reactions */ "./static/js/reactions.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _search__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./search */ "./static/js/search.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
/* harmony import */ var _topic_zoom__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./topic_zoom */ "./static/js/topic_zoom.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















































function do_narrow_action(action) {
    action(_message_lists__WEBPACK_IMPORTED_MODULE_21__.current.selected_id(), {trigger: "hotkey"});
    return true;
}

// For message actions and user profile menu.
const menu_dropdown_hotkeys = new Set(["down_arrow", "up_arrow", "vim_up", "vim_down", "enter"]);

// Note that multiple keys can map to the same event_name, which
// we'll do in cases where they have the exact same semantics.
// DON'T FORGET: update keyboard_shortcuts.html

// The `message_view_only` property is a convenient and performant way
// to express a common case of which hotkeys do something in which
// views.  It is set for hotkeys (like `Ctrl + S`) that only have an effect
// in the main message view with a selected message.
// `message_view_only` hotkeys, as a group, are not processed if any
// overlays are open (e.g. settings, streams, etc.).

const keydown_shift_mappings = {
    // these can be triggered by Shift + key only
    9: {name: "shift_tab", message_view_only: false}, // Tab
    32: {name: "shift_spacebar", message_view_only: true}, // space bar
    37: {name: "left_arrow", message_view_only: false}, // left arrow
    39: {name: "right_arrow", message_view_only: false}, // right arrow
    38: {name: "up_arrow", message_view_only: false}, // up arrow
    40: {name: "down_arrow", message_view_only: false}, // down arrow
};

const keydown_unshift_mappings = {
    // these can be triggered by key only (without Shift)
    9: {name: "tab", message_view_only: false}, // Tab
    27: {name: "escape", message_view_only: false}, // Esc
    32: {name: "spacebar", message_view_only: true}, // space bar
    33: {name: "page_up", message_view_only: true}, // PgUp
    34: {name: "page_down", message_view_only: true}, // PgDn
    35: {name: "end", message_view_only: true}, // End
    36: {name: "home", message_view_only: true}, // Home
    37: {name: "left_arrow", message_view_only: false}, // left arrow
    39: {name: "right_arrow", message_view_only: false}, // right arrow
    38: {name: "up_arrow", message_view_only: false}, // up arrow
    40: {name: "down_arrow", message_view_only: false}, // down arrow
};

const keydown_ctrl_mappings = {
    219: {name: "escape", message_view_only: false}, // '['
    13: {name: "ctrl_enter", message_view_only: true}, // enter
};

const keydown_cmd_or_ctrl_mappings = {
    67: {name: "copy_with_c", message_view_only: false}, // 'C'
    75: {name: "search_with_k", message_view_only: false}, // 'K'
    83: {name: "star_message", message_view_only: true}, // 'S'
    190: {name: "narrow_to_compose_target", message_view_only: true}, // '.'
};

const keydown_either_mappings = {
    // these can be triggered by key or Shift + key
    // Note that codes for letters are still case sensitive!
    //
    // We may want to revisit both of these.  For Backspace, we don't
    // have any specific mapping behavior; we are just trying to disable
    // the normal browser features for certain OSes when we are in the
    // compose box, and the little bit of Backspace-related code here is
    // dubious, but may apply to Shift-Backspace.
    // For Enter, there is some possibly that Shift-Enter is intended to
    // have special behavior for folks that are used to Shift-Enter behavior
    // in other apps, but that's also slightly dubious.
    8: {name: "backspace", message_view_only: true}, // Backspace
    13: {name: "enter", message_view_only: false}, // Enter
    46: {name: "delete", message_view_only: false}, // Delete
};

const keypress_mappings = {
    42: {name: "star_deprecated", message_view_only: true}, // '*'
    43: {name: "thumbs_up_emoji", message_view_only: true}, // '+'
    45: {name: "toggle_message_collapse", message_view_only: true}, // '-'
    47: {name: "search", message_view_only: false}, // '/'
    58: {name: "toggle_reactions_popover", message_view_only: true}, // ':'
    62: {name: "compose_quote_reply", message_view_only: true}, // '>'
    63: {name: "show_shortcuts", message_view_only: false}, // '?'
    64: {name: "compose_reply_with_mention", message_view_only: true}, // '@'
    65: {name: "stream_cycle_backward", message_view_only: true}, // 'A'
    67: {name: "C_deprecated", message_view_only: true}, // 'C'
    68: {name: "stream_cycle_forward", message_view_only: true}, // 'D'
    71: {name: "G_end", message_view_only: true}, // 'G'
    74: {name: "vim_page_down", message_view_only: true}, // 'J'
    75: {name: "vim_page_up", message_view_only: true}, // 'K'
    77: {name: "toggle_topic_mute", message_view_only: true}, // 'M'
    80: {name: "narrow_private", message_view_only: true}, // 'P'
    82: {name: "respond_to_author", message_view_only: true}, // 'R'
    83: {name: "narrow_by_topic", message_view_only: true}, // 'S'
    85: {name: "mark_unread", message_view_only: true}, // 'U'
    86: {name: "view_selected_stream", message_view_only: false}, // 'V'
    97: {name: "all_messages", message_view_only: true}, // 'a'
    99: {name: "compose", message_view_only: true}, // 'c'
    100: {name: "open_drafts", message_view_only: true}, // 'd'
    101: {name: "edit_message", message_view_only: true}, // 'e'
    103: {name: "gear_menu", message_view_only: true}, // 'g'
    104: {name: "vim_left", message_view_only: true}, // 'h'
    105: {name: "message_actions", message_view_only: true}, // 'i'
    106: {name: "vim_down", message_view_only: true}, // 'j'
    107: {name: "vim_up", message_view_only: true}, // 'k'
    108: {name: "vim_right", message_view_only: true}, // 'l'
    109: {name: "move_message", message_view_only: true}, // 'm'
    110: {name: "n_key", message_view_only: false}, // 'n'
    112: {name: "p_key", message_view_only: false}, // 'p'
    113: {name: "query_streams", message_view_only: true}, // 'q'
    114: {name: "reply_message", message_view_only: true}, // 'r'
    115: {name: "narrow_by_recipient", message_view_only: true}, // 's'
    116: {name: "open_recent_topics", message_view_only: true}, // 't'
    117: {name: "show_sender_info", message_view_only: true}, // 'u'
    118: {name: "show_lightbox", message_view_only: true}, // 'v'
    119: {name: "query_users", message_view_only: true}, // 'w'
    120: {name: "compose_private_message", message_view_only: true}, // 'x'
};

function get_keydown_hotkey(e) {
    if (e.altKey) {
        return undefined;
    }

    let hotkey;

    if (e.ctrlKey && !e.shiftKey) {
        hotkey = keydown_ctrl_mappings[e.which];
        if (hotkey) {
            return hotkey;
        }
    }

    const isCmdOrCtrl = Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ? e.metaKey : e.ctrlKey;
    if (isCmdOrCtrl && !e.shiftKey) {
        hotkey = keydown_cmd_or_ctrl_mappings[e.which];
        if (hotkey) {
            return hotkey;
        }
        return undefined;
    } else if (e.metaKey || e.ctrlKey) {
        return undefined;
    }

    if (e.shiftKey) {
        hotkey = keydown_shift_mappings[e.which];
        if (hotkey) {
            return hotkey;
        }
    }

    if (!e.shiftKey) {
        hotkey = keydown_unshift_mappings[e.which];
        if (hotkey) {
            return hotkey;
        }
    }

    return keydown_either_mappings[e.which];
}

function get_keypress_hotkey(e) {
    if (e.metaKey || e.ctrlKey || e.altKey) {
        return undefined;
    }

    return keypress_mappings[e.which];
}

function processing_text() {
    const $focused_elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(":focus");
    return (
        $focused_elt.is("input") ||
        $focused_elt.is("select") ||
        $focused_elt.is("textarea") ||
        $focused_elt.parents(".pill-container").length >= 1 ||
        $focused_elt.attr("id") === "compose-send-button"
    );
}

function in_content_editable_widget(e) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(".editable-section");
}

// Returns true if we handled it, false if the browser should.
function process_escape_key(e) {
    if (
        _recent_topics_util__WEBPACK_IMPORTED_MODULE_32__.is_in_focus() &&
        // This will return false if `e.target` is not
        // any of the recent topics elements by design.
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_31__.change_focused_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target), "escape")
    ) {
        // Recent topics uses escape to switch focus from RT search / filters to topics table.
        // If focus is already on the table it returns false.
        return true;
    }

    if (_feedback_widget__WEBPACK_IMPORTED_MODULE_13__.is_open()) {
        _feedback_widget__WEBPACK_IMPORTED_MODULE_13__.dismiss();
        return true;
    }

    if (_popovers__WEBPACK_IMPORTED_MODULE_29__.any_active()) {
        if (_popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_manage_menu_popped()) {
            _popovers__WEBPACK_IMPORTED_MODULE_29__.hide_user_info_popover_manage_menu();
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_info_popover .user_info_popover_manage_menu_btn").trigger("focus");
            return true;
        }
        _popovers__WEBPACK_IMPORTED_MODULE_29__.hide_all();
        return true;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.is_modal_open()) {
        _overlays__WEBPACK_IMPORTED_MODULE_27__.close_active_modal();
        return true;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.is_active()) {
        _overlays__WEBPACK_IMPORTED_MODULE_27__.close_active();
        return true;
    }

    if (_gear_menu__WEBPACK_IMPORTED_MODULE_14__.is_open()) {
        _gear_menu__WEBPACK_IMPORTED_MODULE_14__.close();
        return true;
    }

    if (processing_text()) {
        if (_activity__WEBPACK_IMPORTED_MODULE_1__.searching()) {
            _activity__WEBPACK_IMPORTED_MODULE_1__.escape_search();
            return true;
        }

        if (_stream_list__WEBPACK_IMPORTED_MODULE_35__.searching()) {
            _stream_list__WEBPACK_IMPORTED_MODULE_35__.escape_search();
            return true;
        }

        // Emoji picker goes before compose so compose emoji picker is closed properly.
        if (_emoji_picker__WEBPACK_IMPORTED_MODULE_12__.reactions_popped()) {
            _emoji_picker__WEBPACK_IMPORTED_MODULE_12__.hide_emoji_popover();
            return true;
        }

        if (_giphy__WEBPACK_IMPORTED_MODULE_15__.is_popped_from_edit_messsage()) {
            _giphy__WEBPACK_IMPORTED_MODULE_15__.focus_current_edit_message();
            // Hide after setting focus so that `edit_message_id` is
            // still set in giphy.
            _giphy__WEBPACK_IMPORTED_MODULE_15__.hide_giphy_popover();
            return true;
        }

        if (_compose_state__WEBPACK_IMPORTED_MODULE_6__.composing()) {
            // Check if the giphy popover was open using compose box.
            // Hide GIPHY popover if it's open.
            if (!_giphy__WEBPACK_IMPORTED_MODULE_15__.is_popped_from_edit_messsage() && _giphy__WEBPACK_IMPORTED_MODULE_15__.hide_giphy_popover()) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").trigger("focus");
                return true;
            }

            // Check for errors in compose box; close errors if they exist
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-status").css("display") !== "none") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-status").hide();
                return true;
            }

            // Clear open compose banners, if present.
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".compose_banner").length) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
                return true;
            }

            // If the user hit the Esc key, cancel the current compose
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.cancel();
            return true;
        }

        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox").has(":focus")) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("input:focus,textarea:focus").trigger("blur");
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox .pill").trigger("blur");
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox #search_query").trigger("blur");
            } else {
                _message_view_header__WEBPACK_IMPORTED_MODULE_23__.exit_search();
            }
            return true;
        }

        // We pressed Esc and something was focused, and the composebox
        // wasn't open. In that case, we should blur the input.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("input:focus,textarea:focus").trigger("blur");
        return true;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_6__.composing()) {
        _compose_actions__WEBPACK_IMPORTED_MODULE_5__.cancel();
        return true;
    }

    if (_topic_zoom__WEBPACK_IMPORTED_MODULE_38__.is_zoomed_in()) {
        _topic_zoom__WEBPACK_IMPORTED_MODULE_38__.zoom_out();
        return true;
    }

    /* The Ctrl+[ hotkey navigates to the default view
     * unconditionally; Esc's behavior depends on a setting. */
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || e.which === 219) {
        _hashchange__WEBPACK_IMPORTED_MODULE_16__.set_hash_to_default_view();
        return true;
    }

    return false;
}

function handle_popover_events(event_name) {
    if (_popover_menus__WEBPACK_IMPORTED_MODULE_28__.actions_popped()) {
        _popovers__WEBPACK_IMPORTED_MODULE_29__.actions_menu_handle_keyboard(event_name);
        return true;
    }

    if (_popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_manage_menu_popped()) {
        _popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_popover_manage_menu_handle_keyboard(event_name);
        return true;
    }

    if (_popovers__WEBPACK_IMPORTED_MODULE_29__.message_info_popped()) {
        _popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_popover_for_message_handle_keyboard(event_name);
        return true;
    }

    if (_popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_popped()) {
        _popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_popover_handle_keyboard(event_name);
        return true;
    }

    if (_popovers__WEBPACK_IMPORTED_MODULE_29__.user_sidebar_popped()) {
        _popovers__WEBPACK_IMPORTED_MODULE_29__.user_sidebar_popover_handle_keyboard(event_name);
        return true;
    }

    if (_stream_popover__WEBPACK_IMPORTED_MODULE_36__.stream_popped()) {
        _stream_popover__WEBPACK_IMPORTED_MODULE_36__.stream_sidebar_menu_handle_keyboard(event_name);
        return true;
    }

    if (_stream_popover__WEBPACK_IMPORTED_MODULE_36__.topic_popped()) {
        _stream_popover__WEBPACK_IMPORTED_MODULE_36__.topic_sidebar_menu_handle_keyboard(event_name);
        return true;
    }

    if (_stream_popover__WEBPACK_IMPORTED_MODULE_36__.all_messages_popped()) {
        _stream_popover__WEBPACK_IMPORTED_MODULE_36__.all_messages_sidebar_menu_handle_keyboard(event_name);
        return true;
    }

    if (_stream_popover__WEBPACK_IMPORTED_MODULE_36__.starred_messages_popped()) {
        _stream_popover__WEBPACK_IMPORTED_MODULE_36__.starred_messages_sidebar_menu_handle_keyboard(event_name);
        return true;
    }
    return false;
}

// Returns true if we handled it, false if the browser should.
function process_enter_key(e) {
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dropdown.open").length && jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).attr("role") === "menuitem") {
        // on #gear-menu li a[tabindex] elements, force a click and prevent default.
        // this is because these links do not have an href and so don't force a
        // default action.
        e.target.click();
        return true;
    }

    if (_hotspots__WEBPACK_IMPORTED_MODULE_17__.is_open()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).find(".hotspot.overlay.show .hotspot-confirm").trigger("click");
        return false;
    }

    if (_emoji_picker__WEBPACK_IMPORTED_MODULE_12__.reactions_popped()) {
        return _emoji_picker__WEBPACK_IMPORTED_MODULE_12__.navigate("enter", e);
    }

    if (handle_popover_events("enter")) {
        return true;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.settings_open()) {
        // On the settings page just let the browser handle
        // the Enter key for things like submitting forms.
        return false;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
        return false;
    }

    if (processing_text()) {
        if (_stream_list__WEBPACK_IMPORTED_MODULE_35__.searching()) {
            // This is sort of funny behavior, but I think
            // the intention is that we want it super easy
            // to close stream search.
            _stream_list__WEBPACK_IMPORTED_MODULE_35__.clear_and_hide_search();
            return true;
        }

        return false;
    }

    // This handles when pressing Enter while looking at drafts.
    // It restores draft that is focused.
    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.drafts_open()) {
        _drafts__WEBPACK_IMPORTED_MODULE_10__.drafts_handle_events(e, "enter");
        return true;
    }

    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).attr("role") === "button") {
        e.target.click();
        return true;
    }

    // All custom logic for overlays/modals is above; if we're in a
    // modal at this point, let the browser handle the event.
    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.is_modal_open()) {
        return false;
    }

    // If we're on a button or a link and have pressed Enter, let the
    // browser handle the keypress
    //
    // This is subtle and here's why: Suppose you have the focus on a
    // stream name in your left sidebar. j and k will still move your
    // cursor up and down, but Enter won't reply -- it'll just trigger
    // the link on the sidebar! So you keep pressing Enter over and
    // over again. Until you click somewhere or press r.
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("a:focus,button:focus").length > 0) {
        return false;
    }

    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#preview_message_area").is(":visible")) {
        _compose__WEBPACK_IMPORTED_MODULE_4__.enter_with_preview_open();
        return true;
    }

    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_32__.is_visible()) {
        if (e.target === jquery__WEBPACK_IMPORTED_MODULE_0___default()("body")[0]) {
            // There's a race when using `Esc` and `Enter` to navigate to
            // Recent Topics and then navigate to the next topic, wherein
            // Recent Topics won't have applied focus to its table yet.
            //
            // Recent Topics's own navigation just lets `Enter` be
            // treated as a click on the highlighted message, so we
            // don't need to do anything there. But if nothing is
            // focused (say, during the race or after clicking on the
            // sidebars, it's worth focusing the table so that hitting
            // `Enter` again will navigate you somewhere.
            const focus_changed = _recent_topics_ui__WEBPACK_IMPORTED_MODULE_31__.revive_current_focus();
            return focus_changed;
        }

        // Never fall through to opening the compose box to reply.
        return false;
    }

    // If we got this far, then we're presumably in the message
    // view, so in that case "Enter" is the hotkey to respond to a message.
    // Note that "r" has same effect, but that is handled in process_hotkey().
    _compose_actions__WEBPACK_IMPORTED_MODULE_5__.respond_to_message({trigger: "hotkey enter"});
    return true;
}

function process_ctrl_enter_key() {
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#preview_message_area").is(":visible")) {
        const ctrl_pressed = true;
        _compose__WEBPACK_IMPORTED_MODULE_4__.enter_with_preview_open(ctrl_pressed);
        return true;
    }

    return false;
}

function process_tab_key() {
    // Returns true if we handled it, false if the browser should.
    // TODO: See if browsers like Safari can now handle tabbing correctly
    // without our intervention.

    let $message_edit_form;

    const $focused_message_edit_content = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_edit_content:focus");
    if ($focused_message_edit_content.length > 0) {
        $message_edit_form = $focused_message_edit_content.closest(".message_edit_form");
        // Open message edit forms either have a save button or a close button, but not both.
        $message_edit_form.find(".message_edit_save,.message_edit_close").trigger("focus");
        return true;
    }

    const $focused_message_edit_save = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_edit_save:focus");
    if ($focused_message_edit_save.length > 0) {
        $message_edit_form = $focused_message_edit_save.closest(".message_edit_form");
        $message_edit_form.find(".message_edit_cancel").trigger("focus");
        return true;
    }

    if (_emoji_picker__WEBPACK_IMPORTED_MODULE_12__.reactions_popped()) {
        return _emoji_picker__WEBPACK_IMPORTED_MODULE_12__.navigate("tab");
    }

    return false;
}

function process_shift_tab_key() {
    // Returns true if we handled it, false if the browser should.
    // TODO: See if browsers like Safari can now handle tabbing correctly
    // without our intervention.

    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").is(":focus")) {
        // Shift-Tab: go back to content textarea and restore
        // cursor position.
        _ui__WEBPACK_IMPORTED_MODULE_39__.restore_compose_cursor();
        return true;
    }

    // Shift-Tabbing from the edit message cancel button takes you to save.
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_edit_cancel:focus").length > 0) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_edit_save").trigger("focus");
        return true;
    }

    // Shift-Tabbing from the edit message save button takes you to the content.
    const $focused_message_edit_save = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_edit_save:focus");
    if ($focused_message_edit_save.length > 0) {
        $focused_message_edit_save
            .closest(".message_edit_form")
            .find(".message_edit_content")
            .trigger("focus");
        return true;
    }

    // Shift-Tabbing from emoji catalog/search results takes you back to search textbox.
    if (_emoji_picker__WEBPACK_IMPORTED_MODULE_12__.reactions_popped()) {
        return _emoji_picker__WEBPACK_IMPORTED_MODULE_12__.navigate("shift_tab");
    }

    return false;
}

// Process a keydown or keypress event.
//
// Returns true if we handled it, false if the browser should.
function process_hotkey(e, hotkey) {
    const event_name = hotkey.name;

    // This block needs to be before the `Tab` handler.
    switch (event_name) {
        case "up_arrow":
        case "down_arrow":
        case "left_arrow":
        case "right_arrow":
        case "page_down":
        case "page_up":
        case "vim_up":
        case "vim_down":
        case "vim_left":
        case "vim_right":
        case "tab":
        case "shift_tab":
        case "open_recent_topics":
            if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_32__.is_in_focus()) {
                return _recent_topics_ui__WEBPACK_IMPORTED_MODULE_31__.change_focused_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target), event_name);
            }
    }

    // We handle the most complex keys in their own functions.
    switch (event_name) {
        case "escape":
            return process_escape_key(e);
        case "enter":
            return process_enter_key(e);
        case "ctrl_enter":
            return process_ctrl_enter_key(e);
        case "tab":
            return process_tab_key();
        case "shift_tab":
            return process_shift_tab_key();
    }

    // This block needs to be before the open modals check, because
    // the "user status" modal can show the emoji picker.
    if (_emoji_picker__WEBPACK_IMPORTED_MODULE_12__.reactions_popped()) {
        return _emoji_picker__WEBPACK_IMPORTED_MODULE_12__.navigate(event_name);
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.is_modal_open()) {
        return false;
    }

    // TODO: break out specific handlers for up_arrow,
    //       down_arrow, and backspace
    switch (event_name) {
        case "up_arrow":
        case "down_arrow":
        case "vim_up":
        case "vim_down":
        case "backspace":
        case "delete":
            if (_overlays__WEBPACK_IMPORTED_MODULE_27__.drafts_open()) {
                _drafts__WEBPACK_IMPORTED_MODULE_10__.drafts_handle_events(e, event_name);
                return true;
            }
    }

    if (hotkey.message_view_only && _overlays__WEBPACK_IMPORTED_MODULE_27__.is_active()) {
        if (processing_text()) {
            return false;
        }
        if (event_name === "narrow_by_topic" && _overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.keyboard_sub();
            return true;
        }
        if (event_name === "show_lightbox" && _overlays__WEBPACK_IMPORTED_MODULE_27__.lightbox_open()) {
            _overlays__WEBPACK_IMPORTED_MODULE_27__.close_overlay("lightbox");
            return true;
        }
        if (event_name === "open_drafts" && _overlays__WEBPACK_IMPORTED_MODULE_27__.drafts_open()) {
            _overlays__WEBPACK_IMPORTED_MODULE_27__.close_overlay("drafts");
            return true;
        }
        return false;
    }

    if (hotkey.message_view_only && _gear_menu__WEBPACK_IMPORTED_MODULE_14__.is_open()) {
        return false;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.settings_open() && !_popovers__WEBPACK_IMPORTED_MODULE_29__.user_info_popped()) {
        return false;
    }

    if (_hotspots__WEBPACK_IMPORTED_MODULE_17__.is_open()) {
        return false;
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.info_overlay_open()) {
        if (event_name === "show_shortcuts") {
            _overlays__WEBPACK_IMPORTED_MODULE_27__.close_active();
            return true;
        }
        return false;
    }

    if ((event_name === "up_arrow" || event_name === "down_arrow") && _overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
        return _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.switch_rows(event_name);
    }

    if (event_name === "up_arrow" && Object(function webpackMissingModule() { var e = new Error("Cannot find module './list_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './list_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e);
        return true;
    }

    if (event_name === "down_arrow" && Object(function webpackMissingModule() { var e = new Error("Cannot find module './list_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './list_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e);
        return true;
    }

    if (menu_dropdown_hotkeys.has(event_name) && handle_popover_events(event_name)) {
        return true;
    }

    // The next two sections date back to 00445c84 and are Mac/Chrome-specific,
    // and they should possibly be eliminated in favor of keeping standard
    // browser behavior.
    if (event_name === "backspace" && jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-send-button").is(":focus")) {
        // Ignore Backspace; don't navigate back a page.
        return true;
    }

    if (event_name === "narrow_to_compose_target") {
        _narrow__WEBPACK_IMPORTED_MODULE_25__.to_compose_target();
        return true;
    }

    // Process hotkeys specially when in an input, select, textarea, or send button
    if (processing_text()) {
        // Note that there is special handling for Enter/Esc too, but
        // we handle this in other functions.

        if (event_name === "left_arrow" && _compose_state__WEBPACK_IMPORTED_MODULE_6__.focus_in_empty_compose()) {
            _message_edit__WEBPACK_IMPORTED_MODULE_19__.edit_last_sent_message();
            return true;
        }

        if (
            (event_name === "up_arrow" ||
                event_name === "down_arrow" ||
                event_name === "page_up" ||
                event_name === "page_down" ||
                event_name === "home" ||
                event_name === "end") &&
            _compose_state__WEBPACK_IMPORTED_MODULE_6__.focus_in_empty_compose()
        ) {
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.cancel();
            // don't return, as we still want it to be picked up by the code below
        } else {
            switch (event_name) {
                case "page_up":
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(":focus").caret(0).animate({scrollTop: 0}, "fast");
                    return true;
                case "page_down": {
                    // so that it always goes to the end of the text box.
                    const height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(":focus")[0].scrollHeight;
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(":focus")
                        .caret(Number.POSITIVE_INFINITY)
                        .animate({scrollTop: height}, "fast");
                    return true;
                }
                case "search_with_k":
                    // Do nothing; this allows one to use Ctrl+K inside compose.
                    break;
                case "star_message":
                    // Do nothing; this allows one to use Ctrl+S inside compose.
                    break;
                default:
                    // Let the browser handle the key normally.
                    return false;
            }
        }
    }

    if (event_name === "left_arrow") {
        if (_overlays__WEBPACK_IMPORTED_MODULE_27__.lightbox_open()) {
            _lightbox__WEBPACK_IMPORTED_MODULE_18__.prev();
            return true;
        } else if (_overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.toggle_view(event_name);
            return true;
        }

        _message_edit__WEBPACK_IMPORTED_MODULE_19__.edit_last_sent_message();
        return true;
    }

    if (event_name === "right_arrow") {
        if (_overlays__WEBPACK_IMPORTED_MODULE_27__.lightbox_open()) {
            _lightbox__WEBPACK_IMPORTED_MODULE_18__.next();
            return true;
        } else if (_overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.toggle_view(event_name);
            return true;
        }
    }

    // Prevent navigation in the background when the overlays are active.
    if (_overlays__WEBPACK_IMPORTED_MODULE_27__.is_overlay_or_modal_open()) {
        if (event_name === "view_selected_stream" && _overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open()) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.view_stream();
            return true;
        }
        if (
            event_name === "n_key" &&
            _overlays__WEBPACK_IMPORTED_MODULE_27__.streams_open() &&
            (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())())
        ) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_37__.open_create_stream();
            return true;
        }
        return false;
    }

    // Shortcuts that don't require a message
    switch (event_name) {
        case "narrow_private":
            return do_narrow_action((target, opts) => {
                _narrow__WEBPACK_IMPORTED_MODULE_25__.by("is", "private", opts);
            });
        case "query_streams":
            _stream_list__WEBPACK_IMPORTED_MODULE_35__.initiate_search();
            return true;
        case "query_users":
            _activity__WEBPACK_IMPORTED_MODULE_1__.initiate_search();
            return true;
        case "search":
        case "search_with_k":
            _search__WEBPACK_IMPORTED_MODULE_33__.initiate_search();
            return true;
        case "gear_menu":
            _gear_menu__WEBPACK_IMPORTED_MODULE_14__.open();
            return true;
        case "show_shortcuts": // Show keyboard shortcuts page
            _browser_history__WEBPACK_IMPORTED_MODULE_2__.go_to_location("keyboard-shortcuts");
            return true;
        case "stream_cycle_backward":
            _narrow__WEBPACK_IMPORTED_MODULE_25__.stream_cycle_backward();
            return true;
        case "stream_cycle_forward":
            _narrow__WEBPACK_IMPORTED_MODULE_25__.stream_cycle_forward();
            return true;
        case "n_key":
            _narrow__WEBPACK_IMPORTED_MODULE_25__.narrow_to_next_topic();
            return true;
        case "p_key":
            _narrow__WEBPACK_IMPORTED_MODULE_25__.narrow_to_next_pm_string();
            return true;
        case "open_recent_topics":
            _browser_history__WEBPACK_IMPORTED_MODULE_2__.go_to_location("#recent");
            return true;
        case "all_messages":
            _browser_history__WEBPACK_IMPORTED_MODULE_2__.go_to_location("#all_messages");
            return true;
    }

    // Shortcuts that are useful with an empty message feed, like opening compose.
    switch (event_name) {
        case "reply_message": // 'r': respond to message
            // Note that you can "Enter" to respond to messages as well,
            // but that is handled in process_enter_key().
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.respond_to_message({trigger: "hotkey"});
            return true;
        case "compose": // 'c': compose
            if (!_compose_state__WEBPACK_IMPORTED_MODULE_6__.composing()) {
                _compose_actions__WEBPACK_IMPORTED_MODULE_5__.start("stream", {trigger: "compose_hotkey"});
            }
            return true;
        case "compose_private_message":
            if (!_compose_state__WEBPACK_IMPORTED_MODULE_6__.composing()) {
                _compose_actions__WEBPACK_IMPORTED_MODULE_5__.start("private", {trigger: "compose_hotkey"});
            }
            return true;
        case "open_drafts":
            _browser_history__WEBPACK_IMPORTED_MODULE_2__.go_to_location("drafts");
            return true;
        case "C_deprecated":
            _deprecated_feature_notice__WEBPACK_IMPORTED_MODULE_9__.maybe_show_deprecation_notice("C");
            return true;
        case "star_deprecated":
            _deprecated_feature_notice__WEBPACK_IMPORTED_MODULE_9__.maybe_show_deprecation_notice("*");
            return true;
    }

    // We don't want hotkeys below this to work when recent topics is
    // open. These involve hotkeys that can only be performed on a message.
    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_32__.is_visible()) {
        return false;
    }

    if (_message_lists__WEBPACK_IMPORTED_MODULE_21__.current.empty()) {
        return false;
    }

    // Shortcuts for navigation and other applications that require a
    // nonempty message feed but do not depend on the selected message.
    switch (event_name) {
        case "down_arrow":
        case "vim_down":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.down(true); // with_centering
            return true;
        case "up_arrow":
        case "vim_up":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.up();
            return true;
        case "home":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.to_home();
            return true;
        case "end":
        case "G_end":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.to_end();
            return true;
        case "page_up":
        case "vim_page_up":
        case "shift_spacebar":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.page_up();
            return true;
        case "page_down":
        case "vim_page_down":
        case "spacebar":
            _message_scroll__WEBPACK_IMPORTED_MODULE_22__.mark_keyboard_triggered_current_scroll();
            _navigate__WEBPACK_IMPORTED_MODULE_26__.page_down();
            return true;
        case "copy_with_c":
            _copy_and_paste__WEBPACK_IMPORTED_MODULE_8__.copy_handler();
            return true;
    }

    if (
        // Allow UI only features for spectators which they can perform.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        !["narrow_by_topic", "narrow_by_recipient", "show_lightbox", "show_sender_info"].includes(
            event_name,
        )
    ) {
        _spectators__WEBPACK_IMPORTED_MODULE_34__.login_to_access();
        return true;
    }

    const msg = _message_lists__WEBPACK_IMPORTED_MODULE_21__.current.selected_message();
    // Shortcuts that operate on a message
    switch (event_name) {
        case "message_actions":
            return _popover_menus__WEBPACK_IMPORTED_MODULE_28__.toggle_message_actions_menu(msg);
        case "star_message":
            _message_flags__WEBPACK_IMPORTED_MODULE_20__.toggle_starred_and_update_server(msg);
            return true;
        case "narrow_by_recipient":
            return do_narrow_action(_narrow__WEBPACK_IMPORTED_MODULE_25__.by_recipient);
        case "narrow_by_topic":
            return do_narrow_action(_narrow__WEBPACK_IMPORTED_MODULE_25__.by_topic);
        case "respond_to_author": // 'R': respond to author
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.respond_to_message({reply_type: "personal", trigger: "hotkey pm"});
            return true;
        case "compose_reply_with_mention": // '@': respond to message with mention to author
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.reply_with_mention({trigger: "hotkey"});
            return true;
        case "show_lightbox":
            _lightbox__WEBPACK_IMPORTED_MODULE_18__.show_from_selected_message();
            return true;
        case "show_sender_info":
            _popovers__WEBPACK_IMPORTED_MODULE_29__.show_sender_info();
            return true;
        case "toggle_reactions_popover": // ':': open reactions to message
            _reactions__WEBPACK_IMPORTED_MODULE_30__.open_reactions_popover();
            return true;
        case "thumbs_up_emoji": {
            // '+': reacts with thumbs up emoji on selected message
            // Use canonical name.
            const thumbs_up_emoji_code = "1f44d";
            const canonical_name = _emoji__WEBPACK_IMPORTED_MODULE_11__.get_emoji_name(thumbs_up_emoji_code);
            _reactions__WEBPACK_IMPORTED_MODULE_30__.toggle_emoji_reaction(msg.id, canonical_name);
            return true;
        }
        case "toggle_topic_mute":
            _muted_topics_ui__WEBPACK_IMPORTED_MODULE_24__.toggle_topic_mute(msg);
            return true;
        case "toggle_message_collapse":
            _condense__WEBPACK_IMPORTED_MODULE_7__.toggle_collapse(msg);
            return true;
        case "mark_unread":
            _unread_ops__WEBPACK_IMPORTED_MODULE_40__.mark_as_unread_from_here(msg.id);
            return true;
        case "compose_quote_reply": // > : respond to selected message with quote
            _compose_actions__WEBPACK_IMPORTED_MODULE_5__.quote_and_reply({trigger: "hotkey"});
            return true;
        case "edit_message": {
            const $row = _message_lists__WEBPACK_IMPORTED_MODULE_21__.current.get_row(msg.id);
            _message_edit__WEBPACK_IMPORTED_MODULE_19__.start($row);
            return true;
        }
        case "move_message": {
            if (!_message_edit__WEBPACK_IMPORTED_MODULE_19__.can_move_message(msg)) {
                return false;
            }

            _stream_popover__WEBPACK_IMPORTED_MODULE_36__.build_move_topic_to_stream_popover(msg.stream_id, msg.topic, msg);
            return true;
        }
    }

    return false;
}

/* We register both a keydown and a keypress function because
   we want to intercept PgUp/PgDn, Esc, etc, and process them
   as they happen on the keyboard. However, if we processed
   letters/numbers in keydown, we wouldn't know what the case of
   the letters were.

   We want case-sensitive hotkeys (such as in the case of r vs R)
   so we bail in .keydown if the event is a letter or number and
   instead just let keypress go for it. */

function process_keydown(e) {
    _activity__WEBPACK_IMPORTED_MODULE_1__.set_new_user_input(true);
    const hotkey = get_keydown_hotkey(e);
    if (!hotkey) {
        return false;
    }
    return process_hotkey(e, hotkey);
}

function process_keypress(e) {
    const hotkey = get_keypress_hotkey(e);
    if (!hotkey) {
        return false;
    }
    return process_hotkey(e, hotkey);
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("keydown", (e) => {
        if (process_keydown(e)) {
            e.preventDefault();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("keypress", (e) => {
        if (process_keypress(e)) {
            e.preventDefault();
        }
    });
}


/***/ }),

/***/ "./static/js/hotspots.js":
/*!*******************************!*\
  !*** ./static/js/hotspots.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "close_hotspot_icon": () => (/* binding */ close_hotspot_icon),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_open": () => (/* binding */ is_open),
/* harmony export */   "load_new": () => (/* binding */ load_new),
/* harmony export */   "post_hotspot_as_read": () => (/* binding */ post_hotspot_as_read)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_hotspot_icon_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/hotspot_icon.hbs */ "./static/templates/hotspot_icon.hbs");
/* harmony import */ var _templates_hotspot_icon_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_hotspot_icon_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_hotspot_overlay_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/hotspot_overlay.hbs */ "./static/templates/hotspot_overlay.hbs");
/* harmony import */ var _templates_hotspot_overlay_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_hotspot_overlay_hbs__WEBPACK_IMPORTED_MODULE_3__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");











// popover orientations
const TOP = "top";
const LEFT = "left";
const RIGHT = "right";
const BOTTOM = "bottom";
const LEFT_BOTTOM = "left_bottom";
const VIEWPORT_CENTER = "viewport_center";

// popover orientation can optionally be fixed here (property: popover),
// otherwise popovers.compute_placement is used to compute orientation
const HOTSPOT_LOCATIONS = new Map([
    [
        "intro_streams",
        {
            element: "#streams_header .sidebar-title",
            offset_x: 1.35,
            offset_y: 0.39,
        },
    ],
    [
        "intro_topics",
        {
            element: ".topic-name",
            offset_x: 0.8,
            offset_y: 0.39,
        },
    ],
    [
        "intro_gear",
        {
            element: "#settings-dropdown",
            offset_x: -0.4,
            offset_y: 1.2,
            popover: LEFT_BOTTOM,
        },
    ],
    [
        "intro_compose",
        {
            element: "#left_bar_compose_stream_button_big",
            offset_x: 0,
            offset_y: 0,
        },
    ],
]);

// popover illustration url(s)
const WHALE = "/static/images/hotspots/whale.svg";

function post_hotspot_as_read(hotspot_name) {
    _channel__WEBPACK_IMPORTED_MODULE_5__.post({
        url: "/json/users/me/hotspots",
        data: {hotspot: hotspot_name},
        error(err) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(err.responseText);
        },
    });
}

function place_icon(hotspot) {
    const $element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(hotspot.location.element);
    const $icon = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#hotspot_${CSS.escape(hotspot.name)}_icon`);

    if (
        $element.length === 0 ||
        $element.css("display") === "none" ||
        !$element.is(":visible") ||
        $element.is(":hidden")
    ) {
        $icon.css("display", "none");
        return false;
    }

    const offset = {
        top: $element.outerHeight() * hotspot.location.offset_y,
        left: $element.outerWidth() * hotspot.location.offset_x,
    };
    const client_rect = $element.get(0).getBoundingClientRect();
    const placement = {
        top: client_rect.top + offset.top,
        left: client_rect.left + offset.left,
    };
    $icon.css("display", "block");
    $icon.css(placement);
    return true;
}

function place_popover(hotspot) {
    if (!hotspot.location.element) {
        return;
    }

    const popover_width = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#hotspot_${CSS.escape(hotspot.name)}_overlay .hotspot-popover`,
    ).outerWidth();
    const popover_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#hotspot_${CSS.escape(hotspot.name)}_overlay .hotspot-popover`,
    ).outerHeight();
    const el_width = jquery__WEBPACK_IMPORTED_MODULE_0___default()(hotspot.location.element).outerWidth();
    const el_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(hotspot.location.element).outerHeight();
    const arrow_offset = 20;

    let popover_offset;
    let arrow_placement;
    const orientation =
        hotspot.location.popover ||
        _popovers__WEBPACK_IMPORTED_MODULE_6__.compute_placement(
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(hotspot.location.element),
            popover_height,
            popover_width,
            false,
        );

    switch (orientation) {
        case TOP:
            popover_offset = {
                top: -(popover_height + arrow_offset),
                left: el_width / 2 - popover_width / 2,
            };
            arrow_placement = "bottom";
            break;

        case LEFT:
            popover_offset = {
                top: el_height / 2 - popover_height / 2,
                left: -(popover_width + arrow_offset),
            };
            arrow_placement = "right";
            break;

        case BOTTOM:
            popover_offset = {
                top: el_height + arrow_offset,
                left: el_width / 2 - popover_width / 2,
            };
            arrow_placement = "top";
            break;

        case RIGHT:
            popover_offset = {
                top: el_height / 2 - popover_height / 2,
                left: el_width + arrow_offset,
            };
            arrow_placement = "left";
            break;

        case LEFT_BOTTOM:
            popover_offset = {
                top: 0,
                left: -(popover_width + arrow_offset / 2),
            };
            arrow_placement = "";
            break;

        case VIEWPORT_CENTER:
            popover_offset = {
                top: el_height / 2,
                left: el_width / 2,
            };
            arrow_placement = "";
            break;

        default:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid popover placement value for hotspot '" + hotspot.name + "'");
            break;
    }

    // position arrow
    arrow_placement = "arrow-" + arrow_placement;
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#hotspot_${CSS.escape(hotspot.name)}_overlay .hotspot-popover`)
        .removeClass("arrow-top arrow-left arrow-bottom arrow-right")
        .addClass(arrow_placement);

    // position popover
    let popover_placement;
    if (orientation === VIEWPORT_CENTER) {
        popover_placement = {
            top: "45%",
            left: "50%",
            transform: "translate(-50%, -50%)",
        };
    } else {
        const client_rect = jquery__WEBPACK_IMPORTED_MODULE_0___default()(hotspot.location.element).get(0).getBoundingClientRect();
        popover_placement = {
            top: client_rect.top + popover_offset.top,
            left: client_rect.left + popover_offset.left,
            transform: "",
        };
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#hotspot_${CSS.escape(hotspot.name)}_overlay .hotspot-popover`).css(popover_placement);
}

function insert_hotspot_into_DOM(hotspot) {
    const hotspot_overlay_HTML = _templates_hotspot_overlay_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        name: hotspot.name,
        title: hotspot.title,
        description: hotspot.description,
        img: WHALE,
    });

    const hotspot_icon_HTML = _templates_hotspot_icon_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        name: hotspot.name,
    });

    setTimeout(() => {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").prepend(hotspot_icon_HTML);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").prepend(hotspot_overlay_HTML);
        if (place_icon(hotspot)) {
            place_popover(hotspot);
        }

        // reposition on any event that might update the UI
        for (const event_name of ["resize", "scroll", "onkeydown", "click"]) {
            window.addEventListener(
                event_name,
                lodash__WEBPACK_IMPORTED_MODULE_1___default().debounce(() => {
                    if (place_icon(hotspot)) {
                        place_popover(hotspot);
                    }
                }, 10),
                true,
            );
        }
    }, hotspot.delay * 1000);
}

function is_open() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".hotspot.overlay").hasClass("show");
}

function close_hotspot_icon(elem) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).animate(
        {opacity: 0},
        {
            duration: 300,
            done: function () {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).css({display: "none"});
            }.bind(elem),
        },
    );
}

function close_read_hotspots(new_hotspots) {
    const unwanted_hotspots = lodash__WEBPACK_IMPORTED_MODULE_1___default().difference(
        Array.from(HOTSPOT_LOCATIONS.keys()),
        new_hotspots.map((hotspot) => hotspot.name),
    );

    for (const hotspot_name of unwanted_hotspots) {
        close_hotspot_icon(jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#hotspot_${CSS.escape(hotspot_name)}_icon`));
    }
}

function load_new(new_hotspots) {
    close_read_hotspots(new_hotspots);
    for (const hotspot of new_hotspots) {
        hotspot.location = HOTSPOT_LOCATIONS.get(hotspot.name);
        insert_hotspot_into_DOM(hotspot);
    }
}

function initialize() {
    load_new(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}


/***/ }),

/***/ "./static/js/huddle_data.js":
/*!**********************************!*\
  !*** ./static/js/huddle_data.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "get_huddles": () => (/* binding */ get_huddles),
/* harmony export */   "process_loaded_messages": () => (/* binding */ process_loaded_messages)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");




const huddle_timestamps = new Map();

function clear_for_testing() {
    huddle_timestamps.clear();
}

function process_loaded_messages(messages) {
    for (const message of messages) {
        const huddle_string = _people__WEBPACK_IMPORTED_MODULE_1__.huddle_string(message);

        if (huddle_string) {
            const old_timestamp = huddle_timestamps.get(huddle_string);

            if (!old_timestamp || old_timestamp < message.timestamp) {
                huddle_timestamps.set(huddle_string, message.timestamp);
            }
        }
    }
}

function get_huddles() {
    let huddles = Array.from(huddle_timestamps.keys());
    huddles = lodash__WEBPACK_IMPORTED_MODULE_0___default().sortBy(huddles, (huddle) => huddle_timestamps.get(huddle));
    return huddles.reverse();
}


/***/ }),

/***/ "./static/js/info_overlay.js":
/*!***********************************!*\
  !*** ./static/js/info_overlay.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "set_up_toggler": () => (/* binding */ set_up_toggler),
/* harmony export */   "show": () => (/* binding */ show),
/* harmony export */   "toggler": () => (/* binding */ toggler)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_keyboard_shortcuts_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/keyboard_shortcuts.hbs */ "./static/templates/keyboard_shortcuts.hbs");
/* harmony import */ var _templates_keyboard_shortcuts_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_keyboard_shortcuts_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_markdown_help_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/markdown_help.hbs */ "./static/templates/markdown_help.hbs");
/* harmony import */ var _templates_markdown_help_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_markdown_help_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_search_operators_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/search_operators.hbs */ "./static/templates/search_operators.hbs");
/* harmony import */ var _templates_search_operators_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_search_operators_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


















// Make it explicit that our toggler is undefined until
// set_up_toggler is called.
let toggler;

const markdown_help_rows = [
    {
        markdown: "*italic*",
        usage_html: "(or <kbd>Ctrl</kbd>+<kbd>I</kbd>)",
    },
    {
        markdown: "**bold**",
        usage_html: "(or <kbd>Ctrl</kbd>+<kbd>B</kbd>)",
    },
    {
        markdown: "~~strikethrough~~",
    },
    {
        markdown: "[Zulip website](https://zulip.org)",
        usage_html: "(or <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>L</kbd>)",
    },
    {
        markdown: `\
* Milk
* Tea
  * Green tea
  * Black tea
  * Oolong tea
* Coffee`,
    },
    {
        markdown: `\
1. Milk
1. Tea
1. Coffee`,
    },
    {
        markdown: ":heart:",
        usage_html:
            '(and <a href="https://www.webfx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener noreferrer">many others</a>, from the <a href="https://code.google.com/p/noto/" target="_blank" rel="noopener noreferrer">Noto Project</a>)',
    },
    {
        markdown: "@**Joe Smith**",
        usage_html: "(autocompletes from @joe)",
        output_html: '<p><span class="user-mention">@Joe Smith</span></p>',
        effect_html: "(notifies Joe Smith)",
    },
    {
        markdown: "@_**Joe Smith**",
        usage_html: "(autocompletes from @_joe)",
        output_html: '<p><span class="user-mention">Joe Smith</span></p>',
        effect_html: "(links to profile but doesn't notify Joe Smith)",
    },
    {
        markdown: "@**all**",
        effect_html: "(notifies all recipients)",
    },
    {
        markdown: "#**streamName**",
        output_html: "<p><a>#streamName</a></p>",
        effect_html: "(links to a stream)",
    },
    {
        markdown: "/me is busy working",
        output_html: '<p><span class="sender_name-in-status">Iago</span> is busy working</p>',
    },
    {
        markdown: `/poll What did you drink this morning?
Milk
Tea
Coffee`,
        output_html: `\
<div class="poll-widget">
    <h4 class="poll-question-header reduced-font-size">What did you drink this morning?</h4>
    <i class="fa fa-pencil poll-edit-question"></i>
    <ul class="poll-widget">
    <li>
        <button class="poll-vote">
            0
        </button>
        <span>Milk</span>
    </li>
    <li>
        <button class="poll-vote">
            0
        </button>
        <span>Tea</span>
    </li>
    <li>
        <button class="poll-vote">
            0
        </button>
        <span>Coffee</span>
    </li>
    </ul>
</div>
`,
    },
    {
        markdown: "Some inline `code`",
    },
    {
        markdown: `\
\`\`\`
def zulip():
    print "Zulip"
\`\`\``,
    },
    {
        markdown: `\
\`\`\`python
def zulip():
    print "Zulip"
\`\`\``,
        output_html: `\
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">zulip</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"Zulip"</span></pre></div>`,
    },
    {
        note_html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {
                defaultMessage:
                    "To add syntax highlighting to a multi-line code block, add the language's <b>first</b> <z-link>Pygments short name</z-link> after the first set of back-ticks. You can also make a code block by indenting each line with 4 spaces.",
            },
            {
                "z-link": (content_html) =>
                    `<a target="_blank" rel="noopener noreferrer" href="https://pygments.org/docs/lexers/">${content_html.join(
                        "",
                    )}</a>`,
            },
        ),
    },
    {
        markdown: "> Quoted",
    },
    {
        markdown: `\
\`\`\`quote
Quoted block
\`\`\``,
    },
    {
        markdown: `\
\`\`\`spoiler Always visible heading
This text won't be visible until the user clicks.
\`\`\``,
    },
    {
        markdown: "Some inline math $$ e^{i \\pi} + 1 = 0 $$",
    },
    {
        markdown: `\
\`\`\`math
\\int_{0}^{1} f(x) dx
\`\`\``,
    },
    {
        note_html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {
                defaultMessage:
                    "You can also make <z-link>tables</z-link> with this <z-link>Markdown-ish table syntax</z-link>.",
            },
            {
                "z-link": (content_html) =>
                    `<a target="_blank" rel="noopener noreferrer" href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#wiki-tables">${content_html.join(
                        "",
                    )}</a>`,
            },
        ),
    },
];

function set_up_toggler() {
    for (const row of markdown_help_rows) {
        if (row.markdown && !row.output_html) {
            const message = {raw_content: row.markdown};
            _markdown__WEBPACK_IMPORTED_MODULE_6__.apply_markdown(message);
            row.output_html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message.content);
        }
    }

    const $markdown_help = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_markdown_help_hbs__WEBPACK_IMPORTED_MODULE_2___default()({markdown_help_rows}));
    $markdown_help.find(".rendered_markdown").each(function () {
        _rendered_markdown__WEBPACK_IMPORTED_MODULE_8__.update_elements(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this));
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".informational-overlays .overlay-body").append($markdown_help);

    const $search_operators = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_search_operators_hbs__WEBPACK_IMPORTED_MODULE_3___default()());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".informational-overlays .overlay-body").append($search_operators);

    const $keyboard_shortcuts = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_keyboard_shortcuts_hbs__WEBPACK_IMPORTED_MODULE_1___default()());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".informational-overlays .overlay-body").append($keyboard_shortcuts);

    const opts = {
        selected: 0,
        child_wants_focus: true,
        values: [
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Keyboard shortcuts"}), key: "keyboard-shortcuts"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Message formatting"}), key: "message-formatting"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Search filters"}), key: "search-operators"},
        ],
        callback(name, key) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".overlay-modal").hide();
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(key)}`).show();
            _ui__WEBPACK_IMPORTED_MODULE_9__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(key)}`).find(".modal-body")).trigger("focus");
        },
    };

    toggler = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(opts);
    const $elem = toggler.get();
    $elem.addClass("large allow-overflow");

    const modals = opts.values.map((item) => {
        const key = item.key; // e.g. message-formatting
        const $modal = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(key)}`).find(".modal-body");
        return $modal;
    });

    for (const $modal of modals) {
        _ui__WEBPACK_IMPORTED_MODULE_9__.get_scroll_element($modal).prop("tabindex", 0);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            $elem: $modal,
            handlers: {
                ArrowLeft: toggler.maybe_go_left,
                ArrowRight: toggler.maybe_go_right,
            },
        });
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".informational-overlays .overlay-tabs").append($elem);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#go-to-default-view-hotkey-help").toggleClass(
        "notdisplayed",
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(".hotkeys_table .hotkey kbd");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("#markdown-instructions kbd");
}

function show(target) {
    if (!toggler) {
        set_up_toggler();
    }

    const $overlay = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".informational-overlays");

    if (!$overlay.hasClass("show")) {
        _overlays__WEBPACK_IMPORTED_MODULE_7__.open_overlay({
            name: "informationalOverlays",
            $overlay,
            on_close() {
                _browser_history__WEBPACK_IMPORTED_MODULE_4__.exit_overlay();
            },
        });
    }

    if (target) {
        toggler.goto(target);
    }
}


/***/ }),

/***/ "./static/js/input_pill.js":
/*!*********************************!*\
  !*** ./static/js/input_pill.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "create": () => (/* binding */ create)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_input_pill_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/input_pill.hbs */ "./static/templates/input_pill.hbs");
/* harmony import */ var _templates_input_pill_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_input_pill_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
// todo: Refactor pills subsystem to use modern javascript classes?










// See https://zulip.readthedocs.io/en/latest/subsystems/input-pills.html

function create(opts) {
    if (!opts.$container) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Pill needs container.");
        return undefined;
    }

    if (!opts.create_item_from_text) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Pill needs create_item_from_text");
        return undefined;
    }

    if (!opts.get_text_from_item) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Pill needs get_text_from_item");
        return undefined;
    }

    // a stateful object of this `pill_container` instance.
    // all unique instance information is stored in here.
    const store = {
        pills: [],
        pill_config: opts.pill_config,
        $parent: opts.$container,
        $input: opts.$container.find(".input").expectOne(),
        create_item_from_text: opts.create_item_from_text,
        get_text_from_item: opts.get_text_from_item,
    };

    // a dictionary of internal functions. Some of these are exposed as well,
    // and nothing in here should be assumed to be private (due to the passing)
    // of the `this` arg in the `Function.prototype.bind` use in the prototype.
    const funcs = {
        // return the value of the contenteditable input form.
        value(input_elem) {
            return input_elem.textContent;
        },

        // clear the value of the input form.
        clear(input_elem) {
            input_elem.textContent = "";
        },

        clear_text() {
            store.$input.text("");
        },

        is_pending() {
            // This function returns true if we have text
            // in out widget that hasn't been turned into
            // pills.  We use it to decide things like
            // whether we're ready to send typing indicators.
            return store.$input.text().trim() !== "";
        },

        create_item(text) {
            const existing_items = funcs.items();
            const item = store.create_item_from_text(text, existing_items);

            if (!item || !item.display_value) {
                store.$input.addClass("shake");
                return undefined;
            }

            return item;
        },

        // This is generally called by typeahead logic, where we have all
        // the data we need (as opposed to, say, just a user-typed email).
        appendValidatedData(item) {
            if (!item.display_value) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("no display_value returned");
                return;
            }

            if (!item.type) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("no type defined for the item");
                return;
            }

            const payload = {
                item,
            };

            store.pills.push(payload);

            const has_image = item.img_src !== undefined;

            const opts = {
                display_value: item.display_value,
                has_image,
                deactivated: item.deactivated,
            };

            if (has_image) {
                opts.img_src = item.img_src;
            }

            if (store.pill_config?.show_user_status_emoji === true) {
                const has_status = item.status_emoji_info !== undefined;
                if (has_status) {
                    opts.status_emoji_info = item.status_emoji_info;
                }
                opts.has_status = has_status;
            }

            if (typeof store.onPillCreate === "function") {
                store.onPillCreate();
            }

            const pill_html = _templates_input_pill_hbs__WEBPACK_IMPORTED_MODULE_1___default()(opts);
            payload.$element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(pill_html);
            store.$input.before(payload.$element);
        },

        // this appends a pill to the end of the container but before the
        // input block.
        appendPill(value) {
            if (value.length === 0) {
                return true;
            }
            if (value.match(",")) {
                funcs.insertManyPills(value);
                return false;
            }

            const payload = this.create_item(value);
            // if the pill object is undefined, then it means the pill was
            // rejected so we should return out of this.
            if (!payload) {
                return false;
            }

            this.appendValidatedData(payload);
            return true;
        },

        // this searches given the DOM node for a pill, removes the node
        // from the DOM, removes it from the array and returns it.
        // this would generally be used for DOM-provoked actions, such as a user
        // clicking on a pill to remove it.
        removePill(element) {
            let idx;
            for (let x = 0; x < store.pills.length; x += 1) {
                if (store.pills[x].$element[0] === element) {
                    idx = x;
                }
            }

            if (typeof idx === "number") {
                store.pills[idx].$element.remove();
                const pill = store.pills.splice(idx, 1);
                if (typeof store.removePillFunction === "function") {
                    store.removePillFunction(pill);
                }

                return pill;
            }

            /* istanbul ignore next */
            return undefined;
        },

        // this will remove the last pill in the container -- by default tied
        // to the "Backspace" key when the value of the input is empty.
        // If quiet is a truthy value, the event handler associated with the
        // pill will not be evaluated. This is useful when using clear to reset
        // the pills.
        removeLastPill(quiet) {
            const pill = store.pills.pop();

            if (pill) {
                pill.$element.remove();
                if (!quiet && typeof store.removePillFunction === "function") {
                    store.removePillFunction(pill);
                }
            }
        },

        removeAllPills(quiet) {
            while (store.pills.length > 0) {
                this.removeLastPill(quiet);
            }

            this.clear(store.$input[0]);
        },

        insertManyPills(pills) {
            if (typeof pills === "string") {
                pills = pills.split(/,/g).map((pill) => pill.trim());
            }

            // this is an array to push all the errored values to, so it's drafts
            // of pills for the user to fix.
            const drafts = pills.filter(
                (pill) =>
                    // if this returns `false`, it errored and we should push it to
                    // the draft pills.
                    funcs.appendPill(pill) === false,
            );

            store.$input.text(drafts.join(", "));
            // when using the `text` insertion feature with jQuery the caret is
            // placed at the beginning of the input field, so this moves it to
            // the end.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(store.$input[0]);

            // this sends a flag if the operation wasn't completely successful,
            // which in this case is defined as some of the pills not autofilling
            // correctly.
            return drafts.length === 0;
        },

        getByElement(element) {
            return store.pills.find((pill) => pill.$element[0] === element);
        },

        _get_pills_for_testing() {
            return store.pills;
        },

        items() {
            return store.pills.map((pill) => pill.item);
        },

        createPillonPaste() {
            if (typeof store.createPillonPaste === "function") {
                return store.createPillonPaste();
            }
            return true;
        },
    };

    {
        store.$parent.on("keydown", ".input", (e) => {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                // regardless of the value of the input, the ENTER keyword
                // should be ignored in favor of keeping content to one line
                // always.
                e.preventDefault();

                // if there is input, grab the input, make a pill from it,
                // and append the pill, then clear the input.
                const value = funcs.value(e.target).trim();
                if (value.length > 0) {
                    // append the pill and by proxy create the pill object.
                    const ret = funcs.appendPill(value);

                    // if the pill to append was rejected, no need to clear the
                    // input; it may have just been a typo or something close but
                    // incorrect.
                    if (ret !== false) {
                        // clear the input.
                        funcs.clear(e.target);
                        e.stopPropagation();
                    }
                }

                return;
            }

            // if the user backspaces and there is input, just do normal char
            // deletion, otherwise delete the last pill in the sequence.
            if (
                e.key === "Backspace" &&
                (funcs.value(e.target).length === 0 || window.getSelection().anchorOffset === 0)
            ) {
                e.preventDefault();
                funcs.removeLastPill();

                return;
            }

            // if one is on the ".input" element and back/left arrows, then it
            // should switch to focus the last pill in the list.
            // the rest of the events then will be taken care of in the function
            // below that handles events on the ".pill" class.
            if (e.key === "ArrowLeft" && window.getSelection().anchorOffset === 0) {
                store.$parent.find(".pill").last().trigger("focus");
            }

            // Typing of the comma is prevented if the last field doesn't validate,
            // as well as when the new pill is created.
            if (e.key === ",") {
                // if the pill is successful, it will create the pill and clear
                // the input.
                if (funcs.appendPill(store.$input.text().trim()) !== false) {
                    funcs.clear(store.$input[0]);
                }
                e.preventDefault();

                return;
            }
        });

        // handle events while hovering on ".pill" elements.
        // the three primary events are next, previous, and delete.
        store.$parent.on("keydown", ".pill", (e) => {
            const $pill = store.$parent.find(".pill:focus");

            switch (e.key) {
                case "ArrowLeft":
                    $pill.prev().trigger("focus");
                    break;
                case "ArrowRight":
                    $pill.next().trigger("focus");
                    break;
                case "Backspace": {
                    const $next = $pill.next();
                    funcs.removePill($pill[0]);
                    $next.trigger("focus");
                    // the "Backspace" key in Firefox will go back a page if you do
                    // not prevent it.
                    e.preventDefault();
                    break;
                }
            }
        });

        // when the shake animation is applied to the ".input" on invalid input,
        // we want to remove the class when finished automatically.
        store.$parent.on("animationend", ".input", function () {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).removeClass("shake");
        });

        // replace formatted input with plaintext to allow for sane copy-paste
        // actions.
        store.$parent.on("paste", ".input", (e) => {
            e.preventDefault();

            // get text representation of clipboard
            const text = (e.originalEvent || e).clipboardData.getData("text/plain");

            // insert text manually
            document.execCommand("insertText", false, text);

            if (funcs.createPillonPaste()) {
                funcs.insertManyPills(store.$input.text().trim());
            }
        });

        // when the "×" is clicked on a pill, it should delete that pill and then
        // select the next pill (or input).
        store.$parent.on("click", ".exit", function (e) {
            e.stopPropagation();
            const $pill = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".pill");
            const $next = $pill.next();

            funcs.removePill($pill[0]);
            $next.trigger("focus");

            _compose__WEBPACK_IMPORTED_MODULE_3__.update_on_recipient_change();
        });

        store.$parent.on("click", function (e) {
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(".pill-container")) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).find(".input").trigger("focus");
            }
        });

        store.$parent.on("copy", ".pill", (e) => {
            const $element = store.$parent.find(":focus");
            const data = funcs.getByElement($element[0]);
            e.originalEvent.clipboardData.setData(
                "text/plain",
                store.get_text_from_item(data.item),
            );
            e.preventDefault();
        });
    }

    // the external, user-accessible prototype.
    const prototype = {
        appendValue: funcs.appendPill.bind(funcs),
        appendValidatedData: funcs.appendValidatedData.bind(funcs),

        getByElement: funcs.getByElement,
        items: funcs.items,

        onPillCreate(callback) {
            store.onPillCreate = callback;
        },

        onPillRemove(callback) {
            store.removePillFunction = callback;
        },

        createPillonPaste(callback) {
            store.createPillonPaste = callback;
        },

        clear: funcs.removeAllPills.bind(funcs),
        clear_text: funcs.clear_text,
        is_pending: funcs.is_pending,
        _get_pills_for_testing: funcs._get_pills_for_testing,
    };

    return prototype;
}


/***/ }),

/***/ "./static/js/invite.js":
/*!*****************************!*\
  !*** ./static/js/invite.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_invite_streams": () => (/* binding */ get_invite_streams),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch": () => (/* binding */ launch)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/add/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_copy_invite_link_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/copy_invite_link.hbs */ "./static/templates/copy_invite_link.hbs");
/* harmony import */ var _templates_copy_invite_link_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_copy_invite_link_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_invitation_failed_error_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/invitation_failed_error.hbs */ "./static/templates/invitation_failed_error.hbs");
/* harmony import */ var _templates_invitation_failed_error_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_invitation_failed_error_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_invite_subscription_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/invite_subscription.hbs */ "./static/templates/invite_subscription.hbs");
/* harmony import */ var _templates_invite_subscription_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_invite_subscription_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_invite_user_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/invite_user.hbs */ "./static/templates/invite_user.hbs");
/* harmony import */ var _templates_invite_user_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_invite_user_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/settings/dev_env_email_access.hbs */ "./static/templates/settings/dev_env_email_access.hbs");
/* harmony import */ var _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

























let custom_expiration_time_input = 10;
let custom_expiration_time_unit = "days";

function reset_error_messages() {
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite_status").hide().text("").removeClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#multiuse_invite_status").hide().text("").removeClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#dev_env_msg").hide().text("").removeClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    }
}

function get_common_invitation_data() {
    const invite_as = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite_as").val(), 10);
    let expires_in = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val();
    // See settings_config.expires_in_values for why we do this conversion.
    if (expires_in === "null") {
        expires_in = JSON.stringify(null);
    } else if (expires_in === "custom") {
        expires_in = Number.parseFloat(get_expiration_time_in_minutes());
    } else {
        expires_in = Number.parseFloat(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val());
    }

    const stream_ids = [];
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-stream-checkboxes input:checked").each(function () {
        const stream_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_2___default()(this).val(), 10);
        stream_ids.push(stream_id);
    });
    const data = {
        csrfmiddlewaretoken: jquery__WEBPACK_IMPORTED_MODULE_2___default()('input[name="csrfmiddlewaretoken"]').attr("value"),
        invite_as,
        stream_ids: JSON.stringify(stream_ids),
        invite_expires_in_minutes: expires_in,
    };
    return data;
}

function beforeSend() {
    reset_error_messages();
    // TODO: You could alternatively parse the textarea here, and return errors to
    // the user if they don't match certain constraints (i.e. not real email addresses,
    // aren't in the right domain, etc.)
    //
    // OR, you could just let the server do it. Probably my temptation.
    const loading_text = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").data("loading-text");
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").text(loading_text);
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").prop("disabled", true);
    return true;
}

function submit_invitation_form() {
    const $invite_status = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite_status");
    const $invitee_emails = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails");
    const data = get_common_invitation_data();
    data.invitee_emails = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails").val();

    _channel__WEBPACK_IMPORTED_MODULE_9__.post({
        url: "/json/invites",
        data,
        beforeSend,
        success() {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User(s) invited successfully."}),
                $invite_status,
            );
            $invitee_emails.val("");

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                const rendered_email_msg = _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_7___default()();
                jquery__WEBPACK_IMPORTED_MODULE_2___default()("#dev_env_msg").html(rendered_email_msg).addClass("alert-info").show();
            }

            if (jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val() === "custom") {
                // Hide the custom inputs if the custom input is set
                // to one of the dropdown's standard options.
                const time_in_minutes = get_expiration_time_in_minutes();
                for (const option of Object.values(Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))) {
                    if (option.value === time_in_minutes) {
                        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-invite-expiration-time").hide();
                        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val(time_in_minutes);
                        return;
                    }
                }
            }
        },
        error(xhr) {
            const arr = JSON.parse(xhr.responseText);
            if (arr.errors === undefined) {
                // There was a fatal error, no partial processing occurred.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("", xhr, $invite_status);
            } else {
                // Some users were not invited.
                const invitee_emails_errored = [];
                const error_list = [];
                let is_invitee_deactivated = false;
                for (const value of arr.errors) {
                    const [email, error_message, deactivated] = value;
                    error_list.push(`${email}: ${error_message}`);
                    if (deactivated) {
                        is_invitee_deactivated = true;
                    }
                    invitee_emails_errored.push(email);
                }

                const error_response = _templates_invitation_failed_error_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
                    error_message: arr.msg,
                    error_list,
                    is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                    is_invitee_deactivated,
                    license_limit_reached: arr.license_limit_reached,
                    has_billing_access: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                    daily_limit_reached: arr.daily_limit_reached,
                });
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error_response, $invite_status, "alert-warning");

                if (arr.sent_invitations) {
                    $invitee_emails.val(invitee_emails_errored.join("\n"));
                }
            }
        },
        complete() {
            jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invite"}));
            jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").prop("disabled", false);
            jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails").trigger("focus");
            _ui__WEBPACK_IMPORTED_MODULE_13__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite_user_form .modal-body"))[0].scrollTop = 0;
        },
    });
}

function generate_multiuse_invite() {
    const $invite_status = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#multiuse_invite_status");
    const data = get_common_invitation_data();
    _channel__WEBPACK_IMPORTED_MODULE_9__.post({
        url: "/json/invites/multiuse",
        data,
        beforeSend,
        success(data) {
            const copy_link_html = _templates_copy_invite_link_hbs__WEBPACK_IMPORTED_MODULE_3___default()(data);
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(copy_link_html, $invite_status);
            new (clipboard__WEBPACK_IMPORTED_MODULE_1___default())("#copy_generated_invite_link");
        },
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("", xhr, $invite_status);
        },
        complete() {
            jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Generate invite link"}));
            jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").prop("disabled", false);
        },
    });
}

function get_invite_streams() {
    const streams = _stream_data__WEBPACK_IMPORTED_MODULE_12__.get_invite_stream_data();
    streams.sort((a, b) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.name, b.name));
    return streams;
}

function update_subscription_checkboxes() {
    const data = {
        streams: get_invite_streams(),
        notifications_stream: _stream_data__WEBPACK_IMPORTED_MODULE_12__.get_notifications_stream(),
    };
    const html = _templates_invite_subscription_hbs__WEBPACK_IMPORTED_MODULE_5___default()(data);
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#streams_to_add").html(html);
}

function prepare_form_to_be_shown() {
    update_subscription_checkboxes();
    reset_error_messages();
}

function launch() {
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").button();
    prepare_form_to_be_shown();

    _overlays__WEBPACK_IMPORTED_MODULE_11__.open_overlay({
        name: "invite",
        $overlay: jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-user"),
        on_close() {
            _browser_history__WEBPACK_IMPORTED_MODULE_8__.exit_overlay();
        },
    });

    (0,autosize__WEBPACK_IMPORTED_MODULE_0__["default"])(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails").trigger("focus"));

    // Ctrl + Enter key to submit form
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-user").on("keydown", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e) && e.ctrlKey) {
            submit_invitation_form();
        }
    });
}

function valid_to(expires_in) {
    const time_valid = Number.parseFloat(expires_in);
    if (!time_valid) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Never expires"});
    }
    const valid_to = (0,date_fns__WEBPACK_IMPORTED_MODULE_14__["default"])(new Date(), {minutes: time_valid});
    const options = {
        year: "numeric",
        month: "numeric",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: !Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    };
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {defaultMessage: "Expires on {date}"},
        {date: valid_to.toLocaleTimeString([], options)},
    );
}

function get_expiration_time_in_minutes() {
    switch (custom_expiration_time_unit) {
        case "hours":
            return custom_expiration_time_input * 60;
        case "days":
            return custom_expiration_time_input * 24 * 60;
        case "weeks":
            return custom_expiration_time_input * 7 * 24 * 60;
        default:
            return custom_expiration_time_input;
    }
}

function set_expires_on_text() {
    if (jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val() === "custom") {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_on").hide();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom_expires_on").text(valid_to(get_expiration_time_in_minutes()));
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_on").show();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_on").text(valid_to(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val()));
    }
}

function set_custom_time_inputs_visibility() {
    if (jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val() === "custom") {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-expiration-time-input").val(custom_expiration_time_input);
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-expiration-time-unit").val(custom_expiration_time_unit);
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-invite-expiration-time").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-invite-expiration-time").hide();
    }
}

function initialize() {
    const time_unit_choices = ["minutes", "hours", "days", "weeks"];
    const rendered = _templates_invite_user_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
        is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        development_environment: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        invite_as_options: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        expires_in_options: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        time_choices: time_unit_choices,
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()(".app").append(rendered);
    set_custom_time_inputs_visibility();
    set_expires_on_text();

    jquery__WEBPACK_IMPORTED_MODULE_2___default()(document).on("click", "#invite_check_all_button", () => {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#streams_to_add :checkbox").prop("checked", true);
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()(document).on("click", "#invite_uncheck_all_button", () => {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#streams_to_add :checkbox").prop("checked", false);
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").on("click", () => {
        const is_generate_invite_link = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#generate_multiuse_invite_radio").prop("checked");
        if (is_generate_invite_link) {
            generate_multiuse_invite();
        } else {
            submit_invitation_form();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#generate_multiuse_invite_button").on("click", () => {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#generate_multiuse_invite_radio").prop("checked", true);
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#multiuse_radio_section").show();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-method-choice").hide();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Generate invite link"}));
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").data("loading-text", Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Generating link..."}));
        reset_error_messages();
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-user").on("change", "#generate_multiuse_invite_radio", () => {
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invitee_emails").prop("disabled", false);
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invite"}));
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#submit-invitation").data("loading-text", Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Inviting..."}));
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#multiuse_radio_section").hide();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#invite-method-choice").show();
        reset_error_messages();
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_on").text(valid_to(jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").val()));
    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#expires_in").on("change", () => {
        set_custom_time_inputs_visibility();
        set_expires_on_text();
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()(".custom-expiration-time").on("change", () => {
        custom_expiration_time_input = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-expiration-time-input").val();
        custom_expiration_time_unit = jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-expiration-time-unit").val();
        jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom_expires_on").text(valid_to(get_expiration_time_in_minutes()));
    });

    jquery__WEBPACK_IMPORTED_MODULE_2___default()("#custom-expiration-time-input").on("keydown", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
            return;
        }
    });
}


/***/ }),

/***/ "./static/js/lightbox.js":
/*!*******************************!*\
  !*** ./static/js/lightbox.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PanZoomControl": () => (/* binding */ PanZoomControl),
/* harmony export */   "build_open_image_function": () => (/* binding */ build_open_image_function),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "next": () => (/* binding */ next),
/* harmony export */   "parse_image_data": () => (/* binding */ parse_image_data),
/* harmony export */   "prev": () => (/* binding */ prev),
/* harmony export */   "render_lightbox_list_images": () => (/* binding */ render_lightbox_list_images),
/* harmony export */   "show_from_selected_message": () => (/* binding */ show_from_selected_message)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var panzoom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! panzoom */ "./node_modules/panzoom/index.js");
/* harmony import */ var panzoom__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(panzoom__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_lightbox_overlay_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/lightbox_overlay.hbs */ "./static/templates/lightbox_overlay.hbs");
/* harmony import */ var _templates_lightbox_overlay_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_lightbox_overlay_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");












let is_open = false;
// the asset map is a map of all retrieved images and YouTube videos that are
// memoized instead of being looked up multiple times.
const asset_map = new Map();

class PanZoomControl {
    // Class for both initializing and controlling the
    // the pan/zoom functionality.
    constructor(container) {
        this.container = container;
        this.panzoom = panzoom__WEBPACK_IMPORTED_MODULE_1___default()(this.container, {
            smoothScroll: false,
            // Ideally we'd set `bounds` here, but that feature is
            // currently broken upstream.  See
            // https://github.com/anvaka/panzoom/issues/112.
            maxZoom: 100,
            minZoom: 0.1,
            filterKey() {
                // Disable the library's built in keybindings
                return true;
            },
        });
        // The following events are necessary to prevent the click event
        // firing where the user "unclicks" at the end of the drag, which
        // was causing accidental overlay closes in some situations.
        this.panzoom.on("pan", () => {
            // Marks this overlay as needing to stay open.
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").data("noclose", true);

            // Enable the panzoom reset button.
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .lightbox-zoom-reset").removeClass("disabled");
        });

        this.panzoom.on("panend", (e) => {
            // Check if the image has been panned out of view.
            this.constrainImage(e);

            // Don't remove the noclose attribute on this overlay until after paint,
            // otherwise it will be removed too early and close the lightbox
            // unintentionally.
            setTimeout(() => {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").data("noclose", false);
            }, 0);
        });

        this.panzoom.on("zoom", (e) => {
            // Check if the image has been zoomed out of view.
            // We are using the zoom event instead of zoomend because the zoomend
            // event does not fire when using the scroll wheel or pinch to zoom.
            // https://github.com/anvaka/panzoom/issues/250
            this.constrainImage(e);

            // Enable the panzoom reset button.
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .lightbox-zoom-reset").removeClass("disabled");
        });

        // key bindings
        document.addEventListener("keydown", (e) => {
            if (!_overlays__WEBPACK_IMPORTED_MODULE_5__.lightbox_open()) {
                return;
            }
            switch (e.key) {
                case "Z":
                case "+":
                    this.zoomIn();
                    break;
                case "z":
                case "-":
                    this.zoomOut();
                    break;
                case "v":
                    _overlays__WEBPACK_IMPORTED_MODULE_5__.close_overlay("lightbox");
                    break;
            }
            e.preventDefault();
            e.stopPropagation();
        });
    }

    constrainImage(e) {
        // Instead of using panzoom's built in bounds option which was buggy
        // at the time of this writing, we act on pan/zoom events and move the
        // image back in to view if it is moved beyond the image-preview container.
        // See https://github.com/anvaka/panzoom/issues/112 for upstream discussion.

        const {scale, x, y} = e.getTransform();
        const image_width = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".zoom-element > img")[0].clientWidth * scale;
        const image_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".zoom-element > img")[0].clientHeight * scale;
        const zoom_element_width = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".zoom-element")[0].clientWidth * scale;
        const zoom_element_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".zoom-element")[0].clientHeight * scale;
        const max_translate_x = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview")[0].clientWidth;
        const max_translate_y = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview")[0].clientHeight;

        // When the image is dragged out of the image-preview container
        // (max_translate) it will be "snapped" back so that the number
        // of pixels set below will remain visible in the dimension it was dragged.
        const return_buffer = 50 * scale;
        // Move the image if it gets within this many pixels of the edge.
        const border = 20;

        const zoom_border_width = (zoom_element_width - image_width) / 2 + image_width;
        const zoom_border_height = (zoom_element_height - image_height) / 2 + image_height;
        const modified_x = x + zoom_border_width;
        const modified_y = y + zoom_border_height;

        if (modified_x < 0 + border) {
            // Image has been dragged beyond the LEFT of the view.
            const move_by = modified_x * -1;
            e.moveBy(move_by + return_buffer, 0, false);
        } else if (modified_x - image_width > max_translate_x - border) {
            // Image has been dragged beyond the RIGHT of the view.
            const move_by = modified_x - max_translate_x - image_width;
            e.moveBy(-move_by - return_buffer, 0, false);
        }

        if (modified_y < 0 + border) {
            // Image has been dragged beyond the TOP of the view.
            const move_by = modified_y * -1;
            e.moveBy(0, move_by + return_buffer, false);
        } else if (modified_y - image_height > max_translate_y - border) {
            // Image has been dragged beyond the BOTTOM of the view.
            const move_by = modified_y - max_translate_y - image_height;
            e.moveBy(0, -move_by - return_buffer, false);
        }
    }

    reset() {
        // To reset the panzoom state, we want to:
        // Reset zoom to the initial state.
        this.panzoom.zoomAbs(0, 0, 1);
        // Re-center the image.
        this.panzoom.moveTo(0, 0);
        // Always ensure that the overlay is available for click to close.
        // This way we don't rely on the above events firing panend,
        // of which there is some anecdotal evidence that suggests they
        // might be prone to race conditions.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").data("noclose", false);
        // Disable the lightbox reset button to reflect the state that
        // the image has not been panned or zoomed.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .lightbox-zoom-reset").addClass("disabled");
    }

    zoomIn() {
        const w = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview").width();
        const h = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview").height();
        this.panzoom.smoothZoom(w / 2, h / 2, 1.5);
    }

    zoomOut() {
        const w = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview").width();
        const h = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview").height();
        this.panzoom.smoothZoom(w / 2, h / 2, 0.5);
    }

    isActive() {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview .zoom-element img").length > 0;
    }
}

function clear_for_testing() {
    is_open = false;
    asset_map.clear();
}

function render_lightbox_list_images(preview_source) {
    if (!is_open) {
        const images = Array.prototype.slice.call(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table .message_inline_image img"));
        const $image_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .image-list").empty();

        for (const img of images) {
            const src = img.getAttribute("src");
            const className = preview_source === src ? "image selected" : "image";

            const $node = jquery__WEBPACK_IMPORTED_MODULE_0___default()("<div>")
                .addClass(className)
                .attr("data-src", src)
                .css({backgroundImage: "url(" + src + ")"});

            $image_list.append($node);

            // We parse the data for each image to show in the list,
            // while we still have its original DOM element handy, so
            // that navigating within the list only needs the `src`
            // attribute used to construct the node object above.
            parse_image_data(img);
        }
    }
}

function display_image(payload) {
    render_lightbox_list_images(payload.preview);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".player-container").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-preview, .image-actions, .image-description, .download, .lightbox-zoom-reset").show();

    const $img_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .image-preview > .zoom-element");
    const img = new Image();
    img.src = payload.source;
    $img_container.html(img).show();

    const filename = payload.url?.split("/").pop();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-description .title")
        .text(payload.title || "N/A")
        .attr("aria-label", payload.title || "N/A")
        .prop("data-filename", filename || "N/A");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-description .user").text(payload.user).prop("title", payload.user);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-actions .open").attr("href", payload.source);

    const url = new URL(payload.source, window.location.href);
    const same_origin = url.origin === window.location.origin;
    if (same_origin && url.pathname.startsWith("/user_uploads/")) {
        // Switch to the "download" handler, so S3 URLs set their Content-Disposition
        url.pathname = "/user_uploads/download/" + url.pathname.slice("/user_uploads/".length);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-actions .download").attr("href", url.href);
    } else if (same_origin) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-actions .download").attr("href", payload.source);
    } else {
        // If it's not same-origin, and we don't know how to tell the remote service to put a
        // content-disposition on it, the download can't possibly download, just show -- so hide the
        // element.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-actions .download").hide();
    }
}

function display_video(payload) {
    render_lightbox_list_images(payload.preview);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        "#lightbox_overlay .image-preview, .image-description, .download, .lightbox-zoom-reset",
    ).hide();

    let source;
    switch (payload.type) {
        case "youtube-video":
            source = "https://www.youtube.com/embed/" + payload.source;
            break;
        case "vimeo-video":
            source = "https://player.vimeo.com/video/" + payload.source;
            break;
        case "embed-video":
            // Use data: to load the player in a unique origin for security.
            source =
                "data:text/html," +
                window.encodeURIComponent(
                    "<!DOCTYPE html><style>iframe{position:absolute;left:0;top:0;width:100%;height:100%;box-sizing:border-box}</style>" +
                        payload.source,
                );
            break;
    }

    const $iframe = jquery__WEBPACK_IMPORTED_MODULE_0___default()("<iframe>");
    $iframe.attr(
        "sandbox",
        "allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts",
    );
    $iframe.attr("src", source);
    $iframe.attr("frameborder", 0);
    $iframe.attr("allowfullscreen", true);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .player-container").html($iframe).show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-actions .open").attr("href", payload.url);
}

function build_open_image_function(on_close) {
    if (on_close === undefined) {
        on_close = function () {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".player-container iframe").remove();
            is_open = false;
            document.activeElement.blur();
        };
    }

    return function ($image) {
        // if the asset_map already contains the metadata required to display the
        // asset, just recall that metadata.
        let $preview_src = $image.attr("src");
        let payload = asset_map.get($preview_src);
        if (payload === undefined) {
            if ($preview_src.endsWith("&size=full")) {
                // while fetching an image for canvas, `src` attribute supplies
                // full-sized image instead of thumbnail, so we have to replace
                // `size=full` with `size=thumbnail`.
                //
                // TODO: This is a hack to work around the fact that for
                // the lightbox canvas, the `src` is the data-fullsize-src
                // for the image, not the original thumbnail used to open
                // the lightbox.  A better fix will be to check a
                // `data-thumbnail-src` attribute that we add to the
                // canvas elements.
                $preview_src = $preview_src.slice(0, -"full".length) + "thumbnail";
                payload = asset_map.get($preview_src);
            }
            if (payload === undefined) {
                payload = parse_image_data($image);
            }
        }

        if (payload.type.match("-video")) {
            display_video(payload);
        } else if (payload.type === "image") {
            display_image(payload);
        }

        if (is_open) {
            return;
        }

        _overlays__WEBPACK_IMPORTED_MODULE_5__.open_overlay({
            name: "lightbox",
            $overlay: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay"),
            on_close,
        });

        _popovers__WEBPACK_IMPORTED_MODULE_7__.hide_all();
        is_open = true;
    };
}

function show_from_selected_message() {
    const $message_selected = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".selected_message");
    let $message = $message_selected;
    let $image = $message.find(".message_inline_image img");
    let $prev_traverse = false;

    while ($image.length === 0) {
        if ($message.prev().length === 0) {
            $message = $message.parent().prev();
            if ($message.length === 0) {
                $prev_traverse = true;
                $message = $message_selected;
                break;
            } else {
                $message = $message.find(".last_message");
                continue;
            }
        }
        $message = $message.prev();
        $image = $message.find(".message_inline_image img");
    }

    if ($prev_traverse) {
        while ($image.length === 0) {
            if ($message.next().length === 0) {
                $message = $message.parent().next();
                if ($message.length === 0) {
                    break;
                } else {
                    $message = $message.children().first();
                    continue;
                }
            }
            $message = $message.next();
            $image = $message.find(".message_inline_image img");
        }
    }

    if ($image.length !== 0) {
        const open_image = build_open_image_function();
        open_image($image);
    }
}

// retrieve the metadata from the DOM and store into the asset_map.
function parse_image_data(image) {
    const $image = jquery__WEBPACK_IMPORTED_MODULE_0___default()(image);
    const preview_src = $image.attr("src");

    if (asset_map.has(preview_src)) {
        // check if image's data is already present in asset_map.
        return asset_map.get(preview_src);
    }

    // if wrapped in the .youtube-video class, it will be length = 1, and therefore
    // cast to true.
    const is_youtube_video = Boolean($image.closest(".youtube-video").length);
    const is_vimeo_video = Boolean($image.closest(".vimeo-video").length);
    const is_embed_video = Boolean($image.closest(".embed-video").length);

    // check if image is descendent of #compose .preview_content
    const is_compose_preview_image = $image.closest("#compose .preview_content").length === 1;

    const $parent = $image.parent();
    let type;
    let source;
    const url = $parent.attr("href");
    if (is_youtube_video) {
        type = "youtube-video";
        source = $parent.attr("data-id");
    } else if (is_vimeo_video) {
        type = "vimeo-video";
        source = $parent.attr("data-id");
    } else if (is_embed_video) {
        type = "embed-video";
        source = $parent.attr("data-id");
    } else {
        type = "image";
        if ($image.attr("data-src-fullsize")) {
            source = $image.attr("data-src-fullsize");
        } else {
            source = preview_src;
        }
    }
    let sender_full_name;
    if (is_compose_preview_image) {
        sender_full_name = _people__WEBPACK_IMPORTED_MODULE_6__.my_full_name();
    } else {
        const $message = $parent.closest("[zid]");
        const zid = _rows__WEBPACK_IMPORTED_MODULE_8__.id($message);
        const message = _message_store__WEBPACK_IMPORTED_MODULE_4__.get(zid);
        if (message === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Lightbox for unknown message " + zid);
        } else {
            sender_full_name = message.sender_full_name;
        }
    }
    const payload = {
        user: sender_full_name,
        title: $parent.attr("aria-label") || $parent.attr("href"),
        type,
        preview: preview_src,
        source,
        url,
    };

    asset_map.set(preview_src, payload);
    return payload;
}

function prev() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-list .image.selected").prev().trigger("click");
}

function next() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-list .image.selected").next().trigger("click");
}

// this is a block of events that are required for the lightbox to work.
function initialize() {
    // Renders the DOM for the lightbox.
    const rendered_lightbox_overlay = _templates_lightbox_overlay_hbs__WEBPACK_IMPORTED_MODULE_2___default()();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append(rendered_lightbox_overlay);

    // Bind the pan/zoom control the newly created element.
    const pan_zoom_control = new PanZoomControl(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .image-preview > .zoom-element")[0],
    );

    const reset_lightbox_state = function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".player-container iframe").remove();
        is_open = false;
        document.activeElement.blur();
        if (pan_zoom_control.isActive()) {
            pan_zoom_control.reset();
        }
    };

    const open_image = build_open_image_function(reset_lightbox_state);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#main_div, #compose .preview_content").on("click", ".message_inline_image a", function (e) {
        // prevent the link from opening in a new page.
        e.preventDefault();
        // prevent the message compose dialog from happening.
        e.stopPropagation();
        const $img = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).find("img");
        open_image($img);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .download").on("click", function () {
        this.blur();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").on("click", ".image-list .image", function () {
        const $image_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parent();
        const $original_image = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `.message_row img[src='${CSS.escape(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-src"))}']`,
        );

        open_image($original_image);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".image-list .image.selected").removeClass("selected");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).addClass("selected");
        pan_zoom_control.reset();

        const parentOffset = this.parentNode.clientWidth + this.parentNode.scrollLeft;
        // this is the left and right of the image compared to its parent.
        const coords = {
            left: this.offsetLeft,
            right: this.offsetLeft + this.clientWidth,
        };

        if (coords.right > parentOffset) {
            // add 2px margin
            $image_list.animate(
                {
                    scrollLeft: coords.right - this.parentNode.clientWidth + 2,
                },
                100,
            );
        } else if (coords.left < this.parentNode.scrollLeft) {
            // subtract 2px margin
            $image_list.animate({scrollLeft: coords.left - 2}, 100);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").on("click", ".center .arrow", function () {
        const direction = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-direction");

        if (direction === "next") {
            next();
        } else if (direction === "prev") {
            prev();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").on("click", ".lightbox-zoom-reset", () => {
        if (!jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .lightbox-zoom-reset").hasClass("disabled")) {
            const $img = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").find(".image-preview img");
            open_image($img);
            pan_zoom_control.reset();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .player-container").on("click", function () {
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).is(".player-container")) {
            reset_lightbox_state();
            _overlays__WEBPACK_IMPORTED_MODULE_5__.close_active();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").on("click", ".image-info-wrapper, .center", (e) => {
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(".image-info-wrapper, .center")) {
            reset_lightbox_state();
            _overlays__WEBPACK_IMPORTED_MODULE_5__.close_overlay("lightbox");
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay .image-preview").on("click", (e) => {
        // Ensure that the click isn't on the image itself, and that
        // the window isn't marked as disabled to click to close.
        if (!jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is("img") && !jquery__WEBPACK_IMPORTED_MODULE_0___default()("#lightbox_overlay").data("noclose")) {
            reset_lightbox_state();
            _overlays__WEBPACK_IMPORTED_MODULE_5__.close_overlay("lightbox");
        }
    });
}


/***/ }),

/***/ "./static/js/linkifiers.js":
/*!*********************************!*\
  !*** ./static/js/linkifiers.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_linkifier_map": () => (/* binding */ get_linkifier_map),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "update_linkifier_rules": () => (/* binding */ update_linkifier_rules)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


const linkifier_map = new Map(); // regex -> url

function get_linkifier_map() {
    return linkifier_map;
}

function python_to_js_linkifier(pattern, url) {
    // Converts a python named-group regex to a javascript-compatible numbered
    // group regex... with a regex!
    const named_group_re = /\(?P<([^>]+?)>/g;
    let match = named_group_re.exec(pattern);
    let current_group = 1;
    while (match) {
        const name = match[1];
        // Replace named group with regular matching group
        pattern = pattern.replace("(?P<" + name + ">", "(");
        // Replace named reference in URL to numbered reference
        url = url.replace("%(" + name + ")s", "\\" + current_group);

        // Reset the RegExp state
        named_group_re.lastIndex = 0;
        match = named_group_re.exec(pattern);

        current_group += 1;
    }
    // Convert any python in-regex flags to RegExp flags
    let js_flags = "g";
    const inline_flag_re = /\(\?([Limsux]+)\)/;
    match = inline_flag_re.exec(pattern);

    // JS regexes only support i (case insensitivity) and m (multiline)
    // flags, so keep those and ignore the rest
    if (match) {
        const py_flags = match[1].split("");

        for (const flag of py_flags) {
            if ("im".includes(flag)) {
                js_flags += flag;
            }
        }

        pattern = pattern.replace(inline_flag_re, "");
    }
    // Ideally we should have been checking that linkifiers
    // begin with certain characters but since there is no
    // support for negative lookbehind in javascript, we check
    // for this condition in `contains_backend_only_syntax()`
    // function. If the condition is satisfied then the message
    // is rendered locally, otherwise, we return false there and
    // message is rendered on the backend which has proper support
    // for negative lookbehind.
    pattern = pattern + /(?!\w)/.source;
    let final_regex = null;
    try {
        final_regex = new RegExp(pattern, js_flags);
    } catch (error) {
        // We have an error computing the generated regex syntax.
        // We'll ignore this linkifier for now, but log this
        // failure for debugging later.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("python_to_js_linkifier: " + error.message);
    }
    return [final_regex, url];
}

function update_linkifier_rules(linkifiers) {
    linkifier_map.clear();

    for (const linkifier of linkifiers) {
        const [regex, final_url] = python_to_js_linkifier(linkifier.pattern, linkifier.url_format);
        if (!regex) {
            // Skip any linkifiers that could not be converted
            continue;
        }

        linkifier_map.set(regex, final_url);
    }
}

function initialize(linkifiers) {
    update_linkifier_rules(linkifiers);
}


/***/ }),

/***/ "./static/js/list_cursor.js":
/*!**********************************!*\
  !*** ./static/js/list_cursor.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "ListCursor": () => (/* binding */ ListCursor)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _scroll_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./scroll_util */ "./static/js/scroll_util.js");





class ListCursor {
    constructor({highlight_class, list}) {
        const config_ok =
            highlight_class &&
            list &&
            list.scroll_container_sel &&
            list.find_li &&
            list.first_key &&
            list.prev_key &&
            list.next_key;
        if (!config_ok) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Programming error");
            return;
        }

        this.highlight_class = highlight_class;
        this.list = list;
    }

    clear() {
        if (this.curr_key === undefined) {
            return;
        }
        const row = this.get_row(this.curr_key);
        if (row) {
            row.clear();
        }
        this.curr_key = undefined;
    }

    get_key() {
        return this.curr_key;
    }

    get_row(key) {
        // TODO: The list class should probably do more of the work
        //       here, so we're not so coupled to jQuery, and
        //       so we instead just get back a widget we can say
        //       something like widget.trigger("select") on.  This will
        //       be especially important if we do lazy rendering.
        //       It would also give the caller more flexibility on
        //       the actual styling.
        if (key === undefined) {
            return undefined;
        }

        const $li = this.list.find_li({
            key,
            force_render: true,
        });

        if (!$li || $li.length === 0) {
            return undefined;
        }

        return {
            highlight: () => {
                $li.addClass(this.highlight_class);
                this.adjust_scroll($li);
            },
            clear: () => {
                $li.removeClass(this.highlight_class);
            },
        };
    }

    adjust_scroll($li) {
        const $scroll_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.list.scroll_container_sel);
        _scroll_util__WEBPACK_IMPORTED_MODULE_2__.scroll_element_into_container($li, $scroll_container);
    }

    redraw() {
        // We should only call this for situations like the buddy
        // list where we redraw the whole list without necessarily
        // changing it, so we just want to re-highlight the current
        // row in the new DOM.  If you are filtering, for now you
        // should call the 'reset()' method.
        const row = this.get_row(this.curr_key);

        if (row === undefined) {
            return;
        }
        row.highlight();
    }

    go_to(key) {
        if (key === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Caller is not checking keys for ListCursor.go_to");
            return;
        }
        if (key === this.curr_key) {
            return;
        }
        this.clear();
        const row = this.get_row(key);
        if (row === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot highlight key for ListCursor: " + key);
            return;
        }
        this.curr_key = key;
        row.highlight();
    }

    reset() {
        this.clear();
        const key = this.list.first_key();
        if (key === undefined) {
            this.curr_key = undefined;
            return;
        }
        this.go_to(key);
    }

    prev() {
        if (this.curr_key === undefined) {
            return;
        }
        const key = this.list.prev_key(this.curr_key);
        if (key === undefined) {
            // leave the current key
            return;
        }
        this.go_to(key);
    }

    next() {
        if (this.curr_key === undefined) {
            // This is sort of a special case where we went from
            // an empty filter to having data.
            this.reset();
            return;
        }
        const key = this.list.next_key(this.curr_key);
        if (key === undefined) {
            // leave the current key
            return;
        }
        this.go_to(key);
    }
}


/***/ }),

/***/ "./static/js/list_widget.js":
/*!**********************************!*\
  !*** ./static/js/list_widget.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "alphabetic_sort": () => (/* binding */ alphabetic_sort),
/* harmony export */   "create": () => (/* binding */ create),
/* harmony export */   "get": () => (/* binding */ get),
/* harmony export */   "get_filtered_items": () => (/* binding */ get_filtered_items),
/* harmony export */   "handle_sort": () => (/* binding */ handle_sort),
/* harmony export */   "numeric_sort": () => (/* binding */ numeric_sort),
/* harmony export */   "valid_filter_opts": () => (/* binding */ valid_filter_opts),
/* harmony export */   "validate_opts": () => (/* binding */ validate_opts)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");





const DEFAULTS = {
    INITIAL_RENDER_COUNT: 80,
    LOAD_COUNT: 20,
    instances: new Map(),
};

// ----------------------------------------------------
// This function describes (programmatically) how to use the ListWidget.
// ----------------------------------------------------

function validate_opts(opts) {
    if (opts.html_selector && typeof opts.html_selector !== "function") {
        // We have an html_selector, but it is not a function.
        // This is a programming error.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("html_selector should be a function.");
        return false;
    }
    if (!opts.$simplebar_container) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("$simplebar_container is missing.");
        return false;
    }
    return true;
}

function get_filtered_items(value, list, opts) {
    /*
        This is used by the main object (see `create`),
        but we split it out to make it a bit easier
        to test.
    */
    const get_item = opts.get_item;

    if (!opts.filter) {
        if (get_item) {
            return list.map((key) => get_item(key));
        }
        return [...list];
    }

    if (opts.filter.filterer) {
        if (get_item) {
            return opts.filter.filterer(
                list.map((key) => get_item(key)),
                value,
            );
        }
        return opts.filter.filterer(list, value);
    }

    const predicate = (item) => opts.filter.predicate(item, value);

    if (get_item) {
        const result = [];

        for (const key of list) {
            const item = get_item(key);
            if (predicate(item)) {
                result.push(item);
            }
        }

        return result;
    }

    return list.filter((item) => predicate(item));
}

function alphabetic_sort(prop) {
    return function (a, b) {
        // The conversion to uppercase helps make the sorting case insensitive.
        const str1 = a[prop].toUpperCase();
        const str2 = b[prop].toUpperCase();

        if (str1 === str2) {
            return 0;
        } else if (str1 > str2) {
            return 1;
        }

        return -1;
    };
}

function numeric_sort(prop) {
    return function (a, b) {
        if (Number.parseFloat(a[prop]) > Number.parseFloat(b[prop])) {
            return 1;
        } else if (Number.parseFloat(a[prop]) === Number.parseFloat(b[prop])) {
            return 0;
        }

        return -1;
    };
}

function valid_filter_opts(opts) {
    if (!opts.filter) {
        return true;
    }
    if (opts.filter.predicate) {
        if (typeof opts.filter.predicate !== "function") {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Filter predicate is not a function.");
            return false;
        }
        if (opts.filter.filterer) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Filterer and predicate are mutually exclusive.");
            return false;
        }
    } else {
        if (typeof opts.filter.filterer !== "function") {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Filter filterer is not a function (or missing).");
            return false;
        }
    }

    return true;
}

function is_scroll_position_for_render(scroll_container) {
    return (
        scroll_container.scrollHeight -
            (scroll_container.scrollTop + scroll_container.clientHeight) <
        10
    );
}

// @params
// $container: jQuery object to append to.
// list: The list of items to progressively append.
// opts: An object of random preferences.
function create($container, list, opts) {
    if (!opts) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Need opts to create widget.");
        return undefined;
    }

    if (!validate_opts(opts)) {
        return undefined;
    }

    if (opts.name && DEFAULTS.instances.get(opts.name)) {
        // Clear event handlers for prior widget.
        const old_widget = DEFAULTS.instances.get(opts.name);
        old_widget.clear_event_handlers();
    }

    const meta = {
        sorting_function: null,
        sorting_functions: new Map(),
        generic_sorting_functions: {
            alphabetic: alphabetic_sort,
            numeric: numeric_sort,
        },
        offset: 0,
        list,
        filtered_list: list,
        reverse_mode: false,
        filter_value: "",
    };

    if (!valid_filter_opts(opts)) {
        return undefined;
    }

    if (opts.get_item && typeof opts.get_item !== "function") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_item should be a function");
        return undefined;
    }

    const widget = {};

    widget.get_current_list = function () {
        return meta.filtered_list;
    };

    widget.filter_and_sort = function () {
        meta.filtered_list = get_filtered_items(meta.filter_value, meta.list, opts);

        if (meta.sorting_function) {
            meta.filtered_list.sort(meta.sorting_function);
        }

        if (meta.reverse_mode) {
            meta.filtered_list.reverse();
        }
    };

    // Used in case of Multiselect DropdownListWidget to retain
    // previously checked items even after widget redraws.
    widget.retain_selected_items = function () {
        const items = opts.multiselect;

        if (items.selected_items) {
            const data = items.selected_items;
            for (const value of data) {
                const $list_item = $container.find(`li[data-value = "${value}"]`);
                if ($list_item.length) {
                    const $link_elem = $list_item.find("a").expectOne();
                    $list_item.addClass("checked");
                    $link_elem.prepend(jquery__WEBPACK_IMPORTED_MODULE_0___default()("<i>").addClass(["fa", "fa-check"]));
                }
            }
        }
    };

    // Reads the provided list (in the scope directly above)
    // and renders the next block of messages automatically
    // into the specified container.
    widget.render = function (how_many) {
        let load_count = how_many || DEFAULTS.LOAD_COUNT;
        if (opts.get_min_load_count) {
            load_count = opts.get_min_load_count(meta.offset, load_count);
        }

        // Stop once the offset reaches the length of the original list.
        if (meta.offset >= meta.filtered_list.length) {
            return;
        }

        const slice = meta.filtered_list.slice(meta.offset, meta.offset + load_count);

        let html = "";
        for (const item of slice) {
            const s = opts.modifier(item);

            if (typeof s !== "string") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("List item is not a string: " + s);
                continue;
            }

            // append the HTML or nothing if corrupt (null, undef, etc.).
            if (s) {
                html += s;
            }
        }

        $container.append(jquery__WEBPACK_IMPORTED_MODULE_0___default()(html));
        meta.offset += load_count;

        if (opts.multiselect) {
            widget.retain_selected_items();
        }

        if (opts.callback_after_render) {
            opts.callback_after_render();
        }
    };

    widget.render_item = (item) => {
        if (!opts.html_selector) {
            // We don't have any way to find the existing item.
            return;
        }
        const $html_item = meta.$scroll_container.find(opts.html_selector(item));
        if (!$html_item) {
            // We don't have the item in the current scroll container; it'll be
            // rendered with updated data when it is scrolled to.
            return;
        }

        if (opts.get_item) {
            item = opts.get_item(item);
        }
        const html = opts.modifier(item);
        if (typeof html !== "string") {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("List item is not a string: " + html);
            return;
        }

        // At this point, we have asserted we have all the information to replace
        // the html now.
        $html_item.replaceWith(html);
    };

    widget.clear = function () {
        $container.empty();
        meta.offset = 0;
    };

    widget.set_filter_value = function (filter_value) {
        meta.filter_value = filter_value;
    };

    widget.set_reverse_mode = function (reverse_mode) {
        meta.reverse_mode = reverse_mode;
    };

    // the sorting function is either the function or string that calls the
    // function to sort the list by. The prop is used for generic functions
    // that can be called to sort with a particular prop.
    widget.set_sorting_function = function (sorting_function, prop) {
        if (typeof sorting_function === "function") {
            meta.sorting_function = sorting_function;
        } else if (typeof sorting_function === "string") {
            if (typeof prop === "string") {
                meta.sorting_function = meta.generic_sorting_functions[sorting_function](prop);
            } else {
                meta.sorting_function = meta.sorting_functions.get(sorting_function);
            }
        }
    };

    widget.set_up_event_handlers = function () {
        meta.$scroll_container = _ui__WEBPACK_IMPORTED_MODULE_2__.get_scroll_element(opts.$simplebar_container);

        // on scroll of the nearest scrolling container, if it hits the bottom
        // of the container then fetch a new block of items and render them.
        meta.$scroll_container.on("scroll.list_widget_container", function () {
            if (opts.post_scroll__pre_render_callback) {
                opts.post_scroll__pre_render_callback();
            }

            if (opts.is_scroll_position_for_render === undefined) {
                opts.is_scroll_position_for_render = is_scroll_position_for_render;
            }

            const should_render = opts.is_scroll_position_for_render(this);
            if (should_render) {
                widget.render();
            }
        });

        if (opts.$parent_container) {
            opts.$parent_container.on("click.list_widget_sort", "[data-sort]", function () {
                handle_sort(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this), widget);
            });
        }

        if (opts.filter && opts.filter.$element) {
            opts.filter.$element.on("input.list_widget_filter", function () {
                const value = this.value.toLocaleLowerCase();
                widget.set_filter_value(value);
                widget.hard_redraw();
            });
        }
    };

    widget.clear_event_handlers = function () {
        meta.$scroll_container.off("scroll.list_widget_container");

        if (opts.$parent_container) {
            opts.$parent_container.off("click.list_widget_sort", "[data-sort]");
        }

        if (opts.filter && opts.filter.$element) {
            opts.filter.$element.off("input.list_widget_filter");
        }
    };

    widget.increase_rendered_offset = function () {
        meta.offset = Math.min(meta.offset + 1, meta.filtered_list.length);
    };

    widget.reduce_rendered_offset = function () {
        meta.offset = Math.max(meta.offset - 1, 0);
    };

    widget.remove_rendered_row = function (rendered_row) {
        rendered_row.remove();
        // We removed a rendered row, so we need to reduce one offset.
        widget.reduce_rendered_offset();
    };

    widget.insert_rendered_row = function (item) {
        // NOTE: Caller should call `filter_and_sort` before calling this function
        // so that `meta.filtered_list` already has the `item`.
        if (meta.filtered_list.length <= 2) {
            // Avoids edge cases for us and could be faster too.
            widget.clean_redraw();
            return;
        }
        if (!opts.filter.predicate(item)) {
            return;
        }
        // We need to insert the row for it to be displayed at the
        // correct position. filtered_list must contain the new item
        // since we know it is not hidden from the above check.
        const topic_insert_index = meta.filtered_list.findIndex(
            (list_item) => list_item.last_msg_id === item.last_msg_id,
        );
        // Rows greater than `offset` are not rendered in the DOM by list_widget;
        // for those, there's nothing to update.
        if (topic_insert_index <= meta.offset) {
            if (!opts.modifier || !opts.html_selector) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Please specify modifier and html_selector when creating the widget.",
                );
            }
            const rendered_row = opts.modifier(item);
            if (topic_insert_index === meta.filtered_list.length - 1) {
                const $target_row = opts.html_selector(meta.filtered_list[topic_insert_index - 1]);
                $target_row.after(rendered_row);
            } else {
                const $target_row = opts.html_selector(meta.filtered_list[topic_insert_index + 1]);
                $target_row.before(rendered_row);
            }
            widget.increase_rendered_offset();
        }
    };

    widget.sort = function (sorting_function, prop) {
        widget.set_sorting_function(sorting_function, prop);
        widget.hard_redraw();
    };

    widget.clean_redraw = function () {
        widget.filter_and_sort();
        widget.clear();
        widget.render(DEFAULTS.INITIAL_RENDER_COUNT);
    };

    widget.hard_redraw = function () {
        widget.clean_redraw();
        if (opts.filter && opts.filter.onupdate) {
            opts.filter.onupdate();
        }
    };

    widget.replace_list_data = function (list) {
        /*
            We mostly use this widget for lists where you are
            not adding or removing rows, so when you do modify
            the list, we have a brute force solution.
        */
        meta.list = list;
        widget.hard_redraw();
    };

    widget.set_up_event_handlers();

    if (opts.sort_fields) {
        for (const [name, sorting_function] of Object.entries(opts.sort_fields)) {
            meta.sorting_functions.set(name, sorting_function);
        }
    }

    if (opts.init_sort) {
        widget.set_sorting_function(...opts.init_sort);
    }

    widget.clean_redraw();

    // Save the instance for potential future retrieval if a name is provided.
    if (opts.name) {
        DEFAULTS.instances.set(opts.name, widget);
    }

    return widget;
}

function get(name) {
    return DEFAULTS.instances.get(name) || false;
}

function handle_sort($th, list) {
    /*
        one would specify sort parameters like this:
            - name => sort alphabetic.
            - age  => sort numeric.
            - status => look up `status` in sort_fields
                        to find custom sort function

        <thead>
            <th data-sort="alphabetic" data-sort-prop="name"></th>
            <th data-sort="numeric" data-sort-prop="age"></th>
            <th data-sort="status"></th>
        </thead>
        */
    const sort_type = $th.data("sort");
    const prop_name = $th.data("sort-prop");

    if ($th.hasClass("active")) {
        if (!$th.hasClass("descend")) {
            $th.addClass("descend");
        } else {
            $th.removeClass("descend");
        }
    } else {
        $th.siblings(".active").removeClass("active");
        $th.addClass("active");
    }

    list.set_reverse_mode($th.hasClass("descend"));

    // if `prop_name` is defined, it will trigger the generic codepath,
    // and not if it is undefined.
    list.sort(sort_type, prop_name);
}


/***/ }),

/***/ "./static/js/local_message.js":
/*!************************************!*\
  !*** ./static/js/local_message.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_next_id_float": () => (/* binding */ get_next_id_float)
/* harmony export */ });
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




function truncate_precision(float) {
    return Number.parseFloat(float.toFixed(3));
}

const get_next_id_float = (function () {
    const already_used = new Set();

    return function () {
        const local_id_increment = 0.01;
        let latest = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        if (_all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.last() !== undefined) {
            latest = _all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.last().id;
        }
        latest = Math.max(0, latest);
        const local_id_float = truncate_precision(latest + local_id_increment);

        if (already_used.has(local_id_float)) {
            // If our id is already used, it is probably an edge case like we had
            // to abort a very recent message.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We don't reuse ids for local echo.");
            return undefined;
        }

        if (local_id_float % 1 > local_id_increment * 5) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Turning off local echo for this message to let host catch up");
            return undefined;
        }

        if (local_id_float % 1 === 0) {
            // The logic to stop at 0.05 should prevent us from ever wrapping around
            // to the next integer.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Programming error");
            return undefined;
        }

        already_used.add(local_id_float);

        return local_id_float;
    };
})();


/***/ }),

/***/ "./static/js/localstorage.js":
/*!***********************************!*\
  !*** ./static/js/localstorage.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "localstorage": () => (/* binding */ localstorage)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


const ls = {
    // parse JSON without throwing an error.
    parseJSON(str) {
        try {
            return JSON.parse(str);
        } catch {
            return undefined;
        }
    },

    // check if the datestamp is from before now and if so return true.
    isExpired(stamp) {
        return new Date(stamp) < new Date();
    },

    // return the localStorage key that is bound to a version of a key.
    formGetter(version, name) {
        return "ls__" + version + "__" + name;
    },

    // create a formData object to put in the data, a signature that it was
    // created with this library, and when it expires (if ever).
    formData(data, expires) {
        return {
            data,
            __valid: true,
            expires: Date.now() + expires,
        };
    },

    getData(version, name) {
        const key = this.formGetter(version, name);
        let data = localStorage.getItem(key);
        data = ls.parseJSON(data);

        if (
            data &&
            data.__valid &&
            // JSON forms of data with `Infinity` turns into `null`,
            // so if null then it hasn't expired since nothing was specified.
            (!ls.isExpired(data.expires) || data.expires === null)
        ) {
            return data;
        }

        return undefined;
    },

    // set the wrapped version of the data into localStorage.
    setData(version, name, data, expires) {
        const key = this.formGetter(version, name);
        const val = this.formData(data, expires);

        localStorage.setItem(key, JSON.stringify(val));
    },

    // remove the key from localStorage and from memory.
    removeData(version, name) {
        const key = this.formGetter(version, name);

        localStorage.removeItem(key);
    },

    // Remove keys which (1) map to a value that satisfies a
    // property tested by `condition_checker` and (2) which match
    // the pattern given by `name`.
    removeDataRegexWithCondition(version, regex, condition_checker) {
        const key_regex = new RegExp(this.formGetter(version, regex));
        const keys = Object.keys(localStorage).filter(
            (key) => key_regex.test(key) && condition_checker(localStorage.getItem(key)),
        );

        for (const key of keys) {
            localStorage.removeItem(key);
        }
    },

    // migrate from an older version of a data src to a newer one with a
    // specified callback function.
    migrate(name, v1, v2, callback) {
        const old = this.getData(v1, name);
        this.removeData(v1, name);

        if (old && old.__valid) {
            const data = callback(old.data);
            this.setData(v2, name, data, Number.POSITIVE_INFINITY);

            return data;
        }

        return undefined;
    },
};

// return a new function instance that has instance-scoped variables.
const localstorage = function () {
    const _data = {
        VERSION: 1,
        expires: Number.POSITIVE_INFINITY,
        expiresIsGlobal: false,
    };

    const prototype = {
        // `expires` should be a Number that represents the number of ms from
        // now that this should expire in.
        // this allows for it to either be set only once or permanently.
        setExpiry(expires, isGlobal) {
            _data.expires = expires;
            _data.expiresIsGlobal = isGlobal || false;

            return this;
        },

        get(name) {
            const data = ls.getData(_data.VERSION, name);

            if (data) {
                return data.data;
            }

            return undefined;
        },

        set(name, data) {
            if (_data.VERSION !== undefined) {
                ls.setData(_data.VERSION, name, data, _data.expires);

                // if the expires attribute was not set as a global, then
                // make sure to return it back to Infinity to not impose
                // constraints on the next key.
                if (!_data.expiresIsGlobal) {
                    _data.expires = Number.POSITIVE_INFINITY;
                }

                return true;
            }

            return false;
        },

        // remove a key with a given version.
        remove(name) {
            ls.removeData(_data.VERSION, name);
        },

        // Remove keys which (1) map to a value that satisfies a
        // property tested by `condition_checker` AND (2) which
        // match the pattern given by `name`.
        removeDataRegexWithCondition(name, condition_checker) {
            ls.removeDataRegexWithCondition(_data.VERSION, name, condition_checker);
        },

        migrate(name, v1, v2, callback) {
            return ls.migrate(name, v1, v2, callback);
        },
    };

    // set a new master version for the LocalStorage instance.
    Object.defineProperty(prototype, "version", {
        get() {
            return _data.VERSION;
        },
        set(version) {
            _data.VERSION = version;
        },
    });

    return prototype;
};

let warned_of_localstorage = false;

localstorage.supported = function supports_localstorage() {
    try {
        return window.localStorage !== undefined && window.localStorage !== null;
    } catch {
        if (!warned_of_localstorage) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Client browser does not support local storage, will lose socket message on reload",
            );
            warned_of_localstorage = true;
        }
        return false;
    }
};


/***/ }),

/***/ "./static/js/markdown.js":
/*!*******************************!*\
  !*** ./static/js/markdown.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_topic_links": () => (/* binding */ add_topic_links),
/* harmony export */   "apply_markdown": () => (/* binding */ apply_markdown),
/* harmony export */   "contains_backend_only_syntax": () => (/* binding */ contains_backend_only_syntax),
/* harmony export */   "get_topic_links": () => (/* binding */ get_topic_links),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_status_message": () => (/* binding */ is_status_message),
/* harmony export */   "parse": () => (/* binding */ parse),
/* harmony export */   "parse2": () => (/* binding */ parse2),
/* harmony export */   "parse_non_message": () => (/* binding */ parse_non_message),
/* harmony export */   "translate_emoticons_to_names": () => (/* binding */ translate_emoticons_to_names)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/isValid/index.js");
/* harmony import */ var katex__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! katex */ "./node_modules/katex/dist/katex.mjs");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/fenced_code */ "./static/shared/js/fenced_code.js");
/* harmony import */ var _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../third/marked/lib/marked.cjs */ "./static/third/marked/lib/marked.cjs");
/* eslint-disable no-else-return */
/* eslint-disable unicorn/catch-error-name */
/* eslint-disable no-console */
/* eslint-disable unicorn/prefer-string-slice */
/* eslint-disable prefer-const */
/* eslint-disable no-undef */
/* eslint-disable guard-for-in */

 // eslint-disable-line import/no-unresolved






// This contains zulip's frontend Markdown implementation; see
// docs/subsystems/markdown.md for docs on our Markdown syntax.  The other
// main piece in rendering Markdown client-side is
// static/third/marked/lib/marked.js, which we have significantly
// modified from the original implementation.

// Docs: https://zulip.readthedocs.io/en/latest/subsystems/markdown.html

// If we see preview-related syntax in our content, we will need the
// backend to render it.
const preview_regexes = [
    // Inline image previews, check for contiguous chars ending in image suffix
    // To keep the below regexes simple, split them out for the end-of-message case

    /\S*(?:\.bmp|\.gif|\.jpg|\.jpeg|\.png|\.webp)\)?\s+/m,
    /\S*(?:\.bmp|\.gif|\.jpg|\.jpeg|\.png|\.webp)\)?$/m,

    // Twitter and youtube links are given previews

    /\S*(?:twitter|youtube)\.com\/\S*/,
];

function contains_preview_link(content) {
    return preview_regexes.some((re) => re.test(content));
}

function translate_emoticons_to_names({src, get_emoticon_translations}) {
    // Translates emoticons in a string to their colon syntax.
    let translated = src;
    let replacement_text;
    const terminal_symbols = ",.;?!()[] \"'\n\t"; // From composebox_typeahead
    const symbols_except_space = terminal_symbols.replace(" ", "");

    const emoticon_replacer = function (match, g1, offset, str) {
        const prev_char = str[offset - 1];
        const next_char = str[offset + match.length];

        const symbol_at_start = terminal_symbols.includes(prev_char);
        const symbol_at_end = terminal_symbols.includes(next_char);
        const non_space_at_start = symbols_except_space.includes(prev_char);
        const non_space_at_end = symbols_except_space.includes(next_char);
        const valid_start = symbol_at_start || offset === 0;
        const valid_end = symbol_at_end || offset === str.length - match.length;

        if (non_space_at_start && non_space_at_end) {
            // Hello!:)?
            return match;
        }
        if (valid_start && valid_end) {
            return replacement_text;
        }
        return match;
    };

    for (const translation of get_emoticon_translations()) {
        // We can't pass replacement_text directly into
        // emoticon_replacer, because emoticon_replacer is
        // a callback for `replace()`.  Instead we just mutate
        // the `replacement_text` that the function closes on.
        replacement_text = translation.replacement_text;
        translated = translated.replace(translation.regex, emoticon_replacer);
    }

    return translated;
}

function contains_problematic_linkifier({content, get_linkifier_map}) {
    // If a linkifier doesn't start with some specified characters
    // then don't render it locally. It is workaround for the fact that
    // javascript regex doesn't support lookbehind.
    for (const re of get_linkifier_map().keys()) {
        const pattern = /[^\s"'(,:<]/.source + re.source + /(?!\w)/.source;
        const regex = new RegExp(pattern);
        if (regex.test(content)) {
            return true;
        }
    }

    return false;
}

function content_contains_backend_only_syntax({content, get_linkifier_map}) {
    // Try to guess whether or not a message contains syntax that only the
    // backend Markdown processor can correctly handle.
    // If it doesn't, we can immediately render it client-side for local echo.
    return (
        contains_preview_link(content) ||
        contains_problematic_linkifier({content, get_linkifier_map})
    );
}

function parse_with_options({raw_content, helper_config, options}) {
    // Given the raw markdown content of a message (raw_content)
    // we return the HTML content (content) and flags.
    // Our caller passes a helper_config object that has several
    // helper functions for getting info about users, streams, etc.
    // And it also passes in options for the marked processor.

    let mentioned = false;
    let mentioned_group = false;
    let mentioned_wildcard = false;

    const marked_options = {
        ...options,
        userMentionHandler(mention, silently) {
            if (mention === "all" || mention === "everyone" || mention === "stream") {
                let classes;
                let display_text;
                if (silently) {
                    classes = "user-mention silent";
                    display_text = mention;
                } else {
                    // Wildcard mention
                    mentioned_wildcard = true;
                    display_text = "@" + mention;
                    classes = "user-mention";
                }

                return `<span class="${classes}" data-user-id="*">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(display_text)}</span>`;
            }

            let full_name;
            let user_id;

            const id_regex = /^(.+)?\|(\d+)$/; // For @**user|id** and @**|id** syntax
            const match = id_regex.exec(mention);

            if (match) {
                /*
                    If we have two users named Alice, we want
                    users to provide mentions like this:

                        alice|42
                        alice|99

                    The autocomplete feature will help users
                    send correct mentions for duplicate names,
                    but we also have to consider the possibility
                    that the user will hand-type something
                    incorrectly, in which case we'll fall
                    through to the other code (which may be a
                    misfeature).
                */
                full_name = match[1];
                user_id = Number.parseInt(match[2], 10);

                if (full_name === undefined) {
                    // For @**|id** syntax
                    if (!helper_config.is_valid_user_id(user_id)) {
                        // silently ignore invalid user id.
                        user_id = undefined;
                    } else {
                        full_name = helper_config.get_actual_name_from_user_id(user_id);
                    }
                } else {
                    // For @**user|id** syntax
                    if (!helper_config.is_valid_full_name_and_user_id(full_name, user_id)) {
                        user_id = undefined;
                        full_name = undefined;
                    }
                }
            }

            if (user_id === undefined) {
                // Handle normal syntax
                full_name = mention;
                user_id = helper_config.get_user_id_from_name(full_name);
            }

            if (user_id === undefined) {
                // This is nothing to be concerned about--the users
                // are allowed to hand-type mentions and they may
                // have had a typo in the name.
                return undefined;
            }

            // HAPPY PATH! Note that we not only need to return the
            // appropriate HTML snippet here; we also want to update
            // flags on the message itself that get used by the message
            // view code and possibly our filtering code.

            // If I mention "@aLiCe sMITH", I still want "Alice Smith" to
            // show in the pill.
            let display_text = helper_config.get_actual_name_from_user_id(user_id);
            let classes;
            if (silently) {
                classes = "user-mention silent";
            } else {
                if (helper_config.my_user_id() === user_id) {
                    // Personal mention of current user.
                    mentioned = true;
                }
                classes = "user-mention";
                display_text = "@" + display_text;
            }

            return `<span class="${classes}" data-user-id="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(user_id)}">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
                display_text,
            )}</span>`;
        },
        groupMentionHandler(name, silently) {
            const group = helper_config.get_user_group_from_name(name);
            if (group !== undefined) {
                let display_text;
                let classes;
                if (silently) {
                    display_text = group.name;
                    classes = "user-group-mention silent";
                } else {
                    display_text = "@" + group.name;
                    classes = "user-group-mention";
                    if (
                        helper_config.is_member_of_user_group(helper_config.my_user_id(), group.id)
                    ) {
                        // Mentioned the current user's group.
                        mentioned_group = true;
                    }
                }

                return `<span class="${classes}" data-user-group-id="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
                    group.id,
                )}">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(display_text)}</span>`;
            }
            return undefined;
        },
        silencedMentionHandler(quote) {
            // Silence quoted mentions.
            quote = quote.replace(
                /(<span class="user-mention)(" data-user-id="(\d+|\*)">)@/g,
                "$1 silent$2",
            );

            // Silence quoted user group mentions.
            quote = quote.replace(
                /(<span class="user-group-mention)(" data-user-group-id="\d+">)@/g,
                "$1 silent$2",
            );

            // In most cases, if you are being mentioned in the message you're quoting, you wouldn't
            // mention yourself outside of the blockquote (and, above it). If that you do that, the
            // following mentioned status is false; the backend rendering is authoritative and the
            // only side effect is the lack red flash on immediately sending the message.
            //
            // A better parser would be able to just ignore mentions
            // inside; we just set all flags to False and let the
            // server rendering correct the message flags, to avoid a
            // flash of mention styling.
            mentioned = false;
            mentioned_group = false;
            mentioned_wildcard = false;
            return quote;
        },
    };

    // Our Python-Markdown processor appends two \n\n to input
    const content = _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__(raw_content + "\n\n", marked_options).trim();

    // Simulate message flags for our locally rendered
    // message. Messages the user themselves sent via the browser are
    // always marked as read.
    const flags = ["read"];
    if (mentioned || mentioned_group) {
        flags.push("mentioned");
    }
    if (mentioned_wildcard) {
        flags.push("wildcard_mentioned");
    }

    return {content, flags};
}

function is_x_between(x, start, length) {
    return start <= x && x < start + length;
}

function is_overlapping(match_a, match_b) {
    return (
        is_x_between(match_a.index, match_b.index, match_b.text.length) ||
        is_x_between(match_b.index, match_a.index, match_a.text.length)
    );
}

function get_topic_links({topic, get_linkifier_map}) {
    // We export this for testing purposes, and mobile may want to
    // use this as well in the future.
    const links = [];
    // The lower the precedence is, the more prioritized the pattern is.
    let precedence = 0;

    for (const [pattern, url] of get_linkifier_map().entries()) {
        let match;
        while ((match = pattern.exec(topic)) !== null) {
            let link_url = url;
            const matched_groups = match.slice(1);
            let i = 0;
            while (i < matched_groups.length) {
                const matched_group = matched_groups[i];
                const current_group = i + 1;
                const back_ref = "\\" + current_group;
                link_url = link_url.replace(back_ref, matched_group);
                i += 1;
            }
            // We store the starting index as well, to sort the order of occurrence of the links
            // in the topic, similar to the logic implemented in zerver/lib/markdown/__init__.py
            links.push({url: link_url, text: match[0], index: match.index, precedence});
        }
        precedence += 1;
    }

    // Sort the matches beforehand so we favor the match with a higher priority and tie-break with the starting index.
    // Note that we sort it before processing the raw URLs so that linkifiers will be prioritized over them.
    links.sort((a, b) => {
        if (a.precedence !== null && b.precedence !== null) {
            // When both of the links have precedence set, find the one that comes first.
            const diff = a.precedence - b.precedence;
            if (diff !== 0) {
                return diff;
            }
        }
        // Fallback to the index when there is either a tie in precedence or at least one of the links is a raw URL.
        return a.index - b.index;
    });

    // Also make raw URLs navigable
    const url_re = /\b(https?:\/\/[^\s<]+[^\s"'),.:;<\]])/g; // Slightly modified from third/marked.js
    let match;
    while ((match = url_re.exec(topic)) !== null) {
        links.push({url: match[0], text: match[0], index: match.index, precedence: null});
    }
    // The following removes overlapping intervals depending on the precedence of linkifier patterns.
    // This uses the same algorithm implemented in zerver/lib/markdown/__init__.py.
    // To avoid mutating links while processing links, the final output gets pushed to another list.
    const applied_matches = [];

    // To avoid mutating matches inside the loop, the final output gets appended to another list.
    for (const new_match of links) {
        // When the current match does not overlap with all existing matches,
        // we are confident that the link should present in the final output because
        //  1. Given that the links are sorted by precedence, the current match has the highest priority
        //     among the matches to be checked.
        //  2. None of the matches with higher priority overlaps with the current match.
        // This might be optimized to search for overlapping matches in O(logn) time,
        // but it is kept as-is since performance is not critical for this codepath and for simplicity.
        if (applied_matches.every((applied_match) => !is_overlapping(applied_match, new_match))) {
            applied_matches.push(new_match);
        }
    }
    // We need to sort applied_matches again because the links were previously ordered by precedence,
    // so that the links are displayed in the order their patterns are matched.
    return applied_matches
        .sort((a, b) => a.index - b.index)
        .map((match) => ({url: match.url, text: match.text}));
}

function is_status_message(raw_content) {
    return raw_content.startsWith("/me ");
}

function make_emoji_span(codepoint, title, alt_text) {
    return `<span aria-label="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(title)}" class="emoji emoji-${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
        codepoint,
    )}" role="img" title="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(title)}">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(alt_text)}</span>`;
}

function handleUnicodeEmoji({unicode_emoji, get_emoji_name}) {
    const codepoint = unicode_emoji.codePointAt(0).toString(16);
    const emoji_name = get_emoji_name(codepoint);

    if (emoji_name) {
        const alt_text = ":" + emoji_name + ":";
        const title = emoji_name.replace(/_/g, " ");
        return make_emoji_span(codepoint, title, alt_text);
    }

    return unicode_emoji;
}

function handleEmoji({emoji_name, get_realm_emoji_url, get_emoji_codepoint}) {
    const alt_text = ":" + emoji_name + ":";
    const title = emoji_name.replace(/_/g, " ");

    // Zulip supports both standard/Unicode emoji, served by a
    // spritesheet and custom realm-specific emoji (served by URL).
    // We first check if this is a realm emoji, and if so, render it.
    //
    // Otherwise we'll look at Unicode emoji to render with an emoji
    // span using the spritesheet; and if it isn't one of those
    // either, we pass through the plain text syntax unmodified.
    const emoji_url = get_realm_emoji_url(emoji_name);

    if (emoji_url) {
        return `<img alt="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(alt_text)}" class="emoji" src="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
            emoji_url,
        )}" title="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(title)}">`;
    }

    const codepoint = get_emoji_codepoint(emoji_name);
    if (codepoint) {
        return make_emoji_span(codepoint, title, alt_text);
    }

    return alt_text;
}

function handleLinkifier({pattern, matches, get_linkifier_map}) {
    let url = get_linkifier_map().get(pattern);

    let current_group = 1;

    for (const match of matches) {
        const back_ref = "\\" + current_group;
        url = url.replace(back_ref, match);
        current_group += 1;
    }

    return url;
}

function handleTimestamp(time) {
    let timeobject;
    if (Number.isNaN(Number(time))) {
        timeobject = new Date(time); // not a Unix timestamp
    } else {
        // JavaScript dates are in milliseconds, Unix timestamps are in seconds
        timeobject = new Date(time * 1000);
    }

    const escaped_time = lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(time);
    if (!(0,date_fns__WEBPACK_IMPORTED_MODULE_4__["default"])(timeobject)) {
        // Unsupported time format: rerender accordingly.

        // We do not show an error on these formats in local echo because
        // there is a chance that the server would interpret it successfully
        // and if it does, the jumping from the error message to a rendered
        // timestamp doesn't look good.
        return `<span>${escaped_time}</span>`;
    }

    // Use html5 <time> tag for valid timestamps.
    // render time without milliseconds.
    const escaped_isotime = lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(timeobject.toISOString().split(".")[0] + "Z");
    return `<time datetime="${escaped_isotime}">${escaped_time}</time>`;
}

function handleStream({stream_name, get_stream_by_name, stream_hash}) {
    const stream = get_stream_by_name(stream_name);
    if (stream === undefined) {
        return undefined;
    }
    const href = stream_hash(stream.stream_id);
    return `<a class="stream" data-stream-id="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(stream.stream_id)}" href="/${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
        href,
    )}">#${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(stream.name)}</a>`;
}

function handleStreamTopic({stream_name, topic, get_stream_by_name, stream_topic_hash}) {
    const stream = get_stream_by_name(stream_name);
    if (stream === undefined || !topic) {
        return undefined;
    }
    const href = stream_topic_hash(stream.stream_id, topic);
    const text = `#${stream.name} > ${topic}`;
    return `<a class="stream-topic" data-stream-id="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
        stream.stream_id,
    )}" href="/${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(href)}">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(text)}</a>`;
}

function handleTex(tex, fullmatch) {
    try {
        return katex__WEBPACK_IMPORTED_MODULE_0__["default"].renderToString(tex);
    } catch (error) {
        if (error.message.startsWith("KaTeX parse error")) {
            // TeX syntax error
            return `<span class="tex-error">${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(fullmatch)}</span>`;
        }
        throw new Error(error.message);
    }
}

function parse({raw_content, helper_config}) {
    function get_linkifier_regexes() {
        return Array.from(helper_config.get_linkifier_map().keys());
    }

    function disable_markdown_regex(rules, name) {
        rules[name] = {
            exec() {
                return false;
            },
        };
    }

    // Configure the marked Markdown parser for our usage
    const renderer = new _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.Renderer();

    // No <code> around our code blocks instead a codehilite <div> and disable
    // class-specific highlighting.
    renderer.code = (code) => _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__.wrap_code(code) + "\n\n";

    // Prohibit empty links for some reason.
    const old_link = renderer.link;
    renderer.link = (href, title, text) =>
        old_link.call(renderer, href, title, text.trim() ? text : href);

    // Put a newline after a <br> in the generated HTML to match Markdown
    renderer.br = function () {
        return "<br>\n";
    };

    function preprocess_code_blocks(src) {
        return _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__.process_fenced_code(src);
    }

    function preprocess_translate_emoticons(src) {
        if (!helper_config.should_translate_emoticons()) {
            return src;
        }

        // In this scenario, the message has to be from the user, so the only
        // requirement should be that they have the setting on.
        return translate_emoticons_to_names({
            src,
            get_emoticon_translations: helper_config.get_emoticon_translations,
        });
    }

    // Disable headings
    // We only keep the # Heading format.
    disable_markdown_regex(_third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.Lexer.rules.tables, "lheading");

    // Disable __strong__ (keeping **strong**)
    _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.InlineLexer.rules.zulip.strong = /^\*\*([\S\s]+?)\*\*(?!\*)/;

    // Make sure <del> syntax matches the backend processor
    _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.InlineLexer.rules.zulip.del = /^(?!<~)~~([^~]+)~~(?!~)/;

    // Disable _emphasis_ (keeping *emphasis*)
    // Text inside ** must start and end with a word character
    // to prevent mis-parsing things like "char **x = (char **)y"
    _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.InlineLexer.rules.zulip.em = /^\*(?!\s+)((?:\*\*|[\S\s])+?)(\S)\*(?!\*)/;

    // Disable autolink as (a) it is not used in our backend and (b) it interferes with @mentions
    disable_markdown_regex(_third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.InlineLexer.rules.zulip, "autolink");

    // Tell our fenced code preprocessor how to insert arbitrary
    // HTML into the output. This generated HTML is safe to not escape
    _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__.set_stash_func((html) => _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.stashHtml(html, true));

    function streamHandler(stream_name) {
        return handleStream({
            stream_name,
            get_stream_by_name: helper_config.get_stream_by_name,
            stream_hash: helper_config.stream_hash,
        });
    }

    function streamTopicHandler(stream_name, topic) {
        return handleStreamTopic({
            stream_name,
            topic,
            get_stream_by_name: helper_config.get_stream_by_name,
            stream_topic_hash: helper_config.stream_topic_hash,
        });
    }

    function emojiHandler(emoji_name) {
        return handleEmoji({
            emoji_name,
            get_realm_emoji_url: helper_config.get_realm_emoji_url,
            get_emoji_codepoint: helper_config.get_emoji_codepoint,
        });
    }

    function unicodeEmojiHandler(unicode_emoji) {
        return handleUnicodeEmoji({
            unicode_emoji,
            get_emoji_name: helper_config.get_emoji_name,
        });
    }

    function linkifierHandler(pattern, matches) {
        return handleLinkifier({
            pattern,
            matches,
            get_linkifier_map: helper_config.get_linkifier_map,
        });
    }

    const options = {
        get_linkifier_regexes,
        linkifierHandler,
        emojiHandler,
        unicodeEmojiHandler,
        streamHandler,
        streamTopicHandler,
        texHandler: handleTex,
        timestampHandler: handleTimestamp,
        gfm: true,
        tables: true,
        breaks: true,
        pedantic: false,
        sanitize: true,
        smartLists: true,
        smartypants: false,
        zulip: true,
        renderer,
        preprocessors: [preprocess_code_blocks, preprocess_translate_emoticons],
    };

    return parse_with_options({raw_content, helper_config, options});
}

// NOTE: Everything below this line is likely to be web-specific
//       and won't be used by future platforms such as mobile.
//       We may eventually move this code to a new file, but we want
//       to wait till the dust settles a bit on some other changes first.

let web_app_helpers;

function initialize(helper_config) {
    // This is generally only intended to be called by the web app. Most
    // other platforms should call setup().
    web_app_helpers = helper_config;
}

function apply_markdown(message) {
    // This is generally only intended to be called by the web app. Most
    // other platforms should call parse().
    const raw_content = message.raw_content;
    const {content, flags} = parse({raw_content, helper_config: web_app_helpers});
    message.content = content;
    message.flags = flags;
    message.is_me_message = is_status_message(raw_content);
}

function add_topic_links(message) {
    if (message.type !== "stream") {
        message.topic_links = [];
        return;
    }
    message.topic_links = get_topic_links({
        topic: message.topic,
        get_linkifier_map: web_app_helpers.get_linkifier_map,
    });
}

function contains_backend_only_syntax(content) {
    return content_contains_backend_only_syntax({
        content,
        get_linkifier_map: web_app_helpers.get_linkifier_map,
    });
}

function parse_non_message(raw_content) {
    // Occasionally we get markdown from the server that is not technically
    // a message, but we want to convert it to HTML. Note that we parse
    // raw_content exactly as if it were a Zulip message, so we will
    // handle things like mentions, stream links, and linkifiers.
    return parse({raw_content, helper_config: web_app_helpers}).content;
}

// eslint-disable-next-line no-unused-vars
function parse_with_options2({raw_content, options}) {

    const marked_options = {
        ...options,
        // // redering 부문에서 사용되고 있어 추가함
        // silencedMentionHandler(quote) {
        //     return quote;
        // },        
    };

    // Our Python-Markdown processor appends two \n\n to input
    // const content = marked.parse(raw_content + "\n\n", marked_options).trim();
    // const content = marked.parse(raw_content + "\n\n",marked_options);
    // const content = marked.parse(raw_content + "\n\n",marked_options).trim();
    const content = _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.parse(raw_content + "\n\n",marked_options).trim();

    return content;
}

function parse2(raw_content) {
    // Configure the marked Markdown parser for our usage
    const renderer = new _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.Renderer();

    // No <code> around our code blocks instead a codehilite <div> and disable
    // class-specific highlighting.
    renderer.code = (code) => _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__.wrap_code(code) + "\n\n";

    // Prohibit empty links for some reason.
    const old_link = renderer.link;
    renderer.link = (href, title, text) =>
        old_link.call(renderer, href, title, text.trim() ? text : href);

    // Math Tex 처리
    const originParagraph = renderer.paragraph.bind(renderer)
    renderer.paragraph = (text) => {
      const blockRegex = /\$\$[^$]*\$\$/g
      const inlineRegex = /\$[^$]*\$/g
      const blockExprArray = text.match(blockRegex)
      const inlineExprArray = text.match(inlineRegex)
      // eslint-disable-next-line guard-for-in
      for ( let i in blockExprArray) {
        const expr = blockExprArray[i]
        const result = renderMathsExpression(expr)
        text = text.replace(expr, result)
      }
      for (let i in inlineExprArray) {
        const expr = inlineExprArray[i]
        const result = renderMathsExpression(expr)
        text = text.replace(expr, result)
      }
      return originParagraph(text)
    }
    function renderMathsExpression (expr) {
      if (expr[0] === '$' && expr[expr.length - 1] === '$') {
        let displayStyle = false
        expr = expr.substr(1, expr.length - 2)
        if (expr[0] === '$' && expr[expr.length - 1] === '$') {
          displayStyle = true
          expr = expr.substr(1, expr.length - 2)
        }
        let html = null
        try {
          html = katex__WEBPACK_IMPORTED_MODULE_0__["default"].renderToString(expr)
        } catch (e) {
          console.err(e)
        }
        if (displayStyle && html) {
          html = html.replace(/class="katex"/g, 'class="katex katex-block" style="display: block;"')
        }
        return html
      } else {
        return null
      }
    }  
   
    const options = {
        gfm: true,
        breaks: true,
        pedantic: false,
        renderer,
    };    
    try {
        // math 처리
        let src = _shared_js_fenced_code__WEBPACK_IMPORTED_MODULE_2__.process_fenced_code(raw_content)
        _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.setOptions(options)
        const content = _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.parse(src + "\n\n").trim();
        // console.log(content);
        return content;         
      } catch (e) {
        e.message += "\nPlease report this to https://zulip.com/development-community/";
        if ((options || _third_marked_lib_marked_cjs__WEBPACK_IMPORTED_MODULE_3__.defaults).silent) {
          return '<p>An error occurred:</p><pre>'
            + escape(String(e.message), true)
            + '</pre>';
        }
        throw e;
      }    
   
}

/***/ }),

/***/ "./static/js/message_edit.js":
/*!***********************************!*\
  !*** ./static/js/message_edit.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "can_move_message": () => (/* binding */ can_move_message),
/* harmony export */   "delete_message": () => (/* binding */ delete_message),
/* harmony export */   "delete_topic": () => (/* binding */ delete_topic),
/* harmony export */   "edit_last_sent_message": () => (/* binding */ edit_last_sent_message),
/* harmony export */   "end_if_focused_on_inline_topic_edit": () => (/* binding */ end_if_focused_on_inline_topic_edit),
/* harmony export */   "end_if_focused_on_message_row_edit": () => (/* binding */ end_if_focused_on_message_row_edit),
/* harmony export */   "end_inline_topic_edit": () => (/* binding */ end_inline_topic_edit),
/* harmony export */   "end_message_edit": () => (/* binding */ end_message_edit),
/* harmony export */   "end_message_row_edit": () => (/* binding */ end_message_row_edit),
/* harmony export */   "get_available_streams_for_moving_messages": () => (/* binding */ get_available_streams_for_moving_messages),
/* harmony export */   "get_deletability": () => (/* binding */ get_deletability),
/* harmony export */   "handle_narrow_deactivated": () => (/* binding */ handle_narrow_deactivated),
/* harmony export */   "hide_message_edit_spinner": () => (/* binding */ hide_message_edit_spinner),
/* harmony export */   "is_content_editable": () => (/* binding */ is_content_editable),
/* harmony export */   "is_editing": () => (/* binding */ is_editing),
/* harmony export */   "is_message_editable_ignoring_permissions": () => (/* binding */ is_message_editable_ignoring_permissions),
/* harmony export */   "is_topic_editable": () => (/* binding */ is_topic_editable),
/* harmony export */   "maybe_show_edit": () => (/* binding */ maybe_show_edit),
/* harmony export */   "move_topic_containing_message_to_stream": () => (/* binding */ move_topic_containing_message_to_stream),
/* harmony export */   "notify_new_thread_default": () => (/* binding */ notify_new_thread_default),
/* harmony export */   "notify_old_thread_default": () => (/* binding */ notify_old_thread_default),
/* harmony export */   "save_inline_topic_edit": () => (/* binding */ save_inline_topic_edit),
/* harmony export */   "save_message_row_edit": () => (/* binding */ save_message_row_edit),
/* harmony export */   "show_message_edit_spinner": () => (/* binding */ show_message_edit_spinner),
/* harmony export */   "show_topic_edit_spinner": () => (/* binding */ show_topic_edit_spinner),
/* harmony export */   "start": () => (/* binding */ start),
/* harmony export */   "start_inline_topic_edit": () => (/* binding */ start_inline_topic_edit),
/* harmony export */   "stream_and_topic_exist_in_edit_history": () => (/* binding */ stream_and_topic_exist_in_edit_history),
/* harmony export */   "toggle_resolve_topic": () => (/* binding */ toggle_resolve_topic),
/* harmony export */   "with_first_message_id": () => (/* binding */ with_first_message_id)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_message_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_message.hbs */ "./static/templates/confirm_dialog/confirm_delete_message.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_message_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_message_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_message_edit_form_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/message_edit_form.hbs */ "./static/templates/message_edit_form.hbs");
/* harmony import */ var _templates_message_edit_form_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_message_edit_form_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_topic_edit_form_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/topic_edit_form.hbs */ "./static/templates/topic_edit_form.hbs");
/* harmony import */ var _templates_topic_edit_form_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_topic_edit_form_hbs__WEBPACK_IMPORTED_MODULE_5__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _composebox_typeahead__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./composebox_typeahead */ "./static/js/composebox_typeahead.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _echo__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./echo */ "./static/js/echo.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _upload__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./upload */ "./static/js/upload.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


































const currently_editing_messages = new Map();
let currently_deleting_messages = [];
let currently_topic_editing_messages = [];
const currently_echoing_messages = new Map();

// These variables are designed to preserve the user's most recent
// choices when editing a group of messages, to make it convenient to
// move several topics in a row with the same settings.
let notify_old_thread_default = false;

let notify_new_thread_default = true;

function is_topic_editable(message, edit_limit_seconds_buffer = 0) {
    if (!is_message_editable_ignoring_permissions(message)) {
        return false;
    }

    if (message.type !== "stream") {
        return false;
    }

    if (message.topic === _compose__WEBPACK_IMPORTED_MODULE_8__.empty_topic_placeholder()) {
        return true;
    }

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return false;
    }

    // Organization admins and moderators can edit message topics indefinitely,
    // irrespective of the topic editing deadline, if edit_topic_policy allows
    // them to do so.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    // If you're using community topic editing, there's a deadline.
    return (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
            edit_limit_seconds_buffer +
            (message.timestamp - Date.now() / 1000) >
        0
    );
}

function is_widget_message(message) {
    if (message.submessages && message.submessages.length !== 0) {
        return true;
    }
    return false;
}

function is_message_editable_ignoring_permissions(message) {
    if (!message) {
        return false;
    }

    if (message.failed_request) {
        // TODO: For completely failed requests, we should be able
        //       to "edit" the message, but it won't really be like
        //       other message updates.  This commit changed the result
        //       from FULL to NO, since the prior implementation was
        //       buggy.
        return false;
    }

    // Locally echoed messages are not editable, since the message hasn't
    // finished being sent yet.
    if (message.locally_echoed) {
        return false;
    }

    // Messages where we're currently locally echoing an edit not yet acknowledged
    // by the server.
    if (currently_echoing_messages.has(message.id)) {
        return false;
    }
    return true;
}

function is_content_editable(message, edit_limit_seconds_buffer = 0) {
    if (!is_message_editable_ignoring_permissions(message)) {
        return false;
    }

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    if (!message.sent_by_me) {
        return false;
    }

    if (is_widget_message(message)) {
        return false;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === null) {
        return true;
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
            edit_limit_seconds_buffer +
            (message.timestamp - Date.now() / 1000) >
        0
    ) {
        return true;
    }
    return false;
}

function get_deletability(message) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    if (!message.sent_by_me) {
        return false;
    }
    if (message.locally_echoed) {
        return false;
    }
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return false;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === null) {
        // This means no time limit for message deletion.
        return true;
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
            (message.timestamp - Date.now() / 1000) >
        0
    ) {
        return true;
    }
    return false;
}

function can_move_message(message) {
    if (!message.is_stream) {
        return false;
    }

    if (!is_message_editable_ignoring_permissions(message)) {
        return false;
    }

    return is_topic_editable(message) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
}

function stream_and_topic_exist_in_edit_history(message, stream_id, topic) {
    /*  Checks to see if a stream_id and a topic match any historical
        stream_id and topic state in the message's edit history.

        Does not check the message's current stream_id and topic for
        a match to the stream_id and topic parameters.
     */
    const narrow_dict = {stream_id, topic};
    const message_dict = {stream_id: message.stream_id, topic: message.topic};

    if (!message.edit_history) {
        // If message edit history is disabled in the organization,
        // the client does not have the information locally to answer
        // this question correctly.
        return false;
    }

    for (const edit_history_event of message.edit_history) {
        if (!edit_history_event.prev_stream && !edit_history_event.prev_topic) {
            // Message was not moved in this edit event.
            continue;
        }

        if (edit_history_event.prev_stream) {
            // This edit event changed the stream.  We expect the
            // following to be true due to the invariants of the edit
            // history data structure:
            // edit_history_event.stream === message_dict.stream_id
            message_dict.stream_id = edit_history_event.prev_stream;
        }

        if (edit_history_event.prev_topic) {
            // This edit event changed the topic.  We expect the
            // following to be true due to the invariants of the edit
            // history data structure:
            // util.lower_same(edit_history_event.topic, message_dict.topic)
            message_dict.topic = edit_history_event.prev_topic;
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(narrow_dict, message_dict)) {
            return true;
        }
    }

    return false;
}

function hide_message_edit_spinner($row) {
    $row.find(".loader").hide();
    $row.find(".message_edit_save span").show();
    $row.find(".message_edit_save").removeClass("disable-btn");
    $row.find(".message_edit_cancel").removeClass("disable-btn");
}

function show_message_edit_spinner($row) {
    const using_dark_theme = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($row.find(".loader"), using_dark_theme);
    $row.find(".message_edit_save span").hide();
    $row.find(".message_edit_save").addClass("disable-btn");
    $row.find(".message_edit_cancel").addClass("disable-btn");
}

function show_topic_edit_spinner($row) {
    const $spinner = $row.find(".topic_edit_spinner");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
    $spinner.css({height: ""});
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".topic_edit_save").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".topic_edit_cancel").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".topic_edit_spinner").show();
}

function end_if_focused_on_inline_topic_edit() {
    const $focused_elem = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".topic_edit_form").find(":focus");
    if ($focused_elem.length === 1) {
        $focused_elem.trigger("blur");
        const $recipient_row = $focused_elem.closest(".recipient_row");
        end_inline_topic_edit($recipient_row);
    }
}

function end_if_focused_on_message_row_edit() {
    const $focused_elem = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_edit").find(":focus");
    if ($focused_elem.length === 1) {
        $focused_elem.trigger("blur");
        const $row = $focused_elem.closest(".message_row");
        end_message_row_edit($row);
    }
}

function handle_message_row_edit_keydown(e) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).hasClass("message_edit_content")) {
            // Pressing Enter to save edits is coupled with Enter to send
            if (_composebox_typeahead__WEBPACK_IMPORTED_MODULE_11__.should_enter_send(e)) {
                const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_edit_content:focus").closest(".message_row");
                const $message_edit_save_button = $row.find(".message_edit_save");
                if ($message_edit_save_button.prop("disabled")) {
                    // In cases when the save button is disabled
                    // we need to disable save on pressing Enter
                    // Prevent default to avoid new-line on pressing
                    // Enter inside the textarea in this case
                    e.preventDefault();
                    return;
                }
                save_message_row_edit($row);
                e.stopPropagation();
                e.preventDefault();
            } else {
                _composebox_typeahead__WEBPACK_IMPORTED_MODULE_11__.handle_enter(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target), e);
                return;
            }
        } else if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".typeahead:visible").length > 0) {
            // Accepting typeahead is handled by the typeahead library.
            return;
        } else if (
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).hasClass("message_edit_topic") ||
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).hasClass("message_edit_topic_propagate")
        ) {
            // Enter should save the topic edit, as long as it's
            // not being used to accept typeahead.
            const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".message_row");
            save_message_row_edit($row);
            e.stopPropagation();
        }
    } else if (e.key === "Escape") {
        end_if_focused_on_message_row_edit();
        e.stopPropagation();
        e.preventDefault();
    }
}

function handle_inline_topic_edit_keydown(e) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
        // Handle Enter key in the recipient bar/inline topic edit form
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".typeahead:visible").length > 0) {
            // Accepting typeahead should not trigger a save.
            e.preventDefault();
            return;
        }
        const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".recipient_row");
        save_inline_topic_edit($row);
        e.stopPropagation();
        e.preventDefault();
    } else if (e.key === "Escape") {
        // Handle Esc
        end_if_focused_on_inline_topic_edit();
        e.stopPropagation();
        e.preventDefault();
    }
}

function timer_text(seconds_left) {
    const minutes = Math.floor(seconds_left / 60);
    const seconds = seconds_left % 60;
    if (minutes >= 1) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "{minutes} min to edit"}, {minutes: minutes.toString()});
    } else if (seconds_left >= 10) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "{seconds} sec to edit"},
            {seconds: (seconds - (seconds % 5)).toString()},
        );
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "{seconds} sec to edit"}, {seconds: seconds.toString()});
}

function create_copy_to_clipboard_handler($row, source, message_id) {
    const clipboard = new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())(source, {
        target: () =>
            document.querySelector(`#edit_form_${CSS.escape(message_id)} .message_edit_content`),
    });

    clipboard.on("success", () => {
        end_message_row_edit($row);
        $row.find(".alert-msg").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Copied!"}));
        $row.find(".alert-msg").css("display", "block");
        $row.find(".alert-msg").delay(1000).fadeOut(300);
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".tooltip").is(":visible")) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".tooltip").hide();
        }
    });
}

function get_available_streams_for_moving_messages(current_stream_id) {
    return _stream_data__WEBPACK_IMPORTED_MODULE_22__.subscribed_subs()
        .filter((stream) => {
            if (stream.stream_id === current_stream_id) {
                return true;
            }
            return _stream_data__WEBPACK_IMPORTED_MODULE_22__.can_post_messages_in_stream(stream);
        })
        .map((stream) => ({
            name: stream.name,
            value: stream.stream_id.toString(),
        }))
        .sort((a, b) => {
            if (a.name.toLowerCase() < b.name.toLowerCase()) {
                return -1;
            }
            if (a.name.toLowerCase() > b.name.toLowerCase()) {
                return 1;
            }
            return 0;
        });
}

function edit_message($row, raw_content) {
    $row.find(".message_reactions").hide();
    _condense__WEBPACK_IMPORTED_MODULE_12__.hide_message_expander($row);
    _condense__WEBPACK_IMPORTED_MODULE_12__.hide_message_condenser($row);
    const content_top = $row.find(".message_top_line")[0].getBoundingClientRect().top;

    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row));

    // We potentially got to this function by clicking a button that implied the
    // user would be able to edit their message.  Give a little bit of buffer in
    // case the button has been around for a bit, e.g. we show the
    // edit_content_button (hovering pencil icon) as long as the user would have
    // been able to click it at the time the mouse entered the message_row. Also
    // a buffer in case their computer is slow, or stalled for a second, etc
    // If you change this number also change edit_limit_buffer in
    // zerver.actions.message_edit.check_update_message
    const seconds_left_buffer = 5;
    const max_file_upload_size = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    let file_upload_enabled = false;

    if (max_file_upload_size > 0) {
        file_upload_enabled = true;
    }

    const is_editable = is_content_editable(message, seconds_left_buffer);

    const $form = jquery__WEBPACK_IMPORTED_MODULE_1___default()(
        _templates_message_edit_form_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
            message_id: message.id,
            is_editable,
            content: raw_content,
            file_upload_enabled,
            minutes_to_edit: Math.floor(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) / 60),
            max_message_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        }),
    );

    const edit_obj = {$form, raw_content};
    currently_editing_messages.set(message.id, edit_obj);
    _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.show_edit_message($row, edit_obj);

    $form.on("keydown", handle_message_row_edit_keydown);

    $form
        .find(".message-edit-feature-group .video_link")
        .toggle(_compose__WEBPACK_IMPORTED_MODULE_8__.compute_show_video_chat_button());
    _upload__WEBPACK_IMPORTED_MODULE_23__.feature_check(jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#edit_form_${CSS.escape(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row))} .compose_upload_file`));

    const $message_edit_content = $row.find("textarea.message_edit_content");
    const $message_edit_countdown_timer = $row.find(".message_edit_countdown_timer");
    const $copy_message = $row.find(".copy_message");

    if (!is_editable) {
        $message_edit_content.attr("readonly", "readonly");
        create_copy_to_clipboard_handler($row, $copy_message[0], message.id);
    } else {
        $copy_message.remove();
        const edit_id = `#edit_form_${CSS.escape(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row))} .message_edit_content`;
        const listeners = _resize__WEBPACK_IMPORTED_MODULE_20__.watch_manual_resize(edit_id);
        if (listeners) {
            currently_editing_messages.get(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row)).listeners = listeners;
        }
        _composebox_typeahead__WEBPACK_IMPORTED_MODULE_11__.initialize_compose_typeahead(edit_id);
        _compose_ui__WEBPACK_IMPORTED_MODULE_10__.handle_keyup(null, jquery__WEBPACK_IMPORTED_MODULE_1___default()(edit_id).expectOne());
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(edit_id).on("keydown", function (event) {
            _compose_ui__WEBPACK_IMPORTED_MODULE_10__.handle_keydown(event, jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).expectOne());
        });
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(edit_id).on("keyup", function (event) {
            _compose_ui__WEBPACK_IMPORTED_MODULE_10__.handle_keyup(event, jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).expectOne());
        });
    }

    // Add tooltip and timer
    if (is_editable && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) > 0) {
        $row.find(".message-edit-timer").show();

        // Give them at least 10 seconds.
        // If you change this number also change edit_limit_buffer in
        // zerver.actions.message_edit.check_update_message
        const min_seconds_to_edit = 10;
        let seconds_left =
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
            (message.timestamp - Date.now() / 1000);
        seconds_left = Math.floor(Math.max(seconds_left, min_seconds_to_edit));

        // I believe this needs to be defined outside the countdown_timer, since
        // row just refers to something like the currently selected message, and
        // can change out from under us
        const $message_edit_save = $row.find("button.message_edit_save");
        // Do this right away, rather than waiting for the timer to do its first update,
        // since otherwise there is a noticeable lag
        $message_edit_countdown_timer.text(timer_text(seconds_left));
        const countdown_timer = setInterval(() => {
            seconds_left -= 1;
            if (seconds_left <= 0) {
                clearInterval(countdown_timer);
                $message_edit_content.prop("readonly", "readonly");
                // We don't go directly to a "TOPIC_ONLY" type state (with an active Save button),
                // since it isn't clear what to do with the half-finished edit. It's nice to keep
                // the half-finished edit around so that they can copy-paste it, but we don't want
                // people to think "Save" will save the half-finished edit.
                $message_edit_save.addClass("disabled");
                $message_edit_countdown_timer.text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Time's up!"}));
            } else {
                $message_edit_countdown_timer.text(timer_text(seconds_left));
            }
        }, 1000);
    }

    if (!is_editable) {
        $row.find(".message_edit_close").trigger("focus");
    } else {
        $message_edit_content.trigger("focus");
        // Put cursor at end of input.
        const contents = $message_edit_content.val();
        $message_edit_content.val("");
        $message_edit_content.val(contents);
    }

    // Scroll to keep the top of the message content text in the same
    // place visually, adjusting for border and padding.
    const edit_top = $message_edit_content[0].getBoundingClientRect().top;
    const scroll_by = edit_top - content_top + 5 - 14;

    edit_obj.scrolled_by = scroll_by;
    _message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop(_message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop() + scroll_by);
}

function start_edit_maintaining_scroll($row, content) {
    edit_message($row, content);
    const row_bottom = $row.height() + $row.offset().top;
    const composebox_top = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").offset().top;
    if (row_bottom > composebox_top) {
        _message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop(_message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop() + row_bottom - composebox_top);
    }
}

function start_edit_with_content($row, content, edit_box_open_callback) {
    start_edit_maintaining_scroll($row, content);
    if (edit_box_open_callback) {
        edit_box_open_callback();
    }

    _upload__WEBPACK_IMPORTED_MODULE_23__.setup_upload({
        mode: "edit",
        row: _rows__WEBPACK_IMPORTED_MODULE_21__.id($row),
    });
}

function start($row, edit_box_open_callback) {
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row));
    if (message === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Couldn't find message ID for edit " + _rows__WEBPACK_IMPORTED_MODULE_21__.id($row));
        return;
    }

    if (message.raw_content) {
        start_edit_with_content($row, message.raw_content, edit_box_open_callback);
        return;
    }

    const msg_list = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current;
    _channel__WEBPACK_IMPORTED_MODULE_7__.get({
        url: "/json/messages/" + message.id,
        success(data) {
            if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current === msg_list) {
                message.raw_content = data.raw_content;
                start_edit_with_content($row, message.raw_content, edit_box_open_callback);
            }
        },
    });
}

function toggle_resolve_topic(message_id, old_topic_name) {
    let new_topic_name;
    if (_shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(old_topic_name)) {
        new_topic_name = _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.unresolve_name(old_topic_name);
    } else {
        new_topic_name = _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.resolve_name(old_topic_name);
    }

    const request = {
        propagate_mode: "change_all",
        topic: new_topic_name,
        send_notification_to_old_thread: false,
        send_notification_to_new_thread: true,
    };

    _channel__WEBPACK_IMPORTED_MODULE_7__.patch({
        url: "/json/messages/" + message_id,
        data: request,
    });
}

function start_inline_topic_edit($recipient_row) {
    const $form = jquery__WEBPACK_IMPORTED_MODULE_1___default()(
        _templates_topic_edit_form_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
            max_topic_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        }),
    );
    _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.show_edit_topic_on_recipient_row($recipient_row, $form);
    $form.on("keydown", handle_inline_topic_edit_keydown);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".topic_edit_spinner").hide();
    const msg_id = _rows__WEBPACK_IMPORTED_MODULE_21__.id_for_recipient_row($recipient_row);
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(msg_id);
    let topic = message.topic;
    if (topic === _compose__WEBPACK_IMPORTED_MODULE_8__.empty_topic_placeholder()) {
        topic = "";
    }
    const $inline_topic_edit_input = $form.find(".inline_topic_edit");
    $inline_topic_edit_input.val(topic).trigger("select").trigger("focus");
    _composebox_typeahead__WEBPACK_IMPORTED_MODULE_11__.initialize_topic_edit_typeahead(
        $inline_topic_edit_input,
        message.stream,
        false,
    );
}

function is_editing(id) {
    return currently_editing_messages.has(id);
}

function end_inline_topic_edit($row) {
    _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.hide_edit_topic_on_recipient_row($row);
}

function end_message_row_edit($row) {
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(_rows__WEBPACK_IMPORTED_MODULE_21__.id($row));
    if (message !== undefined && currently_editing_messages.has(message.id)) {
        const scroll_by = currently_editing_messages.get(message.id).scrolled_by;
        const original_scrollTop = _message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop();

        // Clean up resize event listeners
        const listeners = currently_editing_messages.get(message.id).listeners;
        const edit_box = document.querySelector(
            `#edit_form_${CSS.escape(message.id)} .message_edit_content`,
        );
        if (listeners !== undefined) {
            // Event listeners to clean up are only set in some edit types
            edit_box.removeEventListener("mousedown", listeners[0]);
            document.body.removeEventListener("mouseup", listeners[1]);
        }

        currently_editing_messages.delete(message.id);
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.hide_edit_message($row);
        _message_viewport__WEBPACK_IMPORTED_MODULE_19__.scrollTop(original_scrollTop - scroll_by);

        _compose__WEBPACK_IMPORTED_MODULE_8__.abort_video_callbacks(message.id);
    }
    if ($row.find(".condensed").length !== 0) {
        _condense__WEBPACK_IMPORTED_MODULE_12__.show_message_expander($row);
    } else {
        _condense__WEBPACK_IMPORTED_MODULE_12__.show_message_condenser($row);
    }
    $row.find(".message_reactions").show();

    // We have to blur out text fields, or else hotkeys.js
    // thinks we are still editing.
    $row.find(".message_edit").trigger("blur");
    // We should hide the editing typeahead if it is visible
    $row.find("input.message_edit_topic").trigger("blur");
}

function end_message_edit(message_id) {
    const $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(message_id);
    if ($row.length > 0) {
        end_message_row_edit($row);
    } else if (currently_editing_messages.has(message_id)) {
        // We should delete the message_id from currently_editing_messages
        // if it exists there but we cannot find the row.
        currently_editing_messages.delete(message_id);
    }
}

function save_inline_topic_edit($row) {
    const msg_list = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current;
    let message_id = _rows__WEBPACK_IMPORTED_MODULE_21__.id_for_recipient_row($row);
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(message_id);

    const old_topic = message.topic;
    const new_topic = $row.find(".inline_topic_edit").val();
    const topic_changed = new_topic !== old_topic && new_topic.trim() !== "";

    if (!topic_changed) {
        // this means the inline_topic_edit was opened and submitted without
        // changing anything, therefore, we should just close the inline topic edit.
        end_inline_topic_edit($row);
        return;
    }

    show_topic_edit_spinner($row);

    if (message.locally_echoed) {
        if (topic_changed) {
            _echo__WEBPACK_IMPORTED_MODULE_15__.edit_locally(message, {new_topic});
            $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(message_id);
        }
        end_inline_topic_edit($row);
        return;
    }

    const request = {
        message_id: message.id,
        topic: new_topic,
        propagate_mode: "change_later",
        send_notification_to_old_thread: false,
        send_notification_to_new_thread: false,
    };

    _channel__WEBPACK_IMPORTED_MODULE_7__.patch({
        url: "/json/messages/" + message.id,
        data: request,
        success() {
            const $spinner = $row.find(".topic_edit_spinner");
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
        },
        error(xhr) {
            const $spinner = $row.find(".topic_edit_spinner");
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
            if (msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_17__.current) {
                message_id = _rows__WEBPACK_IMPORTED_MODULE_21__.id_for_recipient_row($row);
                const message = _channel__WEBPACK_IMPORTED_MODULE_7__.xhr_error_message(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error saving edit"}),
                    xhr,
                );
                $row.find(".edit_error").text(message).css("display", "inline-block");
            }
        },
    });
}

function save_message_row_edit($row) {
    const msg_list = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current;
    let message_id = _rows__WEBPACK_IMPORTED_MODULE_21__.id($row);
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(message_id);
    let changed = false;
    let edit_locally_echoed = false;

    let new_content;
    const old_content = message.raw_content;

    show_message_edit_spinner($row);

    const $edit_content_input = $row.find(".message_edit_content");
    const can_edit_content = $edit_content_input.attr("readonly") !== "readonly";
    if (can_edit_content) {
        new_content = $edit_content_input.val();
        changed = old_content !== new_content;
    }

    // Editing a not-yet-acked message (because the original send attempt failed)
    // just results in the in-memory message being changed
    if (message.locally_echoed) {
        if (new_content !== message.raw_content) {
            // `edit_locally` handles the case where `new_topic/new_stream_id` is undefined
            _echo__WEBPACK_IMPORTED_MODULE_15__.edit_locally(message, {
                raw_content: new_content,
            });
            $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(message_id);
        }
        end_message_row_edit($row);
        return;
    }

    if (!changed) {
        // If they didn't change anything, just cancel it.
        end_message_row_edit($row);
        return;
    }

    const request = {message_id: message.id, content: new_content};

    if (!_markdown__WEBPACK_IMPORTED_MODULE_16__.contains_backend_only_syntax(new_content)) {
        // If the new message content could have been locally echoed,
        // than we can locally echo the edit.
        currently_echoing_messages.set(message_id, {
            raw_content: new_content,
            orig_content: message.content,
            orig_raw_content: message.raw_content,

            // Store flags that are about user interaction with the
            // message so that echo.edit_locally() can restore these
            // flags.
            starred: message.starred,
            historical: message.historical,
            collapsed: message.collapsed,

            // These flags are rendering artifacts we'll want if the
            // edit fails and we need to revert to the original
            // rendering of the message.
            alerted: message.alerted,
            mentioned: message.mentioned,
            mentioned_me_directly: message.mentioned,
        });
        edit_locally_echoed = true;

        // Settings these attributes causes a "SAVING" notice to
        // briefly appear where "EDITED" would normally appear until
        // the message is acknowledged by the server.
        message.local_edit_timestamp = Math.round(Date.now() / 1000);

        _echo__WEBPACK_IMPORTED_MODULE_15__.edit_locally(message, currently_echoing_messages.get(message_id));

        $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(message_id);
        end_message_row_edit($row);
    }

    _channel__WEBPACK_IMPORTED_MODULE_7__.patch({
        url: "/json/messages/" + message.id,
        data: request,
        success() {
            if (edit_locally_echoed) {
                delete message.local_edit_timestamp;
                currently_echoing_messages.delete(message_id);
            }
            hide_message_edit_spinner($row);
        },
        error(xhr) {
            if (msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_17__.current) {
                message_id = _rows__WEBPACK_IMPORTED_MODULE_21__.id($row);

                if (edit_locally_echoed) {
                    const echoed_message = _message_store__WEBPACK_IMPORTED_MODULE_18__.get(message_id);
                    const echo_data = currently_echoing_messages.get(message_id);

                    delete echoed_message.local_edit_timestamp;
                    currently_echoing_messages.delete(message_id);

                    // Restore the original content.
                    _echo__WEBPACK_IMPORTED_MODULE_15__.edit_locally(echoed_message, {
                        content: echo_data.orig_content,
                        raw_content: echo_data.orig_raw_content,
                        mentioned: echo_data.mentioned,
                        mentioned_me_directly: echo_data.mentioned_me_directly,
                        alerted: echo_data.alerted,
                    });

                    $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(message_id);
                    if (!is_editing(message_id)) {
                        // Return to the message editing open UI state with the edited content.
                        start_edit_maintaining_scroll($row, echo_data.raw_content);
                    }
                }

                hide_message_edit_spinner($row);
                const message = _channel__WEBPACK_IMPORTED_MODULE_7__.xhr_error_message(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error saving edit"}),
                    xhr,
                );
                $row.find(".edit_error").text(message).show();
            }
        },
    });
    // The message will automatically get replaced via message_list.update_message.
}

function maybe_show_edit($row, id) {
    if (currently_editing_messages.has(id)) {
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.show_edit_message($row, currently_editing_messages.get(id));
    }
}

function edit_last_sent_message() {
    const msg = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_last_message_sent_by_me();

    if (!msg) {
        return;
    }

    if (!msg.id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Message has invalid id in edit_last_sent_message.");
        return;
    }

    if (!is_content_editable(msg, 5)) {
        return;
    }

    const $msg_row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(msg.id);
    if (!$msg_row) {
        // This should never happen, since we got the message above
        // from message_lists.current.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Could not find row for id " + msg.id);
        return;
    }

    _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.select_id(msg.id, {then_scroll: true, from_scroll: true});

    // Finally do the real work!
    _compose_actions__WEBPACK_IMPORTED_MODULE_9__.cancel();
    start($msg_row, () => {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_edit_content").trigger("focus");
    });
}

function delete_message(msg_id) {
    const html_body = _templates_confirm_dialog_confirm_delete_message_hbs__WEBPACK_IMPORTED_MODULE_3___default()();

    function do_delete_message() {
        currently_deleting_messages.push(msg_id);
        _channel__WEBPACK_IMPORTED_MODULE_7__.del({
            url: "/json/messages/" + msg_id,
            success() {
                currently_deleting_messages = currently_deleting_messages.filter(
                    (id) => id !== msg_id,
                );
                _dialog_widget__WEBPACK_IMPORTED_MODULE_14__.hide_dialog_spinner();
                _dialog_widget__WEBPACK_IMPORTED_MODULE_14__.close_modal();
            },
            error(xhr) {
                currently_deleting_messages = currently_deleting_messages.filter(
                    (id) => id !== msg_id,
                );

                _dialog_widget__WEBPACK_IMPORTED_MODULE_14__.hide_dialog_spinner();
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error deleting message"}),
                    xhr,
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"),
                );
            },
        });
    }

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_13__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete message?"}),
        html_body,
        help_link: "/help/edit-or-delete-a-message#delete-a-message",
        on_click: do_delete_message,
        loading_spinner: true,
    });
}

function delete_topic(stream_id, topic_name, failures = 0) {
    _channel__WEBPACK_IMPORTED_MODULE_7__.post({
        url: "/json/streams/" + stream_id + "/delete_topic",
        data: {
            topic_name,
        },
        success(data) {
            if (data.result === "partially_completed") {
                if (failures >= 9) {
                    // Don't keep retrying indefinitely to avoid DoSing the server.
                    return;
                }

                failures += 1;
                /* When trying to delete a very large topic, it's
                   possible for the request to the server to
                   time out after making some progress. Retry the
                   request, so that the user can just do nothing and
                   watch the topic slowly be deleted.

                   TODO: Show a nice loading indicator experience.
                */
                delete_topic(stream_id, topic_name, failures);
            }
        },
    });
}

function handle_narrow_deactivated() {
    for (const [idx, elem] of currently_editing_messages) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(idx) !== undefined) {
            const $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(idx);
            _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.show_edit_message($row, elem);
        }
    }
}

function move_topic_containing_message_to_stream(
    message_id,
    new_stream_id,
    new_topic_name,
    send_notification_to_new_thread,
    send_notification_to_old_thread,
    propagate_mode,
) {
    function reset_modal_ui() {
        currently_topic_editing_messages = currently_topic_editing_messages.filter(
            (id) => id !== message_id,
        );
        _dialog_widget__WEBPACK_IMPORTED_MODULE_14__.hide_dialog_spinner();
    }
    if (currently_topic_editing_messages.includes(message_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "A Topic Move already in progress."}),
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_modal #dialog_error"),
        );
        return;
    }
    currently_topic_editing_messages.push(message_id);

    const request = {
        stream_id: new_stream_id,
        propagate_mode,
        topic: new_topic_name,
        send_notification_to_old_thread,
        send_notification_to_new_thread,
    };
    notify_old_thread_default = send_notification_to_old_thread;
    notify_new_thread_default = send_notification_to_new_thread;
    _channel__WEBPACK_IMPORTED_MODULE_7__.patch({
        url: "/json/messages/" + message_id,
        data: request,
        success() {
            // The main UI will update via receiving the event
            // from server_events.js.
            reset_modal_ui();
            _dialog_widget__WEBPACK_IMPORTED_MODULE_14__.close_modal();
        },
        error(xhr) {
            reset_modal_ui();
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"));
        },
    });
}

function with_first_message_id(stream_id, topic_name, success_cb, error_cb) {
    // The API endpoint for editing messages to change their
    // content, topic, or stream requires a message ID.
    //
    // Because we don't have full data in the browser client, it's
    // possible that we might display a topic in the left sidebar
    // (and thus expose the UI for moving its topic to another
    // stream) without having a message ID that is definitely
    // within the topic.  (The comments in stream_topic_history.js
    // discuss the tricky issues around message deletion that are
    // involved here).
    //
    // To ensure this option works reliably at a small latency
    // cost for a rare operation, we just ask the server for the
    // latest message ID in the topic.
    const data = {
        anchor: "newest",
        num_before: 1,
        num_after: 0,
        narrow: JSON.stringify([
            {operator: "stream", operand: stream_id},
            {operator: "topic", operand: topic_name},
        ]),
    };

    _channel__WEBPACK_IMPORTED_MODULE_7__.get({
        url: "/json/messages",
        data,
        success(data) {
            const message_id = data.messages[0].id;
            success_cb(message_id);
        },
        error: error_cb,
    });
}


/***/ }),

/***/ "./static/js/message_edit_history.js":
/*!*******************************************!*\
  !*** ./static/js/message_edit_history.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "fetch_and_render_message_history": () => (/* binding */ fetch_and_render_message_history),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "show_history": () => (/* binding */ show_history)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/format/index.js");
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/isSameDay/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_message_edit_history_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/message_edit_history.hbs */ "./static/templates/message_edit_history.hbs");
/* harmony import */ var _templates_message_edit_history_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_message_edit_history_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_message_history_modal_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/message_history_modal.hbs */ "./static/templates/message_history_modal.hbs");
/* harmony import */ var _templates_message_history_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_message_history_modal_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());





















function fetch_and_render_message_history(message) {
    _channel__WEBPACK_IMPORTED_MODULE_3__.get({
        url: "/json/messages/" + message.id + "/history",
        data: {message_id: JSON.stringify(message.id)},
        success(data) {
            const content_edit_history = [];
            let prev_time = null;
            let prev_stream_item = null;

            for (const [index, msg] of data.message_history.entries()) {
                // Format times and dates nicely for display
                const time = new Date(msg.timestamp * 1000);
                const item = {
                    timestamp: Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time),
                    display_date: (0,date_fns__WEBPACK_IMPORTED_MODULE_13__["default"])(time, "MMMM d, yyyy"),
                    show_date_row: prev_time === null || !(0,date_fns__WEBPACK_IMPORTED_MODULE_14__["default"])(time, prev_time),
                };

                if (!msg.user_id) {
                    continue;
                }

                const person = _people__WEBPACK_IMPORTED_MODULE_7__.get_by_user_id(msg.user_id);
                const full_name = person.full_name;

                if (index === 0) {
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Posted by {full_name}"},
                        {full_name},
                    );
                    item.body_to_render = msg.rendered_content;
                } else if (msg.prev_topic && msg.prev_content) {
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Edited by {full_name}"},
                        {full_name},
                    );
                    item.body_to_render = msg.content_html_diff;
                    item.topic_edited = true;
                    item.prev_topic = msg.prev_topic;
                    item.new_topic = msg.topic;
                } else if (msg.prev_topic && msg.prev_stream) {
                    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg.prev_stream);
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Moved by {full_name}"},
                        {full_name},
                    );
                    item.topic_edited = true;
                    item.prev_topic = msg.prev_topic;
                    item.new_topic = msg.topic;
                    item.stream_changed = true;
                    if (!sub) {
                        item.prev_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unknown stream"});
                    } else {
                        item.prev_stream = _stream_data__WEBPACK_IMPORTED_MODULE_12__.maybe_get_stream_name(msg.prev_stream);
                    }
                    if (prev_stream_item !== null) {
                        prev_stream_item.new_stream = _stream_data__WEBPACK_IMPORTED_MODULE_12__.maybe_get_stream_name(
                            msg.prev_stream,
                        );
                    }
                    prev_stream_item = item;
                } else if (msg.prev_topic) {
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Moved by {full_name}"},
                        {full_name},
                    );
                    item.topic_edited = true;
                    item.prev_topic = msg.prev_topic;
                    item.new_topic = msg.topic;
                } else if (msg.prev_stream) {
                    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg.prev_stream);
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Moved by {full_name}"},
                        {full_name},
                    );
                    item.stream_changed = true;
                    if (!sub) {
                        item.prev_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unknown stream"});
                    } else {
                        item.prev_stream = _stream_data__WEBPACK_IMPORTED_MODULE_12__.maybe_get_stream_name(msg.prev_stream);
                    }
                    if (prev_stream_item !== null) {
                        prev_stream_item.new_stream = _stream_data__WEBPACK_IMPORTED_MODULE_12__.maybe_get_stream_name(
                            msg.prev_stream,
                        );
                    }
                    prev_stream_item = item;
                } else {
                    // just a content edit
                    item.edited_by_notice = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Edited by {full_name}"},
                        {full_name},
                    );
                    item.body_to_render = msg.content_html_diff;
                }

                content_edit_history.push(item);
                prev_time = time;
            }
            if (prev_stream_item !== null) {
                prev_stream_item.new_stream = _stream_data__WEBPACK_IMPORTED_MODULE_12__.maybe_get_stream_name(message.stream_id);
            }
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-history").attr("data-message-id", message.id);
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-history").html(
                _templates_message_edit_history_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                    edited_messages: content_edit_history,
                }),
            );
            // Pass the history through rendered_markdown.js
            // to update dynamic_elements in the content.
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-history")
                .find(".rendered_markdown")
                .each(function () {
                    _rendered_markdown__WEBPACK_IMPORTED_MODULE_9__.update_elements(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this));
                });
        },
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error fetching message edit history"}),
                xhr,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error"),
            );
        },
    });
}

function show_history(message) {
    const rendered_message_history = _templates_message_history_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default()();

    _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Message edit history"}),
        html_body: rendered_message_history,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Close"}),
        id: "message-edit-history",
        on_click() {},
        close_on_submit: true,
        focus_submit_on_open: true,
        single_footer_button: true,
        post_render() {
            fetch_and_render_message_history(message);
        },
    });
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("mouseenter", ".message_edit_notice", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).addClass("message_edit_notice_hover");
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("mouseleave", ".message_edit_notice", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).removeClass("message_edit_notice_hover");
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".message_edit_notice", (e) => {
        e.stopPropagation();
        e.preventDefault();
        _popovers__WEBPACK_IMPORTED_MODULE_8__.hide_all();

        const message_id = _rows__WEBPACK_IMPORTED_MODULE_10__.id(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest(".message_row"));
        const $row = _message_lists__WEBPACK_IMPORTED_MODULE_6__.current.get_row(message_id);
        const message = _message_lists__WEBPACK_IMPORTED_MODULE_6__.current.get(_rows__WEBPACK_IMPORTED_MODULE_10__.id($row));

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            _spectators__WEBPACK_IMPORTED_MODULE_11__.login_to_access();
            return;
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            show_history(message);
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-history-cancel").trigger("focus");
        }
    });
}


/***/ }),

/***/ "./static/js/message_events.js":
/*!*************************************!*\
  !*** ./static/js/message_events.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "insert_new_messages": () => (/* binding */ insert_new_messages),
/* harmony export */   "remove_messages": () => (/* binding */ remove_messages),
/* harmony export */   "update_messages": () => (/* binding */ update_messages)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_validate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_validate */ "./static/js/compose_validate.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _huddle_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./huddle_data */ "./static/js/huddle_data.js");
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_edit_history__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./message_edit_history */ "./static/js/message_edit_history.js");
/* harmony import */ var _message_helper__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./message_helper */ "./static/js/message_helper.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_util__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./message_util */ "./static/js/message_util.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _recent_senders__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./recent_senders */ "./static/js/recent_senders.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

































function maybe_add_narrowed_messages(messages, msg_list, callback, attempt = 1) {
    const ids = [];

    for (const elem of messages) {
        ids.push(elem.id);
    }

    _channel__WEBPACK_IMPORTED_MODULE_4__.get({
        url: "/json/messages/matches_narrow",
        data: {
            msg_ids: JSON.stringify(ids),
            narrow: JSON.stringify(_narrow_state__WEBPACK_IMPORTED_MODULE_18__.public_operators()),
        },
        timeout: 5000,
        success(data) {
            if (msg_list !== _message_lists__WEBPACK_IMPORTED_MODULE_14__.current) {
                // We unnarrowed in the mean time
                return;
            }

            let new_messages = [];
            const elsewhere_messages = [];

            for (const elem of messages) {
                if (Object.hasOwn(data.messages, elem.id)) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(elem, data.messages[elem.id]);
                    new_messages.push(elem);
                } else {
                    elsewhere_messages.push(elem);
                }
            }

            // This second call to process_new_message in the
            // insert_new_messages code path is designed to replace
            // our slightly stale message object with the latest copy
            // from the message_store. This helps in very rare race
            // conditions, where e.g. the current user's name was
            // edited in between when they sent the message and when
            // we hear back from the server and can echo the new
            // message.
            new_messages = new_messages.map((message) =>
                _message_helper__WEBPACK_IMPORTED_MODULE_13__.process_new_message(message),
            );

            callback(new_messages, msg_list);
            _unread_ops__WEBPACK_IMPORTED_MODULE_26__.process_visible();
            _notifications__WEBPACK_IMPORTED_MODULE_19__.notify_messages_outside_current_search(elsewhere_messages);
        },
        error(xhr) {
            if (msg_list.narrowed && msg_list !== _message_lists__WEBPACK_IMPORTED_MODULE_14__.current) {
                return;
            }
            if (xhr.status === 400) {
                // This narrow was invalid -- don't retry it, and don't display the message.
                return;
            }
            if (attempt >= 5) {
                // Too many retries -- bail out.  However, this means the `messages` are potentially
                // missing from the search results view.  Since this is a very unlikely circumstance
                // (Tornado is up, Django is down for 5 retries, user is in a search view that it
                // cannot apply itself) and the failure mode is not bad (it will simply fail to
                // include live updates of new matching messages), just log an error.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Failed to determine if new message matches current narrow, after 5 tries",
                );
                return;
            }
            // Backoff on retries, with full jitter: up to 2s, 4s, 8s, 16s, 32s
            const delay = Math.random() * 2 ** attempt * 2000;
            setTimeout(() => {
                if (msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_14__.current) {
                    // Don't actually try again if we un-narrowed
                    // while waiting
                    maybe_add_narrowed_messages(messages, msg_list, callback, attempt + 1);
                }
            }, delay);
        },
    });
}

function insert_new_messages(messages, sent_by_this_client) {
    messages = messages.map((message) => _message_helper__WEBPACK_IMPORTED_MODULE_13__.process_new_message(message));

    const any_untracked_unread_messages = _unread__WEBPACK_IMPORTED_MODULE_25__.process_loaded_messages(messages, false);
    _huddle_data__WEBPACK_IMPORTED_MODULE_10__.process_loaded_messages(messages);

    // all_messages_data is the data that we use to populate
    // other lists, so we always update this
    _message_util__WEBPACK_IMPORTED_MODULE_16__.add_new_messages_data(messages, _all_messages_data__WEBPACK_IMPORTED_MODULE_2__.all_messages_data);

    let render_info;

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_18__.active()) {
        // We do this NOW even though the home view is not active,
        // because we want the home view to load fast later.
        _message_util__WEBPACK_IMPORTED_MODULE_16__.add_new_messages(messages, _message_lists__WEBPACK_IMPORTED_MODULE_14__.home);

        if (_narrow_state__WEBPACK_IMPORTED_MODULE_18__.filter().can_apply_locally()) {
            render_info = _message_util__WEBPACK_IMPORTED_MODULE_16__.add_new_messages(messages, _message_lists__WEBPACK_IMPORTED_MODULE_14__.current);
        } else {
            // if we cannot apply locally, we have to wait for this callback to happen to notify
            maybe_add_narrowed_messages(
                messages,
                _message_lists__WEBPACK_IMPORTED_MODULE_14__.current,
                _message_util__WEBPACK_IMPORTED_MODULE_16__.add_new_messages,
            );
        }
    } else {
        // we're in the home view, so update its list
        render_info = _message_util__WEBPACK_IMPORTED_MODULE_16__.add_new_messages(messages, _message_lists__WEBPACK_IMPORTED_MODULE_14__.home);
    }

    if (sent_by_this_client) {
        const need_user_to_scroll = render_info && render_info.need_user_to_scroll;
        // sent_by_this_client will be true if ANY of the messages
        // were sent by this client; notifications.notify_local_mixes
        // will filter out any not sent by us.
        _notifications__WEBPACK_IMPORTED_MODULE_19__.notify_local_mixes(messages, need_user_to_scroll);
    }

    if (any_untracked_unread_messages) {
        _unread_ui__WEBPACK_IMPORTED_MODULE_27__.update_unread_counts();
    }

    _unread_ops__WEBPACK_IMPORTED_MODULE_26__.process_visible();
    _notifications__WEBPACK_IMPORTED_MODULE_19__.received_messages(messages);
    _stream_list__WEBPACK_IMPORTED_MODULE_23__.update_streams_sidebar();
    _pm_list__WEBPACK_IMPORTED_MODULE_20__.update_private_messages();
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_22__.process_messages(messages);
}

function update_messages(events) {
    const msgs_to_rerender = [];
    let any_topic_edited = false;
    let changed_narrow = false;
    let changed_compose = false;
    let any_message_content_edited = false;
    let any_stream_changed = false;

    for (const event of events) {
        const msg = _message_store__WEBPACK_IMPORTED_MODULE_15__.get(event.message_id);
        if (msg === undefined) {
            continue;
        }

        delete msg.local_edit_timestamp;

        msgs_to_rerender.push(msg);

        _message_store__WEBPACK_IMPORTED_MODULE_15__.update_booleans(msg, event.flags);

        _condense__WEBPACK_IMPORTED_MODULE_8__.un_cache_message_content_height(msg.id);

        if (event.rendered_content !== undefined) {
            msg.content = event.rendered_content;
        }

        if (event.is_me_message !== undefined) {
            msg.is_me_message = event.is_me_message;
        }

        // mark the current message edit attempt as complete.
        _message_edit__WEBPACK_IMPORTED_MODULE_11__.end_message_edit(event.message_id);

        // Save the content edit to the front end msg.edit_history
        // before topic edits to ensure that combined topic / content
        // edits have edit_history logged for both before any
        // potential narrowing as part of the topic edit loop.
        if (event.orig_content !== undefined) {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // Note that we do this for topic edits separately, below.
                // If an event changed both content and topic, we'll generate
                // two client-side events, which is probably good for display.
                const edit_history_entry = {
                    user_id: event.user_id,
                    prev_content: event.orig_content,
                    prev_rendered_content: event.orig_rendered_content,
                    prev_rendered_content_version: event.prev_rendered_content_version,
                    timestamp: event.edit_timestamp,
                };
                // Add message's edit_history in message dict
                // For messages that are edited, edit_history needs to
                // be added to message in frontend.
                if (msg.edit_history === undefined) {
                    msg.edit_history = [];
                }
                msg.edit_history = [edit_history_entry].concat(msg.edit_history);
            }
            any_message_content_edited = true;

            // Update raw_content, so that editing a few times in a row is fast.
            msg.raw_content = event.content;
        }

        _unread__WEBPACK_IMPORTED_MODULE_25__.update_message_for_mention(msg, any_message_content_edited);

        // new_topic will be undefined if the topic is unchanged.
        const new_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event);
        // new_stream_id will be undefined if the stream is unchanged.
        const new_stream_id = event.new_stream_id;
        // old_stream_id will be present and valid for all stream messages.
        const old_stream_id = event.stream_id;
        // old_stream will be undefined if the message was moved from
        // a stream that the current user doesn't have access to.
        const old_stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.stream_id);

        // A topic or stream edit may affect multiple messages, listed in
        // event.message_ids. event.message_id is still the first message
        // where the user initiated the edit.
        const topic_edited = new_topic !== undefined;
        const stream_changed = new_stream_id !== undefined;
        const stream_archived = old_stream === undefined;
        if (stream_changed) {
            any_stream_changed = true;
        }
        if (topic_edited) {
            any_topic_edited = true;
        }

        if (topic_edited || stream_changed) {
            const going_forward_change = ["change_later", "change_all"].includes(
                event.propagate_mode,
            );

            const stream_name = stream_archived ? undefined : old_stream.name;
            const compose_stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_6__.stream_name();
            const orig_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event);

            const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_18__.filter();
            const current_selected_id = _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.selected_id();
            const selection_changed_topic = event.message_ids.includes(current_selected_id);
            const event_messages = [];
            for (const message_id of event.message_ids) {
                // We don't need to concern ourselves updating data structures
                // for messages we don't have stored locally.
                const message = _message_store__WEBPACK_IMPORTED_MODULE_15__.get(message_id);
                if (message !== undefined) {
                    event_messages.push(message);
                }
            }
            // The event.message_ids received from the server are not in sorted order.
            event_messages.sort((a, b) => a.id - b.id);

            if (
                going_forward_change &&
                stream_name &&
                compose_stream_name &&
                stream_name.toLowerCase() === compose_stream_name.toLowerCase() &&
                orig_topic === _compose_state__WEBPACK_IMPORTED_MODULE_6__.topic()
            ) {
                changed_compose = true;
                _compose_state__WEBPACK_IMPORTED_MODULE_6__.topic(new_topic);
                _compose_validate__WEBPACK_IMPORTED_MODULE_7__.warn_if_topic_resolved(true);
                _compose_fade__WEBPACK_IMPORTED_MODULE_5__.set_focused_recipient("stream");
            }

            if (going_forward_change) {
                _drafts__WEBPACK_IMPORTED_MODULE_9__.rename_stream_recipient(old_stream_id, orig_topic, new_stream_id, new_topic);
            }

            for (const msg of event_messages) {
                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                    /* Simulate the format of server-generated edit
                     * history events. This logic ensures that all
                     * messages that were moved are displayed as such
                     * without a browser reload. */
                    const edit_history_entry = {
                        user_id: event.user_id,
                        timestamp: event.edit_timestamp,
                    };
                    if (stream_changed) {
                        edit_history_entry.stream = new_stream_id;
                        edit_history_entry.prev_stream = old_stream_id;
                    }
                    if (topic_edited) {
                        edit_history_entry.topic = new_topic;
                        edit_history_entry.prev_topic = orig_topic;
                    }
                    if (msg.edit_history === undefined) {
                        msg.edit_history = [];
                    }
                    msg.edit_history = [edit_history_entry].concat(msg.edit_history);
                }
                msg.last_edit_timestamp = event.edit_timestamp;

                // Remove the recent topics entry for the old topics;
                // must be called before we call set_message_topic.
                //
                // TODO: Use a single bulk request to do this removal.
                // Note that we need to be careful to only remove IDs
                // that were present in stream_topic_history data.
                // This may not be possible to do correctly without extra
                // complexity; the present loop assumes stream_topic_history has
                // only messages in message_store, but that's been false
                // since we added the server_history feature.
                _stream_topic_history__WEBPACK_IMPORTED_MODULE_24__.remove_messages({
                    stream_id: msg.stream_id,
                    topic_name: msg.topic,
                    num_messages: 1,
                    max_removed_msg_id: msg.id,
                });

                // Update the unread counts; again, this must be called
                // before we modify the topic field on the message.
                _unread__WEBPACK_IMPORTED_MODULE_25__.update_unread_topics(msg, event);

                // Now edit the attributes of our message object.
                if (topic_edited) {
                    msg.topic = new_topic;
                    msg.topic_links = event.topic_links;
                }
                if (stream_changed) {
                    const new_stream_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new_stream_id).name;
                    msg.stream_id = new_stream_id;
                    msg.stream = new_stream_name;
                    msg.display_recipient = new_stream_name;
                }

                // Add the recent topics entry for the new stream/topics.
                _stream_topic_history__WEBPACK_IMPORTED_MODULE_24__.add_message({
                    stream_id: msg.stream_id,
                    topic_name: msg.topic,
                    message_id: msg.id,
                });
            }

            if (
                going_forward_change &&
                // This logic is a bit awkward.  What we're trying to
                // accomplish is two things:
                //
                // * If we're currently narrowed to a topic that was just moved,
                //   renarrow to the new location.
                // * We determine whether enough of the topic was moved to justify
                //   renarrowing by checking if the currently selected message is moved.
                //
                // Corner cases around only moving some messages in a topic
                // need to be thought about carefully when making changes.
                //
                // Code further down takes care of the actual rerendering of
                // messages within a narrow.
                selection_changed_topic &&
                current_filter &&
                current_filter.has_topic(stream_name, orig_topic)
            ) {
                let new_filter = current_filter;
                if (new_filter && stream_changed) {
                    // TODO: This logic doesn't handle the
                    // case where we're a guest user and the
                    // message moves to a stream we cannot
                    // access, which would cause the
                    // stream_data lookup here to fail.
                    //
                    // The fix is likely somewhat involved, so punting for now.
                    const new_stream_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new_stream_id).name;
                    new_filter = new_filter.filter_with_new_params({
                        operator: "stream",
                        operand: new_stream_name,
                    });
                    changed_narrow = true;
                }

                if (new_filter && topic_edited) {
                    new_filter = new_filter.filter_with_new_params({
                        operator: "topic",
                        operand: new_topic,
                    });
                    changed_narrow = true;
                }
                // NOTE: We should always be changing narrows after we finish
                //       updating the local data and UI. This avoids conflict
                //       with data fetched from the server (which is already updated)
                //       when we move to new narrow and what data is locally available.
                if (changed_narrow) {
                    const operators = new_filter.operators();
                    const opts = {
                        trigger: "stream/topic change",
                        then_select_id: current_selected_id,
                    };
                    _narrow__WEBPACK_IMPORTED_MODULE_17__.activate(operators, opts);
                }
            }

            // Ensure messages that are no longer part of this
            // narrow are deleted and messages that are now part
            // of this narrow are added to the message_list.
            //
            // Even if we end up renarrowing, the message_list_data
            // part of this is important for non-rendering message
            // lists, so we do this unconditionally.  Most correctly,
            // this should be a loop over all valid message_list_data
            // objects, without the rerender (which will naturally
            // happen in the following code).
            if (!changed_narrow && current_filter) {
                let message_ids_to_remove = [];
                if (current_filter.can_apply_locally()) {
                    const predicate = current_filter.predicate();
                    message_ids_to_remove = event_messages.filter((msg) => !predicate(msg));
                    message_ids_to_remove = message_ids_to_remove.map((msg) => msg.id);
                    // We filter out messages that do not belong to the message
                    // list and then pass these to the remove messages codepath.
                    // While we can pass all our messages to the add messages
                    // codepath as the filtering is done within the method.
                    _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.remove_and_rerender(message_ids_to_remove);
                    _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.add_messages(event_messages);
                } else {
                    // Remove existing message that were updated, since
                    // they may not be a part of the filter now. Also,
                    // this will help us rerender them via
                    // maybe_add_narrowed_messages, if they were
                    // simply updated.
                    const updated_messages = event_messages.filter(
                        (msg) => _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.data.get(msg.id) !== undefined,
                    );
                    _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.remove_and_rerender(
                        updated_messages.map((msg) => msg.id),
                    );
                    // For filters that cannot be processed locally, ask server.
                    maybe_add_narrowed_messages(
                        event_messages,
                        _message_lists__WEBPACK_IMPORTED_MODULE_14__.current,
                        _message_util__WEBPACK_IMPORTED_MODULE_16__.add_messages,
                    );
                }
            }
        }

        // Mark the message as edited for the UI. The rendering_only
        // flag is used to indicated update_message events that are
        // triggered by server latency optimizations, not user
        // interactions; these should not generate edit history updates.
        if (!event.rendering_only) {
            msg.last_edit_timestamp = event.edit_timestamp;
        }

        _notifications__WEBPACK_IMPORTED_MODULE_19__.received_messages([msg]);
        _alert_words__WEBPACK_IMPORTED_MODULE_1__.process_message(msg);

        if (topic_edited || stream_changed) {
            // if topic is changed
            let pre_edit_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event);
            let post_edit_topic = new_topic;

            if (!topic_edited) {
                pre_edit_topic = msg.topic;
                post_edit_topic = pre_edit_topic;
            }

            // new_stream_id is undefined if this is only a topic edit.
            const post_edit_stream_id = new_stream_id || old_stream_id;

            const args = [old_stream_id, pre_edit_topic, post_edit_topic, post_edit_stream_id];
            _recent_senders__WEBPACK_IMPORTED_MODULE_21__.process_topic_edit({
                message_ids: event.message_ids,
                old_stream_id,
                old_topic: pre_edit_topic,
                new_stream_id: post_edit_stream_id,
                new_topic: post_edit_topic,
            });
            _unread__WEBPACK_IMPORTED_MODULE_25__.clear_and_populate_unread_mention_topics();
            _recent_topics_ui__WEBPACK_IMPORTED_MODULE_22__.process_topic_edit(...args);
        }

        // Rerender "Message edit history" if it was open to the edited message.
        if (
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-edit-history").parents(".micromodal").hasClass("modal--open") &&
            msg.id === Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message-history").attr("data-message-id"), 10)
        ) {
            _message_edit_history__WEBPACK_IMPORTED_MODULE_12__.fetch_and_render_message_history(msg);
        }
    }

    // If a topic was edited, we re-render the whole view to get any
    // propagated edits to be updated (since the topic edits can have
    // changed the correct grouping of messages).
    if (any_topic_edited || any_stream_changed) {
        _message_lists__WEBPACK_IMPORTED_MODULE_14__.home.update_muting_and_rerender();
        // However, we don't need to rerender message_list if
        // we just changed the narrow earlier in this function.
        //
        // TODO: We can potentially optimize this logic to avoid
        // calling `update_muting_and_rerender` if the muted
        // messages would not match the view before or after this
        // edit.  Doing so could save significant work, since most
        // topic edits will not match the current topic narrow in
        // large organizations.
        if (!changed_narrow && _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.narrowed) {
            _message_lists__WEBPACK_IMPORTED_MODULE_14__.current.update_muting_and_rerender();
        }
    } else {
        // If the content of the message was edited, we do a special animation.
        //
        // BUG: This triggers the "message edited" animation for every
        // message that was edited if any one of them had its content
        // edited. We should replace any_message_content_edited with
        // passing two sets to rerender_messages; the set of all that
        // are changed, and the set with content changes.
        for (const list of _message_lists__WEBPACK_IMPORTED_MODULE_14__.all_rendered_message_lists()) {
            list.view.rerender_messages(msgs_to_rerender, any_message_content_edited);
        }
    }

    if (changed_compose) {
        // We need to do this after we rerender the message list, to
        // produce correct results.
        _compose_fade__WEBPACK_IMPORTED_MODULE_5__.update_message_list();
    }

    _unread_ui__WEBPACK_IMPORTED_MODULE_27__.update_unread_counts();
    _stream_list__WEBPACK_IMPORTED_MODULE_23__.update_streams_sidebar();
    _pm_list__WEBPACK_IMPORTED_MODULE_20__.update_private_messages();
}

function remove_messages(message_ids) {
    _all_messages_data__WEBPACK_IMPORTED_MODULE_2__.all_messages_data.remove(message_ids);
    for (const list of _message_lists__WEBPACK_IMPORTED_MODULE_14__.all_rendered_message_lists()) {
        list.remove_and_rerender(message_ids);
    }
    _recent_senders__WEBPACK_IMPORTED_MODULE_21__.update_topics_of_deleted_message_ids(message_ids);
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_22__.update_topics_of_deleted_message_ids(message_ids);
}


/***/ }),

/***/ "./static/js/message_fetch.js":
/*!************************************!*\
  !*** ./static/js/message_fetch.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "do_backfill": () => (/* binding */ do_backfill),
/* harmony export */   "get_backfill_anchor": () => (/* binding */ get_backfill_anchor),
/* harmony export */   "get_frontfill_anchor": () => (/* binding */ get_frontfill_anchor),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "load_messages": () => (/* binding */ load_messages),
/* harmony export */   "load_messages_for_narrow": () => (/* binding */ load_messages_for_narrow),
/* harmony export */   "maybe_load_newer_messages": () => (/* binding */ maybe_load_newer_messages),
/* harmony export */   "maybe_load_older_messages": () => (/* binding */ maybe_load_older_messages),
/* harmony export */   "start_backfilling_messages": () => (/* binding */ start_backfilling_messages)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _huddle_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./huddle_data */ "./static/js/huddle_data.js");
/* harmony import */ var _message_helper__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_helper */ "./static/js/message_helper.js");
/* harmony import */ var _message_list__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_list */ "./static/js/message_list.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");
/* harmony import */ var _message_util__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./message_util */ "./static/js/message_util.js");
/* harmony import */ var _narrow_banner__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./narrow_banner */ "./static/js/narrow_banner.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



















const consts = {
    backfill_idle_time: 10 * 1000,
    backfill_batch_size: 1000,
    narrow_before: 50,
    narrow_after: 50,
    num_before_home_anchor: 200,
    num_after_home_anchor: 200,
    recent_topics_initial_fetch_size: 400,
    backward_batch_size: 100,
    forward_batch_size: 100,
    catch_up_batch_size: 1000,
};

function process_result(data, opts) {
    let messages = data.messages;

    if (!jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error").hasClass("get-events-error")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error"));
    }

    messages = messages.map((message) => _message_helper__WEBPACK_IMPORTED_MODULE_5__.process_new_message(message));

    // In some rare situations, we expect to discover new unread
    // messages not tracked in unread.js during this fetching process.
    _message_util__WEBPACK_IMPORTED_MODULE_9__.do_unread_count_updates(messages, true);

    // If we're loading more messages into the home view, save them to
    // the all_messages_data as well, as the message_lists.home is
    // reconstructed from all_messages_data.
    if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
        _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.add_messages(messages);
    }

    if (messages.length !== 0) {
        _message_util__WEBPACK_IMPORTED_MODULE_9__.add_old_messages(messages, opts.msg_list);
    }

    if (
        opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.current &&
        opts.msg_list.narrowed &&
        opts.msg_list.empty()
    ) {
        // Even after loading more messages, we have
        // no messages to display in this narrow.
        _narrow_banner__WEBPACK_IMPORTED_MODULE_10__.show_empty_narrow_message();
    }

    _huddle_data__WEBPACK_IMPORTED_MODULE_4__.process_loaded_messages(messages);
    _stream_list__WEBPACK_IMPORTED_MODULE_15__.update_streams_sidebar();
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__.process_messages(messages);

    _stream_list__WEBPACK_IMPORTED_MODULE_15__.maybe_scroll_narrow_into_view();

    if (opts.cont !== undefined) {
        opts.cont(data, opts);
    }
}

function get_messages_success(data, opts) {
    const update_loading_indicator = opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.current;
    if (opts.num_before > 0) {
        opts.msg_list.data.fetch_status.finish_older_batch({
            update_loading_indicator,
            found_oldest: data.found_oldest,
            history_limited: data.history_limited,
        });
        if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
            // When we update message_lists.home, we need to also update
            // the fetch_status data structure for all_messages_data.
            _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.fetch_status.finish_older_batch({
                update_loading_indicator: false,
                found_oldest: data.found_oldest,
                history_limited: data.history_limited,
            });
        }
        _message_scroll__WEBPACK_IMPORTED_MODULE_8__.update_top_of_narrow_notices(opts.msg_list);
    }

    if (opts.num_after > 0) {
        opts.fetch_again = opts.msg_list.data.fetch_status.finish_newer_batch(data.messages, {
            update_loading_indicator,
            found_newest: data.found_newest,
        });
        if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
            // When we update message_lists.home, we need to also update
            // the fetch_status data structure for all_messages_data.
            opts.fetch_again = _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.fetch_status.finish_newer_batch(data.messages, {
                update_loading_indicator: false,
                found_newest: data.found_newest,
            });
        }
    }

    if (opts.msg_list.narrowed && opts.msg_list !== _message_lists__WEBPACK_IMPORTED_MODULE_7__.current) {
        // We unnarrowed before receiving new messages so
        // don't bother processing the newly arrived messages.
        return;
    }
    if (!data) {
        // The server occasionally returns no data during a
        // restart.  Ignore those responses and try again
        setTimeout(() => {
            load_messages(opts);
        }, 0);
        return;
    }

    process_result(data, opts);
}

// This function modifies the data.narrow filters to use user IDs
// instead of emails string if it is supported. We currently don't set
// or convert the emails string to user IDs directly into the Filter code
// because doing so breaks the app in various modules that expect emails string.
function handle_operators_supporting_id_based_api(data) {
    const operators_supporting_ids = new Set(["pm-with"]);
    const operators_supporting_id = new Set(["sender", "group-pm-with", "stream"]);

    if (data.narrow === undefined) {
        return data;
    }

    data.narrow = JSON.parse(data.narrow);
    data.narrow = data.narrow.map((filter) => {
        if (operators_supporting_ids.has(filter.operator)) {
            filter.operand = _people__WEBPACK_IMPORTED_MODULE_12__.emails_strings_to_user_ids_array(filter.operand);
        }

        if (operators_supporting_id.has(filter.operator)) {
            if (filter.operator === "stream") {
                const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_14__.get_stream_id(filter.operand);
                if (stream_id !== undefined) {
                    filter.operand = stream_id;
                }

                return filter;
            }

            // The other operands supporting object IDs all work with user objects.
            const person = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_email(filter.operand);
            if (person !== undefined) {
                filter.operand = person.user_id;
            }
        }

        return filter;
    });

    data.narrow = JSON.stringify(data.narrow);
    return data;
}

function load_messages(opts, attempt = 1) {
    if (typeof opts.anchor === "number") {
        // Messages that have been locally echoed messages have
        // floating point temporary IDs, which is intended to be a.
        // completely client-side detail.  We need to round these to
        // the nearest integer before sending a request to the server.
        opts.anchor = opts.anchor.toFixed(0);
    }
    let data = {anchor: opts.anchor, num_before: opts.num_before, num_after: opts.num_after};

    // This block is a hack; structurally, we want to set
    //   data.narrow = opts.msg_list.data.filter.public_operators()
    //
    // But support for the all_messages_data sharing of data with
    // message_lists.home and the (hacky) page_params.narrow feature
    // requires a somewhat ugly bundle of conditionals.
    if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
            data.narrow = JSON.stringify(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        }
        // Otherwise, we don't pass narrow for message_lists.home; this is
        // required because it shares its data with all_msg_list, and
        // so we need the server to send us message history from muted
        // streams and topics even though message_lists.home's in:home
        // operators will filter those.
    } else {
        let operators = opts.msg_list.data.filter.public_operators();
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined) {
            operators = operators.concat(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        }
        data.narrow = JSON.stringify(operators);
    }

    let update_loading_indicator = opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.current;
    if (opts.num_before > 0) {
        opts.msg_list.data.fetch_status.start_older_batch({
            update_loading_indicator,
        });
        if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
            _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.fetch_status.start_older_batch({
                update_loading_indicator,
            });
        }
    }

    if (opts.num_after > 0) {
        // We hide the bottom loading indicator when we're fetching both top and bottom messages.
        update_loading_indicator = update_loading_indicator && opts.num_before === 0;
        opts.msg_list.data.fetch_status.start_newer_batch({
            update_loading_indicator,
        });
        if (opts.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home) {
            _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.fetch_status.start_newer_batch({
                update_loading_indicator,
            });
        }
    }

    data.client_gravatar = true;
    data = handle_operators_supporting_id_based_api(data);

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // This is a bit of a hack; ideally we'd unify this logic in
        // some way with the above logic, and not need to do JSON
        // parsing/stringifying here.
        const web_public_narrow = {negated: false, operator: "streams", operand: "web-public"};

        if (!data.narrow) {
            /* For the "All messages" feed, this will be the only operator. */
            data.narrow = JSON.stringify([web_public_narrow]);
        } else {
            // Otherwise, we append the operator.  This logic is not
            // ideal in that in theory an existing `streams:` operator
            // could be present, but not in a useful way.  We don't
            // attempt to validate the narrow is compatible with
            // spectators here; the server will return an error if
            // appropriate.
            data.narrow = JSON.parse(data.narrow);
            data.narrow.push(web_public_narrow);
            data.narrow = JSON.stringify(data.narrow);
        }
    }

    _channel__WEBPACK_IMPORTED_MODULE_2__.get({
        url: "/json/messages",
        data,
        success(data) {
            get_messages_success(data, opts);
        },
        error(xhr) {
            if (opts.msg_list.narrowed && opts.msg_list !== _message_lists__WEBPACK_IMPORTED_MODULE_7__.current) {
                // We unnarrowed before getting an error so don't
                // bother trying again or doing further processing.
                return;
            }
            if (xhr.status === 400) {
                // Bad request: We probably specified a narrow operator
                // for a nonexistent stream or something.  We shouldn't
                // retry or display a connection error.
                //
                // FIXME: Warn the user when this has happened?
                _message_scroll__WEBPACK_IMPORTED_MODULE_8__.hide_indicators();
                const data = {
                    messages: [],
                };
                process_result(data, opts);
                return;
            }

            // Backoff on retries, with full jitter: up to 2s, 4s, 8s, 16s, 32s
            let delay = Math.random() * 2 ** attempt * 2000;
            if (attempt >= 5) {
                delay = 30000;
            }
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error"));
            setTimeout(() => {
                load_messages(opts, attempt + 1);
            }, delay);
        },
    });
}

function load_messages_for_narrow(opts) {
    load_messages({
        anchor: opts.anchor,
        num_before: consts.narrow_before,
        num_after: consts.narrow_after,
        msg_list: opts.msg_list,
        cont: opts.cont,
    });
}

function get_backfill_anchor(msg_list) {
    const oldest_msg =
        msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home ? _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.first() : msg_list.first();

    if (oldest_msg) {
        return oldest_msg.id;
    }

    // msg_list is empty, which is an impossible
    // case, raise a fatal error.
    throw new Error("There are no message available to backfill.");
}

function get_frontfill_anchor(msg_list) {
    const last_msg = msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.home ? _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.last() : msg_list.last();

    if (last_msg) {
        return last_msg.id;
    }

    // Although it is impossible that we reach here since we
    // are already checking `msg_list.fetch_status.can_load_newer_messages`
    // and user cannot be scrolling down on an empty message_list to
    // fetch more data, and if user is, then the available data is wrong
    // and we raise a fatal error.
    throw new Error("There are no message available to frontfill.");
}

function maybe_load_older_messages(opts) {
    // This function gets called when you scroll to the top
    // of your window, and you want to get messages older
    // than what the browsers originally fetched.
    const msg_list = opts.msg_list;
    if (!msg_list.data.fetch_status.can_load_older_messages()) {
        // We may already be loading old messages or already
        // got the oldest one.
        return;
    }

    do_backfill({
        msg_list,
        num_before: consts.backward_batch_size,
    });
}

function do_backfill(opts) {
    const msg_list = opts.msg_list;
    const anchor = get_backfill_anchor(msg_list);

    load_messages({
        anchor,
        num_before: opts.num_before,
        num_after: 0,
        msg_list,
        cont() {
            if (opts.cont) {
                opts.cont();
            }
        },
    });
}

function maybe_load_newer_messages(opts) {
    // This function gets called when you scroll to the bottom
    // of your window, and you want to get messages newer
    // than what the browsers originally fetched.
    const msg_list = opts.msg_list;

    if (!msg_list.data.fetch_status.can_load_newer_messages()) {
        // We may already be loading new messages or already
        // got the newest one.
        return;
    }

    const anchor = get_frontfill_anchor(msg_list);

    function load_more(data, args) {
        if (args.fetch_again && args.msg_list === _message_lists__WEBPACK_IMPORTED_MODULE_7__.current) {
            maybe_load_newer_messages({msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_7__.current});
        }
    }

    load_messages({
        anchor,
        num_before: 0,
        num_after: consts.forward_batch_size,
        msg_list,
        cont: load_more,
    });
}

function start_backfilling_messages() {
    // backfill more messages after the user is idle
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).idle({
        idle: consts.backfill_idle_time,
        onIdle() {
            do_backfill({
                num_before: consts.backfill_batch_size,
                msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_7__.home,
            });
        },
    });
}

function initialize(home_view_loaded) {
    // get the initial message list
    function load_more(data) {
        // If we haven't selected a message in the home view yet, and
        // the home view isn't empty, we select the anchor message here.
        if (_message_lists__WEBPACK_IMPORTED_MODULE_7__.home.selected_id() === -1 && !_message_lists__WEBPACK_IMPORTED_MODULE_7__.home.empty()) {
            // We fall back to the closest selected id, as the user
            // may have removed a stream from the home view while we
            // were loading data.
            _message_lists__WEBPACK_IMPORTED_MODULE_7__.home.select_id(data.anchor, {
                then_scroll: true,
                use_closest: true,
                target_scroll_offset: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            });
        }

        if (data.found_newest) {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // Since for spectators, this is the main fetch, we
                // hide the Recent Topics loading indicator here.
                _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__.hide_loading_indicator();
            }

            // See server_events.js for this callback.
            home_view_loaded();
            start_backfilling_messages();
            return;
        }

        // If we fall through here, we need to keep fetching more data, and
        // we'll call back to the function we're in.
        const messages = data.messages;
        const latest_id = messages.at(-1).id;

        load_messages({
            anchor: latest_id,
            num_before: 0,
            num_after: consts.catch_up_batch_size,
            msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_7__.home,
            cont: load_more,
        });
    }

    let anchor;
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // If we're doing a server-initiated reload, similar to a
        // near: narrow query, we want to select a specific message.
        anchor = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    } else {
        // Otherwise, we should just use the first unread message in
        // the user's unmuted history as our anchor.
        anchor = "first_unread";
    }
    load_messages({
        anchor,
        num_before: consts.num_before_home_anchor,
        num_after: consts.num_after_home_anchor,
        msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_7__.home,
        cont: load_more,
    });

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // Since spectators never have old unreads, we can skip the
        // hacky fetch below for them (which would just waste resources).

        // This optimization requires a bit of duplicated loading
        // indicator code, here and hiding logic in hide_more.
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__.show_loading_indicator();
        return;
    }

    // In addition to the algorithm above, which is designed to ensure
    // that we fetch all message history eventually starting with the
    // first unread message, we also need to ensure that the Recent
    // Topics page contains the very most recent threads on page load.
    //
    // Long term, we'll want to replace this with something that's
    // more performant (i.e. avoids this unnecessary extra fetch the
    // results of which are basically discarded) and better represents
    // more than a few hundred messages' history, but this strategy
    // allows "Recent topics" to always show current data (with gaps)
    // on page load; the data will be complete once the algorithm
    // above catches up to present.
    //
    // (Users will see a weird artifact where Recent topics has a gap
    // between E.g. 6 days ago and 37 days ago while the catchup
    // process runs, so this strategy still results in problematic
    // visual artifacts shortly after page load; just more forgivable
    // ones).
    //
    // This MessageList is defined similarly to home_message_list,
    // without a `table_name` attached.
    const recent_topics_message_list = new _message_list__WEBPACK_IMPORTED_MODULE_6__.MessageList({
        filter: new _filter__WEBPACK_IMPORTED_MODULE_3__.Filter([{operator: "in", operand: "home"}]),
        excludes_muted_topics: true,
    });
    // TODO: Ideally we'd have loading indicators for recent topics at
    // both top and bottom be managed by load_messages, but that
    // likely depends on other reorganizations of the early loading
    // sequence.
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__.show_loading_indicator();
    load_messages({
        anchor: "newest",
        num_before: consts.recent_topics_initial_fetch_size,
        num_after: 0,
        msg_list: recent_topics_message_list,
        cont: _recent_topics_ui__WEBPACK_IMPORTED_MODULE_13__.hide_loading_indicator,
    });
}


/***/ }),

/***/ "./static/js/message_flags.js":
/*!************************************!*\
  !*** ./static/js/message_flags.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_unread_batch_size": () => (/* binding */ _unread_batch_size),
/* harmony export */   "mark_as_read": () => (/* binding */ mark_as_read),
/* harmony export */   "mark_as_unread": () => (/* binding */ mark_as_unread),
/* harmony export */   "save_collapsed": () => (/* binding */ save_collapsed),
/* harmony export */   "save_uncollapsed": () => (/* binding */ save_uncollapsed),
/* harmony export */   "send_read": () => (/* binding */ send_read),
/* harmony export */   "toggle_starred_and_update_server": () => (/* binding */ toggle_starred_and_update_server),
/* harmony export */   "unstar_all_messages": () => (/* binding */ unstar_all_messages),
/* harmony export */   "unstar_all_messages_in_topic": () => (/* binding */ unstar_all_messages_in_topic),
/* harmony export */   "update_starred_flag": () => (/* binding */ update_starred_flag)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _starred_messages__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./starred_messages */ "./static/js/starred_messages.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");








function send_flag_update_for_messages(msg_ids, flag, op) {
    _channel__WEBPACK_IMPORTED_MODULE_1__.post({
        url: "/json/messages/flags",
        data: {
            messages: JSON.stringify(msg_ids),
            flag,
            op,
        },
    });
}
const _unread_batch_size = 1000;

const send_read = (function () {
    let queue = [];
    let start;
    function server_request() {
        // Wait for server IDs before sending flags
        const real_msgs = queue.filter((msg) => !msg.locally_echoed);
        const real_msg_ids = real_msgs.map((msg) => msg.id);

        if (real_msg_ids.length === 0) {
            setTimeout(start, 100);
            return;
        }

        const real_msg_ids_batch = real_msg_ids.slice(0, _unread_batch_size);

        // We have some real IDs.  If there are any left in the queue when this
        // call finishes, they will be handled in the success callback.

        _channel__WEBPACK_IMPORTED_MODULE_1__.post({
            url: "/json/messages/flags",
            data: {messages: JSON.stringify(real_msg_ids_batch), op: "add", flag: "read"},
            success() {
                const batch_set = new Set(real_msg_ids_batch);
                queue = queue.filter((message) => !batch_set.has(message.id));

                if (queue.length > 0) {
                    start();
                }
            },
        });
    }

    start = lodash__WEBPACK_IMPORTED_MODULE_0___default().throttle(server_request, 1000);

    function add(messages) {
        queue = queue.concat(messages);
        start();
    }

    return add;
})();

function mark_as_read(message_ids) {
    send_flag_update_for_messages(message_ids, "read", "add");
}

function mark_as_unread(message_ids) {
    send_flag_update_for_messages(message_ids, "read", "remove");
}

function save_collapsed(message) {
    send_flag_update_for_messages([message.id], "collapsed", "add");
}

function save_uncollapsed(message) {
    send_flag_update_for_messages([message.id], "collapsed", "remove");
}

// This updates the state of the starred flag in local data
// structures, and triggers a UI rerender.
function update_starred_flag(message_id, new_value) {
    const message = _message_store__WEBPACK_IMPORTED_MODULE_2__.get(message_id);
    if (message === undefined) {
        // If we don't have the message locally, do nothing; if later
        // we fetch it, it'll come with the correct `starred` state.
        return;
    }
    message.starred = new_value;
    _ui__WEBPACK_IMPORTED_MODULE_4__.update_starred_view(message_id, new_value);
}

function toggle_starred_and_update_server(message) {
    if (message.locally_echoed) {
        // This is defensive code for when you hit the "*" key
        // before we get a server ack.  It's rare that somebody
        // can star this quickly, and we don't have a good way
        // to tell the server which message was starred.
        return;
    }

    message.starred = !message.starred;

    // Unlike most calls to mark messages as read, we don't check
    // msg_list.can_mark_messages_read, because starring a message is an
    // explicit interaction and we'd like to preserve the user
    // expectation invariant that all starred messages are read.
    _unread_ops__WEBPACK_IMPORTED_MODULE_5__.notify_server_message_read(message);
    _ui__WEBPACK_IMPORTED_MODULE_4__.update_starred_view(message.id, message.starred);

    if (message.starred) {
        send_flag_update_for_messages([message.id], "starred", "add");
        _starred_messages__WEBPACK_IMPORTED_MODULE_3__.add([message.id]);
    } else {
        send_flag_update_for_messages([message.id], "starred", "remove");
        _starred_messages__WEBPACK_IMPORTED_MODULE_3__.remove([message.id]);
    }
}

function unstar_all_messages() {
    const starred_msg_ids = _starred_messages__WEBPACK_IMPORTED_MODULE_3__.get_starred_msg_ids();
    send_flag_update_for_messages(starred_msg_ids, "starred", "remove");
}

function unstar_all_messages_in_topic(stream_id, topic) {
    const data = {
        anchor: "newest",
        // In the unlikely event the user has >1000 starred messages
        // in a topic, this won't find them all. This is probably an
        // acceptable bug; one can do it multiple times, and we avoid
        // creating an API endpoint just for this very minor feature.
        num_before: 1000,
        num_after: 0,
        narrow: JSON.stringify([
            {operator: "stream", operand: stream_id},
            {operator: "topic", operand: topic},
            {operator: "is", operand: "starred"},
        ]),
    };

    _channel__WEBPACK_IMPORTED_MODULE_1__.get({
        url: "/json/messages",
        data,
        success(data) {
            const messages = data.messages;
            const starred_message_ids = messages.map((message) => message.id);
            send_flag_update_for_messages(starred_message_ids, "starred", "remove");
        },
    });
}


/***/ }),

/***/ "./static/js/message_helper.js":
/*!*************************************!*\
  !*** ./static/js/message_helper.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "process_new_message": () => (/* binding */ process_new_message)
/* harmony export */ });
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_user_ids'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_conversations__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pm_conversations */ "./static/js/pm_conversations.js");
/* harmony import */ var _recent_senders__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./recent_senders */ "./static/js/recent_senders.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());










function process_new_message(message) {
    // Call this function when processing a new message.  After
    // a message is processed and inserted into the message store
    // cache, most modules use message_store.get to look at
    // messages.
    const cached_msg = _message_store__WEBPACK_IMPORTED_MODULE_1__.get_cached_message(message.id);
    if (cached_msg !== undefined) {
        // Copy the match topic and content over if they exist on
        // the new message
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message) !== undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(cached_msg, message);
        }
        return cached_msg;
    }

    _message_store__WEBPACK_IMPORTED_MODULE_1__.set_message_booleans(message);
    message.sent_by_me = _people__WEBPACK_IMPORTED_MODULE_3__.is_current_user(message.sender_email);

    _people__WEBPACK_IMPORTED_MODULE_3__.extract_people_from_message(message);
    _people__WEBPACK_IMPORTED_MODULE_3__.maybe_incr_recipient_count(message);

    const sender = _people__WEBPACK_IMPORTED_MODULE_3__.get_by_user_id(message.sender_id);
    if (sender) {
        message.sender_full_name = sender.full_name;
        message.sender_email = sender.email;
        message.status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(message.sender_id);
    }

    // Convert topic even for PMs, as legacy code
    // wants the empty field.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message);

    switch (message.type) {
        case "stream":
            message.is_stream = true;
            message.stream = message.display_recipient;
            message.reply_to = message.sender_email;

            _stream_topic_history__WEBPACK_IMPORTED_MODULE_6__.add_message({
                stream_id: message.stream_id,
                topic_name: message.topic,
                message_id: message.id,
            });

            _recent_senders__WEBPACK_IMPORTED_MODULE_5__.process_stream_message(message);
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_user_ids'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message.sender_id);
            break;

        case "private":
            message.is_private = true;
            message.reply_to = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_message_store__WEBPACK_IMPORTED_MODULE_1__.get_pm_emails(message));
            message.display_reply_to = _message_store__WEBPACK_IMPORTED_MODULE_1__.get_pm_full_names(message);
            message.pm_with_url = _people__WEBPACK_IMPORTED_MODULE_3__.pm_with_url(message);
            message.to_user_ids = _people__WEBPACK_IMPORTED_MODULE_3__.pm_reply_user_string(message);

            _pm_conversations__WEBPACK_IMPORTED_MODULE_4__.process_message(message);

            _recent_senders__WEBPACK_IMPORTED_MODULE_5__.process_private_message(message);
            if (_people__WEBPACK_IMPORTED_MODULE_3__.is_my_user_id(message.sender_id)) {
                for (const recip of message.display_recipient) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_user_ids'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(recip.id);
                }
            }
            break;
    }

    _alert_words__WEBPACK_IMPORTED_MODULE_0__.process_message(message);
    if (!message.reactions) {
        message.reactions = [];
    }
    _message_store__WEBPACK_IMPORTED_MODULE_1__.update_message_cache(message);
    return message;
}


/***/ }),

/***/ "./static/js/message_list.js":
/*!***********************************!*\
  !*** ./static/js/message_list.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MessageList": () => (/* binding */ MessageList)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_list_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_list_data */ "./static/js/message_list_data.js");
/* harmony import */ var _message_list_view__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_list_view */ "./static/js/message_list_view.js");
/* harmony import */ var _narrow_banner__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./narrow_banner */ "./static/js/narrow_banner.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");











class MessageList {
    constructor(opts) {
        if (opts.data) {
            this.data = opts.data;
        } else {
            const filter = opts.filter;

            this.data = new _message_list_data__WEBPACK_IMPORTED_MODULE_3__.MessageListData({
                excludes_muted_topics: opts.excludes_muted_topics,
                filter,
            });
        }

        const collapse_messages = this.data.filter.supports_collapsing_recipients();
        const table_name = opts.table_name;
        this.view = new _message_list_view__WEBPACK_IMPORTED_MODULE_4__.MessageListView(this, table_name, collapse_messages);
        this.table_name = table_name;
        this.narrowed = this.table_name === "zfilt";
        this.num_appends = 0;
        this.reading_prevented = false;

        return this;
    }

    prevent_reading() {
        this.reading_prevented = true;
    }

    resume_reading() {
        this.reading_prevented = false;
    }

    add_messages(messages, opts) {
        // This adds all messages to our data, but only returns
        // the currently viewable ones.
        const info = this.data.add_messages(messages);

        const top_messages = info.top_messages;
        const bottom_messages = info.bottom_messages;
        const interior_messages = info.interior_messages;

        // Currently we only need data back from rendering to
        // tell us whether users needs to scroll, which only
        // applies for `append_to_view`, but this may change over
        // time.
        let render_info;

        if (interior_messages.length > 0) {
            this.view.rerender_preserving_scrolltop(true);
            return true;
        }
        if (top_messages.length > 0) {
            this.view.prepend(top_messages);
        }

        if (bottom_messages.length > 0) {
            render_info = this.append_to_view(bottom_messages, opts);
        }

        if (this.narrowed && !this.empty()) {
            // If adding some new messages to the message tables caused
            // our current narrow to no longer be empty, hide the empty
            // feed placeholder text.
            _narrow_banner__WEBPACK_IMPORTED_MODULE_5__.hide_empty_narrow_message();
        }

        if (this.narrowed && !this.empty() && this.selected_id() === -1) {
            // And also select the newly arrived message.
            this.select_id(this.selected_id(), {then_scroll: true, use_closest: true});
        }

        return render_info;
    }

    get(id) {
        return this.data.get(id);
    }

    num_items() {
        return this.data.num_items();
    }

    empty() {
        return this.data.empty();
    }

    first() {
        return this.data.first();
    }

    last() {
        return this.data.last();
    }

    ids_greater_or_equal_than(id) {
        return this.data.ids_greater_or_equal_than(id);
    }

    prev() {
        return this.data.prev();
    }

    next() {
        return this.data.next();
    }

    is_at_end() {
        return this.data.is_at_end();
    }

    nth_most_recent_id(n) {
        return this.data.nth_most_recent_id(n);
    }

    is_search() {
        return this.data.is_search();
    }

    can_mark_messages_read() {
        /* Automatically marking messages as read can be disabled for
           two different reasons:
           * The view is structurally a search view, encoded in the
             properties of the message_list_data object.
           * The user recently marked messages in the view as unread, and
             we don't want to lose that state.
        */
        return this.data.can_mark_messages_read() && !this.reading_prevented;
    }

    clear({clear_selected_id = true} = {}) {
        this.data.clear();
        this.view.clear_rendering_state(true);

        if (clear_selected_id) {
            this.data.clear_selected_id();
        }
    }

    selected_id() {
        return this.data.selected_id();
    }

    select_id(id, opts) {
        opts = {
            then_scroll: false,
            target_scroll_offset: undefined,
            use_closest: false,
            empty_ok: false,
            mark_read: true,
            force_rerender: false,
            ...opts,
            id,
            msg_list: this,
            previously_selected_id: this.data.selected_id(),
        };

        const convert_id = (str_id) => {
            const id = Number.parseFloat(str_id);
            if (Number.isNaN(id)) {
                throw new TypeError("Bad message id " + str_id);
            }
            return id;
        };

        id = convert_id(id);

        const closest_id = this.closest_id(id);

        let error_data;

        // The name "use_closest" option is a bit legacy.  We
        // are always gonna move to the closest visible id; the flag
        // just says whether we call blueslip.error or not.  The caller
        // sets use_closest to true when it expects us to move the
        // pointer as needed, so only generate an error if the flag is
        // false.
        if (!opts.use_closest && closest_id !== id) {
            error_data = {
                table_name: this.table_name,
                id,
                closest_id,
            };
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Selected message id not in MessageList", error_data);
        }

        if (closest_id === -1 && !opts.empty_ok) {
            error_data = {
                table_name: this.table_name,
                id,
                items_length: this.data.num_items(),
            };
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot select id -1", error_data);
            throw new Error("Cannot select id -1");
        }

        id = closest_id;
        opts.id = id;
        this.data.set_selected_id(id);

        if (opts.force_rerender) {
            this.rerender();
        } else if (!opts.from_rendering) {
            this.view.maybe_rerender();
        }

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(document).trigger(new (jquery__WEBPACK_IMPORTED_MODULE_1___default().Event)("message_selected.zulip", opts));
    }

    selected_message() {
        return this.get(this.data.selected_id());
    }

    selected_row() {
        return this.get_row(this.data.selected_id());
    }

    closest_id(id) {
        return this.data.closest_id(id);
    }

    advance_past_messages(msg_ids) {
        return this.data.advance_past_messages(msg_ids);
    }

    selected_idx() {
        return this.data.selected_idx();
    }

    // Maintains a trailing bookend element explaining any changes in
    // your subscribed/unsubscribed status at the bottom of the
    // message list.
    update_trailing_bookend() {
        this.view.clear_trailing_bookend();
        if (!this.narrowed) {
            return;
        }
        const stream_name = _narrow_state__WEBPACK_IMPORTED_MODULE_6__.stream();
        if (stream_name === undefined) {
            return;
        }

        let deactivated = false;
        let just_unsubscribed = false;
        const subscribed = _stream_data__WEBPACK_IMPORTED_MODULE_7__.is_subscribed_by_name(stream_name);
        const sub = _stream_data__WEBPACK_IMPORTED_MODULE_7__.get_sub(stream_name);
        const can_toggle_subscription =
            sub !== undefined && _stream_data__WEBPACK_IMPORTED_MODULE_7__.can_toggle_subscription(sub);
        if (sub === undefined) {
            deactivated = true;
        } else if (!subscribed && !this.last_message_historical) {
            just_unsubscribed = true;
        }
        this.view.render_trailing_bookend(
            stream_name,
            subscribed,
            deactivated,
            just_unsubscribed,
            can_toggle_subscription,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
    }

    unmuted_messages(messages) {
        return this.data.unmuted_messages(messages);
    }

    append(messages, opts) {
        const viewable_messages = this.data.append(messages);
        this.append_to_view(viewable_messages, opts);
    }

    append_to_view(messages, {messages_are_new = false} = {}) {
        this.num_appends += 1;
        const render_info = this.view.append(messages, messages_are_new);
        return render_info;
    }

    remove_and_rerender(message_ids) {
        this.data.remove(message_ids);
        this.rerender();
    }

    show_edit_message($row, edit_obj) {
        if ($row.find(".message_edit_form form").length !== 0) {
            return;
        }
        $row.find(".message_edit_form").append(edit_obj.$form);
        $row.find(".message_content, .status-message, .message_controls").hide();
        $row.find(".sender-status").toggleClass("sender-status-edit");
        $row.find(".message_edit").css("display", "block");
        (0,autosize__WEBPACK_IMPORTED_MODULE_0__["default"])($row.find(".message_edit_content"));
    }

    hide_edit_message($row) {
        $row.find(".message_content, .status-message, .message_controls").show();
        $row.find(".sender-status").toggleClass("sender-status-edit");
        $row.find(".message_edit_form").empty();
        $row.find(".message_edit").hide();
        $row.trigger("mouseleave");
    }

    show_edit_topic_on_recipient_row($recipient_row, $form) {
        $recipient_row.find(".topic_edit_form").append($form);
        $recipient_row.find(".on_hover_topic_edit").hide();
        $recipient_row.find(".edit_message_button").hide();
        $recipient_row.find(".stream_topic").hide();
        $recipient_row.find(".topic_edit").show();
        $recipient_row.find(".always_visible_topic_edit").hide();
    }

    hide_edit_topic_on_recipient_row($recipient_row) {
        $recipient_row.find(".stream_topic").show();
        $recipient_row.find(".on_hover_topic_edit").show();
        $recipient_row.find(".edit_message_button").show();
        $recipient_row.find(".topic_edit_form").empty();
        $recipient_row.find(".topic_edit").hide();
        $recipient_row.find(".always_visible_topic_edit").show();
    }

    show_message_as_read(message, options) {
        const $row = this.get_row(message.id);
        if (options.from === "pointer" || options.from === "server") {
            $row.find(".unread_marker").addClass("fast_fade");
        } else {
            $row.find(".unread_marker").addClass("slow_fade");
        }
        $row.removeClass("unread");
    }

    reselect_selected_id() {
        const selected_id = this.data.selected_id();

        if (selected_id !== -1) {
            this.select_id(this.data.selected_id(), {from_rendering: true, mark_read: false});
        }
    }

    rerender_view() {
        this.view.rerender_preserving_scrolltop();
        this.reselect_selected_id();
    }

    rerender() {
        // We need to clear the rendering state, rather than just
        // doing clear_table, since we want to potentially recollapse
        // things.
        this.data.reset_select_to_closest();
        this.view.clear_rendering_state(false);
        this.view.update_render_window(this.selected_idx(), false);

        if (this.narrowed) {
            if (this.empty()) {
                _narrow_banner__WEBPACK_IMPORTED_MODULE_5__.show_empty_narrow_message();
            } else {
                _narrow_banner__WEBPACK_IMPORTED_MODULE_5__.hide_empty_narrow_message();
            }
        }
        this.rerender_view();
    }

    update_muting_and_rerender() {
        this.data.update_items_for_muting();
        // We need to rerender whether or not the narrow hides muted
        // topics, because we need to update recipient bars for topics
        // we've muted when we are displaying those topics.
        //
        // We could avoid a rerender if we can provide that this
        // narrow cannot have contained messages to muted topics
        // either before or after the state change.  The right place
        // to do this is in the message_events.js code path for
        // processing topic edits, since that's the only place we'll
        // call this frequently anyway.
        //
        // But in any case, we need to rerender the list for user muting,
        // to make sure only the right messages are hidden.
        this.rerender();
    }

    all_messages() {
        return this.data.all_messages();
    }

    first_unread_message_id() {
        return this.data.first_unread_message_id();
    }

    has_unread_messages() {
        return this.data.has_unread_messages();
    }

    message_range(start, end) {
        return this.data.message_range(start, end);
    }

    get_row(id) {
        return this.view.get_row(id);
    }

    change_message_id(old_id, new_id) {
        const require_rerender = this.data.change_message_id(old_id, new_id);
        if (require_rerender) {
            this.rerender_view();
        }
    }

    get_last_message_sent_by_me() {
        return this.data.get_last_message_sent_by_me();
    }
}


/***/ }),

/***/ "./static/js/message_list_data.js":
/*!****************************************!*\
  !*** ./static/js/message_list_data.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MessageListData": () => (/* binding */ MessageListData)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _fetch_status__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fetch_status */ "./static/js/fetch_status.js");
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());









class MessageListData {
    constructor({excludes_muted_topics, filter = new _filter__WEBPACK_IMPORTED_MODULE_2__.Filter()}) {
        this.excludes_muted_topics = excludes_muted_topics;
        this._all_items = [];
        this._items = [];
        this._hash = new Map();
        this._local_only = new Set();
        this._selected_id = -1;

        this.filter = filter;
        this.fetch_status = new _fetch_status__WEBPACK_IMPORTED_MODULE_1__.FetchStatus();
    }

    all_messages() {
        return this._items;
    }

    num_items() {
        return this._items.length;
    }

    empty() {
        return this._items.length === 0;
    }

    first() {
        return this._items[0];
    }

    last() {
        return this._items.at(-1);
    }

    ids_greater_or_equal_than(my_id) {
        const result = [];

        for (let i = this._items.length - 1; i >= 0; i -= 1) {
            const message_id = this._items[i].id;
            if (message_id >= my_id) {
                result.push(message_id);
            } else {
                continue;
            }
        }

        return result;
    }

    select_idx() {
        if (this._selected_id === -1) {
            return undefined;
        }
        const ids = this._items.map((message) => message.id);

        const i = ids.indexOf(this._selected_id);
        if (i === -1) {
            return undefined;
        }
        return i;
    }

    prev() {
        const i = this.select_idx();

        if (i === undefined) {
            return undefined;
        }

        if (i === 0) {
            return undefined;
        }

        return this._items[i - 1].id;
    }

    next() {
        const i = this.select_idx();

        if (i === undefined) {
            return undefined;
        }

        if (i + 1 >= this._items.length) {
            return undefined;
        }

        return this._items[i + 1].id;
    }

    is_at_end() {
        if (this._selected_id === -1) {
            return false;
        }

        const n = this._items.length;

        if (n === 0) {
            return false;
        }

        const last_msg = this._items[n - 1];

        return last_msg.id === this._selected_id;
    }

    nth_most_recent_id(n) {
        const i = this._items.length - n;
        if (i < 0) {
            return -1;
        }
        return this._items[i].id;
    }

    clear() {
        this._all_items = [];
        this._items = [];
        this._hash.clear();
    }

    get(id) {
        id = Number.parseFloat(id);
        if (Number.isNaN(id)) {
            return undefined;
        }
        return this._hash.get(id);
    }

    clear_selected_id() {
        this._selected_id = -1;
    }

    selected_id() {
        return this._selected_id;
    }

    set_selected_id(id) {
        this._selected_id = id;
    }

    selected_idx() {
        return this._lower_bound(this._selected_id);
    }

    reset_select_to_closest() {
        this._selected_id = this.closest_id(this._selected_id);
    }

    is_search() {
        return this.filter.is_search();
    }
    can_mark_messages_read() {
        return this.filter.can_mark_messages_read();
    }
    _get_predicate() {
        // We cache this.
        if (!this.predicate) {
            this.predicate = this.filter.predicate();
        }
        return this.predicate;
    }

    valid_non_duplicated_messages(messages) {
        const predicate = this._get_predicate();
        return messages.filter((msg) => this.get(msg.id) === undefined && predicate(msg));
    }

    filter_incoming(messages) {
        const predicate = this._get_predicate();
        return messages.filter((message) => predicate(message));
    }

    messages_filtered_for_topic_mutes(messages) {
        if (!this.excludes_muted_topics) {
            return [...messages];
        }

        return messages.filter((message) => {
            if (message.type !== "stream") {
                return true;
            }
            return (
                !_user_topics__WEBPACK_IMPORTED_MODULE_5__.is_topic_muted(message.stream_id, message.topic) || message.mentioned
            );
        });
    }

    messages_filtered_for_user_mutes(messages) {
        if (this.filter.is_non_huddle_pm()) {
            // We are in a 1:1 PM narrow, so do not do any filtering.
            return [...messages];
        }

        return messages.filter((message) => {
            if (message.type !== "private") {
                return true;
            }
            const recipients = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message.to_user_ids);
            if (recipients.length > 1) {
                // Huddle message
                return true;
            }

            const recipient_id = Number.parseInt(recipients[0], 10);
            return (
                !_muted_users__WEBPACK_IMPORTED_MODULE_3__.is_user_muted(recipient_id) &&
                !_muted_users__WEBPACK_IMPORTED_MODULE_3__.is_user_muted(message.sender_id)
            );
        });
    }

    unmuted_messages(messages) {
        return this.messages_filtered_for_topic_mutes(
            this.messages_filtered_for_user_mutes(messages),
        );
    }

    update_items_for_muting() {
        this._items = this.unmuted_messages(this._all_items);
    }

    first_unread_message_id() {
        const first_unread = this._items.find((message) => _unread__WEBPACK_IMPORTED_MODULE_4__.message_unread(message));

        if (first_unread) {
            return first_unread.id;
        }

        // if no unread, return the bottom message
        return this.last().id;
    }

    has_unread_messages() {
        return this._items.some((message) => _unread__WEBPACK_IMPORTED_MODULE_4__.message_unread(message));
    }

    add_messages(messages) {
        let top_messages = [];
        let bottom_messages = [];
        let interior_messages = [];

        // If we're initially populating the list, save the messages in
        // bottom_messages regardless
        if (this.selected_id() === -1 && this.empty()) {
            const narrow_messages = this.filter_incoming(messages);
            bottom_messages = narrow_messages.filter((msg) => !this.get(msg.id));
        } else {
            // Filter out duplicates that are already in self, and all messages
            // that fail our filter predicate
            messages = this.valid_non_duplicated_messages(messages);

            for (const msg of messages) {
                // Put messages in correct order on either side of the
                // message list.  This code path assumes that messages
                // is a (1) sorted, and (2) consecutive block of
                // messages that belong in this message list; those
                // facts should be ensured by the caller.
                if (this.empty() || msg.id > this.last().id) {
                    bottom_messages.push(msg);
                } else if (msg.id < this.first().id) {
                    top_messages.push(msg);
                } else {
                    interior_messages.push(msg);
                }
            }
        }

        if (interior_messages.length > 0) {
            interior_messages = this.add_anywhere(interior_messages);
        }

        if (top_messages.length > 0) {
            top_messages = this.prepend(top_messages);
        }

        if (bottom_messages.length > 0) {
            bottom_messages = this.append(bottom_messages);
        }

        const info = {
            top_messages,
            bottom_messages,
            interior_messages,
        };

        return info;
    }

    add_anywhere(messages) {
        // Caller should have already filtered messages.
        // This should be used internally when we have
        // "interior" messages to add and can't optimize
        // things by only doing prepend or only doing append.

        const viewable_messages = this.unmuted_messages(messages);

        this._all_items = messages.concat(this._all_items);
        this._all_items.sort((a, b) => a.id - b.id);

        this._items = viewable_messages.concat(this._items);
        this._items.sort((a, b) => a.id - b.id);

        this._add_to_hash(messages);
        return viewable_messages;
    }

    append(messages) {
        // Caller should have already filtered
        const viewable_messages = this.unmuted_messages(messages);

        this._all_items = this._all_items.concat(messages);
        this._items = this._items.concat(viewable_messages);

        this._add_to_hash(messages);
        return viewable_messages;
    }

    prepend(messages) {
        // Caller should have already filtered
        const viewable_messages = this.unmuted_messages(messages);

        this._all_items = messages.concat(this._all_items);
        this._items = viewable_messages.concat(this._items);

        this._add_to_hash(messages);
        return viewable_messages;
    }

    remove(message_ids) {
        const msg_ids_to_remove = new Set(message_ids);
        for (const id of msg_ids_to_remove) {
            this._hash.delete(id);
            this._local_only.delete(id);
        }

        this._items = this._items.filter((msg) => !msg_ids_to_remove.has(msg.id));
        this._all_items = this._all_items.filter((msg) => !msg_ids_to_remove.has(msg.id));
    }

    // Returns messages from the given message list in the specified range, inclusive
    message_range(start, end) {
        if (start === -1) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("message_range given a start of -1");
        }

        const start_idx = this._lower_bound(start);
        const end_idx = this._lower_bound(end);
        return this._items.slice(start_idx, end_idx + 1);
    }

    // Returns the index where you could insert the desired ID
    // into the message list, without disrupting the sort order
    // This takes into account the potentially-unsorted
    // nature of local message IDs in the message list
    _lower_bound(id) {
        const less_func = (msg, ref_id, a_idx) => {
            if (this._is_localonly_id(msg.id)) {
                // First non-local message before this one
                const effective = this._next_nonlocal_message(this._items, a_idx, (idx) => idx - 1);
                if (effective) {
                    // Turn the 10.02 in [11, 10.02, 12] into 11.02
                    const decimal = Number.parseFloat((msg.id % 1).toFixed(0.02));
                    const effective_id = effective.id + decimal;
                    return effective_id < ref_id;
                }
            }
            return msg.id < ref_id;
        };

        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(this._items, id, less_func);
    }

    closest_id(id) {
        // We directly keep track of local-only messages,
        // so if we're asked for one that we know we have,
        // just return it directly
        if (this._local_only.has(id)) {
            return id;
        }

        const items = this._items;

        if (items.length === 0) {
            return -1;
        }

        let closest = this._lower_bound(id);

        if (closest < items.length && id === items[closest].id) {
            return items[closest].id;
        }

        const potential_closest_matches = [];
        if (closest > 0 && this._is_localonly_id(items[closest - 1].id)) {
            // Since we treated all blocks of local ids as their left-most-non-local message
            // for lower_bound purposes, find the real leftmost index (first non-local id)
            do {
                potential_closest_matches.push(closest);
                closest -= 1;
            } while (closest > 0 && this._is_localonly_id(items[closest - 1].id));
        }
        potential_closest_matches.push(closest);

        if (closest === items.length) {
            closest = closest - 1;
        } else {
            // Any of the ids that we skipped over (due to them being local-only) might be the
            // closest ID to the desired one, in case there is no exact match.
            potential_closest_matches.unshift(closest - 1);
            let best_match = items[closest].id;

            for (const potential_idx of potential_closest_matches) {
                if (potential_idx < 0) {
                    continue;
                }
                const item = items[potential_idx];

                if (item === undefined) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid potential_idx: " + potential_idx);
                    continue;
                }

                const potential_match = item.id;
                // If the potential id is the closest to the requested, save that one
                if (Math.abs(id - potential_match) < Math.abs(best_match - id)) {
                    best_match = potential_match;
                    closest = potential_idx;
                }
            }
        }
        return items[closest].id;
    }

    advance_past_messages(msg_ids) {
        // Start with the current pointer, but then keep advancing the
        // pointer while the next message's id is in msg_ids.  See trac #1555
        // for more context, but basically we are skipping over contiguous
        // messages that we have recently visited.
        let next_msg_id = 0;

        const id_set = new Set(msg_ids);

        let idx = this.selected_idx() + 1;
        while (idx < this._items.length) {
            const msg_id = this._items[idx].id;
            if (!id_set.has(msg_id)) {
                break;
            }
            next_msg_id = msg_id;
            idx += 1;
        }

        if (next_msg_id > 0) {
            this.set_selected_id(next_msg_id);
        }
    }

    _add_to_hash(messages) {
        for (const elem of messages) {
            const id = Number.parseFloat(elem.id);
            if (Number.isNaN(id)) {
                throw new TypeError("Bad message id");
            }
            if (this._is_localonly_id(id)) {
                this._local_only.add(id);
            }
            if (this._hash.has(id)) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Duplicate message added to MessageListData");
                continue;
            }
            this._hash.set(id, elem);
        }
    }

    _is_localonly_id(id) {
        return id % 1 !== 0;
    }

    _next_nonlocal_message(item_list, start_index, op) {
        let cur_idx = start_index;
        do {
            cur_idx = op(cur_idx);
        } while (item_list[cur_idx] !== undefined && this._is_localonly_id(item_list[cur_idx].id));
        return item_list[cur_idx];
    }

    change_message_id(old_id, new_id) {
        // Update our local cache that uses the old id to the new id
        if (this._hash.has(old_id)) {
            const msg = this._hash.get(old_id);
            this._hash.delete(old_id);
            this._hash.set(new_id, msg);
        } else {
            return false;
        }

        if (this._local_only.has(old_id)) {
            if (this._is_localonly_id(new_id)) {
                this._local_only.add(new_id);
            }
            this._local_only.delete(old_id);
        }

        if (this._selected_id === old_id) {
            this._selected_id = new_id;
        }

        return this.reorder_messages(new_id);
    }

    reorder_messages(new_id) {
        const message_sort_func = (a, b) => a.id - b.id;
        // If this message is now out of order, re-order and re-render
        const current_message = this._hash.get(new_id);
        const index = this._items.indexOf(current_message);

        const next = this._next_nonlocal_message(this._items, index, (idx) => idx + 1);
        const prev = this._next_nonlocal_message(this._items, index, (idx) => idx - 1);

        if (
            (next !== undefined && current_message.id > next.id) ||
            (prev !== undefined && current_message.id < prev.id)
        ) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Changed message ID from server caused out-of-order list, reordering");
            this._items.sort(message_sort_func);
            this._all_items.sort(message_sort_func);
            return true;
        }

        return false;
    }

    get_messages_sent_by_user(user_id) {
        const msgs = this._items.filter((msg) => msg.sender_id === user_id);
        if (msgs.length === 0) {
            return [];
        }
        return msgs;
    }

    get_last_message_sent_by_me() {
        const msg_index = this._items.findLastIndex((msg) => msg.sender_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        if (msg_index === -1) {
            return undefined;
        }
        const msg = this._items[msg_index];
        return msg;
    }
}


/***/ }),

/***/ "./static/js/message_list_view.js":
/*!****************************************!*\
  !*** ./static/js/message_list_view.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MessageListView": () => (/* binding */ MessageListView)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/isSameDay/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _templates_bookend_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/bookend.hbs */ "./static/templates/bookend.hbs");
/* harmony import */ var _templates_bookend_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_bookend_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_login_to_view_image_button_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/login_to_view_image_button.hbs */ "./static/templates/login_to_view_image_button.hbs");
/* harmony import */ var _templates_login_to_view_image_button_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_login_to_view_image_button_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_message_group_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/message_group.hbs */ "./static/templates/message_group.hbs");
/* harmony import */ var _templates_message_group_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_message_group_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_recipient_row_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/recipient_row.hbs */ "./static/templates/recipient_row.hbs");
/* harmony import */ var _templates_recipient_row_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_recipient_row_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_single_message_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/single_message.hbs */ "./static/templates/single_message.hbs");
/* harmony import */ var _templates_single_message_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_single_message_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _reactions__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./reactions */ "./static/js/reactions.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _submessage__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./submessage */ "./static/js/submessage.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());







































function same_day(earlier_msg, later_msg) {
    if (earlier_msg === undefined || later_msg === undefined) {
        return false;
    }
    return (0,date_fns__WEBPACK_IMPORTED_MODULE_29__["default"])(earlier_msg.msg.timestamp * 1000, later_msg.msg.timestamp * 1000);
}

function same_sender(a, b) {
    if (a === undefined || b === undefined) {
        return false;
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.msg, b.msg);
}

function same_recipient(a, b) {
    if (a === undefined || b === undefined) {
        return false;
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.msg, b.msg);
}

function analyze_edit_history(message) {
    // Returns a dict of booleans that describe the message's history:
    //   * edited: if the message has had its content edited
    //   * moved: if the message has had its stream/topic edited
    //   * resolve_toggled: if the message has had a topic resolve/unresolve edit
    let edited = false;
    let moved = false;
    let resolve_toggled = false;

    if (message.edit_history !== undefined) {
        for (const edit_history_event of message.edit_history) {
            if (edit_history_event.prev_content) {
                edited = true;
            }

            if (edit_history_event.prev_stream) {
                moved = true;
            }

            if (edit_history_event.prev_topic) {
                // We know it has a topic edit. Now we need to determine if
                // it was a true move or a resolve/unresolve.
                if (
                    _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(edit_history_event.topic) &&
                    edit_history_event.topic.slice(2) === edit_history_event.prev_topic
                ) {
                    // Resolved.
                    resolve_toggled = true;
                    continue;
                }
                if (
                    _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(edit_history_event.prev_topic) &&
                    edit_history_event.prev_topic.slice(2) === edit_history_event.topic
                ) {
                    // Unresolved.
                    resolve_toggled = true;
                    continue;
                }
                // Otherwise, it is a real topic rename/move.
                moved = true;
            }
        }
    }
    return {edited, moved, resolve_toggled};
}

function render_group_display_date(group, message_container) {
    const time = new Date(message_container.msg.timestamp * 1000);
    const today = new Date();
    const date_element = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time, undefined, today)[0];

    group.date = date_element.outerHTML;
}

function update_group_date_divider(group, message_container, prev) {
    const time = new Date(message_container.msg.timestamp * 1000);
    const today = new Date();

    if (prev !== undefined) {
        const prev_time = new Date(prev.msg.timestamp * 1000);
        if (!(0,date_fns__WEBPACK_IMPORTED_MODULE_29__["default"])(time, prev_time)) {
            // NB: group_date_divider_html is HTML, inserted into the document without escaping.
            group.group_date_divider_html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                time,
                prev_time,
                today,
            )[0].outerHTML;
            group.show_group_date_divider = true;
        }
    } else {
        // Show the date in the recipient bar, but not a date separator bar.
        group.show_group_date_divider = false;
        group.group_date_divider_html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time, undefined, today)[0].outerHTML;
    }
}

function clear_group_date_divider(group) {
    group.show_group_date_divider = false;
    group.group_date_divider_html = undefined;
}

function clear_message_date_divider(msg) {
    // see update_message_date_divider for how
    // these get set
    msg.want_date_divider = false;
    msg.date_divider_html = undefined;
}

function update_message_date_divider(opts) {
    const prev_msg_container = opts.prev_msg_container;
    const curr_msg_container = opts.curr_msg_container;

    if (!prev_msg_container || same_day(curr_msg_container, prev_msg_container)) {
        clear_message_date_divider(curr_msg_container);
        return;
    }

    const prev_time = new Date(prev_msg_container.msg.timestamp * 1000);
    const curr_time = new Date(curr_msg_container.msg.timestamp * 1000);
    const today = new Date();

    curr_msg_container.want_date_divider = true;
    curr_msg_container.date_divider_html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        curr_time,
        prev_time,
        today,
    )[0].outerHTML;
}

function set_timestr(message_container) {
    const time = new Date(message_container.msg.timestamp * 1000);
    message_container.timestr = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time);
}

function set_topic_edit_properties(group, message) {
    group.always_visible_topic_edit = false;
    group.on_hover_topic_edit = false;
    // if a user who can edit a topic, can resolve it as well
    group.user_can_resolve_topic = _message_edit__WEBPACK_IMPORTED_MODULE_14__.is_topic_editable(message);

    // Messages with no topics should always have an edit icon visible
    // to encourage updating them. Admins can also edit any topic.
    if (message.topic === _compose__WEBPACK_IMPORTED_MODULE_10__.empty_topic_placeholder()) {
        group.always_visible_topic_edit = true;
    } else if (_message_edit__WEBPACK_IMPORTED_MODULE_14__.is_topic_editable(message)) {
        group.on_hover_topic_edit = true;
    }
}

function populate_group_from_message_container(group, message_container) {
    group.is_stream = message_container.msg.is_stream;
    group.is_private = message_container.msg.is_private;

    if (group.is_stream) {
        group.background_color = _stream_data__WEBPACK_IMPORTED_MODULE_26__.get_color(message_container.msg.stream);
        group.color_class = Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(group.background_color);
        group.invite_only = _stream_data__WEBPACK_IMPORTED_MODULE_26__.is_invite_only_by_stream_name(message_container.msg.stream);
        group.is_web_public = _stream_data__WEBPACK_IMPORTED_MODULE_26__.is_web_public(message_container.msg.stream_id);
        group.topic = message_container.msg.topic;
        group.match_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message_container.msg);
        group.stream_url = message_container.stream_url;
        group.topic_url = message_container.topic_url;
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message_container.msg.stream_id);
        if (sub === undefined) {
            // Hack to handle unusual cases like the tutorial where
            // the streams used don't actually exist in the subs
            // module.  Ideally, we'd clean this up by making the
            // tutorial populate stream_settings_ui.js "properly".
            group.stream_id = -1;
        } else {
            group.stream_id = sub.stream_id;
        }
        group.topic_is_resolved = _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(group.topic);
        group.topic_muted = _user_topics__WEBPACK_IMPORTED_MODULE_28__.is_topic_muted(group.stream_id, group.topic);
    } else if (group.is_private) {
        group.pm_with_url = message_container.pm_with_url;
        group.display_reply_to = _message_store__WEBPACK_IMPORTED_MODULE_16__.get_pm_full_names(message_container.msg);
    }
    group.display_recipient = message_container.msg.display_recipient;
    group.topic_links = message_container.msg.topic_links;

    set_topic_edit_properties(group, message_container.msg);
    render_group_display_date(group, message_container);
}

class MessageListView {
    constructor(list, table_name, collapse_messages) {
        this.list = list;
        this.collapse_messages = collapse_messages;
        this._rows = new Map();
        this.message_containers = new Map();
        this.table_name = table_name;
        if (this.table_name) {
            this.clear_table();
        }
        this._message_groups = [];

        // Half-open interval of the indices that define the current render window
        this._render_win_start = 0;
        this._render_win_end = 0;
    }

    // Number of messages to render at a time
    _RENDER_WINDOW_SIZE = 400;
    // Number of messages away from edge of render window at which we
    // trigger a re-render
    _RENDER_THRESHOLD = 50;

    _get_msg_timestring(message_container) {
        let last_edit_timestamp;
        if (message_container.msg.local_edit_timestamp !== undefined) {
            last_edit_timestamp = message_container.msg.local_edit_timestamp;
        } else {
            last_edit_timestamp = message_container.msg.last_edit_timestamp;
        }
        if (last_edit_timestamp !== undefined) {
            const last_edit_time = new Date(last_edit_timestamp * 1000);
            const today = new Date();
            return (
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_edit_time, undefined, today)[0].textContent +
                " at " +
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_edit_time)
            );
        }
        return undefined;
    }

    _add_msg_edited_vars(message_container) {
        // This function computes data on whether the message was edited
        // and in what ways, as well as where the "EDITED" or "MOVED"
        // label should be located, and adds it to the message_container
        // object.
        //
        // The bools can be defined only when the message is edited
        // (or when the `last_edit_timestr` is defined). The bools are:
        //   * `edited_in_left_col`      -- when label appears in left column.
        //   * `edited_alongside_sender` -- when label appears alongside sender info.
        //   * `edited_status_msg`       -- when label appears for a "/me" message.
        const last_edit_timestr = this._get_msg_timestring(message_container);
        const include_sender = message_container.include_sender;
        const is_hidden = message_container.is_hidden;
        const status_message = Boolean(message_container.status_message);
        const edit_history_details = analyze_edit_history(message_container.msg);

        if (
            last_edit_timestr === undefined ||
            !(edit_history_details.moved || edit_history_details.edited)
        ) {
            // For messages whose edit history at most includes
            // resolving topics, we don't display an EDITED/MOVED
            // notice at all. (The message actions popover will still
            // display an edit history option, so you can see when it
            // was marked as resolved if you need to).
            delete message_container.last_edit_timestr;
            message_container.edited_in_left_col = false;
            message_container.edited_alongside_sender = false;
            message_container.edited_status_msg = false;
            return;
        }

        message_container.last_edit_timestr = last_edit_timestr;
        message_container.edited_in_left_col = !include_sender && !is_hidden;
        message_container.edited_alongside_sender = include_sender && !status_message;
        message_container.edited_status_msg = include_sender && status_message;
        message_container.moved = edit_history_details.moved && !edit_history_details.edited;
    }

    set_calculated_message_container_variables(message_container, is_revealed) {
        set_timestr(message_container);

        /*
            If the message needs to be hidden because the sender was muted, we do
            a few things:
            1. Hide the sender avatar and name.
            2. Hide reactions on that message.
            3. Do not give a background color to that message even if it mentions the
               current user.

            Further, is a hidden message was just revealed, we make sure to show
            the sender.
        */

        const is_hidden =
            _muted_users__WEBPACK_IMPORTED_MODULE_18__.is_user_muted(message_container.msg.sender_id) && !is_revealed;

        message_container.is_hidden = is_hidden;
        // Make sure the right thing happens if the message was edited to mention us.
        if (!is_hidden && message_container.msg.mentioned) {
            // Currently the API does not differentiate between a group mention and
            // a user mention. For now, we parse the markdown to see if the message
            // mentions the user.
            let is_user_mention = false;
            const $msg = jquery__WEBPACK_IMPORTED_MODULE_0___default()(message_container.msg.content);
            $msg.find(".user-mention:not(.silent)").each(function () {
                const user_id = _rendered_markdown__WEBPACK_IMPORTED_MODULE_24__.get_user_id_for_mention_button(this);
                if (user_id === "*") {
                    return;
                }
                if (_people__WEBPACK_IMPORTED_MODULE_20__.is_my_user_id(user_id)) {
                    is_user_mention = true;
                }
            });

            // If a message includes a user mention, then we don't care if there is a
            // group/wildcard mention, and color the message as a user mention. If the
            // message didn't include a user mention, then it was a usergroup/wildcard
            // mention (which is the only other option for `mentioned` being true).
            if (message_container.msg.mentioned_me_directly && is_user_mention) {
                message_container.mention_classname = "direct_mention";
            } else {
                message_container.mention_classname = "group_mention";
            }
        } else {
            // If there are no mentions, the classname might need to be updated (i.e.
            // removed) to reflect this.
            message_container.mention_classname = null;
        }
        message_container.include_sender = message_container.include_sender && !is_hidden;
        if (is_revealed) {
            // If the message is to be revealed, we show the sender anyways, because the
            // the first message in the group (which would hold the sender) can still be
            // hidden.
            message_container.include_sender = true;
        }

        message_container.sender_is_bot = _people__WEBPACK_IMPORTED_MODULE_20__.sender_is_bot(message_container.msg);
        message_container.sender_is_guest = _people__WEBPACK_IMPORTED_MODULE_20__.sender_is_guest(message_container.msg);

        message_container.small_avatar_url = _people__WEBPACK_IMPORTED_MODULE_20__.small_avatar_url(message_container.msg);
        if (message_container.msg.stream) {
            message_container.background_color = _stream_data__WEBPACK_IMPORTED_MODULE_26__.get_color(
                message_container.msg.stream,
            );
        }

        this._maybe_format_me_message(message_container);
        // Once all other variables are updated
        this._add_msg_edited_vars(message_container);
    }

    maybe_add_subscription_marker(group, last_msg_container, first_msg_container) {
        // The `historical` flag is present on messages which were
        // sent a time when the current user was not subscribed to the
        // stream receiving the message.
        //
        // When a narrow contains only messages within a given stream,
        // we can infer that whenever the historical flag flips
        // between adjacent messages, the current user must have
        // (un)subscribed in between those messages.
        if (!this.list.data.filter.has_operator("stream")) {
            return;
        }
        if (last_msg_container === undefined) {
            return;
        }

        const last_subscribed = !last_msg_container.msg.historical;
        const first_subscribed = !first_msg_container.msg.historical;
        const stream = first_msg_container.msg.stream;

        if (!last_subscribed && first_subscribed) {
            group.bookend_top = true;
            group.subscribed = true;
            group.stream_name = stream;
            return;
        }

        if (last_subscribed && !first_subscribed) {
            group.bookend_top = true;
            group.just_unsubscribed = true;
            group.stream_name = stream;
            return;
        }
    }

    build_message_groups(message_containers) {
        const start_group = () => ({
            message_containers: [],
            message_group_id: lodash__WEBPACK_IMPORTED_MODULE_1___default().uniqueId("message_group_"),
        });

        let current_group = start_group();
        const new_message_groups = [];
        let prev;

        const add_message_container_to_group = (message_container) => {
            if (same_sender(prev, message_container)) {
                prev.next_is_same_sender = true;
            }
            current_group.message_containers.push(message_container);
        };

        const finish_group = () => {
            if (current_group.message_containers.length > 0) {
                populate_group_from_message_container(
                    current_group,
                    current_group.message_containers[0],
                );
                current_group.message_containers.at(-1).include_footer = true;
                new_message_groups.push(current_group);
            }
        };

        for (const message_container of message_containers) {
            const message_reactions = _reactions__WEBPACK_IMPORTED_MODULE_22__.get_message_reactions(message_container.msg);
            message_container.msg.message_reactions = message_reactions;
            message_container.include_recipient = false;
            message_container.include_footer = false;

            if (
                same_recipient(prev, message_container) &&
                this.collapse_messages &&
                prev.msg.historical === message_container.msg.historical
            ) {
                add_message_container_to_group(message_container);
                update_message_date_divider({
                    prev_msg_container: prev,
                    curr_msg_container: message_container,
                });
            } else {
                finish_group();
                current_group = start_group();
                add_message_container_to_group(message_container);

                update_group_date_divider(current_group, message_container, prev);
                clear_message_date_divider(message_container);

                message_container.include_recipient = true;
                message_container.subscribed = false;
                message_container.unsubscribed = false;

                this.maybe_add_subscription_marker(current_group, prev, message_container);

                if (message_container.msg.stream) {
                    message_container.stream_url = _hash_util__WEBPACK_IMPORTED_MODULE_13__.by_stream_url(
                        message_container.msg.stream_id,
                    );
                    message_container.topic_url = _hash_util__WEBPACK_IMPORTED_MODULE_13__.by_stream_topic_url(
                        message_container.msg.stream_id,
                        message_container.msg.topic,
                    );
                } else {
                    message_container.pm_with_url = message_container.msg.pm_with_url;
                }
            }

            message_container.include_sender = true;
            if (
                !message_container.include_recipient &&
                !prev.status_message &&
                same_day(prev, message_container) &&
                same_sender(prev, message_container)
            ) {
                message_container.include_sender = false;
            }

            this.set_calculated_message_container_variables(message_container);

            prev = message_container;
        }

        finish_group();

        return new_message_groups;
    }

    join_message_groups(first_group, second_group) {
        // join_message_groups will combine groups if they have the
        // same_recipient and the view supports collapsing, otherwise
        // it may add a subscription_marker if required.  It returns
        // true if the two groups were joined in to one and the
        // second_group should be ignored.
        if (first_group === undefined || second_group === undefined) {
            return false;
        }
        const last_msg_container = first_group.message_containers.at(-1);
        const first_msg_container = second_group.message_containers[0];

        // Join two groups into one.
        if (
            this.collapse_messages &&
            same_recipient(last_msg_container, first_msg_container) &&
            last_msg_container.msg.historical === first_msg_container.msg.historical
        ) {
            if (
                !last_msg_container.status_message &&
                !first_msg_container.msg.is_me_message &&
                same_day(last_msg_container, first_msg_container) &&
                same_sender(last_msg_container, first_msg_container)
            ) {
                first_msg_container.include_sender = false;
            }
            if (same_sender(last_msg_container, first_msg_container)) {
                last_msg_container.next_is_same_sender = true;
            }
            first_group.message_containers = first_group.message_containers.concat(
                second_group.message_containers,
            );
            return true;
        }

        // We may need to add a subscripton marker after merging the groups.
        this.maybe_add_subscription_marker(second_group, last_msg_container, first_msg_container);

        return false;
    }

    merge_message_groups(new_message_groups, where) {
        // merge_message_groups takes a list of new messages groups to add to
        // this._message_groups and a location where to merge them currently
        // top or bottom. It returns an object of changes which needed to be
        // rendered in to the page. The types of actions are append_group,
        // prepend_group, rerender_group, append_message.
        //
        // append_groups are groups to add to the top of the rendered DOM
        // prepend_groups are group to add to the bottom of the rendered DOM
        // rerender_groups are group that should be updated in place in the DOM
        // append_messages are messages which should be added to the last group in the DOM
        // rerender_messages are messages which should be updated in place in the DOM

        const message_actions = {
            append_groups: [],
            prepend_groups: [],
            rerender_groups: [],
            append_messages: [],
            rerender_messages_next_same_sender: [],
        };
        let first_group;
        let second_group;
        let curr_msg_container;
        let prev_msg_container;

        if (where === "top") {
            first_group = new_message_groups.at(-1);
            second_group = this._message_groups[0];
        } else {
            first_group = this._message_groups.at(-1);
            second_group = new_message_groups[0];
        }

        if (first_group) {
            prev_msg_container = first_group.message_containers.at(-1);
        }

        if (second_group) {
            curr_msg_container = second_group.message_containers[0];
        }

        const was_joined = this.join_message_groups(first_group, second_group);
        if (was_joined) {
            update_message_date_divider({
                prev_msg_container,
                curr_msg_container,
            });
        } else {
            clear_message_date_divider(curr_msg_container);
        }

        if (where === "top") {
            if (was_joined) {
                // join_message_groups moved the old message to the end of the
                // new group. We need to replace the old rendered message
                // group. So we will reuse its ID.

                first_group.message_group_id = second_group.message_group_id;
                message_actions.rerender_groups.push(first_group);

                // Swap the new group in
                this._message_groups.shift();
                this._message_groups.unshift(first_group);

                new_message_groups = new_message_groups.slice(0, -1);
            } else if (
                !same_day(second_group.message_containers[0], first_group.message_containers[0])
            ) {
                // The groups did not merge, so we need up update the date row for the old group
                update_group_date_divider(second_group, curr_msg_container, prev_msg_container);
                // We could add an action to update the date row, but for now rerender the group.
                message_actions.rerender_groups.push(second_group);
            }
            message_actions.prepend_groups = new_message_groups;
            this._message_groups = new_message_groups.concat(this._message_groups);
        } else {
            if (was_joined) {
                // rerender the last message
                message_actions.rerender_messages_next_same_sender.push(prev_msg_container);
                message_actions.append_messages = new_message_groups[0].message_containers;
                new_message_groups = new_message_groups.slice(1);
            } else if (first_group !== undefined && second_group !== undefined) {
                if (same_day(prev_msg_container, curr_msg_container)) {
                    clear_group_date_divider(second_group);
                } else {
                    // If we just sent the first message on a new day
                    // in a narrow, make sure we render a date separator.
                    update_group_date_divider(second_group, curr_msg_container, prev_msg_container);
                }
            }
            message_actions.append_groups = new_message_groups;
            this._message_groups = this._message_groups.concat(new_message_groups);
        }

        return message_actions;
    }

    _put_row($row) {
        // $row is a jQuery object wrapping one message row
        if ($row.hasClass("message_row")) {
            this._rows.set(_rows__WEBPACK_IMPORTED_MODULE_25__.id($row), $row);
        }
    }

    _post_process($message_rows) {
        // $message_rows wraps one or more message rows

        if (!($message_rows instanceof (jquery__WEBPACK_IMPORTED_MODULE_0___default()))) {
            // An assertion check that we're calling this properly
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("programming error--pass in jQuery objects");
        }

        for (const dom_row of $message_rows) {
            const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(dom_row);
            this._put_row($row);
            this._post_process_single_row($row);
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            // For images that fail to load due to being rate limited or being denied access
            // by server in general, we tell user to login to be able to view the image.
            $message_rows.find(".message_inline_image img").on("error", (e) => {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target)
                    .closest(".message_inline_image")
                    .replaceWith(_templates_login_to_view_image_button_hbs__WEBPACK_IMPORTED_MODULE_4___default()());
            });
        }
    }

    _post_process_single_row($row) {
        // For message formatting that requires some post-processing
        // (and is not possible to handle solely via CSS), this is
        // where we modify the content.  It is a goal to minimize how
        // much logic is present in this function; wherever possible,
        // we should implement features with the Markdown processor,
        // HTML and CSS.

        if ($row.length !== 1) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("programming error--expected single element");
        }

        const $content = $row.find(".message_content");

        _rendered_markdown__WEBPACK_IMPORTED_MODULE_24__.update_elements($content);

        const id = _rows__WEBPACK_IMPORTED_MODULE_25__.id($row);
        _message_edit__WEBPACK_IMPORTED_MODULE_14__.maybe_show_edit($row, id);

        _submessage__WEBPACK_IMPORTED_MODULE_27__.process_submessages({
            $row,
            message_id: id,
        });
    }

    _get_message_template(message_container) {
        const msg_reactions = _reactions__WEBPACK_IMPORTED_MODULE_22__.get_message_reactions(message_container.msg);
        message_container.msg.message_reactions = msg_reactions;
        const msg_to_render = {
            ...message_container,
            table_name: this.table_name,
        };
        return _templates_single_message_hbs__WEBPACK_IMPORTED_MODULE_7___default()(msg_to_render);
    }

    _render_group(opts) {
        const message_groups = opts.message_groups;
        const use_match_properties = opts.use_match_properties;
        const table_name = opts.table_name;

        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            _templates_message_group_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                message_groups,
                use_match_properties,
                table_name,
            }),
        );
    }

    render(messages, where, messages_are_new) {
        // This function processes messages into chunks with separators between them,
        // and templates them to be inserted as table rows into the DOM.

        if (messages.length === 0) {
            return undefined;
        }

        const list = this.list; // for convenience
        const table_name = this.table_name;
        const $table = _rows__WEBPACK_IMPORTED_MODULE_25__.get_table(table_name);
        let orig_scrolltop_offset;

        // If we start with the message feed scrolled up (i.e.
        // the bottom message is not visible), then we will respect
        // the user's current position after rendering, rather
        // than auto-scrolling.
        const started_scrolled_up = _message_viewport__WEBPACK_IMPORTED_MODULE_17__.is_scrolled_up();

        // The messages we are being asked to render are shared with between
        // all messages lists. To prevent having both list views overwriting
        // each others' data we will make a new message object to add data to
        // for rendering.
        const message_containers = messages.map((message) => {
            if (message.starred) {
                message.starred_status = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unstar"});
            } else {
                message.starred_status = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Star"});
            }

            message.url = _hash_util__WEBPACK_IMPORTED_MODULE_13__.by_conversation_and_time_url(message);

            return {msg: message};
        });

        const save_scroll_position = () => {
            if (orig_scrolltop_offset === undefined && this.selected_row().length > 0) {
                orig_scrolltop_offset = this.selected_row().offset().top;
            }
        };

        const restore_scroll_position = () => {
            if (
                !_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.is_visible() &&
                list === _message_lists__WEBPACK_IMPORTED_MODULE_15__.current &&
                orig_scrolltop_offset !== undefined
            ) {
                list.view.set_message_offset(orig_scrolltop_offset);
                list.reselect_selected_id();
            }
        };

        if (message_containers.length === 0) {
            return undefined;
        }

        const new_message_groups = this.build_message_groups(message_containers, this.table_name);
        const message_actions = this.merge_message_groups(new_message_groups, where);
        let new_dom_elements = [];
        let $rendered_groups;
        let $dom_messages;
        let $last_message_row;
        let $last_group_row;

        for (const message_container of message_containers) {
            this.message_containers.set(message_container.msg.id, message_container);
        }

        // Render new message groups on the top
        if (message_actions.prepend_groups.length > 0) {
            save_scroll_position();

            $rendered_groups = this._render_group({
                message_groups: message_actions.prepend_groups,
                use_match_properties: this.list.is_search(),
                table_name: this.table_name,
            });

            $dom_messages = $rendered_groups.find(".message_row");
            new_dom_elements = new_dom_elements.concat($rendered_groups);

            this._post_process($dom_messages);

            // The date row will be included in the message groups or will be
            // added in a rerendered in the group below
            $table.find(".recipient_row").first().prev(".date_row").remove();
            $table.prepend($rendered_groups);
            _condense__WEBPACK_IMPORTED_MODULE_12__.condense_and_collapse($dom_messages);
        }

        // Rerender message groups
        if (message_actions.rerender_groups.length > 0) {
            save_scroll_position();

            for (const message_group of message_actions.rerender_groups) {
                const $old_message_group = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(message_group.message_group_id)}`);
                // Remove the top date_row, we'll re-add it after rendering
                $old_message_group.prev(".date_row").remove();

                $rendered_groups = this._render_group({
                    message_groups: [message_group],
                    use_match_properties: this.list.is_search(),
                    table_name: this.table_name,
                });

                $dom_messages = $rendered_groups.find(".message_row");
                // Not adding to new_dom_elements it is only used for autoscroll

                this._post_process($dom_messages);
                $old_message_group.replaceWith($rendered_groups);
                _condense__WEBPACK_IMPORTED_MODULE_12__.condense_and_collapse($dom_messages);
            }
        }

        // Update the rendering for message rows which used to be last
        // and now know whether the following message has the same
        // sender.
        //
        // It is likely the case that we can just remove the block
        // entirely, since it appears the next_is_same_sender CSS
        // class doesn't do anything.
        if (message_actions.rerender_messages_next_same_sender.length > 0) {
            const targets = message_actions.rerender_messages_next_same_sender;

            for (const message_container of targets) {
                const $row = this.get_row(message_container.msg.id);
                $row.find("div.messagebox").toggleClass(
                    "next_is_same_sender",
                    message_container.next_is_same_sender,
                );
            }
        }

        // Insert new messages in to the last message group
        if (message_actions.append_messages.length > 0) {
            $last_message_row = $table.find(".message_row").last().expectOne();
            $last_group_row = _rows__WEBPACK_IMPORTED_MODULE_25__.get_message_recipient_row($last_message_row);
            $dom_messages = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                message_actions.append_messages
                    .map((message_container) => this._get_message_template(message_container))
                    .join(""),
            ).filter(".message_row");

            this._post_process($dom_messages);
            $last_group_row.append($dom_messages);

            _condense__WEBPACK_IMPORTED_MODULE_12__.condense_and_collapse($dom_messages);
            new_dom_elements = new_dom_elements.concat($dom_messages);
        }

        // Add new message groups to the end
        if (message_actions.append_groups.length > 0) {
            // Remove the trailing bookend; it'll be re-added after we do our rendering
            this.clear_trailing_bookend();

            $rendered_groups = this._render_group({
                message_groups: message_actions.append_groups,
                use_match_properties: this.list.is_search(),
                table_name: this.table_name,
            });

            $dom_messages = $rendered_groups.find(".message_row");
            new_dom_elements = new_dom_elements.concat($rendered_groups);

            this._post_process($dom_messages);

            // This next line is a workaround for a weird scrolling
            // bug on Chrome.  Basically, in Chrome 64, we had a
            // highly reproducible bug where if you hit the "End" key
            // 5 times in a row in a `near:1` narrow (or any other
            // narrow with enough content below to try this), the 5th
            // time (because RENDER_WINDOW_SIZE / batch_size = 4,
            // i.e. the first time we need to rerender to show the
            // message "End" jumps to) would trigger an unexpected
            // scroll, resulting in some chaotic scrolling and
            // additional fetches (from bottom_whitespace ending up in
            // the view).  During debugging, we found that this adding
            // this next line seems to prevent the Chrome bug from firing.
            _message_viewport__WEBPACK_IMPORTED_MODULE_17__.scrollTop();

            $table.append($rendered_groups);
            _condense__WEBPACK_IMPORTED_MODULE_12__.condense_and_collapse($dom_messages);
        }

        restore_scroll_position();

        const last_message_group = this._message_groups.at(-1);
        if (last_message_group !== undefined) {
            list.last_message_historical =
                last_message_group.message_containers.at(-1).msg.historical;
        }

        const stream_name = _narrow_state__WEBPACK_IMPORTED_MODULE_19__.stream();
        if (stream_name !== undefined) {
            // If user narrows to a stream, doesn't update
            // trailing bookend if user is subscribed.
            const sub = _stream_data__WEBPACK_IMPORTED_MODULE_26__.get_sub(stream_name);
            if (sub === undefined || !sub.subscribed || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                list.update_trailing_bookend();
            }
        }

        if (list === _message_lists__WEBPACK_IMPORTED_MODULE_15__.current) {
            // Update the fade.

            const get_element = (message_group) => {
                // We don't have a MessageGroup class, but we can at least hide the messy details
                // of rows.js from compose_fade.  We provide a callback function to be lazy--
                // compose_fade may not actually need the elements depending on its internal
                // state.
                const $message_row = this.get_row(message_group.message_containers[0].msg.id);
                return _rows__WEBPACK_IMPORTED_MODULE_25__.get_message_recipient_row($message_row);
            };

            _compose_fade__WEBPACK_IMPORTED_MODULE_11__.update_rendered_message_groups(new_message_groups, get_element);
        }

        if (list === _message_lists__WEBPACK_IMPORTED_MODULE_15__.current && messages_are_new) {
            if (started_scrolled_up) {
                return {
                    need_user_to_scroll: true,
                };
            }
            const new_messages_height = this._new_messages_height(new_dom_elements);
            const need_user_to_scroll = this._maybe_autoscroll(new_messages_height);

            if (need_user_to_scroll) {
                return {
                    need_user_to_scroll: true,
                };
            }
        }

        return undefined;
    }

    _new_messages_height(rendered_elems) {
        let new_messages_height = 0;

        for (const $elem of rendered_elems.reverse()) {
            // Sometimes there are non-DOM elements in rendered_elems; only
            // try to get the heights of actual trs.
            if ($elem.is("div")) {
                new_messages_height += $elem.height();
            }
        }

        return new_messages_height;
    }

    _scroll_limit($selected_row, viewport_info) {
        // This scroll limit is driven by the TOP of the feed, and
        // it's the max amount that we can scroll down (or "skooch
        // up" the messages) before knocking the selected message
        // out of the feed.
        const selected_row_top = $selected_row.offset().top;
        let scroll_limit = selected_row_top - viewport_info.visible_top;

        if (scroll_limit < 0) {
            // This shouldn't happen, but if we're off by a pixel or
            // something, we can deal with it, and just warn.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Selected row appears too high on screen.");
            scroll_limit = 0;
        }

        return scroll_limit;
    }

    _maybe_autoscroll(new_messages_height) {
        // If we are near the bottom of our feed (the bottom is visible) and can
        // scroll up without moving the pointer out of the viewport, do so, by
        // up to the amount taken up by the new message.
        //
        // returns `true` if we need the user to scroll

        const $selected_row = this.selected_row();
        const $last_visible = _rows__WEBPACK_IMPORTED_MODULE_25__.last_visible();

        // Make sure we have a selected row and last visible row. (defensive)
        if (!($selected_row && $selected_row.length > 0 && $last_visible)) {
            return false;
        }

        if (new_messages_height <= 0) {
            return false;
        }

        if (!_activity__WEBPACK_IMPORTED_MODULE_8__.client_is_active) {
            // Don't autoscroll if the window hasn't had focus
            // recently.  This in intended to help protect us from
            // auto-scrolling downwards when the window is in the
            // background and might be having some functionality
            // throttled by modern Chrome's aggressive power-saving
            // features.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Suppressing scroll down due to inactivity");
            return false;
        }

        // do not scroll if there are any active popovers.
        if (_popovers__WEBPACK_IMPORTED_MODULE_21__.any_active()) {
            // If a popover is active, then we are pretty sure the
            // incoming message is not from the user themselves, so
            // we don't need to tell users to scroll down.
            return false;
        }

        const info = _message_viewport__WEBPACK_IMPORTED_MODULE_17__.message_viewport_info();
        const scroll_limit = this._scroll_limit($selected_row, info);

        // This next decision is fairly debatable.  For a big message that
        // would push the pointer off the screen, we do a partial autoscroll,
        // which has the following implications:
        //    a) user sees scrolling (good)
        //    b) user's pointer stays on screen (good)
        //    c) scroll amount isn't really tied to size of new messages (bad)
        //    d) all the bad things about scrolling for users who want messages
        //       to stay on the screen
        let scroll_amount;
        let need_user_to_scroll;

        if (new_messages_height <= scroll_limit) {
            // This is the happy path where we can just scroll
            // automatically, and the user will see the new message.
            scroll_amount = new_messages_height;
            need_user_to_scroll = false;
        } else {
            // Sometimes we don't want to scroll the entire height of
            // the message, but our callers can give appropriate
            // warnings if the message is gonna be offscreen.
            // (Even if we are somewhat constrained here, the message may
            // still end up being visible, so we do some arithmetic.)
            scroll_amount = scroll_limit;
            const offset = _message_viewport__WEBPACK_IMPORTED_MODULE_17__.offset_from_bottom($last_visible);

            // For determining whether we need to show the user a "you
            // need to scroll down" notification, the obvious check
            // would be `offset > scroll_amount`, and that is indeed
            // correct with a 1-line message in the compose box.
            // However, the compose box is open with the content of
            // the message just sent when this code runs, and
            // `offset_from_bottom` if an offset from the top of the
            // compose box, which is about to be reset to empty.  So
            // to compute the offset at the time the user might see
            // this notification, we need to adjust by the amount that
            // the current compose is bigger than the empty, open
            // compose box.
            const compose_textarea_default_height = 42;
            const compose_textarea_current_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").height();
            const expected_change =
                compose_textarea_current_height - compose_textarea_default_height;
            const expected_offset = offset - expected_change;
            need_user_to_scroll = expected_offset > scroll_amount;
        }

        // Ok, we are finally ready to actually scroll.
        if (scroll_amount > 0) {
            _message_viewport__WEBPACK_IMPORTED_MODULE_17__.system_initiated_animate_scroll(scroll_amount);
        }

        return need_user_to_scroll;
    }

    clear_rendering_state(clear_table) {
        if (clear_table) {
            this.clear_table();
        }
        this.list.last_message_historical = false;

        this._render_win_start = 0;
        this._render_win_end = 0;
    }

    update_render_window(selected_idx, check_for_changed) {
        const new_start = Math.max(selected_idx - this._RENDER_WINDOW_SIZE / 2, 0);
        if (check_for_changed && new_start === this._render_win_start) {
            return false;
        }

        this._render_win_start = new_start;
        this._render_win_end = Math.min(
            this._render_win_start + this._RENDER_WINDOW_SIZE,
            this.list.num_items(),
        );
        return true;
    }

    maybe_rerender() {
        const selected_idx = this.list.selected_idx();

        // We rerender under the following conditions:
        // * The selected message is within this._RENDER_THRESHOLD messages
        //   of the top of the currently rendered window and the top
        //   of the window does not abut the beginning of the message
        //   list
        // * The selected message is within this._RENDER_THRESHOLD messages
        //   of the bottom of the currently rendered window and the
        //   bottom of the window does not abut the end of the
        //   message list
        if (
            !(
                (selected_idx - this._render_win_start < this._RENDER_THRESHOLD &&
                    this._render_win_start !== 0) ||
                (this._render_win_end - selected_idx <= this._RENDER_THRESHOLD &&
                    this._render_win_end !== this.list.num_items())
            )
        ) {
            return false;
        }

        if (!this.update_render_window(selected_idx, true)) {
            return false;
        }

        this.rerender_preserving_scrolltop();
        return true;
    }

    rerender_preserving_scrolltop(discard_rendering_state) {
        // old_offset is the number of pixels between the top of the
        // viewable window and the selected message
        let old_offset;
        const $selected_row = this.selected_row();
        const selected_in_view = $selected_row.length > 0;
        if (selected_in_view) {
            old_offset = $selected_row.offset().top;
        }
        if (discard_rendering_state) {
            // If we know that the existing render is invalid way
            // (typically because messages appear out-of-order), then
            // we discard the message_list rendering state entirely.
            this.clear_rendering_state(true);
            this.update_render_window(this.list.selected_idx(), false);
        }
        return this.rerender_with_target_scrolltop($selected_row, old_offset);
    }

    set_message_offset(offset) {
        const $msg = this.selected_row();
        _message_viewport__WEBPACK_IMPORTED_MODULE_17__.scrollTop(_message_viewport__WEBPACK_IMPORTED_MODULE_17__.scrollTop() + $msg.offset().top - offset);
    }

    rerender_with_target_scrolltop(selected_row, target_offset) {
        // target_offset is the target number of pixels between the top of the
        // viewable window and the selected message
        this.clear_table();
        this.render(
            this.list.all_messages().slice(this._render_win_start, this._render_win_end),
            "bottom",
        );

        // If we could see the newly selected message, scroll the
        // window such that the newly selected message is at the
        // same location as it would have been before we
        // re-rendered.
        if (target_offset !== undefined) {
            if (this.selected_row().length === 0 && this.list.selected_id() > -1) {
                this.list.select_id(this.list.selected_id(), {use_closest: true});
            }

            this.set_message_offset(target_offset);
        }
    }

    _find_message_group(message_group_id) {
        // Ideally, we'd maintain this data structure with a hash
        // table or at least a pointer from the message containers (in
        // either case, updating the data structure when message
        // groups are merged etc.) , but we only call this from flows
        // like message editing, so it's not a big performance
        // problem.
        return this._message_groups.find(
            // Since we don't have a way to get a message group from
            // the containing message container, we just do a search
            // to find it.
            (message_group) => message_group.message_group_id === message_group_id,
        );
    }

    _rerender_header(message_containers) {
        // Given a list of messages that are in the **same** message group,
        // rerender the header / recipient bar of the messages
        if (message_containers.length === 0) {
            return;
        }

        const $first_row = this.get_row(message_containers[0].msg.id);

        // We may not have the row if the stream or topic was muted
        if ($first_row.length === 0) {
            return;
        }

        const $recipient_row = _rows__WEBPACK_IMPORTED_MODULE_25__.get_message_recipient_row($first_row);
        const $header = $recipient_row.find(".message_header");
        const message_group_id = $recipient_row.attr("id");

        // Since there might be multiple dates within the message
        // group, it's important to look up the original/full message
        // group rather than doing an artificial rerendering of the
        // message header from the set of message containers passed in
        // here.
        const group = this._find_message_group(message_group_id);
        if (group === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Could not find message group for rerendering headers");
            return;
        }

        // TODO: It's possible that we no longer need this populate
        // call; it was introduced in an earlier version of this code
        // where we constructed an artificial message group for this
        // rerendering rather than looking up the original version.
        populate_group_from_message_container(group, group.message_containers[0]);

        const $rendered_recipient_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_recipient_row_hbs__WEBPACK_IMPORTED_MODULE_6___default()(group));

        $header.replaceWith($rendered_recipient_row);
    }

    _rerender_message(message_container, {message_content_edited, is_revealed}) {
        const $row = this.get_row(message_container.msg.id);
        const was_selected = this.list.selected_message() === message_container.msg;

        this.set_calculated_message_container_variables(message_container, is_revealed);

        const $rendered_msg = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this._get_message_template(message_container));
        if (message_content_edited) {
            $rendered_msg.addClass("fade-in-message");
        }
        this._post_process($rendered_msg);
        $row.replaceWith($rendered_msg);

        if (was_selected) {
            this.list.select_id(message_container.msg.id);
        }
    }

    reveal_hidden_message(message_id) {
        const message_container = this.message_containers.get(message_id);
        this._rerender_message(message_container, {
            message_content_edited: false,
            is_revealed: true,
        });
    }

    hide_revealed_message(message_id) {
        const message_container = this.message_containers.get(message_id);
        this._rerender_message(message_container, {
            message_content_edited: false,
            is_revealed: false,
        });
    }

    rerender_messages(messages, message_content_edited) {
        // Convert messages to list messages
        let message_containers = messages.map((message) => this.message_containers.get(message.id));
        // We may not have the message_container if the stream or topic was muted
        message_containers = message_containers.filter(
            (message_container) => message_container !== undefined,
        );

        const message_groups = [];
        let current_group = [];

        for (const message_container of message_containers) {
            if (
                current_group.length === 0 ||
                same_recipient(current_group.at(-1), message_container)
            ) {
                current_group.push(message_container);
            } else {
                message_groups.push(current_group);
                current_group = [];
            }
            this._rerender_message(message_container, {message_content_edited, is_revealed: false});
        }

        if (current_group.length !== 0) {
            message_groups.push(current_group);
        }

        for (const messages_in_group of message_groups) {
            this._rerender_header(messages_in_group, message_content_edited);
        }
    }

    append(messages, messages_are_new) {
        const cur_window_size = this._render_win_end - this._render_win_start;
        let render_info;

        if (cur_window_size < this._RENDER_WINDOW_SIZE) {
            const slice_to_render = messages.slice(0, this._RENDER_WINDOW_SIZE - cur_window_size);
            render_info = this.render(slice_to_render, "bottom", messages_are_new);
            this._render_win_end += slice_to_render.length;
        }

        // If the pointer is high on the page such that there is a
        // lot of empty space below and the render window is full, a
        // newly received message should trigger a rerender so that
        // the new message, which will appear in the viewable area,
        // is rendered.
        const needed_rerender = this.maybe_rerender();

        if (needed_rerender) {
            render_info = {need_user_to_scroll: true};
        }

        return render_info;
    }

    prepend(messages) {
        this._render_win_start += messages.length;
        this._render_win_end += messages.length;

        const cur_window_size = this._render_win_end - this._render_win_start;
        if (cur_window_size < this._RENDER_WINDOW_SIZE) {
            const msgs_to_render_count = this._RENDER_WINDOW_SIZE - cur_window_size;
            const slice_to_render = messages.slice(messages.length - msgs_to_render_count);
            this.render(slice_to_render, "top", false);
            this._render_win_start -= slice_to_render.length;
        }

        // See comment for maybe_rerender call in the append code path
        this.maybe_rerender();
    }

    clear_table() {
        // We do not want to call .empty() because that also clears
        // jQuery data.  This does mean, however, that we need to be
        // mindful of memory leaks.
        _rows__WEBPACK_IMPORTED_MODULE_25__.get_table(this.table_name).children().detach();
        this._rows.clear();
        this._message_groups = [];
        this.message_containers.clear();
    }

    get_row(id) {
        const $row = this._rows.get(id);

        if ($row === undefined) {
            // For legacy reasons we need to return an empty
            // jQuery object here.
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()(undefined);
        }

        return $row;
    }

    clear_trailing_bookend() {
        const $trailing_bookend = _rows__WEBPACK_IMPORTED_MODULE_25__.get_table(this.table_name).find(".trailing_bookend");
        $trailing_bookend.remove();
    }

    render_trailing_bookend(
        stream_name,
        subscribed,
        deactivated,
        just_unsubscribed,
        can_toggle_subscription,
        is_spectator,
    ) {
        // This is not the only place we render bookends; see also the
        // partial in message_group.hbs, which do not set is_trailing_bookend.
        const $rendered_trailing_bookend = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            _templates_bookend_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                stream_name,
                can_toggle_subscription,
                subscribed,
                deactivated,
                just_unsubscribed,
                is_spectator,
                is_trailing_bookend: true,
            }),
        );
        _rows__WEBPACK_IMPORTED_MODULE_25__.get_table(this.table_name).append($rendered_trailing_bookend);
    }

    selected_row() {
        return this.get_row(this.list.selected_id());
    }

    get_message(id) {
        return this.list.get(id);
    }

    change_message_id(old_id, new_id) {
        if (this._rows.has(old_id)) {
            const $row = this._rows.get(old_id);
            this._rows.delete(old_id);

            $row.attr("zid", new_id);
            $row.attr("id", this.table_name + new_id);
            $row.removeClass("local");
            this._rows.set(new_id, $row);
        }

        if (this.message_containers.has(old_id)) {
            const message_container = this.message_containers.get(old_id);
            this.message_containers.delete(old_id);
            this.message_containers.set(new_id, message_container);
        }
    }

    _maybe_format_me_message(message_container) {
        if (message_container.is_hidden) {
            // If the message is to be hidden anyway, no need to render
            // it differently.
            return;
        }
        if (message_container.msg.is_me_message) {
            // Slice the '<p>/me ' off the front, and '</p>' off the first line
            // 'p' tag is sliced off to get sender in the same line as the
            // first line of the message
            const msg_content = message_container.msg.content;
            const p_index = msg_content.indexOf("</p>");
            message_container.status_message =
                msg_content.slice("<p>/me ".length, p_index) +
                msg_content.slice(p_index + "</p>".length);
            message_container.include_sender = true;
        } else {
            message_container.status_message = false;
        }
    }
}


/***/ }),

/***/ "./static/js/message_lists.js":
/*!************************************!*\
  !*** ./static/js/message_lists.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "all_rendered_message_lists": () => (/* binding */ all_rendered_message_lists),
/* harmony export */   "current": () => (/* binding */ current),
/* harmony export */   "home": () => (/* binding */ home),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "set_current": () => (/* binding */ set_current)
/* harmony export */ });
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _message_list__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_list */ "./static/js/message_list.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");




let home;
let current;

function set_current(msg_list) {
    current = msg_list;
}

function all_rendered_message_lists() {
    const rendered_message_lists = [home];
    if (current !== home && !_recent_topics_util__WEBPACK_IMPORTED_MODULE_2__.is_visible()) {
        rendered_message_lists.push(current);
    }
    return rendered_message_lists;
}

function initialize() {
    home = new _message_list__WEBPACK_IMPORTED_MODULE_1__.MessageList({
        table_name: "zhome",
        filter: new _filter__WEBPACK_IMPORTED_MODULE_0__.Filter([{operator: "in", operand: "home"}]),
        excludes_muted_topics: true,
    });
    current = home;
}


/***/ }),

/***/ "./static/js/message_live_update.js":
/*!******************************************!*\
  !*** ./static/js/message_live_update.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "rerender_messages_view": () => (/* binding */ rerender_messages_view),
/* harmony export */   "update_avatar": () => (/* binding */ update_avatar),
/* harmony export */   "update_stream_name": () => (/* binding */ update_stream_name),
/* harmony export */   "update_user_full_name": () => (/* binding */ update_user_full_name),
/* harmony export */   "update_user_status_emoji": () => (/* binding */ update_user_status_emoji)
/* harmony export */ });
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");




function rerender_messages_view() {
    for (const list of _message_lists__WEBPACK_IMPORTED_MODULE_0__.all_rendered_message_lists()) {
        list.rerender_view();
    }
}

function rerender_messages_view_for_user(user_id) {
    for (const list of _message_lists__WEBPACK_IMPORTED_MODULE_0__.all_rendered_message_lists()) {
        const messages = list.data.get_messages_sent_by_user(user_id);
        if (messages.length === 0) {
            continue;
        }
        list.view.rerender_messages(messages);
    }
}

function update_stream_name(stream_id, new_name) {
    _message_store__WEBPACK_IMPORTED_MODULE_1__.update_property("stream_name", new_name, {stream_id});
    rerender_messages_view();
}

function update_user_full_name(user_id, full_name) {
    _message_store__WEBPACK_IMPORTED_MODULE_1__.update_property("sender_full_name", full_name, {user_id});
    rerender_messages_view_for_user(user_id);
}

function update_avatar(user_id, avatar_url) {
    let url = avatar_url;
    url = _people__WEBPACK_IMPORTED_MODULE_2__.format_small_avatar_url(url);
    _message_store__WEBPACK_IMPORTED_MODULE_1__.update_property("small_avatar_url", url, {user_id});
    rerender_messages_view_for_user(user_id);
}

function update_user_status_emoji(user_id, status_emoji_info) {
    _message_store__WEBPACK_IMPORTED_MODULE_1__.update_property("status_emoji_info", status_emoji_info, {user_id});
    rerender_messages_view_for_user(user_id);
}


/***/ }),

/***/ "./static/js/message_scroll.js":
/*!*************************************!*\
  !*** ./static/js/message_scroll.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "hide_end_of_results_notice": () => (/* binding */ hide_end_of_results_notice),
/* harmony export */   "hide_history_limit_notice": () => (/* binding */ hide_history_limit_notice),
/* harmony export */   "hide_indicators": () => (/* binding */ hide_indicators),
/* harmony export */   "hide_loading_newer": () => (/* binding */ hide_loading_newer),
/* harmony export */   "hide_loading_older": () => (/* binding */ hide_loading_older),
/* harmony export */   "hide_scroll_to_bottom": () => (/* binding */ hide_scroll_to_bottom),
/* harmony export */   "hide_top_of_narrow_notices": () => (/* binding */ hide_top_of_narrow_notices),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_actively_scrolling": () => (/* binding */ is_actively_scrolling),
/* harmony export */   "mark_keyboard_triggered_current_scroll": () => (/* binding */ mark_keyboard_triggered_current_scroll),
/* harmony export */   "scroll_finished": () => (/* binding */ scroll_finished),
/* harmony export */   "show_end_of_results_notice": () => (/* binding */ show_end_of_results_notice),
/* harmony export */   "show_history_limit_notice": () => (/* binding */ show_history_limit_notice),
/* harmony export */   "show_loading_newer": () => (/* binding */ show_loading_newer),
/* harmony export */   "show_loading_older": () => (/* binding */ show_loading_older),
/* harmony export */   "show_scroll_to_bottom_button": () => (/* binding */ show_scroll_to_bottom_button),
/* harmony export */   "suppress_selection_update_on_next_scroll": () => (/* binding */ suppress_selection_update_on_next_scroll),
/* harmony export */   "update_top_of_narrow_notices": () => (/* binding */ update_top_of_narrow_notices)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./floating_recipient_bar */ "./static/js/floating_recipient_bar.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_fetch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_fetch */ "./static/js/message_fetch.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _narrow_banner__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./narrow_banner */ "./static/js/narrow_banner.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
















let actively_scrolling = false;

// Tracks whether the next scroll that will complete is initiated by
// code, not the user, and thus should avoid moving the selected
// message.
let update_selection_on_next_scroll = true;

function suppress_selection_update_on_next_scroll() {
    update_selection_on_next_scroll = false;
}

// Whether a keyboard shortcut is triggering a message feed scroll event.
let keyboard_triggered_current_scroll = false;

function mark_keyboard_triggered_current_scroll() {
    keyboard_triggered_current_scroll = true;
}

let loading_older_messages_indicator_showing = false;
let loading_newer_messages_indicator_showing = false;

function show_loading_older() {
    if (!loading_older_messages_indicator_showing) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#loading_older_messages_indicator"), {abs_positioned: true});
        loading_older_messages_indicator_showing = true;
        _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_2__.hide();
    }
}

function hide_loading_older() {
    if (loading_older_messages_indicator_showing) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#loading_older_messages_indicator"));
        loading_older_messages_indicator_showing = false;
    }
}

function show_loading_newer() {
    if (!loading_newer_messages_indicator_showing) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".bottom-messages-logo").show();
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#loading_newer_messages_indicator"), {abs_positioned: true});
        loading_newer_messages_indicator_showing = true;
        _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_2__.hide();
    }
}

function hide_loading_newer() {
    if (loading_newer_messages_indicator_showing) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".bottom-messages-logo").hide();
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#loading_newer_messages_indicator"));
        loading_newer_messages_indicator_showing = false;
    }
}

function hide_indicators() {
    hide_loading_older();
    hide_loading_newer();
}

function show_history_limit_notice() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top-messages-logo").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".history-limited-box").show();
    _narrow_banner__WEBPACK_IMPORTED_MODULE_8__.hide_empty_narrow_message();
}

function hide_history_limit_notice() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top-messages-logo").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".history-limited-box").hide();
}

function hide_end_of_results_notice() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".all-messages-search-caution").hide();
}

function show_end_of_results_notice() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".all-messages-search-caution").show();

    // Set the link to point to this search with streams:public added.
    // Note that element we adjust is not visible to spectators.
    const operators = _narrow_state__WEBPACK_IMPORTED_MODULE_9__.filter().operators();
    const update_hash = _hash_util__WEBPACK_IMPORTED_MODULE_3__.search_public_streams_notice_url(operators);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".all-messages-search-caution a.search-shared-history").attr("href", update_hash);
}

function update_top_of_narrow_notices(msg_list) {
    // Assumes that the current state is all notices hidden (i.e. this
    // will not hide a notice that should not be there)
    if (msg_list !== _message_lists__WEBPACK_IMPORTED_MODULE_6__.current) {
        return;
    }

    if (
        msg_list.data.fetch_status.has_found_oldest() &&
        _message_lists__WEBPACK_IMPORTED_MODULE_6__.current !== _message_lists__WEBPACK_IMPORTED_MODULE_6__.home
    ) {
        const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_9__.filter();
        if (filter === undefined && _recent_topics_util__WEBPACK_IMPORTED_MODULE_10__.is_visible()) {
            // user moved away from the narrow / filter to recent topics.
            return;
        }
        // Potentially display the notice that lets users know
        // that not all messages were searched.  One could
        // imagine including `filter.is_search()` in these
        // conditions, but there's a very legitimate use case
        // for moderation of searching for all messages sent
        // by a potential spammer user.
        if (
            !filter.contains_only_private_messages() &&
            !filter.includes_full_stream_history() &&
            !filter.is_personal_filter()
        ) {
            show_end_of_results_notice();
        }
    }

    if (msg_list.data.fetch_status.history_limited()) {
        show_history_limit_notice();
    }
}

function hide_top_of_narrow_notices() {
    hide_end_of_results_notice();
    hide_history_limit_notice();
}

let hide_scroll_to_bottom_timer;
function hide_scroll_to_bottom() {
    const $show_scroll_to_bottom_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#scroll-to-bottom-button-container");
    if (_message_viewport__WEBPACK_IMPORTED_MODULE_7__.bottom_message_visible() || _message_lists__WEBPACK_IMPORTED_MODULE_6__.current.empty()) {
        // If last message is visible, just hide the
        // scroll to bottom button.
        $show_scroll_to_bottom_button.removeClass("show");
        return;
    }

    // Wait before hiding to allow user time to click on the button.
    hide_scroll_to_bottom_timer = setTimeout(() => {
        // Don't hide if user is hovered on it.
        if (
            !_narrow_state__WEBPACK_IMPORTED_MODULE_9__.narrowed_by_topic_reply() &&
            !$show_scroll_to_bottom_button.get(0).matches(":hover")
        ) {
            $show_scroll_to_bottom_button.removeClass("show");
        }
    }, 3000);
}

function show_scroll_to_bottom_button() {
    if (_message_viewport__WEBPACK_IMPORTED_MODULE_7__.bottom_message_visible()) {
        // Only show scroll to bottom button when
        // last message is not visible in the
        // current scroll position.
        return;
    }

    clearTimeout(hide_scroll_to_bottom_timer);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#scroll-to-bottom-button-container").addClass("show");
}

jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("keydown", (e) => {
    if (e.shiftKey || e.ctrlKey || e.metaKey) {
        return;
    }

    // Hide scroll to bottom button on any keypress.
    // Keyboard users are very less likely to use this button.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#scroll-to-bottom-button-container").removeClass("show");
});

function is_actively_scrolling() {
    return actively_scrolling;
}

function scroll_finished() {
    actively_scrolling = false;
    hide_scroll_to_bottom();

    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_10__.is_visible()) {
        return;
    }

    if (update_selection_on_next_scroll) {
        _message_viewport__WEBPACK_IMPORTED_MODULE_7__.keep_pointer_in_view();
    } else {
        update_selection_on_next_scroll = true;
    }

    _floating_recipient_bar__WEBPACK_IMPORTED_MODULE_2__.update();

    if (_message_viewport__WEBPACK_IMPORTED_MODULE_7__.at_top()) {
        _message_fetch__WEBPACK_IMPORTED_MODULE_5__.maybe_load_older_messages({
            msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_6__.current,
        });
    }

    if (_message_viewport__WEBPACK_IMPORTED_MODULE_7__.at_bottom()) {
        _message_fetch__WEBPACK_IMPORTED_MODULE_5__.maybe_load_newer_messages({
            msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_6__.current,
        });
    }

    // When the window scrolls, it may cause some messages to
    // enter the screen and become read.  Calling
    // unread_ops.process_visible will update necessary
    // data structures and DOM elements.
    setTimeout(_unread_ops__WEBPACK_IMPORTED_MODULE_12__.process_visible, 0);
}

let scroll_timer;
function scroll_finish() {
    actively_scrolling = true;

    // Don't present the "scroll to bottom" widget if the current
    // scroll was triggered by the keyboard.
    if (!keyboard_triggered_current_scroll) {
        show_scroll_to_bottom_button();
    }
    keyboard_triggered_current_scroll = false;

    clearTimeout(scroll_timer);
    scroll_timer = setTimeout(scroll_finished, 100);
}

function initialize() {
    _message_viewport__WEBPACK_IMPORTED_MODULE_7__.$message_pane.on(
        "scroll",
        lodash__WEBPACK_IMPORTED_MODULE_1___default().throttle(() => {
            _unread_ops__WEBPACK_IMPORTED_MODULE_12__.process_visible();
            scroll_finish();
        }, 50),
    );

    // Scroll handler that marks messages as read when you scroll past them.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("message_selected.zulip", (event) => {
        if (event.id === -1) {
            return;
        }

        if (event.mark_read && event.previously_selected_id !== -1) {
            // Mark messages between old pointer and new pointer as read
            let messages;
            if (event.id < event.previously_selected_id) {
                messages = event.msg_list.message_range(event.id, event.previously_selected_id);
            } else {
                messages = event.msg_list.message_range(event.previously_selected_id, event.id);
            }
            if (event.msg_list.can_mark_messages_read()) {
                _unread_ops__WEBPACK_IMPORTED_MODULE_12__.notify_server_messages_read(messages, {from: "pointer"});
            } else if (
                _unread__WEBPACK_IMPORTED_MODULE_11__.get_unread_messages(messages).length !== 0 &&
                // The below checks might seem redundant, but it's
                // possible this logic, which runs after a delay, lost
                // a race with switching to another view, like Recent
                // Topics, and we don't want to displ[ay this banner
                // in such a view.
                //
                // This can likely be fixed more cleanly with another approach.
                _narrow_state__WEBPACK_IMPORTED_MODULE_9__.filter() !== undefined &&
                _message_lists__WEBPACK_IMPORTED_MODULE_6__.current === event.msg_list
            ) {
                _unread_ui__WEBPACK_IMPORTED_MODULE_13__.notify_messages_remain_unread();
            }
        }
    });
}


/***/ }),

/***/ "./static/js/message_store.js":
/*!************************************!*\
  !*** ./static/js/message_store.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "get": () => (/* binding */ get),
/* harmony export */   "get_cached_message": () => (/* binding */ get_cached_message),
/* harmony export */   "get_pm_emails": () => (/* binding */ get_pm_emails),
/* harmony export */   "get_pm_full_names": () => (/* binding */ get_pm_full_names),
/* harmony export */   "reify_message_id": () => (/* binding */ reify_message_id),
/* harmony export */   "set_message_booleans": () => (/* binding */ set_message_booleans),
/* harmony export */   "update_booleans": () => (/* binding */ update_booleans),
/* harmony export */   "update_message_cache": () => (/* binding */ update_message_cache),
/* harmony export */   "update_property": () => (/* binding */ update_property)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");



const stored_messages = new Map();

function update_message_cache(message) {
    // You should only call this from message_helper (or in tests).
    stored_messages.set(message.id, message);
}

function get_cached_message(message_id) {
    // You should only call this from message_helper.
    // Use the get() wrapper below for most other use cases.
    return stored_messages.get(message_id);
}

function clear_for_testing() {
    stored_messages.clear();
}

function get(message_id) {
    if (message_id === undefined || message_id === null) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("message_store.get got bad value: " + message_id);
        return undefined;
    }

    if (typeof message_id !== "number") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("message_store got non-number: " + message_id);

        // Try to soldier on, assuming the caller treats message
        // ids as strings.
        message_id = Number.parseFloat(message_id);
    }

    return stored_messages.get(message_id);
}

function get_pm_emails(message) {
    const user_ids = _people__WEBPACK_IMPORTED_MODULE_1__.pm_with_user_ids(message);
    const emails = user_ids
        .map((user_id) => {
            const person = _people__WEBPACK_IMPORTED_MODULE_1__.get_by_user_id(user_id);
            if (!person) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user id " + user_id);
                return "?";
            }
            return person.email;
        })
        .sort();

    return emails.join(", ");
}

function get_pm_full_names(message) {
    const user_ids = _people__WEBPACK_IMPORTED_MODULE_1__.pm_with_user_ids(message);
    const names = _people__WEBPACK_IMPORTED_MODULE_1__.get_display_full_names(user_ids).sort();

    return names.join(", ");
}

function set_message_booleans(message) {
    const flags = message.flags || [];

    function convert_flag(flag_name) {
        return flags.includes(flag_name);
    }

    message.unread = !convert_flag("read");
    message.historical = convert_flag("historical");
    message.starred = convert_flag("starred");
    message.mentioned = convert_flag("mentioned") || convert_flag("wildcard_mentioned");
    message.mentioned_me_directly = convert_flag("mentioned");
    message.collapsed = convert_flag("collapsed");
    message.alerted = convert_flag("has_alert_word");

    // Once we have set boolean flags here, the `flags` attribute is
    // just a distraction, so we delete it.  (All the downstream code
    // uses booleans.)
    delete message.flags;
}

function update_booleans(message, flags) {
    // When we get server flags for local echo or message edits,
    // we are vulnerable to race conditions, so only update flags
    // that are driven by message content.
    function convert_flag(flag_name) {
        return flags.includes(flag_name);
    }

    message.mentioned = convert_flag("mentioned") || convert_flag("wildcard_mentioned");
    message.mentioned_me_directly = convert_flag("mentioned");
    message.alerted = convert_flag("has_alert_word");
}

function update_property(property, value, info) {
    switch (property) {
        case "sender_full_name":
        case "small_avatar_url":
            for (const msg of stored_messages.values()) {
                if (msg.sender_id && msg.sender_id === info.user_id) {
                    msg[property] = value;
                }
            }
            break;
        case "stream_name":
            for (const msg of stored_messages.values()) {
                if (msg.stream_id && msg.stream_id === info.stream_id) {
                    msg.display_recipient = value;
                    msg.stream = value;
                }
            }
            break;
        case "status_emoji_info":
            for (const msg of stored_messages.values()) {
                if (msg.sender_id && msg.sender_id === info.user_id) {
                    msg[property] = value;
                }
            }
            break;
    }
}

function reify_message_id({old_id, new_id}) {
    if (stored_messages.has(old_id)) {
        stored_messages.set(new_id, stored_messages.get(old_id));
        stored_messages.delete(old_id);
    }
}


/***/ }),

/***/ "./static/js/message_util.js":
/*!***********************************!*\
  !*** ./static/js/message_util.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_messages": () => (/* binding */ add_messages),
/* harmony export */   "add_new_messages": () => (/* binding */ add_new_messages),
/* harmony export */   "add_new_messages_data": () => (/* binding */ add_new_messages_data),
/* harmony export */   "add_old_messages": () => (/* binding */ add_old_messages),
/* harmony export */   "do_unread_count_updates": () => (/* binding */ do_unread_count_updates),
/* harmony export */   "get_max_message_id_in_stream": () => (/* binding */ get_max_message_id_in_stream),
/* harmony export */   "get_messages_in_topic": () => (/* binding */ get_messages_in_topic),
/* harmony export */   "get_topics_for_message_ids": () => (/* binding */ get_topics_for_message_ids)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");








function do_unread_count_updates(messages, expect_no_new_unreads = false) {
    const any_new_unreads = _unread__WEBPACK_IMPORTED_MODULE_4__.process_loaded_messages(messages, expect_no_new_unreads);

    if (any_new_unreads) {
        // The following operations are expensive, and thus should
        // only happen if we found any unread messages justifying it.
        _unread_ui__WEBPACK_IMPORTED_MODULE_5__.update_unread_counts();
    }
}

function add_messages(messages, msg_list, opts) {
    if (!messages) {
        return undefined;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#page_loading_indicator"));

    const render_info = msg_list.add_messages(messages, opts);

    return render_info;
}

function add_old_messages(messages, msg_list) {
    return add_messages(messages, msg_list, {messages_are_new: false});
}

function add_new_messages(messages, msg_list) {
    if (!msg_list.data.fetch_status.has_found_newest()) {
        // We don't render newly received messages for the message list,
        // if we haven't found the latest messages to be displayed in the
        // narrow. Otherwise the new message would be rendered just after
        // the previously fetched messages when that's inaccurate.
        msg_list.data.fetch_status.update_expected_max_message_id(messages);
        return undefined;
    }
    return add_messages(messages, msg_list, {messages_are_new: true});
}

function add_new_messages_data(messages, msg_list_data) {
    if (!msg_list_data.fetch_status.has_found_newest()) {
        // The reasoning in add_new_messages applies here as well;
        // we're trying to maintain a data structure that's a
        // contiguous range of message history, so we can't append a
        // new message that might not be adjacent to that range.
        msg_list_data.fetch_status.update_expected_max_message_id(messages);
        return undefined;
    }
    return msg_list_data.add_messages(messages);
}

function get_messages_in_topic(stream_id, topic) {
    return _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.all_messages()
        .filter(
            (x) =>
                x.type === "stream" &&
                x.stream_id === stream_id &&
                x.topic.toLowerCase() === topic.toLowerCase(),
        );
}

function get_max_message_id_in_stream(stream_id) {
    let max_message_id = 0;
    for (const msg of _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.all_messages()) {
        if (msg.type === "stream" && msg.stream_id === stream_id && msg.id > max_message_id) {
            max_message_id = msg.id;
        }
    }
    return max_message_id;
}

function get_topics_for_message_ids(message_ids) {
    const topics = new Map(); // key = stream_id:topic
    for (const msg_id of message_ids) {
        // message_store still has data on deleted messages when this runs.
        const message = _message_store__WEBPACK_IMPORTED_MODULE_3__.get(msg_id);
        if (message === undefined) {
            // We may not have the deleted message cached locally in
            // message_store; if so, we can just skip processing it.
            continue;
        }
        if (message.type === "stream") {
            // Create unique keys for stream_id and topic.
            const topic_key = message.stream_id + ":" + message.topic;
            topics.set(topic_key, [message.stream_id, message.topic]);
        }
    }
    return topics;
}


/***/ }),

/***/ "./static/js/message_view_header.js":
/*!******************************************!*\
  !*** ./static/js/message_view_header.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "close_search_bar_and_open_narrow_description": () => (/* binding */ close_search_bar_and_open_narrow_description),
/* harmony export */   "colorize_message_view_header": () => (/* binding */ colorize_message_view_header),
/* harmony export */   "exit_search": () => (/* binding */ exit_search),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "maybe_rerender_title_area_for_stream": () => (/* binding */ maybe_rerender_title_area_for_stream),
/* harmony export */   "open_search_bar_and_close_narrow_description": () => (/* binding */ open_search_bar_and_close_narrow_description),
/* harmony export */   "render_title_area": () => (/* binding */ render_title_area),
/* harmony export */   "reset_searchbox_text": () => (/* binding */ reset_searchbox_text)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_message_view_header_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/message_view_header.hbs */ "./static/templates/message_view_header.hbs");
/* harmony import */ var _templates_message_view_header_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_message_view_header_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _rendered_markdown__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./rendered_markdown */ "./static/js/rendered_markdown.js");
/* harmony import */ var _search__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./search */ "./static/js/search.js");












function get_formatted_sub_count(sub_count) {
    if (sub_count >= 1000) {
        // parseInt() is used to floor the value of division to an integer
        sub_count = Number.parseInt(sub_count / 1000, 10) + "k";
    }
    return sub_count;
}

function make_message_view_header(filter) {
    const message_view_header = {};
    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_5__.is_visible()) {
        return {
            title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Recent conversations"}),
            icon: "clock-o",
        };
    }
    if (filter === undefined) {
        return {
            title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "All messages"}),
            icon: "align-left",
        };
    }
    message_view_header.title = filter.get_title();
    message_view_header.icon = filter.get_icon();
    if (message_view_header.icon === "globe") {
        // This is a bit hacky, but it works as a way to communicate
        // to the HTML template that we need to use the different HTML
        // required for the globe icon.
        message_view_header.web_public_stream = true;
    }
    if (filter.has_operator("stream") && !filter._sub) {
        message_view_header.sub_count = "0";
        message_view_header.formatted_sub_count = "0";
        message_view_header.rendered_narrow_description = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "This stream does not exist or is private.",
        });
        return message_view_header;
    }
    if (filter._sub) {
        // We can now be certain that the narrow
        // involves a stream which exists and
        // the current user can access.
        const current_stream = filter._sub;
        message_view_header.rendered_narrow_description = current_stream.rendered_description;
        const sub_count = _peer_data__WEBPACK_IMPORTED_MODULE_4__.get_subscriber_count(current_stream.stream_id);
        message_view_header.sub_count = sub_count;
        message_view_header.formatted_sub_count = get_formatted_sub_count(sub_count);
        // the "title" is passed as a variable and doesn't get translated (nor should it)
        message_view_header.sub_count_tooltip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "This stream has {count} subscribers."},
            {count: message_view_header.sub_count, title: message_view_header.title},
        );
        message_view_header.stream_settings_link =
            "#streams/" + current_stream.stream_id + "/" + current_stream.name;
    }
    return message_view_header;
}

function colorize_message_view_header() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    if (filter === undefined || !filter._sub) {
        return;
    }
    // selecting i instead of .fa because web public streams have custom icon.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header a.stream i").css("color", filter._sub.color);
}

function append_and_display_title_area(message_view_header_data) {
    const $message_view_header_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header");
    $message_view_header_elem.empty();
    const rendered = _templates_message_view_header_hbs__WEBPACK_IMPORTED_MODULE_1___default()(message_view_header_data);
    $message_view_header_elem.append(rendered);
    if (message_view_header_data.stream_settings_link) {
        colorize_message_view_header();
    }
    $message_view_header_elem.removeClass("notdisplayed");
    const $content = $message_view_header_elem.find("span.rendered_markdown");
    if ($content) {
        // Update syntax like stream names, emojis, mentions, timestamps.
        _rendered_markdown__WEBPACK_IMPORTED_MODULE_6__.update_elements($content);
    }
}

function bind_title_area_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".search_closed").on("click", (e) => {
        _search__WEBPACK_IMPORTED_MODULE_7__.initiate_search();
        e.preventDefault();
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header .navbar-click-opens-search").on("click", (e) => {
        if (document.getSelection().type === "Range") {
            // Allow copy/paste to work normally without interference.
            return;
        }

        // Let links behave normally, ie, do nothing if <a>
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("a").length === 0) {
            _search__WEBPACK_IMPORTED_MODULE_7__.initiate_search();
            e.preventDefault();
            e.stopPropagation();
        }
    });

    // handler that makes sure that hover plays nicely
    // with whether search is being opened or not.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header .narrow_description > a")
        .on("mouseenter", () => {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header .search_closed").css("opacity", 0.5);
        })
        .on("mouseleave", () => {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header .search_closed").css("opacity", "");
        });
}

function build_message_view_header(filter) {
    // This makes sure we don't waste time appending
    // message_view_header on a template where it's never used
    if (filter && !filter.is_common_narrow()) {
        open_search_bar_and_close_narrow_description();
    } else {
        const message_view_header_data = make_message_view_header(filter);
        append_and_display_title_area(message_view_header_data);
        bind_title_area_handlers();
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").is(":focus")) {
            open_search_bar_and_close_narrow_description();
        } else {
            close_search_bar_and_open_narrow_description();
        }
    }
}

// we rely entirely on this function to ensure
// the searchbar has the right text.
function reset_searchbox_text() {
    let search_string = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.search_string();
    if (search_string !== "") {
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !_narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter().is_search()) {
            // saves the user a keystroke for quick searches
            search_string = search_string + " ";
        }
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").val(search_string);
    }
}

function exit_search() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    if (!filter || filter.is_common_narrow()) {
        // for common narrows, we change the UI (and don't redirect)
        close_search_bar_and_open_narrow_description();
    } else {
        // for "searching narrows", we redirect
        window.location.href = filter.generate_redirect_url();
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app").trigger("focus");
}

function initialize() {
    render_title_area();

    // register searchbar click handler
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_exit").on("click", (e) => {
        exit_search();
        e.preventDefault();
        e.stopPropagation();
    });
}

function render_title_area() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    build_message_view_header(filter);
}

// This function checks if "modified_sub" which is the stream whose values
// have been updated is the same as the stream which is currently
// narrowed (filter._sub) and rerenders if necessary
function maybe_rerender_title_area_for_stream(modified_sub) {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    if (filter && filter._sub && filter._sub.stream_id === modified_sub.stream_id) {
        render_title_area();
    }
}

function open_search_bar_and_close_narrow_description() {
    reset_searchbox_text();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".navbar-search").addClass("expanded");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header").addClass("hidden");
}

function close_search_bar_and_open_narrow_description() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    if (!(filter && !filter.is_common_narrow())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".navbar-search").removeClass("expanded");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header").removeClass("hidden");
    }
}


/***/ }),

/***/ "./static/js/message_viewport.js":
/*!***************************************!*\
  !*** ./static/js/message_viewport.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$message_pane": () => (/* binding */ $message_pane),
/* harmony export */   "at_bottom": () => (/* binding */ at_bottom),
/* harmony export */   "at_top": () => (/* binding */ at_top),
/* harmony export */   "bottom_message_visible": () => (/* binding */ bottom_message_visible),
/* harmony export */   "height": () => (/* binding */ height),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_below_visible_bottom": () => (/* binding */ is_below_visible_bottom),
/* harmony export */   "is_scrolled_up": () => (/* binding */ is_scrolled_up),
/* harmony export */   "is_visible_and_focused": () => (/* binding */ is_visible_and_focused),
/* harmony export */   "keep_pointer_in_view": () => (/* binding */ keep_pointer_in_view),
/* harmony export */   "last_movement_direction": () => (/* binding */ last_movement_direction),
/* harmony export */   "message_viewport_info": () => (/* binding */ message_viewport_info),
/* harmony export */   "offset_from_bottom": () => (/* binding */ offset_from_bottom),
/* harmony export */   "recenter_view": () => (/* binding */ recenter_view),
/* harmony export */   "scrollTop": () => (/* binding */ scrollTop),
/* harmony export */   "set_last_movement_direction": () => (/* binding */ set_last_movement_direction),
/* harmony export */   "set_message_position": () => (/* binding */ set_message_position),
/* harmony export */   "stop_auto_scrolling": () => (/* binding */ stop_auto_scrolling),
/* harmony export */   "system_initiated_animate_scroll": () => (/* binding */ system_initiated_animate_scroll),
/* harmony export */   "user_initiated_animate_scroll": () => (/* binding */ user_initiated_animate_scroll),
/* harmony export */   "visible_groups": () => (/* binding */ visible_groups),
/* harmony export */   "visible_messages": () => (/* binding */ visible_messages),
/* harmony export */   "width": () => (/* binding */ width)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());










let $message_pane;

let $jwindow;
const dimensions = {};
let in_stoppable_autoscroll = false;

function make_dimen_wrapper(dimen_name, dimen_func) {
    dimensions[dimen_name] = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        compute_value() {
            return dimen_func.call($message_pane);
        },
    });
    return function viewport_dimension_wrapper(...args) {
        if (args.length !== 0) {
            dimensions[dimen_name].reset();
            return dimen_func.apply($message_pane, args);
        }
        return dimensions[dimen_name].get();
    };
}

const height = make_dimen_wrapper("height", (jquery__WEBPACK_IMPORTED_MODULE_0___default().fn.height));
const width = make_dimen_wrapper("width", (jquery__WEBPACK_IMPORTED_MODULE_0___default().fn.width));

// Includes both scroll and arrow events. Negative means scroll up,
// positive means scroll down.
let last_movement_direction = 1;

function set_last_movement_direction(value) {
    last_movement_direction = value;
}

function at_top() {
    return scrollTop() <= 0;
}

function message_viewport_info() {
    // Return a structure that tells us details of the viewport
    // accounting for fixed elements like the top navbar.
    //
    // The message_header is NOT considered to be part of the visible
    // message pane, which should make sense for callers, who will
    // generally be concerned about whether actual message content is
    // visible.

    const res = {};

    const $element_just_above_us = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".floating_recipient");
    const $element_just_below_us = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose");

    res.visible_top =
        $element_just_above_us.offset().top + $element_just_above_us.safeOuterHeight();

    res.visible_bottom = $element_just_below_us.position().top;

    res.visible_height = res.visible_bottom - res.visible_top;

    return res;
}

function at_bottom() {
    const bottom = scrollTop() + height();
    const full_height = $message_pane.prop("scrollHeight");

    // We only know within a pixel or two if we're
    // exactly at the bottom, due to browser quirkiness,
    // and we err on the side of saying that we are at
    // the bottom.
    return bottom + 2 >= full_height;
}

// This differs from at_bottom in that it only requires the bottom message to
// be visible, but you may be able to scroll down further.
function bottom_message_visible() {
    const $last_row = _rows__WEBPACK_IMPORTED_MODULE_6__.last_visible();
    if ($last_row.length) {
        const message_bottom = $last_row[0].getBoundingClientRect().bottom;
        const bottom_of_feed = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose")[0].getBoundingClientRect().top;
        return bottom_of_feed > message_bottom;
    }
    return false;
}

function is_below_visible_bottom(offset) {
    return offset > scrollTop() + height() - jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose").height();
}

function is_scrolled_up() {
    // Let's determine whether the user was already dealing
    // with messages off the screen, which can guide auto
    // scrolling decisions.
    const $last_row = _rows__WEBPACK_IMPORTED_MODULE_6__.last_visible();
    if ($last_row.length === 0) {
        return false;
    }

    const offset = offset_from_bottom($last_row);

    return offset > 0;
}

function offset_from_bottom($last_row) {
    // A positive return value here means the last row is
    // below the bottom of the feed (i.e. obscured by the compose
    // box or even further below the bottom).
    const message_bottom = $last_row.offset().top + $last_row.height();
    const info = message_viewport_info();

    return message_bottom - info.visible_bottom;
}

function set_message_position(message_top, message_height, viewport_info, ratio) {
    // message_top = offset of the top of a message that you are positioning
    // message_height = height of the message that you are positioning
    // viewport_info = result of calling message_viewport.message_viewport_info
    // ratio = fraction indicating how far down the screen the msg should be

    let how_far_down_in_visible_page = viewport_info.visible_height * ratio;

    // special case: keep large messages fully on the screen
    if (how_far_down_in_visible_page + message_height > viewport_info.visible_height) {
        how_far_down_in_visible_page = viewport_info.visible_height - message_height;

        // Next handle truly gigantic messages.  We just say that the top of the
        // message goes to the top of the viewing area.  Realistically, gigantic
        // messages should either be condensed, socially frowned upon, or scrolled
        // with the mouse.
        if (how_far_down_in_visible_page < 0) {
            how_far_down_in_visible_page = 0;
        }
    }

    const hidden_top = viewport_info.visible_top - scrollTop();

    const message_offset = how_far_down_in_visible_page + hidden_top;

    const new_scroll_top = message_top - message_offset;

    _message_scroll__WEBPACK_IMPORTED_MODULE_3__.suppress_selection_update_on_next_scroll();
    scrollTop(new_scroll_top);
}

function in_viewport_or_tall(rect, top_of_feed, bottom_of_feed, require_fully_visible) {
    if (require_fully_visible) {
        return (
            rect.top > top_of_feed && // Message top is in view and
            (rect.bottom < bottom_of_feed || // message is fully in view or
                (rect.height > bottom_of_feed - top_of_feed && rect.top < bottom_of_feed))
        ); // message is tall.
    }
    return rect.bottom > top_of_feed && rect.top < bottom_of_feed;
}

function add_to_visible(
    $candidates,
    visible,
    top_of_feed,
    bottom_of_feed,
    require_fully_visible,
    row_to_id,
) {
    for (const row of $candidates) {
        const row_rect = row.getBoundingClientRect();
        // Mark very tall messages as read once we've gotten past them
        if (in_viewport_or_tall(row_rect, top_of_feed, bottom_of_feed, require_fully_visible)) {
            visible.push(row_to_id(row));
        } else {
            break;
        }
    }
}

const top_of_feed = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
    compute_value() {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".floating_recipient").offset().top + jquery__WEBPACK_IMPORTED_MODULE_0___default()(".floating_recipient").safeOuterHeight();
    },
});

const bottom_of_feed = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
    compute_value() {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose")[0].getBoundingClientRect().top;
    },
});

function _visible_divs(
    $selected_row,
    row_min_height,
    row_to_output,
    div_class,
    require_fully_visible,
) {
    // Note that when using getBoundingClientRect() we are getting offsets
    // relative to the visible window, but when using jQuery's offset() we are
    // getting offsets relative to the full scrollable window. You can't try to
    // compare heights from these two methods.
    const height = bottom_of_feed.get() - top_of_feed.get();
    const num_neighbors = Math.floor(height / row_min_height);

    // We do this explicitly without merges and without recalculating
    // the feed bounds to keep this computation as cheap as possible.
    const visible = [];
    const $above_pointer = $selected_row.prevAll("div." + div_class).slice(0, num_neighbors);
    const $below_pointer = $selected_row.nextAll("div." + div_class).slice(0, num_neighbors);
    add_to_visible(
        $selected_row,
        visible,
        top_of_feed.get(),
        bottom_of_feed.get(),
        require_fully_visible,
        row_to_output,
    );
    add_to_visible(
        $above_pointer,
        visible,
        top_of_feed.get(),
        bottom_of_feed.get(),
        require_fully_visible,
        row_to_output,
    );
    add_to_visible(
        $below_pointer,
        visible,
        top_of_feed.get(),
        bottom_of_feed.get(),
        require_fully_visible,
        row_to_output,
    );

    return visible;
}

function visible_groups(require_fully_visible) {
    const $selected_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.selected_row();
    if ($selected_row === undefined || $selected_row.length === 0) {
        return [];
    }

    const $selected_group = _rows__WEBPACK_IMPORTED_MODULE_6__.get_message_recipient_row($selected_row);

    function get_row(row) {
        return row;
    }

    // Being simplistic about this, the smallest group is about 75 px high.
    return _visible_divs($selected_group, 75, get_row, "recipient_row", require_fully_visible);
}

function visible_messages(require_fully_visible) {
    const $selected_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.selected_row();

    function row_to_id(row) {
        return _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(_rows__WEBPACK_IMPORTED_MODULE_6__.id(jquery__WEBPACK_IMPORTED_MODULE_0___default()(row)));
    }

    // Being simplistic about this, the smallest message is 25 px high.
    return _visible_divs($selected_row, 25, row_to_id, "message_row", require_fully_visible);
}

function scrollTop(target_scrollTop) {
    const orig_scrollTop = $message_pane.scrollTop();
    if (target_scrollTop === undefined) {
        return orig_scrollTop;
    }
    let $ret = $message_pane.scrollTop(target_scrollTop);
    const new_scrollTop = $message_pane.scrollTop();
    const space_to_scroll = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bottom_whitespace").offset().top - height();

    // Check whether our scrollTop didn't move even though one could have scrolled down
    if (
        space_to_scroll > 0 &&
        target_scrollTop > 0 &&
        orig_scrollTop === 0 &&
        new_scrollTop === 0
    ) {
        // Chrome has a bug where sometimes calling
        // window.scrollTop(x) has no effect, resulting in the browser
        // staying at 0 -- and afterwards if you call
        // window.scrollTop(x) again, it will still do nothing.  To
        // fix this, we need to first scroll to some other place.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "ScrollTop did nothing when scrolling to " + target_scrollTop + ", fixing...",
        );
        // First scroll to 1 in order to clear the stuck state
        $message_pane.scrollTop(1);
        // And then scroll where we intended to scroll to
        $ret = $message_pane.scrollTop(target_scrollTop);
        if ($message_pane.scrollTop() === 0) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "ScrollTop fix did not work when scrolling to " +
                    target_scrollTop +
                    "!  space_to_scroll was " +
                    space_to_scroll,
            );
        }
    }
    return $ret;
}

function stop_auto_scrolling() {
    if (in_stoppable_autoscroll) {
        $message_pane.stop();
    }
}

function system_initiated_animate_scroll(scroll_amount) {
    _message_scroll__WEBPACK_IMPORTED_MODULE_3__.suppress_selection_update_on_next_scroll();
    const viewport_offset = scrollTop();
    in_stoppable_autoscroll = true;
    $message_pane.animate({
        scrollTop: viewport_offset + scroll_amount,
        always() {
            in_stoppable_autoscroll = false;
        },
    });
}

function user_initiated_animate_scroll(scroll_amount) {
    _message_scroll__WEBPACK_IMPORTED_MODULE_3__.suppress_selection_update_on_next_scroll();
    in_stoppable_autoscroll = false; // defensive

    const viewport_offset = scrollTop();

    $message_pane.animate({
        scrollTop: viewport_offset + scroll_amount,
    });
}

function recenter_view($message, {from_scroll = false, force_center = false} = {}) {
    // BarnOwl-style recentering: if the pointer is too high, move it to
    // the 1/2 marks. If the pointer is too low, move it to the 1/7 mark.
    // See keep_pointer_in_view() for related logic to keep the pointer onscreen.

    const viewport_info = message_viewport_info();
    const top_threshold = viewport_info.visible_top;

    const bottom_threshold = viewport_info.visible_bottom;

    const message_top = $message.offset().top;
    const message_height = $message.safeOuterHeight(true);
    const message_bottom = message_top + message_height;

    const is_above = message_top < top_threshold;
    const is_below = message_bottom > bottom_threshold;

    if (from_scroll) {
        // If the message you're trying to center on is already in view AND
        // you're already trying to move in the direction of that message,
        // don't try to recenter. This avoids disorienting jumps when the
        // pointer has gotten itself outside the threshold (e.g. by
        // autoscrolling).
        if (is_above && last_movement_direction >= 0) {
            return;
        }
        if (is_below && last_movement_direction <= 0) {
            return;
        }
    }

    if (is_above || force_center) {
        set_message_position(message_top, message_height, viewport_info, 1 / 2);
    } else if (is_below) {
        set_message_position(message_top, message_height, viewport_info, 1 / 7);
    }
}

function keep_pointer_in_view() {
    // See message_viewport.recenter_view() for related logic to keep the pointer onscreen.
    // This function mostly comes into place for mouse scrollers, and it
    // keeps the pointer in view.  For people who purely scroll with the
    // mouse, the pointer is kind of meaningless to them, but keyboard
    // users will occasionally do big mouse scrolls, so this gives them
    // a pointer reasonably close to the middle of the screen.
    let $candidate;
    let $next_row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.selected_row();

    if ($next_row.length === 0) {
        return;
    }

    const info = message_viewport_info();
    const top_threshold = info.visible_top + (1 / 10) * info.visible_height;
    const bottom_threshold = info.visible_top + (9 / 10) * info.visible_height;

    function message_is_far_enough_down() {
        if (at_top()) {
            return true;
        }

        const message_top = $next_row.offset().top;

        // If the message starts after the very top of the screen, we just
        // leave it alone.  This avoids bugs like #1608, where overzealousness
        // about repositioning the pointer can cause users to miss messages.
        if (message_top >= info.visible_top) {
            return true;
        }

        // If at least part of the message is below top_threshold (10% from
        // the top), then we also leave it alone.
        const bottom_offset = message_top + $next_row.safeOuterHeight(true);
        if (bottom_offset >= top_threshold) {
            return true;
        }

        // If we got this far, the message is not "in view."
        return false;
    }

    function message_is_far_enough_up() {
        return at_bottom() || $next_row.offset().top <= bottom_threshold;
    }

    function adjust(in_view, get_next_row) {
        // return true only if we make an actual adjustment, so
        // that we know to short circuit the other direction
        if (in_view($next_row)) {
            return false; // try other side
        }
        while (!in_view($next_row)) {
            $candidate = get_next_row($next_row);
            if ($candidate.length === 0) {
                break;
            }
            $next_row = $candidate;
        }
        return true;
    }

    if (!adjust(message_is_far_enough_down, _rows__WEBPACK_IMPORTED_MODULE_6__.next_visible)) {
        adjust(message_is_far_enough_up, _rows__WEBPACK_IMPORTED_MODULE_6__.prev_visible);
    }

    _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.select_id(_rows__WEBPACK_IMPORTED_MODULE_6__.id($next_row), {from_scroll: true});
}

function initialize() {
    $jwindow = jquery__WEBPACK_IMPORTED_MODULE_0___default()(window);
    $message_pane = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app");
    // This handler must be placed before all resize handlers in our application
    $jwindow.on("resize", () => {
        dimensions.height.reset();
        dimensions.width.reset();
        top_of_feed.reset();
        bottom_of_feed.reset();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("compose_started compose_canceled compose_finished", () => {
        bottom_of_feed.reset();
    });

    // We stop autoscrolling when the user is clearly in the middle of
    // doing something.  Be careful, though, if you try to capture
    // mousemove, then you will have to contend with the autoscroll
    // itself generating mousemove events.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("message_selected.zulip wheel", () => {
        stop_auto_scrolling();
    });
}

function is_visible_and_focused() {
    if (
        _overlays__WEBPACK_IMPORTED_MODULE_5__.is_overlay_or_modal_open() ||
        !_notifications__WEBPACK_IMPORTED_MODULE_4__.is_window_focused() ||
        !jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_feed_container").is(":visible")
    ) {
        return false;
    }
    return true;
}


/***/ }),

/***/ "./static/js/muted_topics_ui.js":
/*!**************************************!*\
  !*** ./static/js/muted_topics_ui.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "handle_topic_updates": () => (/* binding */ handle_topic_updates),
/* harmony export */   "mute_topic": () => (/* binding */ mute_topic),
/* harmony export */   "rerender_for_muted_topic": () => (/* binding */ rerender_for_muted_topic),
/* harmony export */   "toggle_topic_mute": () => (/* binding */ toggle_topic_mute),
/* harmony export */   "unmute_topic": () => (/* binding */ unmute_topic)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_topic_muted_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/topic_muted.hbs */ "./static/templates/topic_muted.hbs");
/* harmony import */ var _templates_topic_muted_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_topic_muted_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _feedback_widget__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./feedback_widget */ "./static/js/feedback_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _settings_muted_topics__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./settings_muted_topics */ "./static/js/settings_muted_topics.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");

















function rerender_for_muted_topic(old_muted_topics) {
    _stream_list__WEBPACK_IMPORTED_MODULE_10__.update_streams_sidebar();
    _message_lists__WEBPACK_IMPORTED_MODULE_5__.current.update_muting_and_rerender();
    if (_message_lists__WEBPACK_IMPORTED_MODULE_5__.current !== _message_lists__WEBPACK_IMPORTED_MODULE_5__.home) {
        _message_lists__WEBPACK_IMPORTED_MODULE_5__.home.update_muting_and_rerender();
    }
    if (_overlays__WEBPACK_IMPORTED_MODULE_6__.settings_open() && _settings_muted_topics__WEBPACK_IMPORTED_MODULE_8__.loaded) {
        _settings_muted_topics__WEBPACK_IMPORTED_MODULE_8__.populate_list();
    }

    // We only update those topics which could have been affected, because
    // we want to avoid doing a complete rerender of the recent topics view,
    // because that can be expensive.
    const current_muted_topics = _user_topics__WEBPACK_IMPORTED_MODULE_13__.get_muted_topics();
    const maybe_affected_topics = lodash__WEBPACK_IMPORTED_MODULE_0___default().unionWith(old_muted_topics, current_muted_topics, (lodash__WEBPACK_IMPORTED_MODULE_0___default().isEqual));

    for (const topic_data of maybe_affected_topics) {
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_7__.update_topic_is_muted(topic_data.stream_id, topic_data.topic);
    }
}

function handle_topic_updates(user_topic) {
    const old_muted_topics = _user_topics__WEBPACK_IMPORTED_MODULE_13__.get_muted_topics();
    _user_topics__WEBPACK_IMPORTED_MODULE_13__.set_user_topic(user_topic);
    _stream_popover__WEBPACK_IMPORTED_MODULE_11__.hide_topic_popover();
    _unread_ui__WEBPACK_IMPORTED_MODULE_12__.update_unread_counts();
    rerender_for_muted_topic(old_muted_topics);
}

function mute_topic(stream_id, topic, from_hotkey) {
    const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_9__.maybe_get_stream_name(stream_id);
    const data = {
        stream_id,
        topic,
        op: "add",
    };

    _channel__WEBPACK_IMPORTED_MODULE_2__.patch({
        url: "/json/users/me/subscriptions/muted_topics",
        data,
        success() {
            if (!from_hotkey) {
                return;
            }

            // The following feedback_widget notice helps avoid
            // confusion when a user who is not familiar with Zulip's
            // keyboard UI hits "M" in the wrong context and has a
            // bunch of messages suddenly disappear.  This notice is
            // only useful when muting from the keyboard, since you
            // know what you did if you triggered muting with the
            // mouse.
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.show({
                populate($container) {
                    const rendered_html = _templates_topic_muted_hbs__WEBPACK_IMPORTED_MODULE_1___default()();
                    $container.html(rendered_html);
                    $container.find(".stream").text(stream_name);
                    $container.find(".topic").text(topic);
                },
                on_undo() {
                    unmute_topic(stream_id, topic);
                },
                title_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Topic muted"}),
                undo_button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unmute"}),
            });
        },
    });
}

function unmute_topic(stream_id, topic) {
    // Accidentally unmuting a topic isn't as much an issue as accidentally muting
    // a topic, so we don't show a popup after unmuting.
    const data = {
        stream_id,
        topic,
        op: "remove",
    };

    _channel__WEBPACK_IMPORTED_MODULE_2__.patch({
        url: "/json/users/me/subscriptions/muted_topics",
        data,
        success() {
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.dismiss();
        },
    });
}

function toggle_topic_mute(message) {
    const stream_id = message.stream_id;
    const topic = message.topic;

    if (_user_topics__WEBPACK_IMPORTED_MODULE_13__.is_topic_muted(stream_id, topic)) {
        unmute_topic(stream_id, topic);
    } else if (message.type === "stream") {
        mute_topic(stream_id, topic, true);
    }
}


/***/ }),

/***/ "./static/js/muted_users.js":
/*!**********************************!*\
  !*** ./static/js/muted_users.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_muted_user": () => (/* binding */ add_muted_user),
/* harmony export */   "filter_muted_user_ids": () => (/* binding */ filter_muted_user_ids),
/* harmony export */   "filter_muted_users": () => (/* binding */ filter_muted_users),
/* harmony export */   "get_muted_users": () => (/* binding */ get_muted_users),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_user_muted": () => (/* binding */ is_user_muted),
/* harmony export */   "remove_muted_user": () => (/* binding */ remove_muted_user),
/* harmony export */   "set_muted_users": () => (/* binding */ set_muted_users)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




const muted_users = new Map();

function add_muted_user(user_id, date_muted) {
    const time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(date_muted);
    if (user_id) {
        muted_users.set(user_id, time);
    }
}

function remove_muted_user(user_id) {
    if (user_id) {
        muted_users.delete(user_id);
    }
}

function is_user_muted(user_id) {
    if (user_id === undefined) {
        return false;
    }

    return muted_users.has(user_id);
}

function filter_muted_user_ids(user_ids) {
    // Returns a copy of the user ID list, after removing muted user IDs.
    const base_user_ids = [...user_ids];
    return base_user_ids.filter((user_id) => !is_user_muted(user_id));
}

function filter_muted_users(persons) {
    // Returns a copy of the people list, after removing muted users.
    const base_users = [...persons];
    return base_users.filter((person) => !is_user_muted(person.user_id));
}

function get_muted_users() {
    const users = [];
    for (const [id, date_muted] of muted_users) {
        const date_muted_str = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new Date(date_muted)).time_str;
        users.push({
            id,
            date_muted,
            date_muted_str,
        });
    }
    return users;
}

function set_muted_users(list) {
    muted_users.clear();

    for (const user of list) {
        if (user !== undefined && user.id !== undefined) {
            add_muted_user(user.id, user.timestamp);
        }
    }
}

function initialize() {
    set_muted_users(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}


/***/ }),

/***/ "./static/js/muted_users_ui.js":
/*!*************************************!*\
  !*** ./static/js/muted_users_ui.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "confirm_mute_user": () => (/* binding */ confirm_mute_user),
/* harmony export */   "handle_user_updates": () => (/* binding */ handle_user_updates),
/* harmony export */   "mute_user": () => (/* binding */ mute_user),
/* harmony export */   "rerender_for_muted_user": () => (/* binding */ rerender_for_muted_user),
/* harmony export */   "unmute_user": () => (/* binding */ unmute_user)
/* harmony export */ });
/* harmony import */ var _templates_confirm_dialog_confirm_mute_user_hbs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_mute_user.hbs */ "./static/templates/confirm_dialog/confirm_mute_user.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_mute_user_hbs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_mute_user_hbs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _settings_muted_users__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./settings_muted_users */ "./static/js/settings_muted_users.js");















function mute_user(user_id) {
    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/users/me/muted_users/" + user_id,
    });
}

function confirm_mute_user(user_id) {
    function on_click() {
        mute_user(user_id);
    }

    const html_body = _templates_confirm_dialog_confirm_mute_user_hbs__WEBPACK_IMPORTED_MODULE_0___default()({
        user_name: _people__WEBPACK_IMPORTED_MODULE_8__.get_full_name(user_id),
    });

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_3__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Mute user"}),
        help_link: "/help/mute-a-user",
        html_body,
        on_click,
    });
}

function unmute_user(user_id) {
    _channel__WEBPACK_IMPORTED_MODULE_2__.del({
        url: "/json/users/me/muted_users/" + user_id,
    });
}

function rerender_for_muted_user() {
    _message_lists__WEBPACK_IMPORTED_MODULE_5__.current.update_muting_and_rerender();
    if (_message_lists__WEBPACK_IMPORTED_MODULE_5__.current !== _message_lists__WEBPACK_IMPORTED_MODULE_5__.home) {
        _message_lists__WEBPACK_IMPORTED_MODULE_5__.home.update_muting_and_rerender();
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_7__.settings_open() && _settings_muted_users__WEBPACK_IMPORTED_MODULE_12__.loaded) {
        _settings_muted_users__WEBPACK_IMPORTED_MODULE_12__.populate_list();
    }

    _activity__WEBPACK_IMPORTED_MODULE_1__.redraw();
    _pm_list__WEBPACK_IMPORTED_MODULE_9__.update_private_messages();

    // If a user is (un)muted, we want to update their avatars on the recent topics
    // participants column.
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_11__.complete_rerender();
}

function handle_user_updates(muted_user_ids) {
    _popovers__WEBPACK_IMPORTED_MODULE_10__.hide_all();
    _muted_users__WEBPACK_IMPORTED_MODULE_6__.set_muted_users(muted_user_ids);
    rerender_for_muted_user();
}


/***/ }),

/***/ "./static/js/narrow.js":
/*!*****************************!*\
  !*** ./static/js/narrow.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "activate": () => (/* binding */ activate),
/* harmony export */   "activate_stream_for_cycle_hotkey": () => (/* binding */ activate_stream_for_cycle_hotkey),
/* harmony export */   "by": () => (/* binding */ by),
/* harmony export */   "by_recipient": () => (/* binding */ by_recipient),
/* harmony export */   "by_topic": () => (/* binding */ by_topic),
/* harmony export */   "compute_narrow_title": () => (/* binding */ compute_narrow_title),
/* harmony export */   "deactivate": () => (/* binding */ deactivate),
/* harmony export */   "handle_middle_pane_transition": () => (/* binding */ handle_middle_pane_transition),
/* harmony export */   "has_shown_message_list_view": () => (/* binding */ has_shown_message_list_view),
/* harmony export */   "maybe_add_local_messages": () => (/* binding */ maybe_add_local_messages),
/* harmony export */   "narrow_title": () => (/* binding */ narrow_title),
/* harmony export */   "narrow_to_next_pm_string": () => (/* binding */ narrow_to_next_pm_string),
/* harmony export */   "narrow_to_next_topic": () => (/* binding */ narrow_to_next_topic),
/* harmony export */   "reset_ui_state": () => (/* binding */ reset_ui_state),
/* harmony export */   "save_pre_narrow_offset_for_reload": () => (/* binding */ save_pre_narrow_offset_for_reload),
/* harmony export */   "stream_cycle_backward": () => (/* binding */ stream_cycle_backward),
/* harmony export */   "stream_cycle_forward": () => (/* binding */ stream_cycle_forward),
/* harmony export */   "to_compose_target": () => (/* binding */ to_compose_target),
/* harmony export */   "update_narrow_title": () => (/* binding */ update_narrow_title),
/* harmony export */   "update_selection": () => (/* binding */ update_selection)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_closed_ui__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_closed_ui */ "./static/js/compose_closed_ui.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
/* harmony import */ var _hashchange__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./hashchange */ "./static/js/hashchange.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_fetch__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./message_fetch */ "./static/js/message_fetch.js");
/* harmony import */ var _message_helper__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_helper */ "./static/js/message_helper.js");
/* harmony import */ var _message_list__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_list */ "./static/js/message_list.js");
/* harmony import */ var _message_list_data__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./message_list_data */ "./static/js/message_list_data.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _narrow_banner__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./narrow_banner */ "./static/js/narrow_banner.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _search__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./search */ "./static/js/search.js");
/* harmony import */ var _search_pill__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./search_pill */ "./static/js/search_pill.js");
/* harmony import */ var _search_pill_widget__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./search_pill_widget */ "./static/js/search_pill_widget.js");
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _top_left_corner__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./top_left_corner */ "./static/js/top_left_corner.js");
/* harmony import */ var _topic_generator__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./topic_generator */ "./static/js/topic_generator.js");
/* harmony import */ var _typing_events__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./typing_events */ "./static/js/typing_events.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _widgetize__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./widgetize */ "./static/js/widgetize.js");















































let unnarrow_times;

const LARGER_THAN_MAX_MESSAGE_ID = 10000000000000000;

function report_narrow_time(initial_core_time, initial_free_time, network_time) {
    _channel__WEBPACK_IMPORTED_MODULE_3__.post({
        url: "/json/report/narrow_times",
        data: {
            initial_core: initial_core_time.toString(),
            initial_free: initial_free_time.toString(),
            network: network_time.toString(),
        },
    });
}

function maybe_report_narrow_time(msg_list) {
    if (
        msg_list.network_time === undefined ||
        msg_list.initial_core_time === undefined ||
        msg_list.initial_free_time === undefined
    ) {
        return;
    }
    report_narrow_time(
        msg_list.initial_core_time - msg_list.start_time,
        msg_list.initial_free_time - msg_list.start_time,
        msg_list.network_time - msg_list.start_time,
    );
}

function report_unnarrow_time() {
    if (
        unnarrow_times === undefined ||
        unnarrow_times.start_time === undefined ||
        unnarrow_times.initial_core_time === undefined ||
        unnarrow_times.initial_free_time === undefined
    ) {
        return;
    }

    const initial_core_time = unnarrow_times.initial_core_time - unnarrow_times.start_time;
    const initial_free_time = unnarrow_times.initial_free_time - unnarrow_times.start_time;

    _channel__WEBPACK_IMPORTED_MODULE_3__.post({
        url: "/json/report/unnarrow_times",
        data: {
            initial_core: initial_core_time.toString(),
            initial_free: initial_free_time.toString(),
        },
    });

    unnarrow_times = {};
}

function save_pre_narrow_offset_for_reload() {
    if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id() !== -1) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_row().length === 0) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("narrow.activate missing selected row", {
                selected_id: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id(),
                selected_idx: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_idx(),
                selected_idx_exact: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.all_messages()
                    .indexOf(_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id())),
                render_start: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.view._render_win_start,
                render_end: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.view._render_win_end,
            });
        }
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.pre_narrow_offset = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_row().offset().top;
    }
}

let has_shown_message_list_view = false;

function compute_narrow_title(filter) {
    if (filter === undefined) {
        // "All messages" and "Recent conversations" views have
        // an `undefined` filter.
        if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_27__.is_visible()) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Recent conversations"});
        }
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "All messages"});
    }

    const filter_title = filter.get_title();

    if (filter_title === undefined) {
        // Default result for uncommon narrow/search views.
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Search results"});
    }

    if (filter.has_operator("stream")) {
        if (!filter._sub) {
            // The stream is not set because it does not currently
            // exist (possibly due to a stream name change), or it
            // is a private stream and the user is not subscribed.
            return filter_title;
        }
        if (filter.has_operator("topic")) {
            const topic_name = filter.operands("topic")[0];
            return "#" + filter_title + " > " + topic_name;
        }
        return "#" + filter_title;
    }

    if (filter.has_operator("pm-with")) {
        const emails = filter.operands("pm-with")[0];
        const user_ids = _people__WEBPACK_IMPORTED_MODULE_24__.emails_strings_to_user_ids_string(emails);

        if (user_ids !== undefined) {
            return _people__WEBPACK_IMPORTED_MODULE_24__.get_recipients(user_ids);
        }
        if (emails.includes(",")) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invalid users"});
        }
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invalid user"});
    }

    return filter_title;
}

let narrow_title = "home";
function update_narrow_title(filter) {
    narrow_title = compute_narrow_title(filter);
    _notifications__WEBPACK_IMPORTED_MODULE_23__.redraw_title();
}

function reset_ui_state() {
    // Resets the state of various visual UI elements that are
    // a function of the current narrow.
    _narrow_banner__WEBPACK_IMPORTED_MODULE_21__.hide_empty_narrow_message();
    _message_scroll__WEBPACK_IMPORTED_MODULE_18__.hide_top_of_narrow_notices();
    _message_scroll__WEBPACK_IMPORTED_MODULE_18__.hide_indicators();
    _unread_ui__WEBPACK_IMPORTED_MODULE_40__.reset_mark_as_read_turned_off_banner();
}

function handle_middle_pane_transition() {
    if (_compose_state__WEBPACK_IMPORTED_MODULE_7__.composing) {
        _compose_actions__WEBPACK_IMPORTED_MODULE_4__.update_narrow_to_recipient_visibility();
    }
}

function activate(raw_operators, opts) {
    /* Main entry point for switching to a new view / message list.
       Note that for historical reasons related to the current
       client-side caching structure, the "All messages"/message_lists.home
       view is reached via `narrow.deactivate()`.

       The name is based on "narrowing to a subset of the user's
       messages.".  Supported parameters:

       raw_operators: Narrowing/search operators; used to construct
       a Filter object that decides which messages belong in the
       view.  Required (See the above note on how `message_lists.home` works)

       All other options are encoded via the `opts` dictionary:

       * trigger: Optional parameter used mainly for logging and some
         custom UI behavior for certain buttons.  Generally aim to
         have this be unique for each UI widget that can trigger narrowing.

       * change_hash: Whether this narrow should change the URL
         fragment ("hash") in the URL bar.  Should be true unless the
         URL is already correct (E.g. because the hashchange logic
         itself is triggering the change of view).

       * then_select_id: If the caller wants us to do the narrow
         centered on a specific message ID ("anchor" in the API
         parlance), specify that here.  Useful e.g. when the user
         clicks on a specific message; implied by a `near:` operator.

       * then_select_offset: Offset from the top of the page in pixels
         at which to place the then_select_id message following
         rendering.  Important to avoid what would otherwise feel like
         visual glitches after clicking on a specific message's heading
         or rerendering due to server-side changes.
    */

    const start_time = new Date();
    const was_narrowed_already = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.active();

    // Since narrow.activate is called directly from various
    // places in our code without passing through hashchange,
    // we need to check if the narrow is allowed for spectator here too.
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        raw_operators.length &&
        raw_operators.some(
            (raw_operator) => !_hash_util__WEBPACK_IMPORTED_MODULE_10__.allowed_web_public_narrows.includes(raw_operator.operator),
        )
    ) {
        _spectators__WEBPACK_IMPORTED_MODULE_32__.login_to_access();
        return;
    }

    // The empty narrow is the home view; so deactivate any narrow if
    // no operators were specified.
    if (raw_operators.length === 0) {
        deactivate();
        return;
    }

    opts = {
        then_select_id: -1,
        then_select_offset: undefined,
        change_hash: true,
        trigger: "unknown",
        ...opts,
    };

    const id_info = {
        target_id: undefined,
        local_select_id: undefined,
        final_select_id: undefined,
    };

    const filter = new _filter__WEBPACK_IMPORTED_MODULE_9__.Filter(raw_operators);
    const operators = filter.operators();

    // These two narrowing operators specify what message should be
    // selected and should be the center of the narrow.
    if (filter.has_operator("near")) {
        id_info.target_id = Number.parseInt(filter.operands("near")[0], 10);
    }
    if (filter.has_operator("id")) {
        id_info.target_id = Number.parseInt(filter.operands("id")[0], 10);
    }

    // Narrow with near / id operator. There are two possibilities:
    // * The user is clicking a permanent link to a conversation, in which
    //   case we want to look up the anchor message and see if it has moved.
    // * The user did a search for something like stream:foo topic:bar near:1
    //   (or some other ID that is not an actual message in the topic).
    //
    // We attempt the match the stream and topic with that of the
    // message in case the message was moved after the link was
    // created. This ensures near / id links work and will redirect
    // correctly if the topic was moved (including being resolved).
    if (id_info.target_id && filter.has_operator("stream") && filter.has_operator("topic")) {
        const target_message = _message_store__WEBPACK_IMPORTED_MODULE_19__.get(id_info.target_id);

        function adjusted_operators_if_moved(operators, message) {
            const adjusted_operators = [];
            let operators_changed = false;

            for (const operator of operators) {
                const adjusted_operator = {...operator};
                if (
                    operator.operator === "stream" &&
                    !Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(operator.operand, message.display_recipient)
                ) {
                    adjusted_operator.operand = message.display_recipient;
                    operators_changed = true;
                }

                if (
                    operator.operator === "topic" &&
                    !Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(operator.operand, message.topic)
                ) {
                    adjusted_operator.operand = message.topic;
                    operators_changed = true;
                }

                adjusted_operators.push(adjusted_operator);
            }

            if (!operators_changed) {
                return null;
            }

            return adjusted_operators;
        }

        if (target_message) {
            // If we have the target message ID for the narrow in our
            // local cache, and the target message has been moved from
            // the stream/topic pair that was requested to some other
            // location, then we should retarget this narrow operation
            // to where the message is located now.
            const narrow_topic = filter.operands("topic")[0];
            const narrow_stream_name = filter.operands("stream")[0];
            const narrow_stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_33__.get_sub(narrow_stream_name).stream_id;
            const narrow_dict = {stream_id: narrow_stream_id, topic: narrow_topic};

            const narrow_exists_in_edit_history =
                _message_edit__WEBPACK_IMPORTED_MODULE_12__.stream_and_topic_exist_in_edit_history(
                    target_message,
                    narrow_stream_id,
                    narrow_topic,
                );

            // It's possible for a message to have moved to another
            // topic and then moved back to the current topic. In this
            // situation, narrow_exists_in_edit_history will be true,
            // but we don't need to redirect the narrow.
            const narrow_matches_target_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                target_message,
                narrow_dict,
            );

            if (
                !narrow_matches_target_message &&
                (narrow_exists_in_edit_history || !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))
            ) {
                const adjusted_operators = adjusted_operators_if_moved(
                    raw_operators,
                    target_message,
                );
                if (adjusted_operators !== null) {
                    activate(adjusted_operators, {
                        ...opts,
                        // Update the URL fragment to reflect the redirect.
                        change_hash: true,
                    });
                    return;
                }
            }
        } else if (!opts.fetched_target_message) {
            // If we don't have the target message ID locally and
            // haven't attempted to fetch it, then we ask the server
            // for it.
            _channel__WEBPACK_IMPORTED_MODULE_3__.get({
                url: `/json/messages/${id_info.target_id}`,
                success(data) {
                    // After the message is fetched, we make the
                    // message locally available and then call
                    // narrow.activate recursively, setting a flag to
                    // indicate we've already done this.
                    _message_helper__WEBPACK_IMPORTED_MODULE_14__.process_new_message(data.message);
                    activate(raw_operators, {
                        ...opts,
                        fetched_target_message: true,
                    });
                },
                error() {
                    // Message doesn't exist or user doesn't have
                    // access to the target message ID. This will
                    // happen, for example, if a user types
                    // `stream:foo topic:bar near:1` into the search
                    // box. No special rewriting is required, so call
                    // narrow.activate recursively.
                    activate(raw_operators, {
                        fetched_target_message: true,
                        ...opts,
                    });
                },
            });

            // The channel.get will call narrow.activate recursively
            // from a continuation unconditionally; the correct thing
            // to do here is return.
            return;
        }
    }

    // IMPORTANT: No code that modifies UI state should appear above
    // this point. This is important to prevent calling such functions
    // more than once in the event that we call narrow.activate
    // recursively.
    reset_ui_state();

    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_27__.is_visible()) {
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_26__.hide();
    } else {
        // If recent topics was not visible, then we are switching
        // from another message list view. Save the scroll position in
        // that message list, so that we can restore it if/when we
        // later navigate back to that view.
        save_pre_narrow_offset_for_reload();
    }

    // most users aren't going to send a bunch of a out-of-narrow messages
    // and expect to visit a list of narrows, so let's get these out of the way.
    _notifications__WEBPACK_IMPORTED_MODULE_23__.clear_compose_notifications();

    // Open tooltips are only interesting for current narrow,
    // so hide them when activating a new one.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".tooltip").hide();

    update_narrow_title(filter);

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Narrowed", {
        operators: operators.map((e) => e.operator),
        trigger: opts ? opts.trigger : undefined,
        previous_id: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id(),
    });

    if (opts.then_select_id > 0) {
        // We override target_id in this case, since the user could be
        // having a near: narrow auto-reloaded.
        id_info.target_id = opts.then_select_id;
        if (opts.then_select_offset === undefined) {
            const $row = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get_row(opts.then_select_id);
            if ($row.length > 0) {
                opts.then_select_offset = $row.offset().top;
            }
        }
    }

    if (!was_narrowed_already) {
        _unread__WEBPACK_IMPORTED_MODULE_38__.set_messages_read_in_narrow(false);
    }

    // IMPORTANT!  At this point we are heavily committed to
    // populating the new narrow, so we update our narrow_state.
    // From here on down, any calls to the narrow_state API will
    // reflect the upcoming narrow.
    has_shown_message_list_view = true;
    _narrow_state__WEBPACK_IMPORTED_MODULE_22__.set_current_filter(filter);

    const excludes_muted_topics = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.excludes_muted_topics();

    let msg_data = new _message_list_data__WEBPACK_IMPORTED_MODULE_16__.MessageListData({
        filter: _narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter(),
        excludes_muted_topics,
    });

    // Populate the message list if we can apply our filter locally (i.e.
    // with no backend help) and we have the message we want to select.
    // Also update id_info accordingly.
    // original back.
    maybe_add_local_messages({
        id_info,
        msg_data,
    });

    if (!id_info.local_select_id) {
        // If we're not actually read to select an ID, we need to
        // trash the `MessageListData` object that we just constructed
        // and pass an empty one to MessageList, because the block of
        // messages in the MessageListData built inside
        // maybe_add_local_messages is likely not be contiguous with
        // the block we're about to request from the server instead.
        msg_data = new _message_list_data__WEBPACK_IMPORTED_MODULE_16__.MessageListData({
            filter: _narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter(),
            excludes_muted_topics,
        });
    }

    const msg_list = new _message_list__WEBPACK_IMPORTED_MODULE_15__.MessageList({
        data: msg_data,
        table_name: "zfilt",
    });

    msg_list.start_time = start_time;

    // Show the new set of messages.  It is important to set message_lists.current to
    // the view right as it's being shown, because we rely on message_lists.current
    // being shown for deciding when to condense messages.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").addClass("narrowed_view");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zfilt").addClass("focused_table");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zhome").removeClass("focused_table");

    _message_lists__WEBPACK_IMPORTED_MODULE_17__.set_current(msg_list);

    let then_select_offset;
    if (id_info.target_id === id_info.final_select_id) {
        then_select_offset = opts.then_select_offset;
    }

    const select_immediately = id_info.local_select_id !== undefined;

    {
        let anchor;

        // Either we're trying to center the narrow around a
        // particular message ID (which could be max_int), or we're
        // asking the server to figure out for us what the first
        // unread message is, and center the narrow around that.
        switch (id_info.final_select_id) {
            case undefined:
                anchor = "first_unread";
                break;
            case -1:
                // This case should never happen in this code path; it's
                // here in case we choose to extract this as an
                // independent reusable function.
                anchor = "oldest";
                break;
            case LARGER_THAN_MAX_MESSAGE_ID:
                anchor = "newest";
                break;
            default:
                anchor = id_info.final_select_id;
        }

        _message_fetch__WEBPACK_IMPORTED_MODULE_13__.load_messages_for_narrow({
            anchor,
            cont() {
                if (!select_immediately) {
                    update_selection({
                        id_info,
                        select_offset: then_select_offset,
                        msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current,
                    });
                }
                msg_list.network_time = new Date();
                maybe_report_narrow_time(msg_list);
            },
            msg_list,
        });
    }

    if (select_immediately) {
        update_selection({
            id_info,
            select_offset: then_select_offset,
            msg_list: _message_lists__WEBPACK_IMPORTED_MODULE_17__.current,
        });
    }

    // Put the narrow operators in the URL fragment.
    // Disabled when the URL fragment was the source
    // of this narrow.
    if (opts.change_hash) {
        _hashchange__WEBPACK_IMPORTED_MODULE_11__.save_narrow(operators);
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && opts.trigger !== "search") {
        _search_pill_widget__WEBPACK_IMPORTED_MODULE_31__.widget.clear(true);

        for (const operator of operators) {
            const search_string = _filter__WEBPACK_IMPORTED_MODULE_9__.Filter.unparse([operator]);
            _search_pill__WEBPACK_IMPORTED_MODULE_30__.append_search_string(search_string, _search_pill_widget__WEBPACK_IMPORTED_MODULE_31__.widget);
        }
    }

    if (filter.contains_only_private_messages()) {
        _compose_closed_ui__WEBPACK_IMPORTED_MODULE_5__.update_buttons_for_private();
    } else {
        _compose_closed_ui__WEBPACK_IMPORTED_MODULE_5__.update_buttons_for_stream();
    }
    _compose_closed_ui__WEBPACK_IMPORTED_MODULE_5__.update_reply_recipient_label();

    _search__WEBPACK_IMPORTED_MODULE_29__.update_button_visibility();

    _compose_actions__WEBPACK_IMPORTED_MODULE_4__.on_narrow(opts);

    const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter();

    _top_left_corner__WEBPACK_IMPORTED_MODULE_35__.handle_narrow_activated(current_filter);
    _pm_list__WEBPACK_IMPORTED_MODULE_25__.handle_narrow_activated(current_filter);
    _stream_list__WEBPACK_IMPORTED_MODULE_34__.handle_narrow_activated(current_filter);
    _typing_events__WEBPACK_IMPORTED_MODULE_37__.render_notifications_for_narrow();
    _message_view_header__WEBPACK_IMPORTED_MODULE_20__.initialize();

    // It is important to call this after other important updates
    // like narrow filter and compose recipients happen.
    handle_middle_pane_transition();

    msg_list.initial_core_time = new Date();
    setTimeout(() => {
        _resize__WEBPACK_IMPORTED_MODULE_28__.resize_stream_filters_container();
        msg_list.initial_free_time = new Date();
        maybe_report_narrow_time(msg_list);
    }, 0);
}

function min_defined(a, b) {
    if (a === undefined) {
        return b;
    }
    if (b === undefined) {
        return a;
    }
    return a < b ? a : b;
}

function load_local_messages(msg_data) {
    // This little helper loads messages into our narrow message
    // data and returns true unless it's empty.  We use this for
    // cases when our local cache (all_messages_data) has at least
    // one message the user will expect to see in the new narrow.

    const in_msgs = _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.all_messages();
    msg_data.add_messages(in_msgs);

    return !msg_data.empty();
}

function maybe_add_local_messages(opts) {
    // This function determines whether we need to go to the server to
    // fetch messages for the requested narrow, or whether we have the
    // data cached locally to render the narrow correctly without
    // waiting for the server.  There are two high-level outcomes:
    //
    // 1. We're centering this narrow on the first unread message: In
    // this case final_select_id is left undefined or first unread
    // message id locally.
    //
    // 2. We're centering this narrow on the most recent matching
    // message. In this case we select final_select_id to the latest
    // message in the local cache (if the local cache has the latest
    // messages for this narrow) or max_int (if it doesn't).
    //
    // In either case, this function does two very closely related
    // things, both of which are somewhat optional:
    //
    //  - update id_info with more complete values
    //  - add messages into our message list from our local cache
    const id_info = opts.id_info;
    const msg_data = opts.msg_data;
    const unread_info = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.get_first_unread_info();

    // If we don't have a specific message we're hoping to select
    // (i.e. no `target_id`) and the narrow's filter doesn't
    // allow_use_first_unread_when_narrowing, we want to just render
    // the latest messages matching the filter.  To ensure this, we
    // set an initial value final_select_id to `max_int`.
    //
    // While that's a confusing naming choice (`final_select_id` is
    // meant to be final in the context of the caller), this sets the
    // default behavior to be fetching and then selecting the very
    // latest message in this narrow.
    //
    // If we're able to render the narrow locally, we'll end up
    // overwriting this value with the ID of the latest message in the
    // narrow later in this function.
    if (!id_info.target_id && !_narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter().allow_use_first_unread_when_narrowing()) {
        // Note that this may be overwritten; see above comment.
        id_info.final_select_id = LARGER_THAN_MAX_MESSAGE_ID;
    }

    if (unread_info.flavor === "cannot_compute") {
        // Full-text search and potentially other future cases where
        // we can't check which messages match on the frontend, so it
        // doesn't matter what's in our cache, we must go to the server.
        if (id_info.target_id) {
            // TODO: Ideally, in this case we should be asking the
            // server to give us the first unread or the target_id,
            // whichever is first (i.e. basically the `found` logic
            // below), but the server doesn't support that query.
            id_info.final_select_id = id_info.target_id;
        }
        // if we can't compute a next unread id, just return without
        // setting local_select_id, so that we go to the server.
        return;
    }

    // We can now assume narrow_state.filter().can_apply_locally(),
    // because !can_apply_locally => cannot_compute

    if (
        unread_info.flavor === "found" &&
        _narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter().allow_use_first_unread_when_narrowing()
    ) {
        // We have at least one unread message in this narrow, and the
        // narrow is one where we use the first unread message in
        // narrowing positioning decisions.  So either we aim for the
        // first unread message, or the target_id (if any), whichever
        // is earlier.  See #2091 for a detailed explanation of why we
        // need to look at unread here.
        id_info.final_select_id = min_defined(id_info.target_id, unread_info.msg_id);

        if (!load_local_messages(msg_data)) {
            return;
        }

        // Now that we know what message ID we're going to land on, we
        // can see if we can take the user there locally.
        if (msg_data.get(id_info.final_select_id)) {
            id_info.local_select_id = id_info.final_select_id;
        }

        // If we don't have the first unread message locally, we must
        // go to the server to get it before we can render the narrow.
        return;
    }

    // In all cases below here, the first unread message is irrelevant
    // to our positioning decisions, either because there are no
    // unread messages (unread_info.flavor === 'not_found') or because
    // this is a mixed narrow where we prefer the bottom of the feed
    // to the first unread message for positioning (and the narrow
    // will be configured to not mark messages as read).

    if (!id_info.target_id) {
        // Without unread messages or a target ID, we're narrowing to
        // the very latest message or first unread if matching the narrow allows.

        if (!_all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.fetch_status.has_found_newest()) {
            // If all_messages_data is not caught up, then we cannot
            // populate the latest messages for the target narrow
            // correctly from there, so we must go to the server.
            return;
        }
        if (!load_local_messages(msg_data)) {
            return;
        }
        // Otherwise, we have matching messages, and all_messages_data
        // is caught up, so the last message in our now-populated
        // msg_data object must be the last message matching the
        // narrow the server could give us, so we can render locally.
        // and use local latest message id instead of max_int if set earlier.
        const last_msg = msg_data.last();
        id_info.final_select_id = last_msg.id;
        id_info.local_select_id = id_info.final_select_id;
        return;
    }

    // We have a target_id and no unread messages complicating things,
    // so we definitely want to land on the target_id message.
    id_info.final_select_id = id_info.target_id;

    // TODO: We could improve on this next condition by considering
    // cases where
    // `all_messages_data.fetch_status.has_found_oldest()`; which
    // would come up with e.g. `near: 0` in a small organization.
    //
    // And similarly for `near: max_int` with has_found_newest.
    if (
        _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.empty() ||
        id_info.target_id < _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.first().id ||
        id_info.target_id > _all_messages_data__WEBPACK_IMPORTED_MODULE_1__.all_messages_data.last().id
    ) {
        // If the target message is outside the range that we had
        // available for local population, we must go to the server.
        return;
    }
    if (!load_local_messages(msg_data)) {
        return;
    }
    if (msg_data.get(id_info.target_id)) {
        // We have a range of locally renderable messages, including
        // our target, so we can render the narrow locally.
        id_info.local_select_id = id_info.final_select_id;
        return;
    }

    // Note: Arguably, we could have a use_closest sort of condition
    // here to handle cases where `target_id` doesn't match the narrow
    // but is within the locally renderable range.  But
    // !can_apply_locally + target_id is a rare combination in the
    // first place, so we don't bother.
    return;
}

function update_selection(opts) {
    if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current !== opts.msg_list) {
        // If we navigated away from a view while we were fetching
        // messages for it, don't attempt to move the currently
        // selected message.
        return;
    }

    if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.empty()) {
        // There's nothing to select if there are no messages.
        return;
    }

    const id_info = opts.id_info;
    const select_offset = opts.select_offset;

    let msg_id = id_info.final_select_id;
    if (msg_id === undefined) {
        msg_id = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.first_unread_message_id();
    }

    const preserve_pre_narrowing_screen_position =
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.get(msg_id) !== undefined && select_offset !== undefined;

    const then_scroll = !preserve_pre_narrowing_screen_position;

    _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.select_id(msg_id, {
        then_scroll,
        use_closest: true,
        force_rerender: true,
    });

    if (preserve_pre_narrowing_screen_position) {
        // Scroll so that the selected message is in the same
        // position in the viewport as it was prior to
        // narrowing
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.view.set_message_offset(select_offset);
    }
    _unread_ops__WEBPACK_IMPORTED_MODULE_39__.process_visible();
}

function activate_stream_for_cycle_hotkey(stream_name) {
    // This is the common code for A/D hotkeys.
    const filter_expr = [{operator: "stream", operand: stream_name}];
    activate(filter_expr, {});
}

function stream_cycle_backward() {
    const curr_stream = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.stream();

    if (!curr_stream) {
        return;
    }

    const stream_name = _topic_generator__WEBPACK_IMPORTED_MODULE_36__.get_prev_stream(curr_stream);

    if (!stream_name) {
        return;
    }

    activate_stream_for_cycle_hotkey(stream_name);
}

function stream_cycle_forward() {
    const curr_stream = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.stream();

    if (!curr_stream) {
        return;
    }

    const stream_name = _topic_generator__WEBPACK_IMPORTED_MODULE_36__.get_next_stream(curr_stream);

    if (!stream_name) {
        return;
    }

    activate_stream_for_cycle_hotkey(stream_name);
}

function narrow_to_next_topic() {
    const curr_info = {
        stream: _narrow_state__WEBPACK_IMPORTED_MODULE_22__.stream(),
        topic: _narrow_state__WEBPACK_IMPORTED_MODULE_22__.topic(),
    };

    const next_narrow = _topic_generator__WEBPACK_IMPORTED_MODULE_36__.get_next_topic(curr_info.stream, curr_info.topic);

    if (!next_narrow) {
        return;
    }

    const filter_expr = [
        {operator: "stream", operand: next_narrow.stream},
        {operator: "topic", operand: next_narrow.topic},
    ];

    activate(filter_expr, {});
}

function narrow_to_next_pm_string() {
    const curr_pm = _narrow_state__WEBPACK_IMPORTED_MODULE_22__.pm_ids_string();

    const next_pm = _topic_generator__WEBPACK_IMPORTED_MODULE_36__.get_next_unread_pm_string(curr_pm);

    if (!next_pm) {
        return;
    }

    // Hopefully someday we can narrow by user_ids_string instead of
    // mapping back to emails.
    const pm_with = _people__WEBPACK_IMPORTED_MODULE_24__.user_ids_string_to_emails_string(next_pm);

    const filter_expr = [{operator: "pm-with", operand: pm_with}];

    // force_close parameter is true to not auto open compose_box
    const opts = {
        force_close: true,
    };

    activate(filter_expr, opts);
}

// Activate narrowing with a single operator.
// This is just for syntactic convenience.
function by(operator, operand, opts) {
    activate([{operator, operand}], opts);
}

function by_topic(target_id, opts) {
    // don't use message_lists.current as it won't work for muted messages or for out-of-narrow links
    const original = _message_store__WEBPACK_IMPORTED_MODULE_19__.get(target_id);
    if (original.type !== "stream") {
        // Only stream messages have topics, but the
        // user wants us to narrow in some way.
        by_recipient(target_id, opts);
        return;
    }

    // We don't check msg_list.can_mark_messages_read here only because
    // the target msg_list isn't initialized yet; in any case, the
    // message is about to be marked read in the new view.
    _unread_ops__WEBPACK_IMPORTED_MODULE_39__.notify_server_message_read(original);

    const search_terms = [
        {operator: "stream", operand: original.stream},
        {operator: "topic", operand: original.topic},
    ];
    opts = {then_select_id: target_id, ...opts};
    activate(search_terms, opts);
}

// Called for the 'narrow by stream' hotkey.
function by_recipient(target_id, opts) {
    opts = {then_select_id: target_id, ...opts};
    // don't use message_lists.current as it won't work for muted messages or for out-of-narrow links
    const message = _message_store__WEBPACK_IMPORTED_MODULE_19__.get(target_id);

    // We don't check msg_list.can_mark_messages_read here only because
    // the target msg_list isn't initialized yet; in any case, the
    // message is about to be marked read in the new view.
    _unread_ops__WEBPACK_IMPORTED_MODULE_39__.notify_server_message_read(message);

    switch (message.type) {
        case "private":
            by("pm-with", message.reply_to, opts);
            break;

        case "stream":
            by("stream", message.stream, opts);
            break;
    }
}

// Called by the narrow_to_compose_target hotkey.
function to_compose_target() {
    if (!_compose_state__WEBPACK_IMPORTED_MODULE_7__.composing()) {
        return;
    }

    const opts = {
        trigger: "narrow_to_compose_target",
    };

    if (_compose_state__WEBPACK_IMPORTED_MODULE_7__.get_message_type() === "stream") {
        const stream_name = _compose_state__WEBPACK_IMPORTED_MODULE_7__.stream_name();
        const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_33__.get_stream_id(stream_name);
        if (!stream_id) {
            return;
        }
        // If we are composing to a new topic, we narrow to the stream but
        // grey-out the message view instead of narrowing to an empty view.
        const operators = [{operator: "stream", operand: stream_name}];
        const topic = _compose_state__WEBPACK_IMPORTED_MODULE_7__.topic();
        if (topic !== "") {
            operators.push({operator: "topic", operand: topic});
        }
        activate(operators, opts);
        return;
    }

    if (_compose_state__WEBPACK_IMPORTED_MODULE_7__.get_message_type() === "private") {
        const recipient_string = _compose_state__WEBPACK_IMPORTED_MODULE_7__.private_message_recipient();
        const emails = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(recipient_string);
        const invalid = emails.filter((email) => !_people__WEBPACK_IMPORTED_MODULE_24__.is_valid_email_for_compose(email));
        // If there are no recipients or any recipient is
        // invalid, narrow to all PMs.
        if (emails.length === 0 || invalid.length > 0) {
            by("is", "private", opts);
            return;
        }
        by("pm-with", Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(recipient_string), opts);
    }
}

function handle_post_narrow_deactivate_processes() {
    _compose_fade__WEBPACK_IMPORTED_MODULE_6__.update_message_list();

    // clear existing search pills
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        _search_pill_widget__WEBPACK_IMPORTED_MODULE_31__.widget.clear(true);
    }

    _top_left_corner__WEBPACK_IMPORTED_MODULE_35__.handle_narrow_deactivated();
    _pm_list__WEBPACK_IMPORTED_MODULE_25__.handle_narrow_deactivated();
    _stream_list__WEBPACK_IMPORTED_MODULE_34__.handle_narrow_deactivated();
    _compose_closed_ui__WEBPACK_IMPORTED_MODULE_5__.update_buttons_for_stream();
    _message_edit__WEBPACK_IMPORTED_MODULE_12__.handle_narrow_deactivated();
    _widgetize__WEBPACK_IMPORTED_MODULE_41__.set_widgets_for_list();
    _typing_events__WEBPACK_IMPORTED_MODULE_37__.render_notifications_for_narrow();
    _message_view_header__WEBPACK_IMPORTED_MODULE_20__.initialize();
    update_narrow_title(_narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter());
    _message_scroll__WEBPACK_IMPORTED_MODULE_18__.update_top_of_narrow_notices(_message_lists__WEBPACK_IMPORTED_MODULE_17__.home);
}

function deactivate(coming_from_recent_topics = false) {
    // NOTE: Never call this function independently,
    // always use browser_history.go_to_location("#all_messages") to
    // activate All message narrow.
    /*
      Switches message_lists.current from narrowed_msg_list to
      message_lists.home ("All messages"), ending the current narrow.  This
      is a very fast operation, because we keep message_lists.home's data
      cached and updated in the DOM at all times, making it suitable
      for rapid access via keyboard shortcuts.

      Long-term, we will likely want to make `message_lists.home` not
      special in any way, and instead just have a generic
      message_list_data structure caching system that happens to have
      message_lists.home in it.
     */
    _search__WEBPACK_IMPORTED_MODULE_29__.clear_search_form();
    // Both All messages and Recent topics have `undefined` filter.
    // Return if already in the All message narrow.
    if (_narrow_state__WEBPACK_IMPORTED_MODULE_22__.filter() === undefined && !coming_from_recent_topics) {
        return;
    }
    unnarrow_times = {start_time: new Date()};
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unnarrowed");

    if (_message_scroll__WEBPACK_IMPORTED_MODULE_18__.is_actively_scrolling()) {
        // There is no way to intercept in-flight scroll events, and they will
        // cause you to end up in the wrong place if you are actively scrolling
        // on an unnarrow. Wait a bit and try again once the scrolling is over.
        setTimeout(deactivate, 50);
        return;
    }

    if (!_compose_state__WEBPACK_IMPORTED_MODULE_7__.has_message_content()) {
        _compose_actions__WEBPACK_IMPORTED_MODULE_4__.cancel();
    }

    _narrow_state__WEBPACK_IMPORTED_MODULE_22__.reset_current_filter();
    has_shown_message_list_view = true;

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").removeClass("narrowed_view");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zfilt").removeClass("focused_table");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zhome").addClass("focused_table");
    _message_lists__WEBPACK_IMPORTED_MODULE_17__.set_current(_message_lists__WEBPACK_IMPORTED_MODULE_17__.home);
    _condense__WEBPACK_IMPORTED_MODULE_8__.condense_and_collapse(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zhome div.message_row"));

    reset_ui_state();
    handle_middle_pane_transition();
    _hashchange__WEBPACK_IMPORTED_MODULE_11__.save_narrow();

    if (_message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id() !== -1) {
        const preserve_pre_narrowing_screen_position =
            _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_row().length > 0 &&
            _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.pre_narrow_offset !== undefined;
        let message_id_to_select;
        const select_opts = {
            then_scroll: true,
            use_closest: true,
            empty_ok: true,
        };

        // We fall back to the closest selected id, if the user has removed a
        // stream from the home view since leaving it the old selected id might
        // no longer be there
        // Additionally, we pass empty_ok as the user may have removed **all** streams
        // from their home view
        if (_unread__WEBPACK_IMPORTED_MODULE_38__.messages_read_in_narrow) {
            // We read some unread messages in a narrow. Instead of going back to
            // where we were before the narrow, go to our first unread message (or
            // the bottom of the feed, if there are no unread messages).
            message_id_to_select = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.first_unread_message_id();
        } else {
            // We narrowed, but only backwards in time (ie no unread were read). Try
            // to go back to exactly where we were before narrowing.
            if (preserve_pre_narrowing_screen_position) {
                // We scroll the user back to exactly the offset from the selected
                // message that they were at the time that they narrowed.
                // TODO: Make this correctly handle the case of resizing while narrowed.
                select_opts.target_scroll_offset = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.pre_narrow_offset;
            }
            message_id_to_select = _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.selected_id();
        }
        _message_lists__WEBPACK_IMPORTED_MODULE_17__.current.select_id(message_id_to_select, select_opts);
    }

    handle_post_narrow_deactivate_processes();

    unnarrow_times.initial_core_time = new Date();
    setTimeout(() => {
        _resize__WEBPACK_IMPORTED_MODULE_28__.resize_stream_filters_container();
        unnarrow_times.initial_free_time = new Date();
        report_unnarrow_time();
    });
}


/***/ }),

/***/ "./static/js/narrow_banner.js":
/*!************************************!*\
  !*** ./static/js/narrow_banner.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "hide_empty_narrow_message": () => (/* binding */ hide_empty_narrow_message),
/* harmony export */   "show_empty_narrow_message": () => (/* binding */ show_empty_narrow_message)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _narrow_error__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./narrow_error */ "./static/js/narrow_error.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");











const SPECTATOR_STREAM_NARROW_BANNER = {
    title: "",
    html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {
            defaultMessage: "This is not a <z-link>publicly accessible</z-link> conversation.",
        },
        {
            "z-link": (content_html) =>
                `<a href="/help/public-access-option">${content_html.join("")}</a>`,
        },
    ),
};

function retrieve_search_query_data() {
    // when search bar contains multiple filters, only retrieve search queries
    const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();
    const search_query = current_filter.operands("search")[0];
    const query_words = search_query.split(" ");

    const search_string_result = {
        query_words: [],
        has_stop_word: false,
    };

    // Add in stream:foo and topic:bar if present
    if (current_filter.has_operator("stream") || current_filter.has_operator("topic")) {
        const stream = current_filter.operands("stream")[0];
        const topic = current_filter.operands("topic")[0];
        if (stream) {
            search_string_result.stream_query = stream;
        }
        if (topic) {
            search_string_result.topic_query = topic;
        }
    }

    // Gather information about each query word
    for (const query_word of query_words) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(query_word)) {
            search_string_result.has_stop_word = true;
            search_string_result.query_words.push({
                query_word,
                is_stop_word: true,
            });
        } else {
            search_string_result.query_words.push({
                query_word,
                is_stop_word: false,
            });
        }
    }

    return search_string_result;
}

function pick_empty_narrow_banner() {
    const default_banner = {
        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "There are no messages here."}),
        // Spectators cannot start a conversation.
        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
            ? ""
            : Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                  {
                      defaultMessage: "Why not <z-link>start the conversation</z-link>?",
                  },
                  {
                      "z-link": (content_html) =>
                          `<a href="#" class="empty_feed_compose_stream">${content_html.join(
                              "",
                          )}</a>`,
                  },
              ),
    };
    const empty_search_narrow_title = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No search results"});

    const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.filter();

    if (current_filter === undefined) {
        return default_banner;
    }

    const first_term = current_filter.operators()[0];
    const first_operator = first_term.operator;
    const first_operand = first_term.operand;
    const num_operators = current_filter.operators().length;

    if (num_operators !== 1) {
        // For invalid-multi-operator narrows, we display an invalid narrow message
        const streams = current_filter.operands("stream");

        // No message can have multiple streams
        if (streams.length > 1) {
            return {
                title: empty_search_narrow_title,
                html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage:
                        "<p>You are searching for messages that belong to more than one stream, which is not possible.</p>",
                }),
            };
        }
        // No message can have multiple topics
        if (current_filter.operands("topic").length > 1) {
            return {
                title: empty_search_narrow_title,
                html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage:
                        "<p>You are searching for messages that belong to more than one topic, which is not possible.</p>",
                }),
            };
        }
        // No message can have multiple senders
        if (current_filter.operands("sender").length > 1) {
            return {
                title: empty_search_narrow_title,
                html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage:
                        "<p>You are searching for messages that are sent by more than one person, which is not possible.</p>",
                }),
            };
        }

        // For empty stream searches within other narrows, we display the stop words
        if (current_filter.operands("search").length > 0) {
            return {
                title: empty_search_narrow_title,
                search_data: retrieve_search_query_data(),
            };
        }

        if (
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
            first_operator === "stream" &&
            !_stream_data__WEBPACK_IMPORTED_MODULE_6__.is_web_public_by_stream_name(first_operand)
        ) {
            // For non web-public streams, show `login_to_access` modal.
            _spectators__WEBPACK_IMPORTED_MODULE_5__.login_to_access(true);
            return SPECTATOR_STREAM_NARROW_BANNER;
        }

        // For other multi-operator narrows, we just use the default banner
        return default_banner;
    }

    switch (first_operator) {
        case "is":
            switch (first_operand) {
                case "starred":
                    // You have no starred messages.
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You haven't starred anything yet!"}),
                        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage:
                                    "Learn more about starring messages <z-link>here</z-link>.",
                            },
                            {
                                "z-link": (content_html) =>
                                    `<a href="/help/star-a-message">${content_html.join("")}</a>`,
                            },
                        ),
                    };
                case "mentioned":
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You haven't been mentioned yet!"}),
                        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage: "Learn more about mentions <z-link>here</z-link>.",
                            },
                            {
                                "z-link": (content_html) =>
                                    `<a href="/help/mention-a-user-or-group">${content_html.join(
                                        "",
                                    )}</a>`,
                            },
                        ),
                    };
                case "private":
                    // You have no private messages.
                    if (
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
                    ) {
                        return {
                            title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                                defaultMessage:
                                    "You are not allowed to send private messages in this organization.",
                            }),
                        };
                    }
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You have no private messages yet!"}),
                        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage: "Why not <z-link>start the conversation</z-link>?",
                            },
                            {
                                // TODO: The href here is a bit weird; we probably want to migrate
                                // this to a button element down the line.
                                "z-link": (content_html) =>
                                    `<a href="#" class="empty_feed_compose_private">${content_html.join(
                                        "",
                                    )}</a>`,
                            },
                        ),
                    };
                case "unread":
                    // You have no unread messages.
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You have no unread messages!"}),
                    };
                case "resolved":
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No topics are marked as resolved."}),
                    };
            }
            // fallthrough to default case if no match is found
            break;
        case "stream":
            if (!_stream_data__WEBPACK_IMPORTED_MODULE_6__.is_subscribed_by_name(first_operand)) {
                // You are narrowed to a stream which does not exist or is a private stream
                // in which you were never subscribed.

                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                    _spectators__WEBPACK_IMPORTED_MODULE_5__.login_to_access(true);
                    return SPECTATOR_STREAM_NARROW_BANNER;
                }

                function can_toggle_narrowed_stream() {
                    const stream_name = _narrow_state__WEBPACK_IMPORTED_MODULE_3__.stream();

                    if (!stream_name) {
                        return false;
                    }

                    const stream_sub = _stream_data__WEBPACK_IMPORTED_MODULE_6__.get_sub(first_operand);
                    return stream_sub && _stream_data__WEBPACK_IMPORTED_MODULE_6__.can_toggle_subscription(stream_sub);
                }

                if (can_toggle_narrowed_stream()) {
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                            defaultMessage:
                                "You aren't subscribed to this stream and nobody has talked about that yet!",
                        }),
                        // TODO: Consider moving the button to be its own option in the template.
                        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage: "<z-button>Subscribe</z-button>",
                            },
                            {
                                "z-button": (content_html) =>
                                    `<button class="button white rounded stream_sub_unsub_button sea-green" type="button" name="subscription">${content_html.join(
                                        "",
                                    )}</button>`,
                            },
                        ),
                    };
                }

                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "This stream does not exist or is private."}),
                };
            }
            // else fallthrough to default case
            break;
        case "search": {
            // You are narrowed to empty search results.
            return {
                title: empty_search_narrow_title,
                search_data: retrieve_search_query_data(),
            };
        }
        case "pm-with": {
            if (!_people__WEBPACK_IMPORTED_MODULE_4__.is_valid_bulk_emails_for_compose(first_operand.split(","))) {
                if (!first_operand.includes(",")) {
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "This user does not exist!"}),
                    };
                }
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "One or more of these users do not exist!"}),
                };
            }
            const user_ids = _people__WEBPACK_IMPORTED_MODULE_4__.emails_strings_to_user_ids_array(first_operand);
            if (
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
                (user_ids.length !== 1 || !_people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_ids[0]).is_bot)
            ) {
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage:
                            "You are not allowed to send private messages in this organization.",
                    }),
                };
            }
            if (!first_operand.includes(",")) {
                // You have no private messages with this person
                if (_people__WEBPACK_IMPORTED_MODULE_4__.is_current_user(first_operand)) {
                    return {
                        title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                            defaultMessage:
                                "You have not sent any private messages to yourself yet!",
                        }),
                        html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage:
                                    "Why not <z-link>start a conversation with yourself</z-link>?",
                            },
                            {
                                "z-link": (content_html) =>
                                    `<a href="#" class="empty_feed_compose_private">${content_html.join(
                                        "",
                                    )}</a>`,
                            },
                        ),
                    };
                }
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage: "You have no private messages with {person} yet.",
                        },
                        {person: _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_ids[0]).full_name},
                    ),
                    html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage: "Why not <z-link>start the conversation</z-link>?",
                        },
                        {
                            "z-link": (content_html) =>
                                `<a href="#" class="empty_feed_compose_private">${content_html.join(
                                    "",
                                )}</a>`,
                        },
                    ),
                };
            }
            return {
                title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You have no private messages with these users yet."}),
                html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {
                        defaultMessage: "Why not <z-link>start the conversation</z-link>?",
                    },
                    {
                        "z-link": (content_html) =>
                            `<a href="#" class="empty_feed_compose_private">${content_html.join(
                                "",
                            )}</a>`,
                    },
                ),
            };
        }
        case "sender": {
            const sender = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_email(first_operand);
            if (sender) {
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage:
                                "You haven't received any messages sent by {person} yet.",
                        },
                        {person: sender.full_name},
                    ),
                };
            }
            return {
                title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "This user does not exist!"}),
            };
        }
        case "group-pm-with": {
            const person_in_group_pm = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_email(first_operand);
            if (!person_in_group_pm) {
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "This user does not exist!"}),
                };
            }
            if (
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
            ) {
                return {
                    title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage:
                            "You are not allowed to send group private messages in this organization.",
                    }),
                };
            }
            return {
                title: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {
                        defaultMessage: "You have no group private messages with {person} yet.",
                    },
                    {person: person_in_group_pm.full_name},
                ),
                html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {
                        defaultMessage: "Why not <z-link>start the conversation</z-link>?",
                    },
                    {
                        "z-link": (content_html) =>
                            `<a href="#" class="empty_feed_compose_private">${content_html}</a>`,
                    },
                ),
            };
        }
    }
    return default_banner;
}

function show_empty_narrow_message() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".empty_feed_notice_main").empty();
    const rendered_narrow_banner = (0,_narrow_error__WEBPACK_IMPORTED_MODULE_2__.narrow_error)(pick_empty_narrow_banner());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".empty_feed_notice_main").html(rendered_narrow_banner);
}

function hide_empty_narrow_message() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".empty_feed_notice_main").empty();
}


/***/ }),

/***/ "./static/js/narrow_error.js":
/*!***********************************!*\
  !*** ./static/js/narrow_error.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "narrow_error": () => (/* binding */ narrow_error)
/* harmony export */ });
/* harmony import */ var _templates_empty_feed_notice_hbs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../templates/empty_feed_notice.hbs */ "./static/templates/empty_feed_notice.hbs");
/* harmony import */ var _templates_empty_feed_notice_hbs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_templates_empty_feed_notice_hbs__WEBPACK_IMPORTED_MODULE_0__);


function narrow_error(narrow_banner_data) {
    const title = narrow_banner_data.title;
    const html = narrow_banner_data.html;
    const search_data = narrow_banner_data.search_data;

    const $empty_feed_notice = _templates_empty_feed_notice_hbs__WEBPACK_IMPORTED_MODULE_0___default()({title, html, search_data});
    return $empty_feed_notice;
}


/***/ }),

/***/ "./static/js/narrow_state.js":
/*!***********************************!*\
  !*** ./static/js/narrow_state.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_possible_unread_message_ids": () => (/* binding */ _possible_unread_message_ids),
/* harmony export */   "active": () => (/* binding */ active),
/* harmony export */   "excludes_muted_topics": () => (/* binding */ excludes_muted_topics),
/* harmony export */   "filter": () => (/* binding */ filter),
/* harmony export */   "get_first_unread_info": () => (/* binding */ get_first_unread_info),
/* harmony export */   "is_for_stream_id": () => (/* binding */ is_for_stream_id),
/* harmony export */   "narrowed_by_pm_reply": () => (/* binding */ narrowed_by_pm_reply),
/* harmony export */   "narrowed_by_reply": () => (/* binding */ narrowed_by_reply),
/* harmony export */   "narrowed_by_stream_reply": () => (/* binding */ narrowed_by_stream_reply),
/* harmony export */   "narrowed_by_topic_reply": () => (/* binding */ narrowed_by_topic_reply),
/* harmony export */   "narrowed_to_pms": () => (/* binding */ narrowed_to_pms),
/* harmony export */   "narrowed_to_search": () => (/* binding */ narrowed_to_search),
/* harmony export */   "narrowed_to_starred": () => (/* binding */ narrowed_to_starred),
/* harmony export */   "narrowed_to_topic": () => (/* binding */ narrowed_to_topic),
/* harmony export */   "operators": () => (/* binding */ operators),
/* harmony export */   "pm_emails_string": () => (/* binding */ pm_emails_string),
/* harmony export */   "pm_ids_string": () => (/* binding */ pm_ids_string),
/* harmony export */   "public_operators": () => (/* binding */ public_operators),
/* harmony export */   "reset_current_filter": () => (/* binding */ reset_current_filter),
/* harmony export */   "search_string": () => (/* binding */ search_string),
/* harmony export */   "set_compose_defaults": () => (/* binding */ set_compose_defaults),
/* harmony export */   "set_current_filter": () => (/* binding */ set_current_filter),
/* harmony export */   "stream": () => (/* binding */ stream),
/* harmony export */   "stream_sub": () => (/* binding */ stream_sub),
/* harmony export */   "topic": () => (/* binding */ topic),
/* harmony export */   "update_email": () => (/* binding */ update_email)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");







let current_filter;

function reset_current_filter() {
    current_filter = undefined;
}

function set_current_filter(filter) {
    current_filter = filter;
}

function active() {
    return current_filter !== undefined;
}

function filter() {
    // Both, `All messages` and
    // `Recent topics` have `current_filter=undefined`
    return current_filter;
}

function operators() {
    if (current_filter === undefined) {
        return new _filter__WEBPACK_IMPORTED_MODULE_1__.Filter(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).operators();
    }
    return current_filter.operators();
}

function update_email(user_id, new_email) {
    if (current_filter !== undefined) {
        current_filter.update_email(user_id, new_email);
    }
}

/* Operators we should send to the server. */
function public_operators() {
    if (current_filter === undefined) {
        return undefined;
    }
    return current_filter.public_operators();
}

function search_string() {
    return _filter__WEBPACK_IMPORTED_MODULE_1__.Filter.unparse(operators());
}

// Collect operators which appear only once into an object,
// and discard those which appear more than once.
function collect_single(operators) {
    const seen = new Map();
    const result = new Map();

    for (const elem of operators) {
        const key = elem.operator;
        if (seen.has(key)) {
            result.delete(key);
        } else {
            result.set(key, elem.operand);
            seen.set(key, true);
        }
    }

    return result;
}

// Modify default compose parameters (stream etc.) based on
// the current narrowed view.
//
// This logic is here and not in the 'compose' module because
// it will get more complicated as we add things to the narrow
// operator language.
function set_compose_defaults() {
    const opts = {};
    const single = collect_single(operators());

    // Set the stream, topic, and/or PM recipient if they are
    // uniquely specified in the narrow view.

    if (single.has("stream")) {
        opts.stream = _stream_data__WEBPACK_IMPORTED_MODULE_3__.get_name(single.get("stream"));
    }

    if (single.has("topic")) {
        opts.topic = single.get("topic");
    }

    if (single.has("pm-with")) {
        const private_message_recipient = single.get("pm-with");
        if (_people__WEBPACK_IMPORTED_MODULE_2__.is_valid_bulk_emails_for_compose(private_message_recipient.split(","))) {
            opts.private_message_recipient = private_message_recipient;
        }
    }
    return opts;
}

function stream() {
    if (current_filter === undefined) {
        return undefined;
    }
    const stream_operands = current_filter.operands("stream");
    if (stream_operands.length === 1) {
        const name = stream_operands[0];

        // Use get_name() to get the most current stream
        // name (considering renames and capitalization).
        return _stream_data__WEBPACK_IMPORTED_MODULE_3__.get_name(name);
    }
    return undefined;
}

function stream_sub() {
    if (current_filter === undefined) {
        return undefined;
    }
    const stream_operands = current_filter.operands("stream");
    if (stream_operands.length !== 1) {
        return undefined;
    }

    const name = stream_operands[0];
    const sub = _stream_data__WEBPACK_IMPORTED_MODULE_3__.get_sub_by_name(name);

    return sub;
}

function topic() {
    if (current_filter === undefined) {
        return undefined;
    }
    const operands = current_filter.operands("topic");
    if (operands.length === 1) {
        return operands[0];
    }
    return undefined;
}

function pm_ids_string() {
    // If you are narrowed to a PM conversation
    // with users 4, 5, and 99, this will return "4,5,99"
    const emails_string = pm_emails_string();

    if (!emails_string) {
        return undefined;
    }

    const user_ids_string = _people__WEBPACK_IMPORTED_MODULE_2__.reply_to_to_user_ids_string(emails_string);

    return user_ids_string;
}

function pm_emails_string() {
    if (current_filter === undefined) {
        return undefined;
    }

    const operands = current_filter.operands("pm-with");
    if (operands.length !== 1) {
        return undefined;
    }

    return operands[0];
}

function get_first_unread_info() {
    if (current_filter === undefined) {
        // we don't yet support the all-messages view
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("unexpected call to get_first_unread_info");
        return {
            flavor: "cannot_compute",
        };
    }

    if (!current_filter.can_apply_locally()) {
        // For things like search queries, where the server has info
        // that the client isn't privy to, we need to wait for the
        // server to give us a definitive list of messages before
        // deciding where we'll move the selection.
        return {
            flavor: "cannot_compute",
        };
    }

    const unread_ids = _possible_unread_message_ids();

    if (unread_ids === undefined) {
        // _possible_unread_message_ids() only works for certain narrows
        return {
            flavor: "cannot_compute",
        };
    }

    const msg_id = current_filter.first_valid_id_from(unread_ids);

    if (msg_id === undefined) {
        return {
            flavor: "not_found",
        };
    }

    return {
        flavor: "found",
        msg_id: unread_ids[0],
    };
}

function _possible_unread_message_ids() {
    // This function currently only returns valid results for
    // certain types of narrows, mostly left sidebar narrows.
    // For more complicated narrows we may return undefined.
    //
    // If we do return a result, it will be a subset of unread
    // message ids but possibly a superset of unread message ids
    // that match our filter.
    if (current_filter === undefined) {
        return undefined;
    }

    let sub;
    let topic_name;
    let current_filter_pm_string;

    if (current_filter.can_bucket_by("stream", "topic")) {
        sub = stream_sub();
        if (sub === undefined) {
            return [];
        }
        topic_name = topic();
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_topic(sub.stream_id, topic_name);
    }

    if (current_filter.can_bucket_by("stream")) {
        sub = stream_sub();
        if (sub === undefined) {
            return [];
        }
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_stream(sub.stream_id);
    }

    if (current_filter.can_bucket_by("pm-with")) {
        current_filter_pm_string = pm_ids_string();
        if (current_filter_pm_string === undefined) {
            return [];
        }
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_user_ids_string(current_filter_pm_string);
    }

    if (current_filter.can_bucket_by("is-private")) {
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_private();
    }

    if (current_filter.can_bucket_by("is-mentioned")) {
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_mentions();
    }

    if (current_filter.can_bucket_by("is-starred")) {
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_msg_ids_for_starred();
    }

    if (current_filter.can_bucket_by("sender")) {
        // TODO: see #9352 to make this more efficient
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_all_msg_ids();
    }

    if (current_filter.can_apply_locally()) {
        return _unread__WEBPACK_IMPORTED_MODULE_4__.get_all_msg_ids();
    }

    return undefined;
}

// Are we narrowed to PMs: all PMs or PMs with particular people.
function narrowed_to_pms() {
    if (current_filter === undefined) {
        return false;
    }
    return current_filter.has_operator("pm-with") || current_filter.has_operand("is", "private");
}

function narrowed_by_pm_reply() {
    if (current_filter === undefined) {
        return false;
    }
    const operators = current_filter.operators();
    return operators.length === 1 && current_filter.has_operator("pm-with");
}

function narrowed_by_topic_reply() {
    if (current_filter === undefined) {
        return false;
    }
    const operators = current_filter.operators();
    return (
        operators.length === 2 &&
        current_filter.operands("stream").length === 1 &&
        current_filter.operands("topic").length === 1
    );
}

// We auto-reply under certain conditions, namely when you're narrowed
// to a PM (or huddle), and when you're narrowed to some stream/topic pair
function narrowed_by_reply() {
    return narrowed_by_pm_reply() || narrowed_by_topic_reply();
}

function narrowed_by_stream_reply() {
    if (current_filter === undefined) {
        return false;
    }
    const operators = current_filter.operators();
    return operators.length === 1 && current_filter.operands("stream").length === 1;
}

function narrowed_to_topic() {
    if (current_filter === undefined) {
        return false;
    }
    return current_filter.has_operator("stream") && current_filter.has_operator("topic");
}

function narrowed_to_search() {
    return current_filter !== undefined && current_filter.is_search();
}

function narrowed_to_starred() {
    if (current_filter === undefined) {
        return false;
    }
    return current_filter.has_operand("is", "starred");
}

function excludes_muted_topics() {
    return (
        !narrowed_to_topic() &&
        !narrowed_to_search() &&
        !narrowed_to_pms() &&
        !narrowed_to_starred()
    );
}

function is_for_stream_id(stream_id) {
    // This is not perfect, since we still track narrows by
    // name, not id, but at least the interface is good going
    // forward.
    const narrow_sub = stream_sub();

    if (narrow_sub === undefined) {
        return false;
    }

    return stream_id === narrow_sub.stream_id;
}


/***/ }),

/***/ "./static/js/navbar_alerts.js":
/*!************************************!*\
  !*** ./static/js/navbar_alerts.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "check_profile_incomplete": () => (/* binding */ check_profile_incomplete),
/* harmony export */   "dismiss_upgrade_nag": () => (/* binding */ dismiss_upgrade_nag),
/* harmony export */   "get_demo_organization_deadline_days_remaining": () => (/* binding */ get_demo_organization_deadline_days_remaining),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "open": () => (/* binding */ open),
/* harmony export */   "resize_app": () => (/* binding */ resize_app),
/* harmony export */   "should_show_notifications": () => (/* binding */ should_show_notifications),
/* harmony export */   "should_show_server_upgrade_notification": () => (/* binding */ should_show_server_upgrade_notification),
/* harmony export */   "show_profile_incomplete": () => (/* binding */ show_profile_incomplete)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/addDays/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_navbar_alerts_bankruptcy_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/navbar_alerts/bankruptcy.hbs */ "./static/templates/navbar_alerts/bankruptcy.hbs");
/* harmony import */ var _templates_navbar_alerts_bankruptcy_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_bankruptcy_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_navbar_alerts_configure_outgoing_email_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/navbar_alerts/configure_outgoing_email.hbs */ "./static/templates/navbar_alerts/configure_outgoing_email.hbs");
/* harmony import */ var _templates_navbar_alerts_configure_outgoing_email_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_configure_outgoing_email_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_navbar_alerts_demo_organization_deadline_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/navbar_alerts/demo_organization_deadline.hbs */ "./static/templates/navbar_alerts/demo_organization_deadline.hbs");
/* harmony import */ var _templates_navbar_alerts_demo_organization_deadline_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_demo_organization_deadline_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_navbar_alerts_desktop_notifications_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/navbar_alerts/desktop_notifications.hbs */ "./static/templates/navbar_alerts/desktop_notifications.hbs");
/* harmony import */ var _templates_navbar_alerts_desktop_notifications_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_desktop_notifications_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_navbar_alerts_insecure_desktop_app_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/navbar_alerts/insecure_desktop_app.hbs */ "./static/templates/navbar_alerts/insecure_desktop_app.hbs");
/* harmony import */ var _templates_navbar_alerts_insecure_desktop_app_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_insecure_desktop_app_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_navbar_alerts_navbar_alert_wrapper_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/navbar_alerts/navbar_alert_wrapper.hbs */ "./static/templates/navbar_alerts/navbar_alert_wrapper.hbs");
/* harmony import */ var _templates_navbar_alerts_navbar_alert_wrapper_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_navbar_alert_wrapper_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_navbar_alerts_profile_incomplete_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/navbar_alerts/profile_incomplete.hbs */ "./static/templates/navbar_alerts/profile_incomplete.hbs");
/* harmony import */ var _templates_navbar_alerts_profile_incomplete_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_profile_incomplete_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _templates_navbar_alerts_server_needs_upgrade_hbs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../templates/navbar_alerts/server_needs_upgrade.hbs */ "./static/templates/navbar_alerts/server_needs_upgrade.hbs");
/* harmony import */ var _templates_navbar_alerts_server_needs_upgrade_hbs__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_templates_navbar_alerts_server_needs_upgrade_hbs__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






















/* This is called by resize.js, and thus indirectly when we trigger
 * resize events in the logic below. */
function resize_app() {
    const navbar_alerts_wrapper_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar_alerts_wrapper").height();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body > .app").height("calc(100% - " + navbar_alerts_wrapper_height + "px)");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".recent_topics_container").height("calc(100vh - " + navbar_alerts_wrapper_height + "px)");

    // the floating recipient bar is usually positioned right below
    // the `.header` element (including padding).
    const frb_top =
        navbar_alerts_wrapper_height +
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").height() +
        Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").css("paddingBottom"), 10);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar").css("top", frb_top + "px");

    // If the compose-box is in expanded state,
    // reset its height as well.
    if (_compose_ui__WEBPACK_IMPORTED_MODULE_9__.is_full_size()) {
        _compose_ui__WEBPACK_IMPORTED_MODULE_9__.set_compose_box_top(true);
    }
}

const show_step = function ($process, step) {
    $process
        .find("[data-step]")
        .hide()
        .filter("[data-step=" + step + "]")
        .show();
};

const get_step = function ($process) {
    return $process.find("[data-step]:visible").data("step");
};

function should_show_notifications(ls) {
    // if the user said to never show banner on this computer again, it will
    // be stored as `true` so we want to negate that.
    if (_localstorage__WEBPACK_IMPORTED_MODULE_11__.localstorage.supported() && ls.get("dontAskForNotifications") === true) {
        return false;
    }

    return (
        // Spectators cannot receive desktop notifications, so never
        // request permissions to send them.
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        // notifications *basically* don't work on any mobile platforms, so don't
        // event show the banners. This prevents trying to access things that
        // don't exist like `Notification.permission`.
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() &&
        // if permission has not been granted yet.
        !_notifications__WEBPACK_IMPORTED_MODULE_12__.granted_desktop_notifications_permission() &&
        // if permission is allowed to be requested (e.g. not in "denied" state).
        _notifications__WEBPACK_IMPORTED_MODULE_12__.permission_state() !== "denied"
    );
}

function should_show_server_upgrade_notification(ls) {
    // We do not show the server upgrade nag for a week after the user
    // clicked "dismiss".
    if (!_localstorage__WEBPACK_IMPORTED_MODULE_11__.localstorage.supported() || ls.get("lastUpgradeNagDismissalTime") === undefined) {
        return true;
    }

    const last_notification_dismissal_time = ls.get("lastUpgradeNagDismissalTime");

    const upgrade_nag_dismissal_duration = (0,date_fns__WEBPACK_IMPORTED_MODULE_16__["default"])(new Date(last_notification_dismissal_time), 7);

    // show the notification only if the time duration is completed.
    return Date.now() > upgrade_nag_dismissal_duration;
}

function dismiss_upgrade_nag(ls) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".alert[data-process='server-needs-upgrade'").hide();
    if (_localstorage__WEBPACK_IMPORTED_MODULE_11__.localstorage.supported()) {
        ls.set("lastUpgradeNagDismissalTime", Date.now());
    }
}

function check_profile_incomplete() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    // Eventually, we might also check page_params.realm_icon_source,
    // but it feels too aggressive to ask users to do change that
    // since their organization might not have a logo yet.
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "" ||
        /^Organization imported from [A-Za-z]+[!.]$/.test(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))
    ) {
        return true;
    }
    return false;
}

function show_profile_incomplete(is_profile_incomplete) {
    if (is_profile_incomplete) {
        // Note that this will be a noop unless we'd already displayed
        // the notice in this session.  This seems OK, given that
        // this is meant to be a one-time task for administrators.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("[data-process='profile-incomplete']").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("[data-process='profile-incomplete']").hide();
    }
}

function get_demo_organization_deadline_days_remaining() {
    const now = new Date(Date.now());
    const deadline = new Date(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) * 1000);
    const day = 24 * 60 * 60 * 1000; // hours * minutes * seconds * milliseconds
    const days_remaining = Math.round(Math.abs(deadline - now) / day);
    return days_remaining;
}

function initialize() {
    const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_11__.localstorage)();

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const days_remaining = get_demo_organization_deadline_days_remaining();
        open({
            data_process: "demo-organization-deadline",
            custom_class: days_remaining <= 7 ? "red" : "",
            rendered_alert_content_html: _templates_navbar_alerts_demo_organization_deadline_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                days_remaining,
            }),
        });
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        open({
            data_process: "insecure-desktop-app",
            custom_class: "red",
            rendered_alert_content_html: _templates_navbar_alerts_insecure_desktop_app_hbs__WEBPACK_IMPORTED_MODULE_5___default()(),
        });
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        if (should_show_server_upgrade_notification(ls)) {
            open({
                data_process: "server-needs-upgrade",
                custom_class: "red",
                rendered_alert_content_html: _templates_navbar_alerts_server_needs_upgrade_hbs__WEBPACK_IMPORTED_MODULE_8___default()(),
            });
        }
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === true && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // if email has not been set up and the user is the admin,
        // display a warning to tell them to set up an email server.
        open({
            data_process: "email-server",
            custom_class: "red",
            rendered_alert_content_html: _templates_navbar_alerts_configure_outgoing_email_hbs__WEBPACK_IMPORTED_MODULE_2___default()(),
        });
    } else if (should_show_notifications(ls)) {
        open({
            data_process: "notifications",
            rendered_alert_content_html: _templates_navbar_alerts_desktop_notifications_hbs__WEBPACK_IMPORTED_MODULE_4___default()(),
        });
    } else if (_unread_ui__WEBPACK_IMPORTED_MODULE_15__.should_display_bankruptcy_banner()) {
        const unread_msgs_count = _unread__WEBPACK_IMPORTED_MODULE_13__.get_unread_message_count();
        open({
            data_process: "bankruptcy",
            custom_class: "bankruptcy",
            rendered_alert_content_html: _templates_navbar_alerts_bankruptcy_hbs__WEBPACK_IMPORTED_MODULE_1___default()({unread_msgs_count}),
        });
    } else if (check_profile_incomplete()) {
        open({
            data_process: "profile-incomplete",
            rendered_alert_content_html: _templates_navbar_alerts_profile_incomplete_hbs__WEBPACK_IMPORTED_MODULE_7___default()(),
        });
    }

    // Configure click handlers.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".request-desktop-notifications").on("click", function (e) {
        e.preventDefault();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".alert").hide();
        _notifications__WEBPACK_IMPORTED_MODULE_12__.request_desktop_notifications_permission();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".reject-notifications").on("click", function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".alert").hide();
        ls.set("dontAskForNotifications", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".hide-demo-org-notice").on("click", function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".alert").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".accept-bankruptcy").on("click", function (e) {
        e.preventDefault();
        const $process = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest("[data-process]");
        show_step($process, 2);
        setTimeout(_unread_ops__WEBPACK_IMPORTED_MODULE_14__.mark_all_as_read, 1000);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dismiss-upgrade-nag").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dismiss_upgrade_nag(ls);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar_alerts_wrapper").on("click", ".alert .close, .alert .exit", function (e) {
        e.stopPropagation();
        const $process = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("[data-process]");
        if (get_step($process) === 1 && $process.data("process") === "notifications") {
            show_step($process, 2);
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".alert").hide();
        }
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
    });

    // Treat Enter with links in the navbar alerts UI focused like a click.,
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar_alerts_wrapper").on("keyup", ".alert-link[role=button]", function (e) {
        e.stopPropagation();
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).trigger("click");
        }
    });
}

function open(args) {
    const rendered_alert_wrapper_html = _templates_navbar_alerts_navbar_alert_wrapper_hbs__WEBPACK_IMPORTED_MODULE_6___default()(args);

    // Note: We only support one alert being rendered at a time; as a
    // result, we just replace the alert area in the DOM with the
    // indicated alert. We do this to avoid bad UX, as it'd look weird
    // to have more than one alert visible at a time.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar_alerts_wrapper").html(rendered_alert_wrapper_html);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).trigger("resize");
}


/***/ }),

/***/ "./static/js/navigate.js":
/*!*******************************!*\
  !*** ./static/js/navigate.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "down": () => (/* binding */ down),
/* harmony export */   "maybe_scroll_to_selected": () => (/* binding */ maybe_scroll_to_selected),
/* harmony export */   "page_down": () => (/* binding */ page_down),
/* harmony export */   "page_down_the_right_amount": () => (/* binding */ page_down_the_right_amount),
/* harmony export */   "page_up": () => (/* binding */ page_up),
/* harmony export */   "page_up_the_right_amount": () => (/* binding */ page_up_the_right_amount),
/* harmony export */   "plan_scroll_to_selected": () => (/* binding */ plan_scroll_to_selected),
/* harmony export */   "scroll_to_selected": () => (/* binding */ scroll_to_selected),
/* harmony export */   "to_end": () => (/* binding */ to_end),
/* harmony export */   "to_home": () => (/* binding */ to_home),
/* harmony export */   "up": () => (/* binding */ up)
/* harmony export */ });
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");





function go_to_row(msg_id) {
    _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.select_id(msg_id, {then_scroll: true, from_scroll: true});
}

function up() {
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.set_last_movement_direction(-1);
    const msg_id = _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.prev();
    if (msg_id === undefined) {
        return;
    }
    go_to_row(msg_id);
}

function down(with_centering) {
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.set_last_movement_direction(1);

    if (_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.is_at_end()) {
        if (with_centering) {
            // At the last message, scroll to the bottom so we have
            // lots of nice whitespace for new messages coming in.
            const $current_msg_table = _rows__WEBPACK_IMPORTED_MODULE_2__.get_table(_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.table_name);
            _message_viewport__WEBPACK_IMPORTED_MODULE_1__.scrollTop(
                $current_msg_table.safeOuterHeight(true) - _message_viewport__WEBPACK_IMPORTED_MODULE_1__.height() * 0.1,
            );
            _unread_ops__WEBPACK_IMPORTED_MODULE_3__.process_scrolled_to_bottom();
        }

        return;
    }

    // Normal path starts here.
    const msg_id = _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.next();
    if (msg_id === undefined) {
        return;
    }
    go_to_row(msg_id);
}

function to_home() {
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.set_last_movement_direction(-1);
    const first_id = _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.first().id;
    _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.select_id(first_id, {then_scroll: true, from_scroll: true});
}

function to_end() {
    const next_id = _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.last().id;
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.set_last_movement_direction(1);
    _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.select_id(next_id, {then_scroll: true, from_scroll: true});
    _unread_ops__WEBPACK_IMPORTED_MODULE_3__.process_scrolled_to_bottom();
}

function amount_to_paginate() {
    // Some day we might have separate versions of this function
    // for Page Up vs. Page Down, but for now it's the same
    // strategy in either direction.
    const info = _message_viewport__WEBPACK_IMPORTED_MODULE_1__.message_viewport_info();
    const page_size = info.visible_height;

    // We don't want to page up a full page, because Zulip users
    // are especially worried about missing messages, so we want
    // a little bit of the old page to stay on the screen.  The
    // value chosen here is roughly 2 or 3 lines of text, but there
    // is nothing sacred about it, and somebody more anal than me
    // might wish to tie this to the size of some particular DOM
    // element.
    const overlap_amount = 55;

    let delta = page_size - overlap_amount;

    // If the user has shrunk their browser a whole lot, pagination
    // is not going to be very pleasant, but we can at least
    // ensure they go in the right direction.
    if (delta < 1) {
        delta = 1;
    }

    return delta;
}

function page_up_the_right_amount() {
    // This function's job is to scroll up the right amount,
    // after the user hits Page Up.  We do this ourselves
    // because we can't rely on the browser to account for certain
    // page elements, like the compose box, that sit in fixed
    // positions above the message pane.  For other scrolling
    // related adjustments, try to make those happen in the
    // scroll handlers, not here.
    const delta = amount_to_paginate();
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.scrollTop(_message_viewport__WEBPACK_IMPORTED_MODULE_1__.scrollTop() - delta);
}

function page_down_the_right_amount() {
    // see also: page_up_the_right_amount
    const delta = amount_to_paginate();
    _message_viewport__WEBPACK_IMPORTED_MODULE_1__.scrollTop(_message_viewport__WEBPACK_IMPORTED_MODULE_1__.scrollTop() + delta);
}

function page_up() {
    if (_message_viewport__WEBPACK_IMPORTED_MODULE_1__.at_top() && !_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.empty()) {
        _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.select_id(_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.first().id, {then_scroll: false});
    } else {
        page_up_the_right_amount();
    }
}

function page_down() {
    if (_message_viewport__WEBPACK_IMPORTED_MODULE_1__.at_bottom() && !_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.empty()) {
        _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.select_id(_message_lists__WEBPACK_IMPORTED_MODULE_0__.current.last().id, {then_scroll: false});
        _unread_ops__WEBPACK_IMPORTED_MODULE_3__.process_scrolled_to_bottom();
    } else {
        page_down_the_right_amount();
    }
}

function scroll_to_selected() {
    const $selected_row = _message_lists__WEBPACK_IMPORTED_MODULE_0__.current.selected_row();
    if ($selected_row && $selected_row.length !== 0) {
        _message_viewport__WEBPACK_IMPORTED_MODULE_1__.recenter_view($selected_row);
    }
}

let scroll_to_selected_planned = false;

function plan_scroll_to_selected() {
    scroll_to_selected_planned = true;
}

function maybe_scroll_to_selected() {
    // If we have made a plan to scroll to the selected message but
    // deferred doing so, do so here.
    if (scroll_to_selected_planned) {
        scroll_to_selected();
        scroll_to_selected_planned = false;
    }
}


/***/ }),

/***/ "./static/js/notifications.js":
/*!************************************!*\
  !*** ./static/js/notifications.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_compose_notifications": () => (/* binding */ clear_compose_notifications),
/* harmony export */   "close_notification": () => (/* binding */ close_notification),
/* harmony export */   "get_local_notify_mix_reason": () => (/* binding */ get_local_notify_mix_reason),
/* harmony export */   "get_notifications": () => (/* binding */ get_notifications),
/* harmony export */   "granted_desktop_notifications_permission": () => (/* binding */ granted_desktop_notifications_permission),
/* harmony export */   "handle_global_notification_updates": () => (/* binding */ handle_global_notification_updates),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_window_focused": () => (/* binding */ is_window_focused),
/* harmony export */   "message_is_notifiable": () => (/* binding */ message_is_notifiable),
/* harmony export */   "notify_above_composebox": () => (/* binding */ notify_above_composebox),
/* harmony export */   "notify_local_mixes": () => (/* binding */ notify_local_mixes),
/* harmony export */   "notify_messages_outside_current_search": () => (/* binding */ notify_messages_outside_current_search),
/* harmony export */   "permission_state": () => (/* binding */ permission_state),
/* harmony export */   "process_notification": () => (/* binding */ process_notification),
/* harmony export */   "received_messages": () => (/* binding */ received_messages),
/* harmony export */   "redraw_title": () => (/* binding */ redraw_title),
/* harmony export */   "register_click_handlers": () => (/* binding */ register_click_handlers),
/* harmony export */   "reify_message_id": () => (/* binding */ reify_message_id),
/* harmony export */   "request_desktop_notifications_permission": () => (/* binding */ request_desktop_notifications_permission),
/* harmony export */   "send_test_notification": () => (/* binding */ send_test_notification),
/* harmony export */   "set_notification_api": () => (/* binding */ set_notification_api),
/* harmony export */   "should_send_audible_notification": () => (/* binding */ should_send_audible_notification),
/* harmony export */   "should_send_desktop_notification": () => (/* binding */ should_send_desktop_notification),
/* harmony export */   "update_notification_sound_source": () => (/* binding */ update_notification_sound_source),
/* harmony export */   "update_unread_counts": () => (/* binding */ update_unread_counts)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_compose_banner_message_sent_banner_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/compose_banner/message_sent_banner.hbs */ "./static/templates/compose_banner/message_sent_banner.hbs");
/* harmony import */ var _templates_compose_banner_message_sent_banner_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_banner_message_sent_banner_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _favicon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./favicon */ "./static/js/favicon.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './spoilers'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_ui_updates__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./stream_ui_updates */ "./static/js/stream_ui_updates.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");




























const notice_memory = new Map();

// When you start Zulip, window_focused should be true, but it might not be the
// case after a server-initiated reload.
let window_focused = document.hasFocus && document.hasFocus();

let NotificationAPI;

function set_notification_api(n) {
    NotificationAPI = n;
}

if (window.electron_bridge && window.electron_bridge.new_notification) {
    class ElectronBridgeNotification extends EventTarget {
        constructor(title, options) {
            super();
            Object.assign(
                this,
                window.electron_bridge.new_notification(title, options, (type, eventInit) =>
                    this.dispatchEvent(new Event(type, eventInit)),
                ),
            );
        }

        static get permission() {
            return Notification.permission;
        }

        static async requestPermission(callback) {
            if (callback) {
                callback(await Promise.resolve(Notification.permission));
            }
            return Notification.permission;
        }
    }

    NotificationAPI = ElectronBridgeNotification;
} else if (window.Notification) {
    NotificationAPI = window.Notification;
}

function get_notifications() {
    return notice_memory;
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window)
        .on("focus", () => {
            window_focused = true;

            for (const notice_mem_entry of notice_memory.values()) {
                notice_mem_entry.obj.close();
            }
            notice_memory.clear();

            // Update many places on the DOM to reflect unread
            // counts.
            _unread_ops__WEBPACK_IMPORTED_MODULE_17__.process_visible();
        })
        .on("blur", () => {
            window_focused = false;
        });

    update_notification_sound_source(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-notification-sound-audio"), Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    update_notification_sound_source(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-default-notification-sound-audio"),
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function update_notification_sound_source(container_elem, settings_object) {
    const notification_sound = settings_object.notification_sound;
    const audio_file_without_extension = "/static/audio/notification_sounds/" + notification_sound;
    container_elem
        .find(".notification-sound-source-ogg")
        .attr("src", `${audio_file_without_extension}.ogg`);
    container_elem
        .find(".notification-sound-source-mp3")
        .attr("src", `${audio_file_without_extension}.mp3`);

    if (notification_sound !== "none") {
        // Load it so that it is ready to be played; without this the old sound
        // is played.
        container_elem[0].load();
    }
}

function permission_state() {
    if (NotificationAPI === undefined) {
        // act like notifications are blocked if they do not have access to
        // the notification API.
        return "denied";
    }
    return NotificationAPI.permission;
}

let unread_count = 0;
let pm_count = 0;

function redraw_title() {
    // Update window title to reflect unread messages in current view
    const new_title =
        (unread_count ? "(" + unread_count + ") " : "") +
        _narrow__WEBPACK_IMPORTED_MODULE_9__.narrow_title +
        " - " +
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
        " - " +
        "Zulip";

    document.title = new_title;
}

function update_unread_counts(new_unread_count, new_pm_count) {
    if (new_unread_count === unread_count && new_pm_count === pm_count) {
        return;
    }

    unread_count = new_unread_count;
    pm_count = new_pm_count;

    // Indicate the message count in the favicon
    _favicon__WEBPACK_IMPORTED_MODULE_5__.update_favicon(unread_count, pm_count);

    // Notify the current desktop app's UI about the new unread count.
    if (window.electron_bridge !== undefined) {
        window.electron_bridge.send_event("total_unread_count", unread_count);
    }

    // TODO: Add a `window.electron_bridge.updatePMCount(new_pm_count);` call?

    redraw_title();
}

function is_window_focused() {
    return window_focused;
}

function notify_above_composebox(
    note,
    link_class,
    above_composebox_narrow_url,
    link_msg_id,
    link_text,
) {
    const $notification = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        _templates_compose_banner_message_sent_banner_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
            note,
            link_class,
            above_composebox_narrow_url,
            link_msg_id,
            link_text,
        }),
    );
    clear_compose_notifications();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").append($notification);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").show();
}

if (window.electron_bridge !== undefined) {
    // The code below is for sending a message received from notification reply which
    // is often referred to as inline reply feature. This is done so desktop app doesn't
    // have to depend on channel.post for setting crsf_token and narrow.by_topic
    // to narrow to the message being sent.
    if (window.electron_bridge.set_send_notification_reply_message_supported !== undefined) {
        window.electron_bridge.set_send_notification_reply_message_supported(true);
    }
    window.electron_bridge.on_event("send_notification_reply_message", (message_id, reply) => {
        const message = _message_store__WEBPACK_IMPORTED_MODULE_8__.get(message_id);
        const data = {
            type: message.type,
            content: reply,
            to: message.type === "private" ? message.reply_to : message.stream,
            topic: message.topic,
        };

        function success() {
            if (message.type === "stream") {
                _narrow__WEBPACK_IMPORTED_MODULE_9__.by_topic(message_id, {trigger: "desktop_notification_reply"});
            } else {
                _narrow__WEBPACK_IMPORTED_MODULE_9__.by_recipient(message_id, {trigger: "desktop_notification_reply"});
            }
        }

        function error(error) {
            window.electron_bridge.send_event("send_notification_reply_message_failed", {
                data,
                message_id,
                error,
            });
        }

        _channel__WEBPACK_IMPORTED_MODULE_4__.post({
            url: "/json/messages",
            data,
            success,
            error,
        });
    });
}

function process_notification(notification) {
    let i;
    let notification_object;
    let key;
    let content;
    let other_recipients;
    const message = notification.message;
    let title = message.sender_full_name;
    let msg_count = 1;
    let notification_source;
    // Convert the content to plain text, replacing emoji with their alt text
    const $content = jquery__WEBPACK_IMPORTED_MODULE_0___default()("<div>").html(message.content);
    _ui__WEBPACK_IMPORTED_MODULE_15__.replace_emoji_with_text($content);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './spoilers'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($content);
    content = $content.text();

    const topic = message.topic;

    if (message.is_me_message) {
        content = message.sender_full_name + content.slice(3);
    }

    if (message.type === "private" || message.type === "test-notification") {
        if (
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== undefined &&
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
        ) {
            content = "New private message from " + message.sender_full_name;
        }
        key = message.display_reply_to;
        // Remove the sender from the list of other recipients
        other_recipients = `, ${message.display_reply_to}, `
            .replace(`, ${message.sender_full_name}, `, ", ")
            .slice(", ".length, -", ".length);
        notification_source = "pm";
    } else {
        key = message.sender_full_name + " to " + message.stream + " > " + topic;
        if (message.mentioned) {
            notification_source = "mention";
        } else if (message.alerted) {
            notification_source = "alert";
        } else {
            notification_source = "stream";
        }
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Desktop notification from source " + notification_source);

    if (content.length > 150) {
        // Truncate content at a word boundary
        for (i = 150; i > 0; i -= 1) {
            if (content[i] === " ") {
                break;
            }
        }
        content = content.slice(0, i);
        content += " [...]";
    }

    if (notice_memory.has(key)) {
        msg_count = notice_memory.get(key).msg_count + 1;
        title = msg_count + " messages from " + title;
        notification_object = notice_memory.get(key).obj;
        notification_object.close();
    }

    if (message.type === "private") {
        if (message.display_recipient.length > 2) {
            // If the message has too many recipients to list them all...
            if (content.length + title.length + other_recipients.length > 230) {
                // Then count how many people are in the conversation and summarize
                // by saying the conversation is with "you and [number] other people"
                other_recipients = other_recipients.replace(/[^,]/g, "").length + " other people";
            }

            title += " (to you and " + other_recipients + ")";
        } else {
            title += " (to you)";
        }
    }

    if (message.type === "stream") {
        title += " (to " + message.stream + " > " + topic + ")";
    }

    if (notification.desktop_notify) {
        const icon_url = _people__WEBPACK_IMPORTED_MODULE_12__.small_avatar_url(message);
        notification_object = new NotificationAPI(title, {
            icon: icon_url,
            body: content,
            tag: message.id,
        });
        notice_memory.set(key, {
            obj: notification_object,
            msg_count,
            message_id: message.id,
        });

        if (typeof notification_object.addEventListener === "function") {
            // Sadly, some third-party Electron apps like Franz/Ferdi
            // misimplement the Notification API not inheriting from
            // EventTarget.  This results in addEventListener being
            // unavailable for them.
            notification_object.addEventListener("click", () => {
                notification_object.close();
                if (message.type !== "test-notification") {
                    _narrow__WEBPACK_IMPORTED_MODULE_9__.by_topic(message.id, {trigger: "notification"});
                }
                window.focus();
            });
            notification_object.addEventListener("close", () => {
                notice_memory.delete(key);
            });
        }
    }
}

function close_notification(message) {
    for (const [key, notice_mem_entry] of notice_memory) {
        if (notice_mem_entry.message_id === message.id) {
            notice_mem_entry.obj.close();
            notice_memory.delete(key);
        }
    }
}

function message_is_notifiable(message) {
    // Independent of the user's notification settings, are there
    // properties of the message that unconditionally mean we
    // shouldn't notify about it.

    if (message.sent_by_me) {
        return false;
    }

    // If a message is edited multiple times, we want to err on the side of
    // not spamming notifications.
    if (message.notification_sent) {
        return false;
    }

    // @-<username> mentions take precedence over muted-ness. Note
    // that @all mentions are still suppressed by muting.
    if (message.mentioned_me_directly) {
        return true;
    }

    // Messages to muted streams that don't mention us specifically
    // are not notifiable.
    if (message.type === "stream" && _stream_data__WEBPACK_IMPORTED_MODULE_13__.is_muted(message.stream_id)) {
        return false;
    }

    if (message.type === "stream" && _user_topics__WEBPACK_IMPORTED_MODULE_18__.is_topic_muted(message.stream_id, message.topic)) {
        return false;
    }

    // Everything else is on the table; next filter based on notification
    // settings.
    return true;
}

function should_send_desktop_notification(message) {
    // Always notify for testing notifications.
    if (message.type === "test-notification") {
        return true;
    }

    // For streams, send if desktop notifications are enabled for all
    // message on this stream.
    if (
        message.type === "stream" &&
        _stream_data__WEBPACK_IMPORTED_MODULE_13__.receives_notifications(message.stream_id, "desktop_notifications")
    ) {
        return true;
    }

    // enable_desktop_notifications determines whether we pop up a
    // notification for PMs/mentions/alerts
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    // And then we need to check if the message is a PM, mention,
    // wildcard mention with wildcard_mentions_notify, or alert.
    if (message.type === "private") {
        return true;
    }

    if (_alert_words__WEBPACK_IMPORTED_MODULE_2__.notifies(message)) {
        return true;
    }

    if (message.mentioned_me_directly) {
        return true;
    }

    // wildcard mentions
    if (
        message.mentioned &&
        _stream_data__WEBPACK_IMPORTED_MODULE_13__.receives_notifications(message.stream_id, "wildcard_mentions_notify")
    ) {
        return true;
    }

    return false;
}

function should_send_audible_notification(message) {
    // If `None` is selected as the notification sound, never send
    // audible notifications regardless of other configuration.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "none") {
        return false;
    }

    // For streams, ding if sounds are enabled for all messages on
    // this stream.
    if (
        message.type === "stream" &&
        _stream_data__WEBPACK_IMPORTED_MODULE_13__.receives_notifications(message.stream_id, "audible_notifications")
    ) {
        return true;
    }

    // enable_sounds determines whether we ding for PMs/mentions/alerts
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    // And then we need to check if the message is a PM, mention,
    // wildcard mention with wildcard_mentions_notify, or alert.
    if (message.type === "private" || message.type === "test-notification") {
        return true;
    }

    if (_alert_words__WEBPACK_IMPORTED_MODULE_2__.notifies(message)) {
        return true;
    }

    if (message.mentioned_me_directly) {
        return true;
    }

    // wildcard mentions
    if (
        message.mentioned &&
        _stream_data__WEBPACK_IMPORTED_MODULE_13__.receives_notifications(message.stream_id, "wildcard_mentions_notify")
    ) {
        return true;
    }

    return false;
}

function granted_desktop_notifications_permission() {
    return NotificationAPI && NotificationAPI.permission === "granted";
}

function request_desktop_notifications_permission() {
    if (NotificationAPI) {
        NotificationAPI.requestPermission();
    }
}

function received_messages(messages) {
    for (const message of messages) {
        if (!message_is_notifiable(message)) {
            continue;
        }
        if (!_unread__WEBPACK_IMPORTED_MODULE_16__.message_unread(message)) {
            // The message is already read; Zulip is currently in focus.
            continue;
        }

        message.notification_sent = true;

        if (should_send_desktop_notification(message)) {
            process_notification({
                message,
                desktop_notify: granted_desktop_notifications_permission(),
            });
        }
        if (should_send_audible_notification(message)) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-notification-sound-audio")[0].play();
        }
    }
}

function send_test_notification(content) {
    received_messages([
        {
            id: Math.random(),
            type: "test-notification",
            sender_email: "notification-bot@zulip.com",
            sender_full_name: "Notification Bot",
            display_reply_to: "Notification Bot",
            content,
            unread: true,
        },
    ]);
}

// Note that this returns values that are not HTML-escaped, for use in
// Handlebars templates that will do further escaping.
function get_message_header(message) {
    if (message.type === "stream") {
        return `#${message.stream} > ${message.topic}`;
    }
    if (message.display_recipient.length > 2) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "group private messages with {recipient}"},
            {recipient: message.display_reply_to},
        );
    }
    if (_people__WEBPACK_IMPORTED_MODULE_12__.is_current_user(message.reply_to)) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "private messages with yourself"});
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {defaultMessage: "private messages with {recipient}"},
        {recipient: message.display_reply_to},
    );
}

function get_local_notify_mix_reason(message) {
    const $row = _message_lists__WEBPACK_IMPORTED_MODULE_7__.current.get_row(message.id);
    if ($row.length > 0) {
        // If our message is in the current message list, we do
        // not have a mix, so we are happy.
        return undefined;
    }

    if (message.type === "stream" && _user_topics__WEBPACK_IMPORTED_MODULE_18__.is_topic_muted(message.stream_id, message.topic)) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent! Your message was sent to a topic you have muted."});
    }

    if (message.type === "stream" && _stream_data__WEBPACK_IMPORTED_MODULE_13__.is_muted(message.stream_id)) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent! Your message was sent to a stream you have muted."});
    }

    // offscreen because it is outside narrow
    // we can only look for these on non-search (can_apply_locally) messages
    // see also: exports.notify_messages_outside_current_search
    const current_filter = _narrow_state__WEBPACK_IMPORTED_MODULE_10__.filter();
    if (
        current_filter &&
        current_filter.can_apply_locally() &&
        !current_filter.predicate()(message)
    ) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent! Your message is outside your current narrow."});
    }

    return undefined;
}

function notify_local_mixes(messages, need_user_to_scroll) {
    /*
        This code should only be called when we are displaying
        messages sent by current client. It notifies users that
        their messages aren't actually in the view that they
        composed to.

        This code is called after we insert messages into our
        message list widgets. All of the conditions here are
        checkable locally, so we may want to execute this code
        earlier in the codepath at some point and possibly punt
        on local rendering.

        Possible cleanup: Arguably, we should call this function
        unconditionally and just check if message.local_id is in
        sent_messages.messages here.
    */

    for (const message of messages) {
        if (!_people__WEBPACK_IMPORTED_MODULE_12__.is_my_user_id(message.sender_id)) {
            // This can happen if the client is offline for a while
            // around the time this client sends a message; see the
            // caller of message_events.insert_new_messages.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Slightly unexpected: A message not sent by us batches with those that were.",
            );
            continue;
        }

        let reason = get_local_notify_mix_reason(message);

        const above_composebox_narrow_url = get_above_composebox_narrow_url(message);

        if (!reason) {
            if (need_user_to_scroll) {
                reason = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent! Scroll down to view your message."});
                notify_above_composebox(reason, "", above_composebox_narrow_url, null, "");
                setTimeout(() => {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").hide();
                }, 3000);
            }

            // This is the HAPPY PATH--for most messages we do nothing
            // other than maybe sending the above message.
            continue;
        }

        const link_msg_id = message.id;
        const link_class = "compose_notification_narrow_by_topic";
        const link_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "Narrow to {message_recipient}"},
            {message_recipient: get_message_header(message)},
        );

        notify_above_composebox(
            reason,
            link_class,
            above_composebox_narrow_url,
            link_msg_id,
            link_text,
        );
    }
}

function get_above_composebox_narrow_url(message) {
    let above_composebox_narrow_url;
    if (message.type === "stream") {
        above_composebox_narrow_url = _hash_util__WEBPACK_IMPORTED_MODULE_6__.by_stream_topic_url(
            message.stream_id,
            message.topic,
        );
    } else {
        above_composebox_narrow_url = message.pm_with_url;
    }
    return above_composebox_narrow_url;
}

// for callback when we have to check with the server if a message should be in
// the message_lists.current (!can_apply_locally; a.k.a. "a search").
function notify_messages_outside_current_search(messages) {
    for (const message of messages) {
        if (!_people__WEBPACK_IMPORTED_MODULE_12__.is_current_user(message.sender_email)) {
            continue;
        }
        const above_composebox_narrow_url = get_above_composebox_narrow_url(message);
        const link_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "Narrow to {message_recipient}"},
            {message_recipient: get_message_header(message)},
        );
        notify_above_composebox(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent! Your recent message is outside the current search."}),
            "compose_notification_narrow_by_topic",
            above_composebox_narrow_url,
            message.id,
            link_text,
        );
    }
}

function clear_compose_notifications() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").empty();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").stop(true, true);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").hide();
}

function reify_message_id(opts) {
    const old_id = opts.old_id;
    const new_id = opts.new_id;

    // If a message ID that we're currently storing (as a link) has changed,
    // update that link as well
    for (const e of jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification a")) {
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e);
        const message_id = $elem.data("message-id");

        if (message_id === old_id) {
            $elem.data("message-id", new_id);
        }
    }
}

function register_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").on("click", ".compose_notification_narrow_by_topic", (e) => {
        const message_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).data("message-id");
        _narrow__WEBPACK_IMPORTED_MODULE_9__.by_topic(message_id, {trigger: "compose_notification"});
        e.stopPropagation();
        e.preventDefault();
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").on("click", ".compose_notification_scroll_to_message", (e) => {
        const message_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).data("message-id");
        _message_lists__WEBPACK_IMPORTED_MODULE_7__.current.select_id(message_id);
        _navigate__WEBPACK_IMPORTED_MODULE_11__.scroll_to_selected();
        e.stopPropagation();
        e.preventDefault();
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#out-of-view-notification").on("click", ".out-of-view-notification-close", (e) => {
        clear_compose_notifications();
        e.stopPropagation();
        e.preventDefault();
    });
}

function handle_global_notification_updates(notification_name, setting) {
    // Update the global settings checked when determining if we should notify
    // for a given message. These settings do not affect whether or not a
    // particular stream should receive notifications.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(notification_name)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[notification_name] = setting;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(notification_name)) {
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_14__.update_notification_setting_checkbox(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[notification_name],
        );
    }

    if (notification_name === "notification_sound") {
        // Change the sound source with the new page `notification_sound`.
        update_notification_sound_source(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-notification-sound-audio"), Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    }
}


/***/ }),

/***/ "./static/js/overlays.js":
/*!*******************************!*\
  !*** ./static/js/overlays.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "active_modal": () => (/* binding */ active_modal),
/* harmony export */   "close_active": () => (/* binding */ close_active),
/* harmony export */   "close_active_modal": () => (/* binding */ close_active_modal),
/* harmony export */   "close_for_hash_change": () => (/* binding */ close_for_hash_change),
/* harmony export */   "close_modal": () => (/* binding */ close_modal),
/* harmony export */   "close_overlay": () => (/* binding */ close_overlay),
/* harmony export */   "drafts_open": () => (/* binding */ drafts_open),
/* harmony export */   "info_overlay_open": () => (/* binding */ info_overlay_open),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_active": () => (/* binding */ is_active),
/* harmony export */   "is_modal_open": () => (/* binding */ is_modal_open),
/* harmony export */   "is_overlay_or_modal_open": () => (/* binding */ is_overlay_or_modal_open),
/* harmony export */   "lightbox_open": () => (/* binding */ lightbox_open),
/* harmony export */   "open_modal": () => (/* binding */ open_modal),
/* harmony export */   "open_overlay": () => (/* binding */ open_overlay),
/* harmony export */   "open_settings": () => (/* binding */ open_settings),
/* harmony export */   "settings_open": () => (/* binding */ settings_open),
/* harmony export */   "streams_open": () => (/* binding */ streams_open)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var micromodal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! micromodal */ "./node_modules/micromodal/dist/micromodal.es.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");







let $active_overlay;
let close_handler;
let open_overlay_name;

function reset_state() {
    $active_overlay = undefined;
    close_handler = undefined;
    open_overlay_name = undefined;
}

function is_active() {
    return Boolean(open_overlay_name);
}

function is_modal_open() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".micromodal").hasClass("modal--open");
}

function is_overlay_or_modal_open() {
    return is_active() || is_modal_open();
}

function info_overlay_open() {
    return open_overlay_name === "informationalOverlays";
}

function settings_open() {
    return open_overlay_name === "settings";
}

function streams_open() {
    return open_overlay_name === "subscriptions";
}

function lightbox_open() {
    return open_overlay_name === "lightbox";
}

function drafts_open() {
    return open_overlay_name === "drafts";
}

function active_modal() {
    if (!is_modal_open()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Programming error — Called active_modal when there is no modal open");
        return undefined;
    }

    const $micromodal = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".micromodal.modal--open");
    return `#${CSS.escape($micromodal.attr("id"))}`;
}

function open_overlay(opts) {
    _popovers__WEBPACK_IMPORTED_MODULE_4__.hide_all();

    if (!opts.name || !opts.$overlay || !opts.on_close) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Programming error in open_overlay");
        return;
    }

    if ($active_overlay || open_overlay_name || close_handler) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Programming error — trying to open " +
                opts.name +
                " before closing " +
                open_overlay_name,
        );
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("open overlay: " + opts.name);

    // Our overlays are kind of crufty...we have an HTML id
    // attribute for them and then a data-overlay attribute for
    // them.  Make sure they match.
    if (opts.$overlay.attr("data-overlay") !== opts.name) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Bad overlay setup for " + opts.name);
        return;
    }

    open_overlay_name = opts.name;
    $active_overlay = opts.$overlay;
    opts.$overlay.addClass("show");

    opts.$overlay.attr("aria-hidden", "false");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app").attr("aria-hidden", "true");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".fixed-app").attr("aria-hidden", "true");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").attr("aria-hidden", "true");

    close_handler = function () {
        opts.on_close();
        reset_state();
    };
}

// If conf.autoremove is true, the modal element will be removed from the DOM
// once the modal is hidden.
// conf also accepts the following optional properties:
// on_show: Callback to run when the modal is triggered to show.
// on_shown: Callback to run when the modal is shown.
// on_hide: Callback to run when the modal is triggered to hide.
// on_hidden: Callback to run when the modal is hidden.
function open_modal(selector, conf = {}) {
    if (selector === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined selector was passed into open_modal");
        return;
    }

    // Don't accept hash-based selector to enforce modals to have unique ids and
    // since micromodal doesn't accept hash based selectors.
    if (selector[0] === "#") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("hash-based selector passed in to open_modal: " + selector);
        return;
    }

    if (is_modal_open()) {
        /*
          Our modal system doesn't directly support opening a modal
          when one is already open, because the `is_modal_open` CSS
          class doesn't update until Micromodal has finished its
          animations, which can take 100ms or more.

          We can likely fix that, but in the meantime, we should
          handle this situation correctly, by closing the current
          modal, waiting for it to finish closing, and then attempting
          to open the current modal again.
        */
        if (!conf.recursive_call_count) {
            conf.recursive_call_count = 1;
        } else {
            conf.recursive_call_count += 1;
        }
        if (conf.recursive_call_count > 50) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Modal incorrectly is still open: " + selector);
            return;
        }

        close_active_modal();
        setTimeout(() => {
            open_modal(selector, conf);
        }, 10);
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("open modal: " + selector);

    // Micromodal gets elements using the getElementById DOM function
    // which doesn't require the hash. We add it manually here.
    const id_selector = `#${selector}`;
    const $micromodal = jquery__WEBPACK_IMPORTED_MODULE_0___default()(id_selector);

    $micromodal.find(".modal__container").on("animationend", (event) => {
        const animation_name = event.originalEvent.animationName;
        if (animation_name === "mmfadeIn") {
            // Micromodal adds the is-open class before the modal animation
            // is complete, which isn't really helpful since a modal is open after the
            // animation is complete. So, we manually add a class after the
            // animation is complete.
            $micromodal.addClass("modal--open");
            $micromodal.removeClass("modal--opening");

            if (conf.on_shown) {
                conf.on_shown();
            }
        } else if (animation_name === "mmfadeOut") {
            // Call the on_hidden callback after the modal finishes hiding.

            $micromodal.removeClass("modal--open");
            if (conf.autoremove) {
                $micromodal.remove();
            }
            if (conf.on_hidden) {
                conf.on_hidden();
            }
        }
    });

    $micromodal.find(".modal__overlay").on("click", (e) => {
        /* Micromodal's data-micromodal-close feature doesn't check for
           range selections; this means dragging a selection of text in an
           input inside the modal too far will weirdly close the modal.
           See https://github.com/ghosh/Micromodal/issues/505.
           Work around this with our own implementation. */
        if (!jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(".modal__overlay")) {
            return;
        }

        if (document.getSelection().type === "Range") {
            return;
        }
        close_modal(selector);
    });

    micromodal__WEBPACK_IMPORTED_MODULE_1__["default"].show(selector, {
        disableFocus: true,
        openClass: "modal--opening",
        onShow: conf?.on_show,
        onClose: conf?.on_hide,
    });
}

function close_overlay(name) {
    _popovers__WEBPACK_IMPORTED_MODULE_4__.hide_all();

    if (name !== open_overlay_name) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to close " + name + " when " + open_overlay_name + " is open.");
        return;
    }

    if (name === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined name was passed into close_overlay");
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("close overlay: " + name);

    $active_overlay.removeClass("show");

    $active_overlay.attr("aria-hidden", "true");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app").attr("aria-hidden", "false");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".fixed-app").attr("aria-hidden", "false");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").attr("aria-hidden", "false");

    if (!close_handler) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Overlay close handler for " + name + " not properly set up.");
        return;
    }

    close_handler();
}

function close_active() {
    if (!open_overlay_name) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("close_active() called without checking is_active()");
        return;
    }

    close_overlay(open_overlay_name);
}

// `conf` is an object with the following optional properties:
// * on_hidden: Callback to run when the modal finishes hiding.
function close_modal(selector, conf = {}) {
    if (selector === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined selector was passed into close_modal");
        return;
    }

    if (!is_modal_open()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("close_active_modal() called without checking is_modal_open()");
        return;
    }

    if (active_modal() !== `#${selector}`) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Trying to close " + selector + " modal when " + active_modal() + " is open.",
        );
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("close modal: " + selector);

    const id_selector = `#${selector}`;
    const $micromodal = jquery__WEBPACK_IMPORTED_MODULE_0___default()(id_selector);

    // On-hidden hooks should typically be registered in
    // overlays.open_modal.  However, we offer this alternative
    // mechanism as a convenience for hooks only known when
    // closing the modal.
    $micromodal.find(".modal__container").on("animationend", (event) => {
        const animation_name = event.originalEvent.animationName;
        if (animation_name === "mmfadeOut" && conf.on_hidden) {
            conf.on_hidden();
        }
    });

    micromodal__WEBPACK_IMPORTED_MODULE_1__["default"].close(selector);
}

function close_active_modal() {
    if (!is_modal_open()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("close_active_modal() called without checking is_modal_open()");
        return;
    }

    const $micromodal = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".micromodal.modal--open");
    micromodal__WEBPACK_IMPORTED_MODULE_1__["default"].close(`${CSS.escape($micromodal.attr("id"))}`);
}

function close_for_hash_change() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("div.overlay.show").removeClass("show");
    if ($active_overlay) {
        close_handler();
    }
}

function open_settings() {
    open_overlay({
        name: "settings",
        $overlay: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container"),
        on_close() {
            _browser_history__WEBPACK_IMPORTED_MODULE_3__.exit_overlay();
        },
    });
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "div.overlay, div.overlay .exit", (e) => {
        let $target = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target);

        if (document.getSelection().type === "Range") {
            return;
        }

        // if the target is not the div.overlay element, search up the node tree
        // until it is found.
        if ($target.is(".exit, .exit-sign, .overlay-content, .exit span")) {
            $target = $target.closest("[data-overlay]");
        } else if (!$target.is("div.overlay")) {
            // not a valid click target then.
            return;
        }

        if ($target.data("noclose")) {
            // This overlay has been marked explicitly to not be closed.
            return;
        }

        const target_name = $target.attr("data-overlay");

        close_overlay(target_name);

        e.preventDefault();
        e.stopPropagation();
    });
}


/***/ }),

/***/ "./static/js/peer_data.js":
/*!********************************!*\
  !*** ./static/js/peer_data.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_subscriber": () => (/* binding */ add_subscriber),
/* harmony export */   "bulk_add_subscribers": () => (/* binding */ bulk_add_subscribers),
/* harmony export */   "bulk_remove_subscribers": () => (/* binding */ bulk_remove_subscribers),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "get_subscriber_count": () => (/* binding */ get_subscriber_count),
/* harmony export */   "get_subscribers": () => (/* binding */ get_subscribers),
/* harmony export */   "is_subscriber_subset": () => (/* binding */ is_subscriber_subset),
/* harmony export */   "is_user_subscribed": () => (/* binding */ is_user_subscribed),
/* harmony export */   "potential_subscribers": () => (/* binding */ potential_subscribers),
/* harmony export */   "remove_subscriber": () => (/* binding */ remove_subscriber),
/* harmony export */   "set_subscribers": () => (/* binding */ set_subscribers)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './lazy_set'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());





// This maps a stream_id to a LazySet of user_ids who are subscribed.
const stream_subscribers = new Map();

function clear_for_testing() {
    stream_subscribers.clear();
}

function assert_number(id) {
    if (typeof id !== "number") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`You must pass ids as numbers to peer_data. id = ${id}`);
    }
}

function get_user_set(stream_id) {
    // This is an internal function to get the LazySet of users.
    // We create one on the fly as necessary, but we warn in that case.
    assert_number(stream_id);

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We called get_user_set for an untracked stream: " + stream_id);
    }

    let subscribers = stream_subscribers.get(stream_id);

    if (subscribers === undefined) {
        subscribers = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './lazy_set'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())([]);
        stream_subscribers.set(stream_id, subscribers);
    }

    return subscribers;
}

function is_subscriber_subset(stream_id1, stream_id2) {
    const sub1_set = get_user_set(stream_id1);
    const sub2_set = get_user_set(stream_id2);

    return Array.from(sub1_set.keys()).every((key) => sub2_set.has(key));
}

function potential_subscribers(stream_id) {
    /*
        This is a list of unsubscribed users
        for the current stream, who the current
        user could potentially subscribe to the
        stream.  This may include some bots.

        We currently use it for typeahead in
        stream_edit.js.

        This may be a superset of the actual
        subscribers that you can change in some cases
        (like if you're a guest?); we should refine this
        going forward, especially if we use it for something
        other than typeahead.  (The guest use case
        may be moot now for other reasons.)
    */

    const subscribers = get_user_set(stream_id);

    function is_potential_subscriber(person) {
        // Use verbose style to force better test
        // coverage, plus we may add more conditions over
        // time.
        if (subscribers.has(person.user_id)) {
            return false;
        }

        return true;
    }

    return _people__WEBPACK_IMPORTED_MODULE_1__.filter_all_users(is_potential_subscriber);
}

function get_subscriber_count(stream_id) {
    const subscribers = get_user_set(stream_id);
    return subscribers.size;
}

function get_subscribers(stream_id) {
    // This is our external interface for callers who just
    // want an array of user_ids who are subscribed to a stream.
    const subscribers = get_user_set(stream_id);

    return Array.from(subscribers.keys());
}

function set_subscribers(stream_id, user_ids) {
    const subscribers = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './lazy_set'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_ids || []);
    stream_subscribers.set(stream_id, subscribers);
}

function add_subscriber(stream_id, user_id) {
    // If stream_id/user_id are unknown to us, we will
    // still track it, but we will warn.
    const subscribers = get_user_set(stream_id);
    const person = _people__WEBPACK_IMPORTED_MODULE_1__.get_by_user_id(user_id);
    if (person === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We tried to add invalid subscriber: " + user_id);
    }
    subscribers.add(user_id);
}

function remove_subscriber(stream_id, user_id) {
    const subscribers = get_user_set(stream_id);
    if (!subscribers.has(user_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We tried to remove invalid subscriber: " + user_id);
        return false;
    }

    subscribers.delete(user_id);

    return true;
}

function bulk_add_subscribers({stream_ids, user_ids}) {
    // We rely on our callers to validate stream_ids and user_ids.
    for (const stream_id of stream_ids) {
        const subscribers = get_user_set(stream_id);
        for (const user_id of user_ids) {
            subscribers.add(user_id);
        }
    }
}

function bulk_remove_subscribers({stream_ids, user_ids}) {
    // We rely on our callers to validate stream_ids and user_ids.
    for (const stream_id of stream_ids) {
        const subscribers = get_user_set(stream_id);
        for (const user_id of user_ids) {
            subscribers.delete(user_id);
        }
    }
}

function is_user_subscribed(stream_id, user_id) {
    // Most callers should call stream_data.is_user_subscribed,
    // which does additional checks.

    const subscribers = get_user_set(stream_id);
    return subscribers.has(user_id);
}


/***/ }),

/***/ "./static/js/people.js":
/*!*****************************!*\
  !*** ./static/js/people.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_add_user": () => (/* binding */ _add_user),
/* harmony export */   "add_active_user": () => (/* binding */ add_active_user),
/* harmony export */   "add_cross_realm_user": () => (/* binding */ add_cross_realm_user),
/* harmony export */   "all_user_ids_in_pm": () => (/* binding */ all_user_ids_in_pm),
/* harmony export */   "build_person_matcher": () => (/* binding */ build_person_matcher),
/* harmony export */   "build_termlet_matcher": () => (/* binding */ build_termlet_matcher),
/* harmony export */   "can_admin_user": () => (/* binding */ can_admin_user),
/* harmony export */   "clear_recipient_counts_for_testing": () => (/* binding */ clear_recipient_counts_for_testing),
/* harmony export */   "compare_by_name": () => (/* binding */ compare_by_name),
/* harmony export */   "concat_huddle": () => (/* binding */ concat_huddle),
/* harmony export */   "deactivate": () => (/* binding */ deactivate),
/* harmony export */   "email_list_to_user_ids_string": () => (/* binding */ email_list_to_user_ids_string),
/* harmony export */   "emails_strings_to_user_ids_array": () => (/* binding */ emails_strings_to_user_ids_array),
/* harmony export */   "emails_strings_to_user_ids_string": () => (/* binding */ emails_strings_to_user_ids_string),
/* harmony export */   "emails_to_full_names_string": () => (/* binding */ emails_to_full_names_string),
/* harmony export */   "emails_to_slug": () => (/* binding */ emails_to_slug),
/* harmony export */   "exclude_me_from_string": () => (/* binding */ exclude_me_from_string),
/* harmony export */   "extract_people_from_message": () => (/* binding */ extract_people_from_message),
/* harmony export */   "filter_all_persons": () => (/* binding */ filter_all_persons),
/* harmony export */   "filter_all_users": () => (/* binding */ filter_all_users),
/* harmony export */   "filter_for_user_settings_search": () => (/* binding */ filter_for_user_settings_search),
/* harmony export */   "filter_people_by_search_terms": () => (/* binding */ filter_people_by_search_terms),
/* harmony export */   "format_small_avatar_url": () => (/* binding */ format_small_avatar_url),
/* harmony export */   "get_active_human_count": () => (/* binding */ get_active_human_count),
/* harmony export */   "get_active_human_ids": () => (/* binding */ get_active_human_ids),
/* harmony export */   "get_active_message_people": () => (/* binding */ get_active_message_people),
/* harmony export */   "get_active_user_ids": () => (/* binding */ get_active_user_ids),
/* harmony export */   "get_actual_name_from_user_id": () => (/* binding */ get_actual_name_from_user_id),
/* harmony export */   "get_bot_owner_user": () => (/* binding */ get_bot_owner_user),
/* harmony export */   "get_by_email": () => (/* binding */ get_by_email),
/* harmony export */   "get_by_user_id": () => (/* binding */ get_by_user_id),
/* harmony export */   "get_custom_profile_data": () => (/* binding */ get_custom_profile_data),
/* harmony export */   "get_display_full_names": () => (/* binding */ get_display_full_names),
/* harmony export */   "get_full_name": () => (/* binding */ get_full_name),
/* harmony export */   "get_full_names_for_poll_option": () => (/* binding */ get_full_names_for_poll_option),
/* harmony export */   "get_mention_syntax": () => (/* binding */ get_mention_syntax),
/* harmony export */   "get_message_people": () => (/* binding */ get_message_people),
/* harmony export */   "get_non_active_human_ids": () => (/* binding */ get_non_active_human_ids),
/* harmony export */   "get_non_active_realm_users": () => (/* binding */ get_non_active_realm_users),
/* harmony export */   "get_people_for_search_bar": () => (/* binding */ get_people_for_search_bar),
/* harmony export */   "get_realm_users": () => (/* binding */ get_realm_users),
/* harmony export */   "get_recipient_count": () => (/* binding */ get_recipient_count),
/* harmony export */   "get_recipients": () => (/* binding */ get_recipients),
/* harmony export */   "get_user_id": () => (/* binding */ get_user_id),
/* harmony export */   "get_user_id_from_name": () => (/* binding */ get_user_id_from_name),
/* harmony export */   "get_user_time": () => (/* binding */ get_user_time),
/* harmony export */   "get_user_time_preferences": () => (/* binding */ get_user_time_preferences),
/* harmony export */   "get_user_type": () => (/* binding */ get_user_type),
/* harmony export */   "get_users_from_ids": () => (/* binding */ get_users_from_ids),
/* harmony export */   "get_visible_email": () => (/* binding */ get_visible_email),
/* harmony export */   "group_pm_with_user_ids": () => (/* binding */ group_pm_with_user_ids),
/* harmony export */   "huddle_string": () => (/* binding */ huddle_string),
/* harmony export */   "id_matches_email_operand": () => (/* binding */ id_matches_email_operand),
/* harmony export */   "incr_recipient_count": () => (/* binding */ incr_recipient_count),
/* harmony export */   "init": () => (/* binding */ init),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initialize_current_user": () => (/* binding */ initialize_current_user),
/* harmony export */   "is_active_user_for_popover": () => (/* binding */ is_active_user_for_popover),
/* harmony export */   "is_cross_realm_email": () => (/* binding */ is_cross_realm_email),
/* harmony export */   "is_current_user": () => (/* binding */ is_current_user),
/* harmony export */   "is_duplicate_full_name": () => (/* binding */ is_duplicate_full_name),
/* harmony export */   "is_known_user": () => (/* binding */ is_known_user),
/* harmony export */   "is_known_user_id": () => (/* binding */ is_known_user_id),
/* harmony export */   "is_my_user_id": () => (/* binding */ is_my_user_id),
/* harmony export */   "is_person_active": () => (/* binding */ is_person_active),
/* harmony export */   "is_valid_bulk_emails_for_compose": () => (/* binding */ is_valid_bulk_emails_for_compose),
/* harmony export */   "is_valid_email_for_compose": () => (/* binding */ is_valid_email_for_compose),
/* harmony export */   "is_valid_full_name_and_user_id": () => (/* binding */ is_valid_full_name_and_user_id),
/* harmony export */   "matches_user_settings_search": () => (/* binding */ matches_user_settings_search),
/* harmony export */   "maybe_incr_recipient_count": () => (/* binding */ maybe_incr_recipient_count),
/* harmony export */   "medium_avatar_url_for_person": () => (/* binding */ medium_avatar_url_for_person),
/* harmony export */   "my_current_email": () => (/* binding */ my_current_email),
/* harmony export */   "my_current_user_id": () => (/* binding */ my_current_user_id),
/* harmony export */   "my_custom_profile_data": () => (/* binding */ my_custom_profile_data),
/* harmony export */   "my_full_name": () => (/* binding */ my_full_name),
/* harmony export */   "pm_lookup_key": () => (/* binding */ pm_lookup_key),
/* harmony export */   "pm_lookup_key_from_user_ids": () => (/* binding */ pm_lookup_key_from_user_ids),
/* harmony export */   "pm_perma_link": () => (/* binding */ pm_perma_link),
/* harmony export */   "pm_reply_to": () => (/* binding */ pm_reply_to),
/* harmony export */   "pm_reply_user_string": () => (/* binding */ pm_reply_user_string),
/* harmony export */   "pm_with_operand_ids": () => (/* binding */ pm_with_operand_ids),
/* harmony export */   "pm_with_url": () => (/* binding */ pm_with_url),
/* harmony export */   "pm_with_user_ids": () => (/* binding */ pm_with_user_ids),
/* harmony export */   "reply_to_to_user_ids_string": () => (/* binding */ reply_to_to_user_ids_string),
/* harmony export */   "report_late_add": () => (/* binding */ report_late_add),
/* harmony export */   "sender_info_for_recent_topics_row": () => (/* binding */ sender_info_for_recent_topics_row),
/* harmony export */   "sender_is_bot": () => (/* binding */ sender_is_bot),
/* harmony export */   "sender_is_guest": () => (/* binding */ sender_is_guest),
/* harmony export */   "set_custom_profile_field_data": () => (/* binding */ set_custom_profile_field_data),
/* harmony export */   "set_full_name": () => (/* binding */ set_full_name),
/* harmony export */   "set_recipient_count_for_testing": () => (/* binding */ set_recipient_count_for_testing),
/* harmony export */   "slug_to_emails": () => (/* binding */ slug_to_emails),
/* harmony export */   "small_avatar_url": () => (/* binding */ small_avatar_url),
/* harmony export */   "small_avatar_url_for_person": () => (/* binding */ small_avatar_url_for_person),
/* harmony export */   "sort_but_pin_current_user_on_top": () => (/* binding */ sort_but_pin_current_user_on_top),
/* harmony export */   "track_duplicate_full_name": () => (/* binding */ track_duplicate_full_name),
/* harmony export */   "update_email": () => (/* binding */ update_email),
/* harmony export */   "update_email_in_reply_to": () => (/* binding */ update_email_in_reply_to),
/* harmony export */   "user_ids_string_to_emails_string": () => (/* binding */ user_ids_string_to_emails_string),
/* harmony export */   "user_ids_string_to_ids_array": () => (/* binding */ user_ids_string_to_ids_array),
/* harmony export */   "validate_user_ids": () => (/* binding */ validate_user_ids)
/* harmony export */ });
/* harmony import */ var blueimp_md5__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! blueimp-md5 */ "./node_modules/blueimp-md5/js/md5.js");
/* harmony import */ var blueimp_md5__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(blueimp_md5__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var date_fns_tz__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! date-fns-tz */ "./node_modules/date-fns-tz/index.js");
/* harmony import */ var date_fns_tz__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(date_fns_tz__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/js/typeahead */ "./static/shared/js/typeahead.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_user_ids'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















let people_dict;
let people_by_name_dict;
let people_by_user_id_dict;
let active_user_dict;
let non_active_user_dict;
let cross_realm_dict;
let pm_recipient_count_dict;
let duplicate_full_name_data;
let my_user_id;

// We have an init() function so that our automated tests
// can easily clear data.
function init() {
    // The following three dicts point to the same objects
    // (all people we've seen), but people_dict can have duplicate
    // keys related to email changes.  We want to deprecate
    // people_dict over time and always do lookups by user_id.
    people_dict = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    people_by_name_dict = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    people_by_user_id_dict = new Map();

    // The next dictionary includes all active users (human/user)
    // in our realm, but it excludes non-active users and
    // cross-realm bots.
    active_user_dict = new Map();
    non_active_user_dict = new Map();
    cross_realm_dict = new Map(); // keyed by user_id
    pm_recipient_count_dict = new Map();

    // This maintains a set of ids of people with same full names.
    duplicate_full_name_data = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
}

// WE INITIALIZE DATA STRUCTURES HERE!
init();

function split_to_ints(lst) {
    return lst.split(",").map((s) => Number.parseInt(s, 10));
}

function get_users_from_ids(user_ids) {
    return user_ids.map((user_id) => get_by_user_id(user_id));
}

function get_by_user_id(user_id, ignore_missing) {
    if (!people_by_user_id_dict.has(user_id) && !ignore_missing) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user_id in get_by_user_id: " + user_id);
        return undefined;
    }
    return people_by_user_id_dict.get(user_id);
}

function validate_user_ids(user_ids) {
    const good_ids = [];
    const bad_ids = [];

    for (const user_id of user_ids) {
        if (people_by_user_id_dict.has(user_id)) {
            good_ids.push(user_id);
        } else {
            bad_ids.push(user_id);
        }
    }

    if (bad_ids.length > 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`We have untracked user_ids: ${bad_ids}`);
    }

    return good_ids;
}

function get_by_email(email) {
    const person = people_dict.get(email);

    if (!person) {
        return undefined;
    }

    if (person.email.toLowerCase() !== email.toLowerCase()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Obsolete email passed to get_by_email: " + email + " new email = " + person.email,
        );
    }

    return person;
}

function get_bot_owner_user(user) {
    const owner_id = user.bot_owner_id;

    if (owner_id === undefined || owner_id === null) {
        // This is probably a cross-realm bot.
        return undefined;
    }

    return get_by_user_id(owner_id);
}

function can_admin_user(user) {
    return (
        (user.is_bot && user.bot_owner_id && user.bot_owner_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) ||
        is_my_user_id(user.user_id)
    );
}

function id_matches_email_operand(user_id, email) {
    const person = get_by_email(email);

    if (!person) {
        // The user may type bad data into the search bar, so
        // we don't complain too loud here.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("User email operand unknown: " + email);
        return false;
    }

    return person.user_id === user_id;
}

function update_email(user_id, new_email) {
    const person = people_by_user_id_dict.get(user_id);
    person.email = new_email;
    people_dict.set(new_email, person);

    // For legacy reasons we don't delete the old email
    // keys in our dictionaries, so that reverse lookups
    // still work correctly.
}

function get_visible_email(user) {
    if (user.delivery_email) {
        return user.delivery_email;
    }
    return user.email;
}

function get_user_id(email) {
    const person = get_by_email(email);
    if (person === undefined) {
        const error_msg = "Unknown email for get_user_id: " + email;
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error_msg);
        return undefined;
    }
    const user_id = person.user_id;
    if (!user_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("No user_id found for " + email);
        return undefined;
    }

    return user_id;
}

function is_known_user_id(user_id) {
    /*
    For certain low-stakes operations, such as emoji reactions,
    we may get a user_id that we don't know about, because the
    user may have been deactivated.  (We eventually want to track
    deactivated users on the client, but until then, this is an
    expedient thing we can check.)
    */
    return people_by_user_id_dict.has(user_id);
}

function is_known_user(user) {
    return user && is_known_user_id(user.user_id);
}

function sort_numerically(user_ids) {
    user_ids.sort((a, b) => a - b);

    return user_ids;
}

function huddle_string(message) {
    if (message.type !== "private") {
        return undefined;
    }

    let user_ids = message.display_recipient.map((recip) => recip.id);

    user_ids = user_ids.filter(
        (user_id) => user_id && people_by_user_id_dict.has(user_id) && !is_my_user_id(user_id),
    );

    if (user_ids.length <= 1) {
        return undefined;
    }

    user_ids = sort_numerically(user_ids);

    return user_ids.join(",");
}

function user_ids_string_to_emails_string(user_ids_string) {
    const user_ids = split_to_ints(user_ids_string);

    let emails = user_ids.map((user_id) => {
        const person = people_by_user_id_dict.get(user_id);
        return person && person.email;
    });

    if (!emails.every(Boolean)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user ids: " + user_ids_string);
        return undefined;
    }

    emails = emails.map((email) => email.toLowerCase());

    emails.sort();

    return emails.join(",");
}

function user_ids_string_to_ids_array(user_ids_string) {
    const user_ids = user_ids_string.split(",");
    const ids = user_ids.map(Number);
    return ids;
}

function emails_strings_to_user_ids_array(emails_string) {
    const user_ids_string = emails_strings_to_user_ids_string(emails_string);
    if (user_ids_string === undefined) {
        return undefined;
    }

    const user_ids_array = user_ids_string_to_ids_array(user_ids_string);
    return user_ids_array;
}

function reply_to_to_user_ids_string(emails_string) {
    // This is basically emails_strings_to_user_ids_string
    // without blueslip warnings, since it can be called with
    // invalid data.
    const emails = emails_string.split(",");

    let user_ids = emails.map((email) => {
        const person = get_by_email(email);
        return person && person.user_id;
    });

    if (!user_ids.every(Boolean)) {
        return undefined;
    }

    user_ids = sort_numerically(user_ids);

    return user_ids.join(",");
}

function emails_to_full_names_string(emails) {
    return emails
        .map((email) => {
            email = email.trim();
            const person = get_by_email(email);
            if (person !== undefined) {
                return person.full_name;
            }
            return email;
        })
        .join(", ");
}

function get_user_time_preferences(user_id) {
    const user_timezone = get_by_user_id(user_id).timezone;
    if (user_timezone) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_timezone);
    }
    return undefined;
}

function get_user_time(user_id) {
    const user_pref = get_user_time_preferences(user_id);
    if (user_pref) {
        const current_date = (0,date_fns_tz__WEBPACK_IMPORTED_MODULE_4__.utcToZonedTime)(new Date(), user_pref.timezone);
        // This could happen if the timezone is invalid.
        if (Number.isNaN(current_date.getTime())) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Got invalid date for timezone: ${user_pref.timezone}`);
            return undefined;
        }
        return (0,date_fns_tz__WEBPACK_IMPORTED_MODULE_4__.format)(current_date, user_pref.format, {timeZone: user_pref.timezone});
    }
    return undefined;
}

function get_user_type(user_id) {
    const user_profile = get_by_user_id(user_id);

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_profile.role);
}

function emails_strings_to_user_ids_string(emails_string) {
    const emails = emails_string.split(",");
    return email_list_to_user_ids_string(emails);
}

function email_list_to_user_ids_string(emails) {
    let user_ids = emails.map((email) => {
        const person = get_by_email(email);
        return person && person.user_id;
    });

    if (!user_ids.every(Boolean)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown emails: " + emails);
        return undefined;
    }

    user_ids = sort_numerically(user_ids);

    return user_ids.join(",");
}

function get_full_names_for_poll_option(user_ids) {
    return get_display_full_names(user_ids).join(", ");
}

function get_display_full_name(user_id) {
    const person = get_by_user_id(user_id);
    if (!person) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user id " + user_id);
        return "?";
    }

    if (_muted_users__WEBPACK_IMPORTED_MODULE_3__.is_user_muted(user_id)) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Muted user"});
    }

    return person.full_name;
}

function get_display_full_names(user_ids) {
    return user_ids.map((user_id) => get_display_full_name(user_id));
}

function get_full_name(user_id) {
    return people_by_user_id_dict.get(user_id).full_name;
}

function _calc_user_and_other_ids(user_ids_string) {
    const user_ids = split_to_ints(user_ids_string);
    const other_ids = user_ids.filter((user_id) => !is_my_user_id(user_id));
    return {user_ids, other_ids};
}

function get_recipients(user_ids_string) {
    // See message_store.get_pm_full_names() for a similar function.

    const {other_ids} = _calc_user_and_other_ids(user_ids_string);

    if (other_ids.length === 0) {
        // private message with oneself
        return my_full_name();
    }

    const names = get_display_full_names(other_ids).sort();
    return names.join(", ");
}

function pm_reply_user_string(message) {
    const user_ids = pm_with_user_ids(message);

    if (!user_ids) {
        return undefined;
    }

    return user_ids.join(",");
}

function pm_reply_to(message) {
    const user_ids = pm_with_user_ids(message);

    if (!user_ids) {
        return undefined;
    }

    const emails = user_ids.map((user_id) => {
        const person = people_by_user_id_dict.get(user_id);
        if (!person) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user id in message: " + user_id);
            return "?";
        }
        return person.email;
    });

    emails.sort();

    const reply_to = emails.join(",");

    return reply_to;
}

function sorted_other_user_ids(user_ids) {
    // This excludes your own user id unless you're the only user
    // (i.e. you sent a message to yourself).

    const other_user_ids = user_ids.filter((user_id) => !is_my_user_id(user_id));

    if (other_user_ids.length >= 1) {
        user_ids = other_user_ids;
    } else {
        user_ids = [my_user_id];
    }

    user_ids = sort_numerically(user_ids);

    return user_ids;
}

function concat_huddle(user_ids, user_id) {
    /*
        We assume user_ids and user_id have already
        been validated by the caller.

        The only logic we're encapsulating here is
        how to encode huddles.
    */
    const sorted_ids = sort_numerically([...user_ids, user_id]);
    return sorted_ids.join(",");
}

function pm_lookup_key_from_user_ids(user_ids) {
    /*
        The server will sometimes include our own user id
        in keys for PMs, but we only want our user id if
        we sent a message to ourself.
    */
    user_ids = sorted_other_user_ids(user_ids);
    return user_ids.join(",");
}

function pm_lookup_key(user_ids_string) {
    const user_ids = split_to_ints(user_ids_string);
    return pm_lookup_key_from_user_ids(user_ids);
}

function all_user_ids_in_pm(message) {
    if (message.type !== "private") {
        return undefined;
    }

    if (message.display_recipient.length === 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Empty recipient list in message");
        return undefined;
    }

    let user_ids = message.display_recipient.map((recip) => recip.id);

    user_ids = sort_numerically(user_ids);
    return user_ids;
}

function pm_with_user_ids(message) {
    if (message.type !== "private") {
        return undefined;
    }

    if (message.display_recipient.length === 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Empty recipient list in message");
        return undefined;
    }

    const user_ids = message.display_recipient.map((recip) => recip.id);

    return sorted_other_user_ids(user_ids);
}

function group_pm_with_user_ids(message) {
    if (message.type !== "private") {
        return undefined;
    }

    if (message.display_recipient.length === 0) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Empty recipient list in message");
        return undefined;
    }

    const user_ids = message.display_recipient.map((recip) => recip.id);
    const is_user_present = user_ids.some((user_id) => is_my_user_id(user_id));
    if (is_user_present) {
        user_ids.sort();
        if (user_ids.length > 2) {
            return user_ids;
        }
    }
    return false;
}

function pm_perma_link(message) {
    const user_ids = all_user_ids_in_pm(message);

    if (!user_ids) {
        return undefined;
    }

    let suffix;

    if (user_ids.length >= 3) {
        suffix = "group";
    } else {
        suffix = "pm";
    }

    const slug = user_ids.join(",") + "-" + suffix;
    const uri = "#narrow/pm-with/" + slug;
    return uri;
}

function pm_with_url(message) {
    const user_ids = pm_with_user_ids(message);

    if (!user_ids) {
        return undefined;
    }

    let suffix;

    if (user_ids.length > 1) {
        suffix = "group";
    } else {
        const person = get_by_user_id(user_ids[0]);
        if (person && person.full_name) {
            suffix = person.full_name.replace(/[ "%/<>`\p{C}]+/gu, "-");
        } else {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown people in message");
            suffix = "unk";
        }
    }

    const slug = user_ids.join(",") + "-" + suffix;
    const uri = "#narrow/pm-with/" + slug;
    return uri;
}

function update_email_in_reply_to(reply_to, user_id, new_email) {
    // We try to replace an old email with a new email in a reply_to,
    // but we try to avoid changing the reply_to if we don't have to,
    // and we don't warn on any errors.
    let emails = reply_to.split(",");

    const persons = emails.map((email) => people_dict.get(email.trim()));

    if (!persons.every(Boolean)) {
        return reply_to;
    }

    const needs_patch = persons.some((person) => person.user_id === user_id);

    if (!needs_patch) {
        return reply_to;
    }

    emails = persons.map((person) => {
        if (person.user_id === user_id) {
            return new_email;
        }
        return person.email;
    });

    return emails.join(",");
}

function pm_with_operand_ids(operand) {
    let emails = operand.split(",");
    emails = emails.map((email) => email.trim());
    let persons = emails.map((email) => people_dict.get(email));

    // If your email is included in a PM group with other people, just ignore it
    if (persons.length > 1) {
        const my_user = people_by_user_id_dict.get(my_user_id);
        persons = persons.filter((person) => person !== my_user);
    }

    if (!persons.every(Boolean)) {
        return undefined;
    }

    let user_ids = persons.map((person) => person.user_id);

    user_ids = sort_numerically(user_ids);

    return user_ids;
}

function emails_to_slug(emails_string) {
    let slug = reply_to_to_user_ids_string(emails_string);

    if (!slug) {
        return undefined;
    }

    slug += "-";

    const emails = emails_string.split(",");

    if (emails.length === 1) {
        const name = get_by_email(emails[0]).full_name;
        slug += name.replace(/[ "%/<>`\p{C}]+/gu, "-");
    } else {
        slug += "group";
    }

    return slug;
}

function slug_to_emails(slug) {
    /*
        It's not super important to be flexible about
        PM-related slugs, since you would rarely post
        them to the web, but we we do want to support
        reasonable variations:

            99-alice@example.com
            99

        Our canonical version is 99-alice@example.com,
        and we only care about the "99" prefix.
    */
    const m = /^([\d,]+)(-.*)?/.exec(slug);
    if (m) {
        let user_ids_string = m[1];
        user_ids_string = exclude_me_from_string(user_ids_string);
        return user_ids_string_to_emails_string(user_ids_string);
    }
    /* istanbul ignore next */
    return undefined;
}

function exclude_me_from_string(user_ids_string) {
    // Exclude me from a user_ids_string UNLESS I'm the
    // only one in it.
    let user_ids = split_to_ints(user_ids_string);

    if (user_ids.length <= 1) {
        // We either have a message to ourself, an empty
        // slug, or a message to somebody else where we weren't
        // part of the slug.
        return user_ids.join(",");
    }

    user_ids = user_ids.filter((user_id) => !is_my_user_id(user_id));

    return user_ids.join(",");
}

function format_small_avatar_url(raw_url) {
    const url = new URL(raw_url, location);
    url.search += (url.search ? "&" : "") + "s=50";
    return url.href;
}

function sender_is_bot(message) {
    if (message.sender_id) {
        const person = get_by_user_id(message.sender_id);
        return person.is_bot;
    }
    return false;
}

function sender_is_guest(message) {
    if (message.sender_id) {
        const person = get_by_user_id(message.sender_id);
        return person.is_guest;
    }
    return false;
}

function gravatar_url_for_email(email) {
    const hash = blueimp_md5__WEBPACK_IMPORTED_MODULE_0___default()(email.toLowerCase());
    const avatar_url = "https://secure.gravatar.com/avatar/" + hash + "?d=identicon";
    const small_avatar_url = format_small_avatar_url(avatar_url);
    return small_avatar_url;
}

function small_avatar_url_for_person(person) {
    if (person.avatar_url) {
        return format_small_avatar_url(person.avatar_url);
    }

    if (person.avatar_url === null) {
        return gravatar_url_for_email(person.email);
    }

    return format_small_avatar_url("/avatar/" + person.user_id);
}

function medium_gravatar_url_for_email(email) {
    const hash = blueimp_md5__WEBPACK_IMPORTED_MODULE_0___default()(email.toLowerCase());
    const avatar_url = "https://secure.gravatar.com/avatar/" + hash + "?d=identicon";
    const url = new URL(avatar_url, location);
    url.search += (url.search ? "&" : "") + "s=500";
    return url.href;
}

function medium_avatar_url_for_person(person) {
    /* Unlike the small avatar URL case, we don't generally have a
     * medium avatar URL included in person objects. So only have the
     * gravatar and server endpoints here. */

    if (person.avatar_url === null) {
        return medium_gravatar_url_for_email(person.email);
    }

    return "/avatar/" + person.user_id + "/medium";
}

function sender_info_for_recent_topics_row(sender_ids) {
    const senders_info = [];
    for (const id of sender_ids) {
        const sender = {...get_by_user_id(id)};
        sender.avatar_url_small = small_avatar_url_for_person(sender);
        sender.is_muted = _muted_users__WEBPACK_IMPORTED_MODULE_3__.is_user_muted(id);
        senders_info.push(sender);
    }
    return senders_info;
}

function small_avatar_url(message) {
    // Try to call this function in all places where we need 25px
    // avatar images, so that the browser can help
    // us avoid unnecessary network trips.  (For user-uploaded avatars,
    // the s=25 parameter is essentially ignored, but it's harmless.)
    //
    // We actually request these at s=50, so that we look better
    // on retina displays.

    let person;
    if (message.sender_id) {
        // We should always have message.sender_id, except for in the
        // tutorial, where it's ok to fall back to the URL in the fake
        // messages.
        person = get_by_user_id(message.sender_id);
    }

    // The first time we encounter a sender in a message, we may
    // not have person.avatar_url set, but if we do, then use that.
    if (person && person.avatar_url) {
        return small_avatar_url_for_person(person);
    }

    // Try to get info from the message if we didn't have a `person` object
    // or if the avatar was missing. We do this verbosely to avoid false
    // positives on line coverage (we don't do branch checking).
    if (message.avatar_url) {
        return format_small_avatar_url(message.avatar_url);
    }

    if (person && person.avatar_url === undefined) {
        // If we don't have an avatar_url at all, we use `GET
        // /avatar/{user_id}` endpoint to obtain avatar url.  This is
        // required to take advantage of the user_avatar_url_field_optional
        // optimization, which saves a huge amount of network traffic on
        // servers with 10,000s of user accounts.
        return format_small_avatar_url("/avatar/" + person.user_id);
    }

    // For computing the user's email, we first trust the person
    // object since that is updated via our real-time sync system, but
    // if unavailable, we use the sender email.
    let email;
    if (person) {
        email = person.email;
    } else {
        email = message.sender_email;
    }

    return gravatar_url_for_email(email);
}

function is_valid_email_for_compose(email) {
    if (is_cross_realm_email(email)) {
        return true;
    }

    const person = get_by_email(email);
    if (!person) {
        return false;
    }

    // we allow deactivated users in compose so that
    // one can attempt to reply to threads that contained them.
    return true;
}

function is_valid_bulk_emails_for_compose(emails) {
    // Returns false if at least one of the emails is invalid.
    return emails.every((email) => {
        if (!is_valid_email_for_compose(email)) {
            return false;
        }
        return true;
    });
}

function is_active_user_for_popover(user_id) {
    // For popover menus, we include cross-realm bots as active
    // users.

    if (cross_realm_dict.get(user_id)) {
        return true;
    }
    if (active_user_dict.has(user_id)) {
        return true;
    }

    // TODO: We can report errors here once we start loading
    //       deactivated users at page-load time. For now just warn.
    if (!people_by_user_id_dict.has(user_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpectedly invalid user_id in user popover query: " + user_id);
    }

    return false;
}

function filter_all_persons(pred) {
    const ret = [];
    for (const person of people_by_user_id_dict.values()) {
        if (pred(person)) {
            ret.push(person);
        }
    }
    return ret;
}

function filter_all_users(pred) {
    const ret = [];
    for (const person of active_user_dict.values()) {
        if (pred(person)) {
            ret.push(person);
        }
    }
    return ret;
}

function get_realm_users() {
    // includes humans and bots from your realm
    return Array.from(active_user_dict.values());
}

function get_active_human_ids() {
    const human_ids = [];

    for (const user of active_user_dict.values()) {
        if (!user.is_bot) {
            human_ids.push(user.user_id);
        }
    }

    return human_ids;
}

function get_non_active_human_ids() {
    const human_ids = [];

    for (const user of non_active_user_dict.values()) {
        if (!user.is_bot) {
            human_ids.push(user.user_id);
        }
    }

    return human_ids;
}

function get_active_human_count() {
    let count = 0;
    for (const person of active_user_dict.values()) {
        if (!person.is_bot) {
            count += 1;
        }
    }
    return count;
}

function get_active_user_ids() {
    // This includes active users and active bots.
    return Array.from(active_user_dict.keys());
}

function get_non_active_realm_users() {
    return Array.from(non_active_user_dict.values());
}

function is_cross_realm_email(email) {
    const person = get_by_email(email);
    if (!person) {
        return undefined;
    }
    return cross_realm_dict.has(person.user_id);
}

function get_recipient_count(person) {
    // We can have fake person objects like the "all"
    // pseudo-person in at-mentions.  They will have
    // the pm_recipient_count on the object itself.
    if (person.pm_recipient_count) {
        return person.pm_recipient_count;
    }

    /*
        For searching in the search bar, we will
        have true `person` objects with `user_id`.

        Likewise, we'll have user_id if we
        are tab-completing a user to send a PM
        to (but we only get called if we're not
        currently in a stream view).

        Finally, we'll have user_id if we are adding
        people to a stream (w/typeahead).

    */
    const count = pm_recipient_count_dict.get(person.user_id);

    return count || 0;
}

function incr_recipient_count(user_id) {
    const old_count = pm_recipient_count_dict.get(user_id) || 0;
    pm_recipient_count_dict.set(user_id, old_count + 1);
}

function clear_recipient_counts_for_testing() {
    pm_recipient_count_dict.clear();
}

function set_recipient_count_for_testing(user_id, count) {
    pm_recipient_count_dict.set(user_id, count);
}

function get_message_people() {
    /*
        message_people are roughly the people who have
        actually sent messages that are currently
        showing up on your feed.  These people
        are important--we give them preference
        over other users in certain search
        suggestions, since non-message-people are
        presumably either not very active or
        possibly subscribed to streams you don't
        care about.  message_people also includes
        people whom you have sent PMs, but look
        at the message_store code to see the precise
        semantics
    */
    const message_people = Object(function webpackMissingModule() { var e = new Error("Cannot find module './message_user_ids'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()
        .map((user_id) => people_by_user_id_dict.get(user_id))
        .filter(Boolean);

    return message_people;
}

function get_active_message_people() {
    const message_people = get_message_people();
    const active_message_people = message_people.filter((item) =>
        active_user_dict.has(item.user_id),
    );
    return active_message_people;
}

function get_people_for_search_bar(query) {
    const pred = build_person_matcher(query);

    const message_people = get_message_people();

    const small_results = message_people.filter((item) => pred(item));

    if (small_results.length >= 5) {
        return small_results;
    }

    return filter_all_persons(pred);
}

function build_termlet_matcher(termlet) {
    termlet = termlet.trim();

    const is_ascii = /^[a-z]+$/.test(termlet);

    return function (user) {
        let full_name = user.full_name;
        if (is_ascii) {
            // Only ignore diacritics if the query is plain ascii
            full_name = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_1__.remove_diacritics(full_name);
        }
        const names = full_name.toLowerCase().split(" ");

        return names.some((name) => name.startsWith(termlet));
    };
}

function build_person_matcher(query) {
    query = query.trim();

    const termlets = query.toLowerCase().split(/\s+/);
    const termlet_matchers = termlets.map((termlet) => build_termlet_matcher(termlet));

    return function (user) {
        const email = user.email.toLowerCase();

        if (email.startsWith(query)) {
            return true;
        }

        return termlet_matchers.every((matcher) => matcher(user));
    };
}

function filter_people_by_search_terms(users, search_terms) {
    const filtered_users = new Map();

    // Build our matchers outside the loop to avoid some
    // search overhead that is not user-specific.
    const matchers = search_terms.map((search_term) => build_person_matcher(search_term));

    // Loop through users and populate filtered_users only
    // if they include search_terms
    for (const user of users) {
        const person = get_by_email(user.email);
        // Get person object (and ignore errors)
        if (!person || !person.full_name) {
            continue;
        }

        // Return user emails that include search terms
        const match = matchers.some((matcher) => matcher(user));

        if (match) {
            filtered_users.set(person.user_id, true);
        }
    }

    return filtered_users;
}

const is_valid_full_name_and_user_id = (full_name, user_id) => {
    const person = people_by_user_id_dict.get(user_id);

    if (!person) {
        return false;
    }

    return person.full_name === full_name;
};

const get_actual_name_from_user_id = (user_id) => {
    /*
        If you are dealing with user-entered data, you
        should validate the user_id BEFORE calling
        this function.
    */
    const person = people_by_user_id_dict.get(user_id);

    if (!person) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user_id: " + user_id);
        return undefined;
    }

    return person.full_name;
};

function get_user_id_from_name(full_name) {
    // get_user_id_from_name('Alice Smith') === 42

    /*
        This function is intended to be called
        with a full name that is user-entered, such
        a full name from a user mention.

        We will only return a **unique** user_id
        here.  For duplicate names, our UI should
        force users to disambiguate names with a
        user_id and then call is_valid_full_name_and_user_id
        to make sure the combo is valid.  This is
        exactly what we do with mentions.
    */

    const person = people_by_name_dict.get(full_name);

    if (!person) {
        return undefined;
    }

    if (is_duplicate_full_name(full_name)) {
        return undefined;
    }

    return person.user_id;
}

function track_duplicate_full_name(full_name, user_id, to_remove) {
    let ids;
    if (duplicate_full_name_data.has(full_name)) {
        ids = duplicate_full_name_data.get(full_name);
    } else {
        ids = new Set();
    }
    if (!to_remove && user_id) {
        ids.add(user_id);
    }
    if (to_remove && user_id) {
        ids.delete(user_id);
    }
    duplicate_full_name_data.set(full_name, ids);
}

function is_duplicate_full_name(full_name) {
    const ids = duplicate_full_name_data.get(full_name);

    return ids && ids.size > 1;
}

function get_mention_syntax(full_name, user_id, silent) {
    let mention = "";
    if (silent) {
        mention += "@_**";
    } else {
        mention += "@**";
    }
    mention += full_name;
    if (!user_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_mention_syntax called without user_id.");
    }
    if (
        (is_duplicate_full_name(full_name) || full_name_matches_wildcard_mention(full_name)) &&
        user_id
    ) {
        mention += "|" + user_id;
    }
    mention += "**";
    return mention;
}

function full_name_matches_wildcard_mention(full_name) {
    return ["all", "everyone", "stream"].includes(full_name);
}

function _add_user(person) {
    /*
        This is common code to add any user, even
        users who may be deactivated or outside
        our realm (like cross-realm bots).
    */
    person.is_moderator = false;
    if (person.role === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        person.is_moderator = true;
    }
    if (person.user_id) {
        people_by_user_id_dict.set(person.user_id, person);
    } else {
        // We eventually want to lock this down completely
        // and report an error and not update other the data
        // structures here, but we have a lot of edge cases
        // with cross-realm bots, zephyr users, etc., deactivated
        // users, where we are probably fine for now not to
        // find them via user_id lookups.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("No user_id provided for " + person.email);
    }

    track_duplicate_full_name(person.full_name, person.user_id);
    people_dict.set(person.email, person);
    people_by_name_dict.set(person.full_name, person);
}

function add_active_user(person) {
    active_user_dict.set(person.user_id, person);
    _add_user(person);
    non_active_user_dict.delete(person.user_id);
}

const is_person_active = (user_id) => {
    if (!people_by_user_id_dict.has(user_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("No user found.", user_id);
    }

    if (cross_realm_dict.has(user_id)) {
        return true;
    }

    return active_user_dict.has(user_id);
};

function add_cross_realm_user(person) {
    if (!people_dict.has(person.email)) {
        _add_user(person);
    }
    cross_realm_dict.set(person.user_id, person);
}

function deactivate(person) {
    // We don't fully remove a person from all of our data
    // structures, because deactivated users can be part
    // of somebody's PM list.
    active_user_dict.delete(person.user_id);
    non_active_user_dict.set(person.user_id, person);
}

function report_late_add(user_id, email) {
    // This function is extracted to make unit testing easier,
    // plus we may fine-tune our reporting here for different
    // types of realms.
    const msg = "Added user late: user_id=" + user_id + " email=" + email;

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg);
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg);
    }
}

function extract_people_from_message(message) {
    let involved_people;

    switch (message.type) {
        case "stream":
            involved_people = [
                {
                    full_name: message.sender_full_name,
                    user_id: message.sender_id,
                    email: message.sender_email,
                },
            ];
            break;

        case "private":
            involved_people = message.display_recipient;
            break;

        default:
            involved_people = [];
    }

    // Add new people involved in this message to the people list
    for (const person of involved_people) {
        if (person.unknown_local_echo_user) {
            continue;
        }

        const user_id = person.user_id || person.id;

        if (people_by_user_id_dict.has(user_id)) {
            continue;
        }

        report_late_add(user_id, person.email);

        _add_user({
            email: person.email,
            user_id,
            full_name: person.full_name,
            is_admin: person.is_realm_admin || false,
            is_bot: person.is_bot || false,
        });
    }
}

function safe_lower(s) {
    return (s || "").toLowerCase();
}

function matches_user_settings_search(person, value) {
    const email = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(person);

    return safe_lower(person.full_name).includes(value) || safe_lower(email).includes(value);
}

function filter_for_user_settings_search(persons, query) {
    /*
        TODO: For large realms, we can optimize this a couple
              different ways.  For realms that don't show
              emails, we can make a simpler filter predicate
              that works solely with full names.  And we can
              also consider two-pass filters that try more
              stingy criteria first, such as exact prefix
              matches, before widening the search.

              See #13554 for more context.
    */
    return persons.filter((person) => matches_user_settings_search(person, query));
}

function maybe_incr_recipient_count(message) {
    if (message.type !== "private") {
        return;
    }

    if (!message.sent_by_me) {
        return;
    }

    // Track the number of PMs we've sent to this person to improve autocomplete
    for (const recip of message.display_recipient) {
        if (recip.unknown_local_echo_user) {
            continue;
        }

        const user_id = recip.id;
        incr_recipient_count(user_id);
    }
}

function set_full_name(person_obj, new_full_name) {
    if (people_by_name_dict.has(person_obj.full_name)) {
        people_by_name_dict.delete(person_obj.full_name);
    }
    // Remove previous and add new full name to the duplicate full name tracker.
    track_duplicate_full_name(person_obj.full_name, person_obj.user_id, true);
    track_duplicate_full_name(new_full_name, person_obj.user_id);
    people_by_name_dict.set(new_full_name, person_obj);
    person_obj.full_name = new_full_name;
}

function set_custom_profile_field_data(user_id, field) {
    if (field.id === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to set undefined field id");
        return;
    }
    people_by_user_id_dict.get(user_id).profile_data[field.id] = {
        value: field.value,
        rendered_value: field.rendered_value,
    };
}

function is_current_user(email) {
    if (email === null || email === undefined || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    return email.toLowerCase() === my_current_email().toLowerCase();
}

function initialize_current_user(user_id) {
    my_user_id = user_id;
}

function my_full_name() {
    return people_by_user_id_dict.get(my_user_id).full_name;
}

function my_current_email() {
    return people_by_user_id_dict.get(my_user_id).email;
}

function my_current_user_id() {
    return my_user_id;
}

function my_custom_profile_data(field_id) {
    if (field_id === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined field id");
        return undefined;
    }
    return get_custom_profile_data(my_user_id, field_id);
}

function get_custom_profile_data(user_id, field_id) {
    const profile_data = people_by_user_id_dict.get(user_id).profile_data;
    if (profile_data === undefined) {
        return null;
    }
    return profile_data[field_id];
}

function is_my_user_id(user_id) {
    if (!user_id) {
        return false;
    }

    if (typeof user_id !== "number") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("user_id is a string in my_user_id: " + user_id);
        user_id = Number.parseInt(user_id, 10);
    }

    return user_id === my_user_id;
}

function compare_by_name(a, b) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.full_name, b.full_name);
}

function sort_but_pin_current_user_on_top(users) {
    const my_user = people_by_user_id_dict.get(my_user_id);
    if (users.includes(my_user)) {
        users.splice(users.indexOf(my_user), 1);
        users.sort(compare_by_name);
        users.unshift(my_user);
    } else {
        users.sort(compare_by_name);
    }
}

function initialize(my_user_id, params) {
    for (const person of params.realm_users) {
        add_active_user(person);
    }

    for (const person of params.realm_non_active_users) {
        non_active_user_dict.set(person.user_id, person);
        _add_user(person);
    }

    for (const person of params.cross_realm_bots) {
        add_cross_realm_user(person);
    }

    initialize_current_user(my_user_id);
}


/***/ }),

/***/ "./static/js/pill_typeahead.js":
/*!*************************************!*\
  !*** ./static/js/pill_typeahead.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _composebox_typeahead__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./composebox_typeahead */ "./static/js/composebox_typeahead.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _stream_pill__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_pill */ "./static/js/stream_pill.js");
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");
/* harmony import */ var _user_group_pill__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_group_pill */ "./static/js/user_group_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");









function person_matcher(query, item) {
    if (_people__WEBPACK_IMPORTED_MODULE_2__.is_known_user(item)) {
        return _composebox_typeahead__WEBPACK_IMPORTED_MODULE_1__.query_matches_person(query, item);
    }
    return false;
}

function group_matcher(query, item) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
        return _composebox_typeahead__WEBPACK_IMPORTED_MODULE_1__.query_matches_name(query, item);
    }
    return false;
}

function set_up($input, pills, opts) {
    if (!opts.user && !opts.user_group && !opts.stream) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unspecified possible item types");
        return;
    }
    const include_streams = (query) => opts.stream && query.trim().startsWith("#");
    const include_user_groups = opts.user_group;
    const include_users = opts.user;

    $input.typeahead({
        items: 5,
        fixed: true,
        dropup: true,
        source() {
            let source = [];
            if (include_streams(this.query)) {
                // If query starts with # we expect,
                // only stream suggestions so we simply
                // return stream source.
                return _stream_pill__WEBPACK_IMPORTED_MODULE_3__.typeahead_source(pills);
            }

            if (include_user_groups) {
                source = source.concat(_user_group_pill__WEBPACK_IMPORTED_MODULE_5__.typeahead_source(pills));
            }

            if (include_users) {
                if (opts.user_source !== undefined) {
                    // If user_source is specified in opts, it
                    // is given priority. Otherwise we use
                    // default user_pill.typeahead_source.
                    source = source.concat(opts.user_source());
                } else {
                    source = source.concat(_user_pill__WEBPACK_IMPORTED_MODULE_6__.typeahead_source(pills));
                }
            }
            return source;
        },
        highlighter(item) {
            if (include_streams(this.query)) {
                return _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__.render_stream(item);
            }

            if (include_user_groups && Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
                return _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__.render_user_group(item);
            }

            // After reaching this point, it is sure
            // that given item is a person. So this
            // handles `include_users` cases along with
            // default cases.
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__.render_person(item);
        },
        matcher(item) {
            let query = this.query.toLowerCase();
            query = query.replace(/\u00A0/g, " ");

            if (include_streams(query)) {
                query = query.trim().slice(1);
                return item.name.toLowerCase().includes(query);
            }

            let matches = false;
            if (include_user_groups) {
                matches = matches || group_matcher(query, item);
            }

            if (include_users) {
                matches = matches || person_matcher(query, item);
            }
            return matches;
        },
        sorter(matches) {
            const query = this.query;
            if (include_streams(query)) {
                return _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__.sort_streams(matches, query.trim().slice(1));
            }

            let users = [];
            if (include_users) {
                users = matches.filter((ele) => _people__WEBPACK_IMPORTED_MODULE_2__.is_known_user(ele));
            }

            let groups;
            if (include_user_groups) {
                groups = matches.filter((ele) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ele));
            }
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_4__.sort_recipients({
                users,
                query,
                current_stream: "",
                current_topic: undefined,
                groups,
                max_num_items: undefined,
            });
        },
        updater(item) {
            if (include_streams(this.query)) {
                _stream_pill__WEBPACK_IMPORTED_MODULE_3__.append_stream(item, pills);
            } else if (include_user_groups && Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
                _user_group_pill__WEBPACK_IMPORTED_MODULE_5__.append_user_group(item, pills);
            } else if (include_users && _people__WEBPACK_IMPORTED_MODULE_2__.is_known_user(item)) {
                _user_pill__WEBPACK_IMPORTED_MODULE_6__.append_user(item, pills);
            }

            $input.trigger("focus");
            if (opts.update_func) {
                opts.update_func();
            }
        },
        stopAdvance: true,
    });
}


/***/ }),

/***/ "./static/js/pm_conversations.js":
/*!***************************************!*\
  !*** ./static/js/pm_conversations.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "is_partner": () => (/* binding */ is_partner),
/* harmony export */   "process_message": () => (/* binding */ process_message),
/* harmony export */   "recent": () => (/* binding */ recent),
/* harmony export */   "set_partner": () => (/* binding */ set_partner)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");




const partners = new Set();

function set_partner(user_id) {
    partners.add(user_id);
}

function is_partner(user_id) {
    return partners.has(user_id);
}

function filter_muted_pms(conversation) {
    // We hide muted users from the top left corner, as well as those huddles
    // in which all participants are muted.
    const recipients = conversation.user_ids_string.split(",").map((id) => Number.parseInt(id, 10));

    if (recipients.every((id) => _muted_users__WEBPACK_IMPORTED_MODULE_1__.is_user_muted(id))) {
        return false;
    }

    return true;
}

class RecentPrivateMessages {
    // This data structure keeps track of the sets of users you've had
    // recent conversations with, sorted by time (implemented via
    // `message_id` sorting, since that's how we time-sort messages).
    recent_message_ids = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(); // key is user_ids_string
    recent_private_messages = [];

    insert(user_ids, message_id) {
        if (user_ids.length === 0) {
            // The server sends [] for self-PMs.
            user_ids = [_people__WEBPACK_IMPORTED_MODULE_2__.my_current_user_id()];
        }
        user_ids.sort((a, b) => a - b);

        const user_ids_string = user_ids.join(",");
        let conversation = this.recent_message_ids.get(user_ids_string);

        if (conversation === undefined) {
            // This is a new user, so create a new object.
            conversation = {
                user_ids_string,
                max_message_id: message_id,
            };
            this.recent_message_ids.set(user_ids_string, conversation);

            // Optimistically insert the new message at the front, since that
            // is usually where it belongs, but we'll re-sort.
            this.recent_private_messages.unshift(conversation);
        } else {
            if (conversation.max_message_id >= message_id) {
                // don't backdate our conversation.  This is the
                // common code path after initialization when
                // processing old messages, since we'll already have
                // the latest message_id for the conversation from
                // initialization.
                return;
            }

            // update our latest message_id
            conversation.max_message_id = message_id;
        }

        this.recent_private_messages.sort((a, b) => b.max_message_id - a.max_message_id);
    }

    get() {
        // returns array of structs with user_ids_string and
        // message_id
        return this.recent_private_messages.filter((pm) => filter_muted_pms(pm));
    }

    get_strings() {
        // returns array of structs with user_ids_string and
        // message_id
        return this.recent_private_messages
            .filter((pm) => filter_muted_pms(pm))
            .map((conversation) => conversation.user_ids_string);
    }

    initialize(params) {
        for (const conversation of params.recent_private_conversations) {
            this.insert(conversation.user_ids, conversation.max_message_id);
        }
    }
}

let recent = new RecentPrivateMessages();

function process_message(message) {
    const user_ids = _people__WEBPACK_IMPORTED_MODULE_2__.pm_with_user_ids(message);
    if (!user_ids) {
        return;
    }

    for (const user_id of user_ids) {
        set_partner(user_id);
    }

    recent.insert(user_ids, message.id);
}

function clear_for_testing() {
    recent = new RecentPrivateMessages();
    partners.clear();
}


/***/ }),

/***/ "./static/js/pm_list.js":
/*!******************************!*\
  !*** ./static/js/pm_list.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_build_private_messages_list": () => (/* binding */ _build_private_messages_list),
/* harmony export */   "expand": () => (/* binding */ expand),
/* harmony export */   "handle_narrow_activated": () => (/* binding */ handle_narrow_activated),
/* harmony export */   "handle_narrow_deactivated": () => (/* binding */ handle_narrow_deactivated),
/* harmony export */   "highlight_all_private_messages_view": () => (/* binding */ highlight_all_private_messages_view),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_private_messages_collapsed": () => (/* binding */ is_private_messages_collapsed),
/* harmony export */   "set_count": () => (/* binding */ set_count),
/* harmony export */   "toggle_private_messages_section": () => (/* binding */ toggle_private_messages_section),
/* harmony export */   "update_dom_with_unread_counts": () => (/* binding */ update_dom_with_unread_counts),
/* harmony export */   "update_private_messages": () => (/* binding */ update_private_messages)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _pm_list_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pm_list_data */ "./static/js/pm_list_data.js");
/* harmony import */ var _pm_list_dom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pm_list_dom */ "./static/js/pm_list_dom.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _topic_zoom__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./topic_zoom */ "./static/js/topic_zoom.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _vdom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./vdom */ "./static/js/vdom.js");











let prior_dom;

// This module manages the "Private messages" section in the upper
// left corner of the app.  This was split out from stream_list.js.

let private_messages_collapsed = false;

// The private messages section can be zoomed in to view more messages.
// This keeps track of if we're zoomed in or not.
let zoomed = false;

function get_private_messages_section_header() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        ".private_messages_container #private_messages_section #private_messages_section_header",
    );
}

function set_count(count) {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(get_private_messages_section_header(), count);
}

function close() {
    private_messages_collapsed = true;
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").removeClass("fa-caret-down");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").addClass("fa-caret-right");

    update_private_messages();
}

function _build_private_messages_list() {
    const conversations = _pm_list_data__WEBPACK_IMPORTED_MODULE_2__.get_conversations();
    const pm_list_info = _pm_list_data__WEBPACK_IMPORTED_MODULE_2__.get_list_info(zoomed);
    const conversations_to_be_shown = pm_list_info.conversations_to_be_shown;
    const more_conversations_unread_count = pm_list_info.more_conversations_unread_count;

    const pm_list_nodes = conversations_to_be_shown.map((conversation) =>
        _pm_list_dom__WEBPACK_IMPORTED_MODULE_3__.keyed_pm_li(conversation),
    );

    const all_conversations_shown = conversations_to_be_shown.length === conversations.length;
    if (!all_conversations_shown) {
        pm_list_nodes.push(
            _pm_list_dom__WEBPACK_IMPORTED_MODULE_3__.more_private_conversations_li(more_conversations_unread_count),
        );
    }
    const dom_ast = _pm_list_dom__WEBPACK_IMPORTED_MODULE_3__.pm_ul(pm_list_nodes);
    return dom_ast;
}

function set_dom_to(new_dom) {
    const $container = _ui__WEBPACK_IMPORTED_MODULE_6__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_messages_list"));

    function replace_content(html) {
        $container.html(html);
    }

    function find() {
        return $container.find("ul");
    }

    _vdom__WEBPACK_IMPORTED_MODULE_8__.update(replace_content, find, new_dom, prior_dom);
    prior_dom = new_dom;
}

function update_private_messages() {
    if (private_messages_collapsed) {
        // In the collapsed state, we will still display the current
        // conversation, to preserve the UI invariant that there's
        // always something highlighted in the left sidebar.
        const conversations = _pm_list_data__WEBPACK_IMPORTED_MODULE_2__.get_conversations();
        const active_conversation = conversations.find((conversation) => conversation.is_active);

        if (active_conversation) {
            const node = [_pm_list_dom__WEBPACK_IMPORTED_MODULE_3__.keyed_pm_li(active_conversation)];
            const new_dom = _pm_list_dom__WEBPACK_IMPORTED_MODULE_3__.pm_ul(node);
            set_dom_to(new_dom);
        } else {
            // Otherwise, empty the section.
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".pm-list").empty();
            prior_dom = undefined;
        }
    } else {
        const new_dom = _build_private_messages_list();
        set_dom_to(new_dom);
    }
    // Make sure to update the left sidebar heights after updating PMs.
    setTimeout(_resize__WEBPACK_IMPORTED_MODULE_4__.resize_stream_filters_container, 0);
}

function expand() {
    private_messages_collapsed = false;
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").addClass("fa-caret-down");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").removeClass("fa-caret-right");
    update_private_messages();
}

function update_dom_with_unread_counts(counts) {
    // In theory, we could support passing the counts object through
    // to pm_list_data, rather than fetching it directly there. But
    // it's not an important optimization, because it's unlikely a
    // user would have 10,000s of unread PMs where it could matter.
    update_private_messages();
    // This is just the global unread count.
    set_count(counts.private_message_count);
}

function highlight_all_private_messages_view() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").addClass("active_private_messages_section");
}

function unhighlight_all_private_messages_view() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").removeClass("active_private_messages_section");
}

function handle_narrow_activated(filter) {
    const active_filter = filter;
    const is_all_private_message_view = lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(active_filter.sorted_term_types(), [
        "is-private",
    ]);
    const narrow_to_private_messages_section = active_filter.operands("pm-with").length !== 0;

    if (is_all_private_message_view) {
        highlight_all_private_messages_view();
    } else {
        unhighlight_all_private_messages_view();
    }
    if (narrow_to_private_messages_section) {
        update_private_messages();
    }
}

function handle_narrow_deactivated() {
    // Since one can renarrow via the keyboard shortcut or similar, we
    // avoid disturbing the zoomed state here.
    unhighlight_all_private_messages_view();
    update_private_messages();
}

function is_private_messages_collapsed() {
    return private_messages_collapsed;
}

function toggle_private_messages_section() {
    // change the state of PM section depending on the previous state.
    if (private_messages_collapsed) {
        expand();
    } else {
        close();
    }
}

function zoom_in() {
    zoomed = true;
    if (_topic_zoom__WEBPACK_IMPORTED_MODULE_5__.is_zoomed_in()) {
        _topic_zoom__WEBPACK_IMPORTED_MODULE_5__.zoom_out();
    }
    update_private_messages();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").removeClass("zoom-out").addClass("zoom-in");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_list").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".left-sidebar .right-sidebar-items").hide();
}

function zoom_out() {
    zoomed = false;
    update_private_messages();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").removeClass("zoom-in").addClass("zoom-out");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_list").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".left-sidebar .right-sidebar-items").show();
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").on("click", "#show_more_private_messages", (e) => {
        e.stopPropagation();
        e.preventDefault();

        zoom_in();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".private_messages_container").on("click", "#hide_more_private_messages", (e) => {
        e.stopPropagation();
        e.preventDefault();

        zoom_out();
    });
}


/***/ }),

/***/ "./static/js/pm_list_data.js":
/*!***********************************!*\
  !*** ./static/js/pm_list_data.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_active_user_ids_string": () => (/* binding */ get_active_user_ids_string),
/* harmony export */   "get_conversations": () => (/* binding */ get_conversations),
/* harmony export */   "get_list_info": () => (/* binding */ get_list_info),
/* harmony export */   "is_all_privates": () => (/* binding */ is_all_privates)
/* harmony export */ });
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_conversations__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pm_conversations */ "./static/js/pm_conversations.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");








// Maximum number of conversation threads to show in default view.
const max_conversations_to_show = 5;

// Maximum number of conversation threads to show in default view with unreads.
const max_conversations_to_show_with_unreads = 8;

function get_active_user_ids_string() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_2__.filter();

    if (!filter) {
        return undefined;
    }

    const emails = filter.operands("pm-with")[0];

    if (!emails) {
        return undefined;
    }

    return _people__WEBPACK_IMPORTED_MODULE_3__.emails_strings_to_user_ids_string(emails);
}

function get_conversations() {
    const private_messages = _pm_conversations__WEBPACK_IMPORTED_MODULE_4__.recent.get();
    const display_objects = [];

    // The user_ids_string for the current view, if any.
    const active_user_ids_string = get_active_user_ids_string();

    for (const conversation of private_messages) {
        const user_ids_string = conversation.user_ids_string;
        const reply_to = _people__WEBPACK_IMPORTED_MODULE_3__.user_ids_string_to_emails_string(user_ids_string);
        const recipients_string = _people__WEBPACK_IMPORTED_MODULE_3__.get_recipients(user_ids_string);

        const num_unread = _unread__WEBPACK_IMPORTED_MODULE_5__.num_unread_for_user_ids_string(user_ids_string);
        const is_group = user_ids_string.includes(",");
        const is_active = user_ids_string === active_user_ids_string;

        let user_circle_class;
        let status_emoji_info;

        if (!is_group) {
            const user_id = Number.parseInt(user_ids_string, 10);
            user_circle_class = _buddy_data__WEBPACK_IMPORTED_MODULE_0__.get_user_circle_class(user_id);
            const recipient_user_obj = _people__WEBPACK_IMPORTED_MODULE_3__.get_by_user_id(user_id);

            if (recipient_user_obj.is_bot) {
                // Bots do not have status emoji, and are modeled as
                // always present. We may want to use this space for a
                // bot icon in the future.
                user_circle_class = "user_circle_green";
            } else {
                status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_6__.get_status_emoji(user_id);
            }
        }

        const display_object = {
            recipients: recipients_string,
            user_ids_string,
            unread: num_unread,
            is_zero: num_unread === 0,
            is_active,
            url: _hash_util__WEBPACK_IMPORTED_MODULE_1__.pm_with_url(reply_to),
            status_emoji_info,
            user_circle_class,
            is_group,
        };
        display_objects.push(display_object);
    }

    return display_objects;
}

function is_all_privates() {
    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_2__.filter();

    if (!filter) {
        return false;
    }

    return filter.operands("is").includes("private");
}

// Designed to closely match topic_list_data.get_list_info().
function get_list_info(zoomed) {
    const conversations = get_conversations();

    if (zoomed || conversations.length <= max_conversations_to_show) {
        return {
            conversations_to_be_shown: conversations,
            more_conversations_unread_count: 0,
        };
    }

    const conversations_to_be_shown = [];
    let more_conversations_unread_count = 0;
    function should_show_conversation(idx, conversation) {
        // We always show the active conversation; see the similar
        // comment in topic_list_data.js.
        if (conversation.is_active) {
            return true;
        }

        // We don't need to filter muted users here, because
        // pm_conversations.js takes care of this for us.

        // We include the most recent max_conversations_to_show
        // conversations, regardless of whether they have unread
        // messages.
        if (idx < max_conversations_to_show) {
            return true;
        }

        // We include older conversations with unread messages up
        // until max_conversations_to_show_with_unreads total
        // topics have been included.
        if (
            conversation.unread > 0 &&
            conversations_to_be_shown.length < max_conversations_to_show_with_unreads
        ) {
            return true;
        }

        // Otherwise, this conversation should only be visible in
        // the unzoomed view.
        return false;
    }
    for (const [idx, conversation] of conversations.entries()) {
        if (should_show_conversation(idx, conversation)) {
            conversations_to_be_shown.push(conversation);
        } else {
            more_conversations_unread_count += conversation.unread;
        }
    }

    return {
        conversations_to_be_shown,
        more_conversations_unread_count,
    };
}


/***/ }),

/***/ "./static/js/pm_list_dom.js":
/*!**********************************!*\
  !*** ./static/js/pm_list_dom.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "keyed_pm_li": () => (/* binding */ keyed_pm_li),
/* harmony export */   "more_private_conversations_li": () => (/* binding */ more_private_conversations_li),
/* harmony export */   "pm_ul": () => (/* binding */ pm_ul)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_more_pms_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/more_pms.hbs */ "./static/templates/more_pms.hbs");
/* harmony import */ var _templates_more_pms_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_more_pms_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_pm_list_item_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/pm_list_item.hbs */ "./static/templates/pm_list_item.hbs");
/* harmony import */ var _templates_pm_list_item_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_pm_list_item_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _vdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./vdom */ "./static/js/vdom.js");







function keyed_pm_li(conversation) {
    const render = () => _templates_pm_list_item_hbs__WEBPACK_IMPORTED_MODULE_2___default()(conversation);

    const eq = (other) => lodash__WEBPACK_IMPORTED_MODULE_0___default().isEqual(conversation, other.conversation);

    const key = conversation.user_ids_string;

    return {
        key,
        render,
        conversation,
        eq,
    };
}

function more_private_conversations_li(more_conversations_unread_count) {
    const render = () => _templates_more_pms_hbs__WEBPACK_IMPORTED_MODULE_1___default()({more_conversations_unread_count});

    // Used in vdom.js to check if an element has changed and needs to
    // be updated in the DOM.
    const eq = (other) =>
        other.more_items &&
        more_conversations_unread_count === other.more_conversations_unread_count;

    // This special key must be impossible as a user_ids_string.
    const key = "more_private_conversations";

    return {
        key,
        more_items: true,
        more_conversations_unread_count,
        render,
        eq,
    };
}

function pm_ul(nodes) {
    const attrs = [
        ["class", "pm-list"],
        ["data-name", "private"],
    ];
    return _vdom__WEBPACK_IMPORTED_MODULE_3__.ul({
        attrs,
        keyed_nodes: nodes,
    });
}


/***/ }),

/***/ "./static/js/poll_widget.js":
/*!**********************************!*\
  !*** ./static/js/poll_widget.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "activate": () => (/* binding */ activate)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _shared_js_poll_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/js/poll_data */ "./static/shared/js/poll_data.js");
/* harmony import */ var _templates_widgets_poll_widget_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/widgets/poll_widget.hbs */ "./static/templates/widgets/poll_widget.hbs");
/* harmony import */ var _templates_widgets_poll_widget_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_widgets_poll_widget_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_widgets_poll_widget_results_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/widgets/poll_widget_results.hbs */ "./static/templates/widgets/poll_widget_results.hbs");
/* harmony import */ var _templates_widgets_poll_widget_results_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_widgets_poll_widget_results_hbs__WEBPACK_IMPORTED_MODULE_3__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./people */ "./static/js/people.js");











function activate({
    $elem,
    callback,
    extra_data: {question = "", options = []} = {},
    message,
}) {
    const is_my_poll = _people__WEBPACK_IMPORTED_MODULE_5__.is_my_user_id(message.sender_id);
    const poll_data = new _shared_js_poll_data__WEBPACK_IMPORTED_MODULE_1__.PollData({
        message_sender_id: message.sender_id,
        current_user_id: _people__WEBPACK_IMPORTED_MODULE_5__.my_current_user_id(),
        is_my_poll,
        question,
        options,
        comma_separated_names: _people__WEBPACK_IMPORTED_MODULE_5__.get_full_names_for_poll_option,
        report_error_function: Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    function update_edit_controls() {
        const has_question = $elem.find("input.poll-question").val().trim() !== "";
        $elem.find("button.poll-question-check").toggle(has_question);
    }

    function render_question() {
        const question = poll_data.get_question();
        const input_mode = poll_data.get_input_mode();
        const can_edit = is_my_poll && !input_mode;
        const has_question = question.trim() !== "";
        const can_vote = has_question;
        const waiting = !is_my_poll && !has_question;
        const author_help = is_my_poll && !has_question;

        $elem.find(".poll-question-header").toggle(!input_mode);
        $elem.find(".poll-question-header").text(question);
        $elem.find(".poll-edit-question").toggle(can_edit);
        update_edit_controls();

        $elem.find(".poll-question-bar").toggle(input_mode);
        $elem.find(".poll-option-bar").toggle(can_vote);

        $elem.find(".poll-please-wait").toggle(waiting);

        $elem.find(".poll-author-help").toggle(author_help);
    }

    function start_editing() {
        poll_data.set_input_mode();

        const question = poll_data.get_question();
        $elem.find("input.poll-question").val(question);
        render_question();
        $elem.find("input.poll-question").trigger("focus");
    }

    function abort_edit() {
        poll_data.clear_input_mode();
        render_question();
    }

    function submit_question() {
        const $poll_question_input = $elem.find("input.poll-question");
        let new_question = $poll_question_input.val().trim();
        const old_question = poll_data.get_question();

        // We should disable the button for blank questions,
        // so this is just defensive code.
        if (new_question.trim() === "") {
            new_question = old_question;
        }

        // Optimistically set the question locally.
        poll_data.set_question(new_question);
        render_question();

        // If there were no actual edits, we can exit now.
        if (new_question === old_question) {
            return;
        }

        // Broadcast the new question to our peers.
        const data = poll_data.handle.question.outbound(new_question);
        callback(data);
    }

    function submit_option() {
        const $poll_option_input = $elem.find("input.poll-option");
        const option = $poll_option_input.val().trim();
        const options = poll_data.get_widget_data().options;

        if (poll_data.is_option_present(options, option)) {
            return;
        }

        if (option === "") {
            return;
        }

        $poll_option_input.val("").trigger("focus");

        const data = poll_data.handle.new_option.outbound(option);
        callback(data);
    }

    function submit_vote(key) {
        const data = poll_data.handle.vote.outbound(key);
        callback(data);
    }

    function build_widget() {
        const html = _templates_widgets_poll_widget_hbs__WEBPACK_IMPORTED_MODULE_2___default()();
        $elem.html(html);

        $elem.find("input.poll-question").on("keyup", (e) => {
            e.stopPropagation();
            update_edit_controls();
        });

        $elem.find("input.poll-question").on("keydown", (e) => {
            e.stopPropagation();

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                submit_question();
                return;
            }

            if (e.key === "Escape") {
                abort_edit();
                return;
            }
        });

        $elem.find(".poll-edit-question").on("click", (e) => {
            e.stopPropagation();
            start_editing();
        });

        $elem.find("button.poll-question-check").on("click", (e) => {
            e.stopPropagation();
            submit_question();
        });

        $elem.find("button.poll-question-remove").on("click", (e) => {
            e.stopPropagation();
            abort_edit();
        });

        $elem.find("button.poll-option").on("click", (e) => {
            e.stopPropagation();
            check_option_button();
            submit_option();
        });

        $elem.find("input.poll-option").on("keyup", (e) => {
            e.stopPropagation();
            check_option_button();

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                submit_option();
                return;
            }

            if (e.key === "Escape") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("input.poll-option").val("");
                return;
            }
        });
    }

    function check_option_button() {
        const $poll_option_input = $elem.find("input.poll-option");
        const option = $poll_option_input.val().trim();
        const options = poll_data.get_widget_data().options;

        if (poll_data.is_option_present(options, option)) {
            $elem.find("button.poll-option").attr("disabled", true);
            $elem
                .find("button.poll-option")
                .attr("title", Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Option already present."}));
        } else {
            $elem.find("button.poll-option").attr("disabled", false);
            $elem.find("button.poll-option").removeAttr("title");
        }
    }

    function render_results() {
        const widget_data = poll_data.get_widget_data();

        const html = _templates_widgets_poll_widget_results_hbs__WEBPACK_IMPORTED_MODULE_3___default()(widget_data);
        $elem.find("ul.poll-widget").html(html);

        $elem
            .find("button.poll-vote")
            .off("click")
            .on("click", (e) => {
                e.stopPropagation();
                const key = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).attr("data-key");
                submit_vote(key);
            });
    }

    $elem.handle_events = function (events) {
        for (const event of events) {
            poll_data.handle_event(event.sender_id, event.data);
        }

        render_question();
        render_results();
    };

    build_widget();
    render_question();
    render_results();
}


/***/ }),

/***/ "./static/js/popover_menus.js":
/*!************************************!*\
  !*** ./static/js/popover_menus.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "actions_popped": () => (/* binding */ actions_popped),
/* harmony export */   "any_active": () => (/* binding */ any_active),
/* harmony export */   "compose_enter_sends_popover_displayed": () => (/* binding */ compose_enter_sends_popover_displayed),
/* harmony export */   "get_compose_control_buttons_popover": () => (/* binding */ get_compose_control_buttons_popover),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "toggle_message_actions_menu": () => (/* binding */ toggle_message_actions_menu)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var tippy_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! tippy.js */ "./node_modules/tippy.js/dist/tippy.esm.js");
/* harmony import */ var _templates_actions_popover_content_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/actions_popover_content.hbs */ "./static/templates/actions_popover_content.hbs");
/* harmony import */ var _templates_actions_popover_content_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_actions_popover_content_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_compose_control_buttons_popover_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/compose_control_buttons_popover.hbs */ "./static/templates/compose_control_buttons_popover.hbs");
/* harmony import */ var _templates_compose_control_buttons_popover_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_control_buttons_popover_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_compose_select_enter_behaviour_popover_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/compose_select_enter_behaviour_popover.hbs */ "./static/templates/compose_select_enter_behaviour_popover.hbs");
/* harmony import */ var _templates_compose_select_enter_behaviour_popover_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_compose_select_enter_behaviour_popover_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_left_sidebar_stream_setting_popover_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/left_sidebar_stream_setting_popover.hbs */ "./static/templates/left_sidebar_stream_setting_popover.hbs");
/* harmony import */ var _templates_left_sidebar_stream_setting_popover_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_left_sidebar_stream_setting_popover_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_mobile_message_buttons_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/mobile_message_buttons_popover_content.hbs */ "./static/templates/mobile_message_buttons_popover_content.hbs");
/* harmony import */ var _templates_mobile_message_buttons_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_mobile_message_buttons_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _emoji_picker__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./emoji_picker */ "./static/js/emoji_picker.js");
/* harmony import */ var _giphy__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./giphy */ "./static/js/giphy.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_edit_history__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_edit_history */ "./static/js/message_edit_history.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _popover_menus_data__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./popover_menus_data */ "./static/js/popover_menus_data.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _read_receipts__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./read_receipts */ "./static/js/read_receipts.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* Module for popovers that have been ported to the modern
   TippyJS/Popper popover library from the legacy Bootstrap
   popovers system in popovers.js. */
































let left_sidebar_stream_setting_popover_displayed = false;
let compose_mobile_button_popover_displayed = false;
let compose_enter_sends_popover_displayed = false;
let compose_control_buttons_popover_instance;
let message_actions_popover_displayed = false;
let message_actions_popover_keyboard_toggle = false;

function actions_popped() {
    return message_actions_popover_displayed;
}

function get_compose_control_buttons_popover() {
    return compose_control_buttons_popover_instance;
}

const default_popover_props = {
    delay: 0,
    appendTo: () => document.body,
    trigger: "click",
    interactive: true,
    hideOnClick: true,
    /* The light-border TippyJS theme is a bit of a misnomer; it
       is a popover styling similar to Bootstrap.  We've also customized
       its CSS to support Zulip's dark theme. */
    theme: "light-border",
    touch: true,
    /* Don't use allow-HTML here since it is unsafe. Instead, use `parse_html`
       to generate the required html */
};

function any_active() {
    return (
        left_sidebar_stream_setting_popover_displayed ||
        compose_mobile_button_popover_displayed ||
        compose_control_buttons_popover_instance ||
        compose_enter_sends_popover_displayed ||
        message_actions_popover_displayed
    );
}

function on_show_prep(instance) {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.popper).on("click", (e) => {
        // Popover is not hidden on click inside it unless the click handler for the
        // element explicitly hides the popover when handling the event.
        // `stopPropagation` is required here to avoid global click handlers from
        // being triggered.
        e.stopPropagation();
    });
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.popper).one("click", ".navigate_and_close_popover", (e) => {
        // Handler for links inside popover which don't need a special click handler.
        e.stopPropagation();
        instance.hide();
    });
    _popovers__WEBPACK_IMPORTED_MODULE_18__.hide_all_except_sidebars();
}

function tippy_no_propagation(target, popover_props) {
    // For some elements, such as the click target to open the message
    // actions menu, we want to avoid propagating the click event to
    // parent elements. Tippy's built-in `delegate` method does not
    // have an option to do stopPropagation, so we use this method to
    // open the Tippy popovers associated with such elements.
    //
    // A click on the click target will close the menu; for this to
    // work correctly without leaking, all callers need call
    // `instance.destroy()` inside their `onHidden` handler.
    //
    // TODO: Should we instead we wrap the caller's `onHidden` hook,
    // if any, to add `instance.destroy()`?
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", target, (e) => {
        e.preventDefault();
        e.stopPropagation();
        const instance = e.currentTarget._tippy;

        if (instance) {
            instance.hide();
            return;
        }

        (0,tippy_js__WEBPACK_IMPORTED_MODULE_23__["default"])(e.currentTarget, {
            ...default_popover_props,
            showOnCreate: true,
            ...popover_props,
        });
    });
}

function toggle_message_actions_menu(message) {
    if (message.locally_echoed) {
        // Don't open the popup for locally echoed messages for now.
        // It creates bugs with things like keyboard handlers when
        // we get the server response.
        return true;
    }

    const $popover_reference = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".selected_message .actions_hover .zulip-icon-ellipsis-v-solid");
    message_actions_popover_keyboard_toggle = true;
    $popover_reference.trigger("click");
    return true;
}

function initialize() {
    tippy_no_propagation("#streams_inline_icon", {
        onShow(instance) {
            const can_create_streams =
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
            on_show_prep(instance);

            if (!can_create_streams) {
                // If the user can't create streams, we directly
                // navigate them to the Manage streams subscribe UI.
                window.location.assign("#streams/all");
                // Returning false from an onShow handler cancels the show.
                return false;
            }

            instance.setContent(Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_templates_left_sidebar_stream_setting_popover_hbs__WEBPACK_IMPORTED_MODULE_5___default()()));
            left_sidebar_stream_setting_popover_displayed = true;
            return true;
        },
        onHidden(instance) {
            instance.destroy();
            left_sidebar_stream_setting_popover_displayed = false;
        },
    });

    // compose box buttons popover shown on mobile widths.
    // We want this click event to propagate and hide other popovers
    // that could possibly obstruct user from using this popover.
    (0,tippy_js__WEBPACK_IMPORTED_MODULE_23__.delegate)("body", {
        ...default_popover_props,
        target: ".compose_mobile_button",
        placement: "top",
        onShow(instance) {
            on_show_prep(instance);
            instance.setContent(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _templates_mobile_message_buttons_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
                        is_in_private_narrow: _narrow_state__WEBPACK_IMPORTED_MODULE_16__.narrowed_to_pms(),
                    }),
                ),
            );
            compose_mobile_button_popover_displayed = true;
        },
        onMount(instance) {
            const $popper = jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.popper);
            $popper.one("click", ".compose_mobile_stream_button", (e) => {
                _compose_actions__WEBPACK_IMPORTED_MODULE_9__.start("stream", {trigger: "new topic button"});
                e.stopPropagation();
                instance.hide();
            });
            $popper.one("click", ".compose_mobile_private_button", (e) => {
                _compose_actions__WEBPACK_IMPORTED_MODULE_9__.start("private");
                e.stopPropagation();
                instance.hide();
            });
        },
        onHidden(instance) {
            // Destroy instance so that event handlers
            // are destroyed too.
            instance.destroy();
            compose_mobile_button_popover_displayed = false;
        },
    });

    // Click event handlers for it are handled in `compose_ui` and
    // we don't want to close this popover on click inside it but
    // only if user clicked outside it.
    tippy_no_propagation(".compose_control_menu_wrapper", {
        placement: "top",
        onShow(instance) {
            instance.setContent(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _templates_compose_control_buttons_popover_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                        giphy_enabled: _giphy__WEBPACK_IMPORTED_MODULE_12__.is_giphy_enabled(),
                    }),
                ),
            );
            compose_control_buttons_popover_instance = instance;
            _popovers__WEBPACK_IMPORTED_MODULE_18__.hide_all_except_sidebars();
        },
        onHidden(instance) {
            instance.destroy();
            compose_control_buttons_popover_instance = undefined;
        },
    });

    tippy_no_propagation(".enter_sends", {
        placement: "top",
        onShow(instance) {
            on_show_prep(instance);
            instance.setContent(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _templates_compose_select_enter_behaviour_popover_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
                        enter_sends_true: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                    }),
                ),
            );
            compose_enter_sends_popover_displayed = true;
        },
        onMount(instance) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(".enter_sends_choices kbd");

            jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.popper).one("click", ".enter_sends_choice", (e) => {
                let selected_behaviour = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget)
                    .find("input[type='radio']")
                    .attr("value");
                selected_behaviour = selected_behaviour === "true"; // Convert to bool
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = selected_behaviour;
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(`.enter_sends_${!selected_behaviour}`).hide();
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(`.enter_sends_${selected_behaviour}`).show();

                // Refocus in the content box so you can continue typing or
                // press Enter to send.
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").trigger("focus");

                _channel__WEBPACK_IMPORTED_MODULE_7__.patch({
                    url: "/json/settings",
                    data: {enter_sends: selected_behaviour},
                });
                e.stopPropagation();
                instance.hide();
            });
        },
        onHidden(instance) {
            instance.destroy();
            compose_enter_sends_popover_displayed = false;
        },
    });

    tippy_no_propagation(".actions_hover .zulip-icon-ellipsis-v-solid", {
        // The is our minimum supported width for mobile. We shouldn't
        // make the popover wider than this.
        maxWidth: "320px",
        placement: "bottom",
        popperOptions: {
            modifiers: [
                {
                    // The placement is set to bottom, but if that placement does not fit,
                    // the opposite top placement will be used.
                    name: "flip",
                    options: {
                        fallbackPlacements: ["top", "left"],
                    },
                },
            ],
        },
        onShow(instance) {
            on_show_prep(instance);
            const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.reference).closest(".message_row");
            const message_id = _rows__WEBPACK_IMPORTED_MODULE_20__.id($row);
            _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.select_id(message_id);
            const args = _popover_menus_data__WEBPACK_IMPORTED_MODULE_17__.get_actions_popover_content_context(message_id);
            instance.setContent(Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_templates_actions_popover_content_hbs__WEBPACK_IMPORTED_MODULE_2___default()(args)));
            $row.addClass("has_popover has_actions_popover");
            message_actions_popover_displayed = true;
        },
        onMount(instance) {
            if (message_actions_popover_keyboard_toggle) {
                _popovers__WEBPACK_IMPORTED_MODULE_18__.focus_first_action_popover_item();
            }
            message_actions_popover_keyboard_toggle = false;

            // We want click events to propagate to `instance` so that
            // instance.hide gets called.
            const $popper = jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.popper);
            $popper.one("click", ".respond_button", (e) => {
                // Arguably, we should fetch the message ID to respond to from
                // e.target, but that should always be the current selected
                // message in the current message list (and
                // compose_actions.respond_to_message doesn't take a message
                // argument).
                _compose_actions__WEBPACK_IMPORTED_MODULE_9__.quote_and_reply({trigger: "popover respond"});
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".popover_edit_message, .popover_view_source", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                const $row = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get_row(message_id);
                _message_edit__WEBPACK_IMPORTED_MODULE_13__.start($row);
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".popover_move_message", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                const message = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get(message_id);
                _stream_popover__WEBPACK_IMPORTED_MODULE_21__.build_move_topic_to_stream_popover(
                    message.stream_id,
                    message.topic,
                    message,
                );
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".mark_as_unread", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                _unread_ops__WEBPACK_IMPORTED_MODULE_22__.mark_as_unread_from_here(message_id);
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".popover_toggle_collapse", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                const $row = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get_row(message_id);
                const message = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get(_rows__WEBPACK_IMPORTED_MODULE_20__.id($row));
                if ($row) {
                    if (message.collapsed) {
                        _condense__WEBPACK_IMPORTED_MODULE_10__.uncollapse($row);
                    } else {
                        _condense__WEBPACK_IMPORTED_MODULE_10__.collapse($row);
                    }
                }
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".rehide_muted_user_message", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                const $row = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get_row(message_id);
                const message = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get(_rows__WEBPACK_IMPORTED_MODULE_20__.id($row));
                const message_container = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.view.message_containers.get(
                    message.id,
                );
                if ($row && !message_container.is_hidden) {
                    _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.view.hide_revealed_message(message_id);
                }
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".view_edit_history", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                const $row = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get_row(message_id);
                const message = _message_lists__WEBPACK_IMPORTED_MODULE_15__.current.get(_rows__WEBPACK_IMPORTED_MODULE_20__.id($row));
                _message_edit_history__WEBPACK_IMPORTED_MODULE_14__.show_history(message);
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#message-history-cancel").trigger("focus");
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".view_read_receipts", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                _read_receipts__WEBPACK_IMPORTED_MODULE_19__.show_user_list(message_id);
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".delete_message", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                _message_edit__WEBPACK_IMPORTED_MODULE_13__.delete_message(message_id);
                e.preventDefault();
                e.stopPropagation();
                instance.hide();
            });

            $popper.one("click", ".reaction_button", (e) => {
                const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).data("message-id");
                // Don't propagate the click event since `toggle_emoji_popover` opens a
                // emoji_picker which we don't want to hide after actions popover is hidden.
                e.stopPropagation();
                e.preventDefault();
                _emoji_picker__WEBPACK_IMPORTED_MODULE_11__.toggle_emoji_popover(
                    instance.reference.parentElement,
                    message_id,
                    true,
                );
                instance.hide();
            });

            new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())($popper.find(".copy_link")[0]).on("success", (e) => {
                // e.trigger returns the DOM element triggering the copy action
                const message_id = e.trigger.dataset.messageId;
                const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(`[zid='${CSS.escape(message_id)}']`);
                $row.find(".alert-msg")
                    .text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Copied!"}))
                    .css("display", "block")
                    .delay(1000)
                    .fadeOut(300);

                setTimeout(() => {
                    // The Clipboard library works by focusing to a hidden textarea.
                    // We unfocus this so keyboard shortcuts, etc., will work again.
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()(":focus").trigger("blur");
                }, 0);
                instance.hide();
            });
        },
        onHidden(instance) {
            const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(instance.reference).closest(".message_row");
            $row.removeClass("has_popover has_actions_popover");
            instance.destroy();
            message_actions_popover_displayed = false;
            message_actions_popover_keyboard_toggle = false;
        },
    });
}


/***/ }),

/***/ "./static/js/popover_menus_data.js":
/*!*****************************************!*\
  !*** ./static/js/popover_menus_data.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_actions_popover_content_context": () => (/* binding */ get_actions_popover_content_context)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './feature_flags'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* This module provides relevant data to render popovers that require multiple args.
   This helps keep the popovers code small and keep it focused on rendering side of things. */











function get_actions_popover_content_context(message_id) {
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.get(message_id);
    const message_container = _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.view.message_containers.get(message.id);
    const not_spectator = !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const should_display_hide_option =
        _muted_users__WEBPACK_IMPORTED_MODULE_4__.is_user_muted(message.sender_id) &&
        !message_container.is_hidden &&
        not_spectator;
    const is_content_editable = _message_edit__WEBPACK_IMPORTED_MODULE_2__.is_content_editable(message);
    const can_move_message = _message_edit__WEBPACK_IMPORTED_MODULE_2__.can_move_message(message);

    let editability_menu_item;
    let move_message_menu_item;
    let view_source_menu_item;

    if (is_content_editable) {
        editability_menu_item = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Edit message"});
    } else {
        view_source_menu_item = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "View message source"});
    }

    if (can_move_message) {
        move_message_menu_item = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Move messages"});
    }

    // We do not offer "Mark as unread" on messages in streams
    // that the user is not currently subscribed to. Zulip has an
    // invariant that all unread messages must be in streams the
    // user is subscribed to, and so the server will ignore any
    // messages in such streams; it's better to hint this is not
    // useful by not offering the option.
    //
    // We also require that the message is currently marked as
    // read. Theoretically, it could be useful to offer this even
    // for a message that is already unread, so you can mark those
    // below it as unread; but that's an unlikely situation, and
    // showing it can be a confusing source of clutter. We may
    // want to revise this algorithm specifically in the context
    // of interleaved views.
    //
    // To work around #22893, we also only offer the option if the
    // fetch_status data structure means we'll be able to mark
    // everything below the current message as read correctly.
    const not_stream_message = message.type !== "stream";
    const subscribed_to_stream =
        message.type === "stream" && _stream_data__WEBPACK_IMPORTED_MODULE_6__.is_subscribed(message.stream_id);
    const should_display_mark_as_unread =
        !message.unread && not_spectator && (not_stream_message || subscribed_to_stream);

    const should_display_edit_history_option =
        message.edit_history &&
        message.edit_history.some(
            (entry) =>
                entry.prev_content !== undefined ||
                entry.prev_stream !== undefined ||
                entry.prev_topic !== undefined,
        ) &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        not_spectator;

    // Disabling this for /me messages is a temporary workaround
    // for the fact that we don't have a styling for how that
    // should look.  See also condense.js.
    const should_display_collapse =
        !message.locally_echoed && !message.is_me_message && !message.collapsed && not_spectator;
    const should_display_uncollapse =
        !message.locally_echoed && !message.is_me_message && message.collapsed;

    const should_display_quote_and_reply = message.content !== "<p>(deleted)</p>" && not_spectator;

    const conversation_time_uri = _hash_util__WEBPACK_IMPORTED_MODULE_1__.by_conversation_and_time_url(message);

    const should_display_delete_option = _message_edit__WEBPACK_IMPORTED_MODULE_2__.get_deletability(message) && not_spectator;
    const should_display_read_receipts_option =
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && not_spectator;

    return {
        message_id: message.id,
        stream_id: message.stream_id,
        editability_menu_item,
        move_message_menu_item,
        should_display_mark_as_unread,
        view_source_menu_item,
        should_display_collapse,
        should_display_uncollapse,
        should_display_add_reaction_option: message.sent_by_me,
        should_display_edit_history_option,
        should_display_hide_option,
        conversation_time_uri,
        narrowed: _narrow_state__WEBPACK_IMPORTED_MODULE_5__.active(),
        should_display_delete_option,
        should_display_read_receipts_option,
        should_display_reminder_option: Object(function webpackMissingModule() { var e = new Error("Cannot find module './feature_flags'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        should_display_quote_and_reply,
    };
}


/***/ }),

/***/ "./static/js/popovers.js":
/*!*******************************!*\
  !*** ./static/js/popovers.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_test_calculate_info_popover_placement": () => (/* binding */ _test_calculate_info_popover_placement),
/* harmony export */   "_test_fetch_group_members": () => (/* binding */ _test_fetch_group_members),
/* harmony export */   "_test_sort_group_members": () => (/* binding */ _test_sort_group_members),
/* harmony export */   "actions_menu_handle_keyboard": () => (/* binding */ actions_menu_handle_keyboard),
/* harmony export */   "any_active": () => (/* binding */ any_active),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "clipboard_enable": () => (/* binding */ clipboard_enable),
/* harmony export */   "compute_placement": () => (/* binding */ compute_placement),
/* harmony export */   "elem_to_user_id": () => (/* binding */ elem_to_user_id),
/* harmony export */   "focus_first_action_popover_item": () => (/* binding */ focus_first_action_popover_item),
/* harmony export */   "focus_first_popover_item": () => (/* binding */ focus_first_popover_item),
/* harmony export */   "hide_all": () => (/* binding */ hide_all),
/* harmony export */   "hide_all_except_sidebars": () => (/* binding */ hide_all_except_sidebars),
/* harmony export */   "hide_message_info_popover": () => (/* binding */ hide_message_info_popover),
/* harmony export */   "hide_playground_links_popover": () => (/* binding */ hide_playground_links_popover),
/* harmony export */   "hide_pm_list_sidebar": () => (/* binding */ hide_pm_list_sidebar),
/* harmony export */   "hide_user_info_popover": () => (/* binding */ hide_user_info_popover),
/* harmony export */   "hide_user_info_popover_manage_menu": () => (/* binding */ hide_user_info_popover_manage_menu),
/* harmony export */   "hide_user_sidebar_popover": () => (/* binding */ hide_user_sidebar_popover),
/* harmony export */   "hide_userlist_sidebar": () => (/* binding */ hide_userlist_sidebar),
/* harmony export */   "message_info_popped": () => (/* binding */ message_info_popped),
/* harmony export */   "popover_items_handle_keyboard": () => (/* binding */ popover_items_handle_keyboard),
/* harmony export */   "register_click_handlers": () => (/* binding */ register_click_handlers),
/* harmony export */   "set_suppress_scroll_hide": () => (/* binding */ set_suppress_scroll_hide),
/* harmony export */   "set_userlist_placement": () => (/* binding */ set_userlist_placement),
/* harmony export */   "show_sender_info": () => (/* binding */ show_sender_info),
/* harmony export */   "show_user_info_popover": () => (/* binding */ show_user_info_popover),
/* harmony export */   "show_userlist_sidebar": () => (/* binding */ show_userlist_sidebar),
/* harmony export */   "toggle_playground_link_popover": () => (/* binding */ toggle_playground_link_popover),
/* harmony export */   "user_info_manage_menu_popped": () => (/* binding */ user_info_manage_menu_popped),
/* harmony export */   "user_info_popover_for_message_handle_keyboard": () => (/* binding */ user_info_popover_for_message_handle_keyboard),
/* harmony export */   "user_info_popover_handle_keyboard": () => (/* binding */ user_info_popover_handle_keyboard),
/* harmony export */   "user_info_popover_manage_menu_handle_keyboard": () => (/* binding */ user_info_popover_manage_menu_handle_keyboard),
/* harmony export */   "user_info_popped": () => (/* binding */ user_info_popped),
/* harmony export */   "user_sidebar_popover_handle_keyboard": () => (/* binding */ user_sidebar_popover_handle_keyboard),
/* harmony export */   "user_sidebar_popped": () => (/* binding */ user_sidebar_popped)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/parseISO/index.js");
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/formatISO/index.js");
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/add/index.js");
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/set/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var tippy_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! tippy.js */ "./node_modules/tippy.js/dist/tippy.esm.js");
/* harmony import */ var _templates_no_arrow_popover_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/no_arrow_popover.hbs */ "./static/templates/no_arrow_popover.hbs");
/* harmony import */ var _templates_no_arrow_popover_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_no_arrow_popover_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_playground_links_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/playground_links_popover_content.hbs */ "./static/templates/playground_links_popover_content.hbs");
/* harmony import */ var _templates_playground_links_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_playground_links_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_user_group_info_popover_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/user_group_info_popover.hbs */ "./static/templates/user_group_info_popover.hbs");
/* harmony import */ var _templates_user_group_info_popover_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_info_popover_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_user_group_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/user_group_info_popover_content.hbs */ "./static/templates/user_group_info_popover_content.hbs");
/* harmony import */ var _templates_user_group_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_user_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/user_info_popover_content.hbs */ "./static/templates/user_info_popover_content.hbs");
/* harmony import */ var _templates_user_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_user_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_user_info_popover_manage_menu_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/user_info_popover_manage_menu.hbs */ "./static/templates/user_info_popover_manage_menu.hbs");
/* harmony import */ var _templates_user_info_popover_manage_menu_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_user_info_popover_manage_menu_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _templates_user_info_popover_title_hbs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../templates/user_info_popover_title.hbs */ "./static/templates/user_info_popover_title.hbs");
/* harmony import */ var _templates_user_info_popover_title_hbs__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_templates_user_info_popover_title_hbs__WEBPACK_IMPORTED_MODULE_8__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _emoji_picker__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./emoji_picker */ "./static/js/emoji_picker.js");
/* harmony import */ var _giphy__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./giphy */ "./static/js/giphy.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _muted_users_ui__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./muted_users_ui */ "./static/js/muted_users_ui.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popover_menus__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./popover_menus */ "./static/js/popover_menus.js");
/* harmony import */ var _realm_playground__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./realm_playground */ "./static/js/realm_playground.js");
/* harmony import */ var _reminder__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./reminder */ "./static/js/reminder.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _rows__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./rows */ "./static/js/rows.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_users__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./settings_users */ "./static/js/settings_users.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_profile__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./user_profile */ "./static/js/user_profile.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");
/* harmony import */ var _user_status_ui__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./user_status_ui */ "./static/js/user_status_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


















































let $current_message_info_popover_elem;
let $current_user_info_popover_elem;
let $current_user_info_popover_manage_menu;
let $current_playground_links_popover_elem;
let userlist_placement = "right";

let list_of_popovers = [];

function clear_for_testing() {
    $current_message_info_popover_elem = undefined;
    $current_user_info_popover_elem = undefined;
    $current_user_info_popover_manage_menu = undefined;
    $current_playground_links_popover_elem = undefined;
    list_of_popovers.length = 0;
    userlist_placement = "right";
}

function clipboard_enable(arg) {
    // arg is a selector or element
    // We extract this function for testing purpose.
    return new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())(arg);
}

function elem_to_user_id($elem) {
    return Number.parseInt($elem.attr("data-user-id"), 10);
}

// this utilizes the proxy pattern to intercept all calls to $.fn.popover
// and push the $.fn.data($o, "popover") results to an array.
// this is needed so that when we try to unload popovers, we can kill all dead
// ones that no longer have valid parents in the DOM.
const old_popover = (jquery__WEBPACK_IMPORTED_MODULE_1___default().fn.popover);
(jquery__WEBPACK_IMPORTED_MODULE_1___default().fn.popover) = Object.assign(function (...args) {
    // apply the jQuery object as `this`, and popover function arguments.
    old_popover.apply(this, args);

    // if there is a valid "popover" key in the jQuery data object then
    // push it to the array.
    if (this.data("popover")) {
        list_of_popovers.push(this.data("popover"));
    }
}, old_popover);

function copy_email_handler(e) {
    const $email_el = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.trigger.parentElement);
    const $copy_icon = $email_el.find("i");

    // only change the parent element's text back to email
    // and not overwrite the tooltip.
    const email_textnode = $email_el[0].childNodes[2];

    $email_el.addClass("email_copied");
    email_textnode.nodeValue = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Email copied"});

    setTimeout(() => {
        $email_el.removeClass("email_copied");
        email_textnode.nodeValue = $copy_icon.attr("data-clipboard-text");
    }, 1500);
    e.clearSelection();
}

function init_email_clipboard() {
    /*
        This shows (and enables) the copy-text icon for folks
        who have names that would overflow past the right
        edge of our user mention popup.
    */
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".user_popover_email").each(function () {
        if (this.clientWidth < this.scrollWidth) {
            const $email_el = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this);
            const $copy_email_icon = $email_el.find("i");

            /*
                For deactivated users, the copy-email icon will
                not even be present in the HTML, so we don't do
                anything.  We don't reveal emails for deactivated
                users.
            */
            if ($copy_email_icon[0]) {
                $copy_email_icon.removeClass("hide_copy_icon");
                const copy_email_clipboard = clipboard_enable($copy_email_icon[0]);
                copy_email_clipboard.on("success", copy_email_handler);
            }
        }
    });
}

function init_email_tooltip(user) {
    /*
        This displays the email tooltip for folks
        who have names that would overflow past the right
        edge of our user mention popup.
    */

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".user_popover_email").each(function () {
        if (this.clientWidth < this.scrollWidth) {
            (0,tippy_js__WEBPACK_IMPORTED_MODULE_37__["default"])(this, {
                placement: "bottom",
                content: _people__WEBPACK_IMPORTED_MODULE_25__.get_visible_email(user),
                interactive: true,
            });
        }
    });
}

function load_medium_avatar(user, $elt) {
    const user_avatar_url = _people__WEBPACK_IMPORTED_MODULE_25__.medium_avatar_url_for_person(user);
    const sender_avatar_medium = new Image();

    sender_avatar_medium.src = user_avatar_url;
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(sender_avatar_medium).on("load", function () {
        $elt.css("background-image", "url(" + jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("src") + ")");
    });
}

function calculate_info_popover_placement(size, $elt) {
    const ypos = $elt.offset().top;

    if (!(ypos + size / 2 < _message_viewport__WEBPACK_IMPORTED_MODULE_20__.height() && ypos > size / 2)) {
        if (ypos + size < _message_viewport__WEBPACK_IMPORTED_MODULE_20__.height()) {
            return "bottom";
        } else if (ypos > size) {
            return "top";
        }
    }

    return undefined;
}

function hide_user_info_popover_manage_menu() {
    if ($current_user_info_popover_manage_menu !== undefined) {
        $current_user_info_popover_manage_menu.popover("destroy");
        $current_user_info_popover_manage_menu = undefined;
    }
}

function show_user_info_popover_manage_menu(element, user) {
    const $last_popover_elem = $current_user_info_popover_manage_menu;
    hide_user_info_popover_manage_menu();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        return;
    }

    const is_me = _people__WEBPACK_IMPORTED_MODULE_25__.is_my_user_id(user.user_id);
    const is_muted = _muted_users__WEBPACK_IMPORTED_MODULE_21__.is_user_muted(user.user_id);
    const is_system_bot = user.is_system_bot;
    const muting_allowed = !is_me && !user.is_bot;

    const args = {
        can_mute: muting_allowed && !is_muted,
        can_manage_user: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !is_me && !is_system_bot,
        can_unmute: muting_allowed && is_muted,
        is_active: _people__WEBPACK_IMPORTED_MODULE_25__.is_active_user_for_popover(user.user_id),
        is_bot: user.is_bot,
        user_id: user.user_id,
    };

    const $popover_elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(element);
    $popover_elt.popover({
        content: _templates_user_info_popover_manage_menu_hbs__WEBPACK_IMPORTED_MODULE_7___default()(args),
        placement: "bottom",
        html: true,
        trigger: "manual",
    });

    $popover_elt.popover("show");
    $current_user_info_popover_manage_menu = $popover_elt;
}

function render_user_info_popover(
    user,
    popover_element,
    is_sender_popover,
    has_message_context,
    private_msg_class,
    template_class,
    popover_placement,
) {
    const is_me = _people__WEBPACK_IMPORTED_MODULE_25__.is_my_user_id(user.user_id);

    let invisible_mode = false;

    if (is_me) {
        invisible_mode = !Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    const muting_allowed = !is_me && !user.is_bot;
    const is_active = _people__WEBPACK_IMPORTED_MODULE_25__.is_active_user_for_popover(user.user_id);
    const is_system_bot = user.is_system_bot;
    const status_text = _user_status__WEBPACK_IMPORTED_MODULE_35__.get_status_text(user.user_id);
    const status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_35__.get_status_emoji(user.user_id);
    const spectator_view = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    // TODO: The show_manage_menu calculation can get a lot simpler
    // if/when we allow muting bot users.
    const can_manage_user = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !is_me && !is_system_bot;
    const show_manage_menu = !spectator_view && (muting_allowed || can_manage_user);

    let date_joined;
    if (spectator_view) {
        const dateFormat = new Intl.DateTimeFormat("default", {dateStyle: "long"});
        date_joined = dateFormat.format((0,date_fns__WEBPACK_IMPORTED_MODULE_38__["default"])(user.date_joined));
    }
    // Filtering out only those profile fields that can be display in the popover and are not empty.
    const dateFormat = new Intl.DateTimeFormat("default", {dateStyle: "long"});
    const field_types = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const display_profile_fields = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())((f) => _user_profile__WEBPACK_IMPORTED_MODULE_34__.get_custom_profile_field_data(user, f, field_types, dateFormat))
        .filter((f) => f.display_in_profile_summary && f.value !== undefined && f.value !== null);

    const args = {
        invisible_mode,
        can_send_private_message:
            is_active &&
            !is_me &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !==
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        display_profile_fields,
        has_message_context,
        is_active,
        is_bot: user.is_bot,
        is_me,
        is_sender_popover,
        pm_with_url: _hash_util__WEBPACK_IMPORTED_MODULE_18__.pm_with_url(user.email),
        user_circle_class: _buddy_data__WEBPACK_IMPORTED_MODULE_10__.get_user_circle_class(user.user_id),
        private_message_class: private_msg_class,
        sent_by_uri: _hash_util__WEBPACK_IMPORTED_MODULE_18__.by_sender_url(user.email),
        show_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        show_manage_menu,
        user_email: _people__WEBPACK_IMPORTED_MODULE_25__.get_visible_email(user),
        user_full_name: user.full_name,
        user_id: user.user_id,
        user_last_seen_time_status: _buddy_data__WEBPACK_IMPORTED_MODULE_10__.user_last_seen_time_status(user.user_id),
        user_time: _people__WEBPACK_IMPORTED_MODULE_25__.get_user_time(user.user_id),
        user_type: _people__WEBPACK_IMPORTED_MODULE_25__.get_user_type(user.user_id),
        status_content_available: Boolean(status_text || status_emoji_info),
        status_text,
        status_emoji_info,
        user_mention_syntax: _people__WEBPACK_IMPORTED_MODULE_25__.get_mention_syntax(user.full_name, user.user_id),
        date_joined,
        spectator_view,
    };

    if (user.is_bot) {
        const bot_owner_id = user.bot_owner_id;
        if (is_system_bot) {
            args.is_system_bot = is_system_bot;
        } else if (bot_owner_id) {
            const bot_owner = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(bot_owner_id);
            args.bot_owner = bot_owner;
        }
    }

    const $popover_content = jquery__WEBPACK_IMPORTED_MODULE_1___default()(_templates_user_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_6___default()(args));
    popover_element.popover({
        content: $popover_content.get(0),
        // TODO: Determine whether `fixed` should be applied
        // unconditionally.  Right now, we only do it for the user
        // sidebar version of the popover.
        fixed: template_class === "user_popover",
        placement: popover_placement,
        template: _templates_no_arrow_popover_hbs__WEBPACK_IMPORTED_MODULE_2___default()({class: template_class}),
        title: _templates_user_info_popover_title_hbs__WEBPACK_IMPORTED_MODULE_8___default()({
            // See the load_medium_avatar comment for important background.
            user_avatar: _people__WEBPACK_IMPORTED_MODULE_25__.small_avatar_url_for_person(user),
            user_is_guest: user.is_guest,
        }),
        html: true,
        trigger: "manual",
        top_offset: jquery__WEBPACK_IMPORTED_MODULE_1___default()("#userlist-title").offset().top + 15,
        fix_positions: true,
    });
    popover_element.popover("show");

    init_email_clipboard();
    init_email_tooltip(user);
    const $user_name_element = $popover_content.find(".user_full_name");
    const $bot_owner_element = $popover_content.find(".bot_owner");
    if ($user_name_element.prop("clientWidth") < $user_name_element.prop("scrollWidth")) {
        $user_name_element.addClass("tippy-zulip-tooltip");
    }
    if (
        args.bot_owner &&
        $bot_owner_element.prop("clientWidth") < $bot_owner_element.prop("scrollWidth")
    ) {
        $bot_owner_element.addClass("tippy-zulip-tooltip");
    }

    // Note: We pass the normal-size avatar in initial rendering, and
    // then query the server to replace it with the medium-size
    // avatar.  The purpose of this double-fetch approach is to take
    // advantage of the fact that the browser should already have the
    // low-resolution image cached and thus display a low-resolution
    // avatar rather than a blank area during the network delay for
    // fetching the medium-size one.
    load_medium_avatar(user, jquery__WEBPACK_IMPORTED_MODULE_1___default()(".popover-avatar"));
}

// exporting for testability
const _test_calculate_info_popover_placement = calculate_info_popover_placement;

// element is the target element to pop off of
// user is the user whose profile to show
// message is the message containing it, which should be selected
function show_user_info_popover_for_message(element, user, message) {
    const $last_popover_elem = $current_message_info_popover_elem;
    hide_all();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        // We want it to be the case that a user can dismiss a popover
        // by clicking on the same element that caused the popover.
        return;
    }
    _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.select_id(message.id);
    const $elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(element);
    if ($elt.data("popover") === undefined) {
        if (user === undefined) {
            // This is never supposed to happen, not even for deactivated
            // users, so we'll need to debug this error if it occurs.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Bad sender in message" + message.sender_id);
            return;
        }

        const is_sender_popover = message.sender_id === user.user_id;
        render_user_info_popover(
            user,
            $elt,
            is_sender_popover,
            true,
            "respond_personal_button",
            "message-info-popover",
            "right",
        );

        $current_message_info_popover_elem = $elt;
    }
}

function show_user_info_popover(element, user) {
    const $last_popover_elem = $current_user_info_popover_elem;
    hide_all();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        return;
    }
    const $elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(element);
    render_user_info_popover(
        user,
        $elt,
        false,
        false,
        "compose_private_message",
        "user-info-popover",
        "right",
    );
    $current_user_info_popover_elem = $elt;
}

function get_user_info_popover_for_message_items() {
    if (!$current_message_info_popover_elem) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when action popover is closed.");
        return undefined;
    }

    const popover_data = $current_message_info_popover_elem.data("popover");
    if (!popover_data) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find popover data for actions menu.");
        return undefined;
    }

    return jquery__WEBPACK_IMPORTED_MODULE_1___default()("li:not(.divider):visible a", popover_data.$tip);
}

function get_user_info_popover_items() {
    const $popover_elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()("div.user-info-popover");
    if (!$current_user_info_popover_elem || !$popover_elt.length) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when action popover is closed.");
        return undefined;
    }

    if ($popover_elt.length >= 2) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("More than one user info popovers cannot be opened at same time.");
        return undefined;
    }

    return jquery__WEBPACK_IMPORTED_MODULE_1___default()("li:not(.divider):visible a", $popover_elt);
}

function get_user_info_popover_manage_menu_items() {
    if (!$current_user_info_popover_manage_menu) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when action popover is closed.");
        return undefined;
    }

    const popover_data = $current_user_info_popover_manage_menu.data("popover");
    if (!popover_data) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find popover data for actions menu.");
        return undefined;
    }

    return jquery__WEBPACK_IMPORTED_MODULE_1___default()(".user_info_popover_manage_menu li:not(.divider):visible a", popover_data.$tip);
}

function fetch_group_members(member_ids) {
    return member_ids
        .map((m) => _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(m))
        .filter((m) => m !== undefined)
        .map((p) => ({
            ...p,
            user_circle_class: _buddy_data__WEBPACK_IMPORTED_MODULE_10__.get_user_circle_class(p.user_id),
            is_active: _people__WEBPACK_IMPORTED_MODULE_25__.is_active_user_for_popover(p.user_id),
            user_last_seen_time_status: _buddy_data__WEBPACK_IMPORTED_MODULE_10__.user_last_seen_time_status(p.user_id),
        }));
}

function sort_group_members(members) {
    return members.sort((a, b) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.full_name, b.fullname));
}

// exporting these functions for testing purposes
const _test_fetch_group_members = fetch_group_members;

const _test_sort_group_members = sort_group_members;

// element is the target element to pop off of
// user is the user whose profile to show
// message is the message containing it, which should be selected
function show_user_group_info_popover(element, group, message) {
    const $last_popover_elem = $current_message_info_popover_elem;
    // hardcoded pixel height of the popover
    // note that the actual size varies (in group size), but this is about as big as it gets
    const popover_size = 390;
    hide_all();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        // We want it to be the case that a user can dismiss a popover
        // by clicking on the same element that caused the popover.
        return;
    }
    _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.select_id(message.id);
    const $elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(element);
    if ($elt.data("popover") === undefined) {
        const args = {
            group_name: group.name,
            group_description: group.description,
            members: sort_group_members(fetch_group_members(Array.from(group.members))),
        };
        $elt.popover({
            placement: calculate_info_popover_placement(popover_size, $elt),
            template: _templates_user_group_info_popover_hbs__WEBPACK_IMPORTED_MODULE_4___default()({class: "message-info-popover"}),
            content: _templates_user_group_info_popover_content_hbs__WEBPACK_IMPORTED_MODULE_5___default()(args),
            html: true,
            trigger: "manual",
        });
        $elt.popover("show");
        $current_message_info_popover_elem = $elt;
    }
}

function get_action_menu_menu_items() {
    const $current_actions_popover_elem = jquery__WEBPACK_IMPORTED_MODULE_1___default()("[data-tippy-root] .actions_popover");
    if (!$current_actions_popover_elem) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when action popover is closed.");
        return undefined;
    }

    return $current_actions_popover_elem.find("li:not(.divider):visible a");
}

function focus_first_popover_item($items, index = 0) {
    if (!$items) {
        return;
    }

    $items.eq(index).expectOne().trigger("focus");
}

function popover_items_handle_keyboard(key, $items) {
    if (!$items) {
        return;
    }

    let index = $items.index($items.filter(":focus"));

    if (key === "enter" && index >= 0 && index < $items.length) {
        $items[index].click();
        if ($current_user_info_popover_manage_menu) {
            const $items = get_user_info_popover_manage_menu_items();
            focus_first_popover_item($items);
        }
        return;
    }
    if (index === -1) {
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".user_info_popover_manage_menu_btn").is(":visible")) {
            index = 1;
        } else {
            index = 0;
        }
    } else if ((key === "down_arrow" || key === "vim_down") && index < $items.length - 1) {
        index += 1;
    } else if ((key === "up_arrow" || key === "vim_up") && index > 0) {
        index -= 1;
    }
    $items.eq(index).trigger("focus");
}

function focus_first_action_popover_item() {
    // For now I recommend only calling this when the user opens the menu with a hotkey.
    // Our popup menus act kind of funny when you mix keyboard and mouse.
    const $items = get_action_menu_menu_items();
    focus_first_popover_item($items);
}

function actions_menu_handle_keyboard(key) {
    const $items = get_action_menu_menu_items();
    popover_items_handle_keyboard(key, $items);
}

function message_info_popped() {
    return $current_message_info_popover_elem !== undefined;
}

function hide_message_info_popover() {
    if (message_info_popped()) {
        $current_message_info_popover_elem.popover("destroy");
        $current_message_info_popover_elem = undefined;
    }
}

function user_info_popped() {
    return $current_user_info_popover_elem !== undefined;
}

function user_info_manage_menu_popped() {
    return $current_user_info_popover_manage_menu !== undefined;
}

function hide_user_info_popover() {
    if (user_info_popped()) {
        $current_user_info_popover_elem.popover("destroy");
        $current_user_info_popover_elem = undefined;
    }
}

function hide_userlist_sidebar() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app-main .column-right").removeClass("expanded");
}

function hide_pm_list_sidebar() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app-main .column-left").removeClass("expanded");
}

function show_userlist_sidebar() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app-main .column-right").addClass("expanded");
    _resize__WEBPACK_IMPORTED_MODULE_29__.resize_page_components();
}

let current_user_sidebar_user_id;
let current_user_sidebar_popover;

function user_sidebar_popped() {
    return current_user_sidebar_popover !== undefined;
}

function hide_user_sidebar_popover() {
    if (user_sidebar_popped()) {
        // this hide_* method looks different from all the others since
        // the presence list may be redrawn. Due to funkiness with jQuery's .data()
        // this would confuse $.popover("destroy"), which looks at the .data() attached
        // to a certain element. We thus save off the .data("popover") in the
        // show_user_sidebar_popover and inject it here before calling destroy.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#user_presences").data("popover", current_user_sidebar_popover);
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#user_presences").popover("destroy");
        current_user_sidebar_user_id = undefined;
        current_user_sidebar_popover = undefined;
    }
}

function hide_all_user_info_popovers() {
    hide_user_info_popover_manage_menu();
    hide_message_info_popover();
    hide_user_sidebar_popover();
    hide_user_info_popover();
}

function focus_user_info_popover_item() {
    // For now I recommend only calling this when the user opens the menu with a hotkey.
    // Our popup menus act kind of funny when you mix keyboard and mouse.
    const $items = get_user_info_popover_for_message_items();

    if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".user_info_popover_manage_menu_btn").is(":visible")) {
        focus_first_popover_item($items, 1);
    } else {
        focus_first_popover_item($items);
    }
}

function get_user_sidebar_popover_items() {
    if (!current_user_sidebar_popover) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when user sidebar popover is closed.");
        return undefined;
    }

    return jquery__WEBPACK_IMPORTED_MODULE_1___default()("li:not(.divider):visible a", current_user_sidebar_popover.$tip);
}

function user_sidebar_popover_handle_keyboard(key) {
    const $items = get_user_sidebar_popover_items();
    popover_items_handle_keyboard(key, $items);
}

function user_info_popover_for_message_handle_keyboard(key) {
    const $items = get_user_info_popover_for_message_items();
    popover_items_handle_keyboard(key, $items);
}

function user_info_popover_handle_keyboard(key) {
    const $items = get_user_info_popover_items();
    popover_items_handle_keyboard(key, $items);
}

function user_info_popover_manage_menu_handle_keyboard(key) {
    const $items = get_user_info_popover_manage_menu_items();
    popover_items_handle_keyboard(key, $items);
}

function show_sender_info() {
    const $message = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".selected_message");
    const $sender = $message.find(".sender_info_hover");

    const message = _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.get(_rows__WEBPACK_IMPORTED_MODULE_30__.id($message));
    const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(message.sender_id);
    show_user_info_popover_for_message($sender[0], user, message);
    if ($current_message_info_popover_elem && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        focus_user_info_popover_item();
    }
}

// On mobile web, opening the keyboard can trigger a resize event
// (which in turn can trigger a scroll event).  This will have the
// side effect of closing popovers, which we don't want.  So we
// suppress the first hide from scrolling after a resize using this
// variable.
let suppress_scroll_hide = false;

function set_suppress_scroll_hide() {
    suppress_scroll_hide = true;
}

// Playground_info contains all the data we need to generate a popover of
// playground links for each code block. The element is the target element
// to pop off of.
function toggle_playground_link_popover(element, playground_info) {
    const $last_popover_elem = $current_playground_links_popover_elem;
    hide_all();
    if ($last_popover_elem !== undefined && $last_popover_elem.get()[0] === element) {
        // We want it to be the case that a user can dismiss a popover
        // by clicking on the same element that caused the popover.
        return;
    }
    const $elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(element);
    if ($elt.data("popover") === undefined) {
        const ypos = $elt.offset().top;
        $elt.popover({
            // It's unlikely we'll have more than 3-4 playground links
            // for one language, so it should be OK to hardcode 120 here.
            placement: _message_viewport__WEBPACK_IMPORTED_MODULE_20__.height() - ypos < 120 ? "top" : "bottom",
            title: "",
            content: _templates_playground_links_popover_content_hbs__WEBPACK_IMPORTED_MODULE_3___default()({playground_info}),
            html: true,
            trigger: "manual",
        });
        $elt.popover("show");
        $current_playground_links_popover_elem = $elt;
    }
}

function hide_playground_links_popover() {
    if ($current_playground_links_popover_elem !== undefined) {
        $current_playground_links_popover_elem.popover("destroy");
        $current_playground_links_popover_elem = undefined;
    }
}

function register_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#main_div").on(
        "click",
        ".sender_name, .sender_name-in-status, .inline_profile_picture",
        function (e) {
            const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".message_row");
            e.stopPropagation();
            const message = _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.get(_rows__WEBPACK_IMPORTED_MODULE_30__.id($row));
            const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(message.sender_id);
            show_user_info_popover_for_message(this, user, message);
        },
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#main_div").on("click", ".user-mention", function (e) {
        const id_string = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("data-user-id");
        // We fallback to email to handle legacy Markdown that was rendered
        // before we cut over to using data-user-id
        const email = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("data-user-email");
        if (id_string === "*" || email === "*") {
            return;
        }
        const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".message_row");
        e.stopPropagation();
        const message = _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.get(_rows__WEBPACK_IMPORTED_MODULE_30__.id($row));
        let user;
        if (id_string) {
            const user_id = Number.parseInt(id_string, 10);
            user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id);
        } else {
            user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_email(email);
        }
        show_user_info_popover_for_message(this, user, message);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#main_div").on("click", ".user-group-mention", function (e) {
        const user_group_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("data-user-group-id"), 10);
        const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".message_row");
        e.stopPropagation();
        const message = _message_lists__WEBPACK_IMPORTED_MODULE_19__.current.get(_rows__WEBPACK_IMPORTED_MODULE_30__.id($row));
        try {
            const group = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_group_id);
            show_user_group_info_popover(this, group, message);
        } catch {
            // This user group has likely been deleted.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unable to find user group in message" + message.sender_id);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#main_div, #preview_content, #message-history").on(
        "click",
        ".code_external_link",
        function (e) {
            const $view_in_playground_button = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this);
            const $codehilite_div = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".codehilite");
            e.stopPropagation();
            const playground_info = _realm_playground__WEBPACK_IMPORTED_MODULE_27__.get_playground_info_for_languages(
                $codehilite_div.data("code-language"),
            );
            // We do the code extraction here and set the target href combining the url_prefix
            // and the extracted code. Depending on whether the language has multiple playground
            // links configured, a popover is show.
            const extracted_code = $codehilite_div.find("code").text();
            if (playground_info.length === 1) {
                const url_prefix = playground_info[0].url_prefix;
                $view_in_playground_button.attr(
                    "href",
                    url_prefix + encodeURIComponent(extracted_code),
                );
            } else {
                for (const $playground of playground_info) {
                    $playground.playground_url =
                        $playground.url_prefix + encodeURIComponent(extracted_code);
                }
                toggle_playground_link_popover(this, playground_info);
            }
        },
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".popover_playground_link", (e) => {
        hide_playground_links_popover();
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".info_popover_actions .narrow_to_private_messages", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const email = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id).email;
        hide_all();
        if (_overlays__WEBPACK_IMPORTED_MODULE_24__.settings_open()) {
            _overlays__WEBPACK_IMPORTED_MODULE_24__.close_overlay("settings");
        }
        _narrow__WEBPACK_IMPORTED_MODULE_23__.by("pm-with", email, {trigger: "user sidebar popover"});
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".info_popover_actions .narrow_to_messages_sent", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const email = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id).email;
        hide_all();
        if (_overlays__WEBPACK_IMPORTED_MODULE_24__.settings_open()) {
            _overlays__WEBPACK_IMPORTED_MODULE_24__.close_overlay("settings");
        }
        _narrow__WEBPACK_IMPORTED_MODULE_23__.by("sender", email, {trigger: "user sidebar popover"});
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".user_popover .mention_user", (e) => {
        if (!_compose_state__WEBPACK_IMPORTED_MODULE_13__.composing()) {
            _compose_actions__WEBPACK_IMPORTED_MODULE_12__.start("stream", {trigger: "sidebar user actions"});
        }
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const name = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id).full_name;
        const mention = _people__WEBPACK_IMPORTED_MODULE_25__.get_mention_syntax(name, user_id);
        _compose_ui__WEBPACK_IMPORTED_MODULE_14__.insert_syntax_and_focus(mention);
        hide_user_sidebar_popover();
        hide_userlist_sidebar();
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".message-info-popover .mention_user", (e) => {
        if (!_compose_state__WEBPACK_IMPORTED_MODULE_13__.composing()) {
            _compose_actions__WEBPACK_IMPORTED_MODULE_12__.respond_to_message({trigger: "user sidebar popover"});
        }
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const name = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id).full_name;
        const mention = _people__WEBPACK_IMPORTED_MODULE_25__.get_mention_syntax(name, user_id);
        _compose_ui__WEBPACK_IMPORTED_MODULE_14__.insert_syntax_and_focus(mention);
        hide_message_info_popover();
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".info_popover_actions .clear_status", (e) => {
        e.preventDefault();
        const me = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        _user_status__WEBPACK_IMPORTED_MODULE_35__.server_update_status({
            user_id: me,
            status_text: "",
            emoji_name: "",
            emoji_code: "",
            success() {
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(".info_popover_actions #status_message").empty();
            },
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".view_user_profile", (e) => {
        const user_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-user-id"), 10);
        const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id);
        show_user_info_popover(e.target, user);
        e.stopPropagation();
        e.preventDefault();
    });

    /* These click handlers are implemented as just deep links to the
     * relevant part of the Zulip UI, so we don't want preventDefault,
     * but we do want to close the modal when you click them. */

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".invisible_mode_turn_on", (e) => {
        hide_all();
        _user_status__WEBPACK_IMPORTED_MODULE_35__.server_invisible_mode_on();
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".invisible_mode_turn_off", (e) => {
        hide_all();
        _user_status__WEBPACK_IMPORTED_MODULE_35__.server_invisible_mode_off();
        e.stopPropagation();
        e.preventDefault();
    });

    function open_user_status_modal(e) {
        hide_all();

        _user_status_ui__WEBPACK_IMPORTED_MODULE_36__.open_user_status_modal();

        e.stopPropagation();
        e.preventDefault();
    }

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".update_status_text", open_user_status_modal);

    // Clicking on one's own status emoji should open the user status modal.
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#user_presences").on(
        "click",
        ".user_sidebar_entry_me .status_emoji",
        open_user_status_modal,
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-mute-user", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        hide_all_user_info_popovers();
        e.stopPropagation();
        e.preventDefault();
        _muted_users_ui__WEBPACK_IMPORTED_MODULE_22__.confirm_mute_user(user_id);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-unmute-user", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        hide_all_user_info_popovers();
        _muted_users_ui__WEBPACK_IMPORTED_MODULE_22__.unmute_user(user_id);
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".info_popover_actions .sidebar-popover-reactivate-user", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        hide_all();
        e.stopPropagation();
        e.preventDefault();
        function handle_confirm() {
            const url = "/json/users/" + encodeURIComponent(user_id) + "/reactivate";
            _channel__WEBPACK_IMPORTED_MODULE_11__.post({
                url,
                success() {
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_15__.close_modal();
                },
                error(xhr) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"));
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_15__.hide_dialog_spinner();
                },
            });
        }
        _settings_users__WEBPACK_IMPORTED_MODULE_32__.confirm_reactivation(user_id, handle_confirm, true);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#user_presences").on("click", ".user-list-sidebar-menu-icon", function (e) {
        e.stopPropagation();

        const $target = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest("li");
        const user_id = elem_to_user_id($target.find("a"));
        // Hiding popovers may mutate current_user_sidebar_user_id.
        const previous_user_sidebar_id = current_user_sidebar_user_id;

        // Hide popovers, but we don't want to hide the sidebars on
        // smaller browser windows.
        hide_all_except_sidebars();

        if (previous_user_sidebar_id === user_id) {
            // If the popover is already shown, clicking again should toggle it.
            return;
        }

        const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id);
        const popover_placement = userlist_placement === "left" ? "right" : "left";

        render_user_info_popover(
            user,
            $target,
            false,
            false,
            "compose_private_message",
            "user_popover",
            popover_placement,
        );

        current_user_sidebar_user_id = user.user_id;
        current_user_sidebar_popover = $target.data("popover");
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.custom", (e) => {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget)[0]._flatpickr.toggle();
        e.stopPropagation();
        e.preventDefault();
    });

    function reminder_click_handler(datestr, e) {
        const message_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".remind.custom").data("message-id");
        _reminder__WEBPACK_IMPORTED_MODULE_28__.do_set_reminder_for_message(message_id, datestr);
        hide_all();
        e.stopPropagation();
        e.preventDefault();
    }

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.in_20m", (e) => {
        const datestr = (0,date_fns__WEBPACK_IMPORTED_MODULE_39__["default"])((0,date_fns__WEBPACK_IMPORTED_MODULE_40__["default"])(new Date(), {minutes: 20}));
        reminder_click_handler(datestr, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.in_1h", (e) => {
        const datestr = (0,date_fns__WEBPACK_IMPORTED_MODULE_39__["default"])((0,date_fns__WEBPACK_IMPORTED_MODULE_40__["default"])(new Date(), {hours: 1}));
        reminder_click_handler(datestr, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.in_3h", (e) => {
        const datestr = (0,date_fns__WEBPACK_IMPORTED_MODULE_39__["default"])((0,date_fns__WEBPACK_IMPORTED_MODULE_40__["default"])(new Date(), {hours: 3}));
        reminder_click_handler(datestr, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.tomo", (e) => {
        const datestr = (0,date_fns__WEBPACK_IMPORTED_MODULE_39__["default"])(
            (0,date_fns__WEBPACK_IMPORTED_MODULE_41__["default"])((0,date_fns__WEBPACK_IMPORTED_MODULE_40__["default"])(new Date(), {days: 1}), {hours: 9, minutes: 0, seconds: 0}),
        );
        reminder_click_handler(datestr, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".remind.nxtw", (e) => {
        const datestr = (0,date_fns__WEBPACK_IMPORTED_MODULE_39__["default"])(
            (0,date_fns__WEBPACK_IMPORTED_MODULE_41__["default"])((0,date_fns__WEBPACK_IMPORTED_MODULE_40__["default"])(new Date(), {weeks: 1}), {hours: 9, minutes: 0, seconds: 0}),
        );
        reminder_click_handler(datestr, e);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".flatpickr-calendar", (e) => {
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".flatpickr-confirm", (e) => {
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(".remind.custom")[0]) {
            const datestr = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".remind.custom")[0].value;
            reminder_click_handler(datestr, e);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".respond_personal_button, .compose_private_message", (e) => {
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const email = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id).email;
        _compose_actions__WEBPACK_IMPORTED_MODULE_12__.start("private", {
            trigger: "popover send private",
            private_message_recipient: email,
        });
        hide_all();
        if (_overlays__WEBPACK_IMPORTED_MODULE_24__.settings_open()) {
            _overlays__WEBPACK_IMPORTED_MODULE_24__.close_overlay("settings");
        }
        e.stopPropagation();
        e.preventDefault();
    });

    clipboard_enable(".copy_mention_syntax");

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".copy_mention_syntax", (e) => {
        hide_all();
        e.stopPropagation();
        e.preventDefault();
    });

    {
        let last_scroll = 0;

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app").on("scroll", () => {
            if (suppress_scroll_hide) {
                suppress_scroll_hide = false;
                return;
            }

            const date = Date.now();

            // only run `popovers.hide_all()` if the last scroll was more
            // than 250ms ago.
            if (date - last_scroll > 250) {
                hide_all();
            }

            // update the scroll time on every event to make sure it doesn't
            // retrigger `hide_all` while still scrolling.
            last_scroll = date;
        });
    }

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-manage-user", (e) => {
        hide_all();
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id);
        if (user.is_bot) {
            _settings_bots__WEBPACK_IMPORTED_MODULE_31__.show_edit_bot_info_modal(user_id, true);
        } else {
            _settings_users__WEBPACK_IMPORTED_MODULE_32__.show_edit_user_info_modal(user_id, true);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".user_info_popover_manage_menu_btn", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const user_id = elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).parents("ul"));
        const user = _people__WEBPACK_IMPORTED_MODULE_25__.get_by_user_id(user_id);
        show_user_info_popover_manage_menu(e.target, user);
    });
}

function any_active() {
    // True if any popover (that this module manages) is currently shown.
    // Expanded sidebars on mobile view count as popovers as well.
    return (
        _popover_menus__WEBPACK_IMPORTED_MODULE_26__.any_active() ||
        user_sidebar_popped() ||
        _stream_popover__WEBPACK_IMPORTED_MODULE_33__.stream_popped() ||
        _stream_popover__WEBPACK_IMPORTED_MODULE_33__.topic_popped() ||
        message_info_popped() ||
        user_info_popped() ||
        _emoji_picker__WEBPACK_IMPORTED_MODULE_16__.reactions_popped() ||
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("[class^='column-'].expanded").length
    );
}

// This function will hide all true popovers (the streamlist and
// userlist sidebars use the popover infrastructure, but doesn't work
// like a popover structurally).
function hide_all_except_sidebars(opts) {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".has_popover").removeClass("has_popover has_actions_popover has_emoji_popover");
    if (!opts || !opts.not_hide_tippy_instances) {
        // hideAll hides all tippy instances (tooltips and popovers).
        (0,tippy_js__WEBPACK_IMPORTED_MODULE_37__.hideAll)();
    }
    _emoji_picker__WEBPACK_IMPORTED_MODULE_16__.hide_emoji_popover();
    _giphy__WEBPACK_IMPORTED_MODULE_17__.hide_giphy_popover();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_stream_popover();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_topic_popover();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_all_messages_popover();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_starred_messages_popover();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_drafts_popover();
    hide_all_user_info_popovers();
    hide_playground_links_popover();

    // look through all the popovers that have been added and removed.
    for (const $o of list_of_popovers) {
        if (!document.body.contains($o.$element[0]) && $o.$tip) {
            $o.$tip.remove();
        }
    }
    list_of_popovers = [];
}

// This function will hide all the popovers, including the mobile web
// or narrow window sidebars.
function hide_all(not_hide_tippy_instances) {
    hide_userlist_sidebar();
    _stream_popover__WEBPACK_IMPORTED_MODULE_33__.hide_streamlist_sidebar();
    hide_all_except_sidebars({
        not_hide_tippy_instances,
    });
}

function set_userlist_placement(placement) {
    userlist_placement = placement || "right";
}

function compute_placement(
    $elt,
    popover_height,
    popover_width,
    prefer_vertical_positioning,
) {
    const client_rect = $elt.get(0).getBoundingClientRect();
    const distance_from_top = client_rect.top;
    const distance_from_bottom = _message_viewport__WEBPACK_IMPORTED_MODULE_20__.height() - client_rect.bottom;
    const distance_from_left = client_rect.left;
    const distance_from_right = _message_viewport__WEBPACK_IMPORTED_MODULE_20__.width() - client_rect.right;

    const elt_will_fit_horizontally =
        distance_from_left + $elt.width() / 2 > popover_width / 2 &&
        distance_from_right + $elt.width() / 2 > popover_width / 2;

    const elt_will_fit_vertically =
        distance_from_bottom + $elt.height() / 2 > popover_height / 2 &&
        distance_from_top + $elt.height() / 2 > popover_height / 2;

    // default to placing the popover in the center of the screen
    let placement = "viewport_center";

    // prioritize left/right over top/bottom
    if (distance_from_top > popover_height && elt_will_fit_horizontally) {
        placement = "top";
    }
    if (distance_from_bottom > popover_height && elt_will_fit_horizontally) {
        placement = "bottom";
    }

    if (prefer_vertical_positioning && placement !== "viewport_center") {
        // If vertical positioning is preferred and the popover fits in
        // either top or bottom position then return.
        return placement;
    }

    if (distance_from_left > popover_width && elt_will_fit_vertically) {
        placement = "left";
    }
    if (distance_from_right > popover_width && elt_will_fit_vertically) {
        placement = "right";
    }

    return placement;
}


/***/ }),

/***/ "./static/js/presence.js":
/*!*******************************!*\
  !*** ./static/js/presence.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_internal_data": () => (/* binding */ clear_internal_data),
/* harmony export */   "get_status": () => (/* binding */ get_status),
/* harmony export */   "get_user_ids": () => (/* binding */ get_user_ids),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "last_active_date": () => (/* binding */ last_active_date),
/* harmony export */   "presence_info": () => (/* binding */ presence_info),
/* harmony export */   "set_info": () => (/* binding */ set_info),
/* harmony export */   "status_from_raw": () => (/* binding */ status_from_raw),
/* harmony export */   "update_info_for_small_realm": () => (/* binding */ update_info_for_small_realm),
/* harmony export */   "update_info_from_event": () => (/* binding */ update_info_from_event)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






// This module just manages data.  See activity.js for
// the UI of our buddy list.

// The following Maps have user_id as the key.  Some of the
// user_ids may not yet be registered in people.js.
// See the long comment in `set_info` below for details.

// In future commits we'll use raw_info to facilitate
// handling server events and/or timeout events.
const raw_info = new Map();
const presence_info = new Map();

// We use this internally and export it for testing convenience.
function clear_internal_data() {
    raw_info.clear();
    presence_info.clear();
}

/* Mark users as offline after 140 seconds since their last checkin,
 * Keep in sync with zerver/tornado/event_queue.py:receiver_is_idle
 */
const OFFLINE_THRESHOLD_SECS = 140;

const BIG_REALM_COUNT = 250;

function get_status(user_id) {
    if (_people__WEBPACK_IMPORTED_MODULE_1__.is_my_user_id(user_id)) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            // if the current user is sharing presence, they always see themselves as online.
            return "active";
        }
        // if the current user is not sharing presence, they always see themselves as offline.
        return "offline";
    }
    if (presence_info.has(user_id)) {
        return presence_info.get(user_id).status;
    }
    return "offline";
}

function get_user_ids() {
    return Array.from(presence_info.keys());
}

function status_from_raw(raw) {
    /*
        Example of `raw`:

        {
            active_timestamp: 1585745133
            idle_timestamp: 1585745091
            server_timestamp: 1585745140
        }
    */
    function age(timestamp) {
        return raw.server_timestamp - (timestamp || 0);
    }

    const active_timestamp = raw.active_timestamp;
    const idle_timestamp = raw.idle_timestamp;

    let last_active;
    if (active_timestamp !== undefined || idle_timestamp !== undefined) {
        last_active = Math.max(active_timestamp || 0, idle_timestamp || 0);
    }

    /*
        If the server sends us `active_timestamp`, this
        means at least one client was active at this time
        (and hasn't changed since).

        As long as the timestamp is current enough, we will
        show the user as active (even if there's a newer
        timestamp for idle).
    */
    if (age(active_timestamp) < OFFLINE_THRESHOLD_SECS) {
        return {
            status: "active",
            last_active,
        };
    }

    if (age(idle_timestamp) < OFFLINE_THRESHOLD_SECS) {
        return {
            status: "idle",
            last_active,
        };
    }

    return {
        status: "offline",
        last_active,
    };
}

function update_info_from_event(user_id, info, server_timestamp) {
    /*
        Example of `info`:

        {
            website: {
                client: 'website',
                pushable: false,
                status: 'active',
                timestamp: 1585745225
            }
        }

        Example of `raw`:

        {
            active_timestamp: 1585745133
            idle_timestamp: 1585745091
            server_timestamp: 1585745140
        }
    */
    const raw = raw_info.get(user_id) || {};

    raw.server_timestamp = server_timestamp;

    for (const rec of Object.values(info)) {
        if (rec.status === "active" && rec.timestamp > (raw.active_timestamp || 0)) {
            raw.active_timestamp = rec.timestamp;
        }

        if (rec.status === "idle" && rec.timestamp > (raw.idle_timestamp || 0)) {
            raw.idle_timestamp = rec.timestamp;
        }
    }

    raw_info.set(user_id, raw);

    const status = status_from_raw(raw);
    presence_info.set(user_id, status);
}

function set_info(presences, server_timestamp) {
    /*
        Example `presences` data:

        {
            6: Object { idle_timestamp: 1585746028 },
            7: Object { active_timestamp: 1585745774 },
            8: Object { active_timestamp: 1585745578 }
        }
    */

    clear_internal_data();
    for (const [user_id_str, info] of Object.entries(presences)) {
        const user_id = Number.parseInt(user_id_str, 10);

        // Note: In contrast with all other state updates received
        // receive from the server, presence data is updated via a
        // polling process rather than the events system
        // (server_events_dispatch.js).
        //
        // This means that if we're coming back from being offline and
        // new users were created in the meantime, we may see user IDs
        // not yet present in people.js if server_events doesn't have
        // current data (or we've been offline, our event queue was
        // GC'ed, and we're about to reload).  Such user_ids being
        // present could, in turn, create spammy downstream exceptions
        // when rendering the buddy list.  To address this, we check
        // if the user ID is not yet present in people.js, and if it
        // is, we skip storing that user (we'll see them again in the
        // next presence request in 1 minute anyway).
        //
        // It's important to check both suspect_offline and
        // reload_state.is_in_progress, because races where presence
        // returns data on users not yet received via the server_events
        // system are common in both situations.
        const person = _people__WEBPACK_IMPORTED_MODULE_1__.get_by_user_id(user_id, true);
        if (person === undefined) {
            if (!(Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() || Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())())) {
                // If we're online, and we get a user who we don't
                // know about in the presence data, throw an error.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user ID in presence data: " + user_id);
            }
            // Either way, we deal by skipping this user and
            // continuing with processing everyone else.
            continue;
        }

        const raw = {
            server_timestamp,
            active_timestamp: info.active_timestamp || undefined,
            idle_timestamp: info.idle_timestamp || undefined,
        };

        raw_info.set(user_id, raw);

        const status = status_from_raw(raw);
        presence_info.set(user_id, status);
    }
    update_info_for_small_realm();
}

function update_info_for_small_realm() {
    if (_people__WEBPACK_IMPORTED_MODULE_1__.get_active_human_count() >= BIG_REALM_COUNT) {
        // For big realms, we don't want to bloat our buddy
        // lists with lots of long-time-inactive users.
        return;
    }

    // For small realms, we create presence info for users
    // that the server didn't include in its presence update.
    const persons = _people__WEBPACK_IMPORTED_MODULE_1__.get_realm_users();

    for (const person of persons) {
        const user_id = person.user_id;
        let status = "offline";

        if (presence_info.has(user_id)) {
            // this is normal, we have data for active
            // users that we don't want to clobber.
            continue;
        }

        if (person.is_bot) {
            // we don't show presence for bots
            continue;
        }

        if (_people__WEBPACK_IMPORTED_MODULE_1__.is_my_user_id(user_id)) {
            status = "active";
        }

        presence_info.set(user_id, {
            status,
            last_active: undefined,
        });
    }
}

function last_active_date(user_id) {
    const info = presence_info.get(user_id);

    if (!info || !info.last_active) {
        return undefined;
    }

    return new Date(info.last_active * 1000);
}

function initialize(params) {
    set_info(params.presences, params.server_timestamp);
}


/***/ }),

/***/ "./static/js/reactions.js":
/*!********************************!*\
  !*** ./static/js/reactions.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_reaction": () => (/* binding */ add_reaction),
/* harmony export */   "current_user_has_reacted_to_emoji": () => (/* binding */ current_user_has_reacted_to_emoji),
/* harmony export */   "find_reaction": () => (/* binding */ find_reaction),
/* harmony export */   "get_add_reaction_button": () => (/* binding */ get_add_reaction_button),
/* harmony export */   "get_emojis_used_by_user_for_message_id": () => (/* binding */ get_emojis_used_by_user_for_message_id),
/* harmony export */   "get_local_reaction_id": () => (/* binding */ get_local_reaction_id),
/* harmony export */   "get_message_reactions": () => (/* binding */ get_message_reactions),
/* harmony export */   "get_reaction_section": () => (/* binding */ get_reaction_section),
/* harmony export */   "get_reaction_title_data": () => (/* binding */ get_reaction_title_data),
/* harmony export */   "get_vote_text": () => (/* binding */ get_vote_text),
/* harmony export */   "open_reactions_popover": () => (/* binding */ open_reactions_popover),
/* harmony export */   "process_reaction_click": () => (/* binding */ process_reaction_click),
/* harmony export */   "remove_reaction": () => (/* binding */ remove_reaction),
/* harmony export */   "set_clean_reactions": () => (/* binding */ set_clean_reactions),
/* harmony export */   "set_reaction_vote_text": () => (/* binding */ set_reaction_vote_text),
/* harmony export */   "toggle_emoji_reaction": () => (/* binding */ toggle_emoji_reaction),
/* harmony export */   "update_user_fields": () => (/* binding */ update_user_fields),
/* harmony export */   "update_vote_text_on_message": () => (/* binding */ update_vote_text_on_message),
/* harmony export */   "view": () => (/* binding */ view)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_message_reaction_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/message_reaction.hbs */ "./static/templates/message_reaction.hbs");
/* harmony import */ var _templates_message_reaction_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_message_reaction_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
/* harmony import */ var _emoji_picker__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./emoji_picker */ "./static/js/emoji_picker.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _spectators__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./spectators */ "./static/js/spectators.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















const view = {}; // function namespace

function get_local_reaction_id(reaction_info) {
    return [reaction_info.reaction_type, reaction_info.emoji_code].join(",");
}

function open_reactions_popover() {
    const message = _message_lists__WEBPACK_IMPORTED_MODULE_6__.current.selected_message();
    let target;

    // Use verbose style to ensure we test both sides of the condition.
    if (message.sent_by_me) {
        target = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_message_lists__WEBPACK_IMPORTED_MODULE_6__.current.selected_row()).find(".actions_hover")[0];
    } else {
        target = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_message_lists__WEBPACK_IMPORTED_MODULE_6__.current.selected_row()).find(".reaction_button")[0];
    }

    _emoji_picker__WEBPACK_IMPORTED_MODULE_5__.toggle_emoji_popover(target, _message_lists__WEBPACK_IMPORTED_MODULE_6__.current.selected_id());
    return true;
}

function current_user_has_reacted_to_emoji(message, local_id) {
    set_clean_reactions(message);

    const clean_reaction_object = message.clean_reactions.get(local_id);
    return clean_reaction_object && clean_reaction_object.user_ids.includes(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}

function get_message(message_id) {
    const message = _message_store__WEBPACK_IMPORTED_MODULE_7__.get(message_id);
    if (!message) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("reactions: Bad message id: " + message_id);
        return undefined;
    }

    set_clean_reactions(message);
    return message;
}

function create_reaction(message_id, reaction_info) {
    return {
        message_id,
        user_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        local_id: get_local_reaction_id(reaction_info),
        reaction_type: reaction_info.reaction_type,
        emoji_name: reaction_info.emoji_name,
        emoji_code: reaction_info.emoji_code,
    };
}

function update_ui_and_send_reaction_ajax(message_id, reaction_info) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // Spectators can't react, since they don't have accounts.  We
        // stop here to avoid a confusing reaction local echo.
        _spectators__WEBPACK_IMPORTED_MODULE_9__.login_to_access();
        return;
    }

    const message = get_message(message_id);
    const local_id = get_local_reaction_id(reaction_info);
    const has_reacted = current_user_has_reacted_to_emoji(message, local_id);
    const operation = has_reacted ? "remove" : "add";
    const reaction = create_reaction(message_id, reaction_info);

    if (operation === "add") {
        add_reaction(reaction);
    } else {
        remove_reaction(reaction);
    }

    const args = {
        url: "/json/messages/" + message_id + "/reactions",
        data: reaction_info,
        success() {},
        error(xhr) {
            const response = _channel__WEBPACK_IMPORTED_MODULE_3__.xhr_error_message("Error sending reaction", xhr);
            // Errors are somewhat common here, due to race conditions
            // where the user tries to add/remove the reaction when there is already
            // an in-flight request.  We eventually want to make this a blueslip
            // error, rather than a warning, but we need to implement either
            // #4291 or #4295 first.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(response);
        },
    };
    if (operation === "add") {
        _channel__WEBPACK_IMPORTED_MODULE_3__.post(args);
    } else if (operation === "remove") {
        _channel__WEBPACK_IMPORTED_MODULE_3__.del(args);
    }
}

function toggle_emoji_reaction(message_id, emoji_name) {
    // This codepath doesn't support toggling a deactivated realm emoji.
    // Since an user can interact with a deactivated realm emoji only by
    // clicking on a reaction and that is handled by `process_reaction_click()`
    // method. This codepath is to be used only where there is no chance of an
    // user interacting with a deactivated realm emoji like emoji picker.

    const reaction_info = _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name(emoji_name);
    update_ui_and_send_reaction_ajax(message_id, reaction_info);
}

function process_reaction_click(message_id, local_id) {
    const message = get_message(message_id);

    if (!message) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("message_id for reaction click is unknown: " + message_id);
        return;
    }

    const clean_reaction_object = message.clean_reactions.get(local_id);

    if (!clean_reaction_object) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Data integrity problem for reaction " + local_id + " (message " + message_id + ")",
        );
        return;
    }

    const reaction_info = {
        reaction_type: clean_reaction_object.reaction_type,
        emoji_name: clean_reaction_object.emoji_name,
        emoji_code: clean_reaction_object.emoji_code,
    };

    update_ui_and_send_reaction_ajax(message_id, reaction_info);
}

function generate_title(emoji_name, user_ids) {
    const usernames = _people__WEBPACK_IMPORTED_MODULE_8__.get_display_full_names(
        user_ids.filter((user_id) => user_id !== Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())),
    );
    const current_user_reacted = user_ids.length !== usernames.length;

    const context = {
        emoji_name: ":" + emoji_name + ":",
    };

    if (user_ids.length === 1) {
        if (current_user_reacted) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You (click to remove) reacted with {emoji_name}"}, context);
        }
        context.username = usernames[0];
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "{username} reacted with {emoji_name}"}, context);
    }

    if (user_ids.length === 2 && current_user_reacted) {
        context.other_username = usernames[0];
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {
                defaultMessage:
                    "You (click to remove) and {other_username} reacted with {emoji_name}",
            },
            context,
        );
    }

    context.comma_separated_usernames = usernames.slice(0, -1).join(", ");
    context.last_username = usernames.at(-1);
    if (current_user_reacted) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {
                defaultMessage:
                    "You (click to remove), {comma_separated_usernames} and {last_username} reacted with {emoji_name}",
            },
            context,
        );
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {
            defaultMessage:
                "{comma_separated_usernames} and {last_username} reacted with {emoji_name}",
        },
        context,
    );
}

// Add a tooltip showing who reacted to a message.
function get_reaction_title_data(message_id, local_id) {
    const message = get_message(message_id);

    const clean_reaction_object = message.clean_reactions.get(local_id);
    const user_list = clean_reaction_object.user_ids;
    const emoji_name = clean_reaction_object.emoji_name;
    const title = generate_title(emoji_name, user_list);

    return title;
}

function get_reaction_section(message_id) {
    const $message_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".message_table").find(`[zid='${CSS.escape(message_id)}']`);
    const $section = $message_element.find(".message_reactions");
    return $section;
}

function find_reaction(message_id, local_id) {
    const $reaction_section = get_reaction_section(message_id);
    const $reaction = $reaction_section.find(`[data-reaction-id='${CSS.escape(local_id)}']`);
    return $reaction;
}

function get_add_reaction_button(message_id) {
    const $reaction_section = get_reaction_section(message_id);
    const $add_button = $reaction_section.find(".reaction_button");
    return $add_button;
}

function set_reaction_vote_text($reaction, vote_text) {
    const $count_element = $reaction.find(".message_reaction_count");
    $count_element.text(vote_text);
}

function add_reaction(event) {
    const message_id = event.message_id;
    const message = _message_store__WEBPACK_IMPORTED_MODULE_7__.get(message_id);

    if (message === undefined) {
        // If we don't have the message in cache, do nothing; if we
        // ever fetch it from the server, it'll come with the
        // latest reactions attached
        return;
    }

    set_clean_reactions(message);

    const local_id = get_local_reaction_id(event);
    const user_id = event.user_id;
    let clean_reaction_object = message.clean_reactions.get(local_id);
    if (clean_reaction_object && clean_reaction_object.user_ids.includes(user_id)) {
        return;
    }

    if (clean_reaction_object) {
        clean_reaction_object.user_ids.push(user_id);
        update_user_fields(clean_reaction_object, message.clean_reactions);
        view.update_existing_reaction(clean_reaction_object, message, user_id);
    } else {
        clean_reaction_object = make_clean_reaction({
            local_id,
            user_ids: [user_id],
            reaction_type: event.reaction_type,
            emoji_name: event.emoji_name,
            emoji_code: event.emoji_code,
        });

        message.clean_reactions.set(local_id, clean_reaction_object);
        update_user_fields(clean_reaction_object, message.clean_reactions);
        view.insert_new_reaction(clean_reaction_object, message, user_id);
    }
}

view.update_existing_reaction = function (clean_reaction_object, message, acting_user_id) {
    // Our caller ensures that this message already has a reaction
    // for this emoji and sets up our user_list.  This function
    // simply updates the DOM.
    const local_id = get_local_reaction_id(clean_reaction_object);
    const $reaction = find_reaction(message.id, local_id);

    const new_label = generate_title(
        clean_reaction_object.emoji_name,
        clean_reaction_object.user_ids,
    );
    $reaction.attr("aria-label", new_label);

    if (acting_user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        $reaction.addClass("reacted");
    }

    update_vote_text_on_message(message);
};

view.insert_new_reaction = function (clean_reaction_object, message, user_id) {
    // Our caller ensures we are the first user to react to this
    // message with this emoji. We then render the emoji/title/count
    // and insert it before the add button.

    const context = {
        message_id: message.id,
        ..._emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_for_rendering(clean_reaction_object),
    };

    const new_label = generate_title(
        clean_reaction_object.emoji_name,
        clean_reaction_object.user_ids,
    );

    context.count = 1;
    context.label = new_label;
    context.local_id = get_local_reaction_id(clean_reaction_object);
    context.emoji_alt_code = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "text";
    context.is_realm_emoji =
        context.reaction_type === "realm_emoji" || context.reaction_type === "zulip_extra_emoji";

    if (user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        context.class = "message_reaction reacted";
    } else {
        context.class = "message_reaction";
    }

    const $new_reaction = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_message_reaction_hbs__WEBPACK_IMPORTED_MODULE_1___default()(context));

    // Now insert it before the add button.
    const $reaction_button_element = get_add_reaction_button(message.id);
    $new_reaction.insertBefore($reaction_button_element);

    update_vote_text_on_message(message);
};

function remove_reaction(event) {
    const message_id = event.message_id;
    const user_id = event.user_id;
    const message = _message_store__WEBPACK_IMPORTED_MODULE_7__.get(message_id);
    const local_id = get_local_reaction_id(event);

    if (message === undefined) {
        // If we don't have the message in cache, do nothing; if we
        // ever fetch it from the server, it'll come with the
        // latest reactions attached
        return;
    }

    set_clean_reactions(message);

    const clean_reaction_object = message.clean_reactions.get(local_id);

    if (!clean_reaction_object) {
        return;
    }

    if (!clean_reaction_object.user_ids.includes(user_id)) {
        return;
    }

    clean_reaction_object.user_ids = clean_reaction_object.user_ids.filter((id) => id !== user_id);
    if (clean_reaction_object.user_ids.length === 0) {
        message.clean_reactions.delete(local_id);
    }

    const should_display_reactors = check_should_display_reactors(message.clean_reactions);
    update_user_fields(clean_reaction_object, should_display_reactors);

    view.remove_reaction(clean_reaction_object, message, user_id);
}

view.remove_reaction = function (clean_reaction_object, message, user_id) {
    const local_id = get_local_reaction_id(clean_reaction_object);
    const $reaction = find_reaction(message.id, local_id);
    const reaction_count = clean_reaction_object.user_ids.length;

    if (reaction_count === 0) {
        // If this user was the only one reacting for this emoji, we simply
        // remove the reaction and exit.
        $reaction.remove();
        update_vote_text_on_message(message);
        return;
    }

    // The emoji still has reactions from other users, so we need to update
    // the title/count and, if the user is the current user, turn off the
    // "reacted" class.
    const new_label = generate_title(
        clean_reaction_object.emoji_name,
        clean_reaction_object.user_ids,
    );
    $reaction.attr("aria-label", new_label);
    if (user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        $reaction.removeClass("reacted");
    }

    update_vote_text_on_message(message);
};

function get_emojis_used_by_user_for_message_id(message_id) {
    const user_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const message = _message_store__WEBPACK_IMPORTED_MODULE_7__.get(message_id);
    set_clean_reactions(message);

    const names = [];
    for (const clean_reaction_object of message.clean_reactions.values()) {
        if (clean_reaction_object.user_ids.includes(user_id)) {
            names.push(clean_reaction_object.emoji_name);
        }
    }

    return names;
}

function get_message_reactions(message) {
    set_clean_reactions(message);
    return Array.from(message.clean_reactions.values());
}

function set_clean_reactions(message) {
    /*
      set_clean_reactions processes the raw message.reactions object,
      which will contain one object for each individual reaction, even
      if two users react with the same emoji.

      As output, it sets message.cleaned_reactions, which is a more
      compressed format with one entry per reaction pill that should
      be displayed visually to users.
    */

    if (message.clean_reactions) {
        // Update display details for the reaction. In particular,
        // user_settings.display_emoji_reaction_users or the names of
        // the users appearing in the reaction may have changed since
        // this reaction was first rendered.
        const should_display_reactors = check_should_display_reactors(message.clean_reactions);
        for (const clean_reaction of message.clean_reactions.values()) {
            update_user_fields(clean_reaction, should_display_reactors);
        }
        return;
    }

    // This first loop creates a temporary distinct_reactions data
    // structure, which will accumulate the set of users who have
    // reacted with each distinct reaction.
    const distinct_reactions = new Map();
    const user_map = new Map();
    for (const reaction of message.reactions) {
        const local_id = get_local_reaction_id(reaction);
        const user_id = reaction.user_id;

        if (!_people__WEBPACK_IMPORTED_MODULE_8__.is_known_user_id(user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown user_id " + user_id + " in reaction for message " + message.id);
            continue;
        }

        if (!distinct_reactions.has(local_id)) {
            distinct_reactions.set(local_id, reaction);
            user_map.set(local_id, []);
        }

        const user_ids = user_map.get(local_id);

        if (user_ids.includes(user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "server sent duplicate reactions for user " + user_id + " (key=" + local_id + ")",
            );
            continue;
        }

        user_ids.push(user_id);
    }

    // TODO: Rather than adding this field to the message object, it
    // might be cleaner to create an independent map from message_id
    // => clean_reactions data for the message, with care being taken
    // to make sure reify_message_id moves the data structure
    // properly.
    message.clean_reactions = new Map();
    for (const local_id of distinct_reactions.keys()) {
        const reaction = distinct_reactions.get(local_id);
        const user_ids = user_map.get(local_id);

        message.clean_reactions.set(
            local_id,
            make_clean_reaction({local_id, user_ids, ...reaction}),
        );
    }

    // We do update_user_fields in a separate loop, because doing so
    // lets us avoid duplicating check_should_display_reactors to
    // determine whether to store in the vote_text field a count or
    // the names of reactors (users who reacted).
    const should_display_reactors = check_should_display_reactors(message.clean_reactions);
    for (const clean_reaction of message.clean_reactions.values()) {
        update_user_fields(clean_reaction, should_display_reactors);
    }

    // We don't maintain message.reactions when users react to
    // messages we already have a copy of, so it's safest to delete it
    // after we've processed the reactions data for a message into the
    // clean_reactions data structure, which we do maintain.
    delete message.reactions;
}

function make_clean_reaction({local_id, user_ids, emoji_name, emoji_code, reaction_type}) {
    const clean_reaction_object = {
        local_id,
        user_ids,
        ..._emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_for_rendering({emoji_name, emoji_code, reaction_type}),
    };
    clean_reaction_object.emoji_alt_code = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "text";
    clean_reaction_object.is_realm_emoji =
        clean_reaction_object.reaction_type === "realm_emoji" ||
        clean_reaction_object.reaction_type === "zulip_extra_emoji";
    return clean_reaction_object;
}

function update_user_fields(clean_reaction_object, should_display_reactors) {
    // update_user_fields needs to be called whenever the set of users
    // whor eacted on a message might have changed, including due to
    // upvote/downvotes on ANY reaction in the message, because those
    // can change the correct value of should_display_reactors to use.
    clean_reaction_object.count = clean_reaction_object.user_ids.length;
    clean_reaction_object.label = generate_title(
        clean_reaction_object.emoji_name,
        clean_reaction_object.user_ids,
    );
    if (clean_reaction_object.user_ids.includes(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))) {
        clean_reaction_object.class = "message_reaction reacted";
    } else {
        clean_reaction_object.class = "message_reaction";
    }

    clean_reaction_object.count = clean_reaction_object.user_ids.length;
    clean_reaction_object.label = generate_title(
        clean_reaction_object.emoji_name,
        clean_reaction_object.user_ids,
    );

    // The vote_text field set here is used directly in the Handlebars
    // template for rendering (or rerendering!) a message.
    clean_reaction_object.vote_text = get_vote_text(clean_reaction_object, should_display_reactors);
}

function get_vote_text(clean_reaction_object, should_display_reactors) {
    if (should_display_reactors) {
        return comma_separated_usernames(clean_reaction_object.user_ids);
    }
    return `${clean_reaction_object.user_ids.length}`;
}

function check_should_display_reactors(cleaned_reactions) {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    let total_reactions = 0;
    for (const r of cleaned_reactions.values()) {
        // r.count is not yet initialized when this is called during
        // set_clean_reactions.
        total_reactions += r.count || r.user_ids.length;
    }
    return total_reactions <= 3;
}

function comma_separated_usernames(user_list) {
    const usernames = _people__WEBPACK_IMPORTED_MODULE_8__.get_display_full_names(user_list);
    const current_user_has_reacted = user_list.includes(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    if (current_user_has_reacted) {
        const current_user_index = user_list.indexOf(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        usernames[current_user_index] = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "You",
        });
    }
    const comma_separated_usernames = usernames.join(", ");
    return comma_separated_usernames;
}

function update_vote_text_on_message(message) {
    // Because whether we display a count or the names of reacting
    // users depends on total reactions on the message, we need to
    // recalculate this whenever adjusting reaction rendering on a
    // message.
    const cleaned_reactions = get_message_reactions(message);
    const should_display_reactors = check_should_display_reactors(cleaned_reactions);
    for (const [reaction, clean_reaction] of message.clean_reactions.entries()) {
        const reaction_elem = find_reaction(message.id, clean_reaction.local_id);
        const vote_text = get_vote_text(clean_reaction, should_display_reactors);
        message.clean_reactions.get(reaction).vote_text = vote_text;
        set_reaction_vote_text(reaction_elem, vote_text);
    }
}


/***/ }),

/***/ "./static/js/read_receipts.js":
/*!************************************!*\
  !*** ./static/js/read_receipts.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "show_user_list": () => (/* binding */ show_user_list)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var simplebar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! simplebar */ "./node_modules/simplebar/dist/simplebar.esm.js");
/* harmony import */ var _templates_read_receipts_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/read_receipts.hbs */ "./static/templates/read_receipts.hbs");
/* harmony import */ var _templates_read_receipts_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_read_receipts_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_read_receipts_modal_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/read_receipts_modal.hbs */ "./static/templates/read_receipts_modal.hbs");
/* harmony import */ var _templates_read_receipts_modal_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_read_receipts_modal_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());















function show_user_list(message_id) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append(_templates_read_receipts_modal_hbs__WEBPACK_IMPORTED_MODULE_3___default()());
    _overlays__WEBPACK_IMPORTED_MODULE_7__.open_modal("read_receipts_modal", {
        autoremove: true,
        on_show() {
            const message = _message_store__WEBPACK_IMPORTED_MODULE_6__.get(message_id);
            if (message.sender_email === "notification-bot@zulip.com") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .read_receipts_info").text(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage:
                            "Read receipts are not available for Notification Bot messages.",
                    }),
                );
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .modal__content").addClass("compact");
            } else {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .loading_indicator"));
                _channel__WEBPACK_IMPORTED_MODULE_4__.get({
                    url: `/json/messages/${message_id}/read_receipts`,
                    success(data) {
                        const users = data.user_ids.map((id) => {
                            const user = _people__WEBPACK_IMPORTED_MODULE_8__.get_by_user_id(id);
                            return {
                                user_id: user.user_id,
                                full_name: user.full_name,
                                avatar_url: _people__WEBPACK_IMPORTED_MODULE_8__.small_avatar_url_for_person(user),
                            };
                        });
                        users.sort(_people__WEBPACK_IMPORTED_MODULE_8__.compare_by_name);

                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .loading_indicator"));
                        if (users.length === 0) {
                            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .read_receipts_info").text(
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No one has read this message yet."}),
                            );
                        } else {
                            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .read_receipts_info").html(
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                                    {
                                        defaultMessage:
                                            "{num_of_people, plural, one {This message has been <z-link>read</z-link> by {num_of_people} person:} other {This message has been <z-link>read</z-link> by {num_of_people} people:}}",
                                    },
                                    {
                                        num_of_people: users.length,
                                        "z-link": (content_html) =>
                                            `<a href="/help/read-receipts">${content_html.join(
                                                "",
                                            )}</a>`,
                                    },
                                ),
                            );
                            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .modal__container").addClass(
                                "showing_read_receipts_list",
                            );
                            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .modal__content").append(
                                _templates_read_receipts_hbs__WEBPACK_IMPORTED_MODULE_2___default()({users}),
                            );
                            new simplebar__WEBPACK_IMPORTED_MODULE_1__["default"](jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .modal__content")[0]);
                        }
                    },
                    error(xhr) {
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("", xhr, jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_error"));
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#read_receipts_modal .loading_indicator"));
                    },
                });
            }
        },
        on_hide() {
            // Ensure any user info popovers are closed
            _popovers__WEBPACK_IMPORTED_MODULE_9__.hide_all();
        },
    });
}


/***/ }),

/***/ "./static/js/realm_icon.js":
/*!*********************************!*\
  !*** ./static/js/realm_icon.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_realm_icon_widget": () => (/* binding */ build_realm_icon_widget),
/* harmony export */   "rerender": () => (/* binding */ rerender)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






function build_realm_icon_widget(upload_function) {
    const get_file_input = function () {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image_file_input").expectOne();
    };

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return undefined;
    }
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "G") {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-delete-button").hide();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-delete-button").show();
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-delete-button").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        _channel__WEBPACK_IMPORTED_MODULE_1__.del({
            url: "/json/realm/icon",
        });
    });

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        get_file_input,
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image_file_input_error").expectOne(),
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image_upload_button").expectOne(),
        upload_function,
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function rerender() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-block").attr("src", Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "U") {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-delete-button").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image-delete-button").hide();
        // Need to clear input because of a small edge case
        // where you try to upload the same image you just deleted.
        const $file_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-icon-upload-widget .image_file_input");
        $file_input.val("");
    }
}


/***/ }),

/***/ "./static/js/realm_logo.js":
/*!*********************************!*\
  !*** ./static/js/realm_logo.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_realm_logo_widget": () => (/* binding */ build_realm_logo_widget),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "render": () => (/* binding */ render)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());







function build_realm_logo_widget(upload_function, is_night) {
    let logo_section_id = "#realm-day-logo-upload-widget";
    let logo_source = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    if (is_night) {
        logo_section_id = "#realm-night-logo-upload-widget";
        logo_source = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    const $delete_button_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(logo_section_id + " .image-delete-button");
    const $file_input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(logo_section_id + " .image_file_input");
    const $file_input_error_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(logo_section_id + " .image_file_input_error");
    const $upload_button_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(logo_section_id + " .image_upload_button");

    const get_file_input = function () {
        return $file_input_elem.expectOne();
    };

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return undefined;
    }

    if (logo_source === "D") {
        $delete_button_elem.hide();
    } else {
        $delete_button_elem.show();
    }

    const data = {night: JSON.stringify(is_night)};
    $delete_button_elem.on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        _channel__WEBPACK_IMPORTED_MODULE_1__.del({
            url: "/json/realm/logo",
            data,
        });
    });

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        get_file_input,
        $file_input_error_elem.expectOne(),
        $upload_button_elem.expectOne(),
        upload_function,
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function change_logo_delete_button(logo_source, $logo_delete_button, $file_input) {
    if (logo_source === "U") {
        $logo_delete_button.show();
    } else {
        $logo_delete_button.hide();
        // Need to clear input because of a small edge case
        // where you try to upload the same image you just deleted.
        $file_input.val("");
    }
}

function render() {
    const $file_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-day-logo-upload-widget .image_file_input");
    const $night_file_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-night-logo-upload-widget .realm-logo-file-input");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-day-logo-upload-widget .image-block").attr("src", Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "D" && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== "D") {
        // If no dark theme logo is uploaded but a light theme one
        // is, use the light theme one; this handles the common case
        // of transparent background logos that look good on both
        // dark and light themes.  See also similar code in admin.js.

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-night-logo-upload-widget .image-block").attr("src", Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-night-logo-upload-widget .image-block").attr(
            "src",
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        );
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== "D") {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-logo").attr("src", Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-logo").attr("src", Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    }

    change_logo_delete_button(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-day-logo-upload-widget .image-delete-button"),
        $file_input,
    );
    change_logo_delete_button(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-night-logo-upload-widget .image-delete-button"),
        $night_file_input,
    );
}

function initialize() {
    // render once
    render();

    // Rerender the realm-logo when the browser detects color scheme changes.
    const dark_mode_media_query_list = window.matchMedia("(prefers-color-scheme: dark)");
    dark_mode_media_query_list.addEventListener("change", () => {
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(":root").hasClass("color-scheme-automatic")) {
            render();
        }
    });
}


/***/ }),

/***/ "./static/js/realm_playground.js":
/*!***************************************!*\
  !*** ./static/js/realm_playground.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_playground_info_for_languages": () => (/* binding */ get_playground_info_for_languages),
/* harmony export */   "get_pygments_typeahead_list": () => (/* binding */ get_pygments_typeahead_list),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "sort_pygments_pretty_names_by_priority": () => (/* binding */ sort_pygments_pretty_names_by_priority),
/* harmony export */   "update_playgrounds": () => (/* binding */ update_playgrounds)
/* harmony export */ });
/* harmony import */ var _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/js/typeahead */ "./static/shared/js/typeahead.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");





const map_language_to_playground_info = new Map();
const map_pygments_pretty_name_to_aliases = new Map();

function update_playgrounds(playgrounds_data) {
    map_language_to_playground_info.clear();

    for (const data of Object.values(playgrounds_data)) {
        const element_to_push = {
            id: data.id,
            name: data.name,
            url_prefix: data.url_prefix,
        };
        if (map_language_to_playground_info.has(data.pygments_language)) {
            map_language_to_playground_info.get(data.pygments_language).push(element_to_push);
        } else {
            map_language_to_playground_info.set(data.pygments_language, [element_to_push]);
        }
    }
}

function get_playground_info_for_languages(lang) {
    return map_language_to_playground_info.get(lang);
}

function sort_pygments_pretty_names_by_priority(generated_pygments_data) {
    const priority_sorted_pygments_data = Object.keys(generated_pygments_data.langs).sort(
        _typeahead_helper__WEBPACK_IMPORTED_MODULE_2__.compare_by_popularity,
    );
    for (const alias of priority_sorted_pygments_data) {
        const pretty_name = generated_pygments_data.langs[alias].pretty_name;
        // JS Map remembers the original order of insertion of keys.
        if (map_pygments_pretty_name_to_aliases.has(pretty_name)) {
            map_pygments_pretty_name_to_aliases.get(pretty_name).push(alias);
        } else {
            map_pygments_pretty_name_to_aliases.set(pretty_name, [alias]);
        }
    }
}

function get_pygments_typeahead_list(query) {
    const language_labels = new Map();

    // Adds a typeahead that allows selecting a custom language, by adding a
    // "Custom language" label in the first position of the typeahead list.
    const clean_query = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_0__.clean_query_lowercase(query);
    if (clean_query !== "") {
        language_labels.set(
            clean_query,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Custom language: {query}"}, {query: clean_query}),
        );
    }

    for (const [key, values] of map_pygments_pretty_name_to_aliases) {
        language_labels.set(key, key + " (" + Array.from(values).join(", ") + ")");
    }

    return language_labels;
}

function initialize(playground_data, generated_pygments_data) {
    update_playgrounds(playground_data);
    sort_pygments_pretty_names_by_priority(generated_pygments_data);
}


/***/ }),

/***/ "./static/js/recent_senders.js":
/*!*************************************!*\
  !*** ./static/js/recent_senders.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "IdTracker": () => (/* binding */ IdTracker),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "compare_by_recency": () => (/* binding */ compare_by_recency),
/* harmony export */   "get_pm_recent_senders": () => (/* binding */ get_pm_recent_senders),
/* harmony export */   "get_topic_recent_senders": () => (/* binding */ get_topic_recent_senders),
/* harmony export */   "process_private_message": () => (/* binding */ process_private_message),
/* harmony export */   "process_stream_message": () => (/* binding */ process_stream_message),
/* harmony export */   "process_topic_edit": () => (/* binding */ process_topic_edit),
/* harmony export */   "update_topics_of_deleted_message_ids": () => (/* binding */ update_topics_of_deleted_message_ids)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./people */ "./static/js/people.js");






// This class is only exported for unit testing purposes.
// If we find reuse opportunities, we should just put it into
// its own module.
class IdTracker {
    ids = new Set();

    // We cache the max message id to make sure that
    // typeahead code is efficient.  We don't eagerly
    // compute it, since it's plausible a spammy bot
    // could cause us to process many messages at a time
    // during fetching.
    _cached_max_id = undefined;

    add(id) {
        this.ids.add(id);
        if (this._cached_max_id !== undefined && id > this._cached_max_id) {
            this._cached_max_id = id;
        }
    }

    remove(id) {
        this.ids.delete(id);
        this._cached_max_id = undefined;
    }

    max_id() {
        if (this._cached_max_id === undefined) {
            this._cached_max_id = lodash__WEBPACK_IMPORTED_MODULE_0___default().max(Array.from(this.ids));
        }
        return this._cached_max_id || -1;
    }

    empty() {
        return this.ids.size === 0;
    }
}

// topic_senders[stream_id][sender_id] = IdTracker
const stream_senders = new Map();

// topic_senders[stream_id][topic_id][sender_id] = IdTracker
const topic_senders = new Map();

// pm_senders[user_ids_string][user_id] = IdTracker
const pm_senders = new Map();

function clear_for_testing() {
    stream_senders.clear();
    topic_senders.clear();
}

function max_id_for_stream_topic_sender({stream_id, topic, sender_id}) {
    const topic_dict = topic_senders.get(stream_id);
    if (!topic_dict) {
        return -1;
    }
    const sender_dict = topic_dict.get(topic);
    if (!sender_dict) {
        return -1;
    }
    const id_tracker = sender_dict.get(sender_id);
    return id_tracker ? id_tracker.max_id() : -1;
}

function max_id_for_stream_sender({stream_id, sender_id}) {
    const sender_dict = stream_senders.get(stream_id);
    if (!sender_dict) {
        return -1;
    }
    const id_tracker = sender_dict.get(sender_id);
    return id_tracker ? id_tracker.max_id() : -1;
}

function add_stream_message({stream_id, sender_id, message_id}) {
    const sender_dict = stream_senders.get(stream_id) || new Map();
    const id_tracker = sender_dict.get(sender_id) || new IdTracker();
    stream_senders.set(stream_id, sender_dict);
    sender_dict.set(sender_id, id_tracker);
    id_tracker.add(message_id);
}

function add_topic_message({stream_id, topic, sender_id, message_id}) {
    const topic_dict = topic_senders.get(stream_id) || new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    const sender_dict = topic_dict.get(topic) || new Map();
    const id_tracker = sender_dict.get(sender_id) || new IdTracker();
    topic_senders.set(stream_id, topic_dict);
    topic_dict.set(topic, sender_dict);
    sender_dict.set(sender_id, id_tracker);
    id_tracker.add(message_id);
}

function process_stream_message(message) {
    const stream_id = message.stream_id;
    const topic = message.topic;
    const sender_id = message.sender_id;
    const message_id = message.id;

    add_stream_message({stream_id, sender_id, message_id});
    add_topic_message({stream_id, topic, sender_id, message_id});
}

function remove_topic_message({stream_id, topic, sender_id, message_id}) {
    const topic_dict = topic_senders.get(stream_id);
    if (!topic_dict) {
        return;
    }

    const sender_dict = topic_dict.get(topic);

    if (!sender_dict) {
        return;
    }

    const id_tracker = sender_dict.get(sender_id);

    if (!id_tracker) {
        return;
    }

    id_tracker.remove(message_id);
    if (id_tracker.empty()) {
        sender_dict.delete(sender_id);
    }

    if (sender_dict.size === 0) {
        topic_dict.delete(topic);
    }
}

function process_topic_edit({
    message_ids,
    old_stream_id,
    old_topic,
    new_stream_id,
    new_topic,
}) {
    // Note that we don't delete anything from stream_senders here.
    // Our view is that it's probably better to not do so; users who
    // recently posted to a stream are relevant for typeahead even if
    // the messages were moved to another stream or deleted.

    for (const message_id of message_ids) {
        const message = _message_store__WEBPACK_IMPORTED_MODULE_2__.get(message_id);
        if (!message) {
            continue;
        }
        const sender_id = message.sender_id;

        remove_topic_message({stream_id: old_stream_id, topic: old_topic, sender_id, message_id});
        add_topic_message({stream_id: new_stream_id, topic: new_topic, sender_id, message_id});

        add_stream_message({stream_id: new_stream_id, sender_id, message_id});
    }
}

function update_topics_of_deleted_message_ids(message_ids) {
    for (const message_id of message_ids) {
        const message = _message_store__WEBPACK_IMPORTED_MODULE_2__.get(message_id);
        if (!message) {
            continue;
        }

        const stream_id = message.stream_id;
        const topic = message.topic;
        const sender_id = message.sender_id;

        remove_topic_message({stream_id, topic, sender_id, message_id});
    }
}

function compare_by_recency(user_a, user_b, stream_id, topic) {
    let a_message_id;
    let b_message_id;

    a_message_id = max_id_for_stream_topic_sender({stream_id, topic, sender_id: user_a.user_id});
    b_message_id = max_id_for_stream_topic_sender({stream_id, topic, sender_id: user_b.user_id});

    if (a_message_id !== b_message_id) {
        return b_message_id - a_message_id;
    }

    a_message_id = max_id_for_stream_sender({stream_id, sender_id: user_a.user_id});
    b_message_id = max_id_for_stream_sender({stream_id, sender_id: user_b.user_id});

    return b_message_id - a_message_id;
}

function get_topic_recent_senders(stream_id, topic) {
    const topic_dict = topic_senders.get(stream_id);
    if (topic_dict === undefined) {
        return [];
    }

    const sender_dict = topic_dict.get(topic);
    if (sender_dict === undefined) {
        return [];
    }

    function by_max_message_id(item1, item2) {
        const list1 = item1[1];
        const list2 = item2[1];
        return list2.max_id() - list1.max_id();
    }

    const sorted_senders = Array.from(sender_dict.entries()).sort(by_max_message_id);
    const recent_senders = [];
    for (const item of sorted_senders) {
        recent_senders.push(item[0]);
    }
    return recent_senders;
}

function process_private_message({to_user_ids, sender_id, id}) {
    const sender_dict = pm_senders.get(to_user_ids) || new Map();
    const id_tracker = sender_dict.get(sender_id) || new IdTracker();
    pm_senders.set(to_user_ids, sender_dict);
    sender_dict.set(sender_id, id_tracker);
    id_tracker.add(id);
}

function get_pm_recent_senders(user_ids_string) {
    const user_ids = user_ids_string.split(",").map((id) => Number.parseInt(id, 10));
    const sender_dict = pm_senders.get(user_ids_string);
    const pm_senders_info = {participants: [], non_participants: []};
    if (!sender_dict) {
        return pm_senders_info;
    }

    function compare_pm_user_ids_by_recency(user_id1, user_id2) {
        const max_id1 = sender_dict.get(user_id1)?.max_id() || -1;
        const max_id2 = sender_dict.get(user_id2)?.max_id() || -1;
        return max_id2 - max_id1;
    }

    // Add current user to user_ids.
    user_ids.push(_people__WEBPACK_IMPORTED_MODULE_3__.my_current_user_id());
    pm_senders_info.non_participants = user_ids.filter((user_id) => {
        if (sender_dict.get(user_id)) {
            pm_senders_info.participants.push(user_id);
            return false;
        }
        return true;
    });
    pm_senders_info.participants.sort(compare_pm_user_ids_by_recency);
    return pm_senders_info;
}


/***/ }),

/***/ "./static/js/recent_topics_data.js":
/*!*****************************************!*\
  !*** ./static/js/recent_topics_data.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get": () => (/* binding */ get),
/* harmony export */   "process_message": () => (/* binding */ process_message),
/* harmony export */   "reify_message_id_if_available": () => (/* binding */ reify_message_id_if_available),
/* harmony export */   "topics": () => (/* binding */ topics)
/* harmony export */ });
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");



const topics = new Map();
// For stream messages, key is stream-id:topic.
// For pms, key is the user IDs to whom the message is being sent.

function process_message(msg) {
    // Return whether any conversation data is updated.
    let conversation_data_updated = false;

    // Initialize conversation data
    const key = (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_1__.get_key_from_message)(msg);
    if (!topics.has(key)) {
        topics.set(key, {
            last_msg_id: -1,
            participated: false,
            type: msg.type,
        });
        conversation_data_updated = true;
    }
    // Update conversation data
    const topic_data = topics.get(key);
    if (topic_data.last_msg_id < msg.id) {
        // NOTE: This also stores locally echoed msg_id which
        // has not been successfully received from the server.
        // We store it now and reify it when response is available
        // from server.
        topic_data.last_msg_id = msg.id;
        conversation_data_updated = true;
    }
    // TODO: Add backend support for participated topics.
    // Currently participated === recently participated
    // i.e. Only those topics are participated for which we have the user's
    // message fetched in the topic. Ideally we would want this to be attached
    // to topic info fetched from backend, which is currently not a thing.
    if (!topic_data.participated && _people__WEBPACK_IMPORTED_MODULE_0__.is_my_user_id(msg.sender_id)) {
        topic_data.participated = true;
        conversation_data_updated = true;
    }
    return conversation_data_updated;
}

function get_sorted_topics() {
    // Sort all recent topics by last message time.
    return new Map(
        Array.from(topics.entries()).sort((a, b) => b[1].last_msg_id - a[1].last_msg_id),
    );
}

function get() {
    return get_sorted_topics();
}

function reify_message_id_if_available(opts) {
    // We don't need to reify the message_id of the topic
    // if a new message arrives in the topic from another user,
    // since it replaces the last_msg_id of the topic which
    // we were trying to reify.
    for (const [, value] of topics.entries()) {
        if (value.last_msg_id === opts.old_id) {
            value.last_msg_id = opts.new_id;
            return true;
        }
    }
    return false;
}


/***/ }),

/***/ "./static/js/recent_topics_ui.js":
/*!***************************************!*\
  !*** ./static/js/recent_topics_ui.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$current_focus_elem": () => (/* binding */ $current_focus_elem),
/* harmony export */   "COLUMNS": () => (/* binding */ COLUMNS),
/* harmony export */   "change_focused_element": () => (/* binding */ change_focused_element),
/* harmony export */   "clear_for_tests": () => (/* binding */ clear_for_tests),
/* harmony export */   "complete_rerender": () => (/* binding */ complete_rerender),
/* harmony export */   "filters_should_hide_topic": () => (/* binding */ filters_should_hide_topic),
/* harmony export */   "focus_clicked_element": () => (/* binding */ focus_clicked_element),
/* harmony export */   "get_focused_row_message": () => (/* binding */ get_focused_row_message),
/* harmony export */   "get_pm_tooltip_data": () => (/* binding */ get_pm_tooltip_data),
/* harmony export */   "hide": () => (/* binding */ hide),
/* harmony export */   "hide_loading_indicator": () => (/* binding */ hide_loading_indicator),
/* harmony export */   "inplace_rerender": () => (/* binding */ inplace_rerender),
/* harmony export */   "load_filters": () => (/* binding */ load_filters),
/* harmony export */   "process_messages": () => (/* binding */ process_messages),
/* harmony export */   "process_topic_edit": () => (/* binding */ process_topic_edit),
/* harmony export */   "revive_current_focus": () => (/* binding */ revive_current_focus),
/* harmony export */   "save_filters": () => (/* binding */ save_filters),
/* harmony export */   "set_default_focus": () => (/* binding */ set_default_focus),
/* harmony export */   "set_filter": () => (/* binding */ set_filter),
/* harmony export */   "show": () => (/* binding */ show),
/* harmony export */   "show_loading_indicator": () => (/* binding */ show_loading_indicator),
/* harmony export */   "topic_in_search_results": () => (/* binding */ topic_in_search_results),
/* harmony export */   "update_filters_view": () => (/* binding */ update_filters_view),
/* harmony export */   "update_topic_is_muted": () => (/* binding */ update_topic_is_muted),
/* harmony export */   "update_topic_unread_count": () => (/* binding */ update_topic_unread_count),
/* harmony export */   "update_topics_of_deleted_message_ids": () => (/* binding */ update_topics_of_deleted_message_ids)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_recent_topic_row_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/recent_topic_row.hbs */ "./static/templates/recent_topic_row.hbs");
/* harmony import */ var _templates_recent_topic_row_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_recent_topic_row_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_recent_topics_filters_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/recent_topics_filters.hbs */ "./static/templates/recent_topics_filters.hbs");
/* harmony import */ var _templates_recent_topics_filters_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_recent_topics_filters_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_recent_topics_table_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/recent_topics_table.hbs */ "./static/templates/recent_topics_table.hbs");
/* harmony import */ var _templates_recent_topics_table_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_recent_topics_table_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_user_with_status_icon_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/user_with_status_icon.hbs */ "./static/templates/user_with_status_icon.hbs");
/* harmony import */ var _templates_user_with_status_icon_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_user_with_status_icon_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./compose_closed_ui */ "./static/js/compose_closed_ui.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./message_util */ "./static/js/message_util.js");
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _navbar_alerts__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./navbar_alerts */ "./static/js/navbar_alerts.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _recent_senders__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./recent_senders */ "./static/js/recent_senders.js");
/* harmony import */ var _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./recent_topics_data */ "./static/js/recent_topics_data.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _top_left_corner__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./top_left_corner */ "./static/js/top_left_corner.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");







































let topics_widget;
let message_list_displayed_before;
// Sets the number of avatars to display.
// Rest of the avatars, if present, are displayed as {+x}
const MAX_AVATAR = 4;
const MAX_EXTRA_SENDERS = 10;

// Use this to set the focused element.
//
// We set it's value to `table` in case the
// focus in one of the table rows, since the
// table rows are constantly updated and tracking
// the selected element in them would be tedious via
// jquery.
//
// So, we use table as a grid system and
// track the coordinates of the focus element via
// `row_focus` and `col_focus`.
let $current_focus_elem = "table";

// If user clicks a topic in recent topics, then
// we store that topic here so that we can restore focus
// to that topic when user revisits.
let last_visited_topic = "";
let row_focus = 0;
// Start focus on the topic column, so Down+Enter works to visit a topic.
let col_focus = 1;

const COLUMNS = {
    stream: 0,
    topic: 1,
    read: 2,
    mute: 3,
};

// The number of selectable actions in a recent_topics.  Used to
// implement wraparound of elements with the right/left keys.  Must be
// increased when we add new actions, or rethought if we add optional
// actions that only appear in some rows.
const MAX_SELECTABLE_TOPIC_COLS = 4;
const MAX_SELECTABLE_PM_COLS = 3;

// we use localstorage to persist the recent topic filters
const ls_key = "recent_topic_filters";
const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_11__.localstorage)();

let filters = new Set();

const recent_conversation_key_prefix = "recent_conversation:";

function clear_for_tests() {
    filters.clear();
    _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.clear();
    topics_widget = undefined;
}

function save_filters() {
    ls.set(ls_key, Array.from(filters));
}

function load_filters() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // A user may have a stored filter and can log out
        // to see web public view. This ensures no filters are
        // selected for spectators.
        filters = new Set(ls.get(ls_key));
    }
}

function set_default_focus() {
    // If at any point we are confused about the currently
    // focused element, we switch focus to search.
    $current_focus_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search");
    $current_focus_elem.trigger("focus");
    _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__.set_standard_text_for_reply_button();
}

function get_min_load_count(already_rendered_count, load_count) {
    const extra_rows_for_viewing_pleasure = 15;
    if (row_focus > already_rendered_count + load_count) {
        return row_focus + extra_rows_for_viewing_pleasure - already_rendered_count;
    }
    return load_count;
}

function is_table_focused() {
    return $current_focus_elem === "table";
}

function get_row_type(row) {
    // Return "private" or "stream"
    // We use CSS method for finding row type until topics_widget gets initialized.
    if (!topics_widget) {
        const $topic_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table tbody tr");
        const $topic_row = $topic_rows.eq(row);
        const is_private = $topic_row.attr("data-private");
        if (is_private) {
            return "private";
        }
        return "stream";
    }

    const current_list = topics_widget.get_current_list();
    const current_row = current_list[row];
    return current_row.type;
}

function get_max_selectable_cols(row) {
    // returns maximum number of columns in stream message or private message row.
    const type = get_row_type(row);
    if (type === "private") {
        return MAX_SELECTABLE_PM_COLS;
    }
    return MAX_SELECTABLE_TOPIC_COLS;
}

function set_table_focus(row, col, using_keyboard) {
    const $topic_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table tbody tr");
    if ($topic_rows.length === 0 || row < 0 || row >= $topic_rows.length) {
        row_focus = 0;
        // return focus back to filters if we cannot focus on the table.
        set_default_focus();
        return true;
    }

    const unread = has_unread(row);
    if (col === 2 && !unread) {
        col = 1;
        col_focus = 1;
    }
    const type = get_row_type(row);
    if (col === 3 && type === "private") {
        col = unread ? 2 : 1;
        col_focus = col;
    }

    const $topic_row = $topic_rows.eq(row);
    // We need to allow table to render first before setting focus.
    setTimeout(
        () => $topic_row.find(".recent_topics_focusable").eq(col).children().trigger("focus"),
        0,
    );
    $current_focus_elem = "table";

    if (using_keyboard) {
        const scroll_element = document.querySelector(
            "#recent_topics_table .table_fix_head .simplebar-content-wrapper",
        );
        const half_height_of_visible_area = scroll_element.offsetHeight / 2;
        const topic_offset = topic_offset_to_visible_area($topic_row);

        if (topic_offset === "above") {
            scroll_element.scrollBy({top: -1 * half_height_of_visible_area});
        } else if (topic_offset === "below") {
            scroll_element.scrollBy({top: half_height_of_visible_area});
        }
    }

    // TODO: This fake "message" object is designed to allow using the
    // get_recipient_label helper inside compose_closed_ui. Surely
    // there's a more readable way to write this code.
    let message;
    if (type === "private") {
        message = {
            display_reply_to: $topic_row.find(".recent_topic_name a").text(),
        };
    } else {
        message = {
            stream: $topic_row.find(".recent_topic_stream a").text(),
            topic: $topic_row.find(".recent_topic_name a").text(),
        };
    }
    _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__.update_reply_recipient_label(message);
    return true;
}

function get_focused_row_message() {
    if (is_table_focused()) {
        const $topic_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table tbody tr");
        if ($topic_rows.length === 0) {
            return undefined;
        }

        const $topic_row = $topic_rows.eq(row_focus);
        const conversation_id = $topic_row.attr("id").slice(recent_conversation_key_prefix.length);
        const topic_last_msg_id = _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.get(conversation_id).last_msg_id;
        return _message_store__WEBPACK_IMPORTED_MODULE_12__.get(topic_last_msg_id);
    }
    return undefined;
}

function revive_current_focus() {
    // After re-render, the current_focus_elem is no longer linked
    // to the focused element, this function attempts to revive the
    // link and focus to the element prior to the rerender.

    // We try to avoid setting focus when user
    // is not focused on recent topics.
    if (!(0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.is_in_focus)()) {
        return false;
    }

    if (!$current_focus_elem) {
        set_default_focus();
        return false;
    }

    if (is_table_focused()) {
        if (last_visited_topic) {
            // If the only message in the topic was deleted,
            // then the topic will not be in recent topics data.
            if (_recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.get(last_visited_topic) !== undefined) {
                const topic_last_msg_id = _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.get(last_visited_topic).last_msg_id;
                const current_list = topics_widget.get_current_list();
                const last_visited_topic_index = current_list.findIndex(
                    (topic) => topic.last_msg_id === topic_last_msg_id,
                );
                if (last_visited_topic_index >= 0) {
                    row_focus = last_visited_topic_index;
                }
            }
            last_visited_topic = "";
        }
        set_table_focus(row_focus, col_focus);
        return true;
    }

    const filter_button = $current_focus_elem.data("filter");
    if (!filter_button) {
        set_default_focus();
    } else {
        $current_focus_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_filter_buttons").find(
            `[data-filter='${CSS.escape(filter_button)}']`,
        );
        $current_focus_elem.trigger("focus");
    }
    return true;
}

function show_loading_indicator() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_loading_messages_indicator"));
}

function hide_loading_indicator() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_bottom_whitespace").hide();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_loading_messages_indicator"), {
        abs_positioned: false,
    });
    // Show empty table text if there are no messages fetched.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table tbody").addClass("required-text");
}

function process_messages(messages) {
    // While this is inexpensive and handles all the cases itself,
    // the UX can be bad if user wants to scroll down the list as
    // the UI will be returned to the beginning of the list on every
    // update.
    let conversation_data_updated = false;
    if (messages.length > 0) {
        for (const msg of messages) {
            if ((0,_recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.process_message)(msg)) {
                conversation_data_updated = true;
            }
        }
    }

    // Only rerender if conversation data actually changed.
    if (conversation_data_updated) {
        complete_rerender();
    }
}

function message_to_conversation_unread_count(msg) {
    if (msg.type === "private") {
        return _unread__WEBPACK_IMPORTED_MODULE_28__.num_unread_for_user_ids_string(msg.to_user_ids);
    }
    return _unread__WEBPACK_IMPORTED_MODULE_28__.num_unread_for_topic(msg.stream_id, msg.topic);
}

function get_pm_tooltip_data(user_ids_string) {
    const user_id = Number.parseInt(user_ids_string, 10);
    const person = _people__WEBPACK_IMPORTED_MODULE_19__.get_by_user_id(user_id);

    if (person.is_bot) {
        const bot_owner = _people__WEBPACK_IMPORTED_MODULE_19__.get_bot_owner_user(person);

        if (bot_owner) {
            const bot_owner_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Owner: {name}"},
                {name: bot_owner.full_name},
            );

            return {
                first_line: person.full_name,
                second_line: bot_owner_name,
            };
        }

        // Bot does not have an owner.
        return {
            first_line: person.full_name,
            second_line: "",
            third_line: "",
        };
    }

    const last_seen = _buddy_data__WEBPACK_IMPORTED_MODULE_6__.user_last_seen_time_status(user_id);

    // Users does not have a status.
    return {
        first_line: last_seen,
        second_line: "",
        third_line: "",
    };
}

function format_conversation(conversation_data) {
    const context = {};
    const last_msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(conversation_data.last_msg_id);
    const time = new Date(last_msg.timestamp * 1000);
    const type = last_msg.type;
    context.full_last_msg_date_time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time);
    context.conversation_key = (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_key_from_message)(last_msg);
    context.unread_count = message_to_conversation_unread_count(last_msg);
    context.last_msg_time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(time);
    context.is_private = last_msg.type === "private";
    let all_senders;
    let senders;
    let displayed_other_senders;
    let extra_sender_ids;

    if (type === "stream") {
        const stream_info = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_msg.stream_id);

        // Stream info
        context.stream_id = last_msg.stream_id;
        context.stream = last_msg.stream;
        context.stream_color = stream_info.color;
        context.stream_url = _hash_util__WEBPACK_IMPORTED_MODULE_8__.by_stream_url(context.stream_id);
        context.invite_only = stream_info.invite_only;
        context.is_web_public = stream_info.is_web_public;
        // Topic info
        context.topic = last_msg.topic;
        context.topic_url = _hash_util__WEBPACK_IMPORTED_MODULE_8__.by_stream_topic_url(context.stream_id, context.topic);

        // We hide the row according to filters or if it's muted.
        // We only supply the data to the topic rows and let jquery
        // display / hide them according to filters instead of
        // doing complete re-render.
        context.topic_muted = Boolean(_user_topics__WEBPACK_IMPORTED_MODULE_31__.is_topic_muted(context.stream_id, context.topic));
        const stream_muted = _stream_data__WEBPACK_IMPORTED_MODULE_24__.is_muted(context.stream_id);
        context.muted = context.topic_muted || stream_muted;
        context.mention_in_unread = _unread__WEBPACK_IMPORTED_MODULE_28__.topic_has_any_unread_mentions(
            context.stream_id,
            context.topic,
        );

        // Since the css for displaying senders in reverse order is much simpler,
        // we provide our handlebars with senders in opposite order.
        // Display in most recent sender first order.
        all_senders = _recent_senders__WEBPACK_IMPORTED_MODULE_21__.get_topic_recent_senders(context.stream_id, context.topic)
            .reverse();
        senders = all_senders.slice(-MAX_AVATAR);

        // Collect extra sender fullname for tooltip
        extra_sender_ids = all_senders.slice(0, -MAX_AVATAR);
        displayed_other_senders = extra_sender_ids.slice(-MAX_EXTRA_SENDERS);
    } else if (type === "private") {
        // Private message info
        context.user_ids_string = last_msg.to_user_ids;
        context.rendered_pm_with = last_msg.display_recipient
            .filter(
                (recipient) =>
                    !_people__WEBPACK_IMPORTED_MODULE_19__.is_my_user_id(recipient.id) || last_msg.display_recipient.length === 1,
            )
            .map((user) =>
                _templates_user_with_status_icon_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                    name: user.full_name,
                    status_emoji_info: _user_status__WEBPACK_IMPORTED_MODULE_30__.get_status_emoji(user.id),
                }),
            )
            .join(", ");
        context.recipient_id = last_msg.recipient_id;
        context.pm_url = last_msg.pm_with_url;
        context.is_group = last_msg.display_recipient.length > 2;

        if (!context.is_group) {
            const user_id = Number.parseInt(last_msg.to_user_ids, 10);
            const user = _people__WEBPACK_IMPORTED_MODULE_19__.get_by_user_id(user_id);
            if (user.is_bot) {
                // Bots do not have status emoji, and are modeled as
                // always present.
                context.user_circle_class = "user_circle_green";
            } else {
                context.user_circle_class = _buddy_data__WEBPACK_IMPORTED_MODULE_6__.get_user_circle_class(user_id);
            }
        }

        // Since the css for displaying senders in reverse order is much simpler,
        // we provide our handlebars with senders in opposite order.
        // Display in most recent sender first order.
        // To match the behavior for streams, we display the set of users who've actually
        // participated, with the most recent participants first. It could make sense to
        // display the other recipients on the PM conversation with different styling,
        // but it's important to not destroy the information of "who's actually talked".
        all_senders = _recent_senders__WEBPACK_IMPORTED_MODULE_21__.get_pm_recent_senders(context.user_ids_string)
            .participants.reverse();
        senders = all_senders.slice(-MAX_AVATAR);
        // Collect extra senders fullname for tooltip.
        extra_sender_ids = all_senders.slice(0, -MAX_AVATAR);
        displayed_other_senders = extra_sender_ids
            .slice(-MAX_EXTRA_SENDERS)
            .map((sender) => sender.id);
    }

    context.senders = _people__WEBPACK_IMPORTED_MODULE_19__.sender_info_for_recent_topics_row(senders);
    context.other_senders_count = Math.max(0, all_senders.length - MAX_AVATAR);
    extra_sender_ids = all_senders.slice(0, -MAX_AVATAR);
    const displayed_other_names = _people__WEBPACK_IMPORTED_MODULE_19__.get_display_full_names(displayed_other_senders.reverse());

    if (extra_sender_ids.length > MAX_EXTRA_SENDERS) {
        // We display only 10 extra senders in tooltips,
        // and just display remaining number of senders.
        const remaining_senders = extra_sender_ids.length - MAX_EXTRA_SENDERS;
        // Pluralization syntax from:
        // https://formatjs.io/docs/core-concepts/icu-syntax/#plural-format
        displayed_other_names.push(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {
                    defaultMessage:
                        "and {remaining_senders, plural, one {1 other} other {# others}}.",
                },
                {remaining_senders},
            ),
        );
    }
    context.other_sender_names_html = displayed_other_names
        .map((name) => lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(name))
        .join("<br />");
    context.participated = conversation_data.participated;
    context.last_msg_url = _hash_util__WEBPACK_IMPORTED_MODULE_8__.by_conversation_and_time_url(last_msg);

    return context;
}

function get_topic_row(topic_data) {
    const msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(topic_data.last_msg_id);
    const topic_key = (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_key_from_message)(msg);
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(recent_conversation_key_prefix + topic_key)}`);
}

function process_topic_edit(old_stream_id, old_topic, new_topic, new_stream_id) {
    // See `recent_senders.process_topic_edit` for
    // logic behind this and important notes on use of this function.
    _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics["delete"]((0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_topic_key)(old_stream_id, old_topic));

    const old_topic_msgs = _message_util__WEBPACK_IMPORTED_MODULE_13__.get_messages_in_topic(old_stream_id, old_topic);
    process_messages(old_topic_msgs);

    new_stream_id = new_stream_id || old_stream_id;
    const new_topic_msgs = _message_util__WEBPACK_IMPORTED_MODULE_13__.get_messages_in_topic(new_stream_id, new_topic);
    process_messages(new_topic_msgs);
}

function topic_in_search_results(keyword, stream, topic) {
    if (keyword === "") {
        return true;
    }
    const text = (stream + " " + topic).toLowerCase();
    const search_words = keyword.toLowerCase().split(/\s+/);
    return search_words.every((word) => text.includes(word));
}

function update_topics_of_deleted_message_ids(message_ids) {
    const topics_to_rerender = _message_util__WEBPACK_IMPORTED_MODULE_13__.get_topics_for_message_ids(message_ids);

    for (const [stream_id, topic] of topics_to_rerender.values()) {
        _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics["delete"]((0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_topic_key)(stream_id, topic));
        const msgs = _message_util__WEBPACK_IMPORTED_MODULE_13__.get_messages_in_topic(stream_id, topic);
        process_messages(msgs);
    }
}

function filters_should_hide_topic(topic_data) {
    const msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(topic_data.last_msg_id);
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg.stream_id);

    if ((sub === undefined || !sub.subscribed) && topic_data.type === "stream") {
        // Never try to process deactivated & unsubscribed stream msgs.
        return true;
    }

    if (filters.has("unread")) {
        const unread_count = message_to_conversation_unread_count(msg);
        if (unread_count === 0) {
            return true;
        }
    }

    if (!topic_data.participated && filters.has("participated")) {
        return true;
    }

    if (!filters.has("include_muted") && topic_data.type === "stream") {
        const topic_muted = Boolean(_user_topics__WEBPACK_IMPORTED_MODULE_31__.is_topic_muted(msg.stream_id, msg.topic));
        const stream_muted = _stream_data__WEBPACK_IMPORTED_MODULE_24__.is_muted(msg.stream_id);
        if (topic_muted || stream_muted) {
            return true;
        }
    }

    if (!filters.has("include_private") && topic_data.type === "private") {
        return true;
    }

    const search_keyword = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search").val();
    if (!topic_in_search_results(search_keyword, msg.stream, msg.topic)) {
        return true;
    }

    return false;
}

function inplace_rerender(topic_key) {
    if (!(0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.is_visible)()) {
        return false;
    }
    if (!_recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.has(topic_key)) {
        return false;
    }

    const topic_data = _recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.get(topic_key);
    const topic_row = get_topic_row(topic_data);
    // We cannot rely on `topic_widget.meta.filtered_list` to know
    // if a topic is rendered since the `filtered_list` might have
    // already been updated via other calls.
    const is_topic_rendered = topic_row.length;
    // Resorting the topics_widget is important for the case where we
    // are rerendering because of message editing or new messages
    // arriving, since those operations often change the sort key.
    topics_widget.filter_and_sort();
    const current_topics_list = topics_widget.get_current_list();
    if (is_topic_rendered && filters_should_hide_topic(topic_data)) {
        // Since the row needs to be removed from DOM, we need to adjust `row_focus`
        // if the row being removed is focused and is the last row in the list.
        // This prevents the row_focus either being reset to the first row or
        // middle of the visible table rows.
        // We need to get the current focused row details from DOM since we cannot
        // rely on `current_topics_list` since it has already been updated and row
        // doesn't exist inside it.
        const row_is_focused = get_focused_row_message()?.id === topic_data.last_msg_id;
        if (row_is_focused && row_focus >= current_topics_list.length) {
            row_focus = current_topics_list.length - 1;
        }
        topics_widget.remove_rendered_row(topic_row);
    } else if (!is_topic_rendered && filters_should_hide_topic(topic_data)) {
        // In case `topic_row` is not present, our job is already done here
        // since it has not been rendered yet and we already removed it from
        // the filtered list in `topic_widget`. So, it won't be displayed in
        // the future too.
    } else if (is_topic_rendered && !filters_should_hide_topic(topic_data)) {
        // Only a re-render is required in this case.
        topics_widget.render_item(topic_data);
    } else {
        // Final case: !is_topic_rendered && !filters_should_hide_topic(topic_data).
        topics_widget.insert_rendered_row(topic_data);
    }
    setTimeout(revive_current_focus, 0);
    return true;
}

function update_topic_is_muted(stream_id, topic) {
    const key = (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_topic_key)(stream_id, topic);
    if (!_recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.topics.has(key)) {
        // we receive mute request for a topic we are
        // not tracking currently
        return false;
    }

    inplace_rerender(key);
    return true;
}

function update_topic_unread_count(message) {
    const topic_key = (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.get_key_from_message)(message);
    inplace_rerender(topic_key);
}

function set_filter(filter) {
    // This function updates the `filters` variable
    // after user clicks on one of the filter buttons
    // based on `btn-recent-selected` class and current
    // set `filters`.

    // Get the button which was clicked.
    const $filter_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_filter_buttons").find(
        `[data-filter="${CSS.escape(filter)}"]`,
    );

    // If user clicks `All`, we clear all filters.
    if (filter === "all" && filters.size !== 0) {
        filters = new Set();
        // If the button was already selected, remove the filter.
    } else if ($filter_elem.hasClass("btn-recent-selected")) {
        filters.delete(filter);
        // If the button was not selected, we add the filter.
    } else {
        filters.add(filter);
    }

    save_filters();
}

function show_selected_filters() {
    // Add `btn-selected-filter` to the buttons to show
    // which filters are applied.
    if (filters.size === 0) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_filter_buttons")
            .find('[data-filter="all"]')
            .addClass("btn-recent-selected")
            .attr("aria-checked", "true");
    } else {
        for (const filter of filters) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_filter_buttons")
                .find(`[data-filter="${CSS.escape(filter)}"]`)
                .addClass("btn-recent-selected")
                .attr("aria-checked", "true");
        }
    }
}

function update_filters_view() {
    const rendered_filters = _templates_recent_topics_filters_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        filter_participated: filters.has("participated"),
        filter_unread: filters.has("unread"),
        filter_muted: filters.has("include_muted"),
        filter_pm: filters.has("include_private"),
        is_spectator: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_filters_group").html(rendered_filters);
    show_selected_filters();

    topics_widget.hard_redraw();
}

function sort_comparator(a, b) {
    // compares strings in lowercase and returns -1, 0, 1
    if (a.toLowerCase() > b.toLowerCase()) {
        return 1;
    } else if (a.toLowerCase() === b.toLowerCase()) {
        return 0;
    }
    return -1;
}

function stream_sort(a, b) {
    if (a.type === b.type) {
        const a_msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(a.last_msg_id);
        const b_msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(b.last_msg_id);

        if (a.type === "stream") {
            return sort_comparator(a_msg.stream, b_msg.stream);
        }
        return sort_comparator(a_msg.display_reply_to, b_msg.display_reply_to);
    }
    // if type is not same sort between "private" and "stream"
    return sort_comparator(a.type, b.type);
}

function topic_sort_key(conversation_data) {
    const message = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(conversation_data.last_msg_id);
    if (message.type === "private") {
        return message.display_reply_to;
    }
    return message.topic;
}

function topic_sort(a, b) {
    return sort_comparator(topic_sort_key(a), topic_sort_key(b));
}

function topic_offset_to_visible_area(topic_row) {
    const $scroll_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head");
    const thead_height = 30;
    const under_closed_compose_region_height = 50;

    const scroll_container_top = $scroll_container.offset().top + thead_height;
    const scroll_container_bottom =
        scroll_container_top + $scroll_container.height() - under_closed_compose_region_height;

    const topic_row_top = jquery__WEBPACK_IMPORTED_MODULE_0___default()(topic_row).offset().top;
    const topic_row_bottom = topic_row_top + jquery__WEBPACK_IMPORTED_MODULE_0___default()(topic_row).height();

    // Topic is above the visible scroll region.
    if (topic_row_top < scroll_container_top) {
        return "above";
        // Topic is below the visible scroll region.
    } else if (topic_row_bottom > scroll_container_bottom) {
        return "below";
    }

    // Topic is visible
    return "visible";
}

function set_focus_to_element_in_center() {
    const table_wrapper_element = document.querySelector("#recent_topics_table .table_fix_head");
    const $topic_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table tbody tr");

    if (row_focus > $topic_rows.length) {
        // User used a filter which reduced
        // the number of visible rows.
        return;
    }
    let $topic_row = $topic_rows.eq(row_focus);
    const topic_offset = topic_offset_to_visible_area($topic_row);
    if (topic_offset !== "visible") {
        // Get the element at the center of the table.
        const position = table_wrapper_element.getBoundingClientRect();
        const topic_center_x = (position.left + position.right) / 2;
        const topic_center_y = (position.top + position.bottom) / 2;

        $topic_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document.elementFromPoint(topic_center_x, topic_center_y)).closest("tr");

        row_focus = $topic_rows.index($topic_row);
        set_table_focus(row_focus, col_focus);
    }
}

function is_scroll_position_for_render(scroll_container) {
    const table_bottom_margin = 100; // Extra margin at the bottom of table.
    const table_row_height = 50;
    return (
        scroll_container.scrollTop +
            scroll_container.clientHeight +
            table_bottom_margin +
            table_row_height >
        scroll_container.scrollHeight
    );
}

function complete_rerender() {
    if (!(0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.is_visible)()) {
        return;
    }

    // Update header
    load_filters();
    show_selected_filters();

    // Show topics list
    const mapped_topic_values = Array.from((0,_recent_topics_data__WEBPACK_IMPORTED_MODULE_22__.get)().values()).map((value) => value);

    if (topics_widget) {
        topics_widget.replace_list_data(mapped_topic_values);
        return;
    }

    const rendered_body = _templates_recent_topics_table_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
        filter_participated: filters.has("participated"),
        filter_unread: filters.has("unread"),
        filter_muted: filters.has("include_muted"),
        filter_pm: filters.has("include_private"),
        search_val: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search").val() || "",
        is_spectator: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table").html(rendered_body);
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table tbody");
    $container.empty();
    topics_widget = _list_widget__WEBPACK_IMPORTED_MODULE_10__.create($container, mapped_topic_values, {
        name: "recent_topics_table",
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table"),
        modifier(item) {
            return _templates_recent_topic_row_hbs__WEBPACK_IMPORTED_MODULE_2___default()(format_conversation(item));
        },
        filter: {
            // We use update_filters_view & filters_should_hide_topic to do all the
            // filtering for us, which is called using click_handlers.
            predicate(topic_data) {
                return !filters_should_hide_topic(topic_data);
            },
        },
        sort_fields: {
            stream_sort,
            topic_sort,
        },
        html_selector: get_topic_row,
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head"),
        callback_after_render: () => setTimeout(revive_current_focus, 0),
        is_scroll_position_for_render,
        post_scroll__pre_render_callback: set_focus_to_element_in_center,
        get_min_load_count,
    });
}

function show() {
    if (_narrow__WEBPACK_IMPORTED_MODULE_15__.has_shown_message_list_view) {
        _narrow__WEBPACK_IMPORTED_MODULE_15__.save_pre_narrow_offset_for_reload();
    }

    if ((0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.is_visible)()) {
        // If we're already visible, E.g. because the user hit Esc
        // while already in the recent topics view, do nothing.
        return;
    }
    // Hide selected elements in the left sidebar.
    _top_left_corner__WEBPACK_IMPORTED_MODULE_26__.narrow_to_recent_topics();
    _stream_list__WEBPACK_IMPORTED_MODULE_25__.handle_narrow_deactivated();

    // Hide "middle-column" which has html for rendering
    // a messages narrow. We hide it and show recent topics.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_feed_container").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_view").show();
    (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.set_visible)(true);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header_underpadding").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").css("padding-bottom", "0px");

    _unread_ui__WEBPACK_IMPORTED_MODULE_29__.hide_mark_as_read_turned_off_banner();

    // We want to show `new stream message` instead of
    // `new topic`, which we are already doing in this
    // function. So, we reuse it here.
    _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__.update_buttons_for_recent_topics();

    _narrow_state__WEBPACK_IMPORTED_MODULE_16__.reset_current_filter();
    _narrow__WEBPACK_IMPORTED_MODULE_15__.update_narrow_title(_narrow_state__WEBPACK_IMPORTED_MODULE_16__.filter());
    _message_view_header__WEBPACK_IMPORTED_MODULE_14__.render_title_area();
    _narrow__WEBPACK_IMPORTED_MODULE_15__.handle_middle_pane_transition();
    _pm_list__WEBPACK_IMPORTED_MODULE_20__.handle_narrow_deactivated();

    complete_rerender();
}

function filter_buttons() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_filters_group").children();
}

function hide() {
    // On firefox (and flaky on other browsers), focus
    // remains on the focused element even after it is hidden. We
    // forcefully blur it so that focus returns to the visible
    // focused element.
    const $focused_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document.activeElement);
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_view").has($focused_element)) {
        $focused_element.trigger("blur");
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_view_header_underpadding").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#message_feed_container").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_view").hide();
    (0,_recent_topics_util__WEBPACK_IMPORTED_MODULE_23__.set_visible)(false);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header").css("padding-bottom", "10px");

    // This solves a bug with message_view_header
    // being broken sometimes when we narrow
    // to a filter and back to recent topics
    // before it completely re-rerenders.
    _message_view_header__WEBPACK_IMPORTED_MODULE_14__.render_title_area();

    if (!message_list_displayed_before) {
        // Hack: If the app is loaded directly to recent topics, then we
        // need to arrange to call navbar_alerts.resize_app when we first
        // visit a message list. This is a workaround for bugs where the
        // floating recipient bar will be invisible (as well as other
        // alignment issues) when they are initially rendered in the
        // background because recent topics is displayed.
        message_list_displayed_before = true;
        _navbar_alerts__WEBPACK_IMPORTED_MODULE_17__.resize_app();
    }

    // This makes sure user lands on the selected message
    // and not always at the top of the narrow.
    _navigate__WEBPACK_IMPORTED_MODULE_18__.plan_scroll_to_selected();
}

function is_focus_at_last_table_row() {
    return row_focus >= topics_widget.get_current_list().length - 1;
}

function has_unread(row) {
    const last_msg_id = topics_widget.get_current_list()[row].last_msg_id;
    const last_msg = _message_store__WEBPACK_IMPORTED_MODULE_12__.get(last_msg_id);
    if (last_msg.type === "stream") {
        return _unread__WEBPACK_IMPORTED_MODULE_28__.num_unread_for_topic(last_msg.stream_id, last_msg.topic) > 0;
    }
    return _unread__WEBPACK_IMPORTED_MODULE_28__.num_unread_for_user_ids_string(last_msg.to_user_ids) > 0;
}

function focus_clicked_element(topic_row_index, col, topic_key) {
    $current_focus_elem = "table";
    col_focus = col;
    row_focus = topic_row_index;

    if (col === COLUMNS.topic) {
        last_visited_topic = topic_key;
    }
    // Set compose_closed_ui reply button text.  The rest of the table
    // focus logic should be a noop.
    set_table_focus(row_focus, col_focus);
}

function left_arrow_navigation(row, col) {
    const type = get_row_type(row);

    if (type === "stream" && col === MAX_SELECTABLE_TOPIC_COLS - 1 && !has_unread(row)) {
        col_focus -= 1;
    }

    col_focus -= 1;
    if (col_focus < 0) {
        col_focus = get_max_selectable_cols(row) - 1;
    }
}

function right_arrow_navigation(row, col) {
    const type = get_row_type(row);

    if (type === "stream" && col === 1 && !has_unread(row)) {
        col_focus += 1;
    }

    col_focus += 1;
    if (col_focus >= get_max_selectable_cols(row)) {
        col_focus = 0;
    }
}

function up_arrow_navigation(row, col) {
    row_focus -= 1;
    if (row_focus < 0) {
        return;
    }
    const type = get_row_type(row);

    if (type === "stream" && col === 2 && row - 1 >= 0 && !has_unread(row - 1)) {
        col_focus = 1;
    }
}

function down_arrow_navigation() {
    row_focus += 1;
}

function get_page_up_down_delta() {
    const table_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head").height();
    const table_header_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table table thead").height();
    const compose_box_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose").height();
    // One usually wants PageDown to move what had been the bottom row
    // to now be at the top, so one can be confident one will see
    // every row using it. This offset helps achieve that goal.
    //
    // See navigate.amount_to_paginate for similar logic in the message feed.
    const scrolling_reduction_to_maintain_context = 75;

    const delta =
        table_height -
        table_header_height -
        compose_box_height -
        scrolling_reduction_to_maintain_context;
    return delta;
}

function page_up_navigation() {
    const $scroll_container = _ui__WEBPACK_IMPORTED_MODULE_27__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head"));
    const delta = get_page_up_down_delta();
    const new_scrollTop = $scroll_container.scrollTop() - delta;
    if (new_scrollTop <= 0) {
        row_focus = 0;
    }
    $scroll_container.scrollTop(new_scrollTop);
    set_table_focus(row_focus, col_focus);
}

function page_down_navigation() {
    const $scroll_container = _ui__WEBPACK_IMPORTED_MODULE_27__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head"));
    const delta = get_page_up_down_delta();
    const new_scrollTop = $scroll_container.scrollTop() + delta;
    const table_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_table .table_fix_head").height();
    if (new_scrollTop >= table_height) {
        row_focus = topics_widget.get_current_list().length - 1;
    }
    $scroll_container.scrollTop(new_scrollTop);
    set_table_focus(row_focus, col_focus);
}

function check_row_type_transition(row, col) {
    // This function checks if the row is transitioning
    // from type "Private messages" to "Stream" or vice versa.
    // This helps in setting the col_focus as maximum column
    // of both the type are different.
    if (row < 0) {
        return false;
    }
    const max_col = get_max_selectable_cols(row);
    if (col > max_col - 1) {
        return true;
    }
    return false;
}

function change_focused_element($elt, input_key) {
    // Called from hotkeys.js; like all logic in that module,
    // returning true will cause the caller to do
    // preventDefault/stopPropagation; false will let the browser
    // handle the key.

    if ($elt.attr("id") === "recent_topics_search") {
        // Since the search box a text area, we want the browser to handle
        // Left/Right and selection within the widget; but if the user
        // arrows off the edges, we should move focus to the adjacent widgets..
        const textInput = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search").get(0);
        const start = textInput.selectionStart;
        const end = textInput.selectionEnd;
        const text_length = textInput.value.length;
        let is_selected = false;
        if (end - start > 0) {
            is_selected = true;
        }

        switch (input_key) {
            //  Allow browser to handle all
            //  character keypresses.
            case "vim_left":
            case "vim_right":
            case "vim_down":
            case "vim_up":
            case "open_recent_topics":
                return false;
            case "shift_tab":
                $current_focus_elem = filter_buttons().last();
                break;
            case "left_arrow":
                if (start !== 0 || is_selected) {
                    return false;
                }
                $current_focus_elem = filter_buttons().last();
                break;
            case "tab":
                $current_focus_elem = filter_buttons().first();
                break;
            case "right_arrow":
                if (end !== text_length || is_selected) {
                    return false;
                }
                $current_focus_elem = filter_buttons().first();
                break;
            case "down_arrow":
                set_table_focus(row_focus, col_focus);
                return true;
            case "click":
                // Note: current_focus_elem can be different here, so we just
                // set current_focus_elem to the input box, we don't want .trigger("focus") on
                // it since it is already focused.
                // We only do this for search because we don't want the focus to
                // go away from the input box when `revive_current_focus` is called
                // on rerender when user is typing.
                $current_focus_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search");
                _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__.set_standard_text_for_reply_button();
                return true;
            case "escape":
                if (is_table_focused()) {
                    return false;
                }
                set_table_focus(row_focus, col_focus);
                return true;
        }
    } else if ($elt.hasClass("btn-recent-filters")) {
        switch (input_key) {
            case "click":
                $current_focus_elem = $elt;
                return true;
            case "shift_tab":
            case "vim_left":
            case "left_arrow":
                if (filter_buttons().first()[0] === $elt[0]) {
                    $current_focus_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search");
                } else {
                    $current_focus_elem = $elt.prev();
                }
                break;
            case "tab":
            case "vim_right":
            case "right_arrow":
                if (filter_buttons().last()[0] === $elt[0]) {
                    $current_focus_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#recent_topics_search");
                } else {
                    $current_focus_elem = $elt.next();
                }
                break;
            case "vim_down":
            case "down_arrow":
                set_table_focus(row_focus, col_focus);
                return true;
            case "escape":
                if (is_table_focused()) {
                    return false;
                }
                set_table_focus(row_focus, col_focus);
                return true;
        }
    } else if (is_table_focused()) {
        // Don't process hotkeys in table if there are no rows.
        if (!topics_widget || topics_widget.get_current_list().length === 0) {
            return true;
        }

        // For arrowing around the table of topics, we implement left/right
        // wraparound.  Going off the top or the bottom takes one
        // to the navigation at the top (see set_table_focus).
        switch (input_key) {
            case "escape":
                return false;
            case "open_recent_topics":
                set_default_focus();
                return true;
            case "shift_tab":
            case "vim_left":
            case "left_arrow":
                left_arrow_navigation(row_focus, col_focus);
                break;
            case "tab":
            case "vim_right":
            case "right_arrow":
                right_arrow_navigation(row_focus, col_focus);
                break;
            case "down_arrow":
            case "vim_down":
                // We stop user at last table row
                // so that user doesn't end up in
                // input box where it is impossible to
                // get out of using vim_up / vim_down
                // keys. This also blocks the user from
                // having `jjjj` typed in the input box
                // when continuously pressing `j`.
                if (is_focus_at_last_table_row()) {
                    return true;
                }
                down_arrow_navigation();
                break;
            case "vim_up":
                // See comment on vim_down.
                // Similarly, blocks the user from
                // having `kkkk` typed in the input box
                // when continuously pressing `k`.
                if (row_focus === 0) {
                    return true;
                }
                up_arrow_navigation(row_focus, col_focus);
                break;
            case "up_arrow":
                up_arrow_navigation(row_focus, col_focus);
                break;
            case "page_up":
                page_up_navigation();
                return true;
            case "page_down":
                page_down_navigation();
                return true;
        }

        if (check_row_type_transition(row_focus, col_focus)) {
            col_focus = get_max_selectable_cols(row_focus) - 1;
        }

        set_table_focus(row_focus, col_focus, true);
        return true;
    }
    if ($current_focus_elem && input_key !== "escape") {
        $current_focus_elem.trigger("focus");
        if ($current_focus_elem.hasClass("btn-recent-filters")) {
            _compose_closed_ui__WEBPACK_IMPORTED_MODULE_7__.set_standard_text_for_reply_button();
        }
        return true;
    }

    return false;
}


/***/ }),

/***/ "./static/js/recent_topics_util.js":
/*!*****************************************!*\
  !*** ./static/js/recent_topics_util.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_key_from_message": () => (/* binding */ get_key_from_message),
/* harmony export */   "get_topic_key": () => (/* binding */ get_topic_key),
/* harmony export */   "is_in_focus": () => (/* binding */ is_in_focus),
/* harmony export */   "is_visible": () => (/* binding */ is_visible),
/* harmony export */   "set_visible": () => (/* binding */ set_visible)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");






let is_rt_visible = false;

function set_visible(value) {
    is_rt_visible = value;
}

function is_visible() {
    return is_rt_visible;
}

function is_in_focus() {
    // Check if user is focused on
    // recent topics.
    return (
        is_visible() &&
        !_compose_state__WEBPACK_IMPORTED_MODULE_1__.composing() &&
        !_popovers__WEBPACK_IMPORTED_MODULE_3__.any_active() &&
        !_overlays__WEBPACK_IMPORTED_MODULE_2__.is_overlay_or_modal_open() &&
        !jquery__WEBPACK_IMPORTED_MODULE_0___default()(".home-page-input").is(":focus")
    );
}

function get_topic_key(stream_id, topic) {
    return stream_id + ":" + topic.toLowerCase();
}

function get_key_from_message(msg) {
    if (msg.type === "private") {
        // The to_user_ids field on a private message object is a
        // string containing the user IDs involved in the message in
        // sorted order.
        return msg.to_user_ids;
    } else if (msg.type === "stream") {
        return get_topic_key(msg.stream_id, msg.topic);
    }
    throw new Error(`Invalid message type ${msg.type}`);
}


/***/ }),

/***/ "./static/js/reload.js":
/*!*****************************!*\
  !*** ./static/js/reload.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initiate": () => (/* binding */ initiate),
/* harmony export */   "is_stale_refresh_token": () => (/* binding */ is_stale_refresh_token)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
/* harmony import */ var _hashchange__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./hashchange */ "./static/js/hashchange.js");
/* harmony import */ var _localstorage__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./localstorage */ "./static/js/localstorage.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _server_events__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./server_events */ "./static/js/server_events.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




















// Read https://zulip.readthedocs.io/en/latest/subsystems/hashchange-system.html
function preserve_state(send_after_reload, save_pointer, save_narrow, save_compose) {
    if (!_localstorage__WEBPACK_IMPORTED_MODULE_9__.localstorage.supported()) {
        // If local storage is not supported by the browser, we can't
        // save the browser's position across reloads (since there's
        // no secure way to pass that state in a signed fashion to the
        // next instance of the browser client).
        //
        // So we just return here and let the reload proceed without
        // having preserved state.  We keep the hash the same so we'll
        // at least save their narrow state.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Can't preserve state; no local storage.");
        return;
    }

    let url = "#reload:send_after_reload=" + Number(send_after_reload);
    url += "+csrf_token=" + encodeURIComponent(Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    if (save_compose) {
        const msg_type = _compose_state__WEBPACK_IMPORTED_MODULE_5__.get_message_type();
        if (msg_type === "stream") {
            url += "+msg_type=stream";
            url += "+stream=" + encodeURIComponent(_compose_state__WEBPACK_IMPORTED_MODULE_5__.stream_name());
            url += "+topic=" + encodeURIComponent(_compose_state__WEBPACK_IMPORTED_MODULE_5__.topic());
        } else if (msg_type === "private") {
            url += "+msg_type=private";
            url += "+recipient=" + encodeURIComponent(_compose_state__WEBPACK_IMPORTED_MODULE_5__.private_message_recipient());
        }

        if (msg_type) {
            url += "+msg=" + encodeURIComponent(_compose_state__WEBPACK_IMPORTED_MODULE_5__.message_content());
            const draft_id = _drafts__WEBPACK_IMPORTED_MODULE_6__.update_draft();
            if (draft_id) {
                url += "+draft_id=" + encodeURIComponent(draft_id);
            }
        }
    }

    if (save_pointer) {
        const pointer = _message_lists__WEBPACK_IMPORTED_MODULE_10__.home.selected_id();
        if (pointer !== -1) {
            url += "+pointer=" + pointer;
        }
    }

    if (save_narrow) {
        const $row = _message_lists__WEBPACK_IMPORTED_MODULE_10__.home.selected_row();
        if (!_narrow_state__WEBPACK_IMPORTED_MODULE_11__.active()) {
            if ($row.length > 0) {
                url += "+offset=" + $row.offset().top;
            }
        } else {
            url += "+offset=" + _message_lists__WEBPACK_IMPORTED_MODULE_10__.home.pre_narrow_offset;

            // narrow_state.active() is true, so this is the current
            // narrowed message list.
            const narrow_pointer = _message_lists__WEBPACK_IMPORTED_MODULE_10__.current.selected_id();
            if (narrow_pointer !== -1) {
                url += "+narrow_pointer=" + narrow_pointer;
            }
            const $narrow_row = _message_lists__WEBPACK_IMPORTED_MODULE_10__.current.selected_row();
            if ($narrow_row.length > 0) {
                url += "+narrow_offset=" + $narrow_row.offset().top;
            }
        }
    }

    url += _hash_util__WEBPACK_IMPORTED_MODULE_7__.build_reload_url();

    // Delete unused states that have been around for a while.
    const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_9__.localstorage)();
    delete_stale_tokens(ls);

    // To protect the browser against CSRF type attacks, the reload
    // logic uses a random token (to distinct this browser from
    // others) which is passed via the URL to the browser (post
    // reloading).  The token is a key into local storage, where we
    // marshall and store the URL.
    //
    // TODO: Remove the now-unnecessary URL-encoding logic above and
    // just pass the actual data structures through local storage.
    const token = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(0, 1024 * 1024 * 1024 * 1024);
    const metadata = {
        url,
        timestamp: Date.now(),
    };
    ls.set("reload:" + token, metadata);
    window.location.replace("#reload:" + token);
}

function is_stale_refresh_token(token_metadata, now) {
    // TODO/compatibility: the metadata was changed from a string
    // to a map containing the string and a timestamp. For now we'll
    // delete all tokens that only contain the url. Remove this
    // early return once you can no longer directly upgrade from
    // Zulip 5.x to the current version.
    if (!token_metadata.timestamp) {
        return true;
    }

    // The time between reload token generation and use should usually be
    // fewer than 30 seconds, but we keep tokens around for a week just in case
    // (e.g. a tab could fail to load and be refreshed a while later).
    const milliseconds_in_a_day = 1000 * 60 * 60 * 24;
    const timedelta = now - token_metadata.timestamp;
    const days_since_token_creation = timedelta / milliseconds_in_a_day;
    return days_since_token_creation > 7;
}

function delete_stale_tokens(ls) {
    const now = Date.now();
    ls.removeDataRegexWithCondition("reload:\\d+", (metadata) =>
        is_stale_refresh_token(metadata, now),
    );
}

// Check if we're doing a compose-preserving reload.  This must be
// done before the first call to get_events
function initialize() {
    // location.hash should be e.g. `#reload:12345123412312`
    if (!location.hash.startsWith("#reload:")) {
        return;
    }
    const hash_fragment = location.hash.slice("#".length);

    // Using the token, recover the saved pre-reload data from local
    // storage.  Afterwards, we clear the reload entry from local
    // storage to avoid a local storage space leak.
    const ls = (0,_localstorage__WEBPACK_IMPORTED_MODULE_9__.localstorage)();
    let fragment = ls.get(hash_fragment);
    if (fragment === undefined) {
        // Since this can happen sometimes with hand-reloading, it's
        // not really worth throwing an exception if these don't
        // exist, but be log it so that it's available for future
        // debugging if an exception happens later.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid hash change reload token");
        _hashchange__WEBPACK_IMPORTED_MODULE_8__.changehash("");
        return;
    }
    ls.remove(hash_fragment);

    // TODO/compatibility: `fragment` was changed from a string
    // to a map containing the string and a timestamp. For now we'll
    // delete all tokens that only contain the url. Remove the
    // `|| fragment` once you can no longer directly upgrade
    // from Zulip 5.x to the current version.
    [, fragment] = /^#reload:(.*)/.exec(fragment.url || fragment);
    const keyvals = fragment.split("+");
    const vars = {};

    for (const str of keyvals) {
        const pair = str.split("=");
        vars[pair[0]] = decodeURIComponent(pair[1]);
    }

    if (vars.msg !== undefined) {
        const send_now = Number.parseInt(vars.send_after_reload, 10);

        try {
            _compose_actions__WEBPACK_IMPORTED_MODULE_4__.start(vars.msg_type, {
                stream: vars.stream || "",
                topic: vars.topic || "",
                private_message_recipient: vars.recipient || "",
                content: vars.msg || "",
                draft_id: vars.draft_id || "",
            });
            if (send_now) {
                _compose__WEBPACK_IMPORTED_MODULE_3__.finish();
            }
        } catch (error) {
            // We log an error if we can't open the compose box, but otherwise
            // we continue, since this is not critical.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error.toString());
        }
    }

    const pointer = Number.parseInt(vars.pointer, 10);

    if (pointer) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = pointer;
    }
    const offset = Number.parseInt(vars.offset, 10);
    if (offset) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = offset;
    }

    const narrow_pointer = Number.parseInt(vars.narrow_pointer, 10);
    if (narrow_pointer) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = narrow_pointer;
    }
    const narrow_offset = Number.parseInt(vars.narrow_offset, 10);
    if (narrow_offset) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = narrow_offset;
    }

    _activity__WEBPACK_IMPORTED_MODULE_1__.set_new_user_input(false);
    _hashchange__WEBPACK_IMPORTED_MODULE_8__.changehash(vars.oldhash);
}

function do_reload_app(send_after_reload, save_pointer, save_narrow, save_compose, message_html) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("do_reload_app: Doing nothing since reload_in_progress");
        return;
    }

    // TODO: we should completely disable the UI here
    if (save_pointer || save_narrow || save_compose) {
        try {
            preserve_state(send_after_reload, save_pointer, save_narrow, save_compose);
        } catch (error) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Failed to preserve state", undefined, error.stack);
        }
    }

    // TODO: We need a better API for showing messages.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message_html, jquery__WEBPACK_IMPORTED_MODULE_0___default()("#reloading-application"));
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Starting server requested page reload");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    // Sometimes the window.location.reload that we attempt has no
    // immediate effect (likely by browsers trying to save power by
    // skipping requested reloads), which can leave the Zulip app in a
    // broken state and cause lots of confusing tracebacks.  So, we
    // set ourselves to try reloading a bit later, both periodically
    // and when the user focuses the window.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).one("focus", () => {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Retrying on-focus page reload");
        window.location.reload(true);
    });

    function retry_reload() {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Retrying page reload due to 30s timer");
        window.location.reload(true);
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(retry_reload, 30000);

    try {
        _server_events__WEBPACK_IMPORTED_MODULE_12__.cleanup_event_queue();
    } catch (error) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Failed to clean up before reloading", undefined, error.stack);
    }

    window.location.reload(true);
}

function initiate({
    immediate = false,
    save_pointer = true,
    save_narrow = true,
    save_compose = true,
    send_after_reload = false,
    message_html = "Reloading ...",
}) {
    if (immediate) {
        do_reload_app(send_after_reload, save_pointer, save_narrow, save_compose, message_html);
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() || Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return;
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    // We're now planning to execute a reload of the browser, usually
    // to get an updated version of the Zulip web app code.  Because in
    // most cases all browsers will be receiving this notice at the
    // same or similar times, we need to randomize the time that we do
    // this in order to avoid a thundering herd overloading the server.
    //
    // Additionally, we try to do this reload at a time the user will
    // not notice.  So completely idle clients will reload first;
    // those will an open compose box will wait until the message has
    // been sent (or until it's clear the user isn't likely to send it).
    //
    // And then we unconditionally reload sometime after 30 minutes
    // even if there is continued activity, because we don't support
    // old JavaScript versions against newer servers and eventually
    // letting that situation continue will lead to users seeing bugs.
    //
    // It's a little odd that how this timeout logic works with
    // compose box resets including the random variance, but that
    // makes it simple to reason about: We know that reloads will be
    // spread over at least 5 minutes in all cases.

    let idle_control;
    const random_variance = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(0, 1000 * 60 * 5);
    const unconditional_timeout = 1000 * 60 * 30 + random_variance;
    const composing_idle_timeout = 1000 * 60 * 7 + random_variance;
    const basic_idle_timeout = 1000 * 60 * 1 + random_variance;
    let compose_started_handler;

    function reload_from_idle() {
        do_reload_app(false, save_pointer, save_narrow, save_compose, message_html);
    }

    // Make sure we always do a reload eventually after
    // unconditional_timeout.  Because we save cursor location and
    // compose state when reloading, we expect this to not be
    // particularly disruptive.
    setTimeout(reload_from_idle, unconditional_timeout);

    const compose_done_handler = function () {
        // If the user sends their message or otherwise closes
        // compose, we return them to the not-composing timeouts.
        idle_control.cancel();
        idle_control = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).idle({idle: basic_idle_timeout, onIdle: reload_from_idle});
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).off("compose_canceled.zulip compose_finished.zulip", compose_done_handler);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("compose_started.zulip", compose_started_handler);
    };
    compose_started_handler = function () {
        // If the user stops being idle and starts composing a
        // message, switch to the compose-open timeouts.
        idle_control.cancel();
        idle_control = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).idle({idle: composing_idle_timeout, onIdle: reload_from_idle});
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).off("compose_started.zulip", compose_started_handler);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("compose_canceled.zulip compose_finished.zulip", compose_done_handler);
    };

    if (_compose_state__WEBPACK_IMPORTED_MODULE_5__.composing()) {
        idle_control = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).idle({idle: composing_idle_timeout, onIdle: reload_from_idle});
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("compose_canceled.zulip compose_finished.zulip", compose_done_handler);
    } else {
        idle_control = jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).idle({idle: basic_idle_timeout, onIdle: reload_from_idle});
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on("compose_started.zulip", compose_started_handler);
    }
}

window.addEventListener("beforeunload", () => {
    // When navigating away from the page do not try to reload.
    // The polling get_events call will fail after we delete the event queue.
    // When that happens we reload the page to correct the problem. If this
    // happens before the navigation is complete the user is kept captive at
    // zulip.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Setting reload_in_progress in beforeunload handler");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
});

Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(() => {
    initiate({
        immediate: true,
        save_pointer: true,
        save_narrow: true,
        save_compose: true,
    });
});


/***/ }),

/***/ "./static/js/reminder.js":
/*!*******************************!*\
  !*** ./static/js/reminder.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "deferred_message_types": () => (/* binding */ deferred_message_types),
/* harmony export */   "do_set_reminder_for_message": () => (/* binding */ do_set_reminder_for_message),
/* harmony export */   "is_deferred_delivery": () => (/* binding */ is_deferred_delivery),
/* harmony export */   "patch_request_for_scheduling": () => (/* binding */ patch_request_for_scheduling),
/* harmony export */   "schedule_message": () => (/* binding */ schedule_message)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _transmit__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./transmit */ "./static/js/transmit.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());














const deferred_message_types = {
    scheduled: {
        delivery_type: "send_later",
        test: /^\/schedule/,
        slash_command: "/schedule",
    },
    reminders: {
        delivery_type: "remind",
        test: /^\/remind/,
        slash_command: "/remind",
    },
};

function is_deferred_delivery(message_content) {
    const reminders_test = deferred_message_types.reminders.test;
    const scheduled_test = deferred_message_types.scheduled.test;
    return reminders_test.test(message_content) || scheduled_test.test(message_content);
}

function patch_request_for_scheduling(request, message_content, deliver_at, delivery_type) {
    if (request.type === "private") {
        request.to = JSON.stringify(request.to);
    } else {
        request.to = JSON.stringify([request.to]);
    }

    const new_request = request;
    new_request.content = message_content;
    new_request.deliver_at = deliver_at;
    new_request.delivery_type = delivery_type;
    new_request.tz_guess = new Intl.DateTimeFormat().resolvedOptions().timeZone;
    return new_request;
}

function schedule_message(request = _compose__WEBPACK_IMPORTED_MODULE_2__.create_message_object()) {
    const raw_message = request.content.split("\n");
    const command_line = raw_message[0];
    const message = raw_message.slice(1).join("\n");

    const deferred_message_type = Object.values(deferred_message_types).find(
        (props) => command_line.match(props.test) !== null,
    );
    const command = command_line.match(deferred_message_type.test)[0];

    const deliver_at = command_line.slice(command.length + 1);

    let error_message;
    if (command_line.slice(command.length, command.length + 1) !== " ") {
        error_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage:
                "Invalid slash command. Check if you are missing a space after the command.",
        });
    } else if (deliver_at.trim() === "") {
        error_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Please specify a date or time."});
    } else if (message.trim() === "") {
        error_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You have nothing to send!"});
    }

    if (error_message) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            error_message,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea"),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").prop("disabled", false);
        return;
    }

    request = patch_request_for_scheduling(
        request,
        message,
        deliver_at,
        deferred_message_type.delivery_type,
    );

    const success = function (data) {
        if (request.delivery_type === deferred_message_types.scheduled.delivery_type) {
            const deliver_at = data.deliver_at;
            _notifications__WEBPACK_IMPORTED_MODULE_6__.notify_above_composebox(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: `Message scheduled for {deliver_at}`}, {deliver_at}),
            );
        }
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").prop("disabled", false);
        _compose__WEBPACK_IMPORTED_MODULE_2__.clear_compose_box();
    };
    const error = function (response) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").prop("disabled", false);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            response,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea"),
        );
    };
    /* We are adding a disable on compose under this block because we
    want slash commands to be blocking in nature. */
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").prop("disabled", true);

    const future_message = true;
    _transmit__WEBPACK_IMPORTED_MODULE_8__.send_message(request, success, error, future_message);
}

function do_set_reminder_for_message(message_id, timestamp) {
    const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`[zid='${CSS.escape(message_id)}']`);
    function error() {
        $row.find(".alert-msg")
            .text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Reminder not set!"}))
            .css("display", "block")
            .css("color", "#b94a48")
            .delay(1000)
            .fadeOut(300, function () {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).css("color", "");
            });
    }

    const message = _message_lists__WEBPACK_IMPORTED_MODULE_5__.current.get(message_id);

    if (!message.raw_content) {
        const msg_list = _message_lists__WEBPACK_IMPORTED_MODULE_5__.current;
        _channel__WEBPACK_IMPORTED_MODULE_1__.get({
            url: "/json/messages/" + message.id,
            success(data) {
                if (_message_lists__WEBPACK_IMPORTED_MODULE_5__.current === msg_list) {
                    message.raw_content = data.raw_content;
                    do_set_reminder_for_message(message_id, timestamp);
                }
            },
            error,
        });
        return;
    }

    const link_to_msg = _hash_util__WEBPACK_IMPORTED_MODULE_4__.by_conversation_and_time_url(message);
    const reminder_msg_content =
        message.raw_content + "\n\n[Link to conversation](" + link_to_msg + ")";
    let reminder_message = {
        type: "private",
        sender_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        stream: "",
    };
    reminder_message.topic = "";

    const recipient = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const emails = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(recipient);
    reminder_message.to = emails;
    reminder_message.reply_to = recipient;
    reminder_message.private_message_recipient = recipient;
    reminder_message.to_user_ids = _people__WEBPACK_IMPORTED_MODULE_7__.email_list_to_user_ids_string(emails);

    function success() {
        $row.find(".alert-msg")
            .text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Reminder set!"}))
            .css("display", "block")
            .delay(1000)
            .fadeOut(300);
    }

    reminder_message = patch_request_for_scheduling(
        reminder_message,
        reminder_msg_content,
        timestamp,
        deferred_message_types.reminders.delivery_type,
    );
    _transmit__WEBPACK_IMPORTED_MODULE_8__.send_message(reminder_message, success, error);
}


/***/ }),

/***/ "./static/js/rendered_markdown.js":
/*!****************************************!*\
  !*** ./static/js/rendered_markdown.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_user_id_for_mention_button": () => (/* binding */ get_user_id_for_mention_button),
/* harmony export */   "set_name_in_mention_element": () => (/* binding */ set_name_in_mention_element),
/* harmony export */   "update_elements": () => (/* binding */ update_elements)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/parseISO/index.js");
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/isValid/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_copy_code_button_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/copy_code_button.hbs */ "./static/templates/copy_code_button.hbs");
/* harmony import */ var _templates_copy_code_button_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_copy_code_button_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_markdown_timestamp_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/markdown_timestamp.hbs */ "./static/templates/markdown_timestamp.hbs");
/* harmony import */ var _templates_markdown_timestamp_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_markdown_timestamp_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_view_code_in_playground_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/view_code_in_playground.hbs */ "./static/templates/view_code_in_playground.hbs");
/* harmony import */ var _templates_view_code_in_playground_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_view_code_in_playground_hbs__WEBPACK_IMPORTED_MODULE_4__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _realm_playground__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./realm_playground */ "./static/js/realm_playground.js");
/* harmony import */ var _rtl__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./rtl */ "./static/js/rtl.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


















/*
    rendered_markdown

    This module provides a single function 'update_elements' to
    update any renamed users/streams/groups etc. and other
    dynamic parts of our rendered messages.

    Use this module wherever some Markdown rendered content
    is being displayed.
*/

function get_user_id_for_mention_button(elem) {
    const user_id_string = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elem).attr("data-user-id");
    // Handle legacy Markdown that was rendered before we cut
    // over to using data-user-id.
    const email = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elem).attr("data-user-email");

    if (user_id_string === "*" || email === "*") {
        return "*";
    }

    if (user_id_string) {
        return Number.parseInt(user_id_string, 10);
    }

    if (email) {
        // Will return undefined if there's no match
        const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_email(email);
        if (user) {
            return user.user_id;
        }
    }
    return undefined;
}

function get_user_group_id_for_mention_button(elem) {
    const user_group_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elem).attr("data-user-group-id");

    if (user_group_id) {
        return Number.parseInt(user_group_id, 10);
    }

    return undefined;
}

// Helper function to update a mentioned user's name.
function set_name_in_mention_element(element, name) {
    if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).hasClass("silent")) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).text(name);
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).text("@" + name);
    }
}

const update_elements = ($content) => {
    // Set the rtl class if the text has an rtl direction
    if (_rtl__WEBPACK_IMPORTED_MODULE_8__.get_direction($content.text()) === "rtl") {
        $content.addClass("rtl");
    }

    $content.find(".user-mention").each(function () {
        const user_id = get_user_id_for_mention_button(this);
        // We give special highlights to the mention buttons
        // that refer to the current user.
        if (user_id === "*" || _people__WEBPACK_IMPORTED_MODULE_6__.is_my_user_id(user_id)) {
            // Either a wildcard mention or us, so mark it.
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).addClass("user-mention-me");
        }
        if (user_id && user_id !== "*" && !jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find(".highlight").length) {
            // If it's a mention of a specific user, edit the
            // mention text to show the user's current name,
            // assuming that you're not searching for text
            // inside the highlight.
            const person = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id, true);
            if (person !== undefined) {
                // Note that person might be undefined in some
                // unpleasant corner cases involving data import.
                set_name_in_mention_element(this, person.full_name);
            }
        }
    });

    $content.find(".user-group-mention").each(function () {
        const user_group_id = get_user_group_id_for_mention_button(this);
        let user_group;
        try {
            user_group = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_group_id);
        } catch {
            // This is a user group the current user doesn't have
            // data on.  This can happen when user groups are
            // deleted.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Rendered unexpected user group " + user_group_id);
            return;
        }

        const my_user_id = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id();
        // Mark user group you're a member of.
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(my_user_id, user_group_id)) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).addClass("user-mention-me");
        }

        if (user_group_id && !jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find(".highlight").length) {
            // Edit the mention to show the current name for the
            // user group, if its not in search.
            set_name_in_mention_element(this, user_group.name);
        }
    });

    $content.find("a.stream").each(function () {
        const stream_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("data-stream-id"), 10);
        if (stream_id && !jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find(".highlight").length) {
            // Display the current name for stream if it is not
            // being displayed in search highlight.
            const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_9__.maybe_get_stream_name(stream_id);
            if (stream_name !== undefined) {
                // If the stream has been deleted,
                // stream_data.maybe_get_stream_name might return
                // undefined.  Otherwise, display the current stream name.
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).text("#" + stream_name);
            }
        }
    });

    $content.find("a.stream-topic").each(function () {
        const stream_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("data-stream-id"), 10);
        if (stream_id && !jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find(".highlight").length) {
            // Display the current name for stream if it is not
            // being displayed in search highlight.
            const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_9__.maybe_get_stream_name(stream_id);
            if (stream_name !== undefined) {
                // If the stream has been deleted,
                // stream_data.maybe_get_stream_name might return
                // undefined.  Otherwise, display the current stream name.
                const text = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).text();
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).text("#" + stream_name + text.slice(text.indexOf(" > ")));
            }
        }
    });

    $content.find("time").each(function () {
        // Populate each timestamp span with mentioned time
        // in user's local time zone.
        const time_str = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("datetime");
        if (time_str === undefined) {
            return;
        }

        const timestamp = (0,date_fns__WEBPACK_IMPORTED_MODULE_10__["default"])(time_str);
        if ((0,date_fns__WEBPACK_IMPORTED_MODULE_11__["default"])(timestamp)) {
            const rendered_timestamp = _templates_markdown_timestamp_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(timestamp),
            });
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).html(rendered_timestamp);
        } else {
            // This shouldn't happen. If it does, we're very interested in debugging it.
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Could not parse datetime supplied by backend: ${time_str}`);
        }
    });

    $content.find("span.timestamp-error").each(function () {
        const [, time_str] = /^Invalid time format: (.*)$/.exec(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).text());
        const text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "Invalid time format: {timestamp}"},
            {timestamp: time_str},
        );
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).text(text);
    });

    $content.find("div.spoiler-header").each(function () {
        // If a spoiler block has no header content, it should have a default header.
        // We do this client side to allow for i18n by the client.
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).html().trim().length === 0) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).append(`<p>${Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Spoiler"})}</p>`);
        }

        // Add the expand/collapse button to spoiler blocks
        const toggle_button_html =
            '<span class="spoiler-button" aria-expanded="false"><span class="spoiler-arrow"></span></span>';
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).prepend(toggle_button_html);
    });

    // Display the view-code-in-playground and the copy-to-clipboard button inside the div.codehilite element.
    $content.find("div.codehilite").each(function () {
        const $codehilite = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this);
        const $pre = $codehilite.find("pre");
        const fenced_code_lang = $codehilite.data("code-language");
        if (fenced_code_lang !== undefined) {
            const playground_info =
                _realm_playground__WEBPACK_IMPORTED_MODULE_7__.get_playground_info_for_languages(fenced_code_lang);
            if (playground_info !== undefined) {
                // If a playground is configured for this language,
                // offer to view the code in that playground.  When
                // there are multiple playgrounds, we display a
                // popover listing the options.
                let title = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "View in playground"});
                const $view_in_playground_button = jquery__WEBPACK_IMPORTED_MODULE_1___default()(_templates_view_code_in_playground_hbs__WEBPACK_IMPORTED_MODULE_4___default()());
                $pre.prepend($view_in_playground_button);
                if (playground_info.length === 1) {
                    title = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "View in {playground_name}"},
                        {playground_name: playground_info[0].name},
                    );
                } else {
                    $view_in_playground_button.attr("aria-haspopup", "true");
                }
                $view_in_playground_button.attr("data-tippy-content", title);
                $view_in_playground_button.attr("aria-label", title);
            }
        }
        const $copy_button = jquery__WEBPACK_IMPORTED_MODULE_1___default()(_templates_copy_code_button_hbs__WEBPACK_IMPORTED_MODULE_2___default()());
        $pre.prepend($copy_button);
        new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())($copy_button[0], {
            text(copy_element) {
                return jquery__WEBPACK_IMPORTED_MODULE_1___default()(copy_element).siblings("code").text();
            },
        });
    });

    // Display emoji (including realm emoji) as text if
    // user_settings.emojiset is 'text'.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "text") {
        $content.find(".emoji").replaceWith(function () {
            const text = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("title");
            return ":" + text + ":";
        });
    }
};


/***/ }),

/***/ "./static/js/resize.js":
/*!*****************************!*\
  !*** ./static/js/resize.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "handler": () => (/* binding */ handler),
/* harmony export */   "reset_compose_message_max_height": () => (/* binding */ reset_compose_message_max_height),
/* harmony export */   "resize_bottom_whitespace": () => (/* binding */ resize_bottom_whitespace),
/* harmony export */   "resize_page_components": () => (/* binding */ resize_page_components),
/* harmony export */   "resize_sidebars": () => (/* binding */ resize_sidebars),
/* harmony export */   "resize_stream_filters_container": () => (/* binding */ resize_stream_filters_container),
/* harmony export */   "watch_manual_resize": () => (/* binding */ watch_manual_resize)
/* harmony export */ });
/* harmony import */ var autosize__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! autosize */ "./node_modules/autosize/dist/autosize.esm.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _condense__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./condense */ "./static/js/condense.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _navbar_alerts__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./navbar_alerts */ "./static/js/navbar_alerts.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());













function get_new_heights() {
    const res = {};
    const viewport_height = _message_viewport__WEBPACK_IMPORTED_MODULE_6__.height();
    const top_navbar_height = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#top_navbar").safeOuterHeight(true);
    const right_sidebar_shorcuts_height = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".right-sidebar-shortcuts").safeOuterHeight(true) || 0;

    res.bottom_whitespace_height = viewport_height * 0.4;

    res.main_div_min_height = viewport_height - top_navbar_height;

    res.stream_filters_max_height =
        viewport_height -
        Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#left-sidebar").css("marginTop"), 10) -
        Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(".narrows_panel").css("marginTop"), 10) -
        Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(".narrows_panel").css("marginBottom"), 10) -
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#global_filters").safeOuterHeight(true) -
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#private_messages_sticky_header").safeOuterHeight(true);

    // Don't let us crush the stream sidebar completely out of view
    res.stream_filters_max_height = Math.max(80, res.stream_filters_max_height);

    // RIGHT SIDEBAR

    const usable_height =
        viewport_height -
        Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#right-sidebar").css("marginTop"), 10) -
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#userlist-header").safeOuterHeight(true) -
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#user_search_section").safeOuterHeight(true) -
        right_sidebar_shorcuts_height;

    res.buddy_list_wrapper_max_height = Math.max(80, usable_height);

    return res;
}

function watch_manual_resize(element) {
    const box = document.querySelector(element);

    if (!box) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Bad selector in watch_manual_resize: " + element);
        return undefined;
    }

    const meta = {
        box,
        height: null,
        mousedown: false,
    };

    const box_handler = function () {
        meta.mousedown = true;
        meta.height = meta.box.clientHeight;
    };
    meta.box.addEventListener("mousedown", box_handler);

    // If the user resizes the textarea manually, we use the
    // callback to stop autosize from adjusting the height.
    // It will be re-enabled when this component is next opened.
    const body_handler = function () {
        if (meta.mousedown === true) {
            meta.mousedown = false;
            if (meta.height !== meta.box.clientHeight) {
                meta.height = meta.box.clientHeight;
                autosize__WEBPACK_IMPORTED_MODULE_0__["default"].destroy(jquery__WEBPACK_IMPORTED_MODULE_1___default()(element)).height(meta.height + "px");
            }
        }
    };
    document.body.addEventListener("mouseup", body_handler);

    return [box_handler, body_handler];
}

function reset_compose_message_max_height(bottom_whitespace_height) {
    // If the compose-box is open, we set the `max-height` property of
    // `compose-textarea` and `preview-textarea`, so that the
    // compose-box's maximum extent does not overlap the last message
    // in the current stream.  We also leave a tiny bit of space after
    // the last message of the current stream.

    // Compute bottom_whitespace_height if not provided by caller.
    if (bottom_whitespace_height === undefined) {
        const h = get_new_heights();
        bottom_whitespace_height = h.bottom_whitespace_height;
    }

    const compose_height = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose").get(0).getBoundingClientRect().height;
    const compose_textarea_height = Math.max(
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").get(0).getBoundingClientRect().height,
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#preview_message_area").get(0).getBoundingClientRect().height,
    );
    const compose_non_textarea_height = compose_height - compose_textarea_height;

    // We ensure that the last message is not overlapped by compose box.
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#compose-textarea").css(
        "max-height",
        // Because <textarea> max-height includes padding, we subtract
        // 10 for the padding and 10 for the selected message border.
        bottom_whitespace_height - compose_non_textarea_height - 20,
    );
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#preview_message_area").css(
        "max-height",
        // Because <div> max-height doesn't include padding, we only
        // subtract 10 for the selected message border.
        bottom_whitespace_height - compose_non_textarea_height - 10,
    );
}

function resize_bottom_whitespace(h) {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bottom_whitespace").height(h.bottom_whitespace_height);

    // The height of the compose box is tied to that of
    // bottom_whitespace, so update it if necessary.
    //
    // reset_compose_message_max_height cannot compute the right
    // height correctly while compose is hidden. This is OK, because
    // we also resize compose every time it is opened.
    if (_compose_state__WEBPACK_IMPORTED_MODULE_3__.composing()) {
        reset_compose_message_max_height(h.bottom_whitespace_height);
    }
}

function resize_stream_filters_container() {
    const h = get_new_heights();
    resize_bottom_whitespace(h);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#left_sidebar_scroll_container").css("max-height", h.stream_filters_max_height);
}

function resize_sidebars() {
    const h = get_new_heights();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#buddy_list_wrapper").css("max-height", h.buddy_list_wrapper_max_height);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#left_sidebar_scroll_container").css("max-height", h.stream_filters_max_height);
    return h;
}

function resize_page_components() {
    _navbar_alerts__WEBPACK_IMPORTED_MODULE_7__.resize_app();
    const h = resize_sidebars();
    resize_bottom_whitespace(h);
}

let _old_width = jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).width();

function handler() {
    const new_width = jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).width();

    // On mobile web, we want to avoid hiding a popover here on height change,
    // especially if this resize was triggered by a virtual keyboard
    // popping up when the user opened that very popover.
    const mobile = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    if (!mobile || new_width !== _old_width) {
        _popovers__WEBPACK_IMPORTED_MODULE_9__.hide_all();
    }

    if (new_width !== _old_width) {
        _old_width = new_width;
        _condense__WEBPACK_IMPORTED_MODULE_4__.clear_message_content_height_cache();
    }
    resize_page_components();

    // Re-compute and display/remove [More] links to messages
    _condense__WEBPACK_IMPORTED_MODULE_4__.condense_and_collapse(jquery__WEBPACK_IMPORTED_MODULE_1___default()(".message_table .message_row"));

    // This function might run onReady (if we're in a narrow window),
    // but before we've loaded in the messages; in that case, don't
    // try to scroll to one.
    if (_message_lists__WEBPACK_IMPORTED_MODULE_5__.current.selected_id() !== -1) {
        if (mobile) {
            _popovers__WEBPACK_IMPORTED_MODULE_9__.set_suppress_scroll_hide();
        }

        _navigate__WEBPACK_IMPORTED_MODULE_8__.scroll_to_selected();
    }
}


/***/ }),

/***/ "./static/js/rows.js":
/*!***************************!*\
  !*** ./static/js/rows.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "first_message_in_group": () => (/* binding */ first_message_in_group),
/* harmony export */   "first_visible": () => (/* binding */ first_visible),
/* harmony export */   "get_closest_group": () => (/* binding */ get_closest_group),
/* harmony export */   "get_closest_row": () => (/* binding */ get_closest_row),
/* harmony export */   "get_message_id": () => (/* binding */ get_message_id),
/* harmony export */   "get_message_recipient_header": () => (/* binding */ get_message_recipient_header),
/* harmony export */   "get_message_recipient_row": () => (/* binding */ get_message_recipient_row),
/* harmony export */   "get_table": () => (/* binding */ get_table),
/* harmony export */   "id": () => (/* binding */ id),
/* harmony export */   "id_for_recipient_row": () => (/* binding */ id_for_recipient_row),
/* harmony export */   "is_draft_row": () => (/* binding */ is_draft_row),
/* harmony export */   "last_visible": () => (/* binding */ last_visible),
/* harmony export */   "local_echo_id": () => (/* binding */ local_echo_id),
/* harmony export */   "next_visible": () => (/* binding */ next_visible),
/* harmony export */   "prev_visible": () => (/* binding */ prev_visible),
/* harmony export */   "recipient_from_group": () => (/* binding */ recipient_from_group),
/* harmony export */   "visible_range": () => (/* binding */ visible_range)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");





// We don't need an andSelf() here because we already know
// that our next element is *not* a message_row, so this
// isn't going to end up empty unless we're at the bottom or top.
function next_visible($message_row) {
    if ($message_row === undefined || $message_row.length === 0) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()();
    }
    const $row = $message_row.next(".selectable_row");
    if ($row.length !== 0) {
        return $row;
    }
    const $recipient_row = get_message_recipient_row($message_row);
    const $next_recipient_rows = $recipient_row.nextAll(".recipient_row");
    if ($next_recipient_rows.length === 0) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()();
    }
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".selectable_row", $next_recipient_rows[0]).first();
}

function prev_visible($message_row) {
    if ($message_row === undefined || $message_row.length === 0) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()();
    }
    const $row = $message_row.prev(".selectable_row");
    if ($row.length !== 0) {
        return $row;
    }
    const $recipient_row = get_message_recipient_row($message_row);
    const $prev_recipient_rows = $recipient_row.prevAll(".recipient_row");
    if ($prev_recipient_rows.length === 0) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()();
    }
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".selectable_row", $prev_recipient_rows[0]).last();
}

function first_visible() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table .selectable_row").first();
}

function last_visible() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table .selectable_row").last();
}

function visible_range(start_id, end_id) {
    /*
        Get all visible rows between start_id
        and end_in, being inclusive on both ends.
    */

    const rows = [];

    let $row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get_row(start_id);
    let msg_id = id($row);

    while (msg_id <= end_id) {
        rows.push($row);

        if (msg_id >= end_id) {
            break;
        }
        $row = next_visible($row);
        msg_id = id($row);
    }

    return rows;
}

function is_draft_row($row) {
    return $row.find(".restore-draft").length >= 1;
}

function id($message_row) {
    if (is_draft_row($message_row)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Drafts have no zid");
        return undefined;
    }

    /*
        For blueslip errors, don't return early, since
        we may have some code now that actually relies
        on the NaN behavior here.  We can try to clean
        that up in the future, but we mainly just want
        more data now.
    */

    if ($message_row.length !== 1) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Caller should pass in a single row.");
    }

    const zid = $message_row.attr("zid");

    if (zid === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Calling code passed rows.id a row with no zid attr.");
    }

    return Number.parseFloat(zid);
}

function local_echo_id($message_row) {
    const zid = $message_row.attr("zid");

    if (zid === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Calling code passed rows.local_id a row with no zid attr.");
        return undefined;
    }

    if (!zid.includes(".0")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get local_id from row that has reified message id: " + zid);
    }

    return zid;
}

const valid_table_names = new Set(["zhome", "zfilt"]);

function get_table(table_name) {
    if (!valid_table_names.has(table_name)) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()();
    }

    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(table_name)}`);
}

function get_message_id(elem) {
    // Gets the message_id for elem, where elem is a DOM
    // element inside a message.  This is typically used
    // in click handlers for things like the reaction button.
    const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).closest(".message_row");
    const message_id = id($row);
    return message_id;
}

function get_closest_group(element) {
    // This gets the closest message row to an element, whether it's
    // a recipient bar or message.  With our current markup,
    // this is the most reliable way to do it.
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(element).closest("div.recipient_row");
}

function get_closest_row(element) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(element).closest("div.message_row");
}

function first_message_in_group(message_group) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("div.message_row", message_group).first();
}

function get_message_recipient_row($message_row) {
    return $message_row.parent(".recipient_row").expectOne();
}

function get_message_recipient_header($message_row) {
    return $message_row.parent(".recipient_row").find(".message_header").expectOne();
}

function recipient_from_group(message_group) {
    return _message_store__WEBPACK_IMPORTED_MODULE_3__.get(id(jquery__WEBPACK_IMPORTED_MODULE_0___default()(message_group).children(".message_row").first().expectOne()));
}

function id_for_recipient_row($recipient_row) {
    // A recipient row can be either a normal recipient row, or
    // the FRB, which is a fake recipient row. If it's a FRB, it has
    // a 'zid' property that stores the message id it is directly over
    const $msg_row = first_message_in_group($recipient_row);
    if ($msg_row.length === 0) {
        // If we're narrowing from the FRB, take the msg id
        // directly from it
        return id($recipient_row);
    }
    return id($msg_row);
}


/***/ }),

/***/ "./static/js/rtl.js":
/*!**************************!*\
  !*** ./static/js/rtl.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_direction": () => (/* binding */ get_direction),
/* harmony export */   "set_rtl_class_for_textarea": () => (/* binding */ set_rtl_class_for_textarea)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);


// How to determine the direction of a paragraph (P1-P3): https://www.unicode.org/reports/tr9/tr9-35.html#The_Paragraph_Level
// Embedding level: https://www.unicode.org/reports/tr9/tr9-35.html#BD2
// How to find the matching PDI for an isolation initiator: https://www.unicode.org/reports/tr9/tr9-35.html#BD9
// Bidirectional character types: https://www.unicode.org/reports/tr9/tr9-35.html#Table_Bidirectional_Character_Types

// Ranges data is extracted from: https://www.unicode.org/Public/9.0.0/ucd/extracted/DerivedBidiClass.txt
// References:
// https://www.unicode.org/reports/tr44/tr44-18.html#UnicodeData.txt
// https://www.unicode.org/reports/tr44/tr44-18.html#Extracted_Properties_Table
// https://www.unicode.org/Public/9.0.0/ucd/UnicodeData.txt
// https://www.unicode.org/Public/9.0.0/ucd/extracted/DerivedBidiClass.txt

/**
 * Splits {@link raw} into parts of length {@link part_length},
 * and then converts each part to a character using simple base
 * conversion with the digits {@link digits}.
 * @param {string} digits
 * @param {number} part_length
 * @param {string} raw
 * @returns {number[]}
 */
function convert_from_raw(digits, part_length, raw) {
    const result = [];
    for (let i = 0; i < raw.length; ) {
        let t = 0;
        for (let j = 0; j < part_length; j += 1) {
            t = t * digits.length + digits.indexOf(raw.charAt(i));
            i += 1;
        }
        result.push(t);
    }
    return result;
}

/** Isolate initiator characters. */
const i_chars = new Set([0x2066, 0x2067, 0x2068]);
/** Pop directional isolate character. */
const pdi_chars = new Set([0x2069]);
/** The digits that are used for base conversions from base 92. */
const digits =
    '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&()*+,-./:;<=>?@[]^_`{|}~';
/**
 * Ranges of strong non-left-to-right characters (right-to-left, and arabic-letter).
 *
 * The ranges are stored as pairs of characters, the first
 * character of the range, and the last character of the range.
 * All ranges are concatenated together and stored here.
 */
const rl_ranges = convert_from_raw(
    digits,
    2,
    'fIfIf}f}g0g0g3g3g6g6g8g"g,g,g/g/g;g;g~hKh?h[h^j1jhjijqjrjCjYj!j~krlplBm2mcmdmimJmOmOmYmYm#m#m*nknooP|j|j',
).concat(
    convert_from_raw(
        digits,
        3,
        '7S)7S)7S+7S>7S@7YZ7Y#7!n7!U7!(7!*7!+7#07$O7}U81%81(84g84k84k84n84r84w84+84/84<84>86Y86"87Q87Y8gv8g"8k=e)]e,fe,ne-De-Le|je|mf0f',
    ),
);
/**
 * Ranges of strong left-to-right characters.
 *
 * The ranges are stored as pairs of characters, the first
 * character of the range, and the last character of the range.
 * All ranges are concatenated together and stored here.
 */
const lr_ranges = convert_from_raw(
    digits,
    2,
    '0$0}151u1<1<1|1|2222282u2w2!2#7Q7T7Z7:7;80848e8e9Q9T9W9$9&9+9.9.9:b1b3cOcWfBfDfEp7pZp"p"p$p(p;p>p@p]q0q9qcqEqGr7r9rcrhrorqrJrMrZr#r*r,r:r=sHsJsMsPsSsVsWs!s#s%t3t6t8tatktnt=t?t]t}t}u1u4u6upusuEuGuUuWvnvpvqvsvsvxvEvGvNvPvZv#w1w3w"w$w:w<xmxvxzxBy5y9ydyhyhymysyvyFyIy"y+y,y.zDzFzTzWz;z>AgAiA>A^B0B2BlBoCxCzCFCJCJCLDIDKDLDTDWDYD%D/E>E@E[E}E}F1FbFiF~G2GsGuGuGwGwGCG{HbHbHhHhHkHoHAHAH-H?H[J0J5J5JcJcJfJgJjJHJKJNJRJ(J-J^J`J{J~K4K6KkKmR>R]SDSOTXTZ!T!V!@!^#h#l#N#R#?#]$l$o$`$}$}%6%d%f%g%s%y%A%A%C%T%%%+%`(k(n(U(W)[)`)}*1*9*b*g*k*n*p*r*u+|,w,S,V,W,Y-p-r-r-z-z-B-B-D-E-N-S-$-%-(.n.D/b/g/"/$/$/+/+/-/;/=:q:A:L:O:?:_:`:}:};2;V;X;X;!;#;%;%;*<z<I<J<M>f>j>j>x>x>F>I>K>P>R>T>W@+[y[C[I{s{u{u{y{I{M{Y{#{:{>|0|3|3|i|i}p}r}D}D}T}+~Z~/~<~<~[~[',
).concat(
    convert_from_raw(
        digits,
        3,
        '0~_10310510510910d10k10k10m10m10o10o10q10t10v10F10I10L10R10V10!10"10>11s11w11z15}16%17117118f18f18T18=18~19j19>1a$1fU1fU1js1m71s]1s^1tq1tr1t!1t#1t;1t;1t_1uj1uo1w]1w~1x21x61xc1xk1yS1yU1zX1A)1Bz1B!1B!1CY1C+1Fa1Fz1FM1FP1FV1FX1F^1G11G61G71G91Gd1Gg1Gk1Go1Hk1Hp1Hr1Ht1Iq1Is1KD1K:1LE1LH1L~1Mg1MH1ML1N41Nk1Nv1NA1Pi1Pn1Qt1Qw1Q!1Q#2wv2x44|[4}L52452853a53s53V53Y54L54O54"55656f56h57J57L57N57P57S57U57>57[57[57{58758a58&58,59T59W59[5aa5aZ5a*5b25be5bX5b"5ci5ck5cl5cq5cr5ct5c(5c*5dI5dP5dQ5dT5dU5dX5d*5d,5d=5d?5ez5eB5e`5e|5e|5f15f25f55f95fc5fc5fe5fT5fW5f$5f&5is5iu5iv5ix5iA5iC7S(7"67"b7""7""7"[7"[7"{7"~7$Q7$Q7$^7%i7%p7%O7%!7&~7(77(77(f7(f7(w7+c7+e7+/7,Z7,"7,:7,=7,?7->7-@7:v7:Y7;|7<37}T8k>8k>8k@8lH8lX8l)8l}8mm8mq8m.8m=8m>8m[8nX8n"8o68oc8oc8ol8o@8o]8p38p68pV8p&8p;8p?8q_8q}8q~8r18r18r48r98rb8s<8s>8s@8s~8tj8tm8t=8t?8t[8t^8ut8uB8uD8uJ8wT8w#8w$8w)8w)8w+8x_8y18y18y38y68y98y98yc8A$8A*8A/8A<8A<8A?8Bf8Bi8Ca8Cj8Ck8Cm8Cm8Cp8CT8C)8DC8DE8DE8DG8DH8DO8DO8DQ8EY8E#8E$8E*8E*8E:8S+8S=8S=8S_8T;8U88U98Uh8Uh8Uk8Uk8Una|[a||a}Ta}"ba*ba/dFgdFjdFjdFoe72e76e7ee7ve7we7Ee7)e7.e8"e9GebHecDemiemkem:em<enGenIeo8eoaeo%eo(eo;epAeu`evPevSewdewkewmewzewBewWew#ew#ew>eLXeL&eL&eL^eL_eM2eM2eM5eM5eMbe)[f0Yf0"f1,f1[f27f28f2of2of2Ef2Ef2<f2`f39f49f4cf8LfjffjrfjFfjHfjPfjXfk]fl3fl|fmDfmQfmTfnkfnrfnCfnHfn]fn~foufpzfpPfpPfpYfp&fp)fp*fp[fp[fq4fq7fqnfqTfq.frrfrtfIZfI#nl1nl4u|xu|AC$$C$(KG5KG8SiBSiEZ_)Z_,)"9)"c;DF;DI^f-',
    ),
    convert_from_raw(digits, 4, "0^f:10]d10]g18YJ18YM1gA;1g?A1odh1odk1v?N1v?Q1DV?1DV]1DV]"),
);

/**
 * Gets a character and returns a simplified version of its bidirectional class.
 * @param {number} ch A character to get its bidirectional class.
 * @returns {'I' | 'PDI' | 'R' | 'L' | 'Other'}
 */
function get_bidi_class(ch) {
    if (i_chars.has(ch)) {
        return "I"; // LRI, RLI, FSI
    }
    if (pdi_chars.has(ch)) {
        return "PDI";
    }
    let i = lodash__WEBPACK_IMPORTED_MODULE_0___default().sortedIndex(rl_ranges, ch);
    if (i < rl_ranges.length && (rl_ranges[i] === ch || i % 2 === 1)) {
        return "R"; // R, AL
    }
    i = lodash__WEBPACK_IMPORTED_MODULE_0___default().sortedIndex(lr_ranges, ch);
    if (i < lr_ranges.length && (lr_ranges[i] === ch || i % 2 === 1)) {
        return "L";
    }
    return "Other";
}

/**
 * Gets the direction that should be used to show the string.
 * @param {string} str The string to get its direction.
 * @returns {'ltr' | 'rtl'}
 */
function get_direction(str) {
    let isolations = 0;
    for (const ch of str) {
        const bidi_class = get_bidi_class(ch.codePointAt(0));
        switch (bidi_class) {
            case "I":
                // LRI, RLI, FSI
                isolations += 1;
                break;
            case "PDI":
                if (isolations > 0) {
                    isolations -= 1;
                }
                break;
            case "R":
                // R, AL
                if (isolations === 0) {
                    return "rtl";
                }
                break;
            case "L":
                if (isolations === 0) {
                    return "ltr";
                }
                break;
        }
    }
    return "ltr";
}

function set_rtl_class_for_textarea($textarea) {
    // Set the rtl class if the text has an rtl direction, remove it otherwise
    let text = $textarea.val();
    if (text.startsWith("```quote")) {
        text = text.slice(8);
    }
    if (get_direction(text) === "rtl") {
        $textarea.addClass("rtl");
    } else {
        $textarea.removeClass("rtl");
    }
}


/***/ }),

/***/ "./static/js/schema.js":
/*!*****************************!*\
  !*** ./static/js/schema.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "check_array": () => (/* binding */ check_array),
/* harmony export */   "check_record": () => (/* binding */ check_record),
/* harmony export */   "check_string": () => (/* binding */ check_string)
/* harmony export */ });
/*

These runtime schema validators are defensive and
should always succeed, so we don't necessarily want
to translate these.  These are very similar to server
side validators in zerver/lib/validator.py.

*/

function check_string(var_name, val) {
    if (typeof val !== "string") {
        return var_name + " is not a string";
    }
    return undefined;
}

function check_record(var_name, val, fields) {
    if (typeof val !== "object") {
        return var_name + " is not a record";
    }

    const field_results = Object.entries(fields).map(([field_name, f]) => {
        if (val[field_name] === undefined) {
            return field_name + " is missing";
        }
        return f(field_name, val[field_name]);
    });

    const msg = field_results.filter(Boolean).sort().join(", ");

    if (msg) {
        return "in " + var_name + " " + msg;
    }

    return undefined;
}

function check_array(var_name, val, checker) {
    if (!Array.isArray(val)) {
        return var_name + " is not an array";
    }

    for (const item of val) {
        const msg = checker("item", item);

        if (msg) {
            return "in " + var_name + " we found an item where " + msg;
        }
    }

    return undefined;
}


/***/ }),

/***/ "./static/js/scroll_bar.js":
/*!*********************************!*\
  !*** ./static/js/scroll_bar.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "set_layout_width": () => (/* binding */ set_layout_width)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




// A few of our width properties in Zulip depend on the width of the
// browser scrollbar that is generated at the far right side of the
// page, which unfortunately varies depending on the browser and
// cannot be detected directly using CSS.  As a result, we adjust a
// number of element widths based on the value detected here.
//
// From https://stackoverflow.com/questions/13382516/getting-scroll-bar-width-using-javascript
function getScrollbarWidth() {
    const outer = document.createElement("div");
    outer.style.visibility = "hidden";
    outer.style.width = "100px";
    outer.style.msOverflowStyle = "scrollbar"; // needed for WinJS apps

    document.body.append(outer);

    const widthNoScroll = outer.offsetWidth;
    // force scrollbars
    outer.style.overflow = "scroll";

    // add inner div
    const inner = document.createElement("div");
    inner.style.width = "100%";
    outer.append(inner);

    const widthWithScroll = inner.offsetWidth;

    // remove divs
    outer.remove();

    return widthNoScroll - widthWithScroll;
}

let sbWidth;

function initialize() {
    // Workaround for browsers with fixed scrollbars
    sbWidth = getScrollbarWidth();
    if (sbWidth > 0) {
        // Reduce width of screen-wide parent containers, whose width doesn't vary with scrollbar width, by scrollbar width.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#navbar-container .header, .fixed-app .app-main, #compose").css(
            "width",
            `calc(100% - ${sbWidth}px)`,
        );

        // Align floating recipient bar with the middle column.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".fixed-app").css("left", "-" + sbWidth / 2 + "px");
    }
    set_layout_width();
}

function set_layout_width() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header-main, .app .app-main, .fixed-app .app-main, #compose-container").css(
            "max-width",
            "inherit",
        );
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".header-main, .app .app-main, .fixed-app .app-main, #compose-container").css(
            "max-width",
            "1400px",
        );
    }
}


/***/ }),

/***/ "./static/js/scroll_util.js":
/*!**********************************!*\
  !*** ./static/js/scroll_util.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "scroll_delta": () => (/* binding */ scroll_delta),
/* harmony export */   "scroll_element_into_container": () => (/* binding */ scroll_element_into_container)
/* harmony export */ });
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");


function scroll_delta(opts) {
    const elem_top = opts.elem_top;
    const container_height = opts.container_height;
    const elem_bottom = opts.elem_bottom;

    let delta = 0;

    if (elem_top < 0) {
        delta = Math.max(elem_top, elem_bottom - container_height);
        delta = Math.min(0, delta);
    } else {
        if (elem_bottom > container_height) {
            delta = Math.min(elem_top, elem_bottom - container_height);
            delta = Math.max(0, delta);
        }
    }

    return delta;
}

function scroll_element_into_container($elem, $container, sticky_header_height = 0) {
    // This does the minimum amount of scrolling that is needed to make
    // the element visible.  It doesn't try to center the element, so
    // this will be non-intrusive to users when they already have
    // the element visible.

    $container = _ui__WEBPACK_IMPORTED_MODULE_0__.get_scroll_element($container);
    const elem_top = $elem.position().top - sticky_header_height;
    const elem_bottom = elem_top + $elem.innerHeight();
    const container_height = $container.height() - sticky_header_height;

    const opts = {
        elem_top,
        elem_bottom,
        container_height,
    };

    const delta = scroll_delta(opts);

    if (delta === 0) {
        return;
    }

    $container.scrollTop($container.scrollTop() + delta);
}


/***/ }),

/***/ "./static/js/search.js":
/*!*****************************!*\
  !*** ./static/js/search.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_search_form": () => (/* binding */ clear_search_form),
/* harmony export */   "focus_search": () => (/* binding */ focus_search),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initiate_search": () => (/* binding */ initiate_search),
/* harmony export */   "is_using_input_method": () => (/* binding */ is_using_input_method),
/* harmony export */   "narrow_or_search_for_term": () => (/* binding */ narrow_or_search_for_term),
/* harmony export */   "update_button_visibility": () => (/* binding */ update_button_visibility)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_search_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/search_list_item.hbs */ "./static/templates/search_list_item.hbs");
/* harmony import */ var _templates_search_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_search_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _search_pill__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./search_pill */ "./static/js/search_pill.js");
/* harmony import */ var _search_pill_widget__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./search_pill_widget */ "./static/js/search_pill_widget.js");
/* harmony import */ var _search_suggestion__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./search_suggestion */ "./static/js/search_suggestion.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());















// Exported for unit testing
let is_using_input_method = false;

function narrow_or_search_for_term(search_string) {
    const $search_query_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query");
    if (is_using_input_method) {
        // Neither narrow nor search when using input tools as
        // `updater` is also triggered when 'enter' is triggered
        // while using input tool
        return $search_query_box.val();
    }

    let operators;
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // We have to take care to append the new pill before calling this
        // function, so that the base_query includes the suggestion selected
        // along with query corresponding to the existing pills.
        const base_query = _search_pill__WEBPACK_IMPORTED_MODULE_7__.get_search_string_for_current_filter(
            _search_pill_widget__WEBPACK_IMPORTED_MODULE_8__.widget,
        );
        operators = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.parse(base_query);
    } else {
        operators = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.parse(search_string);
    }
    _narrow__WEBPACK_IMPORTED_MODULE_5__.activate(operators, {trigger: "search"});

    // It's sort of annoying that this is not in a position to
    // blur the search box, because it means that Esc won't
    // unnarrow, it'll leave the searchbox.

    // Narrowing will have already put some operators in the search box,
    // so leave the current text in.
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        $search_query_box.trigger("blur");
    }
    return $search_query_box.val();
}

function update_buttons_with_focus(focused) {
    const $search_query_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query");

    // Show buttons iff the search input is focused, or has non-empty contents,
    // or we are narrowed.
    if (focused || $search_query_box.val() || _narrow_state__WEBPACK_IMPORTED_MODULE_6__.active()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".search_button").prop("disabled", false);
    }
}

function update_button_visibility() {
    update_buttons_with_focus(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").is(":focus"));
}

function initialize() {
    const $search_query_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query");
    const $searchbox_form = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox_form");
    const $searchbox = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox");

    // Data storage for the typeahead.
    // This maps a search string to an object with a "description_html" field.
    // (It's a bit of legacy that we have an object with only one important
    // field.  There's also a "search_string" field on each element that actually
    // just represents the key of the hash, so it's redundant.)
    let search_map = new Map();

    $search_query_box.typeahead({
        source(query) {
            let base_query = "";
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                base_query = _search_pill__WEBPACK_IMPORTED_MODULE_7__.get_search_string_for_current_filter(
                    _search_pill_widget__WEBPACK_IMPORTED_MODULE_8__.widget,
                );
            }
            const suggestions = _search_suggestion__WEBPACK_IMPORTED_MODULE_9__.get_suggestions(base_query, query);
            // Update our global search_map hash
            search_map = suggestions.lookup_table;
            return suggestions.strings;
        },
        fixed: true,
        items: _search_suggestion__WEBPACK_IMPORTED_MODULE_9__.max_num_of_search_results,
        helpOnEmptyStrings: true,
        naturalSearch: true,
        highlighter(item) {
            const obj = search_map.get(item);
            return _templates_search_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default()(obj);
        },
        matcher() {
            return true;
        },
        updater(search_string) {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                _search_pill__WEBPACK_IMPORTED_MODULE_7__.append_search_string(search_string, _search_pill_widget__WEBPACK_IMPORTED_MODULE_8__.widget);
                return $search_query_box.val();
            }
            return narrow_or_search_for_term(search_string);
        },
        sorter(items) {
            return items;
        },
        stopAdvance: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        advanceKeyCodes: [8],

        on_move() {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($search_query_box[0]);
            }
        },
        // Use our custom typeahead `on_escape` hook to exit
        // the search bar as soon as the user hits Esc.
        on_escape: _message_view_header__WEBPACK_IMPORTED_MODULE_4__.exit_search,
    });

    $searchbox_form.on("compositionend", () => {
        // Set `is_using_input_method` to true if Enter is pressed to exit
        // the input tool popover and get the text in the search bar. Then
        // we suppress searching triggered by this Enter key by checking
        // `is_using_input_method` before searching.
        // More details in the commit message that added this line.
        is_using_input_method = true;
    });

    $searchbox_form
        .on("keydown", (e) => {
            update_button_visibility();
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e) && $search_query_box.is(":focus")) {
                // Don't submit the form so that the typeahead can instead
                // handle our Enter keypress. Any searching that needs
                // to be done will be handled in the keyup.
                e.preventDefault();
            }
        })
        .on("keyup", (e) => {
            if (is_using_input_method) {
                is_using_input_method = false;
                return;
            }

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e) && $search_query_box.is(":focus")) {
                // We just pressed Enter and the box had focus, which
                // means we didn't use the typeahead at all.  In that
                // case, we should act as though we're searching by
                // operators.  (The reason the other actions don't call
                // this codepath is that they first all blur the box to
                // indicate that they've done what they need to do)

                // Pill is already added during keydown event of input pills.
                narrow_or_search_for_term($search_query_box.val());
                $search_query_box.trigger("blur");
                update_buttons_with_focus(false);
            }
        });

    // Some of these functions don't actually need to be exported,
    // but the code was moved here from elsewhere, and it would be
    // more work to re-order everything and make them private.

    $search_query_box.on("focus", focus_search);
    $search_query_box.on("blur", (e) => {
        // The search query box is a visual cue as to
        // whether search or narrowing is active.  If
        // the user blurs the search box, then we should
        // update the search string to reflect the current
        // narrow (or lack of narrow).
        //
        // But we can't do this right away, because
        // selecting something in the typeahead menu causes
        // the box to lose focus a moment before.
        //
        // The workaround is to check 100ms later -- long
        // enough for the search to have gone through, but
        // short enough that the user won't notice (though
        // really it would be OK if they did).

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            const $element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.relatedTarget).closest(".pill");
            const search_pill = _search_pill_widget__WEBPACK_IMPORTED_MODULE_8__.widget.getByElement($element[0]);
            if (search_pill) {
                // The searchbox loses focus while the search
                // pill element gains focus.
                // We do not consider the searchbox to actually
                // lose focus when a pill inside it gets selected
                // or deleted by a click.
                return;
            }
        }
        setTimeout(() => {
            update_button_visibility();
        }, 100);
    });

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // Uses jquery instead of pure css as the `:focus` event occurs on `#search_query`,
        // while we want to add box-shadow to `#searchbox`. This could have been done
        // with `:focus-within` CSS selector, but it is not supported in IE or Opera.
        $searchbox.on("focusout", () => {
            _message_view_header__WEBPACK_IMPORTED_MODULE_4__.close_search_bar_and_open_narrow_description();
            $searchbox.css({"box-shadow": "unset"});
        });
    }
}

function focus_search() {
    // The search bar is not focused yet, but will be.
    update_buttons_with_focus(true);
}

function initiate_search() {
    _message_view_header__WEBPACK_IMPORTED_MODULE_4__.open_search_bar_and_close_narrow_description();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#searchbox").css({"box-shadow": "inset 0px 0px 0px 2px hsl(204, 20%, 74%)"});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").typeahead("lookup").trigger("select");
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").trigger("focus");
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query")[0]);
    }
}

function clear_search_form() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").val("");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_query").trigger("blur");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".search_button").prop("disabled", true);
}


/***/ }),

/***/ "./static/js/search_pill.js":
/*!**********************************!*\
  !*** ./static/js/search_pill.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "append_search_string": () => (/* binding */ append_search_string),
/* harmony export */   "create_item_from_search_string": () => (/* binding */ create_item_from_search_string),
/* harmony export */   "create_pills": () => (/* binding */ create_pills),
/* harmony export */   "get_search_string_for_current_filter": () => (/* binding */ get_search_string_for_current_filter),
/* harmony export */   "get_search_string_from_item": () => (/* binding */ get_search_string_from_item)
/* harmony export */ });
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _input_pill__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./input_pill */ "./static/js/input_pill.js");



function create_item_from_search_string(search_string) {
    const operator = _filter__WEBPACK_IMPORTED_MODULE_0__.Filter.parse(search_string);
    const description_html = _filter__WEBPACK_IMPORTED_MODULE_0__.Filter.describe(operator);
    return {
        display_value: search_string,
        description_html,
    };
}

function get_search_string_from_item(item) {
    return item.display_value;
}

function create_pills($pill_container) {
    const pills = _input_pill__WEBPACK_IMPORTED_MODULE_1__.create({
        $container: $pill_container,
        create_item_from_text: create_item_from_search_string,
        get_text_from_item: get_search_string_from_item,
    });
    return pills;
}

function append_search_string(search_string, pill_widget) {
    const operators = _filter__WEBPACK_IMPORTED_MODULE_0__.Filter.parse(search_string);
    for (const operator of operators) {
        const input = _filter__WEBPACK_IMPORTED_MODULE_0__.Filter.unparse([operator]);
        pill_widget.appendValue(input);
    }
    if (pill_widget.clear_text !== undefined) {
        pill_widget.clear_text();
    }
}

function get_search_string_for_current_filter(pill_widget) {
    const items = pill_widget.items();
    const search_strings = items.map((item) => item.display_value);
    return search_strings.join(" ");
}


/***/ }),

/***/ "./static/js/search_pill_widget.js":
/*!*****************************************!*\
  !*** ./static/js/search_pill_widget.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "widget": () => (/* binding */ widget)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _search_pill__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./search_pill */ "./static/js/search_pill.js");






let widget;

function initialize() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_arrows");
    widget = _search_pill__WEBPACK_IMPORTED_MODULE_3__.create_pills($container);

    widget.onPillRemove(() => {
        if (widget.items().length === 0) {
            _browser_history__WEBPACK_IMPORTED_MODULE_1__.go_to_location("");
        }
    });

    widget.createPillonPaste(() => false);
}


/***/ }),

/***/ "./static/js/search_suggestion.js":
/*!****************************************!*\
  !*** ./static/js/search_suggestion.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "finalize_search_result": () => (/* binding */ finalize_search_result),
/* harmony export */   "get_search_result": () => (/* binding */ get_search_result),
/* harmony export */   "get_suggestions": () => (/* binding */ get_suggestions),
/* harmony export */   "get_topic_suggestions_from_candidates": () => (/* binding */ get_topic_suggestions_from_candidates),
/* harmony export */   "max_num_of_search_results": () => (/* binding */ max_num_of_search_results)
/* harmony export */ });
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! handlebars/runtime */ "./node_modules/handlebars/dist/cjs/handlebars.runtime.js");
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./filter */ "./static/js/filter.js");
/* harmony import */ var _huddle_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./huddle_data */ "./static/js/huddle_data.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_topic_history_util */ "./static/js/stream_topic_history_util.js");
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");













const max_num_of_search_results = 12;

function stream_matches_query(stream_name, q) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(q, stream_name);
}

function make_person_highlighter(query) {
    const highlight_query = _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.make_query_highlighter(query);

    return function (person) {
        return highlight_query(person.full_name);
    };
}

function highlight_person(person, highlighter) {
    const avatar_url = _people__WEBPACK_IMPORTED_MODULE_5__.small_avatar_url_for_person(person);
    const highlighted_name = highlighter(person);

    return {
        id: person.user_id,
        display_value: new (handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().SafeString)(highlighted_name),
        has_image: true,
        img_src: avatar_url,
    };
}

function match_criteria(operators, criteria) {
    const filter = new _filter__WEBPACK_IMPORTED_MODULE_2__.Filter(operators);
    return criteria.some((cr) => {
        if (Object.hasOwn(cr, "operand")) {
            return filter.has_operand(cr.operator, cr.operand);
        }
        return filter.has_operator(cr.operator);
    });
}

function check_validity(last, operators, valid, invalid) {
    // valid: list of strings valid for the last operator
    // invalid: list of operators invalid for any previous operators except last.
    if (!valid.includes(last.operator)) {
        return false;
    }
    if (match_criteria(operators, invalid)) {
        return false;
    }
    return true;
}

function format_as_suggestion(terms) {
    return {
        description_html: _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.describe(terms),
        search_string: _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse(terms),
    };
}

function compare_by_huddle(huddle) {
    huddle = huddle.slice(0, -1).map((person) => {
        person = _people__WEBPACK_IMPORTED_MODULE_5__.get_by_email(person);
        return person && person.user_id;
    });

    // Construct dict for all huddles, so we can look up each's recency
    const huddles = _huddle_data__WEBPACK_IMPORTED_MODULE_3__.get_huddles();
    const huddle_dict = new Map();
    for (const [i, huddle] of huddles.entries()) {
        huddle_dict.set(huddle, i + 1);
    }

    return function (person1, person2) {
        const huddle1 = _people__WEBPACK_IMPORTED_MODULE_5__.concat_huddle(huddle, person1.user_id);
        const huddle2 = _people__WEBPACK_IMPORTED_MODULE_5__.concat_huddle(huddle, person2.user_id);

        // If not in the dict, assign an arbitrarily high index
        const score1 = huddle_dict.get(huddle1) || huddles.length + 1;
        const score2 = huddle_dict.get(huddle2) || huddles.length + 1;
        const diff = score1 - score2;

        if (diff !== 0) {
            return diff;
        }
        return _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.compare_by_pms(person1, person2);
    };
}

function get_stream_suggestions(last, operators) {
    const valid = ["stream", "search", ""];
    const invalid = [
        {operator: "stream"},
        {operator: "streams"},
        {operator: "is", operand: "private"},
        {operator: "pm-with"},
    ];
    if (!check_validity(last, operators, valid, invalid)) {
        return [];
    }

    const query = last.operand;
    let streams = _stream_data__WEBPACK_IMPORTED_MODULE_6__.subscribed_streams();

    streams = streams.filter((stream) => stream_matches_query(stream, query));

    streams = _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.sorter(query, streams);

    const regex = _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.build_highlight_regex(query);
    const highlight_query = _typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.highlight_with_escaping_and_regex;

    const objs = streams.map((stream) => {
        const prefix = "stream";
        const highlighted_stream = highlight_query(regex, stream);
        const verb = last.negated ? "exclude " : "";
        const description_html = verb + prefix + " " + highlighted_stream;
        const term = {
            operator: "stream",
            operand: stream,
            negated: last.negated,
        };
        const search_string = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse([term]);
        return {description_html, search_string};
    });

    return objs;
}

function get_group_suggestions(last, operators) {
    if (!check_validity(last, operators, ["pm-with"], [{operator: "stream"}])) {
        return [];
    }

    const operand = last.operand;
    const negated = last.negated;

    // The operand has the form "part1,part2,pa", where all but the last part
    // are emails, and the last part is an arbitrary query.
    //
    // We only generate group suggestions when there's more than one part, and
    // we only use the last part to generate suggestions.

    const last_comma_index = operand.lastIndexOf(",");
    if (last_comma_index < 0) {
        return [];
    }

    // Neither all_but_last_part nor last_part include the final comma.
    const all_but_last_part = operand.slice(0, last_comma_index);
    const last_part = operand.slice(last_comma_index + 1);

    // We don't suggest a person if their email is already present in the
    // operand (not including the last part).
    const parts = all_but_last_part.split(",").concat(_people__WEBPACK_IMPORTED_MODULE_5__.my_current_email());

    const person_matcher = _people__WEBPACK_IMPORTED_MODULE_5__.build_person_matcher(last_part);
    let persons = _people__WEBPACK_IMPORTED_MODULE_5__.filter_all_persons((person) => {
        if (parts.includes(person.email)) {
            return false;
        }
        return last_part === "" || person_matcher(person);
    });

    persons.sort(compare_by_huddle(parts));

    // Take top 15 persons, since they're ordered by pm_recipient_count.
    persons = persons.slice(0, 15);

    const prefix = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.operator_to_prefix("pm-with", negated);

    const person_highlighter = make_person_highlighter(last_part);

    const suggestions = persons.map((person) => {
        const term = {
            operator: "pm-with",
            operand: all_but_last_part + "," + person.email,
            negated,
        };

        // Note that description_html won't contain the user's
        // identity; that instead will be rendered in the separate
        // user pill.
        const description_html =
            prefix + handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().Utils.escapeExpression(" " + all_but_last_part + ",");

        let terms = [term];
        if (negated) {
            terms = [{operator: "is", operand: "private"}, term];
        }

        return {
            description_html,
            search_string: _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse(terms),
            is_person: true,
            user_pill_context: highlight_person(person, person_highlighter),
        };
    });

    return suggestions;
}

function make_people_getter(last) {
    let persons;

    /* The next function will be called between 0 and 4
       times for each keystroke in a search, but we will
       only do real work one time.
    */
    return function () {
        if (persons !== undefined) {
            return persons;
        }

        let query;

        // This next block is designed to match the behavior of the
        // `is:private` block in get_person_suggestions
        if (last.operator === "is" && last.operand === "private") {
            query = "";
        } else {
            query = last.operand;
        }

        persons = _people__WEBPACK_IMPORTED_MODULE_5__.get_people_for_search_bar(query);
        persons.sort(_typeahead_helper__WEBPACK_IMPORTED_MODULE_9__.compare_by_pms);
        return persons;
    };
}

// Possible args for autocomplete_operator: pm-with, sender, from
function get_person_suggestions(people_getter, last, operators, autocomplete_operator) {
    if (last.operator === "is" && last.operand === "private") {
        // Interpret 'is:private' as equivalent to 'pm-with:'
        last = {operator: "pm-with", operand: "", negated: false};
    }

    const query = last.operand;

    // Be especially strict about the less common "from" operator.
    if (autocomplete_operator === "from" && last.operator !== "from") {
        return [];
    }

    const valid = ["search", autocomplete_operator];
    let invalid;
    if (autocomplete_operator === "pm-with") {
        invalid = [{operator: "pm-with"}, {operator: "stream"}];
    } else {
        // If not pm-with, then this must either be 'sender' or 'from'
        invalid = [{operator: "sender"}, {operator: "from"}];
    }

    if (!check_validity(last, operators, valid, invalid)) {
        return [];
    }

    const persons = people_getter();

    const prefix = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.operator_to_prefix(autocomplete_operator, last.negated);

    const person_highlighter = make_person_highlighter(query);

    const objs = persons.map((person) => {
        const terms = [
            {
                operator: autocomplete_operator,
                operand: person.email,
                negated: last.negated,
            },
        ];
        if (autocomplete_operator === "pm-with" && last.negated) {
            // In the special case of '-pm-with', add 'is:private' before it
            // because we assume the user still wants to narrow to PMs
            terms.unshift({operator: "is", operand: "private"});
        }

        return {
            description_html: prefix,
            search_string: _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse(terms),
            is_person: true,
            user_pill_context: highlight_person(person, person_highlighter),
        };
    });

    return objs;
}

function get_default_suggestion(operators) {
    // Here we return the canonical suggestion for the query that the
    // user typed. (The caller passes us the parsed query as "operators".)
    if (operators.length === 0) {
        return {description_html: "", search_string: ""};
    }
    return format_as_suggestion(operators);
}

function get_topic_suggestions_from_candidates({candidate_topics, guess}) {
    // This function is exported for unit testing purposes.
    const max_num_topics = 10;

    if (guess === "") {
        // In the search UI, once you autocomplete the stream,
        // we just show you the most recent topics before you even
        // need to start typing any characters.
        return candidate_topics.slice(0, max_num_topics);
    }

    // Once the user starts typing characters for a topic name,
    // it is pretty likely they want to get suggestions for
    // topics that may be fairly low in our list of candidates,
    // so we do an aggressive search here.
    //
    // The following loop can be expensive if you have lots
    // of topics in a stream, so we try to exit the loop as
    // soon as we find enough matches.
    const topics = [];
    for (const topic of candidate_topics) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(guess, topic)) {
            topics.push(topic);
            if (topics.length >= max_num_topics) {
                break;
            }
        }
    }

    return topics;
}

function get_topic_suggestions(last, operators) {
    const invalid = [
        {operator: "pm-with"},
        {operator: "is", operand: "private"},
        {operator: "topic"},
    ];
    if (!check_validity(last, operators, ["stream", "topic", "search"], invalid)) {
        return [];
    }

    const operator = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.canonicalize_operator(last.operator);
    const operand = last.operand;
    const negated = operator === "topic" && last.negated;
    let stream;
    let guess;
    const filter = new _filter__WEBPACK_IMPORTED_MODULE_2__.Filter(operators);
    const suggest_operators = [];

    // stream:Rome -> show all Rome topics
    // stream:Rome topic: -> show all Rome topics
    // stream:Rome f -> show all Rome topics with a word starting in f
    // stream:Rome topic:f -> show all Rome topics with a word starting in f
    // stream:Rome topic:f -> show all Rome topics with a word starting in f

    // When narrowed to a stream:
    //   topic: -> show all topics in current stream
    //   foo -> show all topics in current stream with words starting with foo

    // If somebody explicitly types search:, then we might
    // not want to suggest topics, but I feel this is a very
    // minor issue, and Filter.parse() is currently lossy
    // in terms of telling us whether they provided the operator,
    // i.e. "foo" and "search:foo" both become [{operator: 'search', operand: 'foo'}].
    switch (operator) {
        case "stream":
            guess = "";
            stream = operand;
            suggest_operators.push(last);
            break;
        case "topic":
        case "search":
            guess = operand;
            if (filter.has_operator("stream")) {
                stream = filter.operands("stream")[0];
            } else {
                stream = _narrow_state__WEBPACK_IMPORTED_MODULE_4__.stream();
                suggest_operators.push({operator: "stream", operand: stream});
            }
            break;
    }

    if (!stream) {
        return [];
    }

    const stream_sub = _stream_data__WEBPACK_IMPORTED_MODULE_6__.get_sub(stream);
    if (!stream_sub) {
        return [];
    }

    if (_stream_data__WEBPACK_IMPORTED_MODULE_6__.can_access_topic_history(stream_sub)) {
        // Fetch topic history from the server, in case we will need it.
        // Note that we won't actually use the results from the server here
        // for this particular keystroke from the user, because we want to
        // show results immediately. Assuming the server responds quickly,
        // as the user makes their search more specific, subsequent calls to
        // this function will get more candidates from calling
        // stream_topic_history.get_recent_topic_names.
        _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_8__.get_server_history(stream_sub.stream_id, () => {});
    }

    const candidate_topics = _stream_topic_history__WEBPACK_IMPORTED_MODULE_7__.get_recent_topic_names(stream_sub.stream_id);

    if (!candidate_topics || !candidate_topics.length) {
        return [];
    }

    const topics = get_topic_suggestions_from_candidates({candidate_topics, guess});

    // Just use alphabetical order.  While recency and read/unreadness of
    // topics do matter in some contexts, you can get that from the left sidebar,
    // and I'm leaning toward high scannability for autocompletion.  I also don't
    // care about case.
    topics.sort();

    return topics.map((topic) => {
        const topic_term = {operator: "topic", operand: topic, negated};
        const operators = suggest_operators.concat([topic_term]);
        return format_as_suggestion(operators);
    });
}

function get_operator_subset_suggestions(operators) {
    // For stream:a topic:b search:c, suggest:
    //  stream:a topic:b
    //  stream:a
    if (operators.length < 1) {
        return [];
    }

    let i;
    const suggestions = [];

    for (i = operators.length - 1; i >= 1; i -= 1) {
        const subset = operators.slice(0, i);
        suggestions.push(format_as_suggestion(subset));
    }

    return suggestions;
}

function get_special_filter_suggestions(last, operators, suggestions) {
    const is_search_operand_negated = last.operator === "search" && last.operand[0] === "-";
    // Negating suggestions on is_search_operand_negated is required for
    // suggesting negated operators.
    if (last.negated || is_search_operand_negated) {
        suggestions = suggestions.map((suggestion) => ({
            search_string: "-" + suggestion.search_string,
            description_html: "exclude " + suggestion.description_html,
            invalid: suggestion.invalid,
        }));
    }

    const last_string = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse([last]).toLowerCase();
    suggestions = suggestions.filter((s) => {
        if (match_criteria(operators, s.invalid)) {
            return false;
        }
        if (last_string === "") {
            return true;
        }

        // returns the substring after the ":" symbol.
        const suggestion_operand = s.search_string.slice(s.search_string.indexOf(":") + 1);
        // e.g for `att` search query, `has:attachment` should be suggested.
        const show_operator_suggestions =
            last.operator === "search" && suggestion_operand.toLowerCase().startsWith(last_string);
        return (
            s.search_string.toLowerCase().startsWith(last_string) ||
            show_operator_suggestions ||
            s.description_html.toLowerCase().startsWith(last_string)
        );
    });

    // Only show home if there's an empty bar
    if (operators.length === 0 && last_string === "") {
        suggestions.unshift({search_string: "", description_html: "All messages"});
    }
    return suggestions;
}

function get_streams_filter_suggestions(last, operators) {
    const suggestions = [
        {
            search_string: "streams:public",
            description_html: "All public streams in organization",
            invalid: [
                {operator: "is", operand: "private"},
                {operator: "stream"},
                {operator: "group-pm-with"},
                {operator: "pm-with"},
                {operator: "in"},
                {operator: "streams"},
            ],
        },
    ];
    return get_special_filter_suggestions(last, operators, suggestions);
}
function get_is_filter_suggestions(last, operators) {
    const suggestions = [
        {
            search_string: "is:private",
            description_html: "private messages",
            invalid: [
                {operator: "is", operand: "private"},
                {operator: "stream"},
                {operator: "pm-with"},
                {operator: "in"},
            ],
        },
        {
            search_string: "is:starred",
            description_html: "starred messages",
            invalid: [{operator: "is", operand: "starred"}],
        },
        {
            search_string: "is:mentioned",
            description_html: "@-mentions",
            invalid: [{operator: "is", operand: "mentioned"}],
        },
        {
            search_string: "is:alerted",
            description_html: "alerted messages",
            invalid: [{operator: "is", operand: "alerted"}],
        },
        {
            search_string: "is:unread",
            description_html: "unread messages",
            invalid: [{operator: "is", operand: "unread"}],
        },
        {
            search_string: "is:resolved",
            description_html: "topics marked as resolved",
            invalid: [{operator: "is", operand: "resolved"}],
        },
    ];
    return get_special_filter_suggestions(last, operators, suggestions);
}

function get_has_filter_suggestions(last, operators) {
    const suggestions = [
        {
            search_string: "has:link",
            description_html: "messages with one or more link",
            invalid: [{operator: "has", operand: "link"}],
        },
        {
            search_string: "has:image",
            description_html: "messages with one or more image",
            invalid: [{operator: "has", operand: "image"}],
        },
        {
            search_string: "has:attachment",
            description_html: "messages with one or more attachment",
            invalid: [{operator: "has", operand: "attachment"}],
        },
    ];
    return get_special_filter_suggestions(last, operators, suggestions);
}

function get_sent_by_me_suggestions(last, operators) {
    const last_string = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.unparse([last]).toLowerCase();
    const negated = last.negated || (last.operator === "search" && last.operand[0] === "-");
    const negated_symbol = negated ? "-" : "";
    const verb = negated ? "exclude " : "";

    const sender_query = negated_symbol + "sender:" + _people__WEBPACK_IMPORTED_MODULE_5__.my_current_email();
    const from_query = negated_symbol + "from:" + _people__WEBPACK_IMPORTED_MODULE_5__.my_current_email();
    const sender_me_query = negated_symbol + "sender:me";
    const from_me_query = negated_symbol + "from:me";
    const sent_string = negated_symbol + "sent";
    const description_html = verb + "sent by me";

    const invalid = [{operator: "sender"}, {operator: "from"}];

    if (match_criteria(operators, invalid)) {
        return [];
    }

    if (
        last.operator === "" ||
        sender_query.startsWith(last_string) ||
        sender_me_query.startsWith(last_string) ||
        last_string === sent_string
    ) {
        return [
            {
                search_string: sender_query,
                description_html,
            },
        ];
    } else if (from_query.startsWith(last_string) || from_me_query.startsWith(last_string)) {
        return [
            {
                search_string: from_query,
                description_html,
            },
        ];
    }
    return [];
}

function get_operator_suggestions(last) {
    if (!(last.operator === "search")) {
        return [];
    }
    let last_operand = last.operand;

    let negated = false;
    if (last_operand.startsWith("-")) {
        negated = true;
        last_operand = last_operand.slice(1);
    }

    let choices = ["stream", "topic", "pm-with", "sender", "near", "from", "group-pm-with"];
    choices = choices.filter((choice) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_operand, choice));

    return choices.map((choice) => {
        const op = [{operator: choice, operand: "", negated}];
        return format_as_suggestion(op);
    });
}

class Attacher {
    result = [];
    prev = new Set();

    constructor(base) {
        this.base = base;
    }

    prepend_base(suggestion) {
        if (this.base && this.base.description_html.length > 0) {
            suggestion.search_string = this.base.search_string + " " + suggestion.search_string;
            suggestion.description_html =
                this.base.description_html + ", " + suggestion.description_html;
        }
    }

    push(suggestion) {
        if (!this.prev.has(suggestion.search_string)) {
            this.prev.add(suggestion.search_string);
            this.result.push(suggestion);
        }
    }

    concat(suggestions) {
        for (const suggestion of suggestions) {
            this.push(suggestion);
        }
    }

    attach_many(suggestions) {
        for (const suggestion of suggestions) {
            this.prepend_base(suggestion);
            this.push(suggestion);
        }
    }
}

function get_search_result(base_query, query) {
    let suggestion;
    let all_operators;

    // search_operators correspond to the operators for the query in the input.
    // For search_pills_enabled, this includes just editable query where search pills
    // have not been created yet.
    // And for this disabled case, this includes the entire query entered in the searchbox.
    // operators correspond to the operators for the entire query entered in the searchbox.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        all_operators = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.parse((base_query + " " + query).trim());
    }
    const search_operators = _filter__WEBPACK_IMPORTED_MODULE_2__.Filter.parse(query);
    let last = {operator: "", operand: "", negated: false};
    if (search_operators.length > 0) {
        last = search_operators.slice(-1)[0];
    } else if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // We push an empty term so that we can get suggestions
        // on the empty string based on the base query which is
        // calculated from the created search pills.
        // Else search results are returned as if the user is still
        // typing the non-editable last search pill.
        all_operators.push(last);
        search_operators.push(last);
    }

    const person_suggestion_ops = ["sender", "pm-with", "from", "group-pm"];

    // Handle spaces in person name in new suggestions only. Checks if the last operator is 'search'
    // and the second last operator in search_operators is one out of person_suggestion_ops.
    // e.g for `sender:Ted sm`, initially last = {operator: 'search', operand: 'sm'....}
    // and second last is {operator: 'sender', operand: 'sm'....}. If the second last operand
    // is an email of a user, both of these operators remain unchanged. Otherwise search operator
    // will be deleted and new last will become {operator:'sender', operand: 'Ted sm`....}.
    if (
        search_operators.length > 1 &&
        last.operator === "search" &&
        person_suggestion_ops.includes(search_operators.at(-2).operator)
    ) {
        const person_op = search_operators.at(-2);
        if (!_people__WEBPACK_IMPORTED_MODULE_5__.reply_to_to_user_ids_string(person_op.operand)) {
            last = {
                operator: person_op.operator,
                operand: person_op.operand + " " + last.operand,
                negated: person_op.negated,
            };
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                all_operators.splice(-2);
                all_operators.push(last);
            }
            search_operators.splice(-2);
            search_operators.push(last);
        }
    }

    const base = get_default_suggestion(search_operators.slice(0, -1));
    const attacher = new Attacher(base);

    // Display the default first
    // `has` and `is` operators work only on predefined categories. Default suggestion
    // is not displayed in that case. e.g. `messages with one or more abc` as
    // a suggestion for `has:abc`does not make sense.
    if (last.operator !== "" && last.operator !== "has" && last.operator !== "is") {
        suggestion = get_default_suggestion(search_operators);
        attacher.push(suggestion);
    }

    // only make one people_getter to avoid duplicate work
    const people_getter = make_people_getter(last);

    function get_people(flavor) {
        return function (last, base_operators) {
            return get_person_suggestions(people_getter, last, base_operators, flavor);
        };
    }

    // Remember to update the spectator list when changing this.
    let filterers = [
        get_streams_filter_suggestions,
        get_is_filter_suggestions,
        get_sent_by_me_suggestions,
        get_stream_suggestions,
        get_people("sender"),
        get_people("pm-with"),
        get_people("from"),
        get_people("group-pm-with"),
        get_group_suggestions,
        get_topic_suggestions,
        get_operator_suggestions,
        get_has_filter_suggestions,
    ];

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        filterers = [
            get_stream_suggestions,
            get_people("sender"),
            get_people("from"),
            get_topic_suggestions,
            get_operator_suggestions,
            get_has_filter_suggestions,
        ];
    }

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        all_operators = search_operators;
    }
    const base_operators = all_operators.slice(0, -1);
    const max_items = max_num_of_search_results;

    for (const filterer of filterers) {
        if (attacher.result.length < max_items) {
            const suggestions = filterer(last, base_operators);
            attacher.attach_many(suggestions);
        }
    }

    if (
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        // This is unique to the legacy search system.  With pills
        // it is difficult to "suggest" a subset of operators,
        // and there's a more natural mechanism under that paradigm,
        // where the user just deletes one or more pills.  So you
        // won't see this is in the new code.
        attacher.result.length < max_items
    ) {
        const subset_suggestions = get_operator_subset_suggestions(search_operators);
        attacher.concat(subset_suggestions);
    }

    return attacher.result.slice(0, max_items);
}

function get_suggestions(base_query, query) {
    const result = get_search_result(base_query, query);
    return finalize_search_result(result);
}

function finalize_search_result(result) {
    for (const sug of result) {
        const first = sug.description_html.charAt(0).toUpperCase();
        sug.description_html = first + sug.description_html.slice(1);
    }

    // Typeahead expects us to give it strings, not objects,
    // so we maintain our own hash back to our objects
    const lookup_table = new Map();

    for (const obj of result) {
        lookup_table.set(obj.search_string, obj);
    }

    const strings = result.map((obj) => obj.search_string);
    return {
        strings,
        lookup_table,
    };
}


/***/ }),

/***/ "./static/js/sent_messages.js":
/*!************************************!*\
  !*** ./static/js/sent_messages.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MessageState": () => (/* binding */ MessageState),
/* harmony export */   "get_message_state": () => (/* binding */ get_message_state),
/* harmony export */   "get_new_local_id": () => (/* binding */ get_new_local_id),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "mark_disparity": () => (/* binding */ mark_disparity),
/* harmony export */   "messages": () => (/* binding */ messages),
/* harmony export */   "next_local_id": () => (/* binding */ next_local_id),
/* harmony export */   "report_event_received": () => (/* binding */ report_event_received),
/* harmony export */   "report_server_ack": () => (/* binding */ report_server_ack),
/* harmony export */   "reset_id_state": () => (/* binding */ reset_id_state),
/* harmony export */   "start_resend": () => (/* binding */ start_resend),
/* harmony export */   "start_tracking_message": () => (/* binding */ start_tracking_message)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _server_events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./server_events */ "./static/js/server_events.js");




let next_local_id;
const messages = new Map();

function reset_id_state() {
    next_local_id = 0;
}

function get_new_local_id() {
    next_local_id += 1;
    const local_id = next_local_id;
    return "loc-" + local_id.toString();
}

function report_send_time(send_time, receive_time, locally_echoed, rendered_changed) {
    const data = {
        time: send_time.toString(),
        received: receive_time.toString(),
        locally_echoed,
    };

    if (locally_echoed) {
        data.rendered_content_disparity = rendered_changed;
    }

    _channel__WEBPACK_IMPORTED_MODULE_1__.post({
        url: "/json/report/send_times",
        data,
    });
}

class MessageState {
    start = new Date();

    received = undefined;
    send_finished = undefined;
    rendered_content_disparity = false;

    constructor(opts) {
        this.local_id = opts.local_id;
        this.locally_echoed = opts.locally_echoed;
    }

    start_resend() {
        this.start = new Date();
        this.received = undefined;
        this.send_finished = undefined;
        this.rendered_content_disparity = false;
    }

    maybe_restart_event_loop() {
        if (this.received) {
            // We got our event, no need to do anything
            return;
        }

        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            `Restarting get_events due to delayed receipt of sent message ${this.local_id}`,
        );

        _server_events__WEBPACK_IMPORTED_MODULE_2__.restart_get_events();
    }

    maybe_report_send_times() {
        if (!this.ready()) {
            return;
        }
        report_send_time(
            this.send_finished - this.start,
            this.received - this.start,
            this.locally_echoed,
            this.rendered_content_disparity,
        );
    }

    report_event_received() {
        this.received = new Date();
        this.maybe_report_send_times();
    }

    mark_disparity() {
        this.rendered_content_disparity = true;
    }

    report_server_ack() {
        this.send_finished = new Date();
        this.maybe_report_send_times();

        // We only start our timer for events coming in here,
        // since it's plausible the server rejected our message,
        // or took a while to process it, but there is nothing
        // wrong with our event loop.

        if (!this.received) {
            setTimeout(() => this.maybe_restart_event_loop(), 5000);
        }
    }

    ready() {
        return this.send_finished !== undefined && this.received !== undefined;
    }
}

function start_tracking_message(opts) {
    const local_id = opts.local_id;

    if (!opts.local_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("You must supply a local_id");
        return;
    }

    if (messages.has(local_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We are re-using a local_id");
        return;
    }

    const state = new MessageState(opts);

    messages.set(local_id, state);
}

function get_message_state(local_id) {
    const state = messages.get(local_id);

    if (!state) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown local_id: " + local_id);
    }

    return state;
}

function mark_disparity(local_id) {
    const state = get_message_state(local_id);
    if (!state) {
        return;
    }
    state.mark_disparity();
}

function report_event_received(local_id) {
    const state = get_message_state(local_id);
    if (!state) {
        return;
    }

    state.report_event_received();
}

function start_resend(local_id) {
    const state = get_message_state(local_id);
    if (!state) {
        return;
    }

    state.start_resend();
}

function report_server_ack(local_id) {
    const state = get_message_state(local_id);
    if (!state) {
        return;
    }

    state.report_server_ack();
}

function initialize() {
    reset_id_state();
}


/***/ }),

/***/ "./static/js/server_events.js":
/*!************************************!*\
  !*** ./static/js/server_events.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "_get_events_success": () => (/* binding */ _get_events_success),
/* harmony export */   "assert_get_events_running": () => (/* binding */ assert_get_events_running),
/* harmony export */   "cleanup_event_queue": () => (/* binding */ cleanup_event_queue),
/* harmony export */   "force_get_events": () => (/* binding */ force_get_events),
/* harmony export */   "home_view_loaded": () => (/* binding */ home_view_loaded),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "restart_get_events": () => (/* binding */ restart_get_events)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _echo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./echo */ "./static/js/echo.js");
/* harmony import */ var _message_events__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_events */ "./static/js/message_events.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _reload__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./reload */ "./static/js/reload.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _sent_messages__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./sent_messages */ "./static/js/sent_messages.js");
/* harmony import */ var _server_events_dispatch__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./server_events_dispatch */ "./static/js/server_events_dispatch.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















// Docs: https://zulip.readthedocs.io/en/latest/subsystems/events-system.html

let waiting_on_homeview_load = true;

let events_stored_while_loading = [];

let get_events_xhr;
let get_events_timeout;
let get_events_failures = 0;
const get_events_params = {};

function get_events_success(events) {
    let messages = [];
    const update_message_events = [];
    const post_message_events = [];

    const clean_event = function clean_event(event) {
        // Only log a whitelist of the event to remove private data
        return lodash__WEBPACK_IMPORTED_MODULE_1___default().pick(event, "id", "type", "op");
    };

    for (const event of events) {
        try {
            get_events_params.last_event_id = Math.max(get_events_params.last_event_id, event.id);
        } catch (error) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Failed to update last_event_id",
                {event: clean_event(event)},
                error.stack,
            );
        }
    }

    if (waiting_on_homeview_load) {
        events_stored_while_loading = events_stored_while_loading.concat(events);
        return;
    }

    if (events_stored_while_loading.length > 0) {
        events = events_stored_while_loading.concat(events);
        events_stored_while_loading = [];
    }

    // Most events are dispatched via the code server_events_dispatch,
    // called in the default case.  The goal of this split is to avoid
    // contributors needing to read or understand the complex and
    // rarely modified logic for non-normal events.
    const dispatch_event = function dispatch_event(event) {
        switch (event.type) {
            case "message": {
                const msg = event.message;
                msg.flags = event.flags;
                if (event.local_message_id) {
                    msg.local_id = event.local_message_id;
                    _sent_messages__WEBPACK_IMPORTED_MODULE_8__.report_event_received(event.local_message_id);
                }
                messages.push(msg);
                break;
            }

            case "update_message":
                update_message_events.push(event);
                break;

            case "delete_message":
            case "submessage":
            case "update_message_flags":
                post_message_events.push(event);
                break;

            default:
                _server_events_dispatch__WEBPACK_IMPORTED_MODULE_9__.dispatch_normal_event(event);
        }
    };

    for (const event of events) {
        try {
            dispatch_event(event);
        } catch (error) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Failed to process an event\n" + Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error),
                {event: clean_event(event)},
                error.stack,
            );
        }
    }

    if (messages.length !== 0) {
        // Sort by ID, so that if we get multiple messages back from
        // the server out-of-order, we'll still end up with our
        // message lists in order.
        messages = lodash__WEBPACK_IMPORTED_MODULE_1___default().sortBy(messages, "id");
        try {
            messages = _echo__WEBPACK_IMPORTED_MODULE_4__.process_from_server(messages);
            if (messages.length > 0) {
                const sent_by_this_client = messages.some((msg) =>
                    _sent_messages__WEBPACK_IMPORTED_MODULE_8__.messages.has(msg.local_id),
                );
                // If some message in this batch of events was sent by this
                // client, almost every time, this message will be the only one
                // in messages, because multiple messages being returned by
                // get_events usually only happens when a client is offline.
                // But in any case, insert_new_messages handles multiple
                // messages, only one of which was sent by this client,
                // correctly.

                _message_events__WEBPACK_IMPORTED_MODULE_5__.insert_new_messages(messages, sent_by_this_client);
            }
        } catch (error) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Failed to insert new messages\n" + Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error),
                undefined,
                error.stack,
            );
        }
    }

    if (_message_lists__WEBPACK_IMPORTED_MODULE_6__.home.selected_id() === -1 && !_message_lists__WEBPACK_IMPORTED_MODULE_6__.home.empty()) {
        _message_lists__WEBPACK_IMPORTED_MODULE_6__.home.select_id(_message_lists__WEBPACK_IMPORTED_MODULE_6__.home.first().id, {then_scroll: false});
    }

    if (update_message_events.length !== 0) {
        try {
            _message_events__WEBPACK_IMPORTED_MODULE_5__.update_messages(update_message_events);
        } catch (error) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "Failed to update messages\n" + Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error),
                undefined,
                error.stack,
            );
        }
    }

    // We do things like updating message flags and deleting messages last,
    // to avoid ordering issues that are caused by batch handling of
    // messages above.
    for (const event of post_message_events) {
        _server_events_dispatch__WEBPACK_IMPORTED_MODULE_9__.dispatch_normal_event(event);
    }
}

function show_ui_connection_error() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error"));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error").addClass("get-events-error");
}

function hide_ui_connection_error() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error"));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#connection-error").removeClass("get-events-error");
}

function get_events({dont_block = false} = {}) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return;
    }

    // TODO: In the future, we may implement Tornado support for live
    // update for spectator, but until then, there's nothing
    // to do here.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    get_events_params.dont_block = dont_block || get_events_failures > 0;

    if (get_events_params.dont_block) {
        // If we're requesting an immediate re-connect to the server,
        // that means it's fairly likely that this client has been off
        // the Internet and thus may have stale state (which is
        // important for potential presence issues).
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(true);
    }
    if (get_events_params.queue_id === undefined) {
        get_events_params.queue_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        get_events_params.last_event_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    if (get_events_xhr !== undefined) {
        get_events_xhr.abort();
    }
    if (get_events_timeout !== undefined) {
        clearTimeout(get_events_timeout);
    }

    get_events_params.client_gravatar = true;
    get_events_params.slim_presence = true;

    get_events_timeout = undefined;
    get_events_xhr = _channel__WEBPACK_IMPORTED_MODULE_3__.get({
        url: "/json/events",
        data: get_events_params,
        timeout: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) * 1000,
        success(data) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(false);
            try {
                get_events_xhr = undefined;
                get_events_failures = 0;
                hide_ui_connection_error();

                get_events_success(data.events);
            } catch (error) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Failed to handle get_events success\n" + Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error),
                    undefined,
                    error.stack,
                );
            }
            get_events_timeout = setTimeout(get_events, 0);
        },
        error(xhr, error_type) {
            try {
                get_events_xhr = undefined;
                // If we're old enough that our message queue has been
                // garbage collected, immediately reload.
                if (
                    xhr.status === 400 &&
                    JSON.parse(xhr.responseText).code === "BAD_EVENT_QUEUE_ID"
                ) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = true;
                    _reload__WEBPACK_IMPORTED_MODULE_7__.initiate({
                        immediate: true,
                        save_pointer: false,
                        save_narrow: true,
                        save_compose: true,
                    });
                    return;
                }

                if (error_type === "abort") {
                    // Don't restart if we explicitly aborted
                    return;
                } else if (error_type === "timeout") {
                    // Retry indefinitely on timeout.
                    get_events_failures = 0;
                    hide_ui_connection_error();
                } else {
                    get_events_failures += 1;
                }

                if (get_events_failures >= 5) {
                    show_ui_connection_error();
                } else {
                    hide_ui_connection_error();
                }
            } catch (error) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    "Failed to handle get_events error\n" + Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error),
                    undefined,
                    error.stack,
                );
            }
            const retry_sec = Math.min(90, Math.exp(get_events_failures / 2));
            get_events_timeout = setTimeout(get_events, retry_sec * 1000);
        },
    });
}

function assert_get_events_running(error_message) {
    if (get_events_xhr === undefined && get_events_timeout === undefined) {
        restart_get_events({dont_block: true});
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error_message);
    }
}

function restart_get_events(options) {
    get_events(options);
}

function force_get_events() {
    get_events_timeout = setTimeout(get_events, 0);
}

function home_view_loaded() {
    waiting_on_homeview_load = false;
    get_events_success([]);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).trigger("home_view_loaded.zulip");
}

function initialize() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './watchdog'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(() => {
        // Immediately poll for new events on unsuspend
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Restarting get_events due to unsuspend");
        get_events_failures = 0;
        restart_get_events({dont_block: true});
    });
    get_events();
}

function cleanup_event_queue() {
    // Submit a request to the server to clean up our event queue
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === true || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === true) {
        return;
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cleaning up our event queue");
    // Set expired because in a reload we may be called twice.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = true;
    _channel__WEBPACK_IMPORTED_MODULE_3__.del({
        url: "/json/events",
        data: {queue_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())},
        ignore_reload: true,
    });
}

window.addEventListener("beforeunload", () => {
    cleanup_event_queue();
});

// For unit testing
const _get_events_success = get_events_success;


/***/ }),

/***/ "./static/js/server_events_dispatch.js":
/*!*********************************************!*\
  !*** ./static/js/server_events_dispatch.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "dispatch_normal_event": () => (/* binding */ dispatch_normal_event)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
/* harmony import */ var _alert_words__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./alert_words */ "./static/js/alert_words.js");
/* harmony import */ var _alert_words_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./alert_words_ui */ "./static/js/alert_words_ui.js");
/* harmony import */ var _attachments_ui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./attachments_ui */ "./static/js/attachments_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _bot_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./bot_data */ "./static/js/bot_data.js");
/* harmony import */ var _buddy_list__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./buddy_list */ "./static/js/buddy_list.js");
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_fade__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./compose_fade */ "./static/js/compose_fade.js");
/* harmony import */ var _compose_pm_pill__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./compose_pm_pill */ "./static/js/compose_pm_pill.js");
/* harmony import */ var _composebox_typeahead__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./composebox_typeahead */ "./static/js/composebox_typeahead.js");
/* harmony import */ var _dark_theme__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./dark_theme */ "./static/js/dark_theme.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
/* harmony import */ var _emoji_picker__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./emoji_picker */ "./static/js/emoji_picker.js");
/* harmony import */ var _giphy__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./giphy */ "./static/js/giphy.js");
/* harmony import */ var _hotspots__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./hotspots */ "./static/js/hotspots.js");
/* harmony import */ var _linkifiers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./linkifiers */ "./static/js/linkifiers.js");
/* harmony import */ var _message_events__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./message_events */ "./static/js/message_events.js");
/* harmony import */ var _message_flags__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./message_flags */ "./static/js/message_flags.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_live_update__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./message_live_update */ "./static/js/message_live_update.js");
/* harmony import */ var _muted_topics_ui__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./muted_topics_ui */ "./static/js/muted_topics_ui.js");
/* harmony import */ var _muted_users_ui__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./muted_users_ui */ "./static/js/muted_users_ui.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _navbar_alerts__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./navbar_alerts */ "./static/js/navbar_alerts.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _reactions__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./reactions */ "./static/js/reactions.js");
/* harmony import */ var _realm_icon__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./realm_icon */ "./static/js/realm_icon.js");
/* harmony import */ var _realm_logo__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./realm_logo */ "./static/js/realm_logo.js");
/* harmony import */ var _realm_playground__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./realm_playground */ "./static/js/realm_playground.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _reload__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./reload */ "./static/js/reload.js");
/* harmony import */ var _scroll_bar__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./scroll_bar */ "./static/js/scroll_bar.js");
/* harmony import */ var _settings_account__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./settings_account */ "./static/js/settings_account.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_display__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./settings_display */ "./static/js/settings_display.js");
/* harmony import */ var _settings_emoji__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./settings_emoji */ "./static/js/settings_emoji.js");
/* harmony import */ var _settings_exports__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./settings_exports */ "./static/js/settings_exports.js");
/* harmony import */ var _settings_invites__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./settings_invites */ "./static/js/settings_invites.js");
/* harmony import */ var _settings_linkifiers__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./settings_linkifiers */ "./static/js/settings_linkifiers.js");
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_playgrounds__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./settings_playgrounds */ "./static/js/settings_playgrounds.js");
/* harmony import */ var _settings_profile_fields__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./settings_profile_fields */ "./static/js/settings_profile_fields.js");
/* harmony import */ var _settings_realm_domains__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./settings_realm_domains */ "./static/js/settings_realm_domains.js");
/* harmony import */ var _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./settings_realm_user_settings_defaults */ "./static/js/settings_realm_user_settings_defaults.js");
/* harmony import */ var _settings_streams__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./settings_streams */ "./static/js/settings_streams.js");
/* harmony import */ var _settings_user_groups_legacy__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./settings_user_groups_legacy */ "./static/js/settings_user_groups_legacy.js");
/* harmony import */ var _settings_users__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./settings_users */ "./static/js/settings_users.js");
/* harmony import */ var _starred_messages__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./starred_messages */ "./static/js/starred_messages.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_events__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./stream_events */ "./static/js/stream_events.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _submessage__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./submessage */ "./static/js/submessage.js");
/* harmony import */ var _typing_events__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./typing_events */ "./static/js/typing_events.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
/* harmony import */ var _user_events__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./user_events */ "./static/js/user_events.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");









































































function dispatch_normal_event(event) {
    const noop = function () {};
    switch (event.type) {
        case "alert_words":
            _alert_words__WEBPACK_IMPORTED_MODULE_2__.set_words(event.alert_words);
            _alert_words_ui__WEBPACK_IMPORTED_MODULE_3__.rerender_alert_words_ui();
            break;

        case "attachment":
            _attachments_ui__WEBPACK_IMPORTED_MODULE_4__.update_attachments(event);
            break;

        case "custom_profile_fields":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.fields;
            _settings_profile_fields__WEBPACK_IMPORTED_MODULE_48__.populate_profile_fields(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            _settings_account__WEBPACK_IMPORTED_MODULE_38__.add_custom_profile_fields_to_settings();
            break;

        case "default_streams":
            _stream_data__WEBPACK_IMPORTED_MODULE_55__.set_realm_default_streams(event.default_streams);
            _settings_streams__WEBPACK_IMPORTED_MODULE_51__.update_default_streams_table();
            break;

        case "delete_message": {
            const msg_ids = event.message_ids;
            // message is passed to unread.get_unread_messages,
            // which returns all the unread messages out of a given list.
            // So double marking something as read would not occur
            _unread_ops__WEBPACK_IMPORTED_MODULE_62__.process_read_messages_event(msg_ids);
            // This methods updates message_list too and since stream_topic_history relies on it
            // this method should be called first.
            _message_events__WEBPACK_IMPORTED_MODULE_19__.remove_messages(msg_ids);

            if (event.message_type === "stream") {
                _stream_topic_history__WEBPACK_IMPORTED_MODULE_59__.remove_messages({
                    stream_id: event.stream_id,
                    topic_name: event.topic,
                    num_messages: msg_ids.length,
                    max_removed_msg_id: Math.max(...msg_ids),
                });
                _stream_list__WEBPACK_IMPORTED_MODULE_57__.update_streams_sidebar();
            }

            break;
        }

        case "has_zoom_token":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.value;
            if (event.value) {
                for (const callback of _compose__WEBPACK_IMPORTED_MODULE_8__.zoom_token_callbacks.values()) {
                    callback();
                }
                _compose__WEBPACK_IMPORTED_MODULE_8__.zoom_token_callbacks.clear();
            }
            break;

        case "hotspots":
            _hotspots__WEBPACK_IMPORTED_MODULE_17__.load_new(event.hotspots);
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
                ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.hotspots)
                : event.hotspots;
            break;

        case "invites_changed":
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-invites-list").length) {
                _settings_invites__WEBPACK_IMPORTED_MODULE_43__.set_up(false);
            }
            break;

        case "user_topic":
            _muted_topics_ui__WEBPACK_IMPORTED_MODULE_23__.handle_topic_updates(event);
            break;

        case "muted_users":
            _muted_users_ui__WEBPACK_IMPORTED_MODULE_24__.handle_user_updates(event.muted_users);
            break;

        case "presence":
            _activity__WEBPACK_IMPORTED_MODULE_1__.update_presence_info(event.user_id, event.presence, event.server_timestamp);
            break;

        case "restart": {
            const reload_options = {
                save_pointer: true,
                save_narrow: true,
                save_compose: true,
                message_html: "The application has been updated; reloading!",
            };
            if (event.immediate) {
                reload_options.immediate = true;
            }
            _reload__WEBPACK_IMPORTED_MODULE_36__.initiate(reload_options);
            break;
        }

        case "reaction":
            switch (event.op) {
                case "add":
                    _reactions__WEBPACK_IMPORTED_MODULE_32__.add_reaction(event);
                    break;
                case "remove":
                    _reactions__WEBPACK_IMPORTED_MODULE_32__.remove_reaction(event);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type reaction/" + event.op);
                    break;
            }
            break;

        case "realm": {
            const realm_settings = {
                add_custom_emoji_policy: _settings_emoji__WEBPACK_IMPORTED_MODULE_41__.update_custom_emoji_ui,
                allow_edit_history: noop,
                allow_message_editing: noop,
                edit_topic_policy: noop,
                user_group_edit_policy: noop,
                avatar_changes_disabled: _settings_account__WEBPACK_IMPORTED_MODULE_38__.update_avatar_change_display,
                bot_creation_policy: _settings_bots__WEBPACK_IMPORTED_MODULE_39__.update_bot_permissions_ui,
                create_public_stream_policy: noop,
                create_private_stream_policy: noop,
                create_web_public_stream_policy: noop,
                invite_to_stream_policy: noop,
                default_code_block_language: noop,
                default_language: noop,
                delete_own_message_policy: noop,
                description: noop,
                digest_emails_enabled: noop,
                digest_weekday: noop,
                email_address_visibility: noop,
                email_changes_disabled: _settings_account__WEBPACK_IMPORTED_MODULE_38__.update_email_change_display,
                disallow_disposable_email_addresses: noop,
                inline_image_preview: noop,
                inline_url_embed_preview: noop,
                invite_to_realm_policy: noop,
                invite_required: noop,
                mandatory_topics: noop,
                message_content_edit_limit_seconds: noop,
                message_content_delete_limit_seconds: noop,
                message_retention_days: noop,
                name: _notifications__WEBPACK_IMPORTED_MODULE_27__.redraw_title,
                name_changes_disabled: _settings_account__WEBPACK_IMPORTED_MODULE_38__.update_name_change_display,
                notifications_stream_id: noop,
                org_type: noop,
                private_message_policy: noop,
                send_welcome_emails: noop,
                message_content_allowed_in_email_notifications: noop,
                enable_spectator_access: noop,
                signup_notifications_stream_id: noop,
                emails_restricted_to_domains: noop,
                video_chat_provider: _compose__WEBPACK_IMPORTED_MODULE_8__.update_video_chat_button_display,
                giphy_rating: _giphy__WEBPACK_IMPORTED_MODULE_16__.update_giphy_rating,
                waiting_period_threshold: noop,
                want_advertise_in_communities_directory: noop,
                wildcard_mention_policy: noop,
                enable_read_receipts: _settings_account__WEBPACK_IMPORTED_MODULE_38__.update_send_read_receipts_tooltip,
            };
            switch (event.op) {
                case "update":
                    if (Object.hasOwn(realm_settings, event.property)) {
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())["realm_" + event.property] = event.value;
                        realm_settings[event.property]();
                        _settings_org__WEBPACK_IMPORTED_MODULE_46__.sync_realm_settings(event.property);

                        if (event.property === "name" && window.electron_bridge !== undefined) {
                            window.electron_bridge.send_event("realm_name", event.value);
                        }

                        const stream_creation_settings = [
                            "create_private_stream_policy",
                            "create_public_stream_policy",
                            "create_web_public_stream_policy",
                        ];
                        if (stream_creation_settings.includes(event.property)) {
                            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.update_stream_privacy_choices(event.property);
                        }

                        if (event.property === "enable_spectator_access") {
                            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.update_stream_privacy_choices(
                                "create_web_public_stream_policy",
                            );
                        }
                    }
                    break;
                case "update_dict":
                    switch (event.property) {
                        case "default":
                            for (const [key, value] of Object.entries(event.data)) {
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())["realm_" + key] = value;
                                if (Object.hasOwn(realm_settings, key)) {
                                    _settings_org__WEBPACK_IMPORTED_MODULE_46__.sync_realm_settings(key);
                                }
                            }
                            if (event.data.authentication_methods !== undefined) {
                                _settings_org__WEBPACK_IMPORTED_MODULE_46__.populate_auth_methods(
                                    event.data.authentication_methods,
                                );
                            }
                            break;
                        case "icon":
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.icon_url;
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.icon_source;
                            _realm_icon__WEBPACK_IMPORTED_MODULE_33__.rerender();
                            {
                                const electron_bridge = window.electron_bridge;
                                if (electron_bridge !== undefined) {
                                    electron_bridge.send_event(
                                        "realm_icon_url",
                                        event.data.icon_url,
                                    );
                                }
                            }
                            break;
                        case "logo":
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.logo_url;
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.logo_source;
                            _realm_logo__WEBPACK_IMPORTED_MODULE_34__.render();
                            break;
                        case "night_logo":
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.night_logo_url;
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.data.night_logo_source;
                            _realm_logo__WEBPACK_IMPORTED_MODULE_34__.render();
                            break;
                        default:
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                                "Unexpected event type realm/update_dict/" + event.property,
                            );
                            break;
                    }
                    break;
                case "deactivated":
                    // This handler is likely unnecessary, in that if we
                    // did nothing here, we'd reload and end up at the
                    // same place when we attempt the next `GET /events`
                    // and get an error.  Some clients will do that even
                    // with this code, if they didn't have an active
                    // longpoll waiting at the moment the realm was
                    // deactivated.
                    window.location.href = "/accounts/deactivated/";
                    break;
            }
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // Update the UI notice about the user's profile being
                // incomplete, as we might have filled in the missing field(s).
                _navbar_alerts__WEBPACK_IMPORTED_MODULE_26__.show_profile_incomplete(_navbar_alerts__WEBPACK_IMPORTED_MODULE_26__.check_profile_incomplete());
            }
            break;
        }

        case "realm_bot":
            switch (event.op) {
                case "add":
                    _bot_data__WEBPACK_IMPORTED_MODULE_6__.add(event.bot);
                    _settings_bots__WEBPACK_IMPORTED_MODULE_39__.render_bots();
                    _settings_users__WEBPACK_IMPORTED_MODULE_53__.redraw_bots_list();
                    break;
                case "remove":
                    _bot_data__WEBPACK_IMPORTED_MODULE_6__.deactivate(event.bot.user_id);
                    event.bot.is_active = false;
                    _settings_bots__WEBPACK_IMPORTED_MODULE_39__.render_bots();
                    _settings_users__WEBPACK_IMPORTED_MODULE_53__.update_bot_data(event.bot.user_id);
                    break;
                case "delete":
                    _bot_data__WEBPACK_IMPORTED_MODULE_6__.del(event.bot.user_id);
                    _settings_bots__WEBPACK_IMPORTED_MODULE_39__.render_bots();
                    _settings_users__WEBPACK_IMPORTED_MODULE_53__.redraw_bots_list();
                    break;
                case "update":
                    _bot_data__WEBPACK_IMPORTED_MODULE_6__.update(event.bot.user_id, event.bot);
                    _settings_bots__WEBPACK_IMPORTED_MODULE_39__.render_bots();
                    _settings_users__WEBPACK_IMPORTED_MODULE_53__.update_bot_data(event.bot.user_id);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type realm_bot/" + event.op);
                    break;
            }
            break;
        case "realm_emoji":
            // The authoritative data source is here.
            _emoji__WEBPACK_IMPORTED_MODULE_14__.update_emojis(event.realm_emoji);

            // And then let other widgets know.
            _settings_emoji__WEBPACK_IMPORTED_MODULE_41__.populate_emoji();
            _emoji_picker__WEBPACK_IMPORTED_MODULE_15__.rebuild_catalog();
            _composebox_typeahead__WEBPACK_IMPORTED_MODULE_12__.update_emoji_data();
            break;

        case "realm_linkifiers":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.realm_linkifiers;
            _linkifiers__WEBPACK_IMPORTED_MODULE_18__.update_linkifier_rules(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            _settings_linkifiers__WEBPACK_IMPORTED_MODULE_44__.populate_linkifiers(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            break;

        case "realm_playgrounds":
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.realm_playgrounds;
            _realm_playground__WEBPACK_IMPORTED_MODULE_35__.update_playgrounds(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            _settings_playgrounds__WEBPACK_IMPORTED_MODULE_47__.populate_playgrounds(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            break;

        case "realm_domains":
            {
                let i;
                switch (event.op) {
                    case "add":
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.realm_domain);
                        _settings_org__WEBPACK_IMPORTED_MODULE_46__.populate_realm_domains_label(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
                        _settings_realm_domains__WEBPACK_IMPORTED_MODULE_49__.populate_realm_domains_table(
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                        );
                        break;
                    case "change":
                        for (i = 0; i < Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()); i += 1) {
                            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[i].domain === event.realm_domain.domain) {
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[i].allow_subdomains =
                                    event.realm_domain.allow_subdomains;
                                break;
                            }
                        }
                        _settings_org__WEBPACK_IMPORTED_MODULE_46__.populate_realm_domains_label(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
                        _settings_realm_domains__WEBPACK_IMPORTED_MODULE_49__.populate_realm_domains_table(
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                        );
                        break;
                    case "remove":
                        for (i = 0; i < Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()); i += 1) {
                            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[i].domain === event.domain) {
                                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(i, 1);
                                break;
                            }
                        }
                        _settings_org__WEBPACK_IMPORTED_MODULE_46__.populate_realm_domains_label(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
                        _settings_realm_domains__WEBPACK_IMPORTED_MODULE_49__.populate_realm_domains_table(
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                        );
                        break;
                    default:
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type realm_domains/" + event.op);
                        break;
                }
            }
            break;

        case "realm_user_settings_defaults": {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[event.property] = event.value;
            _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_50__.update_page(event.property);

            if (event.property === "notification_sound") {
                _notifications__WEBPACK_IMPORTED_MODULE_27__.update_notification_sound_source(
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-default-notification-sound-audio"),
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                );
            }
            break;
        }

        case "realm_user":
            switch (event.op) {
                case "add":
                    _people__WEBPACK_IMPORTED_MODULE_30__.add_active_user(event.person);
                    break;
                case "remove":
                    _people__WEBPACK_IMPORTED_MODULE_30__.deactivate(event.person);
                    _stream_events__WEBPACK_IMPORTED_MODULE_56__.remove_deactivated_user_from_all_streams(event.person.user_id);
                    _settings_users__WEBPACK_IMPORTED_MODULE_53__.update_view_on_deactivate(event.person.user_id);
                    _buddy_list__WEBPACK_IMPORTED_MODULE_7__.buddy_list.maybe_remove_key({key: event.person.user_id});
                    break;
                case "update":
                    _user_events__WEBPACK_IMPORTED_MODULE_63__.update_person(event.person);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type realm_user/" + event.op);
                    break;
            }
            break;

        case "stream":
            switch (event.op) {
                case "update":
                    _stream_events__WEBPACK_IMPORTED_MODULE_56__.update_property(event.stream_id, event.property, event.value, {
                        rendered_description: event.rendered_description,
                        history_public_to_subscribers: event.history_public_to_subscribers,
                        is_web_public: event.is_web_public,
                    });
                    _settings_streams__WEBPACK_IMPORTED_MODULE_51__.update_default_streams_table();
                    _stream_list__WEBPACK_IMPORTED_MODULE_57__.update_subscribe_to_more_streams_link();
                    break;
                case "create":
                    _stream_data__WEBPACK_IMPORTED_MODULE_55__.create_streams(event.streams);

                    for (const stream of event.streams) {
                        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream.stream_id);
                        if (_overlays__WEBPACK_IMPORTED_MODULE_28__.streams_open()) {
                            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.add_sub_to_table(sub);
                        }
                    }
                    _stream_list__WEBPACK_IMPORTED_MODULE_57__.update_subscribe_to_more_streams_link();
                    break;
                case "delete":
                    for (const stream of event.streams) {
                        const was_subscribed = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream.stream_id).subscribed;
                        const is_narrowed_to_stream = _narrow_state__WEBPACK_IMPORTED_MODULE_25__.is_for_stream_id(
                            stream.stream_id,
                        );
                        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.remove_stream(stream.stream_id);
                        _stream_data__WEBPACK_IMPORTED_MODULE_55__.delete_sub(stream.stream_id);
                        if (was_subscribed) {
                            _stream_list__WEBPACK_IMPORTED_MODULE_57__.remove_sidebar_row(stream.stream_id);
                        }
                        _settings_streams__WEBPACK_IMPORTED_MODULE_51__.update_default_streams_table();
                        _stream_data__WEBPACK_IMPORTED_MODULE_55__.remove_default_stream(stream.stream_id);
                        if (is_narrowed_to_stream) {
                            _message_lists__WEBPACK_IMPORTED_MODULE_21__.current.update_trailing_bookend();
                        }
                        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === stream.stream_id) {
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = -1;
                            _settings_org__WEBPACK_IMPORTED_MODULE_46__.sync_realm_settings("notifications_stream_id");
                        }
                        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === stream.stream_id) {
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = -1;
                            _settings_org__WEBPACK_IMPORTED_MODULE_46__.sync_realm_settings("signup_notifications_stream_id");
                        }
                    }
                    _stream_list__WEBPACK_IMPORTED_MODULE_57__.update_subscribe_to_more_streams_link();
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type stream/" + event.op);
                    break;
            }
            break;

        case "submessage": {
            // The fields in the event don't quite exactly
            // match the layout of a submessage, since there's
            // an event id.  We also want to be explicit here.
            const submsg = {
                id: event.submessage_id,
                sender_id: event.sender_id,
                msg_type: event.msg_type,
                message_id: event.message_id,
                content: event.content,
            };
            _submessage__WEBPACK_IMPORTED_MODULE_60__.handle_event(submsg);
            break;
        }

        case "subscription":
            switch (event.op) {
                case "add":
                    for (const rec of event.subscriptions) {
                        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(rec.stream_id);
                        if (sub) {
                            _stream_data__WEBPACK_IMPORTED_MODULE_55__.update_stream_email_address(sub, rec.email_address);
                            _stream_events__WEBPACK_IMPORTED_MODULE_56__.mark_subscribed(sub, rec.subscribers, rec.color);
                        } else {
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                                "Subscribing to unknown stream with ID " + rec.stream_id,
                            );
                        }
                    }
                    break;
                case "peer_add": {
                    const stream_ids = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.stream_ids);
                    const user_ids = _people__WEBPACK_IMPORTED_MODULE_30__.validate_user_ids(event.user_ids);

                    _peer_data__WEBPACK_IMPORTED_MODULE_29__.bulk_add_subscribers({stream_ids, user_ids});

                    for (const stream_id of stream_ids) {
                        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
                        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.update_subscribers_ui(sub);
                    }

                    _compose_fade__WEBPACK_IMPORTED_MODULE_10__.update_faded_users();
                    break;
                }
                case "peer_remove": {
                    const stream_ids = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.stream_ids);
                    const user_ids = _people__WEBPACK_IMPORTED_MODULE_30__.validate_user_ids(event.user_ids);

                    _peer_data__WEBPACK_IMPORTED_MODULE_29__.bulk_remove_subscribers({stream_ids, user_ids});

                    for (const stream_id of stream_ids) {
                        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
                        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_58__.update_subscribers_ui(sub);
                    }

                    _compose_fade__WEBPACK_IMPORTED_MODULE_10__.update_faded_users();
                    break;
                }
                case "remove":
                    for (const rec of event.subscriptions) {
                        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(rec.stream_id);
                        _stream_events__WEBPACK_IMPORTED_MODULE_56__.mark_unsubscribed(sub);
                    }
                    break;
                case "update":
                    _stream_events__WEBPACK_IMPORTED_MODULE_56__.update_property(event.stream_id, event.property, event.value);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type subscription/" + event.op);
                    break;
            }
            break;
        case "typing":
            if (event.sender.user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // typing notifications are sent to the user who is typing
                // as well as recipients; we ignore such self-generated events.
                return;
            }
            switch (event.op) {
                case "start":
                    _typing_events__WEBPACK_IMPORTED_MODULE_61__.display_notification(event);
                    break;
                case "stop":
                    _typing_events__WEBPACK_IMPORTED_MODULE_61__.hide_notification(event);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type typing/" + event.op);
                    break;
            }
            break;

        case "user_settings": {
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.property)) {
                _notifications__WEBPACK_IMPORTED_MODULE_27__.handle_global_notification_updates(event.property, event.value);
                _settings_notifications__WEBPACK_IMPORTED_MODULE_45__.update_page(_settings_notifications__WEBPACK_IMPORTED_MODULE_45__.user_settings_panel);
                // TODO: This should also do a refresh of the stream_edit UI
                // if it's currently displayed, possibly reusing some code
                // from stream_events.js
                // (E.g. update_stream_push_notifications).
                break;
            }

            const user_display_settings = [
                "color_scheme",
                "default_language",
                "default_view",
                "demote_inactive_streams",
                "dense_mode",
                "emojiset",
                "escape_navigates_to_default_view",
                "fluid_layout_width",
                "high_contrast_mode",
                "timezone",
                "twenty_four_hour_time",
                "translate_emoticons",
                "display_emoji_reaction_users",
                "user_list_style",
                "starred_message_counts",
                "send_stream_typing_notifications",
                "send_private_typing_notifications",
                "send_read_receipts",
            ];

            if (user_display_settings.includes(event.property)) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[event.property] = event.value;
            }
            if (event.property === "default_language") {
                // We additionally need to set the language name.
                //
                // Note that this does not change translations at all;
                // a reload is fundamentally required because we
                // cannot rerender with the new language the strings
                // present in the backend/Jinja2 templates.
                _settings_display__WEBPACK_IMPORTED_MODULE_40__.set_default_language_name(event.language_name);
            }
            if (event.property === "twenty_four_hour_time") {
                // Rerender the whole message list UI
                for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_21__.all_rendered_message_lists()) {
                    msg_list.rerender();
                }
            }
            if (event.property === "high_contrast_mode") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").toggleClass("high-contrast");
            }
            if (event.property === "demote_inactive_streams") {
                _stream_list__WEBPACK_IMPORTED_MODULE_57__.update_streams_sidebar();
                _stream_data__WEBPACK_IMPORTED_MODULE_55__.set_filter_out_inactives();
            }
            if (event.property === "user_list_style") {
                _settings_display__WEBPACK_IMPORTED_MODULE_40__.report_user_list_style_change(
                    _settings_display__WEBPACK_IMPORTED_MODULE_40__.user_settings_panel,
                );
                _activity__WEBPACK_IMPORTED_MODULE_1__.build_user_sidebar();
            }
            if (event.property === "dense_mode") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").toggleClass("less_dense_mode");
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").toggleClass("more_dense_mode");
            }
            if (event.property === "color_scheme") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").fadeOut(300);
                setTimeout(() => {
                    if (event.value === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                        _dark_theme__WEBPACK_IMPORTED_MODULE_13__.enable();
                        _realm_logo__WEBPACK_IMPORTED_MODULE_34__.render();
                    } else if (event.value === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                        _dark_theme__WEBPACK_IMPORTED_MODULE_13__.disable();
                        _realm_logo__WEBPACK_IMPORTED_MODULE_34__.render();
                    } else {
                        _dark_theme__WEBPACK_IMPORTED_MODULE_13__.default_preference_checker();
                        _realm_logo__WEBPACK_IMPORTED_MODULE_34__.render();
                    }
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").fadeIn(300);
                }, 300);
            }
            if (event.property === "starred_message_counts") {
                _starred_messages__WEBPACK_IMPORTED_MODULE_54__.rerender_ui();
            }
            if (event.property === "fluid_layout_width") {
                _scroll_bar__WEBPACK_IMPORTED_MODULE_37__.set_layout_width();
            }
            if (event.property === "default_language") {
                // TODO: Make this change the view immediately rather than
                // requiring a reload.  This is likely fairly difficult,
                // because various i18n strings are rendered by the
                // server; we may want to instead just trigger a page
                // reload.
            }
            if (event.property === "emojiset") {
                _settings_display__WEBPACK_IMPORTED_MODULE_40__.report_emojiset_change(_settings_display__WEBPACK_IMPORTED_MODULE_40__.user_settings_panel);

                // Rerender the whole message list UI
                for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_21__.all_rendered_message_lists()) {
                    msg_list.rerender();
                }
                // Rerender buddy list status emoji
                _activity__WEBPACK_IMPORTED_MODULE_1__.build_user_sidebar();
            }

            if (event.property === "display_emoji_reaction_users") {
                _message_live_update__WEBPACK_IMPORTED_MODULE_22__.rerender_messages_view();
            }
            if (event.property === "escape_navigates_to_default_view") {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#go-to-default-view-hotkey-help").toggleClass("notdisplayed", !event.value);
            }
            if (event.property === "enter_sends") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.value;
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.enter_sends_${!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).hide();
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.enter_sends_${Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`).show();
                break;
            }
            if (event.property === "presence_enabled") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = event.value;
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_presence_enabled").prop("checked", Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
                _activity__WEBPACK_IMPORTED_MODULE_1__.redraw_user(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
                break;
            }
            _settings_display__WEBPACK_IMPORTED_MODULE_40__.update_page(event.property);
            break;
        }

        case "update_message_flags": {
            const new_value = event.op === "add";
            switch (event.flag) {
                case "starred":
                    for (const message_id of event.messages) {
                        _message_flags__WEBPACK_IMPORTED_MODULE_20__.update_starred_flag(message_id, new_value);
                    }

                    if (event.op === "add") {
                        _starred_messages__WEBPACK_IMPORTED_MODULE_54__.add(event.messages);
                    } else {
                        _starred_messages__WEBPACK_IMPORTED_MODULE_54__.remove(event.messages);
                    }
                    break;
                case "read":
                    if (event.op === "add") {
                        _unread_ops__WEBPACK_IMPORTED_MODULE_62__.process_read_messages_event(event.messages);
                    } else {
                        _unread_ops__WEBPACK_IMPORTED_MODULE_62__.process_unread_messages_event({
                            message_ids: event.messages,
                            message_details: event.message_details,
                        });
                    }
                    break;
            }
            break;
        }

        case "user_group":
            switch (event.op) {
                case "add":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group);
                    break;
                case "remove":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group_id));
                    break;
                case "add_members":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group_id, event.user_ids);
                    break;
                case "remove_members":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group_id, event.user_ids);
                    break;
                case "add_subgroups":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group_id, event.direct_subgroup_ids);
                    break;
                case "remove_subgroups":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event.group_id, event.direct_subgroup_ids);
                    break;
                case "update":
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event);
                    break;
                default:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected event type user_group/" + event.op);
                    break;
            }
            _settings_user_groups_legacy__WEBPACK_IMPORTED_MODULE_52__.reload();
            break;

        case "user_status":
            if (event.status_text !== undefined) {
                _user_status__WEBPACK_IMPORTED_MODULE_64__.set_status_text({
                    user_id: event.user_id,
                    status_text: event.status_text,
                });
                _activity__WEBPACK_IMPORTED_MODULE_1__.redraw_user(event.user_id);

                // Update the status text in compose box placeholder when opened to self.
                if (_compose_pm_pill__WEBPACK_IMPORTED_MODULE_11__.get_user_ids().includes(event.user_id)) {
                    _compose_actions__WEBPACK_IMPORTED_MODULE_9__.update_placeholder_text();
                }
            }

            if (event.emoji_name !== undefined) {
                _user_status__WEBPACK_IMPORTED_MODULE_64__.set_status_emoji(event);
                _activity__WEBPACK_IMPORTED_MODULE_1__.redraw_user(event.user_id);
                _pm_list__WEBPACK_IMPORTED_MODULE_31__.update_private_messages();
                _message_live_update__WEBPACK_IMPORTED_MODULE_22__.update_user_status_emoji(
                    event.user_id,
                    _user_status__WEBPACK_IMPORTED_MODULE_64__.get_status_emoji(event.user_id),
                );
            }
            break;
        case "realm_export":
            _settings_exports__WEBPACK_IMPORTED_MODULE_42__.populate_exports_table(event.exports);
            break;
    }
}


/***/ }),

/***/ "./static/js/settings.js":
/*!*******************************!*\
  !*** ./static/js/settings.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch": () => (/* binding */ launch),
/* harmony export */   "set_settings_header": () => (/* binding */ set_settings_header),
/* harmony export */   "settings_label": () => (/* binding */ settings_label)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/parseISO/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings_overlay.hbs */ "./static/templates/settings_overlay.hbs");
/* harmony import */ var _templates_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_tab_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings_tab.hbs */ "./static/templates/settings_tab.hbs");
/* harmony import */ var _templates_settings_tab_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_tab_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _admin__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./admin */ "./static/js/admin.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_display__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./settings_display */ "./static/js/settings_display.js");
/* harmony import */ var _settings_panel_menu__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_panel_menu */ "./static/js/settings_panel_menu.js");
/* harmony import */ var _settings_sections__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_sections */ "./static/js/settings_sections.js");
/* harmony import */ var _settings_toggle__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./settings_toggle */ "./static/js/settings_toggle.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



// import timezones from "../generated/timezones.json";


















let settings_label;

jquery__WEBPACK_IMPORTED_MODULE_0___default()(() => {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container").on("click", (e) => {
        if (!_overlays__WEBPACK_IMPORTED_MODULE_5__.is_modal_open()) {
            return;
        }
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".micromodal").length > 0) {
            return;
        }
        e.preventDefault();
        e.stopPropagation();
        // Whenever opening a modal(over settings overlay) in an event handler
        // attached to a click event, make sure to stop the propagation of the
        // event to the parent container otherwise the modal will not open. This
        // is so because this event handler will get fired on any click in settings
        // overlay and subsequently close any open modal.
        _overlays__WEBPACK_IMPORTED_MODULE_5__.close_active_modal();
    });
});

function setup_settings_label() {
    settings_label = {
        // settings_notification
        presence_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Display my availability to other users",
        }),
        presence_enabled_parens_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "invisible mode off"}),
        send_stream_typing_notifications: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Let subscribers see when I'm typing messages in streams",
        }),
        send_private_typing_notifications: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Let recipients see when I'm typing private messages",
        }),
        send_read_receipts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Let others see when I've read messages",
        }),

        ...Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        ...Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    };
}

function get_parsed_date_of_joining() {
    const user_date_joined = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()), false).date_joined;
    const dateFormat = new Intl.DateTimeFormat("default", {dateStyle: "long"});
    return dateFormat.format((0,date_fns__WEBPACK_IMPORTED_MODULE_12__["default"])(user_date_joined));
}

function build_page() {
    setup_settings_label();

    const rendered_settings_tab = _templates_settings_tab_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        full_name: _people__WEBPACK_IMPORTED_MODULE_6__.my_full_name(),
        date_joined_text: get_parsed_date_of_joining(),
        page_params: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        enable_sound_select:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        zuliprc: "zuliprc",
        botserverrc: "botserverrc",
        // timezones: timezones.timezones,
        can_create_new_bots: _settings_bots__WEBPACK_IMPORTED_MODULE_7__.can_create_new_bots(),
        settings_label,
        demote_inactive_streams_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        user_list_style_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        color_scheme_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        default_view_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        twenty_four_hour_time_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        general_settings: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).general_settings,
        notification_settings: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).settings,
        email_notifications_batching_period_values:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        desktop_icon_count_display_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_push_notifications_tooltip:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).show_push_notifications_tooltip,
        display_settings: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        user_can_change_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        user_can_change_avatar: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        user_role_text: _people__WEBPACK_IMPORTED_MODULE_6__.get_user_type(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())),
        default_language_name: _settings_display__WEBPACK_IMPORTED_MODULE_8__.user_default_language_name,
        realm_push_notifications_enabled: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        settings_object: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        send_read_receipts_tooltip: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Read receipts are currently disabled in this organization.",
        }),
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-box").html(rendered_settings_tab);
}

function launch(section) {
    build_page();
    _admin__WEBPACK_IMPORTED_MODULE_3__.build_page();
    _settings_sections__WEBPACK_IMPORTED_MODULE_10__.reset_sections();

    _overlays__WEBPACK_IMPORTED_MODULE_5__.open_settings();
    _settings_panel_menu__WEBPACK_IMPORTED_MODULE_9__.normal_settings.activate_section_or_default(section);
    _settings_toggle__WEBPACK_IMPORTED_MODULE_11__.highlight_toggle("settings");
}

function set_settings_header(key) {
    const selected_tab_key = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_page .tab-switcher .selected").data("tab-key");
    let header_prefix = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Personal settings"});
    if (selected_tab_key === "organization") {
        header_prefix = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Organization settings"});
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-header h1 .header-prefix").text(header_prefix);

    const header_text = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#settings_page .sidebar-list [data-section='${CSS.escape(key)}'] .text`,
    ).text();
    if (header_text) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-header h1 .section").text(" / " + header_text);
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "Error: the key '" +
                key +
                "' does not exist in the settings" +
                " sidebar list. Please add it.",
        );
    }
}

function initialize() {
    const rendered_settings_overlay = _templates_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_guest: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_uploaded_files_section: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) > 0,
        show_emoji_settings_lock:
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container").append(rendered_settings_overlay);
}


/***/ }),

/***/ "./static/js/settings_account.js":
/*!***************************************!*\
  !*** ./static/js/settings_account.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_custom_profile_fields_to_settings": () => (/* binding */ add_custom_profile_fields_to_settings),
/* harmony export */   "append_custom_profile_fields": () => (/* binding */ append_custom_profile_fields),
/* harmony export */   "hide_confirm_email_banner": () => (/* binding */ hide_confirm_email_banner),
/* harmony export */   "initialize_custom_date_type_fields": () => (/* binding */ initialize_custom_date_type_fields),
/* harmony export */   "initialize_custom_pronouns_type_fields": () => (/* binding */ initialize_custom_pronouns_type_fields),
/* harmony export */   "initialize_custom_user_type_fields": () => (/* binding */ initialize_custom_user_type_fields),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_avatar_change_display": () => (/* binding */ update_avatar_change_display),
/* harmony export */   "update_email": () => (/* binding */ update_email),
/* harmony export */   "update_email_change_display": () => (/* binding */ update_email_change_display),
/* harmony export */   "update_full_name": () => (/* binding */ update_full_name),
/* harmony export */   "update_name_change_display": () => (/* binding */ update_name_change_display),
/* harmony export */   "update_send_read_receipts_tooltip": () => (/* binding */ update_send_read_receipts_tooltip)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_change_email_modal_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/change_email_modal.hbs */ "./static/templates/change_email_modal.hbs");
/* harmony import */ var _templates_change_email_modal_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_change_email_modal_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_own_user_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_own_user.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_own_user.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_own_user_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_own_user_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_dialog_change_password_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/dialog_change_password.hbs */ "./static/templates/dialog_change_password.hbs");
/* harmony import */ var _templates_dialog_change_password_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_dialog_change_password_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_api_key_modal_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/api_key_modal.hbs */ "./static/templates/settings/api_key_modal.hbs");
/* harmony import */ var _templates_settings_api_key_modal_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_api_key_modal_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_settings_custom_user_profile_field_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/settings/custom_user_profile_field.hbs */ "./static/templates/settings/custom_user_profile_field.hbs");
/* harmony import */ var _templates_settings_custom_user_profile_field_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_custom_user_profile_field_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/settings/dev_env_email_access.hbs */ "./static/templates/settings/dev_env_email_access.hbs");
/* harmony import */ var _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _avatar__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./avatar */ "./static/js/avatar.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pill_typeahead__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./pill_typeahead */ "./static/js/pill_typeahead.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");
/* harmony import */ var _user_profile__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./user_profile */ "./static/js/user_profile.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());































let password_quality; // Loaded asynchronously

function update_email(new_email) {
    const $email_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email");

    if ($email_input) {
        $email_input.text(new_email);
    }
}

function update_full_name(new_full_name) {
    // Arguably, this should work more like how the `update_email`
    // flow works, where we update the name in the modal on open,
    // rather than updating it here, but this works.
    const $full_name_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".full-name-change-container input[name='full_name']");
    if ($full_name_input) {
        $full_name_input.val(new_full_name);
    }
}

function update_name_change_display() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#full_name").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".change_name_tooltip").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#full_name").prop("disabled", false);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".change_name_tooltip").hide();
    }
}

function update_email_change_display() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".change_email_tooltip").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email").prop("disabled", false);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".change_email_tooltip").hide();
    }
}

function update_avatar_change_display() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        // We disable this widget by simply hiding its edit UI.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_upload_button").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-avatar-section .settings-info-icon").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_upload_button").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-avatar-section .settings-info-icon").hide();
    }
}

function update_send_read_receipts_tooltip() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#send_read_receipts_label .settings-info-icon").hide();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#send_read_receipts_label .settings-info-icon").show();
    }
}

function display_avatar_upload_complete() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .upload-spinner-background").css({visibility: "hidden"});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-upload-text").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").show();
}

function display_avatar_upload_started() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .upload-spinner-background").css({visibility: "visible"});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-upload-text").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-delete-button").hide();
}

function settings_change_error(message_html, xhr) {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(message_html, xhr, jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status").expectOne());
}

function update_custom_profile_field(field, method) {
    let field_id;
    if (method === _channel__WEBPACK_IMPORTED_MODULE_9__.del) {
        field_id = field;
    } else {
        field_id = field.id;
    }

    const $spinner_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `.custom_user_field[data-field-id="${CSS.escape(field_id)}"] .custom-field-status`,
    ).expectOne();
    _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
        method,
        "/json/users/me/profile_data",
        {data: JSON.stringify([field])},
        $spinner_element,
    );
}

function update_user_custom_profile_fields(fields, method) {
    if (method === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined method in update_user_custom_profile_fields");
    }

    for (const field of fields) {
        update_custom_profile_field(field, method);
    }
}

function append_custom_profile_fields(element_id, user_id) {
    const person = _people__WEBPACK_IMPORTED_MODULE_13__.get_by_user_id(user_id);
    if (person.is_bot) {
        return;
    }
    const all_custom_fields = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const all_field_types = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    const all_field_template_types = new Map([
        [all_field_types.LONG_TEXT.id, "text"],
        [all_field_types.SHORT_TEXT.id, "text"],
        [all_field_types.SELECT.id, "select"],
        [all_field_types.USER.id, "user"],
        [all_field_types.DATE.id, "date"],
        [all_field_types.EXTERNAL_ACCOUNT.id, "text"],
        [all_field_types.URL.id, "url"],
        [all_field_types.PRONOUNS.id, "text"],
    ]);

    for (const field of all_custom_fields) {
        let field_value = _people__WEBPACK_IMPORTED_MODULE_13__.get_custom_profile_data(user_id, field.id);
        const is_select_field = field.type === all_field_types.SELECT.id;
        const field_choices = [];

        if (field_value === undefined || field_value === null) {
            field_value = {value: "", rendered_value: ""};
        }
        if (is_select_field) {
            const field_choice_dict = JSON.parse(field.field_data);
            for (const choice in field_choice_dict) {
                if (choice) {
                    field_choices[field_choice_dict[choice].order] = {
                        value: choice,
                        text: field_choice_dict[choice].text,
                        selected: choice === field_value.value,
                    };
                }
            }
        }

        const html = _templates_settings_custom_user_profile_field_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
            field,
            field_type: all_field_template_types.get(field.type),
            field_value,
            is_long_text_field: field.type === all_field_types.LONG_TEXT.id,
            is_user_field: field.type === all_field_types.USER.id,
            is_date_field: field.type === all_field_types.DATE.id,
            is_url_field: field.type === all_field_types.URL.id,
            is_pronouns_field: field.type === all_field_types.PRONOUNS.id,
            is_select_field,
            field_choices,
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id).append(html);
    }
}

function initialize_custom_date_type_fields(element_id) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id).find(".custom_user_field .datepicker").flatpickr({
        altInput: true,
        altFormat: "F j, Y",
        allowInput: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id)
        .find(".custom_user_field .datepicker")
        .on("mouseenter", function () {
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val().length <= 0) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parent().find(".remove_date").hide();
            } else {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parent().find(".remove_date").show();
            }
        });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id)
        .find(".custom_user_field .remove_date")
        .on("click", function () {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parent().find(".custom_user_field_value").val("");
        });
}

function initialize_custom_user_type_fields(
    element_id,
    user_id,
    is_editable,
    set_handler_on_update,
) {
    const field_types = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const user_pills = new Map();

    const person = _people__WEBPACK_IMPORTED_MODULE_13__.get_by_user_id(user_id);
    if (person.is_bot) {
        return user_pills;
    }

    for (const field of Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        let field_value_raw = _people__WEBPACK_IMPORTED_MODULE_13__.get_custom_profile_data(user_id, field.id);

        if (field_value_raw) {
            field_value_raw = field_value_raw.value;
        }

        // If field is not editable and field value is null, we don't expect
        // pill container for that field and proceed further
        if (field.type === field_types.USER.id && (field_value_raw || is_editable)) {
            const $pill_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id)
                .find(`.custom_user_field[data-field-id="${CSS.escape(field.id)}"] .pill-container`)
                .expectOne();
            const pills = _user_pill__WEBPACK_IMPORTED_MODULE_18__.create_pills($pill_container);

            function update_custom_user_field() {
                const fields = [];
                const user_ids = _user_pill__WEBPACK_IMPORTED_MODULE_18__.get_user_ids(pills);
                if (user_ids.length < 1) {
                    fields.push(field.id);
                    update_user_custom_profile_fields(fields, _channel__WEBPACK_IMPORTED_MODULE_9__.del);
                } else {
                    fields.push({id: field.id, value: user_ids});
                    update_user_custom_profile_fields(fields, _channel__WEBPACK_IMPORTED_MODULE_9__.patch);
                }
            }

            if (field_value_raw) {
                const field_value = JSON.parse(field_value_raw);
                if (field_value) {
                    for (const pill_user_id of field_value) {
                        const user = _people__WEBPACK_IMPORTED_MODULE_13__.get_by_user_id(pill_user_id);
                        _user_pill__WEBPACK_IMPORTED_MODULE_18__.append_user(user, pills);
                    }
                }
            }

            if (is_editable) {
                const $input = $pill_container.children(".input");
                if (set_handler_on_update) {
                    const opts = {update_func: update_custom_user_field, user: true};
                    _pill_typeahead__WEBPACK_IMPORTED_MODULE_14__.set_up($input, pills, opts);
                    pills.onPillRemove(() => {
                        update_custom_user_field();
                    });
                } else {
                    _pill_typeahead__WEBPACK_IMPORTED_MODULE_14__.set_up($input, pills, {user: true});
                }
            }
            user_pills.set(field.id, pills);
        }
    }

    return user_pills;
}

function initialize_custom_pronouns_type_fields(element_id) {
    const commonly_used_pronouns = [
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "he/him"}),
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "she/her"}),
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "they/them"}),
    ];
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id)
        .find(".pronouns_type_field")
        .typeahead({
            items: 3,
            fixed: true,
            helpOnEmptyStrings: true,
            source() {
                return commonly_used_pronouns;
            },
            highlighter(item) {
                return _typeahead_helper__WEBPACK_IMPORTED_MODULE_17__.render_typeahead_item({primary: item});
            },
        });
}

function add_custom_profile_fields_to_settings() {
    if (!_overlays__WEBPACK_IMPORTED_MODULE_12__.settings_open()) {
        return;
    }

    const element_id = "#profile-settings .custom-profile-fields-form";
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id).empty();

    append_custom_profile_fields(element_id, _people__WEBPACK_IMPORTED_MODULE_13__.my_current_user_id());
    initialize_custom_user_type_fields(element_id, _people__WEBPACK_IMPORTED_MODULE_13__.my_current_user_id(), true, true);
    initialize_custom_date_type_fields(element_id);
    initialize_custom_pronouns_type_fields(element_id);
}

function hide_confirm_email_banner() {
    if (!_overlays__WEBPACK_IMPORTED_MODULE_12__.settings_open()) {
        return;
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status").hide();
}

function set_up() {
    // Add custom profile fields elements to user account settings.
    add_custom_profile_fields_to_settings();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status").hide();

    const setup_api_key_modal = () => {
        function request_api_key(data) {
            _channel__WEBPACK_IMPORTED_MODULE_9__.post({
                url: "/json/fetch_api_key",
                data,
                success(data) {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_password").val("");
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_value").text(data.api_key);
                    // The display property on the error bar is set to important
                    // so instead of making display: none !important we just
                    // remove it.
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_status").remove();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#password_confirmation").hide();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_button").hide();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show_api_key").show();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_buttons").show();
                },
                error(xhr) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error"}),
                        xhr,
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_status").expectOne(),
                    );
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show_api_key").hide();
                },
            });
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_value").text("");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show_api_key").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_buttons").hide();
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "#get_api_key_password",
            "#get_api_key_password + .password_visibility_toggle",
            {tippy_tooltips: true},
        );

        function do_get_api_key() {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_status").hide();
            const data = {};
            data.password = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_password").val();
            request_api_key(data);
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === false) {
            // Skip the password prompt step, since the user doesn't have one.
            request_api_key({});
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_button").on("click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                do_get_api_key();
            });
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_password").on("keydown", (e) => {
                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                    e.preventDefault();
                    e.stopPropagation();
                    do_get_api_key();
                }
            });
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#regenerate_api_key").on("click", (e) => {
            const email = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
            const api_key = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_value").text();
            const authorization_header = "Basic " + btoa(`${email}:${api_key}`);

            _channel__WEBPACK_IMPORTED_MODULE_9__.post({
                // This endpoint is only accessible with the previous API key,
                // via our usual HTTP Basic auth mechanism.
                url: "/api/v1/users/me/api_key/regenerate",
                headers: {Authorization: authorization_header},
                success(data) {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_value").text(data.api_key);
                },
                error(xhr) {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_api_key_error").text(JSON.parse(xhr.responseText).msg).show();
                },
            });
            e.preventDefault();
            e.stopPropagation();
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#download_zuliprc").on("click", function () {
            const bot_object = {
                user_id: _people__WEBPACK_IMPORTED_MODULE_13__.my_current_user_id(),
                email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                api_key: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_value").text(),
            };
            const data = _settings_bots__WEBPACK_IMPORTED_MODULE_15__.generate_zuliprc_content(bot_object);
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("href", _settings_bots__WEBPACK_IMPORTED_MODULE_15__.encode_zuliprc_as_uri(data));
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_modal [data-micromodal-close]").on("click", () => {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                "#get_api_key_password",
                "#get_api_key_password + .password_visibility_toggle",
            );
        });
    };

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_button").on("click", (e) => {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append(_templates_settings_api_key_modal_hbs__WEBPACK_IMPORTED_MODULE_4___default()());
        setup_api_key_modal();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#api_key_status").hide();
        _overlays__WEBPACK_IMPORTED_MODULE_12__.open_modal("api_key_modal", {
            autoremove: true,
            on_show() {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#get_api_key_password").trigger("focus");
            },
        });
        e.preventDefault();
        e.stopPropagation();
    });

    function clear_password_change() {
        // Clear the password boxes so that passwords don't linger in the DOM
        // for an XSS attacker to find.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "#old_password",
            "#old_password + .password_visibility_toggle",
        );
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "#new_password",
            "#new_password + .password_visibility_toggle",
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#old_password, #new_password").val("");
        password_quality?.("", jquery__WEBPACK_IMPORTED_MODULE_0___default()("#pw_strength .bar"), jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password"));
    }

    function change_password_post_render() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_password_modal")
            .find("[data-micromodal-close]")
            .on("click", () => {
                clear_password_change();
            });
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "#old_password",
            "#old_password + .password_visibility_toggle",
            {tippy_tooltips: true},
        );
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './common'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "#new_password",
            "#new_password + .password_visibility_toggle",
            {tippy_tooltips: true},
        );
        clear_password_change();
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_password").on("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();

        function validate_input(e) {
            e.preventDefault();
            e.stopPropagation();
            const old_password = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#old_password").val();
            const new_password = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password").val();

            if (old_password === "") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Please enter your password"}),
                    undefined,
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error"),
                );
                return false;
            }

            if (new_password === "") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Please choose a new password"}),
                    undefined,
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error"),
                );
                return false;
            }
            return true;
        }

        _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Change password"}),
            html_body: _templates_dialog_change_password_hbs__WEBPACK_IMPORTED_MODULE_3___default()(),
            html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Change"}),
            loading_spinner: true,
            id: "change_password_modal",
            form_id: "change_password_container",
            post_render: change_password_post_render,
            on_click: do_change_password,
            validate_input,
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#pw_change_controls").show();

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== false) {
            // zxcvbn.js is pretty big, and is only needed on password
            // change, so load it asynchronously.
            password_quality = (await Promise.resolve().then(function webpackMissingModule() { var e = new Error("Cannot find module './password_quality'"); e.code = 'MODULE_NOT_FOUND'; throw e; })).password_quality;
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#pw_strength .bar").removeClass("fade");

            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password").on("input", () => {
                const $field = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password");
                password_quality($field.val(), jquery__WEBPACK_IMPORTED_MODULE_0___default()("#pw_strength .bar"), $field);
            });
        }
    });

    function do_change_password(e) {
        e.preventDefault();
        e.stopPropagation();
        const $change_password_error = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_password_modal").find("#dialog_error");
        $change_password_error.hide();

        const data = {
            old_password: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#old_password").val(),
            new_password: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password").val(),
        };

        const $new_pw_field = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#new_password");
        const new_pw = data.new_password;
        if (new_pw !== "") {
            if (password_quality === undefined) {
                // password_quality didn't load, for whatever reason.
                settings_change_error(
                    "An internal error occurred; try reloading the page. " +
                        "Sorry for the trouble!",
                );
                return;
            } else if (!password_quality(new_pw, undefined, $new_pw_field)) {
                settings_change_error(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "New password is too weak"}));
                return;
            }
        }

        _channel__WEBPACK_IMPORTED_MODULE_9__.set_password_change_in_progress(true);
        const opts = {
            success_continuation() {
                _channel__WEBPACK_IMPORTED_MODULE_9__.set_password_change_in_progress(false);
                _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.close_modal();
            },
            error_continuation() {
                _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.hide_dialog_spinner();
                _channel__WEBPACK_IMPORTED_MODULE_9__.set_password_change_in_progress(false);
            },
            $error_msg_element: $change_password_error,
            failure_msg_html: null,
        };
        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_9__.patch,
            "/json/settings",
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status").expectOne(),
            opts,
        );
        clear_password_change();
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#full_name").on("change", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const data = {};

        data.full_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#full_name").val();

        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_9__.patch,
            "/json/settings",
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".full-name-status").expectOne(),
        );
    });

    function do_change_email(e) {
        e.preventDefault();
        e.stopPropagation();
        const $change_email_error = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email_modal").find("#dialog_error");
        const data = {};
        data.email = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email_container").find("input[name='email']").val();

        const opts = {
            success_continuation() {
                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                    const email_msg = _templates_settings_dev_env_email_access_hbs__WEBPACK_IMPORTED_MODULE_6___default()();
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        email_msg,
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dev-account-settings-status").expectOne(),
                        4000,
                    );
                }
                _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.close_modal();
            },
            error_continuation() {
                _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.hide_dialog_spinner();
            },
            $error_msg_element: $change_email_error,
            success_msg_html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Check your email ({email}) to confirm the new address."},
                {email: data.email},
            ),
            sticky: true,
        };
        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_9__.patch,
            "/json/settings",
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status").expectOne(),
            opts,
        );
    }

    function change_email_post_render() {
        const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email_container").find("input[name='email']");
        const email = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email").text().trim();
        $input_elem.val(email);
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.launch({
                html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Change email"}),
                html_body: _templates_change_email_modal_hbs__WEBPACK_IMPORTED_MODULE_1___default()(),
                html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Change"}),
                loading_spinner: true,
                id: "change_email_modal",
                form_id: "change_email_container",
                on_click: do_change_email,
                post_render: change_email_post_render,
                on_shown() {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#change_email_container input").trigger("focus");
                },
            });
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile-settings").on("click", ".custom_user_field .remove_date", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $field = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".custom_user_field").expectOne();
        const field_id = Number.parseInt($field.attr("data-field-id"), 10);
        update_user_custom_profile_fields([field_id], _channel__WEBPACK_IMPORTED_MODULE_9__.del);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile-settings").on("change", ".custom_user_field_value", function (e) {
        const fields = [];
        const value = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val();
        const field_id = Number.parseInt(
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".custom_user_field").attr("data-field-id"),
            10,
        );
        if (value) {
            fields.push({id: field_id, value});
            update_user_custom_profile_fields(fields, _channel__WEBPACK_IMPORTED_MODULE_9__.patch);
        } else {
            fields.push(field_id);
            update_user_custom_profile_fields(fields, _channel__WEBPACK_IMPORTED_MODULE_9__.del);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_deactivate_account_button").on("click", (e) => {
        // This click event must not get propagated to parent container otherwise the modal
        // will not show up because of a call to `close_active_modal` in `settings.js`.
        e.preventDefault();
        e.stopPropagation();

        function handle_confirm() {
            _channel__WEBPACK_IMPORTED_MODULE_9__.del({
                url: "/json/users/me",
                success() {
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.hide_dialog_spinner();
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.close_modal();
                    window.location.href = "/login/";
                },
                error(xhr) {
                    const error_last_owner = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Error: Cannot deactivate the only organization owner.",
                    });
                    const error_last_user = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage:
                                "Error: Cannot deactivate the only user. You can deactivate the whole organization though in your <z-link>organization profile settings</z-link>.",
                        },
                        {
                            "z-link": (content_html) =>
                                `<a target="_blank" href="/#organization/organization-profile">${content_html.join(
                                    "",
                                )}</a>`,
                        },
                    );
                    let rendered_error_msg;
                    if (xhr.responseJSON.code === "CANNOT_DEACTIVATE_LAST_USER") {
                        if (xhr.responseJSON.is_last_owner) {
                            rendered_error_msg = error_last_owner;
                        } else {
                            rendered_error_msg = error_last_user;
                        }
                    }
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.hide_dialog_spinner();
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_11__.close_modal();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings-status")
                        .addClass("alert-error")
                        .html(rendered_error_msg)
                        .show();
                },
            });
        }
        const html_body = _templates_confirm_dialog_confirm_deactivate_own_user_hbs__WEBPACK_IMPORTED_MODULE_2___default()();
        _confirm_dialog__WEBPACK_IMPORTED_MODULE_10__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate your account"}),
            html_body,
            on_click: handle_confirm,
            help_link: "/help/deactivate-your-account",
            loading_spinner: true,
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show_my_user_profile_modal").on("click", (e) => {
        e.stopPropagation();
        e.preventDefault();

        const user = _people__WEBPACK_IMPORTED_MODULE_13__.get_by_user_id(_people__WEBPACK_IMPORTED_MODULE_13__.my_current_user_id());
        _user_profile__WEBPACK_IMPORTED_MODULE_19__.show_user_profile(user);
    });

    function upload_avatar($file_input) {
        const form_data = new FormData();

        form_data.append("csrfmiddlewaretoken", Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        for (const [i, file] of Array.prototype.entries.call($file_input[0].files)) {
            form_data.append("file-" + i, file);
        }
        display_avatar_upload_started();
        _channel__WEBPACK_IMPORTED_MODULE_9__.post({
            url: "/json/users/me/avatar",
            data: form_data,
            cache: false,
            processData: false,
            contentType: false,
            success() {
                display_avatar_upload_complete();
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_file_input_error").hide();
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").hide();
                // Rest of the work is done via the user_events -> avatar_url event we will get
            },
            error(xhr) {
                display_avatar_upload_complete();
                if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "G") {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-source").show();
                }
                const $error = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image_file_input_error");
                $error.text(JSON.parse(xhr.responseText).msg);
                $error.show();
            },
        });
    }

    _avatar__WEBPACK_IMPORTED_MODULE_7__.build_user_avatar_widget(upload_avatar);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_timezone").val(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_timezone").on("change", function (e) {
        e.preventDefault();
        e.stopPropagation();

        const data = {timezone: this.value};

        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_9__.patch,
            "/json/settings",
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".timezone-setting-status").expectOne(),
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#privacy_settings_box").on("change", "input", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget);
        const setting_name = $input_elem.attr("name");
        const checked = $input_elem.prop("checked");

        const data = {[setting_name]: checked};
        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_9__.patch,
            "/json/settings",
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#account-settings .privacy-setting-status").expectOne(),
        );
    });
}


/***/ }),

/***/ "./static/js/settings_bots.js":
/*!************************************!*\
  !*** ./static/js/settings_bots.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_a_new_bot": () => (/* binding */ add_a_new_bot),
/* harmony export */   "bot_creation_policy_values": () => (/* binding */ bot_creation_policy_values),
/* harmony export */   "bot_error": () => (/* binding */ bot_error),
/* harmony export */   "can_create_new_bots": () => (/* binding */ can_create_new_bots),
/* harmony export */   "confirm_bot_deactivation": () => (/* binding */ confirm_bot_deactivation),
/* harmony export */   "encode_zuliprc_as_uri": () => (/* binding */ encode_zuliprc_as_uri),
/* harmony export */   "generate_botserverrc_content": () => (/* binding */ generate_botserverrc_content),
/* harmony export */   "generate_zuliprc_content": () => (/* binding */ generate_zuliprc_content),
/* harmony export */   "generate_zuliprc_uri": () => (/* binding */ generate_zuliprc_uri),
/* harmony export */   "get_bot_info_div": () => (/* binding */ get_bot_info_div),
/* harmony export */   "hide_errors": () => (/* binding */ hide_errors),
/* harmony export */   "render_bots": () => (/* binding */ render_bots),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "show_edit_bot_info_modal": () => (/* binding */ show_edit_bot_info_modal),
/* harmony export */   "type_id_to_string": () => (/* binding */ type_id_to_string),
/* harmony export */   "update_bot_permissions_ui": () => (/* binding */ update_bot_permissions_ui),
/* harmony export */   "update_bot_settings_tip": () => (/* binding */ update_bot_settings_tip)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_bot.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_bot.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_add_new_bot_form_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/add_new_bot_form.hbs */ "./static/templates/settings/add_new_bot_form.hbs");
/* harmony import */ var _templates_settings_add_new_bot_form_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_add_new_bot_form_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_bot_avatar_row_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/bot_avatar_row.hbs */ "./static/templates/settings/bot_avatar_row.hbs");
/* harmony import */ var _templates_settings_bot_avatar_row_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_bot_avatar_row_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_settings_edit_bot_form_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/settings/edit_bot_form.hbs */ "./static/templates/settings/edit_bot_form.hbs");
/* harmony import */ var _templates_settings_edit_bot_form_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_edit_bot_form_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_settings_edit_embedded_bot_service_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/settings/edit_embedded_bot_service.hbs */ "./static/templates/settings/edit_embedded_bot_service.hbs");
/* harmony import */ var _templates_settings_edit_embedded_bot_service_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_edit_embedded_bot_service_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_settings_edit_outgoing_webhook_service_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/settings/edit_outgoing_webhook_service.hbs */ "./static/templates/settings/edit_outgoing_webhook_service.hbs");
/* harmony import */ var _templates_settings_edit_outgoing_webhook_service_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_edit_outgoing_webhook_service_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./avatar */ "./static/js/avatar.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _bot_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./bot_data */ "./static/js/bot_data.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./dropdown_list_widget */ "./static/js/dropdown_list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_users__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_users */ "./static/js/settings_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_profile__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./user_profile */ "./static/js/user_profile.js");

























const OUTGOING_WEBHOOK_BOT_TYPE = "3";
const EMBEDDED_BOT_TYPE = "4";

function hide_errors() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot_table_error").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".bot_error").hide();
}

const focus_tab = {
    active_bots_tab() {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .active").removeClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .active-bots-tab").addClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").show();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#inactive_bots_list").hide();
        hide_errors();
    },
    inactive_bots_tab() {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .active").removeClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .inactive-bots-tab").addClass("active");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#inactive_bots_list").show();
        hide_errors();
    },
};

function get_bot_info_div(bot_id) {
    const sel = `.bot_info[data-user-id="${CSS.escape(bot_id)}"]`;
    return jquery__WEBPACK_IMPORTED_MODULE_1___default()(sel).expectOne();
}

function bot_error(bot_id, xhr) {
    const $bot_info = get_bot_info_div(bot_id);
    const $bot_error_div = $bot_info.find(".bot_error");
    $bot_error_div.text(JSON.parse(xhr.responseText).msg);
    $bot_error_div.show();
    const $bot_box = $bot_info.closest(".bot-information-box");
    $bot_box.scrollTop($bot_box[0].scrollHeight - $bot_box[0].clientHeight);
}

function add_bot_row(info) {
    const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(_templates_settings_bot_avatar_row_hbs__WEBPACK_IMPORTED_MODULE_4___default()(info));
    if (info.is_active) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").append($row);
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#inactive_bots_list").append($row);
    }
}

function is_local_part(value) {
    // Adapted from Django's EmailValidator
    return /^[\w!#$%&'*+/=?^`{|}~-]+(\.[\w!#$%&'*+/=?^`{|}~-]+)*$/i.test(value);
}

function type_id_to_string(type_id) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())((bot_type) => bot_type.type_id === type_id).name;
}

function render_bots() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").empty();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#inactive_bots_list").empty();

    const all_bots_for_current_user = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get_all_bots_for_current_user();
    let user_owns_an_active_bot = false;

    for (const elem of all_bots_for_current_user) {
        add_bot_row({
            name: elem.full_name,
            email: elem.email,
            user_id: elem.user_id,
            type: type_id_to_string(elem.bot_type),
            avatar_url: elem.avatar_url,
            api_key: elem.api_key,
            is_active: elem.is_active,
            zuliprc: "zuliprc", // Most browsers do not allow filename starting with `.`
        });
        user_owns_an_active_bot = user_owns_an_active_bot || elem.is_active;
    }
}

function generate_zuliprc_uri(bot_id) {
    const bot = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get(bot_id);
    const data = generate_zuliprc_content(bot);
    return encode_zuliprc_as_uri(data);
}

function encode_zuliprc_as_uri(zuliprc) {
    return "data:application/octet-stream;charset=utf-8," + encodeURIComponent(zuliprc);
}

function generate_zuliprc_content(bot) {
    let token;
    // For outgoing webhooks, include the token in the zuliprc.
    // It's needed for authenticating to the Botserver.
    if (bot.bot_type === 3) {
        token = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get_services(bot.user_id)[0].token;
    }
    return (
        "[api]" +
        "\nemail=" +
        bot.email +
        "\nkey=" +
        bot.api_key +
        "\nsite=" +
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
        (token === undefined ? "" : "\ntoken=" + token) +
        // Some tools would not work in files without a trailing new line.
        "\n"
    );
}

function generate_botserverrc_content(email, api_key, token) {
    return (
        "[]" +
        "\nemail=" +
        email +
        "\nkey=" +
        api_key +
        "\nsite=" +
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) +
        "\ntoken=" +
        token +
        "\n"
    );
}

const bot_creation_policy_values = {
    admins_only: {
        code: 3,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Admins"}),
    },
    everyone: {
        code: 1,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Admins, moderators and members"}),
    },
    restricted: {
        code: 2,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Admins, moderators and members, but only admins can add generic bots",
        }),
    },
};

function can_create_new_bots() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== bot_creation_policy_values.admins_only.code;
}

function update_bot_settings_tip() {
    const permission_type = bot_creation_policy_values;
    const current_permission = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    let tip_text;
    if (current_permission === permission_type.admins_only.code) {
        tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Only organization administrators can add bots to this organization.",
        });
    } else if (current_permission === permission_type.restricted.code) {
        tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Only organization administrators can add generic bots."});
    } else {
        tip_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Anyone in this organization can add bots."});
    }
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".bot-settings-tip").text(tip_text);
}

function update_add_bot_button() {
    if (can_create_new_bots()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-settings .add-a-new-bot").show();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#admin-bot-list .add-a-new-bot").show();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-settings .add-a-new-bot").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#admin-bot-list .add-a-new-bot").hide();
    }
}

function update_bot_permissions_ui() {
    update_bot_settings_tip();
    hide_errors();
    update_add_bot_button();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#id_realm_bot_creation_policy").val(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}

function add_a_new_bot() {
    const html_body = _templates_settings_add_new_bot_form_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        bot_types: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_embedded_bots: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        realm_bot_domain: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    let create_avatar_widget;

    function create_a_new_bot() {
        const bot_type = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_type :selected").val();
        const full_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_name").val();
        const short_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_short_name").val() || jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_short_name").text();
        const payload_url = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_payload_url").val();
        const interface_type = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_interface_type").val();
        const service_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name :selected").val();
        const formData = new FormData();

        formData.append("csrfmiddlewaretoken", Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        formData.append("bot_type", bot_type);
        formData.append("full_name", full_name);
        formData.append("short_name", short_name);

        // If the selected bot_type is Outgoing webhook
        if (bot_type === OUTGOING_WEBHOOK_BOT_TYPE) {
            formData.append("payload_url", JSON.stringify(payload_url));
            formData.append("interface_type", interface_type);
        } else if (bot_type === EMBEDDED_BOT_TYPE) {
            formData.append("service_name", service_name);
            const config_data = {};
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#config_inputbox [name*='${CSS.escape(service_name)}'] input`).each(function () {
                config_data[jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("name")] = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val();
            });
            formData.append("config_data", JSON.stringify(config_data));
        }
        for (const [i, file] of Array.prototype.entries.call(
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot_avatar_file_input")[0].files,
        )) {
            formData.append("file-" + i, file);
        }

        _channel__WEBPACK_IMPORTED_MODULE_11__.post({
            url: "/json/bots",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            success() {
                hide_errors();
                create_avatar_widget.clear();
                _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.close_modal();
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"));
                _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.hide_dialog_spinner();
            },
        });
    }

    function set_up_form_fields() {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#payload_url_inputbox").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_payload_url").val("");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#service_name_list").hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_inputbox").hide();
        const selected_embedded_bot = "converter";
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name").val(selected_embedded_bot); // TODO: Use 'select a bot'.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_inputbox").children().hide();
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(`[name*='${CSS.escape(selected_embedded_bot)}']`).show();

        create_avatar_widget = _avatar__WEBPACK_IMPORTED_MODULE_8__.build_bot_create_widget();

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_type").on("change", () => {
            const bot_type = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_type :selected").val();
            // For "generic bot" or "incoming webhook" both these fields need not be displayed.
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#service_name_list").hide();
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name").removeClass("required");
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_inputbox").hide();

            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#payload_url_inputbox").hide();
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_payload_url").removeClass("required");
            if (bot_type === OUTGOING_WEBHOOK_BOT_TYPE) {
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#payload_url_inputbox").show();
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_payload_url").addClass("required");
            } else if (bot_type === EMBEDDED_BOT_TYPE) {
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#service_name_list").show();
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name").addClass("required");
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name").trigger("change");
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_inputbox").show();
            }
        });

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name").on("change", () => {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_inputbox").children().hide();
            const selected_bot = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_service_name :selected").val();
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(`[name*='${CSS.escape(selected_bot)}']`).show();
        });
    }

    function validate_input(e) {
        e.preventDefault();
        e.stopPropagation();

        const bot_short_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_short_name").val();

        if (is_local_part(bot_short_name)) {
            return true;
        }
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "Please only use characters that are valid in an email address",
            }),
            undefined,
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"),
        );
        return false;
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.launch({
        form_id: "create_bot_form",
        help_link: "/help/add-a-bot-or-integration",
        html_body,
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add a new bot"}),
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add"}),
        loading_spinner: true,
        on_click: create_a_new_bot,
        on_shown: () => jquery__WEBPACK_IMPORTED_MODULE_1___default()("#create_bot_type").trigger("focus"),
        post_render: set_up_form_fields,
        validate_input,
    });
}

function confirm_bot_deactivation(bot_id, handle_confirm, loading_spinner) {
    const bot = _people__WEBPACK_IMPORTED_MODULE_14__.get_by_user_id(bot_id);
    const html_body = _templates_confirm_dialog_confirm_deactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2___default()();

    _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate {name}?"}, {name: bot.full_name}),
        help_link: "/help/deactivate-or-reactivate-a-bot",
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate"}),
        on_click: handle_confirm,
        loading_spinner,
    });
}

function show_edit_bot_info_modal(user_id, from_user_info_popover) {
    const bot = _people__WEBPACK_IMPORTED_MODULE_14__.get_by_user_id(user_id);

    if (!bot) {
        return;
    }

    const html_body = _templates_settings_edit_bot_form_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
        user_id,
        email: bot.email,
        full_name: bot.full_name,
        user_role_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        disable_role_dropdown: !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || (bot.is_owner && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())),
    });

    let owner_widget;
    let avatar_widget;

    const bot_type = bot.bot_type.toString();
    const service = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get_services(bot.user_id)[0];

    function submit_bot_details() {
        const role = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-role-select").val().trim(), 10);
        const $full_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_widget_modal").find("input[name='full_name']");
        const url = "/json/bots/" + encodeURIComponent(bot.user_id);

        const formData = new FormData();
        formData.append("csrfmiddlewaretoken", Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        formData.append("full_name", $full_name.val());
        formData.append("role", JSON.stringify(role));

        if (owner_widget === undefined) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_bot_owner_widget not called");
        }
        const human_user_id = owner_widget.value();
        if (human_user_id) {
            formData.append("bot_owner_id", human_user_id);
        }

        if (bot_type === OUTGOING_WEBHOOK_BOT_TYPE) {
            const service_payload_url = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#edit_service_base_url").val();
            const service_interface = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#edit_service_interface :selected").val();
            formData.append("service_payload_url", JSON.stringify(service_payload_url));
            formData.append("service_interface", service_interface);
        } else if (bot_type === EMBEDDED_BOT_TYPE && service !== undefined) {
            const config_data = {};
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#config_edit_inputbox input").each(function () {
                config_data[jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("name")] = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val();
            });
            formData.append("config_data", JSON.stringify(config_data));
        }

        const $file_input = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-edit-form").find(".edit_bot_avatar_file_input");
        for (const [i, file] of Array.prototype.entries.call($file_input[0].files)) {
            formData.append("file-" + i, file);
        }

        _channel__WEBPACK_IMPORTED_MODULE_11__.patch({
            url,
            data: formData,
            processData: false,
            contentType: false,
            success() {
                avatar_widget.clear();
                _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.close_modal();
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"));
                _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.hide_dialog_spinner();
            },
        });
    }

    function edit_bot_post_render() {
        const owner_id = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get(user_id).owner_id;

        const user_ids = _people__WEBPACK_IMPORTED_MODULE_14__.get_active_human_ids();
        const users_list = user_ids.map((user_id) => ({
            name: _people__WEBPACK_IMPORTED_MODULE_14__.get_full_name(user_id),
            value: user_id.toString(),
        }));

        const opts = {
            widget_name: "edit_bot_owner",
            data: users_list,
            default_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No owner"}),
            value: owner_id,
        };
        // Note: Rendering this is quite expensive in
        // organizations with 10Ks of users.
        owner_widget = new _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_13__.DropdownListWidget(opts);
        owner_widget.setup();

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-role-select").val(bot.role);
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-role-select")
                .find(`option[value="${CSS.escape(Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))}"]`)
                .hide();
        }

        avatar_widget = _avatar__WEBPACK_IMPORTED_MODULE_8__.build_bot_edit_widget(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-edit-form"));

        if (bot_type === OUTGOING_WEBHOOK_BOT_TYPE) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#service_data").append(
                _templates_settings_edit_outgoing_webhook_service_hbs__WEBPACK_IMPORTED_MODULE_7___default()({
                    service,
                }),
            );
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#edit_service_interface").val(service.interface);
        }
        if (bot_type === EMBEDDED_BOT_TYPE) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#service_data").append(
                _templates_settings_edit_embedded_bot_service_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
                    service,
                }),
            );
        }

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-edit-form").on("click", ".deactivate_bot_button", (e) => {
            e.preventDefault();
            e.stopPropagation();
            const bot_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-edit-form").data("user-id");
            function handle_confirm() {
                const url = "/json/bots/" + encodeURIComponent(bot_id);
                _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_11__.del, url);
            }
            const open_deactivate_modal_callback = () =>
                confirm_bot_deactivation(bot_id, handle_confirm, true);
            _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.close_modal(open_deactivate_modal_callback);
        });
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Manage bot"}),
        html_body,
        id: "edit_bot_modal",
        on_click: submit_bot_details,
        post_render: edit_bot_post_render,
        loading_spinner: from_user_info_popover,
    });
}

function set_up() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#download_botserverrc").on("click", function () {
        const OUTGOING_WEBHOOK_BOT_TYPE_INT = 3;
        let content = "";

        for (const bot of _bot_data__WEBPACK_IMPORTED_MODULE_10__.get_all_bots_for_current_user()) {
            if (bot.is_active && bot.bot_type === OUTGOING_WEBHOOK_BOT_TYPE_INT) {
                const bot_token = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get_services(bot.user_id)[0].token;
                content += generate_botserverrc_content(bot.email, bot.api_key, bot_token);
            }
        }

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr(
            "href",
            "data:application/octet-stream;charset=utf-8," + encodeURIComponent(content),
        );
    });

    // This needs to come before render_bots() in case the user
    // has no active bots
    focus_tab.active_bots_tab();
    render_bots();

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").on("click", "button.deactivate_bot", (e) => {
        const bot_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-user-id"), 10);

        function handle_confirm() {
            const url = "/json/bots/" + encodeURIComponent(bot_id);
            const opts = {
                success_continuation() {
                    const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).closest("li");
                    $row.hide("slow", () => {
                        $row.remove();
                    });
                },
            };
            _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_11__.del, url, {}, opts);
        }
        confirm_bot_deactivation(bot_id, handle_confirm, true);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#inactive_bots_list").on("click", "button.reactivate_bot", (e) => {
        const user_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-user-id"), 10);
        e.stopPropagation();
        e.preventDefault();

        function handle_confirm() {
            _channel__WEBPACK_IMPORTED_MODULE_11__.post({
                url: "/json/users/" + encodeURIComponent(user_id) + "/reactivate",
                success() {
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.close_modal();
                },
                error(xhr) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_error"));
                    _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.hide_dialog_spinner();
                },
            });
        }

        _settings_users__WEBPACK_IMPORTED_MODULE_15__.confirm_reactivation(user_id, handle_confirm, true);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").on("click", "button.regenerate_bot_api_key", (e) => {
        const bot_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-user-id"), 10);
        _channel__WEBPACK_IMPORTED_MODULE_11__.post({
            url: "/json/bots/" + encodeURIComponent(bot_id) + "/api_key/regenerate",
            success(data) {
                const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).closest("li");
                $row.find(".api_key").find(".value").text(data.api_key);
                $row.find("api_key_error").hide();
            },
            error(xhr) {
                const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).closest("li");
                $row.find(".api_key_error").text(JSON.parse(xhr.responseText).msg).show();
            },
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").on("click", "button.open_edit_bot_form", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $li = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).closest("li");
        const bot_id = Number.parseInt($li.find(".bot_info").attr("data-user-id"), 10);
        show_edit_bot_info_modal(bot_id, false);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").on("click", "a.download_bot_zuliprc", function () {
        const $bot_info = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".bot-information-box").find(".bot_info");
        const bot_id = Number.parseInt($bot_info.attr("data-user-id"), 10);
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("href", generate_zuliprc_uri(bot_id));
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#active_bots_list").on("click", "button.open_bots_subscribed_streams", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const bot_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-user-id"), 10);
        const bot = _people__WEBPACK_IMPORTED_MODULE_14__.get_by_user_id(bot_id);
        _user_profile__WEBPACK_IMPORTED_MODULE_16__.show_user_profile(bot, "user-profile-streams-tab");
    });

    new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())("#copy_zuliprc", {
        text(trigger) {
            const $bot_info = jquery__WEBPACK_IMPORTED_MODULE_1___default()(trigger).closest(".bot-information-box").find(".bot_info");
            const bot_id = Number.parseInt($bot_info.attr("data-user-id"), 10);
            const bot = _bot_data__WEBPACK_IMPORTED_MODULE_10__.get(bot_id);
            const data = generate_zuliprc_content(bot);
            return data;
        },
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .active-bots-tab").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        focus_tab.active_bots_tab();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bots_lists_navbar .inactive-bots-tab").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        focus_tab.inactive_bots_tab();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#bot-settings .add-a-new-bot").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        add_a_new_bot();
    });
}


/***/ }),

/***/ "./static/js/settings_display.js":
/*!***************************************!*\
  !*** ./static/js/settings_display.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch_default_language_setting_modal": () => (/* binding */ launch_default_language_setting_modal),
/* harmony export */   "report_emojiset_change": () => (/* binding */ report_emojiset_change),
/* harmony export */   "report_user_list_style_change": () => (/* binding */ report_user_list_style_change),
/* harmony export */   "set_default_language_name": () => (/* binding */ set_default_language_name),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_page": () => (/* binding */ update_page),
/* harmony export */   "user_default_language_name": () => (/* binding */ user_default_language_name),
/* harmony export */   "user_settings_panel": () => (/* binding */ user_settings_panel)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var js_cookie__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! js-cookie */ "./node_modules/js-cookie/dist/js.cookie.mjs");
/* harmony import */ var _templates_default_language_modal_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/default_language_modal.hbs */ "./static/templates/default_language_modal.hbs");
/* harmony import */ var _templates_default_language_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_default_language_modal_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _emojisets__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./emojisets */ "./static/js/emojisets.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

 // eslint-disable-line import/no-unresolved
















const meta = {
    loaded: false,
};

const user_settings_panel = {};

let user_default_language_name;

function set_default_language_name(name) {
    user_default_language_name = name;
}

function change_display_setting(data, $status_el, success_msg_html, sticky) {
    const status_is_sticky = $status_el.data("is_sticky");
    const display_message_html = status_is_sticky
        ? $status_el.data("sticky_msg_html")
        : success_msg_html;
    const opts = {
        success_msg_html: display_message_html,
        sticky: status_is_sticky || sticky,
    };

    if (sticky) {
        $status_el.data("is_sticky", true);
        $status_el.data("sticky_msg_html", success_msg_html);
    }
    _settings_ui__WEBPACK_IMPORTED_MODULE_10__.do_settings_change(_channel__WEBPACK_IMPORTED_MODULE_3__.patch, "/json/settings", data, $status_el, opts);
}

function spectator_default_language_modal_post_render() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#language_selection_modal")
        .find(".language")
        .on("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.close_modal();

            const $link = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("a[data-code]");
            js_cookie__WEBPACK_IMPORTED_MODULE_1__["default"].set(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()), $link.attr("data-code"));
            window.location.reload();
        });
}

function org_notification_default_language_modal_post_render() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#language_selection_modal")
        .find(".language")
        .on("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.close_modal();

            const $link = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("a[data-code]");
            const setting_value = $link.attr("data-code");
            const new_language = $link.attr("data-name");
            const $language_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                "#org-notifications .language_selection_widget .language_selection_button span",
            );
            $language_element.text(new_language);
            $language_element.attr("data-language-code", setting_value);
            _settings_org__WEBPACK_IMPORTED_MODULE_9__.save_discard_widget_status_handler(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-notifications"));
        });
}

function user_default_language_modal_post_render() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#language_selection_modal")
        .find(".language")
        .on("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.close_modal();

            const $link = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("a[data-code]");
            const setting_value = $link.attr("data-code");
            const data = {default_language: setting_value};

            const new_language = $link.attr("data-name");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                "#user-display-settings .language_selection_widget .language_selection_button span",
            ).text(new_language);

            change_display_setting(
                data,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_content").find(".lang-time-settings-status"),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {
                        defaultMessage:
                            "Saved. Please <z-link>reload</z-link> for the change to take effect.",
                    },
                    {
                        "z-link": (content_html) =>
                            `<a class='reload_link'>${content_html.join("")}</a>`,
                    },
                ),
                true,
            );
        });
}

function default_language_modal_post_render() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        spectator_default_language_modal_post_render();
    } else if (_hash_util__WEBPACK_IMPORTED_MODULE_6__.get_current_hash_category() === "organization") {
        org_notification_default_language_modal_post_render();
    } else {
        user_default_language_modal_post_render();
    }
}

function launch_default_language_setting_modal() {
    let selected_language = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    if (_hash_util__WEBPACK_IMPORTED_MODULE_6__.get_current_hash_category() === "organization") {
        selected_language = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }

    const html_body = _templates_default_language_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        language_list: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(selected_language),
    });

    _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Select language"}),
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Close"}),
        id: "language_selection_modal",
        close_on_submit: true,
        focus_submit_on_open: true,
        single_footer_button: true,
        post_render: default_language_modal_post_render,
        on_click() {},
    });
}

function set_up(settings_panel) {
    meta.loaded = true;
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container);
    const settings_object = settings_panel.settings_object;
    const for_realm_settings = settings_panel.for_realm_settings;

    $container.find(".advanced-settings-status").hide();

    // Select current values for enum/select type fields. For boolean
    // fields, the current value is set automatically in the template.
    $container
        .find(".setting_demote_inactive_streams")
        .val(settings_object.demote_inactive_streams);
    $container.find(".setting_color_scheme").val(settings_object.color_scheme);
    $container.find(".setting_default_view").val(settings_object.default_view);
    $container
        .find(".setting_twenty_four_hour_time")
        .val(JSON.stringify(settings_object.twenty_four_hour_time));
    $container
        .find(`.setting_emojiset_choice[value="${CSS.escape(settings_object.emojiset)}"]`)
        .prop("checked", true);
    $container
        .find(`.setting_user_list_style_choice[value=${settings_object.user_list_style}]`)
        .prop("checked", true);

    if (for_realm_settings) {
        // For the realm-level defaults page, we use the common
        // settings_org.js handlers, so we can return early here.
        return;
    }

    // Common handler for sending requests to the server when an input
    // element is changed.
    $container.on("change", "input[type=checkbox], select", function (e) {
        const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget);
        const setting = $input_elem.attr("name");
        const data = {};
        data[setting] = _settings_org__WEBPACK_IMPORTED_MODULE_9__.get_input_element_value(this);
        const $status_element = $input_elem
            .closest(".subsection-parent")
            .find(".alert-notification");
        change_display_setting(data, $status_element);
    });

    $container.find(".setting_emojiset_choice").on("click", function () {
        const data = {emojiset: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val()};
        const current_emojiset = settings_object.emojiset;
        if (current_emojiset === data.emojiset) {
            return;
        }
        const $spinner = $container.find(".theme-settings-status").expectOne();
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner, {text: _settings_ui__WEBPACK_IMPORTED_MODULE_10__.strings.saving});

        _channel__WEBPACK_IMPORTED_MODULE_3__.patch({
            url: "/json/settings",
            data,
            success() {},
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _settings_ui__WEBPACK_IMPORTED_MODULE_10__.strings.failure_html,
                    xhr,
                    $container.find(".theme-settings-status").expectOne(),
                );
            },
        });
    });

    $container.find(".setting_user_list_style_choice").on("click", function () {
        const data = {user_list_style: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val()};
        const current_user_list_style = settings_object.user_list_style;
        if (current_user_list_style === data.user_list_style) {
            return;
        }
        const $spinner = $container.find(".theme-settings-status").expectOne();
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner, {text: _settings_ui__WEBPACK_IMPORTED_MODULE_10__.strings.saving});

        _channel__WEBPACK_IMPORTED_MODULE_3__.patch({
            url: "/json/settings",
            data,
            success() {},
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _settings_ui__WEBPACK_IMPORTED_MODULE_10__.strings.failure_html,
                    xhr,
                    $container.find(".theme-settings-status").expectOne(),
                );
            },
        });
    });
}

async function report_emojiset_change(settings_panel) {
    // TODO: Clean up how this works so we can use
    // change_display_setting.  The challenge is that we don't want to
    // report success before the server_events request returns that
    // causes the actual sprite sheet to change.  The current
    // implementation is wrong, though, in that it displays the UI
    // update in all active browser windows.
    await _emojisets__WEBPACK_IMPORTED_MODULE_5__.select(settings_panel.settings_object.emojiset);

    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container).find(".theme-settings-status");
    if ($spinner.length) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Emoji set changed successfully!"}),
            $spinner.expectOne(),
        );
        $spinner.expectOne();
        _settings_ui__WEBPACK_IMPORTED_MODULE_10__.display_checkmark($spinner);
    }
}

async function report_user_list_style_change(settings_panel) {
    // TODO: Clean up how this works so we can use
    // change_display_setting.  The challenge is that we don't want to
    // report success before the server_events request returns that
    // causes the actual sprite sheet to change.  The current
    // implementation is wrong, though, in that it displays the UI
    // update in all active browser windows.
    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container).find(".theme-settings-status");
    if ($spinner.length) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User list style changed successfully!"}),
            $spinner.expectOne(),
        );
        $spinner.expectOne();
        _settings_ui__WEBPACK_IMPORTED_MODULE_10__.display_checkmark($spinner);
    }
}

function update_page(property) {
    if (!_overlays__WEBPACK_IMPORTED_MODULE_8__.settings_open()) {
        return;
    }
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(user_settings_panel.container);
    let value = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property];

    // The default_language button text updates to the language
    // name and not the value of the user_settings property.
    if (property === "default_language") {
        $container.find(".default_language_name").text(user_default_language_name);
        return;
    }

    // settings_org.set_input_element_value doesn't support radio
    // button widgets like these.
    if (property === "emojiset" || property === "user_list_style") {
        $container.find(`input[value=${CSS.escape(value)}]`).prop("checked", true);
        return;
    }

    // The twenty_four_hour_time setting is represented as a boolean
    // in the API, but a dropdown with "true"/"false" as strings in
    // the UI, so we need to convert its format here.
    if (property === "twenty_four_hour_time") {
        value = value.toString();
    }

    const $input_elem = $container.find(`[name=${CSS.escape(property)}]`);
    _settings_org__WEBPACK_IMPORTED_MODULE_9__.set_input_element_value($input_elem, value);
}

function initialize() {
    const user_language_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    set_default_language_name(user_language_name);

    user_settings_panel.container = "#user-display-settings";
    user_settings_panel.settings_object = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    user_settings_panel.for_realm_settings = false;
}


/***/ }),

/***/ "./static/js/settings_emoji.js":
/*!*************************************!*\
  !*** ./static/js/settings_emoji.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_emoji_upload_widget": () => (/* binding */ build_emoji_upload_widget),
/* harmony export */   "populate_emoji": () => (/* binding */ populate_emoji),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_custom_emoji_ui": () => (/* binding */ update_custom_emoji_ui)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_custom_emoji_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_custom_emoji.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_custom_emoji.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_custom_emoji_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_custom_emoji_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_emoji_settings_warning_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_emoji_settings_warning.hbs */ "./static/templates/confirm_dialog/confirm_emoji_settings_warning.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_emoji_settings_warning_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_emoji_settings_warning_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_admin_emoji_list_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/admin_emoji_list.hbs */ "./static/templates/settings/admin_emoji_list.hbs");
/* harmony import */ var _templates_settings_admin_emoji_list_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_emoji_list_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_emoji_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/emoji_settings_tip.hbs */ "./static/templates/settings/emoji_settings_tip.hbs");
/* harmony import */ var _templates_settings_emoji_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_emoji_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* eslint-disable no-unused-vars */


// import emoji_codes from "../generated/emoji/emoji_codes.json";




















const meta = {
    loaded: false,
};

function can_delete_emoji(emoji) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }
    if (emoji.author_id === null) {
        // If we don't have the author information then only admin is allowed to disable that emoji.
        return false;
    }
    if (_people__WEBPACK_IMPORTED_MODULE_11__.is_my_user_id(emoji.author_id)) {
        return true;
    }
    return false;
}

function update_custom_emoji_ui() {
    const rendered_tip = _templates_settings_emoji_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
        realm_add_custom_emoji_policy: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        policy_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji-settings").find(".emoji-settings-tip-container").html(rendered_tip);
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".add-emoji-text").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin-emoji-form").hide();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".add-emoji-text").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin-emoji-form").show();
    }

    populate_emoji();
}

function reset() {
    meta.loaded = false;
}

function sort_author_full_name(a, b) {
    if (a.author.full_name > b.author.full_name) {
        return 1;
    } else if (a.author.full_name === b.author.full_name) {
        return 0;
    }
    return -1;
}

function is_default_emoji(emoji_name) {
    // return emoji_codes.names.includes(emoji_name);
}

function is_custom_emoji(emoji_name) {
    const emoji_data = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_server_realm_emoji_data();
    for (const emoji of Object.values(emoji_data)) {
        if (emoji.name === emoji_name && !emoji.deactivated) {
            return true;
        }
    }
    return false;
}

function populate_emoji() {
    if (!meta.loaded) {
        return;
    }

    const emoji_data = _emoji__WEBPACK_IMPORTED_MODULE_8__.get_server_realm_emoji_data();

    for (const emoji of Object.values(emoji_data)) {
        // Add people.js data for the user here.
        if (emoji.author_id !== null) {
            emoji.author = _people__WEBPACK_IMPORTED_MODULE_11__.get_by_user_id(emoji.author_id);
        } else {
            emoji.author = null;
        }
    }

    const $emoji_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_emoji_table").expectOne();
    _list_widget__WEBPACK_IMPORTED_MODULE_10__.create($emoji_table, Object.values(emoji_data), {
        name: "emoji_list",
        modifier(item) {
            if (item.deactivated !== true) {
                return _templates_settings_admin_emoji_list_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                    emoji: {
                        name: item.name,
                        display_name: item.name.replace(/_/g, " "),
                        source_url: item.source_url,
                        author: item.author || "",
                        can_delete_emoji: can_delete_emoji(item),
                    },
                });
            }
            return "";
        },
        filter: {
            $element: $emoji_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                return item.name.toLowerCase().includes(value);
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_12__.reset_scrollbar($emoji_table);
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji-settings").expectOne(),
        sort_fields: {
            author_full_name: sort_author_full_name,
        },
        init_sort: ["alphabetic", "name"],
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji-settings .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_emoji_loading_indicator"));
}

function build_emoji_upload_widget() {
    const get_file_input = function () {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_file_input");
    };

    const $file_name_field = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji-file-name");
    const $input_error = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_file_input_error");
    const $clear_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_image_clear_button");
    const $upload_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_upload_button");
    const $preview_text = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_preview_text");
    const $preview_image = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_preview_image");

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './upload_widget'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        get_file_input,
        $file_name_field,
        $input_error,
        $clear_button,
        $upload_button,
        $preview_text,
        $preview_image,
    );
}

function set_up() {
    meta.loaded = true;

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_emoji_loading_indicator"));

    // Populate emoji table
    populate_emoji();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_emoji_table").on("click", ".delete", function (e) {
        e.preventDefault();
        e.stopPropagation();
        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const url = "/json/realm/emoji/" + encodeURIComponent($btn.attr("data-emoji-name"));
        const html_body = _templates_confirm_dialog_confirm_deactivate_custom_emoji_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

        const opts = {
            success_continuation() {
                const $row = $btn.parents("tr");
                $row.remove();
            },
        };

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate custom emoji?"}),
            html_body,
            id: "confirm_deactivate_custom_emoji_modal",
            on_click: () => _dialog_widget__WEBPACK_IMPORTED_MODULE_7__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_5__.del, url, {}, opts),
            loading_spinner: true,
        });
    });

    const emoji_widget = build_emoji_upload_widget();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization form.admin-emoji-form")
        .off("submit")
        .on("submit", function (e) {
            e.preventDefault();
            e.stopPropagation();
            const $emoji_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-emoji-status");
            const emoji = {};

            function submit_custom_emoji_request() {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_emoji_submit").prop("disabled", true);
                const formData = new FormData();
                for (const [i, file] of Array.prototype.entries.call(
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#emoji_file_input")[0].files,
                )) {
                    formData.append("file-" + i, file);
                }

                _channel__WEBPACK_IMPORTED_MODULE_5__.post({
                    url: "/json/realm/emoji/" + encodeURIComponent(emoji.name),
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    success() {
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-emoji-status").hide();
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Custom emoji added!"}),
                            $emoji_status,
                        );
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("form.admin-emoji-form input[type='text']").val("");
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_emoji_submit").prop("disabled", false);
                        emoji_widget.clear();
                    },
                    error(xhr) {
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-emoji-status").hide();
                        const errors = JSON.parse(xhr.responseText).msg;
                        xhr.responseText = JSON.stringify({msg: errors});
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $emoji_status);
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_emoji_submit").prop("disabled", false);
                    },
                });
            }

            for (const obj of jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).serializeArray()) {
                emoji[obj.name] = obj.value;
            }

            if (emoji.name.trim() === "") {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed: Emoji name is required."}),
                    $emoji_status,
                );
                return;
            }

            if (is_custom_emoji(emoji.name)) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Failed: A custom emoji with this name already exists.",
                    }),
                    $emoji_status,
                );
                return;
            }

            if (is_default_emoji(emoji.name)) {
                const html_body = _templates_confirm_dialog_confirm_emoji_settings_warning_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
                    emoji_name: emoji.name,
                });

                _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
                    html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Override built-in emoji?"}),
                    html_body,
                    on_click: submit_custom_emoji_request,
                });
            } else {
                submit_custom_emoji_request();
            }
        });
}


/***/ }),

/***/ "./static/js/settings_exports.js":
/*!***************************************!*\
  !*** ./static/js/settings_exports.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "populate_exports_table": () => (/* binding */ populate_exports_table),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_data_export_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_data_export.hbs */ "./static/templates/confirm_dialog/confirm_delete_data_export.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_data_export_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_data_export_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_admin_export_list_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/admin_export_list.hbs */ "./static/templates/settings/admin_export_list.hbs");
/* harmony import */ var _templates_settings_admin_export_list_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_export_list_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function sort_user(a, b) {
    const a_name = _people__WEBPACK_IMPORTED_MODULE_8__.get_full_name(a.acting_user_id).toLowerCase();
    const b_name = _people__WEBPACK_IMPORTED_MODULE_8__.get_full_name(b.acting_user_id).toLowerCase();
    if (a_name > b_name) {
        return 1;
    } else if (a_name === b_name) {
        return 0;
    }
    return -1;
}

function populate_exports_table(exports) {
    if (!meta.loaded) {
        return;
    }

    const $exports_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_exports_table").expectOne();
    _list_widget__WEBPACK_IMPORTED_MODULE_7__.create($exports_table, Object.values(exports), {
        name: "admin_exports_list",
        modifier(data) {
            let failed_timestamp = data.failed_timestamp;
            let deleted_timestamp = data.deleted_timestamp;

            if (failed_timestamp !== null) {
                failed_timestamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    new Date(failed_timestamp * 1000),
                );
            }

            if (deleted_timestamp !== null) {
                deleted_timestamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    new Date(deleted_timestamp * 1000),
                );
            }

            return _templates_settings_admin_export_list_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
                realm_export: {
                    id: data.id,
                    acting_user: _people__WEBPACK_IMPORTED_MODULE_8__.get_full_name(data.acting_user_id),
                    // Convert seconds -> milliseconds
                    event_time: Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        new Date(data.export_time * 1000),
                    ),
                    url: data.export_url,
                    time_failed: failed_timestamp,
                    pending: data.pending,
                    time_deleted: deleted_timestamp,
                },
            });
        },
        filter: {
            $element: $exports_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                return _people__WEBPACK_IMPORTED_MODULE_8__.get_full_name(item.acting_user_id).toLowerCase().includes(value);
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_9__.reset_scrollbar($exports_table);
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#data-exports").expectOne(),
        init_sort: [sort_user],
        sort_fields: {
            user: sort_user,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#data-exports .progressive-table-wrapper"),
    });

    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".export_row .export_url_spinner");
    if ($spinner.length) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
    }
}

function set_up() {
    meta.loaded = true;

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#export-data").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $export_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#export_status");

        _channel__WEBPACK_IMPORTED_MODULE_3__.post({
            url: "/json/export/realm",
            success() {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Export started. Check back in a few minutes."}),
                    $export_status,
                    4000,
                );
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Export failed"}), xhr, $export_status);
            },
        });
    });

    // Do an initial population of the table
    _channel__WEBPACK_IMPORTED_MODULE_3__.get({
        url: "/json/export/realm",
        success(data) {
            populate_exports_table(data.exports);
        },
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_exports_table").on("click", ".delete", function (e) {
        e.preventDefault();
        e.stopPropagation();
        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const url = "/json/export/realm/" + encodeURIComponent($btn.attr("data-export-id"));
        const html_body = _templates_confirm_dialog_confirm_delete_data_export_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete data export?"}),
            html_body,
            on_click: () => _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_3__.del, url),
            loading_spinner: true,
        });
    });
}


/***/ }),

/***/ "./static/js/settings_invites.js":
/*!***************************************!*\
  !*** ./static/js/settings_invites.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "on_load_success": () => (/* binding */ on_load_success),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_resend_invite_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_resend_invite.hbs */ "./static/templates/confirm_dialog/confirm_resend_invite.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_resend_invite_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_resend_invite_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_revoke_invite_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_revoke_invite.hbs */ "./static/templates/confirm_dialog/confirm_revoke_invite.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_revoke_invite_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_revoke_invite_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_admin_invites_list_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/admin_invites_list.hbs */ "./static/templates/settings/admin_invites_list.hbs");
/* harmony import */ var _templates_settings_admin_invites_list_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_invites_list_hbs__WEBPACK_IMPORTED_MODULE_3__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function failed_listing_invites(xhr) {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_invites_loading_indicator"));
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error listing invites"}),
        xhr,
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#invites-field-status"),
    );
}

function add_invited_as_text(invites) {
    for (const data of invites) {
        data.invited_as_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(data.invited_as);
    }
}

function sort_invitee(a, b) {
    // multi-invite links don't have an email field,
    // so we set them to empty strings to let them
    // sort to the top
    const str1 = (a.email || "").toUpperCase();
    const str2 = (b.email || "").toUpperCase();

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(str1, str2);
}

function populate_invites(invites_data) {
    if (!meta.loaded) {
        return;
    }

    add_invited_as_text(invites_data.invites);

    const $invites_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_invites_table").expectOne();
    _list_widget__WEBPACK_IMPORTED_MODULE_7__.create($invites_table, invites_data.invites, {
        name: "admin_invites_list",
        modifier(item) {
            item.invited_absolute_time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item.invited * 1000);
            if (item.expiry_date !== null) {
                item.expiry_date_absolute_time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item.expiry_date * 1000);
            }
            item.is_admin = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
            item.disable_buttons =
                item.invited_as === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
                !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
            item.referrer_name = _people__WEBPACK_IMPORTED_MODULE_8__.get_by_user_id(item.invited_by_user_id).full_name;
            return _templates_settings_admin_invites_list_hbs__WEBPACK_IMPORTED_MODULE_3___default()({invite: item});
        },
        filter: {
            $element: $invites_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                const referrer = _people__WEBPACK_IMPORTED_MODULE_8__.get_by_user_id(item.invited_by_user_id);
                const referrer_email = referrer.email;
                const referrer_name = referrer.full_name;
                const referrer_name_matched = referrer_name.toLowerCase().includes(value);
                const referrer_email_matched = referrer_email.toLowerCase().includes(value);
                if (item.is_multiuse) {
                    return referrer_name_matched || referrer_email_matched;
                }
                const invitee_email_matched = item.email.toLowerCase().includes(value);
                return referrer_email_matched || referrer_name_matched || invitee_email_matched;
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-invites-list").expectOne(),
        init_sort: [sort_invitee],
        sort_fields: {
            invitee: sort_invitee,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-invites-list .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_invites_loading_indicator"));
}

function do_revoke_invite() {
    const modal_invite_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-invite-id");
    const modal_is_multiuse = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-is-multiuse");
    const $revoke_button = meta.$current_revoke_invite_user_modal_row.find("button.revoke");

    if (modal_invite_id !== meta.invite_id || modal_is_multiuse !== meta.is_multiuse) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invite revoking canceled due to non-matching fields.");
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "Resending encountered an error. Please reload and try again.",
            }),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#home-error"),
        );
    }

    $revoke_button.prop("disabled", true).text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Working…"}));
    let url = "/json/invites/" + meta.invite_id;

    if (modal_is_multiuse === "true") {
        url = "/json/invites/multiuse/" + meta.invite_id;
    }
    _channel__WEBPACK_IMPORTED_MODULE_5__.del({
        url,
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(xhr, $revoke_button);
        },
        success() {
            meta.$current_revoke_invite_user_modal_row.remove();
        },
    });
}

function do_resend_invite() {
    const modal_invite_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-invite-id");
    const $resend_button = meta.$current_resend_invite_user_modal_row.find("button.resend");

    if (modal_invite_id !== meta.invite_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invite resending canceled due to non-matching fields.");
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "Resending encountered an error. Please reload and try again.",
            }),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#home-error"),
        );
    }

    $resend_button.prop("disabled", true).text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Working…"}));
    _channel__WEBPACK_IMPORTED_MODULE_5__.post({
        url: "/json/invites/" + meta.invite_id + "/resend",
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(xhr, $resend_button);
        },
        success(data) {
            $resend_button.text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Sent!"}));
            $resend_button.removeClass("resend btn-warning").addClass("sea-green");
            data.timestamp = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(data.timestamp * 1000);
            meta.$current_resend_invite_user_modal_row.find(".invited_at").text(data.timestamp);
        },
    });
}

function set_up(initialize_event_handlers = true) {
    meta.loaded = true;

    // create loading indicators
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_invites_loading_indicator"));

    // Populate invites table
    _channel__WEBPACK_IMPORTED_MODULE_5__.get({
        url: "/json/invites",
        timeout: 10 * 1000,
        success(data) {
            on_load_success(data, initialize_event_handlers);
        },
        error: failed_listing_invites,
    });
}

function on_load_success(invites_data, initialize_event_handlers) {
    meta.loaded = true;
    populate_invites(invites_data);
    if (!initialize_event_handlers) {
        return;
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_invites_table").on("click", ".revoke", (e) => {
        // This click event must not get propagated to parent container otherwise the modal
        // will not show up because of a call to `close_active_modal` in `settings.js`.
        e.preventDefault();
        e.stopPropagation();
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".invite_row");
        const email = $row.find(".email").text();
        const referred_by = $row.find(".referred_by").text();
        meta.$current_revoke_invite_user_modal_row = $row;
        meta.invite_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-invite-id");
        meta.is_multiuse = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-is-multiuse");
        const ctx = {
            is_multiuse: meta.is_multiuse === "true",
            email,
            referred_by,
        };
        const html_body = _templates_confirm_dialog_confirm_revoke_invite_hbs__WEBPACK_IMPORTED_MODULE_2___default()(ctx);

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
            html_heading: ctx.is_multiuse
                ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Revoke invitation link"})
                : Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Revoke invitation to {email}"}, {email}),
            html_body,
            on_click: do_revoke_invite,
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-invite-id", meta.invite_id);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-is-multiuse", meta.is_multiuse);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_invites_table").on("click", ".resend", (e) => {
        // This click event must not get propagated to parent container otherwise the modal
        // will not show up because of a call to `close_active_modal` in `settings.js`.
        e.preventDefault();
        e.stopPropagation();

        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".invite_row");
        const email = $row.find(".email").text();
        meta.$current_resend_invite_user_modal_row = $row;
        meta.invite_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-invite-id");
        const html_body = _templates_confirm_dialog_confirm_resend_invite_hbs__WEBPACK_IMPORTED_MODULE_1___default()({email});

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Resend invitation"}),
            html_body,
            on_click: do_resend_invite,
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button").attr("data-invite-id", meta.invite_id);
    });
}


/***/ }),

/***/ "./static/js/settings_linkifiers.js":
/*!******************************************!*\
  !*** ./static/js/settings_linkifiers.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "populate_linkifiers": () => (/* binding */ populate_linkifiers),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_linkifier_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_linkifier.hbs */ "./static/templates/confirm_dialog/confirm_delete_linkifier.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_linkifier_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_linkifier_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_admin_linkifier_edit_form_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/admin_linkifier_edit_form.hbs */ "./static/templates/settings/admin_linkifier_edit_form.hbs");
/* harmony import */ var _templates_settings_admin_linkifier_edit_form_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_linkifier_edit_form_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_admin_linkifier_list_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/admin_linkifier_list.hbs */ "./static/templates/settings/admin_linkifier_list.hbs");
/* harmony import */ var _templates_settings_admin_linkifier_list_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_linkifier_list_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function maybe_disable_widgets() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }
}

function compare_values(x, y) {
    if (x > y) {
        return 1;
    } else if (x === y) {
        return 0;
    }
    return -1;
}

function sort_pattern(a, b) {
    return compare_values(a.pattern, b.pattern);
}

function sort_url(a, b) {
    return compare_values(a.url_format, b.url_format);
}

function open_linkifier_edit_form(linkifier_id) {
    const linkifiers_list = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const linkifier = linkifiers_list.find((linkifier) => linkifier.id === linkifier_id);
    const html_body = _templates_settings_admin_linkifier_edit_form_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        linkifier_id,
        pattern: linkifier.pattern,
        url_format_string: linkifier.url_format,
    });

    function submit_linkifier_form() {
        const $change_linkifier_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".dialog_submit_button");
        $change_linkifier_button.prop("disabled", true);

        const $modal = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_widget_modal");
        const url = "/json/realm/filters/" + encodeURIComponent(linkifier_id);
        const pattern = $modal.find("#edit-linkifier-pattern").val().trim();
        const url_format_string = $modal.find("#edit-linkifier-url-format-string").val().trim();
        const data = {pattern, url_format_string};
        const $pattern_status = $modal.find("#edit-linkifier-pattern-status").expectOne();
        const $format_status = $modal.find("#edit-linkifier-format-status").expectOne();
        const $dialog_error_element = $modal.find("#dialog_error").expectOne();
        const opts = {
            success_continuation() {
                $change_linkifier_button.prop("disabled", false);
                _dialog_widget__WEBPACK_IMPORTED_MODULE_6__.close_modal();
            },
            error_continuation(xhr) {
                $change_linkifier_button.prop("disabled", false);
                const response_text = JSON.parse(xhr.responseText);
                if (response_text.errors !== undefined) {
                    handle_linkifier_api_error(
                        xhr,
                        $pattern_status,
                        $format_status,
                        $dialog_error_element,
                    );
                } else {
                    // This must be `Linkifier not found` error.
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}),
                        xhr,
                        $dialog_error_element,
                    );
                }
            },
            // Show the error message only on edit linkifier modal.
            $error_msg_element: jquery__WEBPACK_IMPORTED_MODULE_0___default()(),
        };
        _settings_ui__WEBPACK_IMPORTED_MODULE_9__.do_settings_change(
            _channel__WEBPACK_IMPORTED_MODULE_4__.patch,
            url,
            data,
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#linkifier-field-status"),
            opts,
        );
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_6__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Edit linkfiers"}),
        html_body,
        on_click: submit_linkifier_form,
    });
}

function handle_linkifier_api_error(xhr, pattern_status, format_status, linkifier_status) {
    // The endpoint uses the Django ValidationError system for error
    // handling, which returns somewhat complicated error
    // dictionaries. This logic parses them.
    const errors = JSON.parse(xhr.responseText).errors;
    if (errors.pattern !== undefined) {
        xhr.responseText = JSON.stringify({msg: errors.pattern});
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, pattern_status);
    }
    if (errors.url_format_string !== undefined) {
        xhr.responseText = JSON.stringify({msg: errors.url_format_string});
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, format_status);
    }
    if (errors.__all__ !== undefined) {
        xhr.responseText = JSON.stringify({msg: errors.__all__});
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, linkifier_status);
    }
}

function populate_linkifiers(linkifiers_data) {
    if (!meta.loaded) {
        return;
    }

    const $linkifiers_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_linkifiers_table").expectOne();
    _list_widget__WEBPACK_IMPORTED_MODULE_8__.create($linkifiers_table, linkifiers_data, {
        name: "linkifiers_list",
        modifier(linkifier) {
            return _templates_settings_admin_linkifier_list_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
                linkifier: {
                    pattern: linkifier.pattern,
                    url_format_string: linkifier.url_format,
                    id: linkifier.id,
                },
                can_modify: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            });
        },
        filter: {
            $element: $linkifiers_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                return (
                    item.pattern.toLowerCase().includes(value) ||
                    item.url_format.toLowerCase().includes(value)
                );
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_10__.reset_scrollbar($linkifiers_table);
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#linkifier-settings").expectOne(),
        init_sort: [sort_pattern],
        sort_fields: {
            pattern: sort_pattern,
            url: sort_url,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#linkifier-settings .progressive-table-wrapper"),
    });
}

function set_up() {
    build_page();
    maybe_disable_widgets();
}

function build_page() {
    meta.loaded = true;

    // Populate linkifiers table
    populate_linkifiers(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_linkifiers_table").on("click", ".delete", function (e) {
        e.preventDefault();
        e.stopPropagation();
        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const html_body = _templates_confirm_dialog_confirm_delete_linkifier_hbs__WEBPACK_IMPORTED_MODULE_1___default()();
        const url = "/json/realm/filters/" + encodeURIComponent($btn.attr("data-linkifier-id"));

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_5__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete linkifier?"}),
            html_body,
            id: "confirm_delete_linkifiers_modal",
            on_click: () => _dialog_widget__WEBPACK_IMPORTED_MODULE_6__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_4__.del, url),
            loading_spinner: true,
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_linkifiers_table").on("click", ".edit", function (e) {
        e.preventDefault();
        e.stopPropagation();

        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const linkifier_id = Number.parseInt($btn.attr("data-linkifier-id"), 10);
        open_linkifier_edit_form(linkifier_id);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization form.admin-linkifier-form")
        .off("submit")
        .on("submit", function (e) {
            e.preventDefault();
            e.stopPropagation();
            const $linkifier_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-linkifier-status");
            const $pattern_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-linkifier-pattern-status");
            const $format_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-linkifier-format-status");
            const $add_linkifier_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".new-linkifier-form button");
            $add_linkifier_button.prop("disabled", true);
            $linkifier_status.hide();
            $pattern_status.hide();
            $format_status.hide();
            const linkifier = {};

            for (const obj of jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).serializeArray()) {
                linkifier[obj.name] = obj.value;
            }

            _channel__WEBPACK_IMPORTED_MODULE_4__.post({
                url: "/json/realm/filters",
                data: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).serialize(),
                success(data) {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#linkifier_pattern").val("");
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#linkifier_format_string").val("");
                    $add_linkifier_button.prop("disabled", false);
                    linkifier.id = data.id;
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Custom linkifier added!"}),
                        $linkifier_status,
                    );
                },
                error(xhr) {
                    $add_linkifier_button.prop("disabled", false);
                    handle_linkifier_api_error(
                        xhr,
                        $pattern_status,
                        $format_status,
                        $linkifier_status,
                    );
                },
            });
        });
}


/***/ }),

/***/ "./static/js/settings_muted_topics.js":
/*!********************************************!*\
  !*** ./static/js/settings_muted_topics.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "loaded": () => (/* binding */ loaded),
/* harmony export */   "populate_list": () => (/* binding */ populate_list),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_muted_topic_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/muted_topic_ui_row.hbs */ "./static/templates/muted_topic_ui_row.hbs");
/* harmony import */ var _templates_muted_topic_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_muted_topic_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
/* harmony import */ var _muted_topics_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./muted_topics_ui */ "./static/js/muted_topics_ui.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");









let loaded = false;

function populate_list() {
    const all_muted_topics = _user_topics__WEBPACK_IMPORTED_MODULE_5__.get_muted_topics();
    const $muted_topics_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted_topics_table");
    const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted_topics_search");

    _list_widget__WEBPACK_IMPORTED_MODULE_2__.create($muted_topics_table, all_muted_topics, {
        name: "muted-topics-list",
        modifier(muted_topic) {
            return _templates_muted_topic_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1___default()({muted_topic});
        },
        filter: {
            $element: $search_input,
            predicate(item, value) {
                return item.topic.toLocaleLowerCase().includes(value);
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_4__.reset_scrollbar($muted_topics_table.closest(".progressive-table-wrapper"));
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted-topic-settings"),
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted-topic-settings .progressive-table-wrapper"),
    });
}

function set_up() {
    loaded = true;
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".settings-unmute-topic", function (e) {
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest("tr");
        const stream_id = Number.parseInt($row.attr("data-stream-id"), 10);
        const topic = $row.attr("data-topic");

        e.stopPropagation();

        _muted_topics_ui__WEBPACK_IMPORTED_MODULE_3__.unmute_topic(stream_id, topic);
    });

    populate_list();
}

function reset() {
    loaded = false;
}


/***/ }),

/***/ "./static/js/settings_muted_users.js":
/*!*******************************************!*\
  !*** ./static/js/settings_muted_users.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "loaded": () => (/* binding */ loaded),
/* harmony export */   "populate_list": () => (/* binding */ populate_list),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_muted_user_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/muted_user_ui_row.hbs */ "./static/templates/muted_user_ui_row.hbs");
/* harmony import */ var _templates_muted_user_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_muted_user_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
/* harmony import */ var _muted_users_ui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./muted_users_ui */ "./static/js/muted_users_ui.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");










let loaded = false;

function populate_list() {
    const all_muted_users = _muted_users__WEBPACK_IMPORTED_MODULE_3__.get_muted_users().map((user) => ({
        user_id: user.id,
        user_name: _people__WEBPACK_IMPORTED_MODULE_5__.get_full_name(user.id),
        date_muted_str: user.date_muted_str,
    }));
    const $muted_users_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted_users_table");
    const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted_users_search");

    _list_widget__WEBPACK_IMPORTED_MODULE_2__.create($muted_users_table, all_muted_users, {
        name: "muted-users-list",
        modifier(muted_user) {
            return _templates_muted_user_ui_row_hbs__WEBPACK_IMPORTED_MODULE_1___default()({muted_user});
        },
        filter: {
            $element: $search_input,
            predicate(item, value) {
                return item.user_name.toLocaleLowerCase().includes(value);
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_6__.reset_scrollbar($muted_users_table.closest(".progressive-table-wrapper"));
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted-user-settings"),
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#muted-user-settings .progressive-table-wrapper"),
    });
}

function set_up() {
    loaded = true;
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".settings-unmute-user", function (e) {
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest("tr");
        const user_id = Number.parseInt($row.attr("data-user-id"), 10);

        e.stopPropagation();
        _muted_users_ui__WEBPACK_IMPORTED_MODULE_4__.unmute_user(user_id);
    });

    populate_list();
}

function reset() {
    loaded = false;
}


/***/ }),

/***/ "./static/js/settings_notifications.js":
/*!*********************************************!*\
  !*** ./static/js/settings_notifications.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "set_enable_digest_emails_visibility": () => (/* binding */ set_enable_digest_emails_visibility),
/* harmony export */   "set_enable_marketing_emails_visibility": () => (/* binding */ set_enable_marketing_emails_visibility),
/* harmony export */   "set_notification_batching_ui": () => (/* binding */ set_notification_batching_ui),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_muted_stream_state": () => (/* binding */ update_muted_stream_state),
/* harmony export */   "update_page": () => (/* binding */ update_page),
/* harmony export */   "user_settings_panel": () => (/* binding */ user_settings_panel)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_stream_specific_notification_row_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings/stream_specific_notification_row.hbs */ "./static/templates/settings/stream_specific_notification_row.hbs");
/* harmony import */ var _templates_settings_stream_specific_notification_row_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_stream_specific_notification_row_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_edit__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_edit */ "./static/js/stream_edit.js");
/* harmony import */ var _stream_settings_data__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_settings_data */ "./static/js/stream_settings_data.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



















const user_settings_panel = {};

function rerender_ui() {
    const $unmatched_streams_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-specific-notify-table");
    if ($unmatched_streams_table.length === 0) {
        // If we haven't rendered "notification settings" yet, do nothing.
        return;
    }

    const unmatched_streams =
        _stream_settings_data__WEBPACK_IMPORTED_MODULE_9__.get_unmatched_streams_for_notification_settings();

    $unmatched_streams_table.find(".stream-notifications-row").remove();

    const muted_stream_ids = _stream_data__WEBPACK_IMPORTED_MODULE_7__.muted_stream_ids();

    for (const stream of unmatched_streams) {
        $unmatched_streams_table.append(
            _templates_settings_stream_specific_notification_row_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                stream,
                stream_specific_notification_settings:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                is_disabled:
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))
                        .show_push_notifications_tooltip,
                muted: muted_stream_ids.includes(stream.stream_id),
            }),
        );
    }

    if (unmatched_streams.length === 0) {
        $unmatched_streams_table.css("display", "none");
    } else {
        $unmatched_streams_table.css("display", "table-row-group");
    }
}

function change_notification_setting(setting, value, status_element) {
    const data = {};
    data[setting] = value;
    _settings_ui__WEBPACK_IMPORTED_MODULE_6__.do_settings_change(_channel__WEBPACK_IMPORTED_MODULE_2__.patch, "/json/settings", data, status_element);
}

function update_desktop_icon_count_display(settings_panel) {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container);
    const settings_object = settings_panel.settings_object;
    $container
        .find(".setting_desktop_icon_count_display")
        .val(settings_object.desktop_icon_count_display);
    if (!settings_panel.for_realm_settings) {
        _unread_ui__WEBPACK_IMPORTED_MODULE_11__.update_unread_counts();
    }
}

function set_notification_batching_ui($container, setting_seconds, force_custom) {
    const $edit_elem = $container.find(".email_notification_batching_period_edit_minutes");
    const valid_period_values = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        (x) => x.value,
    );

    // We display the custom widget if either the user just selected
    // custom_period, or the current value cannot be represented with
    // the existing set of values.
    const show_edit_elem = force_custom || !valid_period_values.includes(setting_seconds);
    const select_elem_val = show_edit_elem ? "custom_period" : setting_seconds;

    $container.find(".setting_email_notifications_batching_period_seconds").val(select_elem_val);
    $edit_elem.val(setting_seconds / 60);
    _settings_org__WEBPACK_IMPORTED_MODULE_5__.change_element_block_display_property($edit_elem.attr("id"), show_edit_elem);
}

function set_enable_digest_emails_visibility(settings_panel) {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container);
    const for_realm_settings = settings_panel.for_realm_settings;
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        if (for_realm_settings) {
            $container.find(".other_email_notifications").show();
            return;
        }
        $container.find(".enable_digest_emails_label").parent().show();
    } else {
        if (for_realm_settings) {
            $container.find(".other_email_notifications").hide();
            return;
        }
        $container.find(".enable_digest_emails_label").parent().hide();
    }
}

function set_enable_marketing_emails_visibility() {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-notification-settings");
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        $container.find(".enable_marketing_emails_label").parent().show();
    } else {
        $container.find(".enable_marketing_emails_label").parent().hide();
    }
}

function set_up(settings_panel) {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container);
    const settings_object = settings_panel.settings_object;
    const $notification_sound_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.notification_sound_elem);
    const for_realm_settings = settings_panel.for_realm_settings;

    $container.find(".play_notification_sound").on("click", () => {
        if (settings_object.notification_sound !== "none") {
            $notification_sound_elem[0].play();
        }
    });

    update_desktop_icon_count_display(settings_panel);

    const $notification_sound_dropdown = $container.find(".setting_notification_sound");
    $notification_sound_dropdown.val(settings_object.notification_sound);

    $container.find(".enable_sounds, .enable_stream_audible_notifications").on("change", () => {
        if (
            $container.find(".enable_stream_audible_notifications").prop("checked") ||
            $container.find(".enable_sounds").prop("checked")
        ) {
            $notification_sound_dropdown.prop("disabled", false);
            $notification_sound_dropdown.parent().removeClass("control-label-disabled");
        } else {
            $notification_sound_dropdown.prop("disabled", true);
            $notification_sound_dropdown.parent().addClass("control-label-disabled");
        }
    });

    set_notification_batching_ui(
        $container,
        settings_object.email_notifications_batching_period_seconds,
    );

    set_enable_digest_emails_visibility(settings_panel);

    if (for_realm_settings) {
        // For the realm-level defaults page, we use the common
        // settings_org.js handlers, so we can return early here.
        return;
    }

    // Common handler for sending requests to the server when an input
    // element is changed.
    $container.find(".notification-settings-form").on("change", "input, select", function (e) {
        e.preventDefault();
        e.stopPropagation();
        const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget);
        if ($input_elem.parents("#stream-specific-notify-table").length) {
            _stream_edit__WEBPACK_IMPORTED_MODULE_8__.stream_setting_changed(e, true);
            return;
        }
        let setting_name = $input_elem.attr("name");
        let setting_value = _settings_org__WEBPACK_IMPORTED_MODULE_5__.get_input_element_value(this);

        if (setting_name === "email_notifications_batching_period_seconds") {
            if ($input_elem.val() === "custom_period") {
                set_notification_batching_ui(
                    $container,
                    settings_object.email_notifications_batching_period_seconds,
                    true,
                );
                return;
            }
            set_notification_batching_ui($container, setting_value);
        } else if (setting_name === "email_notification_batching_period_edit_minutes") {
            // This field is in minutes, but the actual setting is seconds
            setting_value = setting_value * 60;
            set_notification_batching_ui($container, setting_value);
            setting_name = "email_notifications_batching_period_seconds";
        }

        change_notification_setting(
            setting_name,
            setting_value,
            $input_elem.closest(".subsection-parent").find(".alert-notification"),
        );
    });

    // This final patch of settings are ones for which we
    // intentionally don't let organization administrators set
    // organization-level defaults.
    $container.find(".send_test_notification").on("click", () => {
        _notifications__WEBPACK_IMPORTED_MODULE_4__.send_test_notification(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "This is what a Zulip notification looks like."}),
        );
    });

    set_enable_marketing_emails_visibility();
    rerender_ui();
}

function update_page(settings_panel) {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_panel.container);
    const settings_object = settings_panel.settings_object;
    for (const setting of Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        switch (setting) {
            case "enable_offline_push_notifications": {
                if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                    // If push notifications are disabled at the realm level,
                    // we should just leave the checkbox always off.
                    break;
                }
                $container
                    .find(`.${CSS.escape(setting)}`)
                    .prop("checked", settings_object[setting]);
                break;
            }
            case "desktop_icon_count_display": {
                update_desktop_icon_count_display(settings_panel);
                break;
            }
            case "email_notifications_batching_period_seconds": {
                set_notification_batching_ui($container, settings_object[setting]);
                break;
            }
            case "notification_sound": {
                $container.find(`.setting_${CSS.escape(setting)}`).val(settings_object[setting]);
                break;
            }
            default: {
                $container
                    .find(`.${CSS.escape(setting)}`)
                    .prop("checked", settings_object[setting]);
                break;
            }
        }
    }
    rerender_ui();
}

function update_muted_stream_state(sub) {
    const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#stream-specific-notify-table .stream-notifications-row[data-stream-id='${CSS.escape(
            sub.stream_id,
        )}']`,
    );

    $row.toggleClass("control-label-disabled", sub.is_muted);
    if (sub.is_muted) {
        $row.find(".unmute_stream").show();
    } else {
        $row.find(".unmute_stream").hide();
    }
    $row.find("input").prop("disabled", sub.is_muted);
    $row.find('[name="push_notifications"]').prop(
        "disabled",
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || sub.is_muted,
    );
}

function initialize() {
    user_settings_panel.container = "#user-notification-settings";
    user_settings_panel.settings_object = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    user_settings_panel.notification_sound_elem = "#user-notification-sound-audio";
    user_settings_panel.for_realm_settings = false;

    // Set up click handler for unmuting streams via this UI.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#stream-specific-notify-table .unmute_stream", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest(".stream-notifications-row");
        const stream_id = Number.parseInt($row.attr("data-stream-id"), 10);
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_10__.set_muted(
            sub,
            !sub.is_muted,
            $row.closest(".subsection-parent").find(".alert-notification"),
        );
    });
}


/***/ }),

/***/ "./static/js/settings_org.js":
/*!***********************************!*\
  !*** ./static/js/settings_org.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "change_element_block_display_property": () => (/* binding */ change_element_block_display_property),
/* harmony export */   "change_save_button_state": () => (/* binding */ change_save_button_state),
/* harmony export */   "check_property_changed": () => (/* binding */ check_property_changed),
/* harmony export */   "default_code_language_widget": () => (/* binding */ default_code_language_widget),
/* harmony export */   "discard_property_element_changes": () => (/* binding */ discard_property_element_changes),
/* harmony export */   "extract_property_name": () => (/* binding */ extract_property_name),
/* harmony export */   "get_input_element_value": () => (/* binding */ get_input_element_value),
/* harmony export */   "get_org_type_dropdown_options": () => (/* binding */ get_org_type_dropdown_options),
/* harmony export */   "get_organization_settings_options": () => (/* binding */ get_organization_settings_options),
/* harmony export */   "get_realm_time_limits_in_minutes": () => (/* binding */ get_realm_time_limits_in_minutes),
/* harmony export */   "get_sorted_options_list": () => (/* binding */ get_sorted_options_list),
/* harmony export */   "get_subsection_property_elements": () => (/* binding */ get_subsection_property_elements),
/* harmony export */   "init_dropdown_widgets": () => (/* binding */ init_dropdown_widgets),
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "notifications_stream_widget": () => (/* binding */ notifications_stream_widget),
/* harmony export */   "parse_time_limit": () => (/* binding */ parse_time_limit),
/* harmony export */   "populate_auth_methods": () => (/* binding */ populate_auth_methods),
/* harmony export */   "populate_data_for_request": () => (/* binding */ populate_data_for_request),
/* harmony export */   "populate_realm_domains_label": () => (/* binding */ populate_realm_domains_label),
/* harmony export */   "register_save_discard_widget_handlers": () => (/* binding */ register_save_discard_widget_handlers),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "save_discard_widget_status_handler": () => (/* binding */ save_discard_widget_status_handler),
/* harmony export */   "save_organization_settings": () => (/* binding */ save_organization_settings),
/* harmony export */   "set_input_element_value": () => (/* binding */ set_input_element_value),
/* harmony export */   "set_message_retention_setting_dropdown": () => (/* binding */ set_message_retention_setting_dropdown),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "signup_notifications_stream_widget": () => (/* binding */ signup_notifications_stream_widget),
/* harmony export */   "sync_realm_settings": () => (/* binding */ sync_realm_settings)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_realm_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_realm.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_realm.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_realm_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_realm_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_admin_auth_methods_list_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/admin_auth_methods_list.hbs */ "./static/templates/settings/admin_auth_methods_list.hbs");
/* harmony import */ var _templates_settings_admin_auth_methods_list_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_auth_methods_list_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dropdown_list_widget */ "./static/js/dropdown_list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _realm_icon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./realm_icon */ "./static/js/realm_icon.js");
/* harmony import */ var _realm_logo__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./realm_logo */ "./static/js/realm_logo.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _settings_realm_domains__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_realm_domains */ "./static/js/settings_realm_domains.js");
/* harmony import */ var _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./settings_realm_user_settings_defaults */ "./static/js/settings_realm_user_settings_defaults.js");
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_edit__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./stream_edit */ "./static/js/stream_edit.js");
/* harmony import */ var _stream_settings_data__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./stream_settings_data */ "./static/js/stream_settings_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


// import pygments_data from "../generated/pygments_data.json";

























const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function maybe_disable_widgets() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='auth-methods']")
        .find("input, button, select, checked")
        .prop("disabled", true);

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#deactivate_realm_button").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-message-retention").find("input, select").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-join-settings").find("input, select").prop("disabled", true);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_invite_required_label").parent().addClass("control-label-disabled");
        return;
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-profile']")
        .find("input, textarea, button, select")
        .prop("disabled", true);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-settings']")
        .find("input, textarea, button, select")
        .prop("disabled", true);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-settings']")
        .find(".dropdown_list_reset_button")
        .hide();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-settings']")
        .find(".control-label-disabled")
        .addClass("enabled");

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-permissions']")
        .find("input, textarea, button, select")
        .prop("disabled", true);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-permissions']")
        .find(".control-label-disabled")
        .addClass("enabled");
}

function get_sorted_options_list(option_values_object) {
    const options_list = Object.keys(option_values_object).map((key) => ({
        ...option_values_object[key],
        key,
    }));
    let comparator = (x, y) => x.order - y.order;
    if (!options_list[0].order) {
        comparator = (x, y) => {
            const key_x = x.key.toUpperCase();
            const key_y = y.key.toUpperCase();
            if (key_x < key_y) {
                return -1;
            }
            if (key_x > key_y) {
                return 1;
            }
            return 0;
        };
    }
    options_list.sort(comparator);
    return options_list;
}

function get_organization_settings_options() {
    const options = {};
    options.common_policy_values = get_sorted_options_list(Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    options.private_message_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    options.wildcard_mention_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    options.common_message_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    options.invite_to_realm_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    options.edit_topic_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    options.move_messages_between_streams_policy_values = get_sorted_options_list(
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
    return options;
}

function get_org_type_dropdown_options() {
    const current_org_type = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    if (current_org_type !== 0) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
}

function get_realm_time_limits_in_minutes(property) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property] === null) {
        // This represents "Anytime" case.
        return null;
    }
    let val = (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property] / 60).toFixed(1);
    if (Number.parseFloat(val, 10) === Number.parseInt(val, 10)) {
        val = Number.parseInt(val, 10);
    }
    return val.toString();
}

function get_property_value(property_name, for_realm_default_settings, sub) {
    if (for_realm_default_settings) {
        // realm_user_default_settings are stored in a separate object.
        if (property_name === "twenty_four_hour_time") {
            return JSON.stringify(Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        }
        if (
            property_name === "email_notifications_batching_period_seconds" ||
            property_name === "email_notification_batching_period_edit_minutes"
        ) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        }
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property_name];
    }

    if (sub) {
        if (property_name === "stream_privacy") {
            return _stream_data__WEBPACK_IMPORTED_MODULE_13__.get_stream_privacy_policy(sub.stream_id);
        }

        return sub[property_name];
    }

    if (property_name === "realm_waiting_period_setting") {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 0) {
            return "none";
        }
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 3) {
            return "three_days";
        }
        return "custom_days";
    }

    if (property_name === "realm_org_join_restrictions") {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            return "only_selected_domain";
        }
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            return "no_disposable_email";
        }
        return "no_restriction";
    }

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property_name];
}

function extract_property_name($elem, for_realm_default_settings) {
    if (for_realm_default_settings) {
        // ID for realm_user_default_settings elements are of the form
        // "realm_{settings_name}}" because both user and realm default
        // settings use the same template and each element should have
        // unique id.
        return /^realm_(.*)$/.exec($elem.attr("id").replace(/-/g, "_"))[1];
    }

    if ($elem.attr("id").startsWith("id_authmethod")) {
        // Authentication Method component IDs include authentication method name
        // for uniqueness, anchored to "id_authmethod" prefix, e.g. "id_authmethodapple_<property_name>".
        // We need to strip that whole construct down to extract the actual property name.
        // The [\da-z]+ part of the regexp covers the auth method name itself.
        // We assume it's not an empty string and can contain only digits and lowercase ASCII letters,
        // this is ensured by a respective allowlist-based filter in populate_auth_methods().
        return /^id_authmethod[\da-z]+_(.*)$/.exec($elem.attr("id"))[1];
    }

    return /^id_(.*)$/.exec($elem.attr("id").replace(/-/g, "_"))[1];
}

function get_subsection_property_elements(subsection) {
    return Array.from(jquery__WEBPACK_IMPORTED_MODULE_0___default()(subsection).find(".prop-element"));
}

const simple_dropdown_properties = [
    "realm_create_private_stream_policy",
    "realm_create_public_stream_policy",
    "realm_create_web_public_stream_policy",
    "realm_invite_to_stream_policy",
    "realm_user_group_edit_policy",
    "realm_private_message_policy",
    "realm_add_custom_emoji_policy",
    "realm_invite_to_realm_policy",
    "realm_wildcard_mention_policy",
    "realm_move_messages_between_streams_policy",
    "realm_edit_topic_policy",
    "realm_org_type",
];

function set_property_dropdown_value(property_name) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(property_name)}`).val(get_property_value(property_name));
}

function change_element_block_display_property(elem_id, show_element) {
    const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(elem_id)}`);
    if (show_element) {
        $elem.parent().show();
    } else {
        $elem.parent().hide();
    }
}

function set_realm_waiting_period_dropdown() {
    const value = get_property_value("realm_waiting_period_setting");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_waiting_period_setting").val(value);
    change_element_block_display_property(
        "id_realm_waiting_period_threshold",
        value === "custom_days",
    );
}

function set_video_chat_provider_dropdown() {
    const chat_provider_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_video_chat_provider").val(chat_provider_id);
}

function set_giphy_rating_dropdown() {
    const rating_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_giphy_rating").val(rating_id);
}

function update_message_edit_sub_settings(is_checked) {
    _settings_ui__WEBPACK_IMPORTED_MODULE_12__.disable_sub_setting_onchange(
        is_checked,
        "id_realm_message_content_edit_limit_seconds",
        true,
    );
    _settings_ui__WEBPACK_IMPORTED_MODULE_12__.disable_sub_setting_onchange(
        is_checked,
        "id_realm_message_content_edit_limit_minutes",
        true,
    );
}

function update_custom_value_input(property_name) {
    const $dropdown_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(property_name)}`);
    const custom_input_elem_id = $dropdown_elem
        .parent()
        .find(".admin-realm-time-limit-input")
        .attr("id");

    const show_custom_limit_input = $dropdown_elem.val() === "custom_period";
    change_element_block_display_property(custom_input_elem_id, show_custom_limit_input);
    if (show_custom_limit_input) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(custom_input_elem_id)}`).val(
            get_realm_time_limits_in_minutes(property_name),
        );
    }
}

function get_time_limit_dropdown_setting_value(property_name) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property_name] === null) {
        return "any_time";
    }

    const valid_limit_values = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())((x) => x.value);
    if (valid_limit_values.includes(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property_name])) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property_name].toString();
    }

    return "custom_period";
}

function set_time_limit_setting(property_name) {
    const dropdown_elem_val = get_time_limit_dropdown_setting_value(property_name);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(property_name)}`).val(dropdown_elem_val);

    const $custom_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(property_name)}`)
        .parent()
        .find(".admin-realm-time-limit-input");
    $custom_input.val(get_realm_time_limits_in_minutes(property_name));

    change_element_block_display_property(
        $custom_input.attr("id"),
        dropdown_elem_val === "custom_period",
    );
}

function set_msg_edit_limit_dropdown() {
    set_time_limit_setting("realm_message_content_edit_limit_seconds");
}

function message_delete_limit_setting_enabled(setting_value) {
    // This function is used to check whether the time-limit setting
    // should be enabled. The setting is disabled when delete_own_message_policy
    // is set to 'admins only' as admins can delete messages irrespective of
    // time limit.
    if (setting_value === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }
    return true;
}

function set_delete_own_message_policy_dropdown(setting_value) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_delete_own_message_policy").val(setting_value);
    _settings_ui__WEBPACK_IMPORTED_MODULE_12__.disable_sub_setting_onchange(
        message_delete_limit_setting_enabled(setting_value),
        "id_realm_message_content_delete_limit_seconds",
        true,
    );
    const limit_setting_dropdown_value = get_time_limit_dropdown_setting_value(
        "realm_message_content_delete_limit_seconds",
    );
    if (limit_setting_dropdown_value === "custom_period") {
        _settings_ui__WEBPACK_IMPORTED_MODULE_12__.disable_sub_setting_onchange(
            message_delete_limit_setting_enabled(setting_value),
            "id_realm_message_content_delete_limit_minutes",
            true,
        );
    }
}

function set_msg_delete_limit_dropdown() {
    set_time_limit_setting("realm_message_content_delete_limit_seconds");
}

function get_message_retention_setting_value($input_elem, for_api_data = true) {
    const select_elem_val = $input_elem.val();
    if (select_elem_val === "unlimited") {
        if (!for_api_data) {
            return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        }
        return JSON.stringify("unlimited");
    }

    if (select_elem_val === "realm_default") {
        if (!for_api_data) {
            return null;
        }
        return JSON.stringify("realm_default");
    }

    const $custom_input = $input_elem.parent().find(".message-retention-setting-custom-input");
    if ($custom_input.val().length === 0) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    }
    return Number.parseInt($custom_input.val(), 10);
}

function get_dropdown_value_for_message_retention_setting(setting_value) {
    if (setting_value === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return "unlimited";
    }

    if (setting_value === null) {
        return "realm_default";
    }

    return "custom_period";
}

function set_message_retention_setting_dropdown(sub) {
    let property_name = "realm_message_retention_days";
    if (sub !== undefined) {
        property_name = "message_retention_days";
    }
    const setting_value = get_property_value(property_name, false, sub);
    const dropdown_val = get_dropdown_value_for_message_retention_setting(setting_value);

    const $dropdown_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(property_name)}`);
    $dropdown_elem.val(dropdown_val);

    const $custom_input_elem = $dropdown_elem
        .parent()
        .find(".message-retention-setting-custom-input")
        .val("");
    if (dropdown_val === "custom_period") {
        $custom_input_elem.val(setting_value);
    }

    change_element_block_display_property(
        $custom_input_elem.attr("id"),
        dropdown_val === "custom_period",
    );
}

function set_org_join_restrictions_dropdown() {
    const value = get_property_value("realm_org_join_restrictions");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_org_join_restrictions").val(value);
    change_element_block_display_property(
        "allowed_domains_label",
        value === "only_selected_domain",
    );
}

function set_message_content_in_email_notifications_visiblity() {
    change_element_block_display_property(
        "message_content_in_email_notifications_label",
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function set_digest_emails_weekday_visibility() {
    change_element_block_display_property(
        "id_realm_digest_weekday",
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function set_create_web_public_stream_dropdown_visibility() {
    change_element_block_display_property(
        "id_realm_create_web_public_stream_policy",
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    );
}

function populate_realm_domains_label(realm_domains) {
    if (!meta.loaded) {
        return;
    }

    const domains_list = realm_domains.map((realm_domain) =>
        realm_domain.allow_subdomains ? "*." + realm_domain.domain : realm_domain.domain,
    );
    let domains = domains_list.join(", ");
    if (domains.length === 0) {
        domains = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "None"});
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#allowed_domains_label").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Allowed domains: {domains}"}, {domains}));
}

function sort_object_by_key(obj) {
    const keys = Object.keys(obj).sort();
    const new_obj = {};

    for (const key of keys) {
        new_obj[key] = obj[key];
    }

    return new_obj;
}

function populate_auth_methods(auth_methods) {
    if (!meta.loaded) {
        return;
    }
    const $auth_methods_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_authentication_methods").expectOne();
    auth_methods = sort_object_by_key(auth_methods);
    let rendered_auth_method_rows = "";
    for (const [auth_method, value] of Object.entries(auth_methods)) {
        rendered_auth_method_rows += _templates_settings_admin_auth_methods_list_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
            method: auth_method,
            enabled: value,
            is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            // The negated character class regexp serves as an allowlist - the replace() will
            // remove *all* symbols *but* digits (\d) and lowecase letters (a-z),
            // so that we can make assumptions on this string elsewhere in the code.
            // As a result, the only two "incoming" assumptions on the auth method name are:
            // 1) It contains at least one allowed symbol
            // 2) No two auth method names are identical after this allowlist filtering
            prefix: "id_authmethod" + auth_method.toLowerCase().replace(/[^\da-z]/g, "") + "_",
        });
    }
    $auth_methods_list.html(rendered_auth_method_rows);
}

function update_dependent_subsettings(property_name) {
    if (simple_dropdown_properties.includes(property_name)) {
        set_property_dropdown_value(property_name);
        return;
    }

    switch (property_name) {
        case "realm_waiting_period_threshold":
            set_realm_waiting_period_dropdown();
            break;
        case "realm_video_chat_provider":
            set_video_chat_provider_dropdown();
            break;
        case "realm_allow_message_editing":
            update_message_edit_sub_settings(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            break;
        case "realm_delete_own_message_policy":
            set_delete_own_message_policy_dropdown(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
            break;
        case "realm_org_join_restrictions":
            set_org_join_restrictions_dropdown();
            break;
        case "realm_message_content_allowed_in_email_notifications":
            set_message_content_in_email_notifications_visiblity();
            break;
        case "realm_digest_emails_enabled":
            _settings_notifications__WEBPACK_IMPORTED_MODULE_9__.set_enable_digest_emails_visibility(
                _settings_notifications__WEBPACK_IMPORTED_MODULE_9__.user_settings_panel,
            );
            _settings_notifications__WEBPACK_IMPORTED_MODULE_9__.set_enable_digest_emails_visibility(
                _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_11__.realm_default_settings_panel,
            );
            set_digest_emails_weekday_visibility();
            break;
        case "realm_enable_spectator_access":
            set_create_web_public_stream_dropdown_visibility();
            break;
    }
}

let default_code_language_widget = null;
let notifications_stream_widget = null;
let signup_notifications_stream_widget = null;

function discard_property_element_changes(elem, for_realm_default_settings, sub) {
    const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem);
    const property_name = extract_property_name($elem, for_realm_default_settings);
    const property_value = get_property_value(property_name, for_realm_default_settings, sub);

    switch (property_name) {
        case "realm_authentication_methods":
            populate_auth_methods(property_value);
            break;
        case "realm_notifications_stream_id":
            notifications_stream_widget.render(property_value);
            break;
        case "realm_signup_notifications_stream_id":
            signup_notifications_stream_widget.render(property_value);
            break;
        case "realm_default_code_block_language":
            default_code_language_widget.render(property_value);
            break;
        case "realm_default_language":
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-notifications .language_selection_widget .language_selection_button span").attr(
                "data-language-code",
                property_value,
            );
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-notifications .language_selection_widget .language_selection_button span").text(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(property_value),
            );
            break;
        case "emojiset":
        case "user_list_style":
        case "stream_privacy":
            // Because this widget has a radio button structure, it
            // needs custom reset code.
            $elem.find(`input[value='${CSS.escape(property_value)}']`).prop("checked", true);
            break;
        case "email_notifications_batching_period_seconds":
        case "email_notification_batching_period_edit_minutes":
            _settings_notifications__WEBPACK_IMPORTED_MODULE_9__.set_notification_batching_ui(
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm-user-default-settings"),
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            );
            break;
        case "realm_org_type":
            set_input_element_value($elem, property_value);
            // Remove 'unspecified' option (value=0) from realm_org_type
            // dropdown menu options whenever page_params.realm_org_type
            // returns another value.
            if (property_value !== 0) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_org_type option[value=0]").remove();
            }
            break;
        case "realm_message_content_edit_limit_seconds":
        case "realm_message_content_delete_limit_seconds":
            set_time_limit_setting(property_name);
            break;
        case "realm_message_retention_days":
        case "message_retention_days":
            set_message_retention_setting_dropdown(sub);
            break;
        default:
            if (property_value !== undefined) {
                set_input_element_value($elem, property_value);
            } else {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Element refers to unknown property " + property_name);
            }
    }

    update_dependent_subsettings(property_name);
}

function sync_realm_settings(property) {
    if (!meta.loaded) {
        return;
    }

    const value = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[`realm_${property}`];
    switch (property) {
        case "notifications_stream_id":
            notifications_stream_widget.render(value);
            break;
        case "signup_notifications_stream_id":
            signup_notifications_stream_widget.render(value);
            break;
        case "default_code_block_language":
            default_code_language_widget.render(value);
            break;
    }

    switch (property) {
        case "emails_restricted_to_domains":
        case "disallow_disposable_email_addresses":
            property = "org_join_restrictions";
            break;
    }
    const $element = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_realm_${CSS.escape(property)}`);
    if ($element.length) {
        discard_property_element_changes($element);
    }
}

function change_save_button_state($element, state) {
    function show_hide_element($element, show, fadeout_delay, fadeout_callback) {
        if (show) {
            $element.removeClass("hide").addClass(".show").fadeIn(300);
            return;
        }
        setTimeout(() => {
            $element.fadeOut(300, fadeout_callback);
        }, fadeout_delay);
    }

    const $saveBtn = $element.find(".save-button");
    const $textEl = $saveBtn.find(".save-discard-widget-button-text");

    if (state !== "saving") {
        $saveBtn.removeClass("saving");
    }

    if (state === "discarded") {
        show_hide_element($element, false, 0, () =>
            enable_or_disable_save_button($element.closest(".settings-subsection-parent")),
        );
        return;
    }

    let button_text;
    let data_status;
    let is_show;
    switch (state) {
        case "unsaved":
            button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save changes"});
            data_status = "unsaved";
            is_show = true;

            $element.find(".discard-button").show();
            break;
        case "saved":
            button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save changes"});
            data_status = "";
            is_show = false;
            break;
        case "saving":
            button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Saving"});
            data_status = "saving";
            is_show = true;

            $element.find(".discard-button").hide();
            $saveBtn.addClass("saving");
            break;
        case "failed":
            button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save changes"});
            data_status = "failed";
            is_show = true;
            break;
        case "succeeded":
            button_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Saved"});
            data_status = "saved";
            is_show = false;
            break;
    }

    $textEl.text(button_text);
    $saveBtn.attr("data-status", data_status);
    if (state === "unsaved") {
        enable_or_disable_save_button($element.closest(".settings-subsection-parent"));
    }
    show_hide_element($element, is_show, 800);
}

function save_organization_settings(data, $save_button, patch_url) {
    const $subsection_parent = $save_button.closest(".settings-subsection-parent");
    const $save_btn_container = $subsection_parent.find(".save-button-controls");
    const $failed_alert_elem = $subsection_parent.find(".subsection-failed-status p");
    change_save_button_state($save_btn_container, "saving");
    _channel__WEBPACK_IMPORTED_MODULE_4__.patch({
        url: patch_url,
        data,
        success() {
            $failed_alert_elem.hide();
            change_save_button_state($save_btn_container, "succeeded");
        },
        error(xhr) {
            change_save_button_state($save_btn_container, "failed");
            $save_button.hide();
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save failed"}), xhr, $failed_alert_elem);
        },
    });
}

function get_input_type($input_elem, input_type) {
    if (["boolean", "string", "number"].includes(input_type)) {
        return input_type;
    }
    return $input_elem.data("setting-widget-type");
}

function get_input_element_value(input_elem, input_type) {
    const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(input_elem);
    input_type = get_input_type($input_elem, input_type);
    switch (input_type) {
        case "boolean":
            return $input_elem.prop("checked");
        case "string":
            return $input_elem.val().trim();
        case "number":
            return Number.parseInt($input_elem.val().trim(), 10);
        case "radio-group": {
            const selected_val = $input_elem.find("input:checked").val();
            if ($input_elem.data("setting-choice-type") === "number") {
                return Number.parseInt(selected_val, 10);
            }
            return selected_val.trim();
        }
        case "time-limit":
            return get_time_limit_setting_value($input_elem);
        case "message-retention-setting":
            return get_message_retention_setting_value($input_elem);
        default:
            return undefined;
    }
}

function set_input_element_value($input_elem, value) {
    const input_type = get_input_type($input_elem, typeof value);
    if (input_type) {
        if (input_type === "boolean") {
            return $input_elem.prop("checked", value);
        } else if (input_type === "string" || input_type === "number") {
            return $input_elem.val(value);
        }
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Failed to set value of property ${extract_property_name($input_elem)}`);
    return undefined;
}

function set_up() {
    build_page();
    maybe_disable_widgets();
}

function get_auth_method_list_data() {
    const new_auth_methods = {};
    const $auth_method_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_authentication_methods").find("div.method_row");

    for (const method_row of $auth_method_rows) {
        new_auth_methods[jquery__WEBPACK_IMPORTED_MODULE_0___default()(method_row).data("method")] = jquery__WEBPACK_IMPORTED_MODULE_0___default()(method_row)
            .find("input")
            .prop("checked");
    }

    return new_auth_methods;
}

function parse_time_limit($elem) {
    return Math.floor(Number.parseFloat(Number($elem.val()), 10).toFixed(1) * 60);
}

function get_time_limit_setting_value($input_elem, for_api_data = true) {
    const select_elem_val = $input_elem.val();

    if (select_elem_val === "any_time") {
        // "unlimited" is sent to API when a user wants to set the setting to
        // "Any time" and the message_content_edit_limit_seconds field is "null"
        // for that case.
        if (!for_api_data) {
            return null;
        }
        return JSON.stringify("unlimited");
    }

    if (select_elem_val !== "custom_period") {
        return Number.parseInt(select_elem_val, 10);
    }

    const $custom_input_elem = $input_elem.parent().find(".admin-realm-time-limit-input");
    if ($custom_input_elem.val().length === 0) {
        // This handles the case where the initial setting value is "Any time" and then
        // dropdown is changed to "Custom" where the input box is empty initially and
        // thus we do not show the save-discard widget until something is typed in the
        // input box.
        return null;
    }
    return parse_time_limit($custom_input_elem);
}

function check_property_changed(elem, for_realm_default_settings, sub) {
    const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem);
    const property_name = extract_property_name($elem, for_realm_default_settings);
    let current_val = get_property_value(property_name, for_realm_default_settings, sub);
    let proposed_val;

    switch (property_name) {
        case "realm_authentication_methods":
            current_val = sort_object_by_key(current_val);
            current_val = JSON.stringify(current_val);
            proposed_val = get_auth_method_list_data();
            proposed_val = JSON.stringify(proposed_val);
            break;
        case "realm_notifications_stream_id":
            proposed_val = Number.parseInt(notifications_stream_widget.value(), 10);
            break;
        case "realm_signup_notifications_stream_id":
            proposed_val = Number.parseInt(signup_notifications_stream_widget.value(), 10);
            break;
        case "realm_default_code_block_language":
            proposed_val = default_code_language_widget.value();
            if (proposed_val.length === 0) {
                proposed_val = null;
            }
            break;
        case "email_notifications_batching_period_seconds":
            proposed_val = get_time_limit_setting_value($elem, false);
            break;
        case "realm_message_content_edit_limit_seconds":
        case "realm_message_content_delete_limit_seconds":
            proposed_val = get_time_limit_setting_value($elem, false);
            break;
        case "realm_message_retention_days":
        case "message_retention_days":
            proposed_val = get_message_retention_setting_value($elem, false);
            break;
        case "realm_default_language":
            proposed_val = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                "#org-notifications .language_selection_widget .language_selection_button span",
            ).attr("data-language-code");
            break;
        case "emojiset":
        case "user_list_style":
        case "stream_privacy":
            proposed_val = get_input_element_value($elem, "radio-group");
            break;
        default:
            if (current_val !== undefined) {
                proposed_val = get_input_element_value($elem, typeof current_val);
            } else {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Element refers to unknown property " + property_name);
            }
    }
    return current_val !== proposed_val;
}

function save_discard_widget_status_handler($subsection, for_realm_default_settings, sub) {
    $subsection.find(".subsection-failed-status p").hide();
    $subsection.find(".save-button").show();
    const properties_elements = get_subsection_property_elements($subsection);
    const show_change_process_button = properties_elements.some((elem) =>
        check_property_changed(elem, for_realm_default_settings, sub),
    );

    const $save_btn_controls = $subsection.find(".subsection-header .save-button-controls");
    const button_state = show_change_process_button ? "unsaved" : "discarded";
    change_save_button_state($save_btn_controls, button_state);
}

function init_dropdown_widgets() {
    const streams = _stream_settings_data__WEBPACK_IMPORTED_MODULE_15__.get_streams_for_settings_page();
    const notification_stream_options = {
        data: streams.map((x) => ({
            name: x.name,
            value: x.stream_id.toString(),
        })),
        on_update() {
            save_discard_widget_status_handler(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-notifications"));
        },
        default_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Disabled"}),
        render_text: (x) => `#${x}`,
        null_value: -1,
    };
    notifications_stream_widget = new _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_6__.DropdownListWidget({
        widget_name: "realm_notifications_stream_id",
        value: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        ...notification_stream_options,
    });
    notifications_stream_widget.setup();
    signup_notifications_stream_widget = new _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_6__.DropdownListWidget({
        widget_name: "realm_signup_notifications_stream_id",
        value: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        ...notification_stream_options,
    });
    signup_notifications_stream_widget.setup();
    default_code_language_widget = new _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_6__.DropdownListWidget({
        widget_name: "realm_default_code_block_language",
        data: Object.keys(pygments_data.langs).map((x) => ({
            name: x,
            value: x,
        })),
        value: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        on_update() {
            save_discard_widget_status_handler(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#org-other-settings"));
        },
        default_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No language set"}),
    });
    default_code_language_widget.setup();
}

function enable_or_disable_save_button($subsection_elem) {
    const time_limit_settings = Array.from($subsection_elem.find(".time-limit-setting"));
    let disable_save_btn = false;
    for (const setting_elem of time_limit_settings) {
        const dropdown_elem_val = jquery__WEBPACK_IMPORTED_MODULE_0___default()(setting_elem).find("select").val();
        const custom_input_elem_val = Number.parseInt(
            Number(jquery__WEBPACK_IMPORTED_MODULE_0___default()(setting_elem).find(".admin-realm-time-limit-input").val()),
            10,
        );

        disable_save_btn =
            dropdown_elem_val === "custom_period" &&
            (custom_input_elem_val <= 0 || Number.isNaN(custom_input_elem_val));
        if (disable_save_btn) {
            break;
        }
    }
    $subsection_elem.find(".subsection-changes-save button").prop("disabled", disable_save_btn);
}

function populate_data_for_request(subsection, for_realm_default_settings, sub) {
    let data = {};
    const properties_elements = get_subsection_property_elements(subsection);

    for (const input_elem of properties_elements) {
        const $input_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(input_elem);
        if (check_property_changed($input_elem, for_realm_default_settings, sub)) {
            const input_value = get_input_element_value($input_elem);
            if (input_value !== undefined) {
                let property_name;
                if (for_realm_default_settings || sub) {
                    property_name = extract_property_name($input_elem, for_realm_default_settings);
                } else if ($input_elem.attr("id").startsWith("id_authmethod")) {
                    // Authentication Method component IDs include authentication method name
                    // for uniqueness, anchored to "id_authmethod" prefix, e.g. "id_authmethodapple_<property_name>".
                    // We need to strip that whole construct down to extract the actual property name.
                    // The [\da-z]+ part of the regexp covers the auth method name itself.
                    // We assume it's not an empty string and can contain only digits and lowercase ASCII letters,
                    // this is ensured by a respective allowlist-based filter in populate_auth_methods().
                    [, property_name] = /^id_authmethod[\da-z]+_(.*)$/.exec($input_elem.attr("id"));
                } else {
                    [, property_name] = /^id_realm_(.*)$/.exec($input_elem.attr("id"));
                }

                if (property_name === "stream_privacy") {
                    data = {
                        ...data,
                        ..._stream_edit__WEBPACK_IMPORTED_MODULE_14__.get_request_data_for_stream_privacy(input_value),
                    };
                    continue;
                }
                data[property_name] = input_value;
            }
        }
    }

    return data;
}

function register_save_discard_widget_handlers(
    $container,
    patch_url,
    for_realm_default_settings,
) {
    $container.on("change input", "input, select, textarea", (e) => {
        e.preventDefault();
        e.stopPropagation();

        // This event handler detects whether after these input
        // changes, any fields have different values from the current
        // official values stored in the database and page_params.  If
        // they do, we transition to the "unsaved" state showing the
        // save/discard widget; otherwise, we hide that widget (the
        // "discarded" state).

        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).hasClass("no-input-change-detection")) {
            // This is to prevent input changes detection in elements
            // within a subsection whose changes should not affect the
            // visibility of the discard button
            return false;
        }

        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).hasClass("setting_email_notifications_batching_period_seconds")) {
            const show_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).val() === "custom_period";
            change_element_block_display_property(
                "realm_email_notification_batching_period_edit_minutes",
                show_elem,
            );
        }

        const $subsection = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".settings-subsection-parent");
        save_discard_widget_status_handler($subsection, for_realm_default_settings);
        return undefined;
    });

    $container.on("click", ".subsection-header .subsection-changes-discard button", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $subsection = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".settings-subsection-parent");
        for (const elem of get_subsection_property_elements($subsection)) {
            discard_property_element_changes(elem, for_realm_default_settings);
        }
        const $save_btn_controls = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".save-button-controls");
        change_save_button_state($save_btn_controls, "discarded");
    });

    function get_complete_data_for_subsection(subsection) {
        let data = {};

        switch (subsection) {
            case "notifications":
                data.notifications_stream_id = Number.parseInt(
                    notifications_stream_widget.value(),
                    10,
                );
                data.signup_notifications_stream_id = Number.parseInt(
                    signup_notifications_stream_widget.value(),
                    10,
                );
                data.default_language = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                    "#org-notifications .language_selection_widget .language_selection_button span",
                ).attr("data-language-code");
                break;
            case "other_settings": {
                const code_block_language_value = default_code_language_widget.value();
                // No need to JSON-encode, since this value is already a string.
                data.default_code_block_language = code_block_language_value;
                break;
            }
            case "join_settings": {
                const org_join_restrictions = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_org_join_restrictions").val();
                switch (org_join_restrictions) {
                    case "only_selected_domain":
                        data.emails_restricted_to_domains = true;
                        data.disallow_disposable_email_addresses = false;
                        break;
                    case "no_disposable_email":
                        data.emails_restricted_to_domains = false;
                        data.disallow_disposable_email_addresses = true;
                        break;
                    case "no_restriction":
                        data.disallow_disposable_email_addresses = false;
                        data.emails_restricted_to_domains = false;
                        break;
                }

                const waiting_period_threshold = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_waiting_period_setting").val();
                switch (waiting_period_threshold) {
                    case "none":
                        data.waiting_period_threshold = 0;
                        break;
                    case "three_days":
                        data.waiting_period_threshold = 3;
                        break;
                    case "custom_days":
                        data.waiting_period_threshold = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                            "#id_realm_waiting_period_threshold",
                        ).val();
                        break;
                }
                break;
            }
            case "auth_settings":
                data = {};
                data.authentication_methods = JSON.stringify(get_auth_method_list_data());
                break;
        }
        return data;
    }

    $container.on("click", ".subsection-header .subsection-changes-save button", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $save_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget);
        const $subsection_elem = $save_button.closest(".settings-subsection-parent");
        let extra_data = {};

        if (!for_realm_default_settings) {
            // The organization settings system has some coupled
            // fields that must be submitted together, which is
            // managed by the get_complete_data_for_subsection function.
            const [, subsection_id] = /^org-(.*)$/.exec($subsection_elem.attr("id"));
            const subsection = subsection_id.replace(/-/g, "_");
            extra_data = get_complete_data_for_subsection(subsection);
        }

        const data = {
            ...populate_data_for_request($subsection_elem, for_realm_default_settings),
            ...extra_data,
        };
        save_organization_settings(data, $save_button, patch_url);
    });
}

function build_page() {
    meta.loaded = true;

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_auth_methods_loading_indicator"));

    // Initialize all the dropdown list widgets.
    init_dropdown_widgets();
    // Populate realm domains
    populate_realm_domains_label(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    // Populate authentication methods table
    populate_auth_methods(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    for (const property_name of simple_dropdown_properties) {
        set_property_dropdown_value(property_name);
    }

    set_realm_waiting_period_dropdown();
    set_video_chat_provider_dropdown();
    set_giphy_rating_dropdown();
    set_msg_edit_limit_dropdown();
    set_msg_delete_limit_dropdown();
    set_delete_own_message_policy_dropdown(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    set_message_retention_setting_dropdown();
    set_org_join_restrictions_dropdown();
    set_message_content_in_email_notifications_visiblity();
    set_digest_emails_weekday_visibility();
    set_create_web_public_stream_dropdown_visibility();

    register_save_discard_widget_handlers(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin-realm-form"), "/json/realm", false);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-subsection-parent").on("keydown", "input", (e) => {
        e.stopPropagation();
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target)
                .closest(".settings-subsection-parent")
                .find(".subsection-changes-save button")
                .trigger("click");
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_message_content_edit_limit_seconds").on("change", () => {
        update_custom_value_input("realm_message_content_edit_limit_seconds");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_message_content_delete_limit_seconds").on("change", () => {
        update_custom_value_input("realm_message_content_delete_limit_seconds");
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_message_retention_days").on("change", (e) => {
        const message_retention_setting_dropdown_value = e.target.value;
        change_element_block_display_property(
            "id_realm_message_retention_custom_input",
            message_retention_setting_dropdown_value === "custom_period",
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_waiting_period_setting").on("change", function () {
        const waiting_period_threshold = this.value;
        change_element_block_display_property(
            "id_realm_waiting_period_threshold",
            waiting_period_threshold === "custom_days",
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_digest_emails_enabled").on("change", (e) => {
        const digest_emails_enabled = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(":checked");
        change_element_block_display_property(
            "id_realm_digest_weekday",
            digest_emails_enabled === true,
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_org_join_restrictions").on("change", (e) => {
        const org_join_restrictions = e.target.value;
        const $node = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#allowed_domains_label").parent();
        if (org_join_restrictions === "only_selected_domain") {
            $node.show();
            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 0) {
                _settings_realm_domains__WEBPACK_IMPORTED_MODULE_10__.show_realm_domains_modal();
            }
        } else {
            $node.hide();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_allow_message_editing").on("change", (e) => {
        const is_checked = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).prop("checked");
        update_message_edit_sub_settings(is_checked);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_delete_own_message_policy").on("change", (e) => {
        const setting_value = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).val(), 10);
        set_delete_own_message_policy_dropdown(setting_value);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#id_realm_org_join_restrictions").on("click", (e) => {
        // This prevents the disappearance of modal when there are
        // no allowed domains otherwise it gets closed due to
        // the click event handler attached to `#settings_overlay_container`
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show_realm_domains_modal").on("click", (e) => {
        e.stopPropagation();
        _settings_realm_domains__WEBPACK_IMPORTED_MODULE_10__.show_realm_domains_modal();
    });

    function realm_icon_logo_upload_complete($spinner, $upload_text, $delete_button) {
        $spinner.css({visibility: "hidden"});
        $upload_text.show();
        $delete_button.show();
    }

    function realm_icon_logo_upload_start($spinner, $upload_text, $delete_button) {
        $spinner.css({visibility: "visible"});
        $upload_text.hide();
        $delete_button.hide();
    }

    function upload_realm_logo_or_icon($file_input, night, icon) {
        const form_data = new FormData();
        let widget;
        let url;

        form_data.append("csrfmiddlewaretoken", Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        for (const [i, file] of Array.prototype.entries.call($file_input[0].files)) {
            form_data.append("file-" + i, file);
        }
        if (icon) {
            url = "/json/realm/icon";
            widget = "#realm-icon-upload-widget";
        } else {
            if (night) {
                widget = "#realm-night-logo-upload-widget";
            } else {
                widget = "#realm-day-logo-upload-widget";
            }
            url = "/json/realm/logo";
            form_data.append("night", JSON.stringify(night));
        }
        const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`${widget} .upload-spinner-background`).expectOne();
        const $upload_text = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`${widget}  .image-upload-text`).expectOne();
        const $delete_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`${widget}  .image-delete-button`).expectOne();
        const $error_field = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`${widget}  .image_file_input_error`).expectOne();
        realm_icon_logo_upload_start($spinner, $upload_text, $delete_button);
        $error_field.hide();
        _channel__WEBPACK_IMPORTED_MODULE_4__.post({
            url,
            data: form_data,
            cache: false,
            processData: false,
            contentType: false,
            success() {
                realm_icon_logo_upload_complete($spinner, $upload_text, $delete_button);
            },
            error(xhr) {
                realm_icon_logo_upload_complete($spinner, $upload_text, $delete_button);
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("", xhr, $error_field);
            },
        });
    }

    _realm_icon__WEBPACK_IMPORTED_MODULE_7__.build_realm_icon_widget(upload_realm_logo_or_icon, null, true);
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        _realm_logo__WEBPACK_IMPORTED_MODULE_8__.build_realm_logo_widget(upload_realm_logo_or_icon, false);
        _realm_logo__WEBPACK_IMPORTED_MODULE_8__.build_realm_logo_widget(upload_realm_logo_or_icon, true);
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#deactivate_realm_button").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();

        function do_deactivate_realm() {
            _channel__WEBPACK_IMPORTED_MODULE_4__.post({
                url: "/json/realm/deactivate",
                error(xhr) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}),
                        xhr,
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-realm-deactivation-status").expectOne(),
                    );
                },
            });
        }

        const html_body = _templates_confirm_dialog_confirm_deactivate_realm_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_5__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate organization"}),
            help_link: "/help/deactivate-your-organization",
            html_body,
            on_click: do_deactivate_realm,
        });
    });
}


/***/ }),

/***/ "./static/js/settings_panel_menu.js":
/*!******************************************!*\
  !*** ./static/js/settings_panel_menu.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "SettingsPanelMenu": () => (/* binding */ SettingsPanelMenu),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "mobile_deactivate_section": () => (/* binding */ mobile_deactivate_section),
/* harmony export */   "normal_settings": () => (/* binding */ normal_settings),
/* harmony export */   "org_settings": () => (/* binding */ org_settings),
/* harmony export */   "set_key_handlers": () => (/* binding */ set_key_handlers),
/* harmony export */   "show_normal_settings": () => (/* binding */ show_normal_settings),
/* harmony export */   "show_org_settings": () => (/* binding */ show_org_settings)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./settings */ "./static/js/settings.js");
/* harmony import */ var _settings_sections__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings_sections */ "./static/js/settings_sections.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");









let normal_settings;
let org_settings;

function mobile_deactivate_section() {
    const $settings_overlay_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container");
    $settings_overlay_container.find(".right").removeClass("show");
    $settings_overlay_container.find(".settings-header.mobile").removeClass("slide-left");
}

function two_column_mode() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container").css("--single-column") === undefined;
}

class SettingsPanelMenu {
    constructor(opts) {
        this.$main_elem = opts.$main_elem;
        this.hash_prefix = opts.hash_prefix;
        this.$curr_li = this.$main_elem.children("li").eq(0);

        this.$main_elem.on("click", "li[data-section]", (e) => {
            const section = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-section");

            this.activate_section_or_default(section);

            // You generally want to add logic to activate_section,
            // not to this click handler.

            e.stopPropagation();
        });
    }

    show() {
        this.$main_elem.show();
        const section = this.current_tab();
        if (two_column_mode()) {
            // In one column mode want to show the settings list, not the first settings section.
            this.activate_section_or_default(section);
        }
        this.$curr_li.trigger("focus");
    }

    hide() {
        this.$main_elem.hide();
    }

    current_tab() {
        return this.$curr_li.data("section");
    }

    li_for_section(section) {
        const $li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#settings_overlay_container li[data-section='${CSS.escape(section)}']`);
        return $li;
    }

    set_key_handlers(toggler) {
        const {vim_left, vim_right, vim_up, vim_down} = Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            $elem: this.$main_elem,
            handlers: {
                ArrowLeft: toggler.maybe_go_left,
                ArrowRight: toggler.maybe_go_right,
                Enter: () => this.enter_panel(),
                ArrowUp: () => this.prev(),
                ArrowDown: () => this.next(),

                // Binding vim keys as well
                [vim_left]: toggler.maybe_go_left,
                [vim_right]: toggler.maybe_go_right,
                [vim_up]: () => this.prev(),
                [vim_down]: () => this.next(),
            },
        });
    }

    prev() {
        this.$curr_li.prevAll(":visible").first().trigger("focus").trigger("click");
        return true;
    }

    next() {
        this.$curr_li.nextAll(":visible").first().trigger("focus").trigger("click");
        return true;
    }

    enter_panel() {
        const $panel = this.get_panel();
        const $panel_elem = $panel.find("input:visible,button:visible,select:visible").first();

        $panel_elem.trigger("focus");
        return true;
    }

    activate_section_or_default(section) {
        _popovers__WEBPACK_IMPORTED_MODULE_3__.hide_all();
        if (!section) {
            // No section is given so we display the default.

            if (two_column_mode()) {
                // In two column mode we resume to the last active section.
                section = this.current_tab();
            } else {
                // In single column mode we close the active section
                // so that you always start at the settings list.
                mobile_deactivate_section();
                return;
            }
        }

        const $li_for_section = this.li_for_section(section);
        if ($li_for_section.length === 0) {
            // This happens when there is no such section or the user does not have
            // permission to view that section.
            section = this.current_tab();
        } else {
            this.$curr_li = $li_for_section;
        }

        this.$main_elem.children("li").removeClass("active");
        this.$curr_li.addClass("active");

        const settings_section_hash = "#" + this.hash_prefix + section;

        // It could be that the hash has already been set.
        _browser_history__WEBPACK_IMPORTED_MODULE_1__.update_hash_internally_if_required(settings_section_hash);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-section").removeClass("show");

        _settings_sections__WEBPACK_IMPORTED_MODULE_5__.load_settings_section(section);

        this.get_panel().addClass("show");

        _ui__WEBPACK_IMPORTED_MODULE_6__.reset_scrollbar(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_content"));

        const $settings_overlay_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container");
        $settings_overlay_container.find(".right").addClass("show");
        $settings_overlay_container.find(".settings-header.mobile").addClass("slide-left");

        _settings__WEBPACK_IMPORTED_MODULE_4__.set_settings_header(section);
    }

    get_panel() {
        const section = this.$curr_li.data("section");
        const sel = `[data-name='${CSS.escape(section)}']`;
        const $panel = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings-section" + sel);
        return $panel;
    }
}

function initialize() {
    normal_settings = new SettingsPanelMenu({
        $main_elem: jquery__WEBPACK_IMPORTED_MODULE_0___default()(".normal-settings-list"),
        hash_prefix: "settings/",
    });
    org_settings = new SettingsPanelMenu({
        $main_elem: jquery__WEBPACK_IMPORTED_MODULE_0___default()(".org-settings-list"),
        hash_prefix: "organization/",
    });
}

function show_normal_settings() {
    org_settings.hide();
    normal_settings.show();
}

function show_org_settings() {
    normal_settings.hide();
    org_settings.show();
}

function set_key_handlers(toggler) {
    normal_settings.set_key_handlers(toggler);
    org_settings.set_key_handlers(toggler);
}


/***/ }),

/***/ "./static/js/settings_playgrounds.js":
/*!*******************************************!*\
  !*** ./static/js/settings_playgrounds.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "populate_playgrounds": () => (/* binding */ populate_playgrounds),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_playground_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_playground.hbs */ "./static/templates/confirm_dialog/confirm_delete_playground.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_playground_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_playground_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_admin_playground_list_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/admin_playground_list.hbs */ "./static/templates/settings/admin_playground_list.hbs");
/* harmony import */ var _templates_settings_admin_playground_list_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_playground_list_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _realm_playground__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./realm_playground */ "./static/js/realm_playground.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function compare_by_index(a, b, i) {
    if (a[i] > b[i]) {
        return 1;
    } else if (a[i] === b[i]) {
        return 0;
    }
    return -1;
}

function sort_pygments_language(a, b) {
    return compare_by_index(a, b, 0);
}

function sort_playground_name(a, b) {
    return compare_by_index(a, b, 1);
}

function maybe_disable_widgets() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }
}

function populate_playgrounds(playgrounds_data) {
    if (!meta.loaded) {
        return;
    }

    const $playgrounds_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_playgrounds_table").expectOne();
    _list_widget__WEBPACK_IMPORTED_MODULE_7__.create($playgrounds_table, playgrounds_data, {
        name: "playgrounds_list",
        modifier(playground) {
            return _templates_settings_admin_playground_list_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
                playground: {
                    playground_name: playground.name,
                    pygments_language: playground.pygments_language,
                    url_prefix: playground.url_prefix,
                    id: playground.id,
                },
                can_modify: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            });
        },
        filter: {
            $element: $playgrounds_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                return (
                    item.name.toLowerCase().includes(value) ||
                    item.pygments_language.toLowerCase().includes(value)
                );
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_9__.reset_scrollbar($playgrounds_table);
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground-settings").expectOne(),
        init_sort: [sort_pygments_language],
        sort_fields: {
            pygments_language: sort_pygments_language,
            playground_name: sort_playground_name,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground-settings .progressive-table-wrapper"),
    });
}

function set_up() {
    build_page();
    maybe_disable_widgets();
}

function build_page() {
    meta.loaded = true;
    populate_playgrounds(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".admin_playgrounds_table").on("click", ".delete", function (e) {
        e.preventDefault();
        e.stopPropagation();
        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const url =
            "/json/realm/playgrounds/" + encodeURIComponent($btn.attr("data-playground-id"));
        const html_body = _templates_confirm_dialog_confirm_delete_playground_hbs__WEBPACK_IMPORTED_MODULE_1___default()();

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete code playground?"}),
            html_body,
            id: "confirm_delete_code_playgrounds_modal",
            on_click: () => _dialog_widget__WEBPACK_IMPORTED_MODULE_5__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_3__.del, url),
            loading_spinner: true,
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization form.admin-playground-form")
        .off("submit")
        .on("submit", (e) => {
            e.preventDefault();
            e.stopPropagation();
            const $playground_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-playground-status");
            const $add_playground_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".new-playground-form button");
            $add_playground_button.prop("disabled", true);
            $playground_status.hide();
            const data = {
                name: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_name").val(),
                pygments_language: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_pygments_language").val(),
                url_prefix: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_url_prefix").val(),
            };
            _channel__WEBPACK_IMPORTED_MODULE_3__.post({
                url: "/json/realm/playgrounds",
                data,
                success() {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_pygments_language").val("");
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_name").val("");
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_url_prefix").val("");
                    $add_playground_button.prop("disabled", false);
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Custom playground added!"}),
                        $playground_status,
                        3000,
                    );
                    // FIXME: One thing to note here is that the "view code in playground"
                    // option for an already rendered code block (tagged with this newly added
                    // language) would not be visible without a re-render. To fix this, we should
                    // probably do some extraction in `rendered_markdown.js` which does a
                    // live-update of the `data-code-language` parameter in code blocks. Or change
                    // how we do the HTML in the frontend so that the icon labels/behavior are
                    // computed dynamically when you hover over the message based on configured
                    // playgrounds. Since this isn't high priority right now, we can probably
                    // take this up later.
                },
                error(xhr) {
                    $add_playground_button.prop("disabled", false);
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}),
                        xhr,
                        $playground_status,
                        3000,
                    );
                },
            });
        });

    const $search_pygments_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#playground_pygments_language");
    let language_labels = new Map();

    $search_pygments_box.typeahead({
        source(query) {
            language_labels = _realm_playground__WEBPACK_IMPORTED_MODULE_8__.get_pygments_typeahead_list(query);
            return Array.from(language_labels.keys());
        },
        items: 5,
        fixed: true,
        helpOnEmptyStrings: true,
        highlighter(item) {
            return language_labels.get(item);
        },
        matcher(item) {
            const q = this.query.trim().toLowerCase();
            return item.toLowerCase().startsWith(q);
        },
    });

    $search_pygments_box.on("click", (e) => {
        $search_pygments_box.typeahead("lookup").trigger("select");
        e.preventDefault();
        e.stopPropagation();
    });
}


/***/ }),

/***/ "./static/js/settings_profile_fields.js":
/*!**********************************************!*\
  !*** ./static/js/settings_profile_fields.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "do_populate_profile_fields": () => (/* binding */ do_populate_profile_fields),
/* harmony export */   "field_type_id_to_string": () => (/* binding */ field_type_id_to_string),
/* harmony export */   "get_external_account_link": () => (/* binding */ get_external_account_link),
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "parse_field_choices_from_field_data": () => (/* binding */ parse_field_choices_from_field_data),
/* harmony export */   "populate_profile_fields": () => (/* binding */ populate_profile_fields),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var sortablejs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sortablejs */ "./node_modules/sortablejs/modular/sortable.esm.js");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_profile_field_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_profile_field.hbs */ "./static/templates/confirm_dialog/confirm_delete_profile_field.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_profile_field_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_profile_field_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_profile_field_option_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_profile_field_option.hbs */ "./static/templates/confirm_dialog/confirm_delete_profile_field_option.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_profile_field_option_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_profile_field_option_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_add_new_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/add_new_custom_profile_field_form.hbs */ "./static/templates/settings/add_new_custom_profile_field_form.hbs");
/* harmony import */ var _templates_settings_add_new_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_add_new_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_settings_admin_profile_field_list_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/settings/admin_profile_field_list.hbs */ "./static/templates/settings/admin_profile_field_list.hbs");
/* harmony import */ var _templates_settings_admin_profile_field_list_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_profile_field_list_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_settings_edit_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/settings/edit_custom_profile_field_form.hbs */ "./static/templates/settings/edit_custom_profile_field_form.hbs");
/* harmony import */ var _templates_settings_edit_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_edit_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_settings_profile_field_choice_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/settings/profile_field_choice.hbs */ "./static/templates/settings/profile_field_choice.hbs");
/* harmony import */ var _templates_settings_profile_field_choice_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_profile_field_choice_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




















const meta = {
    loaded: false,
};

function display_success_status() {
    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-profile-field-status").expectOne();
    const success_msg_html = _settings_ui__WEBPACK_IMPORTED_MODULE_13__.strings.success_html;
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(success_msg_html, $spinner, 1000);
    _settings_ui__WEBPACK_IMPORTED_MODULE_13__.display_checkmark($spinner);
}

function maybe_disable_widgets() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='profile-field-settings']")
        .find("input, button, select")
        .prop("disabled", true);
}

let display_in_profile_summary_fields_limit_reached = false;
let order = [];
const field_types = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

function field_type_id_to_string(type_id) {
    for (const field_type of Object.values(field_types)) {
        if (field_type.id === type_id) {
            // Few necessary modifications in field-type-name for
            // table-list view of custom fields UI in org settings
            if (field_type.name === "Date picker") {
                return "Date";
            } else if (field_type.name === "Person picker") {
                return "Person";
            }
            return field_type.name;
        }
    }
    return undefined;
}

// Checking custom profile field type is valid for showing display on user card checkbox field.
function is_valid_to_display_in_summary(field_type) {
    if (field_type === field_types.LONG_TEXT.id || field_type === field_types.USER.id) {
        return false;
    }
    return true;
}

function update_profile_fields_table_element() {
    const $profile_fields_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table").expectOne();

    // If there are no custom fields, hide the table headers at the top
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) < 1) {
        $profile_fields_table.hide();
    } else {
        $profile_fields_table.show();
    }
}

function delete_profile_field(e) {
    e.preventDefault();
    e.stopPropagation();

    const profile_field_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-profile-field-id"), 10);
    const profile_field = get_profile_field(profile_field_id);
    const active_user_ids = _people__WEBPACK_IMPORTED_MODULE_12__.get_active_user_ids();
    let users_using_deleting_profile_field = 0;

    for (const user_id of active_user_ids) {
        const user_profile_data = _people__WEBPACK_IMPORTED_MODULE_12__.get_custom_profile_data(user_id, profile_field_id);
        if (user_profile_data) {
            users_using_deleting_profile_field += 1;
        }
    }

    const html_body = _templates_confirm_dialog_confirm_delete_profile_field_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        profile_field_name: profile_field.name,
        count: users_using_deleting_profile_field,
    });

    function request_delete() {
        const url = "/json/realm/profile_fields/" + profile_field_id;
        const opts = {
            success_continuation() {
                display_success_status();
                update_profile_fields_table_element();
            },
        };
        _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.del, url, {}, opts);
    }

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_9__.launch({
        html_body,
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete custom profile field?"}),
        on_click: request_delete,
    });
}

function read_select_field_data_from_form($profile_field_form, old_field_data) {
    const field_data = {};
    let field_order = 1;

    const old_option_value_map = new Map();
    if (old_field_data !== undefined) {
        for (const [value, choice] of Object.entries(old_field_data)) {
            old_option_value_map.set(choice.text, value);
        }
    }

    $profile_field_form.find("div.choice-row").each(function () {
        const text = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).find("input")[0].value;
        if (text) {
            if (old_option_value_map.get(text) !== undefined) {
                // Resetting the data-value in the form is
                // important if the user removed an option string
                // and then added it back again before saving
                // changes.
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-value", old_option_value_map.get(text));
            }
            const value = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-value");
            field_data[value] = {text, order: field_order.toString()};
            field_order += 1;
        }
    });

    return field_data;
}

function read_external_account_field_data($profile_field_form) {
    const field_data = {};
    field_data.subtype = $profile_field_form.find("select[name=external_acc_field_type]").val();
    if (field_data.subtype === "custom") {
        field_data.url_pattern = $profile_field_form.find("input[name=url_pattern]").val();
    }
    return field_data;
}

function update_choice_delete_btn($container, display_flag) {
    const no_of_choice_row = $container.find(".choice-row").length;

    // Disable delete button if there only one choice row
    // Enable choice delete button more one than once choice
    if (no_of_choice_row === 1) {
        if (display_flag === true) {
            $container.find(".choice-row .delete-choice").show();
        } else {
            $container.find(".choice-row .delete-choice").hide();
        }
    }
}

function get_value_for_new_option(container) {
    const $choice_rows = jquery__WEBPACK_IMPORTED_MODULE_0___default()(container).find(".choice-row");
    if ($choice_rows.length === 0) {
        // Value for the first option is 0.
        return 0;
    }

    const existing_option_values = [];
    $choice_rows.each(function () {
        existing_option_values.push(Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-value"), 10));
    });
    existing_option_values.sort();
    return existing_option_values[existing_option_values.length - 1] + 1;
}

function create_choice_row(container) {
    const context = {value: get_value_for_new_option(container)};
    const row = _templates_settings_profile_field_choice_hbs__WEBPACK_IMPORTED_MODULE_7___default()(context);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(container).append(row);
}

function clear_form_data() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_name").val("").closest(".input-group").show();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_hint").val("").closest(".input-group").show();
    // Set default type "Short text" in field type dropdown
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").val(field_types.SHORT_TEXT.id);
    // Clear data from select field form
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices").empty();
    create_choice_row(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices"));
    update_choice_delete_btn(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices"), false);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices_row").hide();
    // Clear external account field form
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#custom_field_url_pattern").val("");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#custom_external_account_url_pattern").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_external_accounts").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_external_accounts_type").val(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_external_accounts_type option:first-child").val(),
    );
}

function set_up_create_field_form() {
    // Hide error on field type change.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error").hide();
    const $field_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_external_accounts");
    const $field_url_pattern_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#custom_external_account_url_pattern");
    const profile_field_type = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").val(), 10);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_name").val("").prop("disabled", false);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_hint").val("").prop("disabled", false);
    $field_url_pattern_elem.hide();
    $field_elem.hide();

    if (profile_field_type === field_types.EXTERNAL_ACCOUNT.id) {
        $field_elem.show();
        const $profile_field_external_account_type = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            "#profile_field_external_accounts_type",
        ).val();
        if ($profile_field_external_account_type === "custom") {
            $field_url_pattern_elem.show();
        } else {
            $field_url_pattern_elem.hide();
            const profile_field_name =
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[$profile_field_external_account_type]
                    .name;
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_name").val(profile_field_name).prop("disabled", true);
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_hint").val("").prop("disabled", true);
        }
    } else if (profile_field_type === field_types.PRONOUNS.id) {
        const default_label = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Pronouns"});
        const default_hint = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "What pronouns should people use to refer to you?",
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_name").val(default_label);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_hint").val(default_hint);
    }

    // Not showing "display on user card" option for long text/user profile field.
    if (is_valid_to_display_in_summary(profile_field_type)) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_display_in_profile_summary").closest(".input-group").show();
        const check_display_in_profile_summary_by_default =
            profile_field_type === field_types.PRONOUNS.id &&
            !display_in_profile_summary_fields_limit_reached;
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_display_in_profile_summary").prop(
            "checked",
            check_display_in_profile_summary_by_default,
        );
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_display_in_profile_summary").closest(".input-group").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_display_in_profile_summary").prop("checked", false);
    }
}

function read_field_data_from_form(field_type_id, $profile_field_form, old_field_data) {
    // Only read field data if we are creating a select field
    // or external account field.
    if (field_type_id === field_types.SELECT.id) {
        return read_select_field_data_from_form($profile_field_form, old_field_data);
    } else if (field_type_id === field_types.EXTERNAL_ACCOUNT.id) {
        return read_external_account_field_data($profile_field_form);
    }
    return undefined;
}

function open_custom_profile_field_form_modal() {
    const html_body = _templates_settings_add_new_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
        realm_default_external_accounts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        custom_profile_field_types: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    function create_profile_field() {
        let field_data = {};
        const field_type = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").val();
        field_data = read_field_data_from_form(
            Number.parseInt(field_type, 10),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".new-profile-field-form"),
        );
        const data = {
            name: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_name").val(),
            hint: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_hint").val(),
            field_type,
            field_data: JSON.stringify(field_data),
            display_in_profile_summary: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_display_in_profile_summary").is(
                ":checked",
            ),
        };
        const url = "/json/realm/profile_fields";
        const opts = {
            success_continuation() {
                display_success_status();
            },
        };
        _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.post, url, data, opts);
    }

    function set_up_form_fields() {
        set_up_select_field();
        set_up_external_account_field();
        clear_form_data();

        // If we already have 2 custom profile fields configured to be
        // displayed on the user card, disable the input to change it.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-new-custom-profile-field-form #profile_field_display_in_profile_summary").prop(
            "disabled",
            display_in_profile_summary_fields_limit_reached,
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-new-custom-profile-field-form .profile_field_display_label").toggleClass(
            "disabled_label",
            display_in_profile_summary_fields_limit_reached,
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-new-custom-profile-field-form .checkbox").toggleClass(
            "display_in_profile_summary_tooltip",
            display_in_profile_summary_fields_limit_reached,
        );
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.launch({
        form_id: "add-new-custom-profile-field-form",
        help_link: "/help/custom-profile-fields#add-a-custom-profile-field",
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add a new custom profile field"}),
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add"}),
        on_click: create_profile_field,
        post_render: set_up_form_fields,
        loading_spinner: true,
    });
}

function add_choice_row(e) {
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).parent().next().hasClass("choice-row")) {
        return;
    }
    const choices_div = e.delegateTarget;
    update_choice_delete_btn(jquery__WEBPACK_IMPORTED_MODULE_0___default()(choices_div), true);
    create_choice_row(choices_div);
}

function delete_choice_row(e) {
    const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).parent();
    const $container = $row.parent();
    $row.remove();
    update_choice_delete_btn($container, false);
}

function show_modal_for_deleting_options(field, deleted_values, update_profile_field) {
    const active_user_ids = _people__WEBPACK_IMPORTED_MODULE_12__.get_active_user_ids();
    let users_count_with_deleted_option_selected = 0;
    for (const user_id of active_user_ids) {
        const field_value = _people__WEBPACK_IMPORTED_MODULE_12__.get_custom_profile_data(user_id, field.id);
        if (field_value && deleted_values[field_value.value]) {
            users_count_with_deleted_option_selected += 1;
        }
    }
    const deleted_options_count = Object.keys(deleted_values).length;
    const html_body = _templates_confirm_dialog_confirm_delete_profile_field_option_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        count: users_count_with_deleted_option_selected,
        field_name: field.name,
        deleted_options_count,
        deleted_values,
    });

    let modal_heading_text = "Delete this option?";
    if (deleted_options_count !== 1) {
        modal_heading_text = "Delete these options?";
    }
    _confirm_dialog__WEBPACK_IMPORTED_MODULE_9__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "{modal_heading_text}"}, {modal_heading_text}),
        html_body,
        on_click: update_profile_field,
    });
}

function get_profile_field(id) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())((field) => field.id === id);
}

function parse_field_choices_from_field_data(field_data) {
    const choices = [];
    for (const [value, choice] of Object.entries(field_data)) {
        choices.push({
            value,
            text: choice.text,
            order: choice.order,
        });
    }
    choices.sort((a, b) => a.order - b.order);
    return choices;
}

function set_up_external_account_field_edit_form($profile_field_form, url_pattern_val) {
    if ($profile_field_form.find("select[name=external_acc_field_type]").val() === "custom") {
        $profile_field_form.find("input[name=url_pattern]").val(url_pattern_val);
        $profile_field_form.find(".custom_external_account_detail").show();
        $profile_field_form.find("input[name=name]").prop("disabled", false);
        $profile_field_form.find("input[name=hint]").prop("disabled", false);
    } else {
        $profile_field_form.find("input[name=name]").prop("disabled", true);
        $profile_field_form.find("input[name=hint]").prop("disabled", true);
        $profile_field_form.find(".custom_external_account_detail").hide();
    }
}

function set_up_select_field_edit_form($profile_field_form, field_data) {
    // Re-render field choices in edit form to load initial select data
    const $choice_list = $profile_field_form.find(".edit_profile_field_choices_container");
    $choice_list.off();
    $choice_list.empty();

    const choices_data = parse_field_choices_from_field_data(field_data);

    for (const choice of choices_data) {
        $choice_list.append(
            _templates_settings_profile_field_choice_hbs__WEBPACK_IMPORTED_MODULE_7___default()({
                text: choice.text,
                value: choice.value,
            }),
        );
    }

    // Add blank choice at last
    create_choice_row($choice_list);
    update_choice_delete_btn($choice_list, false);
    sortablejs__WEBPACK_IMPORTED_MODULE_1__.Sortable.create($choice_list[0], {
        onUpdate() {},
        filter: "input",
        preventOnFilter: false,
    });
}

function open_edit_form_modal(e) {
    const field_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-profile-field-id"), 10);
    const field = get_profile_field(field_id);

    let field_data = {};
    if (field.field_data) {
        field_data = JSON.parse(field.field_data);
    }
    let choices = [];
    if (field.type === field_types.SELECT.id) {
        choices = parse_field_choices_from_field_data(field_data);
    }

    const html_body = _templates_settings_edit_custom_profile_field_form_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
        profile_field_info: {
            id: field.id,
            name: field.name,
            hint: field.hint,
            choices,
            display_in_profile_summary: field.display_in_profile_summary === true,
            is_select_field: field.type === field_types.SELECT.id,
            is_external_account_field: field.type === field_types.EXTERNAL_ACCOUNT.id,
            valid_to_display_in_summary: is_valid_to_display_in_summary(field.type),
        },
        realm_default_external_accounts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    function set_initial_values_of_profile_field() {
        const $profile_field_form = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-custom-profile-field-form-" + field_id);

        // If it exceeds or equals the max limit, we are disabling option for display custom
        // profile field on user card and adding tooptip, unless the field is already checked.
        if (display_in_profile_summary_fields_limit_reached && !field.display_in_profile_summary) {
            $profile_field_form
                .find("input[name=display_in_profile_summary]")
                .prop("disabled", true);
            $profile_field_form
                .find(".checkbox")
                .addClass("display_in_profile_summary_tooltip disabled_label");
        }

        if (Number.parseInt(field.type, 10) === field_types.SELECT.id) {
            set_up_select_field_edit_form($profile_field_form, field_data);
        }

        if (Number.parseInt(field.type, 10) === field_types.EXTERNAL_ACCOUNT.id) {
            $profile_field_form
                .find("select[name=external_acc_field_type]")
                .val(field_data.subtype);
            set_up_external_account_field_edit_form($profile_field_form, field_data.url_pattern);
        }

        // Set initial value in edit form
        $profile_field_form.find("input[name=name]").val(field.name);
        $profile_field_form.find("input[name=hint]").val(field.hint);

        $profile_field_form
            .find(".edit_profile_field_choices_container")
            .on("input", ".choice-row input", add_choice_row);
        $profile_field_form
            .find(".edit_profile_field_choices_container")
            .on("click", "button.delete-choice", delete_choice_row);
    }

    function submit_form() {
        const $profile_field_form = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-custom-profile-field-form-" + field_id);

        // For some reason jQuery's serialize() is not working with
        // channel.patch even though it is supported by $.ajax.
        const data = {};

        data.name = $profile_field_form.find("input[name=name]").val();
        data.hint = $profile_field_form.find("input[name=hint]").val();
        data.display_in_profile_summary = $profile_field_form
            .find("input[name=display_in_profile_summary]")
            .is(":checked");

        const new_field_data = read_field_data_from_form(
            Number.parseInt(field.type, 10),
            $profile_field_form,
            field_data,
        );
        data.field_data = JSON.stringify(new_field_data);

        function update_profile_field() {
            const url = "/json/realm/profile_fields/" + field_id;
            const opts = {
                success_continuation() {
                    display_success_status();
                },
            };
            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.patch, url, data, opts);
        }

        if (field.type === field_types.SELECT.id) {
            const new_values = new Set(Object.keys(new_field_data));
            const deleted_values = {};
            for (const [value, option] of Object.entries(field_data)) {
                if (!new_values.has(value)) {
                    deleted_values[value] = option.text;
                }
            }

            if (Object.keys(deleted_values).length !== 0) {
                const edit_select_field_modal_callback = () =>
                    show_modal_for_deleting_options(field, deleted_values, update_profile_field);
                _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.close_modal(edit_select_field_modal_callback);
                return;
            }
        }

        update_profile_field();
    }

    const edit_custom_profile_field_form_id = "edit-custom-profile-field-form-" + field_id;
    _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.launch({
        form_id: edit_custom_profile_field_form_id,
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Edit custom profile field"}),
        html_body,
        id: "edit-custom-profile-field-form-modal",
        on_click: submit_form,
        post_render: set_initial_values_of_profile_field,
        loading_spinner: true,
    });
}

// If exceeds or equals the max limit, we are disabling option for
// display custom profile field on user card and adding tooltip.
function update_profile_fields_checkboxes() {
    // Disabling only uncheck checkboxes in table, so user should able uncheck checked checkboxes.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table .display_in_profile_summary_checkbox_false").prop(
        "disabled",
        display_in_profile_summary_fields_limit_reached,
    );
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table .display_in_profile_summary_false").toggleClass(
        "display_in_profile_summary_tooltip",
        display_in_profile_summary_fields_limit_reached,
    );
}

function toggle_display_in_profile_summary_profile_field(e) {
    const field_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-profile-field-id"), 10);
    const field = get_profile_field(field_id);

    let field_data;
    if (field.field_data) {
        field_data = field.field_data;
    }

    const data = {
        name: field.name,
        hint: field.hint,
        field_data,
        display_in_profile_summary: !field.display_in_profile_summary,
    };
    const $profile_field_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-profile-field-status").expectOne();

    _settings_ui__WEBPACK_IMPORTED_MODULE_13__.do_settings_change(
        _channel__WEBPACK_IMPORTED_MODULE_8__.patch,
        "/json/realm/profile_fields/" + field_id,
        data,
        $profile_field_status,
    );
}

function reset() {
    meta.loaded = false;
}

function update_field_order() {
    order = [];
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".profile-field-row").each(function () {
        order.push(Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("data-profile-field-id"), 10));
    });
    _settings_ui__WEBPACK_IMPORTED_MODULE_13__.do_settings_change(
        _channel__WEBPACK_IMPORTED_MODULE_8__.patch,
        "/json/realm/profile_fields",
        {order: JSON.stringify(order)},
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-profile-field-status").expectOne(),
    );
}

function populate_profile_fields(profile_fields_data) {
    if (!meta.loaded) {
        // If outside callers call us when we're not loaded, just
        // exit and we'll draw the widgets again during set_up().
        return;
    }
    do_populate_profile_fields(profile_fields_data);
}

function do_populate_profile_fields(profile_fields_data) {
    // We should only call this internally or from tests.
    const $profile_fields_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table").expectOne();

    $profile_fields_table.find("tr.profile-field-row").remove(); // Clear all rows.
    $profile_fields_table.find("tr.profile-field-form").remove(); // Clear all rows.
    order = [];

    let display_in_profile_summary_fields_count = 0;
    for (const profile_field of profile_fields_data) {
        order.push(profile_field.id);
        let field_data = {};
        if (profile_field.field_data) {
            field_data = JSON.parse(profile_field.field_data);
        }
        let choices = [];
        if (profile_field.type === field_types.SELECT.id) {
            choices = parse_field_choices_from_field_data(field_data);
        }

        const display_in_profile_summary = profile_field.display_in_profile_summary === true;
        $profile_fields_table.append(
            _templates_settings_admin_profile_field_list_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                profile_field: {
                    id: profile_field.id,
                    name: profile_field.name,
                    hint: profile_field.hint,
                    type: field_type_id_to_string(profile_field.type),
                    choices,
                    is_select_field: profile_field.type === field_types.SELECT.id,
                    is_external_account_field:
                        profile_field.type === field_types.EXTERNAL_ACCOUNT.id,
                    display_in_profile_summary,
                    valid_to_display_in_summary: is_valid_to_display_in_summary(profile_field.type),
                },
                can_modify: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
                realm_default_external_accounts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            }),
        );

        // Keeping counts of all display_in_profile_summary profile fields, to keep track.
        if (display_in_profile_summary) {
            display_in_profile_summary_fields_count += 1;
        }
    }

    // Update whether we're at the limit for display_in_profile_summary.
    display_in_profile_summary_fields_limit_reached = display_in_profile_summary_fields_count >= 2;

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const field_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table")[0];
        sortablejs__WEBPACK_IMPORTED_MODULE_1__.Sortable.create(field_list, {
            onUpdate: update_field_order,
            filter: "input",
            preventOnFilter: false,
        });
    }

    update_profile_fields_checkboxes();
    update_profile_fields_table_element();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_profile_fields_loading_indicator"));
}

function set_up_select_field() {
    create_choice_row("#profile_field_choices");
    update_choice_delete_btn(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices"), false);

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        const choice_list = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices")[0];
        sortablejs__WEBPACK_IMPORTED_MODULE_1__.Sortable.create(choice_list, {
            onUpdate() {},
            filter: "input",
            preventOnFilter: false,
        });
    }

    const field_type = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").val();

    if (Number.parseInt(field_type, 10) !== field_types.SELECT.id) {
        // If 'Select' type is already selected, show choice row.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices_row").hide();
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").on("change", (e) => {
        // Hide error on field type change.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error").hide();
        const selected_field_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).val(), 10);
        if (selected_field_id === field_types.SELECT.id) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices_row").show();
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices_row").hide();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices").on("input", ".choice-row input", add_choice_row);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_choices").on("click", "button.delete-choice", delete_choice_row);
}

function set_up_external_account_field() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_type").on("change", () => {
        set_up_create_field_form();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#profile_field_external_accounts_type").on("change", () => {
        set_up_create_field_form();
    });
}

function get_external_account_link(field) {
    const field_subtype = field.field_data.subtype;
    let field_url_pattern;

    if (field_subtype === "custom") {
        field_url_pattern = field.field_data.url_pattern;
    } else {
        field_url_pattern = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[field_subtype].url_pattern;
    }
    return field_url_pattern.replace("%(username)s", field.value);
}

function set_up() {
    build_page();
    maybe_disable_widgets();
}

function build_page() {
    // create loading indicators
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_profile_fields_loading_indicator"));
    // Populate profile_fields table
    do_populate_profile_fields(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    meta.loaded = true;

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table").on("click", ".delete", delete_profile_field);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-custom-profile-field-btn").on("click", open_custom_profile_field_form_modal);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table").on("click", ".open-edit-form-modal", open_edit_form_modal);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_profile_fields_table").on(
        "click",
        ".display_in_profile_summary",
        toggle_display_in_profile_summary_profile_field,
    );
}


/***/ }),

/***/ "./static/js/settings_realm_domains.js":
/*!*********************************************!*\
  !*** ./static/js/settings_realm_domains.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "populate_realm_domains_table": () => (/* binding */ populate_realm_domains_table),
/* harmony export */   "setup_realm_domains_modal_handlers": () => (/* binding */ setup_realm_domains_modal_handlers),
/* harmony export */   "show_realm_domains_modal": () => (/* binding */ show_realm_domains_modal)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_admin_realm_domains_list_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings/admin_realm_domains_list.hbs */ "./static/templates/settings/admin_realm_domains_list.hbs");
/* harmony import */ var _templates_settings_admin_realm_domains_list_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_realm_domains_list_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_settings_realm_domains_modal_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/settings/realm_domains_modal.hbs */ "./static/templates/settings/realm_domains_modal.hbs");
/* harmony import */ var _templates_settings_realm_domains_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_realm_domains_modal_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());











function populate_realm_domains_table(realm_domains) {
    // Don't populate the table if the realm domains modal isn't open.
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm_domains_modal").length === 0) {
        return;
    }

    const $realm_domains_table_body = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm_domains_table tbody").expectOne();
    $realm_domains_table_body.find("tr").remove();

    for (const realm_domain of realm_domains) {
        $realm_domains_table_body.append(
            _templates_settings_admin_realm_domains_list_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                realm_domain,
            }),
        );
    }
}

function fade_status_element($elem) {
    setTimeout(() => {
        $elem.fadeOut(500);
    }, 3000);
}

function setup_realm_domains_modal_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm_domains_table").on("click", ".delete_realm_domain", function () {
        const domain = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parents("tr").find(".domain").text();
        const url = "/json/realm/domains/" + domain;
        const $realm_domains_info = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".realm_domains_info");

        _channel__WEBPACK_IMPORTED_MODULE_3__.del({
            url,
            success() {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deleted successfully!"}),
                    $realm_domains_info,
                );
                fade_status_element($realm_domains_info);
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $realm_domains_info);
                fade_status_element($realm_domains_info);
            },
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#realm_domains_table").on("change", ".allow-subdomains", function (e) {
        e.stopPropagation();
        const $realm_domains_info = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".realm_domains_info");
        const domain = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parents("tr").find(".domain").text();
        const allow_subdomains = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).prop("checked");
        const url = "/json/realm/domains/" + domain;
        const data = {
            allow_subdomains: JSON.stringify(allow_subdomains),
        };

        _channel__WEBPACK_IMPORTED_MODULE_3__.patch({
            url,
            data,
            success() {
                if (allow_subdomains) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage:
                                    "Update successful: Subdomains allowed for {domain}",
                            },
                            {domain},
                        ),
                        $realm_domains_info,
                    );
                } else {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage:
                                    "Update successful: Subdomains no longer allowed for {domain}",
                            },
                            {domain},
                        ),
                        $realm_domains_info,
                    );
                }
                fade_status_element($realm_domains_info);
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $realm_domains_info);
                fade_status_element($realm_domains_info);
            },
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#submit-add-realm-domain").on("click", () => {
        const $realm_domains_info = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".realm_domains_info");
        const $widget = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-realm-domain-widget");
        const domain = $widget.find(".new-realm-domain").val();
        const allow_subdomains = $widget.find(".new-realm-domain-allow-subdomains").prop("checked");
        const data = {
            domain,
            allow_subdomains: JSON.stringify(allow_subdomains),
        };

        _channel__WEBPACK_IMPORTED_MODULE_3__.post({
            url: "/json/realm/domains",
            data,
            success() {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-realm-domain-widget .new-realm-domain").val("");
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-realm-domain-widget .new-realm-domain-allow-subdomains").prop(
                    "checked",
                    false,
                );
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Added successfully!"}),
                    $realm_domains_info,
                );
                fade_status_element($realm_domains_info);
            },
            error(xhr) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $realm_domains_info);
                fade_status_element($realm_domains_info);
            },
        });
    });
}

function show_realm_domains_modal() {
    const realm_domains_table_body = _templates_settings_realm_domains_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default()();

    _dialog_widget__WEBPACK_IMPORTED_MODULE_4__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Allowed domains"}),
        html_body: realm_domains_table_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Close"}),
        id: "realm_domains_modal",
        on_click() {},
        close_on_submit: true,
        focus_submit_on_open: true,
        single_footer_button: true,
        post_render() {
            setup_realm_domains_modal_handlers();
            populate_realm_domains_table(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
        },
    });
}


/***/ }),

/***/ "./static/js/settings_realm_user_settings_defaults.js":
/*!************************************************************!*\
  !*** ./static/js/settings_realm_user_settings_defaults.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "realm_default_settings_panel": () => (/* binding */ realm_default_settings_panel),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_page": () => (/* binding */ update_page)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_display__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./settings_display */ "./static/js/settings_display.js");
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");









const realm_default_settings_panel = {};

function maybe_disable_widgets() {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-level-user-defaults']")
            .find("input, select")
            .prop("disabled", true);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='organization-level-user-defaults']")
            .find(".play_notification_sound")
            .addClass("control-label-disabled");
    }
}

function update_page(property) {
    if (!_overlays__WEBPACK_IMPORTED_MODULE_1__.settings_open()) {
        return;
    }
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(realm_default_settings_panel.container);
    let value = Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[property];

    // settings_org.set_input_element_value doesn't support radio
    // button widgets like these.
    if (property === "emojiset" || property === "user_list_style") {
        $container.find(`input[value=${CSS.escape(value)}]`).prop("checked", true);
        return;
    }

    if (property === "email_notifications_batching_period_seconds") {
        _settings_notifications__WEBPACK_IMPORTED_MODULE_4__.set_notification_batching_ui($container, value);
        return;
    }

    // The twenty_four_hour_time setting is represented as a boolean
    // in the API, but a dropdown with "true"/"false" as strings in
    // the UI, so we need to convert its format here.
    if (property === "twenty_four_hour_time") {
        value = value.toString();
    }

    const $input_elem = $container.find(`[name=${CSS.escape(property)}]`);
    _settings_org__WEBPACK_IMPORTED_MODULE_5__.set_input_element_value($input_elem, value);
}

function set_up() {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(realm_default_settings_panel.container);
    _settings_display__WEBPACK_IMPORTED_MODULE_3__.set_up(realm_default_settings_panel);
    _settings_notifications__WEBPACK_IMPORTED_MODULE_4__.set_up(realm_default_settings_panel);

    _settings_org__WEBPACK_IMPORTED_MODULE_5__.register_save_discard_widget_handlers(
        $container,
        "/json/realm/user_settings_defaults",
        true,
    );

    maybe_disable_widgets();
}

function initialize() {
    realm_default_settings_panel.container = "#realm-user-default-settings";
    realm_default_settings_panel.settings_object = Object(function webpackMissingModule() { var e = new Error("Cannot find module './realm_user_settings_defaults'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    realm_default_settings_panel.notification_sound_elem =
        "#realm-default-notification-sound-audio";
    realm_default_settings_panel.for_realm_settings = true;
}


/***/ }),

/***/ "./static/js/settings_sections.js":
/*!****************************************!*\
  !*** ./static/js/settings_sections.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_group": () => (/* binding */ get_group),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "load_settings_section": () => (/* binding */ load_settings_section),
/* harmony export */   "reset_sections": () => (/* binding */ reset_sections)
/* harmony export */ });
/* harmony import */ var _alert_words_ui__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./alert_words_ui */ "./static/js/alert_words_ui.js");
/* harmony import */ var _attachments_ui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./attachments_ui */ "./static/js/attachments_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_account__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./settings_account */ "./static/js/settings_account.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
/* harmony import */ var _settings_display__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings_display */ "./static/js/settings_display.js");
/* harmony import */ var _settings_emoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./settings_emoji */ "./static/js/settings_emoji.js");
/* harmony import */ var _settings_exports__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./settings_exports */ "./static/js/settings_exports.js");
/* harmony import */ var _settings_invites__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./settings_invites */ "./static/js/settings_invites.js");
/* harmony import */ var _settings_linkifiers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_linkifiers */ "./static/js/settings_linkifiers.js");
/* harmony import */ var _settings_muted_topics__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_muted_topics */ "./static/js/settings_muted_topics.js");
/* harmony import */ var _settings_muted_users__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./settings_muted_users */ "./static/js/settings_muted_users.js");
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_playgrounds__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./settings_playgrounds */ "./static/js/settings_playgrounds.js");
/* harmony import */ var _settings_profile_fields__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_profile_fields */ "./static/js/settings_profile_fields.js");
/* harmony import */ var _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./settings_realm_user_settings_defaults */ "./static/js/settings_realm_user_settings_defaults.js");
/* harmony import */ var _settings_streams__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./settings_streams */ "./static/js/settings_streams.js");
/* harmony import */ var _settings_user_groups_legacy__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./settings_user_groups_legacy */ "./static/js/settings_user_groups_legacy.js");
/* harmony import */ var _settings_users__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./settings_users */ "./static/js/settings_users.js");





















const load_func_dict = new Map(); // group -> function
const loaded_groups = new Set();

function get_group(section) {
    // Sometimes several sections all share the same code.

    switch (section) {
        case "organization-profile":
        case "organization-settings":
        case "organization-permissions":
        case "auth-methods":
            return "org_misc";

        case "bot-list-admin":
            return "org_bots";

        case "user-list-admin":
        case "deactivated-users-admin":
            return "org_users";

        case "profile":
        case "account-and-privacy":
            return "your-account";

        default:
            return section;
    }
}

function initialize() {
    // personal
    load_func_dict.set("your-account", _settings_account__WEBPACK_IMPORTED_MODULE_3__.set_up);
    load_func_dict.set("display-settings", () => {
        _settings_display__WEBPACK_IMPORTED_MODULE_5__.set_up(_settings_display__WEBPACK_IMPORTED_MODULE_5__.user_settings_panel);
    });
    load_func_dict.set("notifications", () => {
        _settings_notifications__WEBPACK_IMPORTED_MODULE_12__.set_up(_settings_notifications__WEBPACK_IMPORTED_MODULE_12__.user_settings_panel);
    });
    load_func_dict.set("your-bots", _settings_bots__WEBPACK_IMPORTED_MODULE_4__.set_up);
    load_func_dict.set("alert-words", _alert_words_ui__WEBPACK_IMPORTED_MODULE_0__.set_up_alert_words);
    load_func_dict.set("uploaded-files", _attachments_ui__WEBPACK_IMPORTED_MODULE_1__.set_up_attachments);
    load_func_dict.set("muted-topics", _settings_muted_topics__WEBPACK_IMPORTED_MODULE_10__.set_up);
    load_func_dict.set("muted-users", _settings_muted_users__WEBPACK_IMPORTED_MODULE_11__.set_up);

    // org
    load_func_dict.set("org_misc", _settings_org__WEBPACK_IMPORTED_MODULE_13__.set_up);
    load_func_dict.set("org_bots", _settings_users__WEBPACK_IMPORTED_MODULE_19__.set_up_bots);
    load_func_dict.set("org_users", _settings_users__WEBPACK_IMPORTED_MODULE_19__.set_up_humans);
    load_func_dict.set("emoji-settings", _settings_emoji__WEBPACK_IMPORTED_MODULE_6__.set_up);
    load_func_dict.set("default-streams-list", _settings_streams__WEBPACK_IMPORTED_MODULE_17__.set_up);
    load_func_dict.set("linkifier-settings", _settings_linkifiers__WEBPACK_IMPORTED_MODULE_9__.set_up);
    load_func_dict.set("playground-settings", _settings_playgrounds__WEBPACK_IMPORTED_MODULE_14__.set_up);
    load_func_dict.set("invites-list-admin", _settings_invites__WEBPACK_IMPORTED_MODULE_8__.set_up);
    load_func_dict.set("user-groups-admin", _settings_user_groups_legacy__WEBPACK_IMPORTED_MODULE_18__.set_up);
    load_func_dict.set("profile-field-settings", _settings_profile_fields__WEBPACK_IMPORTED_MODULE_15__.set_up);
    load_func_dict.set("data-exports-admin", _settings_exports__WEBPACK_IMPORTED_MODULE_7__.set_up);
    load_func_dict.set(
        "organization-level-user-defaults",
        _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_16__.set_up,
    );
}

function load_settings_section(section) {
    const group = get_group(section);

    if (!load_func_dict.has(group)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown section " + section);
        return;
    }

    if (loaded_groups.has(group)) {
        // We only load groups once (unless somebody calls
        // reset_sections).
        return;
    }

    const load_func = load_func_dict.get(group);

    // Do the real work here!
    load_func();
    loaded_groups.add(group);
}

function reset_sections() {
    loaded_groups.clear();
    _settings_emoji__WEBPACK_IMPORTED_MODULE_6__.reset();
    _settings_exports__WEBPACK_IMPORTED_MODULE_7__.reset();
    _settings_linkifiers__WEBPACK_IMPORTED_MODULE_9__.reset();
    _settings_playgrounds__WEBPACK_IMPORTED_MODULE_14__.reset();
    _settings_invites__WEBPACK_IMPORTED_MODULE_8__.reset();
    _settings_org__WEBPACK_IMPORTED_MODULE_13__.reset();
    _settings_profile_fields__WEBPACK_IMPORTED_MODULE_15__.reset();
    _settings_streams__WEBPACK_IMPORTED_MODULE_17__.reset();
    _settings_user_groups_legacy__WEBPACK_IMPORTED_MODULE_18__.reset();
    _settings_muted_topics__WEBPACK_IMPORTED_MODULE_10__.reset();
    _settings_muted_users__WEBPACK_IMPORTED_MODULE_11__.reset();
    _alert_words_ui__WEBPACK_IMPORTED_MODULE_0__.reset();
    // settings_users doesn't need a reset()
}


/***/ }),

/***/ "./static/js/settings_streams.js":
/*!***************************************!*\
  !*** ./static/js/settings_streams.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_default_stream_table": () => (/* binding */ build_default_stream_table),
/* harmony export */   "build_page": () => (/* binding */ build_page),
/* harmony export */   "delete_default_stream": () => (/* binding */ delete_default_stream),
/* harmony export */   "maybe_disable_widgets": () => (/* binding */ maybe_disable_widgets),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up),
/* harmony export */   "update_default_streams_table": () => (/* binding */ update_default_streams_table)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_settings_admin_default_streams_list_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/settings/admin_default_streams_list.hbs */ "./static/templates/settings/admin_default_streams_list.hbs");
/* harmony import */ var _templates_settings_admin_default_streams_list_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_default_streams_list_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _typeahead_helper__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./typeahead_helper */ "./static/js/typeahead_helper.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function maybe_disable_widgets() {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return;
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".organization-box [data-name='default-streams-list']")
        .find("input:not(.search), button, select")
        .prop("disabled", true);
}

function build_default_stream_table() {
    const $table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_default_streams_table").expectOne();

    const stream_ids = _stream_data__WEBPACK_IMPORTED_MODULE_6__.get_default_stream_ids();
    const subs = stream_ids.map((stream_id) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id));

    _list_widget__WEBPACK_IMPORTED_MODULE_5__.create($table, subs, {
        name: "default_streams_list",
        modifier(item) {
            return _templates_settings_admin_default_streams_list_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                stream: item,
                can_modify: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            });
        },
        filter: {
            $element: $table.closest(".settings-section").find(".search"),
            predicate(item, query) {
                return item.name.toLowerCase().includes(query.toLowerCase());
            },
            onupdate() {
                _ui__WEBPACK_IMPORTED_MODULE_8__.reset_scrollbar($table);
            },
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-default-streams-list").expectOne(),
        init_sort: ["alphabetic", "name"],
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-default-streams-list .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_default_streams_loading_indicator"));
}

function update_default_streams_table() {
    if (["organization", "settings"].includes(_hash_util__WEBPACK_IMPORTED_MODULE_3__.get_current_hash_category())) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_default_streams_table").expectOne().find("tr.default_stream_row").remove();
        build_default_stream_table();
    }
}

function make_stream_default(stream_id) {
    const data = {
        stream_id,
    };
    const $default_stream_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-default-stream-status");
    $default_stream_status.hide();

    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/default_streams",
        data,
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $default_stream_status);
            $default_stream_status.show();
        },
    });
}

function delete_default_stream(stream_id, $default_stream_row, $alert_element) {
    _channel__WEBPACK_IMPORTED_MODULE_2__.del({
        url: "/json/default_streams?" + jquery__WEBPACK_IMPORTED_MODULE_0___default().param({stream_id}),
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(xhr, $alert_element);
        },
        success() {
            $default_stream_row.remove();
        },
    });
}

function set_up() {
    build_page();
    maybe_disable_widgets();
}

function build_page() {
    meta.loaded = true;

    update_default_streams_table();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".create_default_stream").on("keypress", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
            e.stopPropagation();
            const $default_stream_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".create_default_stream");
            make_stream_default(_stream_data__WEBPACK_IMPORTED_MODULE_6__.get_stream_id($default_stream_input.val()));
            $default_stream_input[0].value = "";
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".create_default_stream").typeahead({
        items: 5,
        fixed: true,
        source() {
            return _stream_data__WEBPACK_IMPORTED_MODULE_6__.get_non_default_stream_names();
        },
        highlighter(item) {
            return _typeahead_helper__WEBPACK_IMPORTED_MODULE_7__.render_typeahead_item({primary: item});
        },
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".default-stream-form").on("click", "#do_submit_stream", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const $default_stream_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".create_default_stream");
        make_stream_default(_stream_data__WEBPACK_IMPORTED_MODULE_6__.get_stream_id($default_stream_input.val()));
        // Clear value inside input box
        $default_stream_input[0].value = "";
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".default_stream_row .remove-default-stream", function (e) {
        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".default_stream_row");
        const stream_id = Number.parseInt($row.attr("data-stream-id"), 10);
        delete_default_stream(stream_id, $row, jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target));
    });
}


/***/ }),

/***/ "./static/js/settings_toggle.js":
/*!**************************************!*\
  !*** ./static/js/settings_toggle.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "highlight_toggle": () => (/* binding */ highlight_toggle),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "toggle_org_setting_collapse": () => (/* binding */ toggle_org_setting_collapse)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_panel_menu__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./settings_panel_menu */ "./static/js/settings_panel_menu.js");






let toggler;

function highlight_toggle(tab_name) {
    if (toggler) {
        toggler.goto(tab_name);
    }
}

function initialize() {
    toggler = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        child_wants_focus: true,
        values: [
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Personal"}), key: "settings"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Organization"}), key: "organization"},
        ],
        callback(name, key) {
            if (key === "organization") {
                _settings_panel_menu__WEBPACK_IMPORTED_MODULE_2__.show_org_settings();
            } else {
                _settings_panel_menu__WEBPACK_IMPORTED_MODULE_2__.show_normal_settings();
            }
        },
    });

    _settings_panel_menu__WEBPACK_IMPORTED_MODULE_2__.set_key_handlers(toggler);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#settings_overlay_container .tab-container").append(toggler.get());
}

// Handles the collapse/reveal of some tabs in the org settings for non-admins.
function toggle_org_setting_collapse() {
    const is_collapsed = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".collapse-org-settings").hasClass("hide-org-settings");
    const show_fewer_settings_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Show fewer"});
    const show_more_settings_text = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Show more"});

    if (is_collapsed) {
        for (const elem of jquery__WEBPACK_IMPORTED_MODULE_0___default()(".collapse-org-settings")) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).removeClass("hide-org-settings");
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse_chevron").removeClass("fa-angle-double-down");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse_chevron").addClass("fa-angle-double-up");

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse").text(show_fewer_settings_text);
    } else {
        for (const elem of jquery__WEBPACK_IMPORTED_MODULE_0___default()(".collapse-org-settings")) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(elem).addClass("hide-org-settings");
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse_chevron").removeClass("fa-angle-double-up");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse_chevron").addClass("fa-angle-double-down");

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_collapse").text(show_more_settings_text);
    }

    // If current tab is about to be collapsed, go to default tab.
    const $current_tab = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".org-settings-list .active");
    if ($current_tab.hasClass("hide-org-settings")) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(location).attr("href", "/#organization/organization-profile");
    }
}


/***/ }),

/***/ "./static/js/settings_ui.js":
/*!**********************************!*\
  !*** ./static/js/settings_ui.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "disable_sub_setting_onchange": () => (/* binding */ disable_sub_setting_onchange),
/* harmony export */   "display_checkmark": () => (/* binding */ display_checkmark),
/* harmony export */   "do_settings_change": () => (/* binding */ do_settings_change),
/* harmony export */   "strings": () => (/* binding */ strings)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






function display_checkmark($elem) {
    const check_mark = document.createElement("img");
    check_mark.src = "/static/images/checkbox-green.svg";
    $elem.prepend(check_mark);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(check_mark).css("width", "13px");
}

const strings = {
    success_html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Saved"}),
    failure_html: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save failed"}),
    saving: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Saving"}),
};

// Generic function for informing users about changes to the settings
// UI.  Intended to replace the old system that was built around
// direct calls to `ui_report`.
function do_settings_change(
    request_method,
    url,
    data,
    status_element,
    {
        success_msg_html = strings.success_html,
        failure_msg_html = strings.failure_html,
        success_continuation,
        error_continuation,
        sticky = false,
        $error_msg_element,
    } = {},
) {
    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(status_element).expectOne();
    $spinner.fadeTo(0, 1);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner, {text: strings.saving});
    const remove_after = sticky ? undefined : 1000;
    const appear_after = 500;

    request_method({
        url,
        data,
        success(reponse_data) {
            setTimeout(() => {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(success_msg_html, $spinner, remove_after);
                display_checkmark($spinner);
            }, appear_after);
            if (success_continuation !== undefined) {
                success_continuation(reponse_data);
            }
        },
        error(xhr) {
            if ($error_msg_element) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(failure_msg_html, xhr, $error_msg_element);
            } else {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(failure_msg_html, xhr, $spinner);
            }
            if (error_continuation !== undefined) {
                error_continuation(xhr);
            }
        },
    });
}

// This function is used to disable sub-setting when main setting is checked or unchecked
// or two settings are inter-dependent on their values.
// * is_checked is boolean, shows if the main setting is checked or not.
// * sub_setting_id is sub setting or setting which depend on main setting,
//   string id of setting.
// * disable_on_uncheck is boolean, true if sub setting should be disabled
//   when main setting unchecked.
function disable_sub_setting_onchange(
    is_checked,
    sub_setting_id,
    disable_on_uncheck,
    include_label,
) {
    if ((is_checked && disable_on_uncheck) || (!is_checked && !disable_on_uncheck)) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(sub_setting_id)}`).prop("disabled", false);
        if (include_label) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(sub_setting_id)}_label`)
                .parent()
                .removeClass("control-label-disabled");
        }
    } else if ((is_checked && !disable_on_uncheck) || (!is_checked && disable_on_uncheck)) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(sub_setting_id)}`).prop("disabled", true);
        if (include_label) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(sub_setting_id)}_label`)
                .parent()
                .addClass("control-label-disabled");
        }
    }
}


/***/ }),

/***/ "./static/js/settings_user_groups_legacy.js":
/*!**************************************************!*\
  !*** ./static/js/settings_user_groups_legacy.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_user_group": () => (/* binding */ add_user_group),
/* harmony export */   "can_edit": () => (/* binding */ can_edit),
/* harmony export */   "populate_user_groups": () => (/* binding */ populate_user_groups),
/* harmony export */   "reload": () => (/* binding */ reload),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "set_up": () => (/* binding */ set_up)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_user_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_user.hbs */ "./static/templates/confirm_dialog/confirm_delete_user.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_user_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_user_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_settings_add_user_group_modal_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/settings/add_user_group_modal.hbs */ "./static/templates/settings/add_user_group_modal.hbs");
/* harmony import */ var _templates_settings_add_user_group_modal_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_add_user_group_modal_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_admin_user_group_list_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/admin_user_group_list.hbs */ "./static/templates/settings/admin_user_group_list.hbs");
/* harmony import */ var _templates_settings_admin_user_group_list_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_user_group_list_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pill_typeahead__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./pill_typeahead */ "./static/js/pill_typeahead.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");




















const meta = {
    loaded: false,
};

function reset() {
    meta.loaded = false;
}

function reload() {
    if (!meta.loaded) {
        return;
    }

    const $user_groups_section = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-groups").expectOne();
    $user_groups_section.empty();
    populate_user_groups();
}

function can_edit(group_id) {
    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        return false;
    }

    // Admins and moderators are allowed to edit user groups even if they
    // are not a member of that user group. Members can edit user groups
    // only if they belong to that group.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(_people__WEBPACK_IMPORTED_MODULE_9__.my_current_user_id(), group_id);
}

function populate_user_groups() {
    const $user_groups_section = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-groups").expectOne();
    const user_groups_array = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    for (const data of user_groups_array) {
        $user_groups_section.append(
            _templates_settings_admin_user_group_list_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
                user_group: {
                    name: data.name,
                    id: data.id,
                    description: data.description,
                },
            }),
        );

        const pill_config = {
            show_user_status_emoji: false,
        };

        const $pill_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.pill-container[data-group-pills="${CSS.escape(data.id)}"]`);
        const pills = _user_pill__WEBPACK_IMPORTED_MODULE_11__.create_pills($pill_container, pill_config);

        function get_pill_user_ids() {
            return _user_pill__WEBPACK_IMPORTED_MODULE_11__.get_user_ids(pills);
        }

        const $userg = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`div.user-group[id="${CSS.escape(data.id)}"]`);
        for (const user_id of data.members) {
            const user = _people__WEBPACK_IMPORTED_MODULE_9__.get_by_user_id(user_id);
            _user_pill__WEBPACK_IMPORTED_MODULE_11__.append_user(user, pills);
        }

        function update_membership(group_id) {
            if (can_edit(group_id)) {
                return;
            }
            $userg.find(".name").attr("contenteditable", "false");
            $userg.find(".description").attr("contenteditable", "false");
            $userg.addClass("ntm");
            $pill_container.find(".input").attr("contenteditable", "false");
            $pill_container.find(".input").css("display", "none");
            $pill_container.addClass("not-editable");
            $pill_container.off("keydown", ".pill");
            $pill_container.off("keydown", ".input");
            $pill_container.off("click");
            $pill_container.on("click", (e) => {
                e.stopPropagation();
            });
            $pill_container.find(".pill").on("mouseenter", () => {
                $pill_container.find(".pill").find(".exit").css("opacity", "0.5");
            });
        }
        update_membership(data.id);

        function is_user_group_changed() {
            const draft_group = get_pill_user_ids();
            const group_data = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(data.id);
            const original_group = Array.from(group_data.members);
            const same_groups = lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(lodash__WEBPACK_IMPORTED_MODULE_1___default().sortBy(draft_group), lodash__WEBPACK_IMPORTED_MODULE_1___default().sortBy(original_group));
            const description = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .description`)
                .text()
                .trim();
            const name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .name`)
                .text()
                .trim();
            const $user_group_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .user-group-status`);

            if ($user_group_status.is(":visible")) {
                return false;
            }

            if (
                group_data.description === description &&
                group_data.name === name &&
                (!draft_group.length || same_groups)
            ) {
                return false;
            }
            return true;
        }

        function update_cancel_button() {
            if (!can_edit(data.id)) {
                return;
            }
            const $cancel_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                `#user-groups #${CSS.escape(data.id)} .save-status.btn-danger`,
            );
            const $saved_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .save-status.sea-green`);
            const $save_instructions = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .save-instructions`);

            if (is_user_group_changed() && !$cancel_button.is(":visible")) {
                $saved_button.fadeOut(0);
                $cancel_button.css({display: "inline-block", opacity: "0"}).fadeTo(400, 1);
                $save_instructions.css({display: "block", opacity: "0"}).fadeTo(400, 1);
            } else if (!is_user_group_changed() && $cancel_button.is(":visible")) {
                $cancel_button.fadeOut();
                $save_instructions.fadeOut();
            }
        }

        function show_saved_button() {
            const $cancel_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                `#user-groups #${CSS.escape(data.id)} .save-status.btn-danger`,
            );
            const $saved_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .save-status.sea-green`);
            const $save_instructions = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .save-instructions`);
            if (!$saved_button.is(":visible")) {
                $cancel_button.fadeOut(0);
                $save_instructions.fadeOut(0);
                $saved_button
                    .css({display: "inline-block", opacity: "0"})
                    .fadeTo(400, 1)
                    .delay(2000)
                    .fadeTo(400, 0);
            }
        }

        function save_members() {
            const draft_group = get_pill_user_ids();
            const group_data = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(data.id);
            const original_group = Array.from(group_data.members);
            const same_groups = lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(lodash__WEBPACK_IMPORTED_MODULE_1___default().sortBy(draft_group), lodash__WEBPACK_IMPORTED_MODULE_1___default().sortBy(original_group));
            if (!draft_group.length || same_groups) {
                return;
            }
            const added = lodash__WEBPACK_IMPORTED_MODULE_1___default().difference(draft_group, original_group);
            const removed = lodash__WEBPACK_IMPORTED_MODULE_1___default().difference(original_group, draft_group);
            _channel__WEBPACK_IMPORTED_MODULE_5__.post({
                url: "/json/user_groups/" + data.id + "/members",
                data: {
                    add: JSON.stringify(added),
                    delete: JSON.stringify(removed),
                },
                success() {
                    setTimeout(show_saved_button, 200);
                },
            });
        }

        function save_name_desc() {
            const $user_group_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .user-group-status`);
            const group_data = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(data.id);
            const description = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .description`)
                .text()
                .trim();
            const name = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .name`)
                .text()
                .trim();

            if (group_data.description === description && group_data.name === name) {
                return;
            }

            _channel__WEBPACK_IMPORTED_MODULE_5__.patch({
                url: "/json/user_groups/" + data.id,
                data: {
                    name,
                    description,
                },
                success() {
                    $user_group_status.hide();
                    setTimeout(show_saved_button, 200);
                },
                error(xhr) {
                    const errors = JSON.parse(xhr.responseText).msg;
                    xhr.responseText = JSON.stringify({msg: errors});
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $user_group_status);
                    update_cancel_button();
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .name`).text(group_data.name);
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)} .description`).text(
                        group_data.description,
                    );
                },
            });
        }

        function do_not_blur(except_class, event) {
            // Event generated from or inside the typeahead.
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.relatedTarget).closest(".typeahead").length) {
                return true;
            }

            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.relatedTarget).closest(`#user-groups #${CSS.escape(data.id)}`).length) {
                return [".pill-container", ".name", ".description", ".input", ".delete"].some(
                    (class_name) =>
                        class_name !== except_class &&
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.relatedTarget).closest(class_name).length,
                );
            }
            return false;
        }

        function auto_save(class_name, event) {
            if (!can_edit(data.id)) {
                return;
            }

            if (do_not_blur(class_name, event)) {
                return;
            }
            if (
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.relatedTarget).closest(`#user-groups #${CSS.escape(data.id)}`) &&
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.relatedTarget).closest(".save-status.btn-danger").length
            ) {
                reload();
                return;
            }
            save_name_desc();
            save_members();
        }

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)}`).on("blur", ".input", (event) => {
            auto_save(".input", event);
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)}`).on("blur", ".name", (event) => {
            auto_save(".name", event);
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)}`).on("input", ".name", () => {
            update_cancel_button();
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)}`).on("blur", ".description", (event) => {
            auto_save(".description", event);
        });
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#user-groups #${CSS.escape(data.id)}`).on("input", ".description", () => {
            update_cancel_button();
        });

        const $input = $pill_container.children(".input");
        if (can_edit(data.id)) {
            const opts = {update_func: update_cancel_button, user: true};
            _pill_typeahead__WEBPACK_IMPORTED_MODULE_10__.set_up($input, pills, opts);
        }

        if (can_edit(data.id)) {
            pills.onPillRemove(() => {
                // onPillRemove is fired before the pill is removed from
                // the DOM.
                update_cancel_button();
                setTimeout(() => {
                    $input.trigger("focus");
                }, 100);
            });
        }
    }
}

function add_user_group(e) {
    e.preventDefault();
    e.stopPropagation();

    const $user_group_status = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#dialog_error");

    const group = {
        members: JSON.stringify([_people__WEBPACK_IMPORTED_MODULE_9__.my_current_user_id()]),
    };

    for (const obj of jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-user-group-form").serializeArray()) {
        if (obj.value.trim() === "") {
            continue;
        }
        group[obj.name] = obj.value;
    }

    _channel__WEBPACK_IMPORTED_MODULE_5__.post({
        url: "/json/user_groups/create",
        data: group,
        success() {
            $user_group_status.hide();
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User group added!"}), $user_group_status);
            _dialog_widget__WEBPACK_IMPORTED_MODULE_7__.close_modal();
        },
        error(xhr) {
            $user_group_status.hide();
            const errors = JSON.parse(xhr.responseText).msg;
            xhr.responseText = JSON.stringify({msg: errors});
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $user_group_status);
        },
    });
}

function show_add_user_group_modal() {
    const html_body = _templates_settings_add_user_group_modal_hbs__WEBPACK_IMPORTED_MODULE_3___default()();

    function add_user_group_post_render() {
        const $add_user_group_input_element = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name");
        const $add_user_group_submit_button = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#add-user-group-modal .dialog_submit_button");
        $add_user_group_submit_button.prop("disabled", true);

        $add_user_group_input_element.on("input", () => {
            $add_user_group_submit_button.prop(
                "disabled",
                $add_user_group_input_element.val() === "",
            );
        });
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_7__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Add new user group"}),
        html_body,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save"}),
        help_link: "/help/user-groups",
        form_id: "add-user-group-form",
        id: "add-user-group-modal",
        on_click: add_user_group,
        on_shown: () => jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name").trigger("focus"),
        post_render: add_user_group_post_render,
    });
}

function set_up() {
    meta.loaded = true;
    populate_user_groups();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#show-add-user-group-modal").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        show_add_user_group_modal();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-groups").on("click", ".delete", function () {
        const group_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).parents(".user-group").attr("id"), 10);
        if (!can_edit(group_id)) {
            return;
        }
        const user_group = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(group_id);
        const $btn = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);

        function delete_user_group() {
            _channel__WEBPACK_IMPORTED_MODULE_5__.del({
                url: "/json/user_groups/" + group_id,
                data: {
                    id: group_id,
                },
                error() {
                    $btn.text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed!"}));
                },
            });
        }

        const html_body = _templates_confirm_dialog_confirm_delete_user_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
            group_name: user_group.name,
        });

        const user_group_name = user_group.name;

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete {user_group_name}?"}, {user_group_name}),
            html_body,
            on_click: delete_user_group,
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-groups").on("keypress", ".user-group h4 > span", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
        }
    });
}


/***/ }),

/***/ "./static/js/settings_users.js":
/*!*************************************!*\
  !*** ./static/js/settings_users.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "confirm_deactivation": () => (/* binding */ confirm_deactivation),
/* harmony export */   "confirm_reactivation": () => (/* binding */ confirm_reactivation),
/* harmony export */   "redraw_bots_list": () => (/* binding */ redraw_bots_list),
/* harmony export */   "set_up_bots": () => (/* binding */ set_up_bots),
/* harmony export */   "set_up_humans": () => (/* binding */ set_up_humans),
/* harmony export */   "show_edit_user_info_modal": () => (/* binding */ show_edit_user_info_modal),
/* harmony export */   "update_bot_data": () => (/* binding */ update_bot_data),
/* harmony export */   "update_user_data": () => (/* binding */ update_user_data),
/* harmony export */   "update_view_on_deactivate": () => (/* binding */ update_view_on_deactivate)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_user_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_user.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_user.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_user_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_user_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_reactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_reactivate_bot.hbs */ "./static/templates/confirm_dialog/confirm_reactivate_bot.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_reactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_reactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_confirm_dialog_confirm_reactivate_user_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_reactivate_user.hbs */ "./static/templates/confirm_dialog/confirm_reactivate_user.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_reactivate_user_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_reactivate_user_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_settings_admin_human_form_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/settings/admin_human_form.hbs */ "./static/templates/settings/admin_human_form.hbs");
/* harmony import */ var _templates_settings_admin_human_form_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_human_form_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/settings/admin_user_list.hbs */ "./static/templates/settings/admin_user_list.hbs");
/* harmony import */ var _templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _bot_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./bot_data */ "./static/js/bot_data.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _presence__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./presence */ "./static/js/presence.js");
/* harmony import */ var _settings_account__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./settings_account */ "./static/js/settings_account.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_panel_menu__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./settings_panel_menu */ "./static/js/settings_panel_menu.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");




























const section = {
    active: {},
    deactivated: {},
    bots: {},
};

function compare_a_b(a, b) {
    if (a > b) {
        return 1;
    } else if (a === b) {
        return 0;
    }
    return -1;
}

function sort_email(a, b) {
    const email_a = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a) || "";
    const email_b = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(b) || "";
    return compare_a_b(email_a.toLowerCase(), email_b.toLowerCase());
}

function sort_bot_email(a, b) {
    function email(bot) {
        return (bot.display_email || "").toLowerCase();
    }

    return compare_a_b(email(a), email(b));
}

function sort_role(a, b) {
    return compare_a_b(a.role, b.role);
}

function sort_bot_owner(a, b) {
    function owner_name(bot) {
        return (bot.bot_owner_full_name || "").toLowerCase();
    }

    return compare_a_b(owner_name(a), owner_name(b));
}

function sort_last_active(a, b) {
    return compare_a_b(
        _presence__WEBPACK_IMPORTED_MODULE_13__.last_active_date(a.user_id) || 0,
        _presence__WEBPACK_IMPORTED_MODULE_13__.last_active_date(b.user_id) || 0,
    );
}

function sort_user_id(a, b) {
    return compare_a_b(a.user_id, b.user_id);
}

function get_user_info_row(user_id) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`tr.user_row[data-user-id='${CSS.escape(user_id)}']`);
}

function update_view_on_deactivate(user_id) {
    const $row = get_user_info_row(user_id);
    if ($row.length === 0) {
        return;
    }

    const $button = $row.find("button.deactivate");
    const $user_role = $row.find(".user_role");
    $button.prop("disabled", false);
    $row.find("button.open-user-form").hide();
    $row.find("i.deactivated-user-icon").show();
    $button.addClass("btn-warning reactivate");
    $button.removeClass("deactivate btn-danger");
    $button.empty().append(jquery__WEBPACK_IMPORTED_MODULE_0___default()("<i>").addClass(["fa", "fa-user-plus"]).attr("aria-hidden", "true"));
    $button.attr("title", "Reactivate");
    $row.addClass("deactivated_user");

    if ($user_role) {
        const user_id = $row.data("user-id");
        $user_role.text(
            `${Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivated"})} (${_people__WEBPACK_IMPORTED_MODULE_12__.get_user_type(user_id)})`,
        );
    }
}

function update_view_on_reactivate($row) {
    const $button = $row.find("button.reactivate");
    const $user_role = $row.find(".user_role");
    $row.find("button.open-user-form").show();
    $row.find("i.deactivated-user-icon").hide();
    $button.addClass("btn-danger deactivate");
    $button.removeClass("btn-warning reactivate");
    $button.attr("title", "Deactivate");
    $button.empty().append(jquery__WEBPACK_IMPORTED_MODULE_0___default()("<i>").addClass(["fa", "fa-user-times"]).attr("aria-hidden", "true"));
    $row.removeClass("deactivated_user");

    if ($user_role) {
        const user_id = $row.data("user-id");
        $user_role.text(_people__WEBPACK_IMPORTED_MODULE_12__.get_user_type(user_id));
    }
}

function get_status_field() {
    const current_tab = _settings_panel_menu__WEBPACK_IMPORTED_MODULE_16__.org_settings.current_tab();
    switch (current_tab) {
        case "deactivated-users-admin":
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#deactivated-user-field-status").expectOne();
        case "user-list-admin":
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-field-status").expectOne();
        case "bot-list-admin":
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#bot-field-status").expectOne();
        default:
            throw new Error("Invalid admin settings page");
    }
}

function failed_listing_users() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subs_page_loading_indicator"));
    const status = get_status_field();
    const user_id = _people__WEBPACK_IMPORTED_MODULE_12__.my_current_user_id();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Error while listing users for user_id " + user_id, status);
}

function populate_users() {
    const active_user_ids = _people__WEBPACK_IMPORTED_MODULE_12__.get_active_human_ids();
    const deactivated_user_ids = _people__WEBPACK_IMPORTED_MODULE_12__.get_non_active_human_ids();

    if (active_user_ids.length === 0 && deactivated_user_ids.length === 0) {
        failed_listing_users();
    }

    section.active.create_table(active_user_ids);
    section.deactivated.create_table(deactivated_user_ids);
}

function reset_scrollbar($sel) {
    return function () {
        _ui__WEBPACK_IMPORTED_MODULE_17__.reset_scrollbar($sel);
    };
}

function bot_owner_full_name(owner_id) {
    if (!owner_id) {
        return undefined;
    }

    const bot_owner = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(owner_id);
    if (!bot_owner) {
        return undefined;
    }

    return bot_owner.full_name;
}

function bot_info(bot_user_id) {
    const bot_user = _bot_data__WEBPACK_IMPORTED_MODULE_7__.get(bot_user_id);

    if (!bot_user) {
        return undefined;
    }

    const owner_id = bot_user.owner_id;

    const info = {};

    info.is_bot = true;
    info.role = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(bot_user_id).role;
    info.is_active = bot_user.is_active;
    info.user_id = bot_user.user_id;
    info.full_name = bot_user.full_name;
    info.bot_owner_id = owner_id;
    info.user_role_text = _people__WEBPACK_IMPORTED_MODULE_12__.get_user_type(bot_user_id);

    // Convert bot type id to string for viewing to the users.
    info.bot_type = _settings_bots__WEBPACK_IMPORTED_MODULE_15__.type_id_to_string(bot_user.bot_type);

    info.bot_owner_full_name = bot_owner_full_name(owner_id);

    if (!info.bot_owner_full_name) {
        info.no_owner = true;
        info.bot_owner_full_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No owner"});
    }

    info.is_current_user = false;
    info.can_modify = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    // It's always safe to show the real email addresses for bot users
    info.display_email = bot_user.email;

    return info;
}

function get_last_active(user) {
    const last_active_date = _presence__WEBPACK_IMPORTED_MODULE_13__.last_active_date(user.user_id);

    if (!last_active_date) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unknown"});
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(last_active_date).time_str;
}

function human_info(person) {
    const info = {};

    info.is_bot = false;
    info.user_role_text = _people__WEBPACK_IMPORTED_MODULE_12__.get_user_type(person.user_id);
    info.is_active = _people__WEBPACK_IMPORTED_MODULE_12__.is_person_active(person.user_id);
    info.user_id = person.user_id;
    info.full_name = person.full_name;
    info.bot_owner_id = person.bot_owner_id;

    info.can_modify = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    info.is_current_user = _people__WEBPACK_IMPORTED_MODULE_12__.is_my_user_id(person.user_id);
    info.cannot_deactivate = info.is_current_user || (person.is_owner && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    info.display_email = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(person);

    if (info.is_active) {
        // TODO: We might just want to show this
        // for deactivated users, too, even though
        // it might usually just be undefined.
        info.last_active_date = get_last_active(person);
    }

    return info;
}

let bot_list_widget;

section.bots.create_table = () => {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_bots_loading_indicator"), {text: "Loading..."});
    const $bots_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_bots_table");
    $bots_table.hide();
    const bot_user_ids = _bot_data__WEBPACK_IMPORTED_MODULE_7__.all_user_ids();

    bot_list_widget = _list_widget__WEBPACK_IMPORTED_MODULE_11__.create($bots_table, bot_user_ids, {
        name: "admin_bot_list",
        get_item: bot_info,
        modifier: (_templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5___default()),
        html_selector: (item) => `tr[data-user-id='${CSS.escape(item)}']`,
        filter: {
            $element: $bots_table.closest(".settings-section").find(".search"),
            predicate(item, value) {
                if (!item) {
                    return false;
                }
                return (
                    item.full_name.toLowerCase().includes(value) ||
                    item.display_email.toLowerCase().includes(value)
                );
            },
            onupdate: reset_scrollbar($bots_table),
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-bot-list").expectOne(),
        init_sort: ["alphabetic", "full_name"],
        sort_fields: {
            email: sort_bot_email,
            bot_owner: sort_bot_owner,
            role: sort_role,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-bot-list .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_bots_loading_indicator"));
    $bots_table.show();
};

section.active.create_table = (active_users) => {
    const $users_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_users_table");
    _list_widget__WEBPACK_IMPORTED_MODULE_11__.create($users_table, active_users, {
        name: "users_table_list",
        get_item: _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id,
        modifier(item) {
            const info = human_info(item);
            return _templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5___default()(info);
        },
        filter: {
            $element: $users_table.closest(".settings-section").find(".search"),
            filterer: _people__WEBPACK_IMPORTED_MODULE_12__.filter_for_user_settings_search,
            onupdate: reset_scrollbar($users_table),
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-user-list").expectOne(),
        init_sort: ["alphabetic", "full_name"],
        sort_fields: {
            email: sort_email,
            last_active: sort_last_active,
            role: sort_role,
            id: sort_user_id,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-user-list .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_users_loading_indicator"));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_users_table").show();
};

section.deactivated.create_table = (deactivated_users) => {
    const $deactivated_users_table = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_deactivated_users_table");
    _list_widget__WEBPACK_IMPORTED_MODULE_11__.create($deactivated_users_table, deactivated_users, {
        name: "deactivated_users_table_list",
        get_item: _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id,
        modifier(item) {
            const info = human_info(item);
            return _templates_settings_admin_user_list_hbs__WEBPACK_IMPORTED_MODULE_5___default()(info);
        },
        filter: {
            $element: $deactivated_users_table.closest(".settings-section").find(".search"),
            filterer: _people__WEBPACK_IMPORTED_MODULE_12__.filter_for_user_settings_search,
            onupdate: reset_scrollbar($deactivated_users_table),
        },
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-deactivated-users-list").expectOne(),
        init_sort: ["alphabetic", "full_name"],
        sort_fields: {
            email: sort_email,
            role: sort_role,
            id: sort_user_id,
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-deactivated-users-list .progressive-table-wrapper"),
    });

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_deactivated_users_loading_indicator"));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_deactivated_users_table").show();
};

function update_bot_data(bot_user_id) {
    if (!bot_list_widget) {
        return;
    }

    bot_list_widget.render_item(bot_user_id);
}

function update_user_data(user_id, new_data) {
    const $user_row = get_user_info_row(user_id);

    if ($user_row.length === 0) {
        return;
    }

    if (new_data.full_name !== undefined) {
        // Update the full name in the table
        $user_row.find(".user_name").text(new_data.full_name);
    }

    if (new_data.role !== undefined) {
        $user_row.find(".user_role").text(_people__WEBPACK_IMPORTED_MODULE_12__.get_user_type(user_id));
    }
}

function redraw_bots_list() {
    if (!bot_list_widget) {
        return;
    }

    // In order to properly redraw after a user may have been added,
    // we need to update the bot_list_widget with the new set of bot
    // user IDs to display.
    const bot_user_ids = _bot_data__WEBPACK_IMPORTED_MODULE_7__.all_user_ids();
    bot_list_widget.replace_list_data(bot_user_ids);
    bot_list_widget.hard_redraw();
}

function start_data_load() {
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_users_loading_indicator"), {text: "Loading..."});
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_page_deactivated_users_loading_indicator"), {
        text: "Loading...",
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_deactivated_users_table").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_users_table").hide();

    populate_users();
}

function get_human_profile_data(fields_user_pills) {
    /*
        This formats custom profile field data to send to the server.
        See render_admin_human_form and open_human_form
        to see how the form is built.

        TODO: Ideally, this logic would be cleaned up or deduplicated with
        the settings_account.js logic.
    */
    const new_profile_data = [];
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-user-form .custom_user_field_value").each(function () {
        // Remove duplicate datepicker input element generated flatpickr library
        if (!jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).hasClass("form-control")) {
            new_profile_data.push({
                id: Number.parseInt(
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).closest(".custom_user_field").attr("data-field-id"),
                    10,
                ),
                value: jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).val(),
            });
        }
    });
    // Append user type field values also
    for (const [field_id, field_pills] of fields_user_pills) {
        if (field_pills) {
            const user_ids = _user_pill__WEBPACK_IMPORTED_MODULE_18__.get_user_ids(field_pills);
            new_profile_data.push({
                id: field_id,
                value: user_ids,
            });
        }
    }

    return new_profile_data;
}

function confirm_deactivation(user_id, handle_confirm, loading_spinner) {
    // Knowing the number of invites requires making this request. If the request fails,
    // we won't have the accurate number of invites. So, we don't show the modal if the
    // request fails.
    _channel__WEBPACK_IMPORTED_MODULE_8__.get({
        url: "/json/invites",
        timeout: 10 * 1000,
        success(data) {
            let number_of_invites_by_user = 0;
            for (const invite of data.invites) {
                if (invite.invited_by_user_id === user_id) {
                    number_of_invites_by_user = number_of_invites_by_user + 1;
                }
            }

            const bots_owned_by_user = _bot_data__WEBPACK_IMPORTED_MODULE_7__.get_all_bots_owned_by_user(user_id);
            const user = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_id);
            const realm_uri = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
            const realm_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
            const opts = {
                username: user.full_name,
                email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user),
                bots_owned_by_user,
                number_of_invites_by_user,
                admin_email: _people__WEBPACK_IMPORTED_MODULE_12__.my_current_email(),
                realm_uri,
                realm_name,
            };
            const html_body = _templates_confirm_dialog_confirm_deactivate_user_hbs__WEBPACK_IMPORTED_MODULE_1___default()(opts);

            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.launch({
                html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: "Deactivate {name}?"},
                    {name: user.full_name},
                ),
                help_link: "/help/deactivate-or-reactivate-a-user#deactivating-a-user",
                html_body,
                html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Deactivate"}),
                id: "deactivate-user-modal",
                on_click: handle_confirm,
                loading_spinner,
            });
        },
    });
}

function handle_deactivation($tbody) {
    $tbody.on("click", ".deactivate", (e) => {
        // This click event must not get propagated to parent container otherwise the modal
        // will not show up because of a call to `close_active_modal` in `settings.js`.
        e.preventDefault();
        e.stopPropagation();

        const $row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".user_row");
        const user_id = $row.data("user-id");

        function handle_confirm() {
            const url = "/json/users/" + encodeURIComponent(user_id);
            let data = {};
            if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".send_email").is(":checked")) {
                data = {
                    deactivation_notification_comment: jquery__WEBPACK_IMPORTED_MODULE_0___default()(".email_field_textarea").val(),
                };
            }

            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.del, url, data);
        }

        confirm_deactivation(user_id, handle_confirm, true);
    });
}

function handle_bot_deactivation($tbody) {
    $tbody.on("click", ".deactivate", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const $button_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target);
        const $row = $button_elem.closest(".user_row");
        const bot_id = Number.parseInt($row.attr("data-user-id"), 10);

        function handle_confirm() {
            const url = "/json/bots/" + encodeURIComponent(bot_id);
            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.del, url);
        }

        _settings_bots__WEBPACK_IMPORTED_MODULE_15__.confirm_bot_deactivation(bot_id, handle_confirm, true);
    });
}

function confirm_reactivation(user_id, handle_confirm, loading_spinner) {
    const user = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_id);
    const opts = {
        username: user.full_name,
    };

    let html_body;
    // check if bot or human
    if (user.is_bot) {
        html_body = _templates_confirm_dialog_confirm_reactivate_bot_hbs__WEBPACK_IMPORTED_MODULE_2___default()(opts);
    } else {
        html_body = _templates_confirm_dialog_confirm_reactivate_user_hbs__WEBPACK_IMPORTED_MODULE_3___default()(opts);
    }

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_9__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Reactivate {name}"}, {name: user.full_name}),
        help_link: "/help/deactivate-or-reactivate-a-user#reactivating-a-user",
        html_body,
        on_click: handle_confirm,
        loading_spinner,
    });
}

function handle_reactivation($tbody) {
    $tbody.on("click", ".reactivate", (e) => {
        e.preventDefault();
        e.stopPropagation();
        // Go up the tree until we find the user row, then grab the email element
        const $button_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target);
        const $row = $button_elem.closest(".user_row");
        const user_id = Number.parseInt($row.attr("data-user-id"), 10);

        function handle_confirm() {
            const $row = get_user_info_row(user_id);
            const url = "/json/users/" + encodeURIComponent(user_id) + "/reactivate";
            const opts = {
                success_continuation() {
                    update_view_on_reactivate($row);
                },
            };
            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.post, url, {}, opts);
        }

        confirm_reactivation(user_id, handle_confirm, true);
    });
}

function show_edit_user_info_modal(user_id, from_user_info_popover) {
    const person = _people__WEBPACK_IMPORTED_MODULE_12__.get_by_user_id(user_id);

    if (!person) {
        return;
    }

    const user_email = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(person);

    const html_body = _templates_settings_admin_human_form_hbs__WEBPACK_IMPORTED_MODULE_4___default()({
        user_id,
        email: user_email,
        full_name: person.full_name,
        user_role_values: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        disable_role_dropdown: person.is_owner && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    let fields_user_pills;

    function set_role_dropdown_and_fields_user_pills() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-role-select").val(person.role);
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-role-select")
                .find(`option[value="${CSS.escape(Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))}"]`)
                .hide();
        }

        const element = "#edit-user-form .custom-profile-field-form";
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(element).empty();
        _settings_account__WEBPACK_IMPORTED_MODULE_14__.append_custom_profile_fields(element, user_id);
        _settings_account__WEBPACK_IMPORTED_MODULE_14__.initialize_custom_date_type_fields(element);
        fields_user_pills = _settings_account__WEBPACK_IMPORTED_MODULE_14__.initialize_custom_user_type_fields(
            element,
            user_id,
            true,
            false,
        );
        _settings_account__WEBPACK_IMPORTED_MODULE_14__.initialize_custom_pronouns_type_fields(element);

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-user-form").on("click", ".deactivate_user_button", (e) => {
            e.preventDefault();
            e.stopPropagation();
            const user_id = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-user-form").data("user-id");
            function handle_confirm() {
                const url = "/json/users/" + encodeURIComponent(user_id);
                _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.del, url);
            }
            const open_deactivate_modal_callback = () =>
                confirm_deactivation(user_id, handle_confirm, true);
            _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.close_modal(open_deactivate_modal_callback);
        });
    }

    function submit_user_details() {
        const role = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-role-select").val().trim(), 10);
        const $full_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-user-form").find("input[name='full_name']");
        const profile_data = get_human_profile_data(fields_user_pills);

        const url = "/json/users/" + encodeURIComponent(user_id);
        const data = {
            full_name: $full_name.val(),
            role: JSON.stringify(role),
            profile_data: JSON.stringify(profile_data),
        };
        const opts = {
            error_continuation() {
                // Scrolling modal to top, to make error visible to user.
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#edit-user-form")
                    .closest(".simplebar-content-wrapper")
                    .animate({scrollTop: 0}, "fast");
            },
        };
        _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.submit_api_request(_channel__WEBPACK_IMPORTED_MODULE_8__.patch, url, data, opts);
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_10__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Manage user"}),
        html_body,
        on_click: submit_user_details,
        post_render: set_role_dropdown_and_fields_user_pills,
        loading_spinner: from_user_info_popover,
    });
}

function handle_human_form($tbody) {
    $tbody.on("click", ".open-user-form", (e) => {
        e.stopPropagation();
        e.preventDefault();
        const user_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-user-id"), 10);
        show_edit_user_info_modal(user_id, false);
    });
}

function handle_bot_form($tbody) {
    $tbody.on("click", ".open-user-form", (e) => {
        e.stopPropagation();
        e.preventDefault();
        const user_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).attr("data-user-id"), 10);
        _settings_bots__WEBPACK_IMPORTED_MODULE_15__.show_edit_bot_info_modal(user_id, false);
    });
}

section.active.handle_events = () => {
    const $tbody = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_users_table").expectOne();

    handle_deactivation($tbody);
    handle_reactivation($tbody);
    handle_human_form($tbody);
};

section.deactivated.handle_events = () => {
    const $tbody = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_deactivated_users_table").expectOne();

    handle_deactivation($tbody);
    handle_reactivation($tbody);
    handle_human_form($tbody);
};

section.bots.handle_events = () => {
    const $tbody = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin_bots_table").expectOne();

    handle_bot_deactivation($tbody);
    handle_reactivation($tbody);
    handle_bot_form($tbody);
};

function set_up_humans() {
    start_data_load();
    section.active.handle_events();
    section.deactivated.handle_events();
}

function set_up_bots() {
    section.bots.handle_events();
    section.bots.create_table();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#admin-bot-list .add-a-new-bot").on("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        _settings_bots__WEBPACK_IMPORTED_MODULE_15__.add_a_new_bot();
    });
}


/***/ }),

/***/ "./static/js/spectators.js":
/*!*********************************!*\
  !*** ./static/js/spectators.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "login_to_access": () => (/* binding */ login_to_access)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_login_to_access_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/login_to_access.hbs */ "./static/templates/login_to_access.hbs");
/* harmony import */ var _templates_login_to_access_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_login_to_access_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
// Module for displaying the modal asking spectators to log in when
// attempting to do things that are not possible as a spectator (like
// add an emoji reaction, star a message, etc.).  While in many cases,
// we will prefer to hide menu options that don't make sense for
// spectators, this modal is useful for everything that doesn't make
// sense to remove from a design perspective.










function login_to_access(empty_narrow) {
    // Hide all overlays, popover and go back to the previous hash if the
    // hash has changed.
    const login_link = _hash_util__WEBPACK_IMPORTED_MODULE_3__.build_login_link();
    const realm_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").append(
        _templates_login_to_access_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
            signup_link: "/register",
            login_link,
            empty_narrow,
            realm_name,
        }),
    );

    _overlays__WEBPACK_IMPORTED_MODULE_4__.open_modal("login_to_access_modal", {
        autoremove: true,
        on_hide() {
            _browser_history__WEBPACK_IMPORTED_MODULE_2__.return_to_web_public_hash();
        },
    });
}


/***/ }),

/***/ "./static/js/starred_messages.js":
/*!***************************************!*\
  !*** ./static/js/starred_messages.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add": () => (/* binding */ add),
/* harmony export */   "get_count": () => (/* binding */ get_count),
/* harmony export */   "get_count_in_topic": () => (/* binding */ get_count_in_topic),
/* harmony export */   "get_starred_msg_ids": () => (/* binding */ get_starred_msg_ids),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "remove": () => (/* binding */ remove),
/* harmony export */   "rerender_ui": () => (/* binding */ rerender_ui),
/* harmony export */   "starred_ids": () => (/* binding */ starred_ids)
/* harmony export */ });
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
/* harmony import */ var _top_left_corner__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./top_left_corner */ "./static/js/top_left_corner.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






const starred_ids = new Set();

function initialize() {
    starred_ids.clear();

    for (const id of Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        starred_ids.add(id);
    }

    rerender_ui();
}

function add(ids) {
    for (const id of ids) {
        starred_ids.add(id);
    }

    rerender_ui();
}

function remove(ids) {
    for (const id of ids) {
        starred_ids.delete(id);
    }

    rerender_ui();
}

function get_count() {
    return starred_ids.size;
}

function get_starred_msg_ids() {
    return Array.from(starred_ids);
}

function get_count_in_topic(stream_id, topic) {
    if (stream_id === undefined || topic === undefined) {
        return 0;
    }

    const messages = Array.from(starred_ids).filter((id) => {
        const message = _message_store__WEBPACK_IMPORTED_MODULE_0__.get(id);

        if (message === undefined) {
            // We know the `id` from the initial data fetch from page_params,
            // but the message itself hasn't been fetched from the server yet.
            // We ignore this message, since we can't check if it belongs to
            // the topic, but it could, meaning this implementation isn't
            // completely correct.
            // Since this function is used only when opening the topic popover,
            // and not for actually unstarring messages, this discrepancy is
            // probably acceptable. The worst it could manifest as is the topic
            // popover not having the "Unstar all messages in topic" option, when
            // it should have had.
            return false;
        }

        return (
            message.type === "stream" &&
            message.stream_id === stream_id &&
            message.topic.toLowerCase() === topic.toLowerCase()
        );
    });

    return messages.length;
}

function rerender_ui() {
    let count = get_count();

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // This essentially hides the count
        count = 0;
    }

    _stream_popover__WEBPACK_IMPORTED_MODULE_2__.hide_topic_popover();
    _top_left_corner__WEBPACK_IMPORTED_MODULE_3__.update_starred_count(count);
    _stream_popover__WEBPACK_IMPORTED_MODULE_2__.hide_starred_messages_popover();
}


/***/ }),

/***/ "./static/js/starred_messages_ui.js":
/*!******************************************!*\
  !*** ./static/js/starred_messages_ui.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "confirm_unstar_all_messages": () => (/* binding */ confirm_unstar_all_messages),
/* harmony export */   "confirm_unstar_all_messages_in_topic": () => (/* binding */ confirm_unstar_all_messages_in_topic)
/* harmony export */ });
/* harmony import */ var _templates_confirm_dialog_confirm_unstar_all_messages_hbs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_unstar_all_messages.hbs */ "./static/templates/confirm_dialog/confirm_unstar_all_messages.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_unstar_all_messages_hbs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_unstar_all_messages_hbs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_unstar_all_messages_in_topic_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_unstar_all_messages_in_topic.hbs */ "./static/templates/confirm_dialog/confirm_unstar_all_messages_in_topic.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_unstar_all_messages_in_topic_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_unstar_all_messages_in_topic_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_flags__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_flags */ "./static/js/message_flags.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");








function confirm_unstar_all_messages() {
    const html_body = _templates_confirm_dialog_confirm_unstar_all_messages_hbs__WEBPACK_IMPORTED_MODULE_0___default()();

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_2__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unstar all messages"}),
        html_body,
        on_click: _message_flags__WEBPACK_IMPORTED_MODULE_4__.unstar_all_messages,
    });
}

function confirm_unstar_all_messages_in_topic(stream_id, topic) {
    function on_click() {
        _message_flags__WEBPACK_IMPORTED_MODULE_4__.unstar_all_messages_in_topic(stream_id, topic);
    }

    const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_5__.maybe_get_stream_name(stream_id);
    if (stream_name === undefined) {
        return;
    }

    const html_body = _templates_confirm_dialog_confirm_unstar_all_messages_in_topic_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        stream_name,
        topic,
    });

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_2__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unstar messages in topic"}),
        html_body,
        on_click,
    });
}


/***/ }),

/***/ "./static/js/stream_bar.js":
/*!*********************************!*\
  !*** ./static/js/stream_bar.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "decorate": () => (/* binding */ decorate)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");





function update_compose_stream_icon(stream_name) {
    const $streamfield = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_message_recipient_stream");
    const $globe_icon = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-globe-icon");
    const $lock_icon = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-lock-icon");

    // Reset state
    $globe_icon.hide();
    $lock_icon.hide();
    $streamfield.removeClass("lock-padding");

    if (_stream_data__WEBPACK_IMPORTED_MODULE_2__.is_invite_only_by_stream_name(stream_name)) {
        $lock_icon.show();
        $streamfield.addClass("lock-padding");
    } else if (_stream_data__WEBPACK_IMPORTED_MODULE_2__.is_web_public_by_stream_name(stream_name)) {
        $globe_icon.show();
        $streamfield.addClass("lock-padding");
    }
}

// In an attempt to decrease mixing, set stream bar
// color look like the stream being used.
// (In particular, if there's a color associated with it,
//  have that color be reflected here too.)
function decorate(stream_name, $element, is_compose) {
    if (stream_name === undefined) {
        return;
    }
    const color = _stream_data__WEBPACK_IMPORTED_MODULE_2__.get_color(stream_name);
    if (is_compose) {
        update_compose_stream_icon(stream_name);
    }
    $element
        .css("background-color", color)
        .removeClass("dark_background")
        .addClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(color));
}


/***/ }),

/***/ "./static/js/stream_color.js":
/*!***********************************!*\
  !*** ./static/js/stream_color.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "set_colorpicker_color": () => (/* binding */ set_colorpicker_color),
/* harmony export */   "sidebar_popover_colorpicker_options": () => (/* binding */ sidebar_popover_colorpicker_options),
/* harmony export */   "sidebar_popover_colorpicker_options_full": () => (/* binding */ sidebar_popover_colorpicker_options_full),
/* harmony export */   "update_stream_color": () => (/* binding */ update_stream_color)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");







function update_table_stream_color(table, stream_name, color) {
    // This is ugly, but temporary, as the new design will make it
    // so that we only have color in the headers.
    const style = color;

    const $stream_labels = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#floating_recipient_bar").add(table).find(".stream_label");

    for (const label of $stream_labels) {
        const $label = jquery__WEBPACK_IMPORTED_MODULE_0___default()(label);
        if ($label.text().trim() === stream_name) {
            const $messages = $label.closest(".recipient_row").children(".message_row");
            $messages
                .children(".messagebox")
                .css(
                    "box-shadow",
                    "inset 2px 0px 0px 0px " + style + ", -1px 0px 0px 0px " + style,
                );
            $messages
                .children(".date_row")
                .css(
                    "box-shadow",
                    "inset 2px 0px 0px 0px " + style + ", -1px 0px 0px 0px " + style,
                );
            $label.css({background: style, "border-left-color": style});
            $label.removeClass("dark_background");
            $label.addClass(Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(color));
        }
    }
}

function update_stream_sidebar_swatch_color(id, color) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#stream_sidebar_swatch_${CSS.escape(id)}`).css("background-color", color);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#stream_sidebar_privacy_swatch_${CSS.escape(id)}`).css("color", color);
}

function update_historical_message_color(stream_name, color) {
    update_table_stream_color(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table"), stream_name, color);
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".focused_table").attr("id") !== "#zhome") {
        update_table_stream_color(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#zhome"), stream_name, color);
    }
}

const stream_color_palette = [
    ["a47462", "c2726a", "e4523d", "e7664d", "ee7e4a", "f4ae55"],
    ["76ce90", "53a063", "94c849", "bfd56f", "fae589", "f5ce6e"],
    ["a6dcbf", "addfe5", "a6c7e5", "4f8de4", "95a5fd", "b0a5fd"],
    ["c2c2c2", "c8bebf", "c6a8ad", "e79ab5", "bd86e5", "9987e1"],
];

const subscriptions_table_colorpicker_options = {
    clickoutFiresChange: true,
    showPalette: true,
    showInput: true,
    palette: stream_color_palette,
};

function set_colorpicker_color(colorpicker, color) {
    colorpicker.spectrum({
        ...subscriptions_table_colorpicker_options,
        color,
        container: "#subscription_overlay .subscription_settings.show",
    });
}

function update_stream_color(sub, color, {update_historical = false} = {}) {
    sub.color = color;
    const stream_id = sub.stream_id;
    // The swatch in the subscription row header.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.stream-row[data-stream-id='${CSS.escape(stream_id)}'] .icon`).css(
        "background-color",
        color,
    );
    // The swatch in the color picker.
    set_colorpicker_color(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            `#subscription_overlay .subscription_settings[data-stream-id='${CSS.escape(
                stream_id,
            )}'] .colorpicker`,
        ),
        color,
    );
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#subscription_overlay .subscription_settings[data-stream-id='${CSS.escape(
            stream_id,
        )}'] .large-icon`,
    ).css("color", color);

    if (update_historical) {
        update_historical_message_color(sub.name, color);
    }
    update_stream_sidebar_swatch_color(stream_id, color);
    _message_view_header__WEBPACK_IMPORTED_MODULE_2__.colorize_message_view_header();
}

const sidebar_popover_colorpicker_options_full = {
    clickoutFiresChange: false,
    showPalette: true,
    showInput: true,
    flat: true,
    cancelText: "",
    chooseText: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Confirm"}),
    palette: stream_color_palette,
    change: picker_do_change_color,
};

function picker_do_change_color(color) {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".colorpicker").spectrum("destroy");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".colorpicker").spectrum(sidebar_popover_colorpicker_options_full);
    const stream_id = Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("stream_id"), 10);
    const hex_color = color.toHexString();
    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_3__.set_color(stream_id, hex_color);
}
subscriptions_table_colorpicker_options.change = picker_do_change_color;

const sidebar_popover_colorpicker_options = {
    clickoutFiresChange: true,
    showPaletteOnly: true,
    showPalette: true,
    showInput: true,
    flat: true,
    palette: stream_color_palette,
    change: picker_do_change_color,
};


/***/ }),

/***/ "./static/js/stream_create.js":
/*!************************************!*\
  !*** ./static/js/stream_create.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_name": () => (/* binding */ get_name),
/* harmony export */   "new_stream_clicked": () => (/* binding */ new_stream_clicked),
/* harmony export */   "reset_created_stream": () => (/* binding */ reset_created_stream),
/* harmony export */   "set_name": () => (/* binding */ set_name),
/* harmony export */   "set_up_handlers": () => (/* binding */ set_up_handlers),
/* harmony export */   "show_new_stream_modal": () => (/* binding */ show_new_stream_modal)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tippy_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! tippy.js */ "./node_modules/tippy.js/dist/tippy.esm.js");
/* harmony import */ var _templates_announce_stream_docs_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/announce_stream_docs.hbs */ "./static/templates/announce_stream_docs.hbs");
/* harmony import */ var _templates_announce_stream_docs_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_announce_stream_docs_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_subscription_invites_warning_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_subscription_invites_warning.hbs */ "./static/templates/confirm_dialog/confirm_subscription_invites_warning.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_subscription_invites_warning_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_subscription_invites_warning_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_create_subscribers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_create_subscribers */ "./static/js/stream_create_subscribers.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




















let created_stream;

function reset_created_stream() {
    created_stream = undefined;
}

function set_name(stream) {
    created_stream = stream;
}

function get_name() {
    return created_stream;
}

class StreamSubscriptionError {
    report_no_subs_to_stream() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_subscription_error").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You cannot create a stream with no subscribers!"}),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_subscription_error").show();
    }

    cant_create_stream_without_subscribing() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_subscription_error").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage:
                    "You must be an organization administrator to create a stream without subscribing.",
            }),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_subscription_error").show();
    }

    clear_errors() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_subscription_error").hide();
    }
}
const stream_subscription_error = new StreamSubscriptionError();

class StreamNameError {
    report_already_exists() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_name_error").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "A stream with this name already exists"}),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_name_error").show();
    }

    clear_errors() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_name_error").hide();
    }

    report_empty_stream() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_name_error").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "A stream needs to have a name"}));
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_name_error").show();
    }

    select() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").trigger("focus").trigger("select");
    }

    pre_validate(stream_name) {
        // Don't worry about empty strings...we just want to call this
        // to warn users early before they start doing too much work
        // after they make the effort to type in a stream name.  (The
        // use case here is that I go to create a stream, only to find
        // out it already exists, and I was just too lazy to look at
        // the public streams that I'm not subscribed to yet.  Once I
        // realize the stream already exists, I may want to cancel.)
        if (stream_name && _stream_data__WEBPACK_IMPORTED_MODULE_8__.get_sub(stream_name)) {
            this.report_already_exists();
            return;
        }

        this.clear_errors();
    }

    validate_for_submit(stream_name) {
        if (!stream_name) {
            this.report_empty_stream();
            this.select();
            return false;
        }

        if (_stream_data__WEBPACK_IMPORTED_MODULE_8__.get_sub(stream_name)) {
            this.report_already_exists();
            this.select();
            return false;
        }

        // If we got this far, then we think we have a new unique stream
        // name, so we'll submit to the server.  (It's still plausible,
        // however, that there's some invite-only stream that we don't
        // know about locally that will cause a name collision.)
        return true;
    }
}
const stream_name_error = new StreamNameError();

// Stores the previous state of the stream creation checkbox.
let stream_announce_previous_value =
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

// Within the new stream modal...
function update_announce_stream_state() {
    // If there is no notifications_stream, we simply hide the widget.
    if (!_stream_data__WEBPACK_IMPORTED_MODULE_8__.realm_has_notifications_stream()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#announce-new-stream").hide();
        return;
    }

    // If the stream is invite only, disable the "Announce stream" option.
    // Otherwise enable it.
    const $announce_stream_checkbox = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#announce-new-stream input");
    const $announce_stream_label = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#announce-new-stream");
    let disable_it = false;
    const privacy_type = jquery__WEBPACK_IMPORTED_MODULE_0___default()("input:radio[name=privacy]:checked").val();
    const is_invite_only =
        privacy_type === "invite-only" || privacy_type === "invite-only-public-history";
    $announce_stream_label.removeClass("control-label-disabled");

    // Here, we arrange to save the state of the announce checkbox
    // when switching to creating a private stream; we will restore it
    // when switching back to a public stream. This input-disabled
    // check prevents overwriting stream_announce_previous_value with
    // the false when switching between private stream types.
    if (!$announce_stream_checkbox.prop("disabled")) {
        stream_announce_previous_value = $announce_stream_checkbox.prop("checked");
    }

    if (is_invite_only) {
        disable_it = true;
        $announce_stream_checkbox.prop("checked", false);
        $announce_stream_label.addClass("control-label-disabled");
    } else {
        // If the stream was already public, this will be a noop.
        $announce_stream_checkbox.prop("checked", stream_announce_previous_value);
    }

    $announce_stream_checkbox.prop("disabled", disable_it);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#announce-new-stream").show();
}

function create_stream() {
    const data = {};
    const stream_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val().trim();
    const description = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_description").val().trim();
    created_stream = stream_name;

    // Even though we already check to make sure that while typing the user cannot enter
    // newline characters (by pressing the Enter key) it would still be possible to copy
    // and paste over a description with newline characters in it. Prevent that.
    if (description.includes("\n")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "The stream description cannot contain newline characters."}),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_create_info"),
        );
        return undefined;
    }
    data.subscriptions = JSON.stringify([{name: stream_name, description}]);

    let invite_only;
    let history_public_to_subscribers;
    let is_web_public;
    const privacy_setting = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form input[name=privacy]:checked").val();

    switch (privacy_setting) {
        case "invite-only": {
            invite_only = true;
            history_public_to_subscribers = false;
            is_web_public = false;

            break;
        }
        case "invite-only-public-history": {
            invite_only = true;
            history_public_to_subscribers = true;
            is_web_public = false;

            break;
        }
        case "web-public": {
            invite_only = false;
            history_public_to_subscribers = true;
            is_web_public = true;

            break;
        }
        default: {
            invite_only = false;
            history_public_to_subscribers = true;
            is_web_public = false;
        }
    }

    data.is_web_public = JSON.stringify(is_web_public);
    data.invite_only = JSON.stringify(invite_only);
    data.history_public_to_subscribers = JSON.stringify(history_public_to_subscribers);

    const stream_post_policy = Number.parseInt(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form select[name=stream-post-policy]").val(),
        10,
    );

    data.stream_post_policy = JSON.stringify(stream_post_policy);

    let message_retention_selection = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        "#stream_creation_form select[name=stream_message_retention_setting]",
    ).val();
    if (message_retention_selection === "custom_period") {
        message_retention_selection = Number.parseInt(
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form input[name=stream-message-retention-days]").val(),
            10,
        );
    }

    data.message_retention_days = JSON.stringify(message_retention_selection);

    const announce =
        _stream_data__WEBPACK_IMPORTED_MODULE_8__.realm_has_notifications_stream() &&
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#announce-new-stream input").prop("checked");
    data.announce = JSON.stringify(announce);

    // TODO: We can eliminate the user_ids -> principals conversion
    //       once we upgrade the backend to accept user_ids.
    const user_ids = _stream_create_subscribers__WEBPACK_IMPORTED_MODULE_7__.get_principals();
    data.principals = JSON.stringify(user_ids);

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creating_indicator"), {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Creating stream..."}),
    });

    // Subscribe yourself and possible other people to a new stream.
    return _channel__WEBPACK_IMPORTED_MODULE_3__.post({
        url: "/json/users/me/subscriptions",
        data,
        success() {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val("");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_description").val("");
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Stream successfully created!"}),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_create_info"),
            );
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creating_indicator"));
            // The rest of the work is done via the subscribe event we will get
        },
        error(xhr) {
            const msg = JSON.parse(xhr.responseText).msg;
            if (msg.includes("access")) {
                // If we can't access the stream, we can safely assume it's
                // a duplicate stream that we are not invited to.
                //
                // BUG: This check should be using error codes, not
                // parsing the error string, so it works correctly
                // with i18n.  And likely we should be reporting the
                // error text directly rather than turning it into
                // "Error creating stream"?
                stream_name_error.report_already_exists(stream_name);
                stream_name_error.select();
            }

            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error creating stream"}),
                xhr,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_create_info"),
            );
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creating_indicator"));
        },
    });
}

function new_stream_clicked(stream_name) {
    // this changes the tab switcher (settings/preview) which isn't necessary
    // to a add new stream title.
    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.show_subs_pane.create_stream();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-row.active").removeClass("active");

    if (stream_name !== "") {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val(stream_name);
    }
    show_new_stream_modal();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").trigger("focus");
}

function clear_error_display() {
    stream_name_error.clear_errors();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_create_info").hide();
    stream_subscription_error.clear_errors();
}

function show_new_stream_modal() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation").removeClass("hide");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right .settings").hide();
    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.hide_or_disable_stream_privacy_options_if_required(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation"));

    _stream_create_subscribers__WEBPACK_IMPORTED_MODULE_7__.build_widgets();

    // Select the first visible and enabled choice for stream privacy.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#make-invite-only input:visible:not([disabled])").first().prop("checked", true);
    // Make the options default to the same each time:
    // "announce stream" on.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form .stream-message-retention-days-input").hide();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form select[name=stream_message_retention_setting]").val("realm_default");

    // Add listener to .show stream-message-retention-days-input that we've hidden above
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form .stream_message_retention_setting").on("change", (e) => {
        if (e.target.value === "custom_period") {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form .stream-message-retention-days-input").show();
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_creation_form .stream-message-retention-days-input").hide();
        }
    });

    update_announce_stream_state();
    clear_error_display();
}

function set_up_handlers() {
    const $people_to_add_holder = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add").expectOne();
    _stream_create_subscribers__WEBPACK_IMPORTED_MODULE_7__.create_handlers($people_to_add_holder);

    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation").expectOne();

    $container.on("change", ".stream-privacy-values input", update_announce_stream_state);

    $container.on("click", ".finalize_create_stream", (e) => {
        e.preventDefault();
        clear_error_display();

        const stream_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val().trim();
        const name_ok = stream_name_error.validate_for_submit(stream_name);

        if (!name_ok) {
            return;
        }

        const principals = _stream_create_subscribers__WEBPACK_IMPORTED_MODULE_7__.get_principals();
        if (principals.length === 0) {
            stream_subscription_error.report_no_subs_to_stream();
            return;
        }
        if (!principals.includes(_people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id()) && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            stream_subscription_error.cant_create_stream_without_subscribing();
            return;
        }

        if (principals.length >= 50) {
            const html_body = _templates_confirm_dialog_confirm_subscription_invites_warning_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
                stream_name,
                count: principals.length,
            });

            _confirm_dialog__WEBPACK_IMPORTED_MODULE_4__.launch({
                html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Large number of subscribers"}),
                html_body,
                on_click() {
                    create_stream();
                },
            });
        } else {
            create_stream();
        }
    });

    $container.on("input", "#create_stream_name", () => {
        const stream_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val().trim();

        // This is an inexpensive check.
        stream_name_error.pre_validate(stream_name);
    });

    (0,tippy_js__WEBPACK_IMPORTED_MODULE_10__["default"])("#announce-stream-docs", {
        content: () =>
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                _templates_announce_stream_docs_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                    notifications_stream: _stream_data__WEBPACK_IMPORTED_MODULE_8__.get_notifications_stream(),
                }),
            ),
    });

    // Do not allow the user to enter newline characters while typing out the
    // stream's description during it's creation.
    $container.on("keydown", "#create_stream_description", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
        }
    });
}


/***/ }),

/***/ "./static/js/stream_create_subscribers.js":
/*!************************************************!*\
  !*** ./static/js/stream_create_subscribers.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_user_id_to_new_stream": () => (/* binding */ add_user_id_to_new_stream),
/* harmony export */   "build_widgets": () => (/* binding */ build_widgets),
/* harmony export */   "create_handlers": () => (/* binding */ create_handlers),
/* harmony export */   "get_principals": () => (/* binding */ get_principals)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/stream_settings/new_stream_user.hbs */ "./static/templates/stream_settings/new_stream_user.hbs");
/* harmony import */ var _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_stream_settings_new_stream_users_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/stream_settings/new_stream_users.hbs */ "./static/templates/stream_settings/new_stream_users.hbs");
/* harmony import */ var _templates_stream_settings_new_stream_users_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_new_stream_users_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./add_subscribers_pill */ "./static/js/add_subscribers_pill.js");
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_create_subscribers_data */ "./static/js/stream_create_subscribers_data.js");












let pill_widget;
let all_users_list_widget;

function get_principals() {
    return _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.get_principals();
}

function redraw_subscriber_list() {
    all_users_list_widget.replace_list_data(_stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.sorted_user_ids());
}

function add_user_ids(user_ids) {
    _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.add_user_ids(user_ids);
    redraw_subscriber_list();
}

function add_all_users() {
    const user_ids = _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.get_all_user_ids();
    add_user_ids(user_ids);
}

function remove_user_ids(user_ids) {
    _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.remove_user_ids(user_ids);
    redraw_subscriber_list();
}

function build_pill_widget({$parent_container}) {
    const $pill_container = $parent_container.find(".pill-container");
    const get_potential_subscribers = _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.get_potential_subscribers;

    pill_widget = _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__.create({$pill_container, get_potential_subscribers});
}

function create_handlers($container) {
    $container.on("click", ".add_all_users_to_stream", (e) => {
        e.preventDefault();
        add_all_users();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".add-user-list-filter").trigger("focus");
    });

    $container.on("click", ".remove_potential_subscriber", (e) => {
        e.preventDefault();
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target);
        const user_id = Number.parseInt($elem.attr("data-user-id"), 10);
        remove_user_ids([user_id]);
    });

    function add_users({pill_user_ids}) {
        add_user_ids(pill_user_ids);
        pill_widget.clear();
    }

    _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__.set_up_handlers({
        get_pill_widget: () => pill_widget,
        $parent_container: $container,
        pill_selector: ".add_subscribers_container .input",
        button_selector: ".add_subscribers_container button.add-subscriber-button",
        action: add_users,
    });
}

function build_widgets() {
    const $add_people_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add");
    $add_people_container.html(_templates_stream_settings_new_stream_users_hbs__WEBPACK_IMPORTED_MODULE_2___default()({}));

    const $simplebar_container = $add_people_container.find(".subscriber_list_container");

    build_pill_widget({$parent_container: $add_people_container});

    _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.initialize_with_current_user();
    const current_user_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    all_users_list_widget = _list_widget__WEBPACK_IMPORTED_MODULE_4__.create(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_subscribers"), [current_user_id], {
        name: "new_stream_add_users",
        $parent_container: $add_people_container,
        modifier(user_id) {
            const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
            const item = {
                show_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
                email: _people__WEBPACK_IMPORTED_MODULE_6__.get_visible_email(user),
                user_id,
                full_name: user.full_name,
                is_current_user: user_id === current_user_id,
                disabled: _stream_create_subscribers_data__WEBPACK_IMPORTED_MODULE_7__.must_be_subscribed(user_id),
            };
            return _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1___default()(item);
        },
        filter: {
            $element: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add .add-user-list-filter"),
            predicate(user_id, search_term) {
                const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
                return _people__WEBPACK_IMPORTED_MODULE_6__.build_person_matcher(search_term)(user);
            },
        },
        $simplebar_container,
        html_selector(user_id) {
            const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape("user_checkbox_" + user.user_id)}`);
        },
    });
}

function add_user_id_to_new_stream(user_id) {
    // This is only used by puppeteer tests.
    add_user_ids([user_id]);
}


/***/ }),

/***/ "./static/js/stream_create_subscribers_data.js":
/*!*****************************************************!*\
  !*** ./static/js/stream_create_subscribers_data.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_user_ids": () => (/* binding */ add_user_ids),
/* harmony export */   "get_all_user_ids": () => (/* binding */ get_all_user_ids),
/* harmony export */   "get_potential_subscribers": () => (/* binding */ get_potential_subscribers),
/* harmony export */   "get_principals": () => (/* binding */ get_principals),
/* harmony export */   "initialize_with_current_user": () => (/* binding */ initialize_with_current_user),
/* harmony export */   "must_be_subscribed": () => (/* binding */ must_be_subscribed),
/* harmony export */   "remove_user_ids": () => (/* binding */ remove_user_ids),
/* harmony export */   "sorted_user_ids": () => (/* binding */ sorted_user_ids)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");



let user_id_set;

function initialize_with_current_user() {
    const current_user_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    user_id_set = new Set();
    user_id_set.add(current_user_id);
}

function sorted_user_ids() {
    const users = _people__WEBPACK_IMPORTED_MODULE_1__.get_users_from_ids(Array.from(user_id_set));
    _people__WEBPACK_IMPORTED_MODULE_1__.sort_but_pin_current_user_on_top(users);
    return users.map((user) => user.user_id);
}

function get_all_user_ids() {
    const potential_subscribers = _people__WEBPACK_IMPORTED_MODULE_1__.get_realm_users();
    const user_ids = potential_subscribers.map((user) => user.user_id);
    // sort for determinism
    user_ids.sort((a, b) => a - b);
    return user_ids;
}

function get_principals() {
    // Return list of user ids which were selected by user.
    return Array.from(user_id_set);
}

function get_potential_subscribers() {
    const potential_subscribers = _people__WEBPACK_IMPORTED_MODULE_1__.get_realm_users();
    return potential_subscribers.filter((user) => !user_id_set.has(user.user_id));
}

function must_be_subscribed(user_id) {
    return !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
}

function add_user_ids(user_ids) {
    for (const user_id of user_ids) {
        if (!user_id_set.has(user_id)) {
            const user = _people__WEBPACK_IMPORTED_MODULE_1__.get_by_user_id(user_id);
            if (user) {
                user_id_set.add(user_id);
            }
        }
    }
}

function remove_user_ids(user_ids) {
    for (const user_id of user_ids) {
        user_id_set.delete(user_id);
    }
}


/***/ }),

/***/ "./static/js/stream_data.js":
/*!**********************************!*\
  !*** ./static/js/stream_data.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_sub": () => (/* binding */ add_sub),
/* harmony export */   "all_subscribed_streams_are_in_home_view": () => (/* binding */ all_subscribed_streams_are_in_home_view),
/* harmony export */   "can_access_topic_history": () => (/* binding */ can_access_topic_history),
/* harmony export */   "can_change_permissions": () => (/* binding */ can_change_permissions),
/* harmony export */   "can_post_messages_in_stream": () => (/* binding */ can_post_messages_in_stream),
/* harmony export */   "can_preview": () => (/* binding */ can_preview),
/* harmony export */   "can_subscribe_others": () => (/* binding */ can_subscribe_others),
/* harmony export */   "can_toggle_subscription": () => (/* binding */ can_toggle_subscription),
/* harmony export */   "can_view_subscribers": () => (/* binding */ can_view_subscribers),
/* harmony export */   "canonicalized_name": () => (/* binding */ canonicalized_name),
/* harmony export */   "clean_up_description": () => (/* binding */ clean_up_description),
/* harmony export */   "clear_subscriptions": () => (/* binding */ clear_subscriptions),
/* harmony export */   "create_streams": () => (/* binding */ create_streams),
/* harmony export */   "create_sub_from_server_data": () => (/* binding */ create_sub_from_server_data),
/* harmony export */   "delete_sub": () => (/* binding */ delete_sub),
/* harmony export */   "get_color": () => (/* binding */ get_color),
/* harmony export */   "get_colors": () => (/* binding */ get_colors),
/* harmony export */   "get_default_stream_ids": () => (/* binding */ get_default_stream_ids),
/* harmony export */   "get_invite_stream_data": () => (/* binding */ get_invite_stream_data),
/* harmony export */   "get_name": () => (/* binding */ get_name),
/* harmony export */   "get_non_default_stream_names": () => (/* binding */ get_non_default_stream_names),
/* harmony export */   "get_notifications_stream": () => (/* binding */ get_notifications_stream),
/* harmony export */   "get_stream_id": () => (/* binding */ get_stream_id),
/* harmony export */   "get_stream_privacy_policy": () => (/* binding */ get_stream_privacy_policy),
/* harmony export */   "get_streams_for_admin": () => (/* binding */ get_streams_for_admin),
/* harmony export */   "get_sub": () => (/* binding */ get_sub),
/* harmony export */   "get_sub_by_name": () => (/* binding */ get_sub_by_name),
/* harmony export */   "get_subscribed_streams_for_user": () => (/* binding */ get_subscribed_streams_for_user),
/* harmony export */   "get_subscriber_count": () => (/* binding */ get_subscriber_count),
/* harmony export */   "get_unsorted_subs": () => (/* binding */ get_unsorted_subs),
/* harmony export */   "home_view_stream_names": () => (/* binding */ home_view_stream_names),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_active": () => (/* binding */ is_active),
/* harmony export */   "is_default_stream_id": () => (/* binding */ is_default_stream_id),
/* harmony export */   "is_filtering_inactives": () => (/* binding */ is_filtering_inactives),
/* harmony export */   "is_invite_only_by_stream_name": () => (/* binding */ is_invite_only_by_stream_name),
/* harmony export */   "is_muted": () => (/* binding */ is_muted),
/* harmony export */   "is_muted_active": () => (/* binding */ is_muted_active),
/* harmony export */   "is_notifications_stream_muted": () => (/* binding */ is_notifications_stream_muted),
/* harmony export */   "is_stream_muted_by_name": () => (/* binding */ is_stream_muted_by_name),
/* harmony export */   "is_subscribed": () => (/* binding */ is_subscribed),
/* harmony export */   "is_subscribed_by_name": () => (/* binding */ is_subscribed_by_name),
/* harmony export */   "is_user_subscribed": () => (/* binding */ is_user_subscribed),
/* harmony export */   "is_web_public": () => (/* binding */ is_web_public),
/* harmony export */   "is_web_public_by_stream_name": () => (/* binding */ is_web_public_by_stream_name),
/* harmony export */   "maybe_get_stream_name": () => (/* binding */ maybe_get_stream_name),
/* harmony export */   "muted_stream_ids": () => (/* binding */ muted_stream_ids),
/* harmony export */   "name_to_slug": () => (/* binding */ name_to_slug),
/* harmony export */   "num_subscribed_subs": () => (/* binding */ num_subscribed_subs),
/* harmony export */   "realm_has_notifications_stream": () => (/* binding */ realm_has_notifications_stream),
/* harmony export */   "receives_notifications": () => (/* binding */ receives_notifications),
/* harmony export */   "remove_default_stream": () => (/* binding */ remove_default_stream),
/* harmony export */   "rename_sub": () => (/* binding */ rename_sub),
/* harmony export */   "set_filter_out_inactives": () => (/* binding */ set_filter_out_inactives),
/* harmony export */   "set_realm_default_streams": () => (/* binding */ set_realm_default_streams),
/* harmony export */   "slug_to_name": () => (/* binding */ slug_to_name),
/* harmony export */   "stream_post_policy_values": () => (/* binding */ stream_post_policy_values),
/* harmony export */   "stream_privacy_policy_values": () => (/* binding */ stream_privacy_policy_values),
/* harmony export */   "subscribe_myself": () => (/* binding */ subscribe_myself),
/* harmony export */   "subscribed_stream_ids": () => (/* binding */ subscribed_stream_ids),
/* harmony export */   "subscribed_streams": () => (/* binding */ subscribed_streams),
/* harmony export */   "subscribed_subs": () => (/* binding */ subscribed_subs),
/* harmony export */   "unsubscribe_myself": () => (/* binding */ unsubscribe_myself),
/* harmony export */   "unsubscribed_subs": () => (/* binding */ unsubscribed_subs),
/* harmony export */   "update_message_retention_setting": () => (/* binding */ update_message_retention_setting),
/* harmony export */   "update_stream_email_address": () => (/* binding */ update_stream_email_address),
/* harmony export */   "update_stream_post_policy": () => (/* binding */ update_stream_post_policy),
/* harmony export */   "update_stream_privacy": () => (/* binding */ update_stream_privacy)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());













const DEFAULT_COLOR = "#c2c2c2";

// Expose get_subscriber_count for our automated puppeteer tests.
const get_subscriber_count = _peer_data__WEBPACK_IMPORTED_MODULE_1__.get_subscriber_count;

class BinaryDict {
    /*
      A dictionary that keeps track of which objects had the predicate
      return true or false for efficient lookups and iteration.

      This class is an optimization for managing subscriptions.
      Typically you only subscribe to a small minority of streams, and
      most common operations want to efficiently iterate through only
      streams where the current user is subscribed:

            - search bar search
            - build left sidebar
            - autocomplete #stream_links
            - autocomplete stream in compose
    */

    trues = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    falses = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    constructor(pred) {
        this.pred = pred;
    }

    true_values() {
        return this.trues.values();
    }

    num_true_items() {
        return this.trues.size;
    }

    false_values() {
        return this.falses.values();
    }

    *values() {
        for (const value of this.trues.values()) {
            yield value;
        }
        for (const value of this.falses.values()) {
            yield value;
        }
    }

    get(k) {
        const res = this.trues.get(k);

        if (res !== undefined) {
            return res;
        }

        return this.falses.get(k);
    }

    set(k, v) {
        if (this.pred(v)) {
            this.set_true(k, v);
        } else {
            this.set_false(k, v);
        }
    }

    set_true(k, v) {
        this.falses.delete(k);
        this.trues.set(k, v);
    }

    set_false(k, v) {
        this.trues.delete(k);
        this.falses.set(k, v);
    }

    delete(k) {
        this.trues.delete(k);
        this.falses.delete(k);
    }
}

// The stream_info variable maps stream names to stream properties objects
// Call clear_subscriptions() to initialize it.
let stream_info;
let filter_out_inactives = false;

const stream_ids_by_name = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
const default_stream_ids = new Set();

const stream_privacy_policy_values = {
    web_public: {
        code: "web-public",
        name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Web-public"}),
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage:
                "Organization members can join (guests must be invited by a subscriber); anyone on the Internet can view complete message history without creating an account",
        }),
    },
    public: {
        code: "public",
        name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Public"}),
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage:
                "Organization members can join (guests must be invited by a subscriber); organization members can view complete message history without joining",
        }),
    },
    private_with_public_history: {
        code: "invite-only-public-history",
        name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Private, shared history"}),
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage:
                "Must be invited by a subscriber; new subscribers can view complete message history; hidden from non-administrator users",
        }),
    },
    private: {
        code: "invite-only",
        name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Private, protected history"}),
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage:
                "Must be invited by a subscriber; new subscribers can only see messages sent after they join; hidden from non-administrator users",
        }),
    },
};

const stream_post_policy_values = {
    // These strings should match the strings in the
    // Stream.POST_POLICIES object in zerver/models.py.
    everyone: {
        code: 1,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Everyone"}),
    },
    non_new_members: {
        code: 3,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Admins, moderators and full members"}),
    },
    moderators: {
        code: 4,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Admins and moderators",
        }),
    },
    admins: {
        code: 2,
        description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Admins only"}),
    },
};

function clear_subscriptions() {
    // This function is only used once at page load, and then
    // it should only be used in tests.
    stream_info = new BinaryDict((sub) => sub.subscribed);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
}

clear_subscriptions();

function set_filter_out_inactives() {
    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        filter_out_inactives = num_subscribed_subs() >= 30;
    } else if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        filter_out_inactives = true;
    } else {
        filter_out_inactives = false;
    }
}

// for testing:
function is_filtering_inactives() {
    return filter_out_inactives;
}

function is_active(sub) {
    if (!filter_out_inactives || sub.pin_to_top) {
        // If users don't want to filter inactive streams
        // to the bottom, we respect that setting and don't
        // treat any streams as dormant.
        //
        // Currently this setting is automatically determined
        // by the number of streams.  See the callers
        // to set_filter_out_inactives.
        return true;
    }
    return _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__.stream_has_topics(sub.stream_id) || sub.newly_subscribed;
}

function is_muted_active(sub) {
    return sub.is_muted && is_active(sub);
}

function rename_sub(sub, new_name) {
    const old_name = sub.name;

    stream_ids_by_name.set(old_name, sub.stream_id);

    sub.name = new_name;
    stream_info.delete(old_name);
    stream_info.set(new_name, sub);
}

function subscribe_myself(sub) {
    const user_id = _people__WEBPACK_IMPORTED_MODULE_2__.my_current_user_id();
    _peer_data__WEBPACK_IMPORTED_MODULE_1__.add_subscriber(sub.stream_id, user_id);
    sub.subscribed = true;
    sub.newly_subscribed = true;
    stream_info.set_true(sub.name, sub);
}

function unsubscribe_myself(sub) {
    // Remove user from subscriber's list
    const user_id = _people__WEBPACK_IMPORTED_MODULE_2__.my_current_user_id();
    _peer_data__WEBPACK_IMPORTED_MODULE_1__.remove_subscriber(sub.stream_id, user_id);
    sub.subscribed = false;
    sub.newly_subscribed = false;
    stream_info.set_false(sub.name, sub);
}

function add_sub(sub) {
    // This function is currently used only by tests.
    // We use create_sub_from_server_data at page load.
    // We use create_streams for new streams in live-update events.
    stream_info.set(sub.name, sub);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(sub.stream_id, sub);
}

function get_sub(stream_name) {
    return stream_info.get(stream_name);
}

function get_stream_id(name) {
    // Note: Only use this function for situations where
    // you are comfortable with a user dealing with an
    // old name of a stream (from prior to a rename).
    const sub = stream_info.get(name);

    if (sub) {
        return sub.stream_id;
    }

    const stream_id = stream_ids_by_name.get(name);
    return stream_id;
}

function get_sub_by_name(name) {
    // Note: Only use this function for situations where
    // you are comfortable with a user dealing with an
    // old name of a stream (from prior to a rename).

    const sub = stream_info.get(name);

    if (sub) {
        return sub;
    }

    const stream_id = stream_ids_by_name.get(name);

    if (!stream_id) {
        return undefined;
    }

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
}

function name_to_slug(name) {
    const stream_id = get_stream_id(name);

    if (!stream_id) {
        return name;
    }

    // The name part of the URL doesn't really matter, so we try to
    // make it pretty.
    name = name.replaceAll(" ", "-");

    return stream_id + "-" + name;
}

function slug_to_name(slug) {
    /*
    Modern stream slugs look like this, where 42
    is a stream id:

        42
        42-stream-name

    We have legacy slugs that are just the name
    of the stream:

        stream-name

    And it's plausible that old stream slugs will have
    be based on stream names that collide with modern
    slugs:

        4-horseman
        411
        2016-election

    If there is any ambiguity about whether a stream slug
    is old or modern, we prefer modern, as long as the integer
    prefix matches a real stream id.  Eventually we will
    stop supporting the legacy slugs, which only matter now
    because people have linked to Zulip threads in things like
    GitHub conversations.  We migrated to modern slugs in
    early 2018.
    */
    const m = /^(\d+)(-.*)?$/.exec(slug);
    if (m) {
        const stream_id = Number.parseInt(m[1], 10);
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        if (sub) {
            return sub.name;
        }
        // if nothing was found above, we try to match on the stream
        // name in the somewhat unlikely event they had a historical
        // link to a stream like 4-horsemen
    }

    /*
    We are dealing with a pre-2018 slug that doesn't have the
    stream id as a prefix.
    */
    return slug;
}

function delete_sub(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Failed to archive stream " + stream_id);
        return;
    }
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    stream_info.delete(sub.name);
}

function get_non_default_stream_names() {
    let subs = Array.from(stream_info.values());
    subs = subs.filter((sub) => !is_default_stream_id(sub.stream_id) && !sub.invite_only);
    const names = subs.map((sub) => sub.name);
    return names;
}

function get_unsorted_subs() {
    return Array.from(stream_info.values());
}

function num_subscribed_subs() {
    return stream_info.num_true_items();
}

function subscribed_subs() {
    return Array.from(stream_info.true_values());
}

function unsubscribed_subs() {
    return Array.from(stream_info.false_values());
}

function subscribed_streams() {
    return subscribed_subs().map((sub) => sub.name);
}

function subscribed_stream_ids() {
    return subscribed_subs().map((sub) => sub.stream_id);
}

function muted_stream_ids() {
    return subscribed_subs()
        .filter((sub) => sub.is_muted)
        .map((sub) => sub.stream_id);
}

function get_subscribed_streams_for_user(user_id) {
    // Note that we only have access to subscribers of some streams
    // depending on our role.
    const all_subs = get_unsorted_subs();
    const subscribed_subs = [];
    for (const sub of all_subs) {
        if (!can_view_subscribers(sub)) {
            // Private streams that we have been removed from appear
            // in get_unsorted_subs; we don't attempt to check their
            // subscribers (which would trigger a warning).
            continue;
        }
        if (is_user_subscribed(sub.stream_id, user_id)) {
            subscribed_subs.push(sub);
        }
    }

    return subscribed_subs;
}

function get_invite_stream_data() {
    function get_data(sub) {
        return {
            name: sub.name,
            stream_id: sub.stream_id,
            invite_only: sub.invite_only,
            is_web_public: sub.is_web_public,
            default_stream: default_stream_ids.has(sub.stream_id),
        };
    }

    const streams = [];

    // Invite users to all default streams...
    for (const stream_id of default_stream_ids) {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        streams.push(get_data(sub));
    }

    // ...plus all your subscribed streams (avoiding repeats).
    for (const sub of subscribed_subs()) {
        if (!default_stream_ids.has(sub.stream_id)) {
            streams.push(get_data(sub));
        }
    }

    return streams;
}

function get_colors() {
    return subscribed_subs().map((sub) => sub.color);
}

function update_stream_email_address(sub, email) {
    sub.email_address = email;
}

function update_stream_post_policy(sub, stream_post_policy) {
    sub.stream_post_policy = stream_post_policy;
}

function update_stream_privacy(sub, values) {
    sub.invite_only = values.invite_only;
    sub.history_public_to_subscribers = values.history_public_to_subscribers;
    sub.is_web_public = values.is_web_public;
}

function update_message_retention_setting(sub, message_retention_days) {
    sub.message_retention_days = message_retention_days;
}

function receives_notifications(stream_id, notification_name) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (sub === undefined) {
        return false;
    }
    if (sub[notification_name] !== null) {
        return sub[notification_name];
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[notification_name]];
}

function all_subscribed_streams_are_in_home_view() {
    return subscribed_subs().every((sub) => !sub.is_muted);
}

function home_view_stream_names() {
    const home_view_subs = subscribed_subs().filter((sub) => !sub.is_muted);
    return home_view_subs.map((sub) => sub.name);
}

function canonicalized_name(stream_name) {
    return stream_name.toString().toLowerCase();
}

function get_color(stream_name) {
    const sub = get_sub(stream_name);
    if (sub === undefined) {
        return DEFAULT_COLOR;
    }
    return sub.color;
}

function is_muted(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    // Return true for undefined streams
    if (sub === undefined) {
        return true;
    }
    return sub.is_muted;
}

function is_stream_muted_by_name(stream_name) {
    const sub = get_sub(stream_name);
    // Return true for undefined streams
    if (sub === undefined) {
        return true;
    }
    return sub.is_muted;
}

function is_notifications_stream_muted() {
    return is_muted(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}

function can_toggle_subscription(sub) {
    // You can always remove your subscription if you're subscribed.
    //
    // One can only join a stream if it is public (!invite_only) and
    // your role is Member or above (!is_guest).
    // Spectators cannot subscribe to any streams.
    //
    // Note that the correctness of this logic relies on the fact that
    // one cannot be subscribed to a deactivated stream, and
    // deactivated streams are automatically made private during the
    // archive stream process.
    return (
        (sub.subscribed || (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !sub.invite_only)) && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    );
}

function can_access_topic_history(sub) {
    // Anyone can access topic history for web-public streams and
    // subscriptions; additionally, members can access history for
    // public streams.
    return sub.is_web_public || can_toggle_subscription(sub);
}

function can_preview(sub) {
    return sub.subscribed || !sub.invite_only || sub.previously_subscribed;
}

function can_change_permissions(sub) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && (!sub.invite_only || sub.subscribed);
}

function can_view_subscribers(sub) {
    // Guest users can't access subscribers of any(public or private) non-subscribed streams.
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || sub.subscribed || (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !sub.invite_only);
}

function can_subscribe_others(sub) {
    // User can add other users to stream if stream is public or user is subscribed to stream.
    return !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && (!sub.invite_only || sub.subscribed);
}

function can_post_messages_in_stream(stream) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return false;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    if (stream.stream_post_policy === stream_post_policy_values.admins.code) {
        return false;
    }

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return true;
    }

    if (stream.stream_post_policy === stream_post_policy_values.moderators.code) {
        return false;
    }

    if (
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) &&
        stream.stream_post_policy !== stream_post_policy_values.everyone.code
    ) {
        return false;
    }

    const person = _people__WEBPACK_IMPORTED_MODULE_2__.get_by_user_id(_people__WEBPACK_IMPORTED_MODULE_2__.my_current_user_id());
    const current_datetime = new Date(Date.now());
    const person_date_joined = new Date(person.date_joined);
    const days = (current_datetime - person_date_joined) / 1000 / 86400;
    if (
        stream.stream_post_policy === stream_post_policy_values.non_new_members.code &&
        days < Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        return false;
    }
    return true;
}

function is_subscribed_by_name(stream_name) {
    const sub = get_sub(stream_name);
    return sub !== undefined && sub.subscribed;
}

function is_subscribed(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    return sub !== undefined && sub.subscribed;
}

function get_stream_privacy_policy(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

    if (sub.is_web_public) {
        return stream_privacy_policy_values.web_public.code;
    }
    if (!sub.invite_only) {
        return stream_privacy_policy_values.public.code;
    }
    if (sub.invite_only && !sub.history_public_to_subscribers) {
        return stream_privacy_policy_values.private.code;
    }
    return stream_privacy_policy_values.private_with_public_history.code;
}

function is_web_public(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    return sub !== undefined && sub.is_web_public;
}

function is_invite_only_by_stream_name(stream_name) {
    const sub = get_sub(stream_name);
    if (sub === undefined) {
        return false;
    }
    return sub.invite_only;
}

function is_web_public_by_stream_name(stream_name) {
    const sub = get_sub(stream_name);
    if (sub === undefined) {
        return false;
    }
    return sub.is_web_public;
}

function set_realm_default_streams(realm_default_streams) {
    default_stream_ids.clear();

    for (const stream of realm_default_streams) {
        default_stream_ids.add(stream.stream_id);
    }
}

function get_default_stream_ids() {
    return Array.from(default_stream_ids);
}

function is_default_stream_id(stream_id) {
    return default_stream_ids.has(stream_id);
}

function get_name(stream_name) {
    // This returns the actual name of a stream if we are subscribed to
    // it (i.e "Denmark" vs. "denmark"), while falling thru to
    // stream_name if we don't have a subscription.  (Stream names
    // are case-insensitive, but we try to display the actual name
    // when we know it.)
    //
    // This function will also do the right thing if we have
    // an old stream name in memory for a recently renamed stream.
    const sub = get_sub_by_name(stream_name);
    if (sub === undefined) {
        return stream_name;
    }
    return sub.name;
}

function maybe_get_stream_name(stream_id) {
    if (!stream_id) {
        return undefined;
    }
    const stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

    if (!stream) {
        return undefined;
    }

    return stream.name;
}

function is_user_subscribed(stream_id, user_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (sub === undefined || !can_view_subscribers(sub)) {
        // If we don't know about the stream, or we ourselves cannot access subscriber list,
        // so we return undefined (treated as falsy if not explicitly handled).
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            "We got a is_user_subscribed call for a non-existent or inaccessible stream.",
        );
        return undefined;
    }
    if (user_id === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined user_id passed to function is_user_subscribed");
        return undefined;
    }

    return _peer_data__WEBPACK_IMPORTED_MODULE_1__.is_user_subscribed(stream_id, user_id);
}

function create_streams(streams) {
    for (const stream of streams) {
        // We handle subscriber stuff in other events.

        const attrs = {
            subscribers: [],
            subscribed: false,
            ...stream,
        };
        create_sub_from_server_data(attrs);
    }
}

function clean_up_description(sub) {
    if (sub.rendered_description !== undefined) {
        sub.rendered_description = sub.rendered_description.replace("<p>", "").replace("</p>", "");
    }
}

function create_sub_from_server_data(attrs) {
    if (!attrs.stream_id) {
        // fail fast
        throw new Error("We cannot create a sub without a stream_id");
    }

    let sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(attrs.stream_id);
    if (sub !== undefined) {
        // We've already created this subscription, no need to continue.
        return sub;
    }

    // Our internal data structure for subscriptions is mostly plain dictionaries,
    // so we just reuse the attrs that are passed in to us, but we encapsulate how
    // we handle subscribers.  We defensively remove the `subscribers` field from
    // the original `attrs` object, which will get thrown away.  (We used to make
    // a copy of the object with `_.omit(attrs, 'subscribers')`, but `_.omit` is
    // slow enough to show up in timings when you have 1000s of streams.

    const subscriber_user_ids = attrs.subscribers;

    delete attrs.subscribers;

    sub = {
        name: attrs.name,
        render_subscribers: !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || attrs.invite_only === true,
        subscribed: true,
        newly_subscribed: false,
        is_muted: false,
        invite_only: false,
        desktop_notifications: null,
        audible_notifications: null,
        push_notifications: null,
        email_notifications: null,
        wildcard_mentions_notify: null,
        description: "",
        rendered_description: "",
        first_message_id: attrs.first_message_id,
        ...attrs,
    };

    _peer_data__WEBPACK_IMPORTED_MODULE_1__.set_subscribers(sub.stream_id, subscriber_user_ids);

    if (!sub.color) {
        sub.color = Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    }

    clean_up_description(sub);

    stream_info.set(sub.name, sub);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(sub.stream_id, sub);

    return sub;
}

function get_streams_for_admin() {
    // Sort and combine all our streams.
    function by_name(a, b) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.name, b.name);
    }

    const subs = Array.from(stream_info.values());

    subs.sort(by_name);

    return subs;
}

/*
  This module provides a common helper for finding the notification
  stream, but we don't own the data.  The `page_params` structure
  is the authoritative source of this data, and it will be updated by
  server_events_dispatch in case of changes.
*/
function realm_has_notifications_stream() {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== -1;
}

function get_notifications_stream() {
    const stream_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    if (stream_id !== -1) {
        const stream_obj = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        if (stream_obj) {
            return stream_obj.name;
        }
        // We reach here when the notifications stream is a private
        // stream the current user is not subscribed to.
    }
    return "";
}

function initialize(params) {
    /*
        We get `params` data, which is data that we "own"
        and which has already been removed from `page_params`.
        We only use it in this function to populate other
        data structures.
    */

    const subscriptions = params.subscriptions;
    const unsubscribed = params.unsubscribed;
    const never_subscribed = params.never_subscribed;
    const realm_default_streams = params.realm_default_streams;

    /*
        We also consume some data directly from `page_params`.
        This data can be accessed by any other module,
        and we consider the authoritative source to be
        `page_params`.  Some of this data should eventually
        be fully handled by stream_data.
    */

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(subscriptions);

    function populate_subscriptions(subs, subscribed, previously_subscribed) {
        for (const sub of subs) {
            sub.subscribed = subscribed;
            sub.previously_subscribed = previously_subscribed;

            create_sub_from_server_data(sub);
        }
    }

    set_realm_default_streams(realm_default_streams);

    populate_subscriptions(subscriptions, true, true);
    populate_subscriptions(unsubscribed, false, true);
    populate_subscriptions(never_subscribed, false, false);

    set_filter_out_inactives();
}

function remove_default_stream(stream_id) {
    default_stream_ids.delete(stream_id);
}


/***/ }),

/***/ "./static/js/stream_edit.js":
/*!**********************************!*\
  !*** ./static/js/stream_edit.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "archive_stream": () => (/* binding */ archive_stream),
/* harmony export */   "bulk_set_stream_property": () => (/* binding */ bulk_set_stream_property),
/* harmony export */   "get_display_text_for_realm_message_retention_setting": () => (/* binding */ get_display_text_for_realm_message_retention_setting),
/* harmony export */   "get_request_data_for_stream_privacy": () => (/* binding */ get_request_data_for_stream_privacy),
/* harmony export */   "get_stream_email_address": () => (/* binding */ get_stream_email_address),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_notification_setting": () => (/* binding */ is_notification_setting),
/* harmony export */   "open_edit_panel_empty": () => (/* binding */ open_edit_panel_empty),
/* harmony export */   "open_edit_panel_for_row": () => (/* binding */ open_edit_panel_for_row),
/* harmony export */   "select_tab": () => (/* binding */ select_tab),
/* harmony export */   "set_stream_property": () => (/* binding */ set_stream_property),
/* harmony export */   "setup_stream_settings": () => (/* binding */ setup_stream_settings),
/* harmony export */   "setup_subscriptions_tab_hash": () => (/* binding */ setup_subscriptions_tab_hash),
/* harmony export */   "show_settings_for": () => (/* binding */ show_settings_for),
/* harmony export */   "stream_setting_changed": () => (/* binding */ stream_setting_changed),
/* harmony export */   "stream_settings": () => (/* binding */ stream_settings),
/* harmony export */   "toggler": () => (/* binding */ toggler),
/* harmony export */   "update_muting_rendering": () => (/* binding */ update_muting_rendering),
/* harmony export */   "update_stream_description": () => (/* binding */ update_stream_description),
/* harmony export */   "update_stream_name": () => (/* binding */ update_stream_name)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_stream_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_deactivate_stream.hbs */ "./static/templates/confirm_dialog/confirm_deactivate_stream.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_deactivate_stream_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_deactivate_stream_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/stream_privacy.hbs */ "./static/templates/stream_privacy.hbs");
/* harmony import */ var _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_stream_settings_change_stream_info_modal_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/stream_settings/change_stream_info_modal.hbs */ "./static/templates/stream_settings/change_stream_info_modal.hbs");
/* harmony import */ var _templates_stream_settings_change_stream_info_modal_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_change_stream_info_modal_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_stream_settings_copy_email_address_modal_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/stream_settings/copy_email_address_modal.hbs */ "./static/templates/stream_settings/copy_email_address_modal.hbs");
/* harmony import */ var _templates_stream_settings_copy_email_address_modal_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_copy_email_address_modal_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_stream_settings_stream_description_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/stream_settings/stream_description.hbs */ "./static/templates/stream_settings/stream_description.hbs");
/* harmony import */ var _templates_stream_settings_stream_description_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_description_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/stream_settings/stream_settings.hbs */ "./static/templates/stream_settings/stream_settings.hbs");
/* harmony import */ var _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_7__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_ui__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./settings_ui */ "./static/js/settings_ui.js");
/* harmony import */ var _stream_color__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./stream_color */ "./static/js/stream_color.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./stream_edit_subscribers */ "./static/js/stream_edit_subscribers.js");
/* harmony import */ var _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./stream_settings_containers */ "./static/js/stream_settings_containers.js");
/* harmony import */ var _stream_settings_data__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./stream_settings_data */ "./static/js/stream_settings_data.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
/* harmony import */ var _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./stream_ui_updates */ "./static/js/stream_ui_updates.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());





































let toggler;
let select_tab = "personal_settings";

function setup_subscriptions_stream_hash(sub) {
    const hash = _hash_util__WEBPACK_IMPORTED_MODULE_13__.stream_edit_url(sub);
    _browser_history__WEBPACK_IMPORTED_MODULE_9__.update(hash);
}

function setup_subscriptions_tab_hash(tab_key_value) {
    if (tab_key_value === "all-streams") {
        _browser_history__WEBPACK_IMPORTED_MODULE_9__.update("#streams/all");
    } else if (tab_key_value === "subscribed") {
        _browser_history__WEBPACK_IMPORTED_MODULE_9__.update("#streams/subscribed");
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown tab_key_value: " + tab_key_value);
    }
}

function get_display_text_for_realm_message_retention_setting() {
    const realm_message_retention_days = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    if (realm_message_retention_days === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "(forever)"});
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        {defaultMessage: "({message_retention_days} days)"},
        {message_retention_days: realm_message_retention_days},
    );
}

function get_stream_id(target) {
    const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(target).closest(
        ".stream-row, .stream_settings_header, .subscription_settings, .save-button",
    );
    return Number.parseInt($row.attr("data-stream-id"), 10);
}

function get_sub_for_target(target) {
    const stream_id = get_stream_id(target);
    if (!stream_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find stream id for target");
        return undefined;
    }

    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_sub_for_target() failed id lookup: " + stream_id);
        return undefined;
    }
    return sub;
}

function open_edit_panel_for_row(stream_row) {
    const sub = get_sub_for_target(stream_row);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream-row.active").removeClass("active");
    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.show_subs_pane.settings(sub);
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(stream_row).addClass("active");
    setup_subscriptions_stream_hash(sub);
    setup_stream_settings(stream_row);
}

function open_edit_panel_empty() {
    const tab_key = _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.get_active_data().$tabs.first().attr("data-tab-key");
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream-row.active").removeClass("active");
    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.show_subs_pane.nothing_selected();
    setup_subscriptions_tab_hash(tab_key);
}

function update_stream_name(sub, new_name) {
    const $edit_container = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__.get_edit_container(sub);
    $edit_container.find(".email-address").text(sub.email_address);
    $edit_container.find(".sub-stream-name").text(new_name);

    const active_data = _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.get_active_data();
    if (active_data.id === sub.stream_id) {
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.set_right_panel_title(sub);
    }
}

function update_stream_description(sub) {
    const $edit_container = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__.get_edit_container(sub);
    $edit_container.find("input.description").val(sub.description);
    const html = _templates_stream_settings_stream_description_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
        rendered_description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(sub.rendered_description),
    });
    $edit_container.find(".stream-description").html(html);
}

function show_subscription_settings(sub) {
    const $edit_container = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__.get_edit_container(sub);

    const $colorpicker = $edit_container.find(".colorpicker");
    const color = _stream_data__WEBPACK_IMPORTED_MODULE_18__.get_color(sub.name);
    _stream_color__WEBPACK_IMPORTED_MODULE_17__.set_colorpicker_color($colorpicker, color);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__.update_add_subscriptions_elements(sub);

    if (!sub.render_subscribers) {
        return;
    }

    if (!_stream_data__WEBPACK_IMPORTED_MODULE_18__.can_toggle_subscription(sub)) {
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__.initialize_cant_subscribe_popover(sub);
    }

    const $subscriber_container = $edit_container.find(".edit_subscribers_for_stream");
    _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_19__.enable_subscriber_management({
        sub,
        $parent_container: $subscriber_container,
    });
}

function is_notification_setting(setting_label) {
    if (setting_label.includes("_notifications")) {
        return true;
    } else if (setting_label.includes("_notify")) {
        return true;
    }
    return false;
}

function stream_settings(sub) {
    const settings_labels = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const check_realm_setting =
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).show_push_notifications_tooltip;

    const settings = Object.keys(settings_labels).map((setting) => {
        const ret = {
            name: setting,
            label: settings_labels[setting],
            disabled_realm_setting: check_realm_setting[setting],
            is_disabled: check_realm_setting[setting],
            is_notification_setting: is_notification_setting(setting),
        };
        if (is_notification_setting(setting)) {
            // This block ensures we correctly display to users the
            // current state of stream-level notification settings
            // with a value of `null`, which inherit the user's global
            // notification settings for streams.
            ret.is_checked =
                _stream_data__WEBPACK_IMPORTED_MODULE_18__.receives_notifications(sub.stream_id, setting) &&
                !check_realm_setting[setting];
            ret.is_disabled = ret.is_disabled || sub.is_muted;
            return ret;
        }
        ret.is_checked = sub[setting] && !check_realm_setting[setting];
        return ret;
    });
    return settings;
}

function show_settings_for(node) {
    const stream_id = get_stream_id(node);
    const slim_sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    _stream_data__WEBPACK_IMPORTED_MODULE_18__.clean_up_description(slim_sub);
    const sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_21__.get_sub_for_settings(slim_sub);
    const all_settings = stream_settings(sub);

    const other_settings = [];
    const notification_settings = all_settings.filter((setting) => {
        if (setting.is_notification_setting) {
            return true;
        }
        other_settings.push(setting);
        return false;
    });

    const html = _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_7___default()({
        sub,
        notification_settings,
        other_settings,
        stream_post_policy_values: _stream_data__WEBPACK_IMPORTED_MODULE_18__.stream_post_policy_values,
        stream_privacy_policy_values: _stream_data__WEBPACK_IMPORTED_MODULE_18__.stream_privacy_policy_values,
        stream_privacy_policy: _stream_data__WEBPACK_IMPORTED_MODULE_18__.get_stream_privacy_policy(stream_id),
        zulip_plan_is_not_limited: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        upgrade_text_for_wide_organization_logo:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        is_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        org_level_message_retention_setting: get_display_text_for_realm_message_retention_setting(),
    });
    _ui__WEBPACK_IMPORTED_MODULE_24__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_settings")).html(html);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_settings .tab-container").prepend(toggler.get());
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__.update_toggler_for_sub(sub);

    const $edit_container = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__.get_edit_container(sub);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".nothing-selected").hide();
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#subscription_overlay .stream_change_property_info").hide();

    $edit_container.addClass("show");

    show_subscription_settings(sub);
    _settings_org__WEBPACK_IMPORTED_MODULE_15__.set_message_retention_setting_dropdown(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__.enable_or_disable_permission_settings_in_edit_panel(sub);
}

function setup_stream_settings(node) {
    toggler = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        child_wants_focus: true,
        values: [
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "General"}), key: "general_settings"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Personal"}), key: "personal_settings"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribers"}), key: "subscriber_settings"},
        ],
        callback(name, key) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream_section").hide();
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("." + key).show();
            select_tab = key;
        },
    });

    show_settings_for(node);
}

function update_muting_rendering(sub) {
    const $edit_container = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_20__.get_edit_container(sub);
    const $notification_checkboxes = $edit_container.find(".sub_notification_setting");
    const $is_muted_checkbox = $edit_container.find("#sub_is_muted_setting .sub_setting_control");

    $is_muted_checkbox.prop("checked", sub.is_muted);
    $edit_container.find(".mute-note").toggleClass("hide-mute-note", !sub.is_muted);
    $notification_checkboxes.toggleClass("muted-sub", sub.is_muted);
    $notification_checkboxes.find("input[type='checkbox']").prop("disabled", sub.is_muted);
}

function stream_is_muted_changed(e) {
    const sub = get_sub_for_target(e.target);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("stream_is_muted_changed() fails");
        return;
    }

    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.set_muted(
        sub,
        e.target.checked,
        `#stream_change_property_status${CSS.escape(sub.stream_id)}`,
    );
}

function stream_setting_changed(e, from_notification_settings) {
    if (e.target.name === "is_muted") {
        return;
    }

    const sub = get_sub_for_target(e.target);
    const status_element = from_notification_settings
        ? jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".subsection-parent").find(".alert-notification")
        : jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#stream_change_property_status${CSS.escape(sub.stream_id)}`);
    const setting = e.target.name;
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("undefined sub in stream_setting_changed()");
        return;
    }
    if (is_notification_setting(setting) && sub[setting] === null) {
        sub[setting] =
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[setting]];
    }
    set_stream_property(sub, setting, e.target.checked, status_element);
}

function bulk_set_stream_property(sub_data, status_element) {
    const url = "/json/users/me/subscriptions/properties";
    const data = {subscription_data: JSON.stringify(sub_data)};
    if (!status_element) {
        return _channel__WEBPACK_IMPORTED_MODULE_10__.post({
            url,
            data,
            timeout: 10 * 1000,
        });
    }

    _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(_channel__WEBPACK_IMPORTED_MODULE_10__.post, url, data, status_element);
    return undefined;
}

function set_stream_property(sub, property, value, status_element) {
    const sub_data = {stream_id: sub.stream_id, property, value};
    bulk_set_stream_property([sub_data], status_element);
}

function get_request_data_for_stream_privacy(selected_val) {
    switch (selected_val) {
        case _stream_data__WEBPACK_IMPORTED_MODULE_18__.stream_privacy_policy_values["public"].code: {
            return {
                is_private: false,
                history_public_to_subscribers: true,
                is_web_public: false,
            };
        }
        case _stream_data__WEBPACK_IMPORTED_MODULE_18__.stream_privacy_policy_values["private"].code: {
            return {
                is_private: true,
                history_public_to_subscribers: false,
                is_web_public: false,
            };
        }
        case _stream_data__WEBPACK_IMPORTED_MODULE_18__.stream_privacy_policy_values.web_public.code: {
            return {
                is_private: false,
                history_public_to_subscribers: true,
                is_web_public: true,
            };
        }
        default: {
            return {
                is_private: true,
                history_public_to_subscribers: true,
                is_web_public: false,
            };
        }
    }
}

function archive_stream(stream_id, $alert_element, $stream_row) {
    _channel__WEBPACK_IMPORTED_MODULE_10__.del({
        url: "/json/streams/" + stream_id,
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed"}), xhr, $alert_element);
        },
        success() {
            $stream_row.remove();
        },
    });
}

function get_stream_email_address(flags, address) {
    const clean_address = address
        .replace(".show-sender", "")
        .replace(".include-footer", "")
        .replace(".include-quotes", "")
        .replace(".prefer-html", "");

    const flag_string = flags.map((flag) => "." + flag).join("");

    return clean_address.replace("@", flag_string + "@");
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#main_div").on("click", ".stream_sub_unsub_button", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const sub = _narrow_state__WEBPACK_IMPORTED_MODULE_14__.stream_sub();
        if (sub === undefined) {
            return;
        }

        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.sub_or_unsub(sub);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("click", "#open_stream_info_modal", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const stream_id = get_stream_id(e.target);
        const stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const template_data = {
            stream_name: stream.name,
            stream_description: stream.description,
            max_stream_name_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            max_stream_description_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        };
        const change_stream_info_modal = _templates_stream_settings_change_stream_info_modal_hbs__WEBPACK_IMPORTED_MODULE_4___default()(template_data);
        _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Edit #{stream_name}"},
                {stream_name: stream.name},
            ),
            html_body: change_stream_info_modal,
            id: "change_stream_info_modal",
            on_click: save_stream_info,
            post_render() {
                jquery__WEBPACK_IMPORTED_MODULE_1___default()("#change_stream_info_modal .dialog_submit_button")
                    .addClass("save-button")
                    .attr("data-stream-id", stream_id);
            },
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("keypress", "#change_stream_description", (e) => {
        // Stream descriptions can not be multiline, so disable enter key
        // to prevent new line
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            return false;
        }
        return true;
    });

    function save_stream_info(e) {
        e.preventDefault();
        e.stopPropagation();
        const sub = get_sub_for_target(e.currentTarget);

        const url = `/json/streams/${sub.stream_id}`;
        const data = {};
        const new_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#change_stream_name").val().trim();
        const new_description = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#change_stream_description").val().trim();

        if (new_name === sub.name && new_description === sub.description) {
            return;
        }
        if (new_name !== sub.name) {
            data.new_name = new_name;
        }
        if (new_description !== sub.description) {
            data.description = new_description;
        }

        const $status_element = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream_change_property_info");
        _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.close_modal();
        _settings_ui__WEBPACK_IMPORTED_MODULE_16__.do_settings_change(_channel__WEBPACK_IMPORTED_MODULE_10__.patch, url, data, $status_element);
    }

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("click", ".copy_email_button", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const stream_id = get_stream_id(e.target);
        const stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        let address = stream.email_address;

        const copy_email_address = _templates_stream_settings_copy_email_address_modal_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
            email_address: address,
            tags: [
                {
                    name: "show-sender",
                    description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "The sender's email address",
                    }),
                },
                {
                    name: "include-footer",
                    description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Email footers (e.g., signature)"}),
                },
                {
                    name: "include-quotes",
                    description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Quoted original email (in replies)"}),
                },
                {
                    name: "prefer-html",
                    description: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Use html encoding (not recommended)",
                    }),
                },
            ],
        });

        _dialog_widget__WEBPACK_IMPORTED_MODULE_12__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Generate stream email address"}),
            html_body: copy_email_address,
            id: "copy_email_address_modal",
            html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Copy address"}),
            help_link: "/help/message-a-stream-by-email#configuration-options",
            on_click() {},
            close_on_submit: true,
        });
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#show-sender").prop("checked", true);

        new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())("#copy_email_address_modal .dialog_submit_button", {
            text() {
                return address;
            },
        });

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#copy_email_address_modal .tag-checkbox").on("change", () => {
            const $checked_checkboxes = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".copy-email-modal").find("input:checked");

            const flags = [];

            jquery__WEBPACK_IMPORTED_MODULE_1___default()($checked_checkboxes).each(function () {
                flags.push(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).attr("id"));
            });

            address = get_stream_email_address(flags, address);

            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".email-address").text(address);
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on(
        "change",
        "#sub_is_muted_setting .sub_setting_control",
        stream_is_muted_changed,
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on(
        "change",
        ".sub_setting_checkbox .sub_setting_control",
        stream_setting_changed,
    );

    // This handler isn't part of the normal edit interface; it's the convenient
    // checkmark in the subscriber list.
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("click", ".sub_unsub_button", (e) => {
        const sub = get_sub_for_target(e.target);
        // Makes sure we take the correct stream_row.
        const $stream_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(
            `#manage_streams_container div.stream-row[data-stream-id='${CSS.escape(
                sub.stream_id,
            )}']`,
        );
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_22__.sub_or_unsub(sub, $stream_row);

        if (!sub.subscribed) {
            open_edit_panel_for_row($stream_row);
        }
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_23__.update_regular_sub_settings(sub);

        e.preventDefault();
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("click", ".deactivate", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const stream_id = get_stream_id(e.target);
        if (!stream_id) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invalid stream ID"}),
                jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream_change_property_info"),
            );
            return;
        }

        function do_archive_stream() {
            const stream_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".dialog_submit_button").data("stream-id");
            if (!stream_id) {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Invalid stream ID"}),
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream_change_property_info"),
                );
                return;
            }
            const $row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream-row.active");
            archive_stream(stream_id, jquery__WEBPACK_IMPORTED_MODULE_1___default()(".stream_change_property_info"), $row);
        }

        const stream = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const stream_privacy_symbol_html = _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
            invite_only: stream.invite_only,
            is_web_public: stream.is_web_public,
        });
        const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_18__.maybe_get_stream_name(stream_id);
        const html_body = _templates_confirm_dialog_confirm_deactivate_stream_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
            stream_name,
            stream_privacy_symbol_html,
        });

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_11__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Archive <z-link></z-link>{stream}?"},
                {stream: stream_name, "z-link": () => stream_privacy_symbol_html},
            ),
            id: "archive-stream-modal",
            help_link: "/help/archive-a-stream",
            html_body,
            on_click: do_archive_stream,
        });

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".dialog_submit_button").attr("data-stream-id", stream_id);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("click", ".stream-row", function (e) {
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".check, .subscription_settings").length === 0) {
            open_edit_panel_for_row(this);
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("change", ".stream_message_retention_setting", (e) => {
        const message_retention_setting_dropdown_value = e.target.value;
        _settings_org__WEBPACK_IMPORTED_MODULE_15__.change_element_block_display_property(
            "stream_message_retention_custom_input",
            message_retention_setting_dropdown_value === "custom_period",
        );
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on("change input", "input, select, textarea", (e) => {
        e.preventDefault();
        e.stopPropagation();

        const stream_id = get_stream_id(e.target);
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const $subsection = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".settings-subsection-parent");
        _settings_org__WEBPACK_IMPORTED_MODULE_15__.save_discard_widget_status_handler($subsection, false, sub);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on(
        "click",
        ".subsection-header .subsection-changes-save button",
        (e) => {
            e.preventDefault();
            e.stopPropagation();
            const $save_button = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget);
            const $subsection_elem = $save_button.closest(".settings-subsection-parent");

            const stream_id = $save_button.closest(".subscription_settings.show").data("stream-id");
            const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
            const data = _settings_org__WEBPACK_IMPORTED_MODULE_15__.populate_data_for_request($subsection_elem, false, sub);

            const url = "/json/streams/" + stream_id;
            _settings_org__WEBPACK_IMPORTED_MODULE_15__.save_organization_settings(data, $save_button, url);
        },
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#manage_streams_container").on(
        "click",
        ".subsection-header .subsection-changes-discard button",
        (e) => {
            e.preventDefault();
            e.stopPropagation();

            const stream_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".subscription_settings.show").data("stream-id");
            const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

            const $subsection = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".settings-subsection-parent");
            for (const elem of _settings_org__WEBPACK_IMPORTED_MODULE_15__.get_subsection_property_elements($subsection)) {
                _settings_org__WEBPACK_IMPORTED_MODULE_15__.discard_property_element_changes(elem, false, sub);
            }
            const $save_btn_controls = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".save-button-controls");
            _settings_org__WEBPACK_IMPORTED_MODULE_15__.change_save_button_state($save_btn_controls, "discarded");
        },
    );
}


/***/ }),

/***/ "./static/js/stream_edit_subscribers.js":
/*!**********************************************!*\
  !*** ./static/js/stream_edit_subscribers.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "enable_subscriber_management": () => (/* binding */ enable_subscriber_management),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "pill_widget": () => (/* binding */ pill_widget),
/* harmony export */   "update_subscribers_list": () => (/* binding */ update_subscribers_list)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs */ "./static/templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_stream_settings_stream_member_list_entry_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/stream_settings/stream_member_list_entry.hbs */ "./static/templates/stream_settings/stream_member_list_entry.hbs");
/* harmony import */ var _templates_stream_settings_stream_member_list_entry_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_member_list_entry_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_stream_settings_stream_subscription_request_result_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/stream_settings/stream_subscription_request_result.hbs */ "./static/templates/stream_settings/stream_subscription_request_result.hbs");
/* harmony import */ var _templates_stream_settings_stream_subscription_request_result_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_subscription_request_result_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./add_subscribers_pill */ "./static/js/add_subscribers_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _subscriber_api__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./subscriber_api */ "./static/js/subscriber_api.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");





















let pill_widget;
let current_stream_id;
let subscribers_list_widget;

function format_member_list_elem(person) {
    return _templates_stream_settings_stream_member_list_entry_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        name: person.full_name,
        user_id: person.user_id,
        is_current_user: person.user_id === Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(person),
        can_edit_subscribers: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        show_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
    });
}

function get_sub(stream_id) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("get_sub() failed id lookup: " + stream_id);
        return undefined;
    }
    return sub;
}

function show_stream_subscription_request_result({
    message,
    add_class,
    remove_class,
    subscribed_users,
    already_subscribed_users,
    ignored_deactivated_users,
}) {
    const $stream_subscription_req_result_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        ".stream_subscription_request_result",
    ).expectOne();
    const html = _templates_stream_settings_stream_subscription_request_result_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        message,
        subscribed_users,
        already_subscribed_users,
        ignored_deactivated_users,
    });
    _ui__WEBPACK_IMPORTED_MODULE_13__.get_content_element($stream_subscription_req_result_elem).html(html);
    if (add_class) {
        $stream_subscription_req_result_elem.addClass(add_class);
    }
    if (remove_class) {
        $stream_subscription_req_result_elem.removeClass(remove_class);
    }
}

function enable_subscriber_management({sub, $parent_container}) {
    const stream_id = sub.stream_id;

    const $pill_container = $parent_container.find(".pill-container");

    // current_stream_id and pill_widget are module-level variables
    current_stream_id = stream_id;

    function get_potential_subscribers() {
        return _peer_data__WEBPACK_IMPORTED_MODULE_9__.potential_subscribers(stream_id);
    }

    pill_widget = _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_4__.create({
        $pill_container,
        get_potential_subscribers,
    });

    const user_ids = _peer_data__WEBPACK_IMPORTED_MODULE_9__.get_subscribers(stream_id);

    // We track a single subscribers_list_widget for this module, since we
    // only ever have one list of subscribers visible at a time.
    subscribers_list_widget = make_list_widget({
        $parent_container,
        name: "stream_subscribers",
        user_ids,
    });
}

function make_list_widget({$parent_container, name, user_ids}) {
    const users = _people__WEBPACK_IMPORTED_MODULE_10__.get_users_from_ids(user_ids);
    _people__WEBPACK_IMPORTED_MODULE_10__.sort_but_pin_current_user_on_top(users);

    const $list_container = $parent_container.find(".subscriber_table");
    $list_container.empty();

    const $simplebar_container = $parent_container.find(".subscriber_list_container");

    return _list_widget__WEBPACK_IMPORTED_MODULE_8__.create($list_container, users, {
        name,
        modifier(item) {
            return format_member_list_elem(item);
        },
        filter: {
            $element: $parent_container.find(".search"),
            predicate(person, value) {
                const matcher = _people__WEBPACK_IMPORTED_MODULE_10__.build_person_matcher(value);
                const match = matcher(person);

                return match;
            },
        },
        $simplebar_container,
    });
}

function subscribe_new_users({pill_user_ids}) {
    const sub = get_sub(current_stream_id);
    if (!sub) {
        return;
    }

    const deactivated_users = new Set();
    const active_user_ids = pill_user_ids.filter((user_id) => {
        if (!_people__WEBPACK_IMPORTED_MODULE_10__.is_person_active(user_id)) {
            deactivated_users.add(user_id);
            return false;
        }
        return true;
    });

    const user_id_set = new Set(active_user_ids);

    if (user_id_set.has(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) && sub.subscribed) {
        // We don't want to send a request to subscribe ourselves
        // if we are already subscribed to this stream. This
        // case occurs when creating user pills from a stream.
        user_id_set.delete(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
    }
    let ignored_deactivated_users;
    if (deactivated_users.size > 0) {
        ignored_deactivated_users = Array.from(deactivated_users);
        ignored_deactivated_users = ignored_deactivated_users.map((user_id) =>
            _people__WEBPACK_IMPORTED_MODULE_10__.get_by_user_id(user_id),
        );
    }
    if (user_id_set.size === 0) {
        show_stream_subscription_request_result({
            message: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No user to subscribe."}),
            add_class: "text-error",
            remove_class: "text-success",
            ignored_deactivated_users,
        });
        return;
    }

    const user_ids = Array.from(user_id_set);

    function invite_success(data) {
        pill_widget.clear();
        const subscribed_users = Object.keys(data.subscribed).map((email) =>
            _people__WEBPACK_IMPORTED_MODULE_10__.get_by_email(email),
        );
        const already_subscribed_users = Object.keys(data.already_subscribed).map((email) =>
            _people__WEBPACK_IMPORTED_MODULE_10__.get_by_email(email),
        );

        show_stream_subscription_request_result({
            add_class: "text-success",
            remove_class: "text-error",
            subscribed_users,
            already_subscribed_users,
            ignored_deactivated_users,
        });
    }

    function invite_failure(xhr) {
        const error = JSON.parse(xhr.responseText);
        show_stream_subscription_request_result({
            message: error.msg,
            add_class: "text-error",
            remove_class: "text-success",
        });
    }

    _subscriber_api__WEBPACK_IMPORTED_MODULE_12__.add_user_ids_to_stream(user_ids, sub, invite_success, invite_failure);
}

function remove_subscriber({stream_id, target_user_id, $list_entry}) {
    const sub = get_sub(stream_id);
    if (!sub) {
        return;
    }

    function removal_success(data) {
        let message;

        if (stream_id !== current_stream_id) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Response for subscription removal came too late.");
            return;
        }

        if (data.removed.length > 0) {
            // Remove the user from the subscriber list.
            $list_entry.remove();
            message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unsubscribed successfully!"});
            // The rest of the work is done via the subscription -> remove event we will get
        } else {
            message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User is already not subscribed."});
        }
        show_stream_subscription_request_result({
            message,
            add_class: "text-success",
            remove_class: "text-remove",
        });
    }

    function removal_failure() {
        show_stream_subscription_request_result({
            message: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error removing user from this stream."}),
            add_class: "text-error",
            remove_class: "text-success",
        });
    }

    function remove_user_from_private_stream() {
        _subscriber_api__WEBPACK_IMPORTED_MODULE_12__.remove_user_id_from_stream(
            target_user_id,
            sub,
            removal_success,
            removal_failure,
        );
    }

    if (sub.invite_only && _people__WEBPACK_IMPORTED_MODULE_10__.is_my_user_id(target_user_id)) {
        const html_body = _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
            message: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "Once you leave this stream, you will not be able to rejoin.",
            }),
        });

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_6__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "Unsubscribe from {stream_name}"},
                {stream_name: sub.name},
            ),
            html_body,
            on_click: remove_user_from_private_stream,
        });
        return;
    }

    _subscriber_api__WEBPACK_IMPORTED_MODULE_12__.remove_user_id_from_stream(
        target_user_id,
        sub,
        removal_success,
        removal_failure,
    );
}

function update_subscribers_list(sub) {
    // This is for the "Subscribers" tab of the right panel.
    // Render subscriptions only if stream settings is open
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_7__.is_editing_stream(sub.stream_id)) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("ignoring subscription for stream that is no longer being edited");
        return;
    }

    if (sub.stream_id !== current_stream_id) {
        // This should never happen if the prior check works correctly.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("current_stream_id does not match sub.stream_id for some reason");
        return;
    }

    if (!_stream_data__WEBPACK_IMPORTED_MODULE_11__.can_view_subscribers(sub)) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".subscriber_list_settings_container").hide();
    } else {
        // Re-render the whole list when we add new users.  This is
        // inefficient for the single-user case, but using the big-hammer
        // approach is superior when you do things like add subscribers
        // from an existing stream or a user group.
        const subscriber_ids = _peer_data__WEBPACK_IMPORTED_MODULE_9__.get_subscribers(sub.stream_id);
        update_subscribers_list_widget(subscriber_ids);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".subscriber_list_settings_container").show();
    }
}

function update_subscribers_list_widget(subscriber_ids) {
    // This re-renders the subscribers_list_widget with a new
    // list of subscriber_ids.
    const users = _people__WEBPACK_IMPORTED_MODULE_10__.get_users_from_ids(subscriber_ids);
    _people__WEBPACK_IMPORTED_MODULE_10__.sort_but_pin_current_user_on_top(users);
    subscribers_list_widget.replace_list_data(users);
}

function initialize() {
    _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_4__.set_up_handlers({
        get_pill_widget: () => pill_widget,
        $parent_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container"),
        pill_selector: ".edit_subscribers_for_stream .pill-container",
        button_selector: ".edit_subscribers_for_stream .add-subscriber-button",
        action: subscribe_new_users,
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on(
        "submit",
        ".edit_subscribers_for_stream .subscriber_list_remove form",
        (e) => {
            e.preventDefault();

            const $list_entry = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest("tr");
            const target_user_id = Number.parseInt($list_entry.attr("data-subscriber-id"), 10);
            const stream_id = current_stream_id;

            remove_subscriber({stream_id, target_user_id, $list_entry});
        },
    );
}


/***/ }),

/***/ "./static/js/stream_events.js":
/*!************************************!*\
  !*** ./static/js/stream_events.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "mark_subscribed": () => (/* binding */ mark_subscribed),
/* harmony export */   "mark_unsubscribed": () => (/* binding */ mark_unsubscribed),
/* harmony export */   "remove_deactivated_user_from_all_streams": () => (/* binding */ remove_deactivated_user_from_all_streams),
/* harmony export */   "update_property": () => (/* binding */ update_property)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _stream_color__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_color */ "./static/js/stream_color.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_muting__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./stream_muting */ "./static/js/stream_muting.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");



















// In theory, this function should apply the account-level defaults,
// however, they are only called after a manual override, so
// doing so is unnecessary with the current code.  Ideally, we'd do a
// refactor to address that, however.
function update_stream_setting(sub, value, setting) {
    const $setting_checkbox = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(setting)}_${CSS.escape(sub.stream_id)}`);
    $setting_checkbox.prop("checked", value);
    sub[setting] = value;
}

function update_property(stream_id, property, value, other_values) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (sub === undefined) {
        // This isn't a stream we know about, so ignore it.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Update for an unknown subscription", {
            stream_id,
            property,
            value,
        });
        return;
    }

    switch (property) {
        case "color":
            _stream_color__WEBPACK_IMPORTED_MODULE_9__.update_stream_color(sub, value, {update_historical: true});
            break;
        case "in_home_view":
            // Legacy in_home_view events are only sent as duplicates of
            // modern is_muted events, which we handle below.
            break;
        case "is_muted":
            _stream_muting__WEBPACK_IMPORTED_MODULE_12__.update_is_muted(sub, value);
            _stream_list__WEBPACK_IMPORTED_MODULE_11__.refresh_muted_or_unmuted_stream(sub);
            _recent_topics_ui__WEBPACK_IMPORTED_MODULE_7__.complete_rerender();
            break;
        case "desktop_notifications":
        case "audible_notifications":
        case "push_notifications":
        case "email_notifications":
        case "wildcard_mentions_notify":
            update_stream_setting(sub, value, property);
            _settings_notifications__WEBPACK_IMPORTED_MODULE_8__.update_page(_settings_notifications__WEBPACK_IMPORTED_MODULE_8__.user_settings_panel);
            break;
        case "name":
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_stream_name(sub, value);
            break;
        case "description":
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_stream_description(
                sub,
                value,
                other_values.rendered_description,
            );
            break;
        case "email_address":
            sub.email_address = value;
            break;
        case "pin_to_top":
            update_stream_setting(sub, value, property);
            _stream_list__WEBPACK_IMPORTED_MODULE_11__.refresh_pinned_or_unpinned_stream(sub);
            break;
        case "invite_only":
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_stream_privacy(sub, {
                invite_only: value,
                history_public_to_subscribers: other_values.history_public_to_subscribers,
                is_web_public: other_values.is_web_public,
            });
            break;
        case "stream_post_policy":
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_stream_post_policy(sub, value);
            break;
        case "message_retention_days":
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_message_retention_setting(sub, value);
            break;
        default:
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected subscription property type", {
                property,
                value,
            });
    }
}

// Add yourself to a stream we already know about client-side.
// It's likely we should be passing in the full sub object from the caller/backend,
// but for now we just pass in the subscribers and color (things likely to be different).
function mark_subscribed(sub, subscribers, color) {
    if (sub === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined sub passed to mark_subscribed");
        return;
    }

    if (sub.subscribed) {
        return;
    }

    // If the backend sent us a color, use that
    if (color !== undefined && sub.color !== color) {
        sub.color = color;
        _stream_color__WEBPACK_IMPORTED_MODULE_9__.update_stream_color(sub, color, {update_historical: true});
    } else if (sub.color === undefined) {
        // If the backend didn't, and we have a color already, send
        // the backend that color.  It's not clear this code path is
        // needed.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Frontend needed to pick a color in mark_subscribed");
        color = Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.set_color(sub.stream_id, color);
    }
    _stream_data__WEBPACK_IMPORTED_MODULE_10__.subscribe_myself(sub);
    if (subscribers) {
        _peer_data__WEBPACK_IMPORTED_MODULE_6__.set_subscribers(sub.stream_id, subscribers);
    }

    if (_overlays__WEBPACK_IMPORTED_MODULE_5__.streams_open()) {
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_settings_for_subscribed(sub);
    }

    // update navbar if necessary
    _message_view_header__WEBPACK_IMPORTED_MODULE_3__.maybe_rerender_title_area_for_stream(sub);

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_4__.is_for_stream_id(sub.stream_id)) {
        _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.update_trailing_bookend();
    }

    // The new stream in sidebar might need its unread counts
    // re-calculated.
    _unread_ui__WEBPACK_IMPORTED_MODULE_14__.update_unread_counts();

    _stream_list__WEBPACK_IMPORTED_MODULE_11__.add_sidebar_row(sub);
    _stream_list__WEBPACK_IMPORTED_MODULE_11__.update_subscribe_to_more_streams_link();
}

function mark_unsubscribed(sub) {
    if (sub === undefined) {
        // We don't know about this stream
        return;
    } else if (sub.subscribed) {
        _stream_data__WEBPACK_IMPORTED_MODULE_10__.unsubscribe_myself(sub);
        if (_overlays__WEBPACK_IMPORTED_MODULE_5__.streams_open()) {
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_settings_for_unsubscribed(sub);
        }
        // update navbar if necessary
        _message_view_header__WEBPACK_IMPORTED_MODULE_3__.maybe_rerender_title_area_for_stream(sub);
    } else {
        // Already unsubscribed
        return;
    }

    if (_narrow_state__WEBPACK_IMPORTED_MODULE_4__.is_for_stream_id(sub.stream_id)) {
        _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.update_trailing_bookend();
    }

    // Unread messages in the now-unsubscribe stream need to be
    // removed from global count totals.
    _unread_ui__WEBPACK_IMPORTED_MODULE_14__.update_unread_counts();

    _stream_list__WEBPACK_IMPORTED_MODULE_11__.remove_sidebar_row(sub.stream_id);
    _stream_list__WEBPACK_IMPORTED_MODULE_11__.update_subscribe_to_more_streams_link();
}

function remove_deactivated_user_from_all_streams(user_id) {
    const all_subs = _stream_data__WEBPACK_IMPORTED_MODULE_10__.get_unsorted_subs();

    for (const sub of all_subs) {
        if (_stream_data__WEBPACK_IMPORTED_MODULE_10__.is_user_subscribed(sub.stream_id, user_id)) {
            _peer_data__WEBPACK_IMPORTED_MODULE_6__.remove_subscriber(sub.stream_id, user_id);
            _stream_settings_ui__WEBPACK_IMPORTED_MODULE_13__.update_subscribers_ui(sub);
        }
    }
}


/***/ }),

/***/ "./static/js/stream_list.js":
/*!**********************************!*\
  !*** ./static/js/stream_list.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_sidebar_row": () => (/* binding */ add_sidebar_row),
/* harmony export */   "build_stream_list": () => (/* binding */ build_stream_list),
/* harmony export */   "clear_and_hide_search": () => (/* binding */ clear_and_hide_search),
/* harmony export */   "clear_search": () => (/* binding */ clear_search),
/* harmony export */   "create_initial_sidebar_rows": () => (/* binding */ create_initial_sidebar_rows),
/* harmony export */   "create_sidebar_row": () => (/* binding */ create_sidebar_row),
/* harmony export */   "escape_search": () => (/* binding */ escape_search),
/* harmony export */   "get_current_stream_li": () => (/* binding */ get_current_stream_li),
/* harmony export */   "get_sidebar_stream_topic_info": () => (/* binding */ get_sidebar_stream_topic_info),
/* harmony export */   "get_stream_li": () => (/* binding */ get_stream_li),
/* harmony export */   "handle_narrow_activated": () => (/* binding */ handle_narrow_activated),
/* harmony export */   "handle_narrow_deactivated": () => (/* binding */ handle_narrow_deactivated),
/* harmony export */   "hide_search_section": () => (/* binding */ hide_search_section),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "initiate_search": () => (/* binding */ initiate_search),
/* harmony export */   "maybe_scroll_narrow_into_view": () => (/* binding */ maybe_scroll_narrow_into_view),
/* harmony export */   "redraw_stream_privacy": () => (/* binding */ redraw_stream_privacy),
/* harmony export */   "refresh_muted_or_unmuted_stream": () => (/* binding */ refresh_muted_or_unmuted_stream),
/* harmony export */   "refresh_pinned_or_unpinned_stream": () => (/* binding */ refresh_pinned_or_unpinned_stream),
/* harmony export */   "remove_sidebar_row": () => (/* binding */ remove_sidebar_row),
/* harmony export */   "rename_stream": () => (/* binding */ rename_stream),
/* harmony export */   "scroll_stream_into_view": () => (/* binding */ scroll_stream_into_view),
/* harmony export */   "searching": () => (/* binding */ searching),
/* harmony export */   "set_event_handlers": () => (/* binding */ set_event_handlers),
/* harmony export */   "set_in_home_view": () => (/* binding */ set_in_home_view),
/* harmony export */   "show_search_section": () => (/* binding */ show_search_section),
/* harmony export */   "stream_cursor": () => (/* binding */ stream_cursor),
/* harmony export */   "stream_sidebar": () => (/* binding */ stream_sidebar),
/* harmony export */   "toggle_filter_displayed": () => (/* binding */ toggle_filter_displayed),
/* harmony export */   "update_count_in_dom": () => (/* binding */ update_count_in_dom),
/* harmony export */   "update_dom_with_unread_counts": () => (/* binding */ update_dom_with_unread_counts),
/* harmony export */   "update_stream_sidebar_for_narrow": () => (/* binding */ update_stream_sidebar_for_narrow),
/* harmony export */   "update_streams_sidebar": () => (/* binding */ update_streams_sidebar),
/* harmony export */   "update_subscribe_to_more_streams_link": () => (/* binding */ update_subscribe_to_more_streams_link),
/* harmony export */   "zoom_in_topics": () => (/* binding */ zoom_in_topics),
/* harmony export */   "zoom_out_topics": () => (/* binding */ zoom_out_topics)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_filter_topics_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/filter_topics.hbs */ "./static/templates/filter_topics.hbs");
/* harmony import */ var _templates_filter_topics_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_filter_topics_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/stream_privacy.hbs */ "./static/templates/stream_privacy.hbs");
/* harmony import */ var _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_stream_sidebar_row_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/stream_sidebar_row.hbs */ "./static/templates/stream_sidebar_row.hbs");
/* harmony import */ var _templates_stream_sidebar_row_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_sidebar_row_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/streams_subheader.hbs */ "./static/templates/streams_subheader.hbs");
/* harmony import */ var _templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_subscribe_to_more_streams_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/subscribe_to_more_streams.hbs */ "./static/templates/subscribe_to_more_streams.hbs");
/* harmony import */ var _templates_subscribe_to_more_streams_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_subscribe_to_more_streams_hbs__WEBPACK_IMPORTED_MODULE_6__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_cursor__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./list_cursor */ "./static/js/list_cursor.js");
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _scroll_util__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./scroll_util */ "./static/js/scroll_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
/* harmony import */ var _stream_sort__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./stream_sort */ "./static/js/stream_sort.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _topic_list__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./topic_list */ "./static/js/topic_list.js");
/* harmony import */ var _topic_zoom__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./topic_zoom */ "./static/js/topic_zoom.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
































let stream_cursor;

let has_scrolled = false;

function update_count_in_dom($stream_li, count, stream_has_any_unread_mention_messages) {
    // The subscription_block properly excludes the topic list,
    // and it also has sensitive margins related to whether the
    // count is there or not.
    const $subscription_block = $stream_li.find(".subscription_block");

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($subscription_block, count);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        $subscription_block,
        stream_has_any_unread_mention_messages,
    );

    if (count === 0) {
        $subscription_block.removeClass("stream-with-count");
    } else {
        $subscription_block.addClass("stream-with-count");
    }
}

class StreamSidebar {
    rows = new Map(); // stream id -> row widget

    set_row(stream_id, widget) {
        this.rows.set(stream_id, widget);
    }

    get_row(stream_id) {
        return this.rows.get(stream_id);
    }

    has_row_for(stream_id) {
        return this.rows.has(stream_id);
    }

    remove_row(stream_id) {
        // This only removes the row from our data structure.
        // Our caller should use build_stream_list() to re-draw
        // the sidebar, so that we don't have to deal with edge
        // cases like removing the last pinned stream (and removing
        // the divider).

        this.rows.delete(stream_id);
    }
}
const stream_sidebar = new StreamSidebar();

function get_search_term() {
    const $search_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter");
    const search_term = $search_box.expectOne().val().trim();
    return search_term;
}

function add_sidebar_row(sub) {
    create_sidebar_row(sub);
    build_stream_list();
    stream_cursor.redraw();
}

function remove_sidebar_row(stream_id) {
    stream_sidebar.remove_row(stream_id);
    build_stream_list();
    stream_cursor.redraw();
}

function create_initial_sidebar_rows() {
    // This code is slightly opaque, but it ends up building
    // up list items and attaching them to the "sub" data
    // structures that are kept in stream_data.js.
    const subs = _stream_data__WEBPACK_IMPORTED_MODULE_16__.subscribed_subs();

    for (const sub of subs) {
        create_sidebar_row(sub);
    }
}

function build_stream_list(force_rerender) {
    // The stream list in the left sidebar contains 3 sections:
    // pinned, normal, and dormant streams, with headings above them
    // as appropriate.
    //
    // Within the first two sections, muted streams are sorted to the
    // bottom; we skip that for dormant streams to simplify discovery.
    const streams = _stream_data__WEBPACK_IMPORTED_MODULE_16__.subscribed_stream_ids();
    const $parent = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters");
    if (streams.length === 0) {
        $parent.empty();
        return;
    }

    // The main logic to build the list is in stream_sort.js, and
    // we get five lists of streams (pinned/normal/muted_pinned/muted_normal/dormant).
    const stream_groups = _stream_sort__WEBPACK_IMPORTED_MODULE_18__.sort_groups(streams, get_search_term());

    if (stream_groups.same_as_before && !force_rerender) {
        return;
    }

    const elems = [];

    function add_sidebar_li(stream_id) {
        const sidebar_row = stream_sidebar.get_row(stream_id);
        sidebar_row.update_whether_active();
        elems.push(sidebar_row.get_li());
    }

    _topic_list__WEBPACK_IMPORTED_MODULE_19__.clear();
    $parent.empty();

    const any_pinned_streams =
        stream_groups.pinned_streams.length > 0 || stream_groups.muted_pinned_streams.length > 0;
    const any_normal_streams =
        stream_groups.normal_streams.length > 0 || stream_groups.muted_active_streams.length > 0;
    const any_dormant_streams = stream_groups.dormant_streams.length > 0;

    const need_section_subheaders =
        (any_pinned_streams ? 1 : 0) +
            (any_normal_streams ? 1 : 0) +
            (any_dormant_streams ? 1 : 0) >=
        2;

    if (any_pinned_streams && need_section_subheaders) {
        elems.push(
            _templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                subheader_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage: "Pinned",
                }),
            }),
        );
    }

    for (const stream_id of stream_groups.pinned_streams) {
        add_sidebar_li(stream_id);
    }

    for (const stream_id of stream_groups.muted_pinned_streams) {
        add_sidebar_li(stream_id);
    }

    if (any_normal_streams && need_section_subheaders) {
        elems.push(
            _templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                subheader_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage: "Active",
                }),
            }),
        );
    }

    for (const stream_id of stream_groups.normal_streams) {
        add_sidebar_li(stream_id);
    }

    for (const stream_id of stream_groups.muted_active_streams) {
        add_sidebar_li(stream_id);
    }

    if (any_dormant_streams && need_section_subheaders) {
        elems.push(
            _templates_streams_subheader_hbs__WEBPACK_IMPORTED_MODULE_5___default()({
                subheader_name: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage: "Inactive",
                }),
            }),
        );
    }

    for (const stream_id of stream_groups.dormant_streams) {
        add_sidebar_li(stream_id);
    }

    $parent.append(elems);
}

function get_stream_li(stream_id) {
    const row = stream_sidebar.get_row(stream_id);
    if (!row) {
        // Not all streams are in the sidebar, so we don't report
        // an error here, and it's up for the caller to error if
        // they expected otherwise.
        return undefined;
    }

    const $li = row.get_li();
    if (!$li) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find li for id " + stream_id);
        return undefined;
    }

    if ($li.length > 1) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("stream_li has too many elements for " + stream_id);
        return undefined;
    }

    return $li;
}

function update_subscribe_to_more_streams_link() {
    const can_subscribe_stream_count = _stream_data__WEBPACK_IMPORTED_MODULE_16__.unsubscribed_subs()
        .filter((sub) => _stream_data__WEBPACK_IMPORTED_MODULE_16__.can_toggle_subscription(sub)).length;

    const can_create_streams =
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscribe-to-more-streams").html(
        _templates_subscribe_to_more_streams_hbs__WEBPACK_IMPORTED_MODULE_6___default()({
            can_subscribe_stream_count,
            can_create_streams,
            exactly_one_unsubscribed_stream: can_subscribe_stream_count === 1,
        }),
    );
}

function stream_id_for_elt($elt) {
    return Number.parseInt($elt.attr("data-stream-id"), 10);
}

function zoom_in_topics(options) {
    // This only does stream-related tasks related to zooming
    // in to more topics, which is basically hiding all the
    // other streams.

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_list").expectOne().removeClass("zoom-out").addClass("zoom-in");

    // Hide stream list titles and pinned stream splitter
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-filters-label").each(function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).hide();
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams_subheader").each(function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).hide();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters li.narrow-filter").each(function () {
        const $elt = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);
        const stream_id = options.stream_id;

        if (stream_id_for_elt($elt) === stream_id) {
            $elt.show();
            // Add search box for topics list.
            $elt.children("div.bottom_left_row").append(_templates_filter_topics_hbs__WEBPACK_IMPORTED_MODULE_2___default()());
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#filter-topic-input").trigger("focus");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_topic_button").hide();
        } else {
            $elt.hide();
        }
    });
}

function zoom_out_topics() {
    // Show stream list titles and pinned stream splitter
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-filters-label").each(function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).show();
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams_subheader").each(function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).show();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_list").expectOne().removeClass("zoom-in").addClass("zoom-out");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters li.narrow-filter").show();
    // Remove search box for topics list from DOM.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".filter-topics").remove();
}

function set_in_home_view(stream_id, in_home) {
    const $li = get_stream_li(stream_id);
    if (!$li) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("passed in bad stream id " + stream_id);
        return;
    }

    if (in_home) {
        $li.removeClass("out_of_home_view");
    } else {
        $li.addClass("out_of_home_view");
    }
}

function build_stream_sidebar_li(sub) {
    const name = sub.name;
    const args = {
        name,
        id: sub.stream_id,
        uri: _hash_util__WEBPACK_IMPORTED_MODULE_8__.by_stream_url(sub.stream_id),
        is_muted: _stream_data__WEBPACK_IMPORTED_MODULE_16__.is_muted(sub.stream_id) === true,
        invite_only: sub.invite_only,
        is_web_public: sub.is_web_public,
        color: sub.color,
        pin_to_top: sub.pin_to_top,
    };
    args.dark_background = Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(args.color);
    const $list_item = jquery__WEBPACK_IMPORTED_MODULE_0___default()(_templates_stream_sidebar_row_hbs__WEBPACK_IMPORTED_MODULE_4___default()(args));
    return $list_item;
}

class StreamSidebarRow {
    constructor(sub) {
        this.sub = sub;
        this.$list_item = build_stream_sidebar_li(sub);
        this.update_unread_count();
    }

    update_whether_active() {
        if (_stream_data__WEBPACK_IMPORTED_MODULE_16__.is_active(this.sub) || this.sub.pin_to_top === true) {
            this.$list_item.removeClass("inactive_stream");
        } else {
            this.$list_item.addClass("inactive_stream");
        }
    }

    get_li() {
        return this.$list_item;
    }

    remove() {
        this.$list_item.remove();
    }

    update_unread_count() {
        const count = _unread__WEBPACK_IMPORTED_MODULE_22__.num_unread_for_stream(this.sub.stream_id);
        const stream_has_any_unread_mention_messages = _unread__WEBPACK_IMPORTED_MODULE_22__.stream_has_any_unread_mentions(
            this.sub.stream_id,
        );
        update_count_in_dom(this.$list_item, count, stream_has_any_unread_mention_messages);
    }
}

function build_stream_sidebar_row(sub) {
    stream_sidebar.set_row(sub.stream_id, new StreamSidebarRow(sub));
}

function create_sidebar_row(sub) {
    if (stream_sidebar.has_row_for(sub.stream_id)) {
        // already exists
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Dup try to build sidebar row for stream " + sub.stream_id);
        return;
    }
    build_stream_sidebar_row(sub);
}

function redraw_stream_privacy(sub) {
    const $li = get_stream_li(sub.stream_id);
    if (!$li) {
        // We don't want to raise error here, if we can't find stream in subscription
        // stream list. Cause we allow org admin to update stream privacy
        // even if they don't subscribe to public stream.
        return;
    }

    const $div = $li.find(".stream-privacy");
    const dark_background = Object(function webpackMissingModule() { var e = new Error("Cannot find module './color_class'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(sub.color);

    const args = {
        invite_only: sub.invite_only,
        is_web_public: sub.is_web_public,
        dark_background,
    };

    const html = _templates_stream_privacy_hbs__WEBPACK_IMPORTED_MODULE_3___default()(args);
    $div.html(html);
}

function set_stream_unread_count(stream_id, count, stream_has_any_unread_mention_messages) {
    const $stream_li = get_stream_li(stream_id);
    if (!$stream_li) {
        // This can happen for legitimate reasons, but we warn
        // just in case.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("stream id no longer in sidebar: " + stream_id);
        return;
    }
    update_count_in_dom($stream_li, count, stream_has_any_unread_mention_messages);
}

function update_streams_sidebar(force_rerender) {
    build_stream_list(force_rerender);

    stream_cursor.redraw();

    if (!_narrow_state__WEBPACK_IMPORTED_MODULE_11__.active()) {
        return;
    }

    const filter = _narrow_state__WEBPACK_IMPORTED_MODULE_11__.filter();

    update_stream_sidebar_for_narrow(filter);
}

function update_dom_with_unread_counts(counts) {
    // counts.stream_count maps streams to counts
    for (const [stream_id, count] of counts.stream_count) {
        const stream_has_any_unread_mention_messages =
            counts.streams_with_mentions.includes(stream_id);
        set_stream_unread_count(stream_id, count, stream_has_any_unread_mention_messages);
    }
}

function rename_stream(sub) {
    // The sub object is expected to already have the updated name
    build_stream_sidebar_row(sub);
    update_streams_sidebar(true); // big hammer
}

function refresh_pinned_or_unpinned_stream(sub) {
    // Pinned/unpinned streams require re-ordering.
    // We use kind of brute force now, which is probably fine.
    build_stream_sidebar_row(sub);
    update_streams_sidebar();

    // Only scroll pinned topics into view.  If we're unpinning
    // a topic, we may be literally trying to get it out of
    // our sight.
    if (sub.pin_to_top) {
        const $stream_li = get_stream_li(sub.stream_id);
        if (!$stream_li) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("passed in bad stream id " + sub.stream_id);
            return;
        }
        scroll_stream_into_view($stream_li);
    }
}

function refresh_muted_or_unmuted_stream(sub) {
    build_stream_sidebar_row(sub);
    update_streams_sidebar();
}

function get_sidebar_stream_topic_info(filter) {
    const result = {
        stream_id: undefined,
        topic_selected: false,
    };

    const op_stream = filter.operands("stream");
    if (op_stream.length === 0) {
        return result;
    }

    const stream_name = op_stream[0];
    const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_16__.get_stream_id(stream_name);

    if (!stream_id) {
        return result;
    }

    if (!_stream_data__WEBPACK_IMPORTED_MODULE_16__.is_subscribed(stream_id)) {
        return result;
    }

    result.stream_id = stream_id;

    const op_topic = filter.operands("topic");
    result.topic_selected = op_topic.length === 1;

    return result;
}

function deselect_stream_items() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("ul#stream_filters li").removeClass("active-filter");
}

function update_stream_sidebar_for_narrow(filter) {
    const info = get_sidebar_stream_topic_info(filter);

    deselect_stream_items();

    const stream_id = info.stream_id;

    if (!stream_id) {
        _topic_zoom__WEBPACK_IMPORTED_MODULE_20__.clear_topics();
        return undefined;
    }

    const $stream_li = get_stream_li(stream_id);

    if (!$stream_li) {
        // This is a sanity check.  When we narrow to a subscribed
        // stream, there will always be a stream list item
        // corresponding to that stream in our sidebar.  This error
        // stopped appearing from March 2018 until at least
        // April 2020, so if it appears again, something regressed.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("No stream_li for subscribed stream " + stream_id);
        _topic_zoom__WEBPACK_IMPORTED_MODULE_20__.clear_topics();
        return undefined;
    }

    if (!info.topic_selected) {
        $stream_li.addClass("active-filter");
    }

    if (stream_id !== _topic_list__WEBPACK_IMPORTED_MODULE_19__.active_stream_id()) {
        _topic_zoom__WEBPACK_IMPORTED_MODULE_20__.clear_topics();
    }

    _topic_list__WEBPACK_IMPORTED_MODULE_19__.rebuild($stream_li, stream_id);

    return $stream_li;
}

function handle_narrow_activated(filter) {
    const $stream_li = update_stream_sidebar_for_narrow(filter);
    if ($stream_li) {
        scroll_stream_into_view($stream_li);
    }
}

function handle_narrow_deactivated() {
    deselect_stream_items();
    _topic_zoom__WEBPACK_IMPORTED_MODULE_20__.clear_topics();
}

function focus_stream_filter(e) {
    stream_cursor.reset();
    e.stopPropagation();
}

function keydown_enter_key() {
    const stream_id = stream_cursor.get_key();

    if (stream_id === undefined) {
        // This can happen for empty searches, no need to warn.
        return;
    }

    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);

    if (sub === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown stream_id for search/enter: " + stream_id);
        return;
    }

    clear_and_hide_search();
    _narrow__WEBPACK_IMPORTED_MODULE_10__.by("stream", sub.name, {trigger: "sidebar enter key"});
}

function actually_update_streams_for_search() {
    update_streams_sidebar();
    _resize__WEBPACK_IMPORTED_MODULE_14__.resize_page_components();
    stream_cursor.reset();
}

const update_streams_for_search = lodash__WEBPACK_IMPORTED_MODULE_1___default().throttle(actually_update_streams_for_search, 50);

function initialize() {
    create_initial_sidebar_rows();

    // We build the stream_list now.  It may get re-built again very shortly
    // when new messages come in, but it's fairly quick.
    build_stream_list();
    update_subscribe_to_more_streams_link();
    set_event_handlers();
}

function set_event_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters").on("click", "li .subscription_block", (e) => {
        if (e.metaKey || e.ctrlKey) {
            return;
        }
        const stream_id = stream_id_for_elt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).parents("li"));
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        _popovers__WEBPACK_IMPORTED_MODULE_13__.hide_all();
        _narrow__WEBPACK_IMPORTED_MODULE_10__.by("stream", sub.name, {trigger: "sidebar"});

        clear_and_hide_search();

        e.preventDefault();
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_stream_button").on("click", clear_search);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_header")
        .expectOne()
        .on("click", (e) => {
            e.preventDefault();
            if (e.target.id === "streams_inline_icon") {
                return;
            }
            toggle_filter_displayed(e);
        });

    function toggle_pm_header_icon() {
        if (_pm_list__WEBPACK_IMPORTED_MODULE_12__.is_private_messages_collapsed()) {
            return;
        }

        const scroll_position = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
            "#left_sidebar_scroll_container .simplebar-content-wrapper",
        ).scrollTop();
        const pm_list_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#private_messages_list").height();
        if (scroll_position > pm_list_height) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").addClass("fa-caret-right");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").removeClass("fa-caret-down");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").addClass("fa-caret-down");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#toggle_private_messages_section_icon").removeClass("fa-caret-right");
        }
    }

    // check for user scrolls on streams list for first time
    _ui__WEBPACK_IMPORTED_MODULE_21__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_sidebar_scroll_container")).on("scroll", () => {
        has_scrolled = true;
        toggle_pm_header_icon();
    });

    stream_cursor = new _list_cursor__WEBPACK_IMPORTED_MODULE_9__.ListCursor({
        list: {
            scroll_container_sel: "#left_sidebar_scroll_container",
            find_li(opts) {
                const stream_id = opts.key;
                const li = get_stream_li(stream_id);
                return li;
            },
            first_key: _stream_sort__WEBPACK_IMPORTED_MODULE_18__.first_stream_id,
            prev_key: _stream_sort__WEBPACK_IMPORTED_MODULE_18__.prev_stream_id,
            next_key: _stream_sort__WEBPACK_IMPORTED_MODULE_18__.next_stream_id,
        },
        highlight_class: "highlighted_stream",
    });

    const $search_input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter").expectOne();

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
        $elem: $search_input,
        handlers: {
            Enter() {
                keydown_enter_key();
                return true;
            },
            ArrowUp() {
                stream_cursor.prev();
                return true;
            },
            ArrowDown() {
                stream_cursor.next();
                return true;
            },
        },
    });

    $search_input.on("click", focus_stream_filter);
    $search_input.on("focusout", () => stream_cursor.clear());
    $search_input.on("input", update_streams_for_search);
}

function searching() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter").expectOne().is(":focus");
}

function escape_search() {
    const $filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter").expectOne();
    if ($filter.val() === "") {
        clear_and_hide_search();
        return;
    }
    $filter.val("");
    update_streams_for_search();
}

function clear_search(e) {
    e.stopPropagation();
    const $filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter").expectOne();
    if ($filter.val() === "") {
        clear_and_hide_search();
        return;
    }
    $filter.val("");
    $filter.trigger("blur");
    update_streams_for_search();
}

function show_search_section() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_search_section").expectOne().removeClass("notdisplayed");
    _resize__WEBPACK_IMPORTED_MODULE_14__.resize_stream_filters_container();
}

function hide_search_section() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_search_section").expectOne().addClass("notdisplayed");
    _resize__WEBPACK_IMPORTED_MODULE_14__.resize_stream_filters_container();
}

function initiate_search() {
    show_search_section();

    const $filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter").expectOne();

    if (
        // Check if left column is a popover and is not visible.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streamlist-toggle").is(":visible") &&
        !jquery__WEBPACK_IMPORTED_MODULE_0___default()(".app-main .column-left").hasClass("expanded")
    ) {
        _popovers__WEBPACK_IMPORTED_MODULE_13__.hide_all();
        _stream_popover__WEBPACK_IMPORTED_MODULE_17__.show_streamlist_sidebar();
    }
    $filter.trigger("focus");

    stream_cursor.reset();
}

function clear_and_hide_search() {
    const $filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-list-filter");
    if ($filter.val() !== "") {
        $filter.val("");
        update_streams_for_search();
    }
    stream_cursor.clear();
    $filter.trigger("blur");

    hide_search_section();
}

function toggle_filter_displayed(e) {
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_search_section.notdisplayed").length === 0) {
        clear_and_hide_search();
    } else {
        initiate_search();
    }
    e.preventDefault();
}

function scroll_stream_into_view($stream_li) {
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_sidebar_scroll_container");

    if ($stream_li.length !== 1) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Invalid stream_li was passed in");
        return;
    }
    const stream_header_height = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streams_header").outerHeight();
    _scroll_util__WEBPACK_IMPORTED_MODULE_15__.scroll_element_into_container($stream_li, $container, stream_header_height);
}

function maybe_scroll_narrow_into_view() {
    // we don't want to interfere with user scrolling once the page loads
    if (has_scrolled) {
        return;
    }

    const $stream_li = get_current_stream_li();
    if ($stream_li) {
        scroll_stream_into_view($stream_li);
    }
}

function get_current_stream_li() {
    const stream_id = _topic_list__WEBPACK_IMPORTED_MODULE_19__.active_stream_id();

    if (!stream_id) {
        // stream_id is undefined in non-stream narrows
        return undefined;
    }

    const $stream_li = get_stream_li(stream_id);

    if (!$stream_li) {
        // This code path shouldn't ever be reached.
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("No active stream_li found for defined id " + stream_id);
        return undefined;
    }

    return $stream_li;
}


/***/ }),

/***/ "./static/js/stream_muting.js":
/*!************************************!*\
  !*** ./static/js/stream_muting.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "update_is_muted": () => (/* binding */ update_is_muted)
/* harmony export */ });
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_scroll__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_scroll */ "./static/js/message_scroll.js");
/* harmony import */ var _message_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_util */ "./static/js/message_util.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _navigate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./navigate */ "./static/js/navigate.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _settings_notifications__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./settings_notifications */ "./static/js/settings_notifications.js");
/* harmony import */ var _stream_edit__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_edit */ "./static/js/stream_edit.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");












function update_is_muted(sub, value) {
    sub.is_muted = value;

    setTimeout(() => {
        let msg_offset;
        let saved_ypos;
        // Save our current scroll position
        if (_overlays__WEBPACK_IMPORTED_MODULE_6__.is_active() || _overlays__WEBPACK_IMPORTED_MODULE_6__.is_modal_open()) {
            saved_ypos = _message_viewport__WEBPACK_IMPORTED_MODULE_4__.scrollTop();
        } else if (
            _message_lists__WEBPACK_IMPORTED_MODULE_1__.home === _message_lists__WEBPACK_IMPORTED_MODULE_1__.current &&
            _message_lists__WEBPACK_IMPORTED_MODULE_1__.current.selected_row().offset() !== null
        ) {
            msg_offset = _message_lists__WEBPACK_IMPORTED_MODULE_1__.current.selected_row().offset().top;
        }

        _message_lists__WEBPACK_IMPORTED_MODULE_1__.home.clear({clear_selected_id: false});

        // Recreate the message_lists.home with the newly filtered all_messages_data
        _message_util__WEBPACK_IMPORTED_MODULE_3__.add_old_messages(_all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.all_messages(), _message_lists__WEBPACK_IMPORTED_MODULE_1__.home);

        // Ensure we're still at the same scroll position
        if (_overlays__WEBPACK_IMPORTED_MODULE_6__.is_overlay_or_modal_open()) {
            _message_viewport__WEBPACK_IMPORTED_MODULE_4__.scrollTop(saved_ypos);
        } else if (_message_lists__WEBPACK_IMPORTED_MODULE_1__.home === _message_lists__WEBPACK_IMPORTED_MODULE_1__.current) {
            // We pass use_closest to handle the case where the
            // currently selected message is being hidden from the
            // home view
            _message_lists__WEBPACK_IMPORTED_MODULE_1__.home.select_id(_message_lists__WEBPACK_IMPORTED_MODULE_1__.home.selected_id(), {
                use_closest: true,
                empty_ok: true,
            });
            if (_message_lists__WEBPACK_IMPORTED_MODULE_1__.current.selected_id() !== -1) {
                _message_lists__WEBPACK_IMPORTED_MODULE_1__.current.view.set_message_offset(msg_offset);
            }
        }

        // In case we added messages to what's visible in the home
        // view, we need to re-scroll to make sure the pointer is
        // still visible. We don't want the auto-scroll handler to
        // move our pointer to the old scroll location before we have
        // a chance to update it.
        _navigate__WEBPACK_IMPORTED_MODULE_5__.plan_scroll_to_selected();
        _message_scroll__WEBPACK_IMPORTED_MODULE_2__.suppress_selection_update_on_next_scroll();

        // Since muted streams aren't counted in visible unread
        // counts, we need to update the rendering of them.
        _unread_ui__WEBPACK_IMPORTED_MODULE_10__.update_unread_counts();
    }, 0);

    _settings_notifications__WEBPACK_IMPORTED_MODULE_7__.update_muted_stream_state(sub);
    _stream_edit__WEBPACK_IMPORTED_MODULE_8__.update_muting_rendering(sub);
    _stream_list__WEBPACK_IMPORTED_MODULE_9__.set_in_home_view(sub.stream_id, !sub.is_muted);
}


/***/ }),

/***/ "./static/js/stream_pill.js":
/*!**********************************!*\
  !*** ./static/js/stream_pill.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "append_stream": () => (/* binding */ append_stream),
/* harmony export */   "create_item_from_stream_name": () => (/* binding */ create_item_from_stream_name),
/* harmony export */   "filter_taken_streams": () => (/* binding */ filter_taken_streams),
/* harmony export */   "get_stream_ids": () => (/* binding */ get_stream_ids),
/* harmony export */   "get_stream_name_from_item": () => (/* binding */ get_stream_name_from_item),
/* harmony export */   "get_user_ids": () => (/* binding */ get_user_ids),
/* harmony export */   "typeahead_source": () => (/* binding */ typeahead_source)
/* harmony export */ });
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");



function display_pill(sub) {
    const sub_count = _peer_data__WEBPACK_IMPORTED_MODULE_0__.get_subscriber_count(sub.stream_id);
    return "#" + sub.name + ": " + sub_count + " users";
}

function create_item_from_stream_name(stream_name, current_items) {
    stream_name = stream_name.trim();
    if (!stream_name.startsWith("#")) {
        return undefined;
    }
    stream_name = stream_name.slice(1);

    const sub = _stream_data__WEBPACK_IMPORTED_MODULE_1__.get_sub(stream_name);
    if (!sub) {
        return undefined;
    }

    const existing_ids = current_items.map((item) => item.stream_id);
    if (existing_ids.includes(sub.stream_id)) {
        return undefined;
    }

    const item = {
        type: "stream",
        display_value: display_pill(sub),
        stream_id: sub.stream_id,
        stream_name: sub.name,
    };

    return item;
}

function get_stream_name_from_item(item) {
    return item.stream_name;
}

function get_user_ids_from_subs(items) {
    let user_ids = [];
    for (const item of items) {
        // only some of our items have streams (for copy-from-stream)
        if (item.stream_id !== undefined) {
            user_ids = user_ids.concat(_peer_data__WEBPACK_IMPORTED_MODULE_0__.get_subscribers(item.stream_id));
        }
    }
    return user_ids;
}

function get_user_ids(pill_widget) {
    const items = pill_widget.items();
    let user_ids = get_user_ids_from_subs(items);
    user_ids = Array.from(new Set(user_ids));

    user_ids = user_ids.filter(Boolean);
    user_ids.sort((a, b) => a - b);
    return user_ids;
}

function append_stream(stream, pill_widget) {
    pill_widget.appendValidatedData({
        type: "stream",
        display_value: display_pill(stream),
        stream_id: stream.stream_id,
        stream_name: stream.name,
    });
    pill_widget.clear_text();
}

function get_stream_ids(pill_widget) {
    const items = pill_widget.items();
    let stream_ids = items.map((item) => item.stream_id);
    stream_ids = stream_ids.filter(Boolean);

    return stream_ids;
}

function filter_taken_streams(items, pill_widget) {
    const taken_stream_ids = get_stream_ids(pill_widget);
    items = items.filter((item) => !taken_stream_ids.includes(item.stream_id));
    return items;
}

function typeahead_source(pill_widget) {
    const potential_streams = _stream_data__WEBPACK_IMPORTED_MODULE_1__.get_unsorted_subs();
    return filter_taken_streams(potential_streams, pill_widget);
}


/***/ }),

/***/ "./static/js/stream_popover.js":
/*!*************************************!*\
  !*** ./static/js/stream_popover.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "all_messages_popped": () => (/* binding */ all_messages_popped),
/* harmony export */   "all_messages_sidebar_menu_handle_keyboard": () => (/* binding */ all_messages_sidebar_menu_handle_keyboard),
/* harmony export */   "build_move_topic_to_stream_popover": () => (/* binding */ build_move_topic_to_stream_popover),
/* harmony export */   "drafts_popped": () => (/* binding */ drafts_popped),
/* harmony export */   "hide_all_messages_popover": () => (/* binding */ hide_all_messages_popover),
/* harmony export */   "hide_drafts_popover": () => (/* binding */ hide_drafts_popover),
/* harmony export */   "hide_starred_messages_popover": () => (/* binding */ hide_starred_messages_popover),
/* harmony export */   "hide_stream_popover": () => (/* binding */ hide_stream_popover),
/* harmony export */   "hide_streamlist_sidebar": () => (/* binding */ hide_streamlist_sidebar),
/* harmony export */   "hide_topic_popover": () => (/* binding */ hide_topic_popover),
/* harmony export */   "register_click_handlers": () => (/* binding */ register_click_handlers),
/* harmony export */   "register_stream_handlers": () => (/* binding */ register_stream_handlers),
/* harmony export */   "register_topic_handlers": () => (/* binding */ register_topic_handlers),
/* harmony export */   "show_streamlist_sidebar": () => (/* binding */ show_streamlist_sidebar),
/* harmony export */   "starred_messages_popped": () => (/* binding */ starred_messages_popped),
/* harmony export */   "starred_messages_sidebar_menu_handle_keyboard": () => (/* binding */ starred_messages_sidebar_menu_handle_keyboard),
/* harmony export */   "stream_popped": () => (/* binding */ stream_popped),
/* harmony export */   "stream_sidebar_menu_handle_keyboard": () => (/* binding */ stream_sidebar_menu_handle_keyboard),
/* harmony export */   "topic_popped": () => (/* binding */ topic_popped),
/* harmony export */   "topic_sidebar_menu_handle_keyboard": () => (/* binding */ topic_sidebar_menu_handle_keyboard)
/* harmony export */ });
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clipboard */ "./node_modules/clipboard/dist/clipboard.js");
/* harmony import */ var clipboard__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(clipboard__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _templates_all_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/all_messages_sidebar_actions.hbs */ "./static/templates/all_messages_sidebar_actions.hbs");
/* harmony import */ var _templates_all_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_all_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_confirm_dialog_confirm_delete_topic_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_delete_topic.hbs */ "./static/templates/confirm_dialog/confirm_delete_topic.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_delete_topic_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_delete_topic_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_drafts_sidebar_action_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/drafts_sidebar_action.hbs */ "./static/templates/drafts_sidebar_action.hbs");
/* harmony import */ var _templates_drafts_sidebar_action_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_drafts_sidebar_action_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_move_topic_to_stream_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/move_topic_to_stream.hbs */ "./static/templates/move_topic_to_stream.hbs");
/* harmony import */ var _templates_move_topic_to_stream_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_move_topic_to_stream_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_starred_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/starred_messages_sidebar_actions.hbs */ "./static/templates/starred_messages_sidebar_actions.hbs");
/* harmony import */ var _templates_starred_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_starred_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _templates_stream_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../templates/stream_sidebar_actions.hbs */ "./static/templates/stream_sidebar_actions.hbs");
/* harmony import */ var _templates_stream_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _templates_topic_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../templates/topic_sidebar_actions.hbs */ "./static/templates/topic_sidebar_actions.hbs");
/* harmony import */ var _templates_topic_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(_templates_topic_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_9__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _composebox_typeahead__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./composebox_typeahead */ "./static/js/composebox_typeahead.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _drafts__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./drafts */ "./static/js/drafts.js");
/* harmony import */ var _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./dropdown_list_widget */ "./static/js/dropdown_list_widget.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_edit__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./message_edit */ "./static/js/message_edit.js");
/* harmony import */ var _muted_topics_ui__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./muted_topics_ui */ "./static/js/muted_topics_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _starred_messages__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./starred_messages */ "./static/js/starred_messages.js");
/* harmony import */ var _starred_messages_ui__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./starred_messages_ui */ "./static/js/starred_messages_ui.js");
/* harmony import */ var _stream_bar__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./stream_bar */ "./static/js/stream_bar.js");
/* harmony import */ var _stream_color__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./stream_color */ "./static/js/stream_color.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");










































// We handle stream popovers and topic popovers in this
// module.  Both are popped up from the left sidebar.
let current_stream_sidebar_elem;
let current_topic_sidebar_elem;
let all_messages_sidebar_elem;
let starred_messages_sidebar_elem;
let drafts_sidebar_elem;
let stream_widget;
let $stream_header_colorblock;

// Keep the menu icon over which the popover is based off visible.
function show_left_sidebar_menu_icon(element) {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(element).closest("[class*='-sidebar-menu-icon']").addClass("left_sidebar_menu_icon_visible");
}

// Remove the class from element when popover is closed
function hide_left_sidebar_menu_icon() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".left_sidebar_menu_icon_visible").removeClass("left_sidebar_menu_icon_visible");
}

function get_popover_menu_items(sidebar_elem) {
    if (!sidebar_elem) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Trying to get menu items when action popover is closed.");
        return undefined;
    }

    const popover_data = jquery__WEBPACK_IMPORTED_MODULE_1___default()(sidebar_elem).data("popover");
    if (!popover_data) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find popover data for stream sidebar menu.");
        return undefined;
    }
    return jquery__WEBPACK_IMPORTED_MODULE_1___default()("li:not(.divider):visible > a", popover_data.$tip);
}

function stream_sidebar_menu_handle_keyboard(key) {
    const items = get_popover_menu_items(current_stream_sidebar_elem);
    _popovers__WEBPACK_IMPORTED_MODULE_22__.popover_items_handle_keyboard(key, items);
}

function topic_sidebar_menu_handle_keyboard(key) {
    const items = get_popover_menu_items(current_topic_sidebar_elem);
    _popovers__WEBPACK_IMPORTED_MODULE_22__.popover_items_handle_keyboard(key, items);
}

function all_messages_sidebar_menu_handle_keyboard(key) {
    const items = get_popover_menu_items(all_messages_sidebar_elem);
    _popovers__WEBPACK_IMPORTED_MODULE_22__.popover_items_handle_keyboard(key, items);
}

function starred_messages_sidebar_menu_handle_keyboard(key) {
    const items = get_popover_menu_items(starred_messages_sidebar_elem);
    _popovers__WEBPACK_IMPORTED_MODULE_22__.popover_items_handle_keyboard(key, items);
}

function elem_to_stream_id($elem) {
    const stream_id = Number.parseInt($elem.attr("data-stream-id"), 10);

    if (stream_id === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("could not find stream id");
    }

    return stream_id;
}

function topic_popover_stream_id(e) {
    return elem_to_stream_id(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget));
}

function stream_popped() {
    return current_stream_sidebar_elem !== undefined;
}

function topic_popped() {
    return current_topic_sidebar_elem !== undefined;
}

function all_messages_popped() {
    return all_messages_sidebar_elem !== undefined;
}

function starred_messages_popped() {
    return starred_messages_sidebar_elem !== undefined;
}

function drafts_popped() {
    return drafts_sidebar_elem !== undefined;
}

function hide_stream_popover() {
    if (stream_popped()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(current_stream_sidebar_elem).popover("destroy");
        hide_left_sidebar_menu_icon();
        current_stream_sidebar_elem = undefined;
    }
}

function hide_topic_popover() {
    if (topic_popped()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(current_topic_sidebar_elem).popover("destroy");
        hide_left_sidebar_menu_icon();
        current_topic_sidebar_elem = undefined;
    }
}

function hide_all_messages_popover() {
    if (all_messages_popped()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(all_messages_sidebar_elem).popover("destroy");
        hide_left_sidebar_menu_icon();
        all_messages_sidebar_elem = undefined;
    }
}

function hide_starred_messages_popover() {
    if (starred_messages_popped()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(starred_messages_sidebar_elem).popover("destroy");
        hide_left_sidebar_menu_icon();
        starred_messages_sidebar_elem = undefined;
    }
}

function hide_drafts_popover() {
    if (drafts_popped()) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(drafts_sidebar_elem).popover("destroy");
        hide_left_sidebar_menu_icon();
        drafts_sidebar_elem = undefined;
    }
}

function show_streamlist_sidebar() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app-main .column-left").addClass("expanded");
    _resize__WEBPACK_IMPORTED_MODULE_23__.resize_stream_filters_container();
}

function hide_streamlist_sidebar() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(".app-main .column-left").removeClass("expanded");
}

function stream_popover_sub(e) {
    const $elem = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).parents("ul");
    const stream_id = elem_to_stream_id($elem);
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown stream: " + stream_id);
        return undefined;
    }
    return sub;
}

// This little function is a workaround for the fact that
// Bootstrap popovers don't properly handle being resized --
// so after resizing our popover to add in the spectrum color
// picker, we need to adjust its height accordingly.
function update_spectrum($popover, update_func) {
    const initial_height = $popover[0].offsetHeight;

    const $colorpicker = $popover.find(".colorpicker-container").find(".colorpicker");
    update_func($colorpicker);
    const after_height = $popover[0].offsetHeight;

    const $popover_root = $popover.closest(".popover");
    const current_top_px = Number.parseFloat($popover_root.css("top").replace("px", ""));
    const height_delta = after_height - initial_height;
    let top = current_top_px - height_delta / 2;

    if (top < 0) {
        top = 0;
        $popover_root.find("div.arrow").hide();
    } else if (top + after_height > jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).height() - 20) {
        top = jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).height() - after_height - 20;
        if (top < 0) {
            top = 0;
        }
        $popover_root.find("div.arrow").hide();
    }

    $popover_root.css("top", top + "px");
}

// Builds the `Copy link to topic` topic action.
function build_topic_link_clipboard(url) {
    if (!url) {
        return;
    }

    const copy_event = new (clipboard__WEBPACK_IMPORTED_MODULE_0___default())(".sidebar-popover-copy-link-to-topic", {
        text() {
            return url;
        },
    });

    // Hide the topic popover once the url is successfully
    // copied to clipboard.
    copy_event.on("success", () => {
        hide_topic_popover();
    });
}

function build_stream_popover(opts) {
    const elt = opts.elt;
    const stream_id = opts.stream_id;

    if (stream_popped() && current_stream_sidebar_elem === elt) {
        // If the popover is already shown, clicking again should toggle it.
        hide_stream_popover();
        return;
    }

    _popovers__WEBPACK_IMPORTED_MODULE_22__.hide_all_except_sidebars();

    const content = _templates_stream_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_8___default()({
        stream: Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id),
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover({
        content,
        html: true,
        trigger: "manual",
        fixed: true,
        fix_positions: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover("show");
    const $popover = jquery__WEBPACK_IMPORTED_MODULE_1___default()(`.streams_popover[data-stream-id="${CSS.escape(stream_id)}"]`);

    update_spectrum($popover, ($colorpicker) => {
        $colorpicker.spectrum(_stream_color__WEBPACK_IMPORTED_MODULE_27__.sidebar_popover_colorpicker_options);
    });

    current_stream_sidebar_elem = elt;
    show_left_sidebar_menu_icon(elt);
}

function build_topic_popover(opts) {
    const elt = opts.elt;
    const stream_id = opts.stream_id;
    const topic_name = opts.topic_name;

    if (topic_popped() && current_topic_sidebar_elem === elt) {
        // If the popover is already shown, clicking again should toggle it.
        hide_topic_popover();
        return;
    }

    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    if (!sub) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("cannot build topic popover for stream: " + stream_id);
        return;
    }

    _popovers__WEBPACK_IMPORTED_MODULE_22__.hide_all_except_sidebars();

    const topic_muted = _user_topics__WEBPACK_IMPORTED_MODULE_31__.is_topic_muted(sub.stream_id, topic_name);
    const has_starred_messages = _starred_messages__WEBPACK_IMPORTED_MODULE_24__.get_count_in_topic(sub.stream_id, topic_name) > 0;
    // Arguably, we could offer the "Move topic" option even if users
    // can only edit the name within a stream.
    const can_move_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

    const content = _templates_topic_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_9___default()({
        stream_name: sub.name,
        stream_id: sub.stream_id,
        topic_name,
        topic_muted,
        can_move_topic,
        is_realm_admin: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        topic_is_resolved: _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_2__.is_resolved(topic_name),
        color: sub.color,
        has_starred_messages,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover({
        content,
        html: true,
        trigger: "manual",
        fixed: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover("show");

    current_topic_sidebar_elem = elt;
    show_left_sidebar_menu_icon(elt);
}

function build_all_messages_popover(e) {
    const elt = e.target;

    if (all_messages_popped() && all_messages_sidebar_elem === elt) {
        hide_all_messages_popover();
        e.stopPropagation();
        return;
    }

    _popovers__WEBPACK_IMPORTED_MODULE_22__.hide_all_except_sidebars();

    const content = _templates_all_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_3___default()();

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover({
        content,
        html: true,
        trigger: "manual",
        fixed: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover("show");
    all_messages_sidebar_elem = elt;
    show_left_sidebar_menu_icon(elt);
    e.stopPropagation();
}

function build_starred_messages_popover(e) {
    const elt = e.target;

    if (starred_messages_popped() && starred_messages_sidebar_elem === elt) {
        hide_starred_messages_popover();
        e.stopPropagation();
        return;
    }

    _popovers__WEBPACK_IMPORTED_MODULE_22__.hide_all_except_sidebars();

    const show_unstar_all_button = _starred_messages__WEBPACK_IMPORTED_MODULE_24__.get_count() > 0;
    const content = _templates_starred_messages_sidebar_actions_hbs__WEBPACK_IMPORTED_MODULE_7___default()({
        show_unstar_all_button,
        starred_message_counts: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover({
        content,
        html: true,
        trigger: "manual",
        fixed: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover("show");
    starred_messages_sidebar_elem = elt;
    show_left_sidebar_menu_icon(elt);
    e.stopPropagation();
}

function build_drafts_popover(e) {
    const elt = e.target;

    if (drafts_popped() && drafts_sidebar_elem === elt) {
        hide_drafts_popover();
        e.stopPropagation();
        return;
    }

    _popovers__WEBPACK_IMPORTED_MODULE_22__.hide_all_except_sidebars();
    const content = _templates_drafts_sidebar_action_hbs__WEBPACK_IMPORTED_MODULE_5___default()({});
    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover({
        content,
        html: true,
        trigger: "manual",
        fixed: true,
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).popover("show");
    drafts_sidebar_elem = elt;
    show_left_sidebar_menu_icon(elt);
    e.stopPropagation();
}

function build_move_topic_to_stream_popover(current_stream_id, topic_name, message) {
    const current_stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_28__.maybe_get_stream_name(current_stream_id);
    const args = {
        topic_name,
        current_stream_id,
        notify_new_thread: _message_edit__WEBPACK_IMPORTED_MODULE_20__.notify_new_thread_default,
        notify_old_thread: _message_edit__WEBPACK_IMPORTED_MODULE_20__.notify_old_thread_default,
        from_message_actions_popover: message !== undefined,
    };

    let modal_heading = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Move topic"});
    if (message !== undefined) {
        modal_heading = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Move messages"});
        // We disable topic input only for modal is opened from the message actions
        // popover and not when moving the whole topic from left sidebar. This is
        // because topic editing permission depend on message and we do not have
        // any message object when opening the modal and the first message of
        // topic is fetched from the server after clicking submit.
        // Though, this will be changed soon as we are going to make topic
        // edit permission independent of message.
        args.disable_topic_input = !_message_edit__WEBPACK_IMPORTED_MODULE_20__.is_topic_editable(message);
    }

    function get_params_from_form() {
        return Object.fromEntries(
            jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_form")
                .serializeArray()
                .map(({name, value}) => [name, value]),
        );
    }

    function update_submit_button_disabled_state(select_stream_id) {
        const {current_stream_id, new_topic_name, old_topic_name} = get_params_from_form();

        // Unlike most topic comparisons in Zulip, we intentionally do
        // a case-sensitive comparison, since adjusting the
        // capitalization of a topic is a valid operation.
        // new_topic_name can be undefined when the new topic input is
        // disabled in case when user does not have permission to edit
        // topic and thus submit button is disabled if stream is also
        // not changed.
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_modal .dialog_submit_button")[0].disabled =
            Number.parseInt(current_stream_id, 10) === Number.parseInt(select_stream_id, 10) &&
            (new_topic_name === undefined || new_topic_name.trim() === old_topic_name.trim());
    }

    function move_topic() {
        const params = get_params_from_form();

        const {old_topic_name} = params;
        let select_stream_id = stream_widget.value();

        let {
            current_stream_id,
            new_topic_name,
            send_notification_to_new_thread,
            send_notification_to_old_thread,
        } = params;
        send_notification_to_new_thread = send_notification_to_new_thread === "on";
        send_notification_to_old_thread = send_notification_to_old_thread === "on";
        current_stream_id = Number.parseInt(current_stream_id, 10);

        if (new_topic_name !== undefined) {
            // new_topic_name can be undefined when the new topic input is disabled when
            // user does not have permission to edit topic.
            new_topic_name = new_topic_name.trim();
        }
        if (old_topic_name.trim() === new_topic_name) {
            // We use `undefined` to tell the server that
            // there has been no change in the topic name.
            new_topic_name = undefined;
        }

        let propagate_mode = "change_all";
        if (message !== undefined) {
            if (select_stream_id === current_stream_id) {
                // We use `undefined` to tell the server that
                // there has been no change in stream. This is
                // important for cases when changing stream is
                // not allowed.
                select_stream_id = undefined;
            }
            // We already have the message_id here which means that modal is opened using
            // message popover.
            propagate_mode = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_modal select.message_edit_topic_propagate").val();
            _message_edit__WEBPACK_IMPORTED_MODULE_20__.move_topic_containing_message_to_stream(
                message.id,
                select_stream_id,
                new_topic_name,
                send_notification_to_new_thread,
                send_notification_to_old_thread,
                propagate_mode,
            );
            return;
        }

        _dialog_widget__WEBPACK_IMPORTED_MODULE_16__.show_dialog_spinner();
        _message_edit__WEBPACK_IMPORTED_MODULE_20__.with_first_message_id(
            current_stream_id,
            old_topic_name,
            (message_id) => {
                if (old_topic_name && select_stream_id) {
                    _message_edit__WEBPACK_IMPORTED_MODULE_20__.move_topic_containing_message_to_stream(
                        message_id,
                        select_stream_id,
                        new_topic_name,
                        send_notification_to_new_thread,
                        send_notification_to_old_thread,
                        propagate_mode,
                    );
                }
            },
            (xhr) => {
                _dialog_widget__WEBPACK_IMPORTED_MODULE_16__.hide_dialog_spinner();
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error moving topic"}),
                    xhr,
                    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_modal #dialog_error"),
                );
            },
        );
    }

    function set_stream_topic_typeahead() {
        const $topic_input = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_form .inline_topic_edit");
        const new_stream_id = Number(stream_widget.value(), 10);
        const new_stream_name = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new_stream_id).name;
        $topic_input.data("typeahead").unlisten();
        _composebox_typeahead__WEBPACK_IMPORTED_MODULE_14__.initialize_topic_edit_typeahead($topic_input, new_stream_name, false);
    }

    function move_topic_on_update() {
        update_submit_button_disabled_state();
        set_stream_topic_typeahead();
    }

    function move_topic_post_render() {
        const $topic_input = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_form .inline_topic_edit");
        $stream_header_colorblock = jquery__WEBPACK_IMPORTED_MODULE_1___default()("#dialog_widget_modal .topic_stream_edit_header").find(
            ".stream_header_colorblock",
        );
        _stream_bar__WEBPACK_IMPORTED_MODULE_26__.decorate(current_stream_name, $stream_header_colorblock, false);
        const streams_list =
            _message_edit__WEBPACK_IMPORTED_MODULE_20__.get_available_streams_for_moving_messages(current_stream_id);
        const opts = {
            widget_name: "select_stream",
            data: streams_list,
            default_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "No streams"}),
            include_current_item: false,
            value: current_stream_id,
            on_update: move_topic_on_update,
        };
        stream_widget = new _dropdown_list_widget__WEBPACK_IMPORTED_MODULE_18__.DropdownListWidget(opts);

        _composebox_typeahead__WEBPACK_IMPORTED_MODULE_14__.initialize_topic_edit_typeahead(
            $topic_input,
            current_stream_name,
            false,
        );

        stream_widget.setup();

        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#select_stream_widget .dropdown-toggle").prop(
            "disabled",
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        );
        update_submit_button_disabled_state(stream_widget.value());
        jquery__WEBPACK_IMPORTED_MODULE_1___default()("#move_topic_modal .inline_topic_edit").on("input", () => {
            update_submit_button_disabled_state(stream_widget.value());
        });
    }

    _dialog_widget__WEBPACK_IMPORTED_MODULE_16__.launch({
        html_heading: modal_heading,
        html_body: _templates_move_topic_to_stream_hbs__WEBPACK_IMPORTED_MODULE_6___default()(args),
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Confirm"}),
        id: "move_topic_modal",
        on_click: move_topic,
        loading_spinner: true,
        post_render: move_topic_post_render,
    });
}

function register_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_filters").on("click", ".stream-sidebar-menu-icon", (e) => {
        e.stopPropagation();

        const elt = e.target;
        const $stream_li = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).parents("li");
        const stream_id = elem_to_stream_id($stream_li);

        build_stream_popover({
            elt,
            stream_id,
        });
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#stream_filters").on("click", ".topic-sidebar-menu-icon", (e) => {
        e.stopPropagation();

        const elt = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".topic-sidebar-menu-icon").expectOne()[0];
        const $stream_li = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).closest(".narrow-filter").expectOne();
        const stream_id = elem_to_stream_id($stream_li);
        const topic_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).closest("li").expectOne().attr("data-topic-name");
        const url = jquery__WEBPACK_IMPORTED_MODULE_1___default()(elt).closest("li").find(".topic-name").expectOne().prop("href");

        build_topic_popover({
            elt,
            stream_id,
            topic_name,
        });

        build_topic_link_clipboard(url);
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#global_filters").on("click", ".all-messages-sidebar-menu-icon", build_all_messages_popover);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#global_filters").on(
        "click",
        ".starred-messages-sidebar-menu-icon",
        build_starred_messages_popover,
    );

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("#global_filters").on("click", ".drafts-sidebar-menu-icon", build_drafts_popover);

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click keypress", ".move-topic-dropdown .list_item", (e) => {
        // We want the dropdown to collapse once any of the list item is pressed
        // and thus don't want to kill the natural bubbling of event.
        e.preventDefault();

        if (e.type === "keypress" && !Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            return;
        }
        const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_28__.maybe_get_stream_name(
            Number.parseInt(stream_widget.value(), 10),
        );

        _stream_bar__WEBPACK_IMPORTED_MODULE_26__.decorate(stream_name, $stream_header_colorblock, false);
    });

    register_stream_handlers();
    register_topic_handlers();
}

function register_stream_handlers() {
    // Stream settings
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".open_stream_settings", (e) => {
        const sub = stream_popover_sub(e);
        hide_stream_popover();

        const stream_edit_hash = _hash_util__WEBPACK_IMPORTED_MODULE_19__.stream_edit_url(sub);
        _browser_history__WEBPACK_IMPORTED_MODULE_11__.go_to_location(stream_edit_hash);
    });

    // Pin/unpin
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".pin_to_top", (e) => {
        const sub = stream_popover_sub(e);
        hide_stream_popover();
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_29__.toggle_pin_to_top_stream(sub);
        e.stopPropagation();
    });

    // Mark all messages in stream as read
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".mark_stream_as_read", (e) => {
        const sub = stream_popover_sub(e);
        hide_stream_popover();
        _unread_ops__WEBPACK_IMPORTED_MODULE_30__.mark_stream_as_read(sub.stream_id);
        e.stopPropagation();
    });

    // Mark all messages as read
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", "#mark_all_messages_as_read", (e) => {
        hide_all_messages_popover();
        _unread_ops__WEBPACK_IMPORTED_MODULE_30__.mark_all_as_read();
        e.stopPropagation();
    });

    // Unstar all messages
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", "#unstar_all_messages", (e) => {
        hide_starred_messages_popover();
        e.preventDefault();
        e.stopPropagation();
        _starred_messages_ui__WEBPACK_IMPORTED_MODULE_25__.confirm_unstar_all_messages();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", "#delete_all_drafts_sidebar", (e) => {
        hide_drafts_popover();
        e.stopPropagation();
        _drafts__WEBPACK_IMPORTED_MODULE_17__.confirm_delete_all_drafts();
    });

    // Unstar all messages in topic
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-unstar-all-in-topic", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const topic_name = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".sidebar-popover-unstar-all-in-topic").attr("data-topic-name");
        const stream_id = jquery__WEBPACK_IMPORTED_MODULE_1___default()(".sidebar-popover-unstar-all-in-topic").attr("data-stream-id");
        hide_topic_popover();
        _starred_messages_ui__WEBPACK_IMPORTED_MODULE_25__.confirm_unstar_all_messages_in_topic(
            Number.parseInt(stream_id, 10),
            topic_name,
        );
    });

    // Toggle displaying starred message count
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", "#toggle_display_starred_msg_count", (e) => {
        hide_starred_messages_popover();
        e.preventDefault();
        e.stopPropagation();
        const starred_msg_counts = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        const data = {};
        data.starred_message_counts = JSON.stringify(!starred_msg_counts);
        _channel__WEBPACK_IMPORTED_MODULE_12__.patch({
            url: "/json/settings",
            data,
        });
    });
    // Mute/unmute
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".toggle_stream_muted", (e) => {
        const sub = stream_popover_sub(e);
        hide_stream_popover();
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_29__.set_muted(sub, !sub.is_muted);
        e.stopPropagation();
    });

    // New topic in stream menu
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".popover_new_topic_button", (e) => {
        const sub = stream_popover_sub(e);
        hide_stream_popover();

        _compose_actions__WEBPACK_IMPORTED_MODULE_13__.start("stream", {
            trigger: "popover new topic button",
            stream: sub.name,
            topic: "",
        });
        e.preventDefault();
        e.stopPropagation();
    });

    // Unsubscribe
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".popover_sub_unsub_button", function (e) {
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).toggleClass("unsub");
        jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest(".popover").fadeOut(500).delay(500).remove();

        const sub = stream_popover_sub(e);
        _stream_settings_ui__WEBPACK_IMPORTED_MODULE_29__.sub_or_unsub(sub);
        e.preventDefault();
        e.stopPropagation();
    });

    // Choose a different color.
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".choose_stream_color", (e) => {
        update_spectrum(jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).closest(".streams_popover"), ($colorpicker) => {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".colorpicker-container").show();
            $colorpicker.spectrum("destroy");
            $colorpicker.spectrum(_stream_color__WEBPACK_IMPORTED_MODULE_27__.sidebar_popover_colorpicker_options_full);
            // In theory this should clean up the old color picker,
            // but this seems a bit flaky -- the new colorpicker
            // doesn't fire until you click a button, but the buttons
            // have been hidden.  We work around this by just manually
            // fixing it up here.
            $colorpicker.parent().find(".sp-container").removeClass("sp-buttons-disabled");
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target).hide();
        });

        jquery__WEBPACK_IMPORTED_MODULE_1___default()(".streams_popover").on("click", "a.sp-cancel", () => {
            hide_stream_popover();
        });
        if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).width() <= 768) {
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".popover-inner").hide().fadeIn(300);
            jquery__WEBPACK_IMPORTED_MODULE_1___default()(".popover").addClass("colorpicker-popover");
        }
    });
}

function register_topic_handlers() {
    // Mute the topic
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-mute-topic", (e) => {
        const stream_id = topic_popover_stream_id(e);
        if (!stream_id) {
            return;
        }

        const topic = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-topic-name");
        _muted_topics_ui__WEBPACK_IMPORTED_MODULE_21__.mute_topic(stream_id, topic);
        e.stopPropagation();
        e.preventDefault();
    });

    // Unmute the topic
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-unmute-topic", (e) => {
        const stream_id = topic_popover_stream_id(e);
        if (!stream_id) {
            return;
        }

        const topic = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-topic-name");
        _muted_topics_ui__WEBPACK_IMPORTED_MODULE_21__.unmute_topic(stream_id, topic);
        e.stopPropagation();
        e.preventDefault();
    });

    // Mark all messages as read
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-mark-topic-read", (e) => {
        const stream_id = topic_popover_stream_id(e);
        if (!stream_id) {
            return;
        }

        const topic = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-topic-name");
        hide_topic_popover();
        _unread_ops__WEBPACK_IMPORTED_MODULE_30__.mark_topic_as_read(stream_id, topic);
        e.stopPropagation();
    });

    // Deleting all message in a topic
    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-delete-topic-messages", (e) => {
        const stream_id = topic_popover_stream_id(e);
        if (!stream_id) {
            return;
        }

        const topic = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget).attr("data-topic-name");
        const args = {
            topic_name: topic,
        };

        hide_topic_popover();

        const html_body = _templates_confirm_dialog_confirm_delete_topic_hbs__WEBPACK_IMPORTED_MODULE_4___default()(args);

        _confirm_dialog__WEBPACK_IMPORTED_MODULE_15__.launch({
            html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Delete topic"}),
            help_link: "/help/delete-a-topic",
            html_body,
            on_click() {
                _message_edit__WEBPACK_IMPORTED_MODULE_20__.delete_topic(stream_id, topic);
            },
        });

        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-toggle-resolved", (e) => {
        const $topic_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget);
        const stream_id = Number.parseInt($topic_row.attr("data-stream-id"), 10);
        const topic_name = $topic_row.attr("data-topic-name");
        _message_edit__WEBPACK_IMPORTED_MODULE_20__.with_first_message_id(stream_id, topic_name, (message_id) => {
            _message_edit__WEBPACK_IMPORTED_MODULE_20__.toggle_resolve_topic(message_id, topic_name);
        });

        hide_topic_popover();
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_1___default()("body").on("click", ".sidebar-popover-move-topic-messages", (e) => {
        const $topic_row = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.currentTarget);
        const stream_id = Number.parseInt($topic_row.attr("data-stream-id"), 10);
        const topic_name = $topic_row.attr("data-topic-name");
        hide_topic_popover();
        build_move_topic_to_stream_popover(stream_id, topic_name);
        e.stopPropagation();
        e.preventDefault();
    });
}


/***/ }),

/***/ "./static/js/stream_settings_containers.js":
/*!*************************************************!*\
  !*** ./static/js/stream_settings_containers.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_edit_container": () => (/* binding */ get_edit_container)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);


function get_edit_container(sub) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `#subscription_overlay .subscription_settings[data-stream-id='${CSS.escape(
            sub.stream_id,
        )}']`,
    );
}


/***/ }),

/***/ "./static/js/stream_settings_data.js":
/*!*******************************************!*\
  !*** ./static/js/stream_settings_data.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_settings_fields": () => (/* binding */ add_settings_fields),
/* harmony export */   "get_streams_for_settings_page": () => (/* binding */ get_streams_for_settings_page),
/* harmony export */   "get_sub_for_settings": () => (/* binding */ get_sub_for_settings),
/* harmony export */   "get_unmatched_streams_for_notification_settings": () => (/* binding */ get_unmatched_streams_for_notification_settings),
/* harmony export */   "get_updated_unsorted_subs": () => (/* binding */ get_updated_unsorted_subs),
/* harmony export */   "sort_for_stream_settings": () => (/* binding */ sort_for_stream_settings)
/* harmony export */ });
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _peer_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./peer_data */ "./static/js/peer_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());









function get_sub_for_settings(sub) {
    const settings_sub = {...sub};
    add_settings_fields(settings_sub);
    settings_sub.subscriber_count = _peer_data__WEBPACK_IMPORTED_MODULE_2__.get_subscriber_count(sub.stream_id);
    return settings_sub;
}

function get_subs_for_settings(subs) {
    // We may eventually add subscribers to the subs here, rather than
    // delegating, so that we can more efficiently compute subscriber counts
    // (in bulk).  If that plan appears to have been aborted, feel free to
    // inline this.
    return subs.map((sub) => get_sub_for_settings(sub));
}

function get_updated_unsorted_subs() {
    let all_subs = _stream_data__WEBPACK_IMPORTED_MODULE_3__.get_unsorted_subs();

    // We don't display unsubscribed streams to guest users.
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        all_subs = all_subs.filter((sub) => sub.subscribed);
    }

    return get_subs_for_settings(all_subs);
}

function add_settings_fields(sub) {
    // Note that we don't calculate subscriber counts here.

    sub.is_realm_admin = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    // Admin can change any stream's name & description either stream is public or
    // private, subscribed or unsubscribed.
    sub.can_change_name_description = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    sub.should_display_subscription_button = _stream_data__WEBPACK_IMPORTED_MODULE_3__.can_toggle_subscription(sub);
    sub.should_display_preview_button = _stream_data__WEBPACK_IMPORTED_MODULE_3__.can_preview(sub);
    sub.can_change_stream_permissions = _stream_data__WEBPACK_IMPORTED_MODULE_3__.can_change_permissions(sub);
    sub.can_access_subscribers = _stream_data__WEBPACK_IMPORTED_MODULE_3__.can_view_subscribers(sub);
    sub.can_add_subscribers = _stream_data__WEBPACK_IMPORTED_MODULE_3__.can_subscribe_others(sub);

    sub.preview_url = _hash_util__WEBPACK_IMPORTED_MODULE_0__.by_stream_url(sub.stream_id);
    sub.is_old_stream = sub.stream_weekly_traffic !== null;
}

function get_unmatched_streams_for_notification_settings() {
    const subscribed_rows = _stream_data__WEBPACK_IMPORTED_MODULE_3__.subscribed_subs();
    subscribed_rows.sort((a, b) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.name, b.name));

    const notification_settings = [];
    for (const row of subscribed_rows) {
        const settings_values = {};
        let make_table_row = false;
        for (const notification_name of Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            const default_setting =
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())[notification_name]
                ];
            const stream_setting = _stream_data__WEBPACK_IMPORTED_MODULE_3__.receives_notifications(
                row.stream_id,
                notification_name,
            );

            settings_values[notification_name] = stream_setting;
            if (stream_setting !== default_setting) {
                make_table_row = true;
            }
        }
        // We do not need to display the streams whose settings
        // match with the global settings defined by the user.
        if (make_table_row) {
            settings_values.stream_name = row.name;
            settings_values.stream_id = row.stream_id;
            settings_values.invite_only = row.invite_only;
            settings_values.is_web_public = row.is_web_public;

            notification_settings.push(settings_values);
        }
    }
    return notification_settings;
}

function get_streams_for_settings_page() {
    // TODO: This function is only used for copy-from-stream, so
    //       the current name is slightly misleading now, plus
    //       it's not entirely clear we need unsubscribed streams
    //       for that.  Also we may be revisiting that UI.

    // Build up our list of subscribed streams from the data we already have.
    const subscribed_rows = _stream_data__WEBPACK_IMPORTED_MODULE_3__.subscribed_subs();
    const unsubscribed_rows = _stream_data__WEBPACK_IMPORTED_MODULE_3__.unsubscribed_subs();

    // Sort and combine all our streams.
    function by_name(a, b) {
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.name, b.name);
    }
    subscribed_rows.sort(by_name);
    unsubscribed_rows.sort(by_name);
    const all_subs = unsubscribed_rows.concat(subscribed_rows);

    return get_subs_for_settings(all_subs);
}

function sort_for_stream_settings(stream_ids, order) {
    function name(stream_id) {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        if (!sub) {
            return "";
        }
        return sub.name;
    }

    function weekly_traffic(stream_id) {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        if (sub && sub.stream_weekly_traffic !== null) {
            return sub.stream_weekly_traffic;
        }
        // don't intersperse new streams with zero-traffic existing streams
        return -1;
    }

    function by_stream_name(id_a, id_b) {
        const stream_a_name = name(id_a);
        const stream_b_name = name(id_b);
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_a_name, stream_b_name);
    }

    function by_subscriber_count(id_a, id_b) {
        const out = _peer_data__WEBPACK_IMPORTED_MODULE_2__.get_subscriber_count(id_b) - _peer_data__WEBPACK_IMPORTED_MODULE_2__.get_subscriber_count(id_a);
        if (out === 0) {
            return by_stream_name(id_a, id_b);
        }
        return out;
    }

    function by_weekly_traffic(id_a, id_b) {
        const out = weekly_traffic(id_b) - weekly_traffic(id_a);
        if (out === 0) {
            return by_stream_name(id_a, id_b);
        }
        return out;
    }

    const orders = new Map([
        ["by-stream-name", by_stream_name],
        ["by-subscriber-count", by_subscriber_count],
        ["by-weekly-traffic", by_weekly_traffic],
    ]);

    if (order === undefined || !orders.has(order)) {
        order = "by-stream-name";
    }

    stream_ids.sort(orders.get(order));
}


/***/ }),

/***/ "./static/js/stream_settings_ui.js":
/*!*****************************************!*\
  !*** ./static/js/stream_settings_ui.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_sub_to_table": () => (/* binding */ add_sub_to_table),
/* harmony export */   "change_state": () => (/* binding */ change_state),
/* harmony export */   "do_open_create_stream": () => (/* binding */ do_open_create_stream),
/* harmony export */   "get_active_data": () => (/* binding */ get_active_data),
/* harmony export */   "get_left_panel_params": () => (/* binding */ get_left_panel_params),
/* harmony export */   "hide_or_disable_stream_privacy_options_if_required": () => (/* binding */ hide_or_disable_stream_privacy_options_if_required),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_sub_already_present": () => (/* binding */ is_sub_already_present),
/* harmony export */   "is_subscribed_stream_tab_active": () => (/* binding */ is_subscribed_stream_tab_active),
/* harmony export */   "keyboard_sub": () => (/* binding */ keyboard_sub),
/* harmony export */   "launch": () => (/* binding */ launch),
/* harmony export */   "maybe_reset_right_panel": () => (/* binding */ maybe_reset_right_panel),
/* harmony export */   "open_create_stream": () => (/* binding */ open_create_stream),
/* harmony export */   "redraw_left_panel": () => (/* binding */ redraw_left_panel),
/* harmony export */   "remove_stream": () => (/* binding */ remove_stream),
/* harmony export */   "render_left_panel_superset": () => (/* binding */ render_left_panel_superset),
/* harmony export */   "row_for_stream_id": () => (/* binding */ row_for_stream_id),
/* harmony export */   "set_color": () => (/* binding */ set_color),
/* harmony export */   "set_muted": () => (/* binding */ set_muted),
/* harmony export */   "set_right_panel_title": () => (/* binding */ set_right_panel_title),
/* harmony export */   "settings_button_for_sub": () => (/* binding */ settings_button_for_sub),
/* harmony export */   "setup_page": () => (/* binding */ setup_page),
/* harmony export */   "show_active_stream_in_left_panel": () => (/* binding */ show_active_stream_in_left_panel),
/* harmony export */   "show_subs_pane": () => (/* binding */ show_subs_pane),
/* harmony export */   "sub_or_unsub": () => (/* binding */ sub_or_unsub),
/* harmony export */   "switch_rows": () => (/* binding */ switch_rows),
/* harmony export */   "switch_stream_sort": () => (/* binding */ switch_stream_sort),
/* harmony export */   "switch_stream_tab": () => (/* binding */ switch_stream_tab),
/* harmony export */   "switch_to_stream_row": () => (/* binding */ switch_to_stream_row),
/* harmony export */   "toggle_pin_to_top_stream": () => (/* binding */ toggle_pin_to_top_stream),
/* harmony export */   "toggle_view": () => (/* binding */ toggle_view),
/* harmony export */   "toggler": () => (/* binding */ toggler),
/* harmony export */   "unsubscribe_from_private_stream": () => (/* binding */ unsubscribe_from_private_stream),
/* harmony export */   "update_left_panel_row": () => (/* binding */ update_left_panel_row),
/* harmony export */   "update_message_retention_setting": () => (/* binding */ update_message_retention_setting),
/* harmony export */   "update_private_stream_privacy_option_state": () => (/* binding */ update_private_stream_privacy_option_state),
/* harmony export */   "update_public_stream_privacy_option_state": () => (/* binding */ update_public_stream_privacy_option_state),
/* harmony export */   "update_settings_for_subscribed": () => (/* binding */ update_settings_for_subscribed),
/* harmony export */   "update_settings_for_unsubscribed": () => (/* binding */ update_settings_for_unsubscribed),
/* harmony export */   "update_stream_description": () => (/* binding */ update_stream_description),
/* harmony export */   "update_stream_name": () => (/* binding */ update_stream_name),
/* harmony export */   "update_stream_post_policy": () => (/* binding */ update_stream_post_policy),
/* harmony export */   "update_stream_privacy": () => (/* binding */ update_stream_privacy),
/* harmony export */   "update_stream_privacy_choices": () => (/* binding */ update_stream_privacy_choices),
/* harmony export */   "update_subscribers_ui": () => (/* binding */ update_subscribers_ui),
/* harmony export */   "update_web_public_stream_privacy_option_state": () => (/* binding */ update_web_public_stream_privacy_option_state),
/* harmony export */   "view_stream": () => (/* binding */ view_stream)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs */ "./static/templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs");
/* harmony import */ var _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_stream_settings_browse_streams_list_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/stream_settings/browse_streams_list.hbs */ "./static/templates/stream_settings/browse_streams_list.hbs");
/* harmony import */ var _templates_stream_settings_browse_streams_list_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_browse_streams_list_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_stream_settings_browse_streams_list_item_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/stream_settings/browse_streams_list_item.hbs */ "./static/templates/stream_settings/browse_streams_list_item.hbs");
/* harmony import */ var _templates_stream_settings_browse_streams_list_item_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_browse_streams_list_item_hbs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _templates_stream_settings_selected_stream_title_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../templates/stream_settings/selected_stream_title.hbs */ "./static/templates/stream_settings/selected_stream_title.hbs");
/* harmony import */ var _templates_stream_settings_selected_stream_title_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_selected_stream_title_hbs__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../templates/stream_settings/stream_settings.hbs */ "./static/templates/stream_settings/stream_settings.hbs");
/* harmony import */ var _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _templates_stream_settings_stream_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../templates/stream_settings/stream_settings_overlay.hbs */ "./static/templates/stream_settings/stream_settings_overlay.hbs");
/* harmony import */ var _templates_stream_settings_stream_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_7__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _confirm_dialog__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./confirm_dialog */ "./static/js/confirm_dialog.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_live_update__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message_live_update */ "./static/js/message_live_update.js");
/* harmony import */ var _message_view_header__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message_view_header */ "./static/js/message_view_header.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _scroll_util__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./scroll_util */ "./static/js/scroll_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './search_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_create__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./stream_create */ "./static/js/stream_create.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_edit__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./stream_edit */ "./static/js/stream_edit.js");
/* harmony import */ var _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./stream_edit_subscribers */ "./static/js/stream_edit_subscribers.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _stream_muting__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./stream_muting */ "./static/js/stream_muting.js");
/* harmony import */ var _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./stream_settings_data */ "./static/js/stream_settings_data.js");
/* harmony import */ var _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./stream_ui_updates */ "./static/js/stream_ui_updates.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());










































function set_right_panel_title(sub) {
    let title_icon_color = "#333333";
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
        title_icon_color = "#dddeee";
    }
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscription_overlay .stream-info-title").html(
        _templates_stream_settings_selected_stream_title_hbs__WEBPACK_IMPORTED_MODULE_5___default()({sub, title_icon_color}),
    );
}

const show_subs_pane = {
    nothing_selected() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings, #stream-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".nothing-selected").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscription_overlay .stream-info-title").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Stream settings"}));
    },
    settings(sub) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings, #stream-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings").show();
        set_right_panel_title(sub);
    },
    create_stream() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".nothing-selected, .settings, #stream-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscription_overlay .stream-info-title").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Create stream"}));
    },
};

function row_for_stream_id(stream_id) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.stream-row[data-stream-id='${CSS.escape(stream_id)}']`);
}

function is_sub_already_present(sub) {
    return row_for_stream_id(sub.stream_id).length > 0;
}

function update_left_panel_row(sub) {
    const $row = row_for_stream_id(sub.stream_id);

    if ($row.length === 0) {
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Updating row in left panel of stream settings for: ${sub.name}`);
    const setting_sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_sub_for_settings(sub);
    const html = _templates_stream_settings_browse_streams_list_item_hbs__WEBPACK_IMPORTED_MODULE_4___default()(setting_sub);
    const $new_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(html);

    // TODO: Clean up this hack when we eliminate `notdisplayed`
    if ($row.hasClass("notdisplayed")) {
        $new_row.addClass("notdisplayed");
    }

    // TODO: Remove this if/when we just handle "active" when rendering templates.
    if ($row.hasClass("active")) {
        $new_row.addClass("active");
    }

    $row.replaceWith($new_row);
}

function settings_button_for_sub(sub) {
    // We don't do expectOne() here, because this button is only
    // visible if the user has that stream selected in the streams UI.
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `.stream_settings_header[data-stream-id='${CSS.escape(sub.stream_id)}'] .subscribe-button`,
    );
}

function get_row_data($row) {
    const row_id = Number.parseInt($row.attr("data-stream-id"), 10);
    if (row_id) {
        const row_object = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(row_id);
        return {
            id: row_id,
            object: row_object,
        };
    }
    return undefined;
}

function get_active_data() {
    const $active_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()("div.stream-row.active");
    const valid_active_id = Number.parseInt($active_row.attr("data-stream-id"), 10);
    const $active_tabs = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".subscriptions-container").find("div.ind-tab.selected");
    return {
        $row: $active_row,
        id: valid_active_id,
        $tabs: $active_tabs,
    };
}

function selectText(element) {
    const sel = window.getSelection();
    const range = document.createRange();
    range.selectNodeContents(element);

    sel.removeAllRanges();
    sel.addRange(range);
}

function should_list_all_streams() {
    return !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
}

function set_muted(sub, is_muted, status_element) {
    _stream_muting__WEBPACK_IMPORTED_MODULE_24__.update_is_muted(sub, is_muted);
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.set_stream_property(sub, "is_muted", sub.is_muted, status_element);
}

function toggle_pin_to_top_stream(sub) {
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.set_stream_property(sub, "pin_to_top", !sub.pin_to_top);
}

let subscribed_only = true;

function is_subscribed_stream_tab_active() {
    // Returns true if "Subscribed" tab in stream settings is open
    // otherwise false.
    return subscribed_only;
}

function update_stream_name(sub, new_name) {
    const old_name = sub.name;

    // Rename the stream internally.
    _stream_data__WEBPACK_IMPORTED_MODULE_20__.rename_sub(sub, new_name);
    const stream_id = sub.stream_id;

    // Update the left sidebar.
    _stream_list__WEBPACK_IMPORTED_MODULE_23__.rename_stream(sub, new_name);

    // Update the stream settings
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.update_stream_name(sub, new_name);

    // Update the subscriptions page
    const $sub_row = row_for_stream_id(stream_id);
    $sub_row.find(".stream-name").text(new_name);

    // Update the message feed.
    _message_live_update__WEBPACK_IMPORTED_MODULE_14__.update_stream_name(stream_id, new_name);

    // Update compose_state if needed
    if (_compose_state__WEBPACK_IMPORTED_MODULE_11__.stream_name() === old_name) {
        _compose_state__WEBPACK_IMPORTED_MODULE_11__.set_stream_name(new_name);
    }

    // Update navbar if needed
    _message_view_header__WEBPACK_IMPORTED_MODULE_15__.maybe_rerender_title_area_for_stream(sub);
}

function update_stream_description(sub, description, rendered_description) {
    sub.description = description;
    sub.rendered_description = rendered_description;
    _stream_data__WEBPACK_IMPORTED_MODULE_20__.clean_up_description(sub);

    // Update stream row
    const $sub_row = row_for_stream_id(sub.stream_id);
    $sub_row.find(".description").html(Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(sub.rendered_description));

    // Update stream settings
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.update_stream_description(sub);

    // Update navbar if needed
    _message_view_header__WEBPACK_IMPORTED_MODULE_15__.maybe_rerender_title_area_for_stream(sub);
}

function update_stream_privacy(slim_sub, values) {
    _stream_data__WEBPACK_IMPORTED_MODULE_20__.update_stream_privacy(slim_sub, values);
    const sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_sub_for_settings(slim_sub);

    // Update UI elements
    update_left_panel_row(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_setting_element(sub, "stream_privacy");
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.enable_or_disable_permission_settings_in_edit_panel(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_stream_privacy_icon_in_settings(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_settings_button_for_sub(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_add_subscriptions_elements(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.enable_or_disable_subscribers_tab(sub);
    _stream_list__WEBPACK_IMPORTED_MODULE_23__.redraw_stream_privacy(sub);

    const active_data = get_active_data();
    if (active_data.id === sub.stream_id) {
        set_right_panel_title(sub);
    }

    // Update navbar if needed
    _message_view_header__WEBPACK_IMPORTED_MODULE_15__.maybe_rerender_title_area_for_stream(sub);
}

function update_stream_post_policy(sub, new_value) {
    _stream_data__WEBPACK_IMPORTED_MODULE_20__.update_stream_post_policy(sub, new_value);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_setting_element(sub, "stream_post_policy");
}

function update_message_retention_setting(sub, new_value) {
    _stream_data__WEBPACK_IMPORTED_MODULE_20__.update_message_retention_setting(sub, new_value);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_setting_element(sub, "message_retention_days");
}

function set_color(stream_id, color) {
    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.set_stream_property(sub, "color", color);
}

function update_subscribers_ui(sub) {
    update_left_panel_row(sub);
    _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_22__.update_subscribers_list(sub);
    _message_view_header__WEBPACK_IMPORTED_MODULE_15__.maybe_rerender_title_area_for_stream(sub);
}

function add_sub_to_table(sub) {
    if (is_sub_already_present(sub)) {
        // If a stream is already listed/added in subscription modal,
        // display stream in `Subscribed` tab and return.
        // This can happen in some corner cases (which might
        // be backend bugs) where a realm administrator is subscribed
        // to a private stream, in which case they might get two
        // stream-create events.
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_stream_row_in_settings_tab(sub);
        return;
    }

    const setting_sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_sub_for_settings(sub);
    const html = _templates_stream_settings_browse_streams_list_item_hbs__WEBPACK_IMPORTED_MODULE_4___default()(setting_sub);
    const $new_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(html);

    if (_stream_create__WEBPACK_IMPORTED_MODULE_19__.get_name() === sub.name) {
        _ui__WEBPACK_IMPORTED_MODULE_27__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams-list")).prepend($new_row);
        _ui__WEBPACK_IMPORTED_MODULE_27__.reset_scrollbar(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams-list"));
    } else {
        _ui__WEBPACK_IMPORTED_MODULE_27__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams-list")).append($new_row);
    }

    const settings_html = _templates_stream_settings_stream_settings_hbs__WEBPACK_IMPORTED_MODULE_6___default()(sub);
    _ui__WEBPACK_IMPORTED_MODULE_27__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .settings")).append(jquery__WEBPACK_IMPORTED_MODULE_0___default()(settings_html));

    if (_stream_create__WEBPACK_IMPORTED_MODULE_19__.get_name() === sub.name) {
        // This `stream_create.get_name()` check tells us whether the
        // stream was just created in this browser window; it's a hack
        // to work around the server_events code flow not having a
        // good way to associate with this request because the stream
        // ID isn't known yet.  These are appended to the top of the
        // list, so they are more visible.
        row_for_stream_id(sub.stream_id).trigger("click");
        _stream_create__WEBPACK_IMPORTED_MODULE_19__.reset_created_stream();
    }
}

function remove_stream(stream_id) {
    // It is possible that row is empty when we deactivate a
    // stream, but we let jQuery silently handle that.
    const $row = row_for_stream_id(stream_id);
    $row.remove();
    if (_hash_util__WEBPACK_IMPORTED_MODULE_13__.is_editing_stream(stream_id)) {
        _stream_edit__WEBPACK_IMPORTED_MODULE_21__.open_edit_panel_empty();
    }
}

function update_settings_for_subscribed(slim_sub) {
    const sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_sub_for_settings(slim_sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_add_subscriptions_elements(sub);
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(
        `.stream_settings_header[data-stream-id='${CSS.escape(
            sub.stream_id,
        )}'] #preview-stream-button`,
    ).show();

    if (is_sub_already_present(sub)) {
        update_left_panel_row(sub);
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_toggler_for_sub(sub);
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_stream_row_in_settings_tab(sub);
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_settings_button_for_sub(sub);
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.enable_or_disable_permission_settings_in_edit_panel(sub);
    } else {
        add_sub_to_table(sub);
    }

    _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_22__.update_subscribers_list(sub);

    // Display the swatch and subscription stream_settings
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_regular_sub_settings(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_permissions_banner(sub);
}

function show_active_stream_in_left_panel() {
    const selected_row = _hash_util__WEBPACK_IMPORTED_MODULE_13__.get_current_hash_section();

    if (Number.parseFloat(selected_row)) {
        const $sub_row = row_for_stream_id(selected_row);
        $sub_row.addClass("active");
    }
}

function update_settings_for_unsubscribed(slim_sub) {
    const sub = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_sub_for_settings(slim_sub);
    update_left_panel_row(sub);
    _stream_edit_subscribers__WEBPACK_IMPORTED_MODULE_22__.update_subscribers_list(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_toggler_for_sub(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_settings_button_for_sub(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_regular_sub_settings(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.enable_or_disable_permission_settings_in_edit_panel(sub);

    // If user unsubscribed from private stream then user cannot subscribe to
    // stream without invitation and cannot add subscribers to stream.
    if (!_stream_data__WEBPACK_IMPORTED_MODULE_20__.can_toggle_subscription(sub)) {
        _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_add_subscriptions_elements(sub);
    }
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        _stream_edit__WEBPACK_IMPORTED_MODULE_21__.open_edit_panel_empty();
    }

    // Remove private streams from subscribed streams list.
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_stream_row_in_settings_tab(sub);
    _stream_ui_updates__WEBPACK_IMPORTED_MODULE_26__.update_permissions_banner(sub);
}

function triage_stream(left_panel_params, sub) {
    if (left_panel_params.subscribed_only && !sub.subscribed) {
        // reject non-subscribed streams
        return "rejected";
    }

    const search_terms = Object(function webpackMissingModule() { var e = new Error("Cannot find module './search_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(left_panel_params.input);

    function match(attr) {
        const val = sub[attr];

        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './search_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            val,
            search_terms,
        });
    }

    if (match("name")) {
        return "name_match";
    }

    if (match("description")) {
        return "desc_match";
    }

    return "rejected";
}

function get_stream_id_buckets(stream_ids, left_panel_params) {
    // When we simplify the settings UI, we can get
    // rid of the "others" bucket.

    const buckets = {
        name: [],
        desc: [],
        other: [],
    };

    for (const stream_id of stream_ids) {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const match_status = triage_stream(left_panel_params, sub);

        if (match_status === "name_match") {
            buckets.name.push(stream_id);
        } else if (match_status === "desc_match") {
            buckets.desc.push(stream_id);
        } else {
            buckets.other.push(stream_id);
        }
    }

    _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.sort_for_stream_settings(buckets.name, left_panel_params.sort_order);
    _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.sort_for_stream_settings(buckets.desc, left_panel_params.sort_order);

    return buckets;
}

function render_left_panel_superset() {
    // For annoying legacy reasons we render all the subs we are
    // allowed to know about and put them in the DOM, then we do
    // a second pass where we filter/sort them.
    const html = Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("render left panel", () => {
        const sub_rows = _stream_settings_data__WEBPACK_IMPORTED_MODULE_25__.get_updated_unsorted_subs();

        const template_data = {
            subscriptions: sub_rows,
        };

        return _templates_stream_settings_browse_streams_list_hbs__WEBPACK_IMPORTED_MODULE_3___default()(template_data);
    });

    _ui__WEBPACK_IMPORTED_MODULE_27__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .streams-list")).html(html);
}

// LeftPanelParams { input: String, subscribed_only: Boolean, sort_order: String }
function redraw_left_panel(left_panel_params = get_left_panel_params()) {
    // We only get left_panel_params passed in from tests.  Real
    // code calls get_left_panel_params().
    show_active_stream_in_left_panel();

    function stream_id_for_row(row) {
        return Number.parseInt(jquery__WEBPACK_IMPORTED_MODULE_0___default()(row).attr("data-stream-id"), 10);
    }

    const widgets = new Map();

    const stream_ids = [];

    for (const row of jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .stream-row")) {
        const stream_id = stream_id_for_row(row);
        stream_ids.push(stream_id);
    }

    const buckets = get_stream_id_buckets(stream_ids, left_panel_params);

    // If we just re-built the DOM from scratch we wouldn't need
    // all this hidden/notdisplayed logic.
    const hidden_ids = new Set();

    for (const stream_id of buckets.other) {
        hidden_ids.add(stream_id);
    }

    for (const row of jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .stream-row")) {
        const stream_id = stream_id_for_row(row);

        // Below code goes away if we don't do sort-DOM-in-place.
        if (hidden_ids.has(stream_id)) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(row).addClass("notdisplayed");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(row).removeClass("notdisplayed");
        }

        widgets.set(stream_id, jquery__WEBPACK_IMPORTED_MODULE_0___default()(row).detach());
    }

    _ui__WEBPACK_IMPORTED_MODULE_27__.reset_scrollbar(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscription_overlay .streams-list"));

    const all_stream_ids = [...buckets.name, ...buckets.desc, ...buckets.other];

    for (const stream_id of all_stream_ids) {
        _ui__WEBPACK_IMPORTED_MODULE_27__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .streams-list")).append(
            widgets.get(stream_id),
        );
    }
    maybe_reset_right_panel();

    // return this for test convenience
    return [...buckets.name, ...buckets.desc];
}

let sort_order = "by-stream-name";

function get_left_panel_params() {
    const $search_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filter input[type='text']");
    const input = $search_box.expectOne().val().trim();
    const params = {
        input,
        subscribed_only,
        sort_order,
    };
    return params;
}

function maybe_reset_right_panel() {
    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-row.active").hasClass("notdisplayed")) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right .settings").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".nothing-selected").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream-row.active").removeClass("active");
    }
}

// Make it explicit that our toggler is not created right away.
let toggler;

function switch_stream_tab(tab_name) {
    /*
        This switches the stream tab, but it doesn't update
        the toggler widget.  You may instead want to
        use `toggler.goto`.
    */

    if (tab_name === "all-streams") {
        subscribed_only = false;
    } else if (tab_name === "subscribed") {
        subscribed_only = true;
    }

    redraw_left_panel();
    _stream_edit__WEBPACK_IMPORTED_MODULE_21__.setup_subscriptions_tab_hash(tab_name);
}

function switch_stream_sort(tab_name) {
    if (
        tab_name === "by-stream-name" ||
        tab_name === "by-subscriber-count" ||
        tab_name === "by-weekly-traffic"
    ) {
        sort_order = tab_name;
    } else {
        sort_order = "by-stream-name";
    }
    redraw_left_panel();
}

function setup_page(callback) {
    // We should strongly consider only setting up the page once,
    // but I am writing these comments write before a big release,
    // so it's too risky a change for now.
    //
    // The history behind setting up the page from scratch every
    // time we go into "Manage streams" is that we used to have
    // some live-update issues, so being able to re-launch the
    // streams page is kind of a workaround for those bugs, since
    // we will re-populate the widget.
    //
    // For now, every time we go back into the widget we'll
    // continue the strategy that we re-render everything from scratch.
    // Also, we'll always go back to the "Subscribed" tab.
    function initialize_components() {
        // Sort by name by default when opening "Manage streams".
        sort_order = "by-stream-name";
        const sort_toggler = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            values: [
                {
                    label_html: `<i class="fa fa-sort-alpha-asc" data-tippy-content="${Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Sort by name",
                    })}"></i>`,
                    key: "by-stream-name",
                },
                {
                    label_html: `<i class="fa fa-user-o" data-tippy-content="${Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Sort by number of subscribers",
                    })}"></i>`,
                    key: "by-subscriber-count",
                },
                {
                    label_html: `<i class="fa fa-bar-chart" data-tippy-content="${Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                        defaultMessage: "Sort by estimated weekly traffic",
                    })}"></i>`,
                    key: "by-weekly-traffic",
                },
            ],
            html_class: "stream_sorter_toggle",
            callback(value, key) {
                switch_stream_sort(key);
            },
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .search-container").prepend(sort_toggler.get());

        // Reset our internal state to reflect that we're initially in
        // the "Subscribed" tab if we're reopening "Manage streams".
        subscribed_only = true;
        toggler = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            child_wants_focus: true,
            values: [
                {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribed"}), key: "subscribed"},
                {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "All streams"}), key: "all-streams"},
            ],
            callback(value, key) {
                switch_stream_tab(key);
            },
        });

        if (should_list_all_streams()) {
            const toggler_elem = toggler.get();
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .search-container").prepend(toggler_elem);
        }
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            toggler.disable_tab("all-streams");
        }

        // show the "Stream settings" header by default.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".display-type #stream_settings_title").show();
    }

    function populate_and_fill() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").empty();

        // TODO: Ideally we'd indicate in some way what stream types
        // the user can create, by showing other options as disabled.
        const stream_privacy_policy = _stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values["public"].code;
        const template_data = {
            ask_to_announce_stream: true,
            can_create_streams:
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
            hide_all_streams: !should_list_all_streams(),
            max_stream_name_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            max_stream_description_length: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            is_owner: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            stream_privacy_policy_values: _stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values,
            stream_privacy_policy,
            stream_post_policy_values: _stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_post_policy_values,
            zulip_plan_is_not_limited: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            org_level_message_retention_setting:
                _stream_edit__WEBPACK_IMPORTED_MODULE_21__.get_display_text_for_realm_message_retention_setting(),
            upgrade_text_for_wide_organization_logo:
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            is_business_type_org:
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
            disable_message_retention_setting:
                !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        };

        const rendered = _templates_stream_settings_stream_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_7___default()(template_data);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").append(rendered);

        render_left_panel_superset();
        initialize_components();
        redraw_left_panel();
        _stream_create__WEBPACK_IMPORTED_MODULE_19__.set_up_handlers();

        const throttled_redraw_left_panel = lodash__WEBPACK_IMPORTED_MODULE_1___default().throttle(redraw_left_panel, 50);
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filter input[type='text']").on("input", () => {
            // Debounce filtering in case a user is typing quickly
            throttled_redraw_left_panel();
        });

        // When hitting Enter in the stream creation box, we open the
        // "create stream" UI with the stream name prepopulated.  This
        // is only useful if the user has permission to create
        // streams, either explicitly via user_can_create_streams, or
        // implicitly because page_params.realm_is_zephyr_mirror_realm.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filter input[type='text']").on("keypress", (e) => {
            if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
                return;
            }

            if (
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())() ||
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
            ) {
                open_create_stream();
                e.preventDefault();
                e.stopPropagation();
                return;
            }
        });

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_stream_name").on("click", () => {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filter input[type='text']").val("");
            redraw_left_panel();
        });

        if (callback) {
            callback();
        }
    }

    populate_and_fill();

    if (!should_list_all_streams()) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".create_stream_button").val(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribe"}));
    }
}

function switch_to_stream_row(stream_id) {
    const $stream_row = row_for_stream_id(stream_id);
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".streams-list");

    get_active_data().$row.removeClass("active");
    $stream_row.addClass("active");

    _scroll_util__WEBPACK_IMPORTED_MODULE_18__.scroll_element_into_container($stream_row, $container);

    // It's dubious that we need this timeout any more.
    setTimeout(() => {
        if (stream_id === get_active_data().id) {
            $stream_row.trigger("click");
        }
    }, 100);
}

function show_right_section() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right").addClass("show");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".subscriptions-header").addClass("slide-left");
}

function change_state(section) {
    // if in #streams/new form.
    if (section === "new") {
        if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            do_open_create_stream();
            show_right_section();
        } else {
            toggler.goto("subscribed");
        }
        return;
    }

    if (section === "all") {
        toggler.goto("all-streams");
        return;
    }

    if (section === "subscribed") {
        toggler.goto("subscribed");
        return;
    }

    // if the section is a valid number.
    if (/\d+/.test(section)) {
        const stream_id = Number.parseInt(section, 10);
        // Guest users can not access unsubscribed streams
        // So redirect guest users to 'subscribed' tab
        // for any unsubscribed stream settings hash
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) && !_stream_data__WEBPACK_IMPORTED_MODULE_20__.is_subscribed(stream_id)) {
            toggler.goto("subscribed");
        } else {
            show_right_section();
            switch_to_stream_row(stream_id);
        }
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("invalid section for streams: " + section);
    toggler.goto("subscribed");
}

function launch(section) {
    setup_page(() => {
        _overlays__WEBPACK_IMPORTED_MODULE_16__.open_overlay({
            name: "subscriptions",
            $overlay: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#subscription_overlay"),
            on_close() {
                _browser_history__WEBPACK_IMPORTED_MODULE_9__.exit_overlay();
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".colorpicker").spectrum("destroy");
            },
        });
        change_state(section);
    });
    if (!get_active_data().id) {
        if (section === "new") {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").trigger("focus");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").trigger("focus");
        }
    }
}

function switch_rows(event) {
    const active_data = get_active_data();
    let $switch_row;
    if (_hash_util__WEBPACK_IMPORTED_MODULE_13__.is_create_new_stream_narrow()) {
        // Prevent switching stream rows when creating a new stream
        return false;
    } else if (!active_data.id || active_data.$row.hasClass("notdisplayed")) {
        $switch_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()("div.stream-row:not(.notdisplayed)").first();
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").is(":focus")) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").trigger("blur");
        }
    } else {
        if (event === "up_arrow") {
            $switch_row = active_data.$row.prevAll().not(".notdisplayed").first();
        } else if (event === "down_arrow") {
            $switch_row = active_data.$row.nextAll().not(".notdisplayed").first();
        }
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").is(":focus")) {
            // remove focus from Filter streams input instead of switching rows
            // if Filter streams input is focused
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").trigger("blur");
        }
    }

    const row_data = get_row_data($switch_row);
    if (row_data) {
        const stream_id = row_data.id;
        switch_to_stream_row(stream_id);
    } else if (event === "up_arrow" && !row_data) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").trigger("focus");
    }
    return true;
}

function keyboard_sub() {
    const active_data = get_active_data();
    const row_data = get_row_data(active_data.$row);
    if (row_data) {
        sub_or_unsub(row_data.object);
    }
}

function toggle_view(event) {
    const active_data = get_active_data();
    const stream_filter_tab = active_data.$tabs.first().text();

    if (event === "right_arrow" && stream_filter_tab === "Subscribed") {
        toggler.goto("all-streams");
    } else if (event === "left_arrow" && stream_filter_tab === "All streams") {
        toggler.goto("subscribed");
    }
}

function view_stream() {
    const active_data = get_active_data();
    const row_data = get_row_data(active_data.$row);
    if (row_data) {
        const stream_narrow_hash =
            "#narrow/stream/" + _hash_util__WEBPACK_IMPORTED_MODULE_13__.encode_stream_name(row_data.object.name);
        _browser_history__WEBPACK_IMPORTED_MODULE_9__.go_to_location(stream_narrow_hash);
    }
}

/* For the given stream_row, remove the tick and replace by a spinner. */
function display_subscribe_toggle_spinner(stream_row) {
    /* Prevent sending multiple requests by removing the button class. */
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find(".check").removeClass("sub_unsub_button");

    /* Hide the tick. */
    const $tick = jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find("svg");
    $tick.addClass("hide");

    /* Add a spinner to show the request is in process. */
    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find(".sub_unsub_status").expectOne();
    $spinner.show();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
}

/* For the given stream_row, add the tick and delete the spinner. */
function hide_subscribe_toggle_spinner(stream_row) {
    /* Re-enable the button to handle requests. */
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find(".check").addClass("sub_unsub_button");

    /* Show the tick. */
    const $tick = jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find("svg");
    $tick.removeClass("hide");

    /* Destroy the spinner. */
    const $spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()(stream_row).find(".sub_unsub_status").expectOne();
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($spinner);
}

function ajaxSubscribe(stream, color, $stream_row) {
    // Subscribe yourself to a single stream.
    let true_stream_name;

    if ($stream_row !== undefined) {
        display_subscribe_toggle_spinner($stream_row);
    }
    return _channel__WEBPACK_IMPORTED_MODULE_10__.post({
        url: "/json/users/me/subscriptions",
        data: {subscriptions: JSON.stringify([{name: stream, color}])},
        success(resp, statusText, xhr) {
            if (_overlays__WEBPACK_IMPORTED_MODULE_16__.streams_open()) {
                jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_stream_name").val("");
            }

            const res = JSON.parse(xhr.responseText);
            if (!jquery__WEBPACK_IMPORTED_MODULE_0___default().isEmptyObject(res.already_subscribed)) {
                // Display the canonical stream capitalization.
                true_stream_name = res.already_subscribed[_people__WEBPACK_IMPORTED_MODULE_17__.my_current_email()][0];
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {defaultMessage: "Already subscribed to {stream}"},
                        {stream: true_stream_name},
                    ),
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_change_property_info"),
                );
            }
            // The rest of the work is done via the subscribe event we will get

            if ($stream_row !== undefined) {
                hide_subscribe_toggle_spinner($stream_row);
            }
        },
        error(xhr) {
            if ($stream_row !== undefined) {
                hide_subscribe_toggle_spinner($stream_row);
            }
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error adding subscription"}),
                xhr,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_change_property_info"),
            );
        },
    });
}

function ajaxUnsubscribe(sub, $stream_row) {
    // TODO: use stream_id when backend supports it
    if ($stream_row !== undefined) {
        display_subscribe_toggle_spinner($stream_row);
    }
    return _channel__WEBPACK_IMPORTED_MODULE_10__.del({
        url: "/json/users/me/subscriptions",
        data: {subscriptions: JSON.stringify([sub.name])},
        success() {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_change_property_info").hide();
            // The rest of the work is done via the unsubscribe event we will get

            if ($stream_row !== undefined) {
                hide_subscribe_toggle_spinner($stream_row);
            }
        },
        error(xhr) {
            if ($stream_row !== undefined) {
                hide_subscribe_toggle_spinner($stream_row);
            }
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error removing subscription"}),
                xhr,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".stream_change_property_info"),
            );
        },
    });
}

function do_open_create_stream() {
    // Only call this directly for hash changes.
    // Prefer open_create_stream().

    const stream = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").val().trim();

    if (!should_list_all_streams()) {
        // Realms that don't allow listing streams should simply be subscribed to.
        _stream_create__WEBPACK_IMPORTED_MODULE_19__.set_name(stream);
        ajaxSubscribe(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_stream_name").val());
        return;
    }

    _stream_create__WEBPACK_IMPORTED_MODULE_19__.new_stream_clicked(stream);
}

function open_create_stream() {
    do_open_create_stream();
    _browser_history__WEBPACK_IMPORTED_MODULE_9__.update("#streams/new");
}

function unsubscribe_from_private_stream(sub) {
    const html_body = _templates_confirm_dialog_confirm_unsubscribe_private_stream_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
        message: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
            defaultMessage: "Once you leave this stream, you will not be able to rejoin.",
        }),
    });

    function unsubscribe_from_stream() {
        let $stream_row;
        if (_overlays__WEBPACK_IMPORTED_MODULE_16__.streams_open()) {
            $stream_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(
                "#manage_streams_container div.stream-row[data-stream-id='" + sub.stream_id + "']",
            );
        }

        ajaxUnsubscribe(sub, $stream_row);
    }

    _confirm_dialog__WEBPACK_IMPORTED_MODULE_12__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            {defaultMessage: "Unsubscribe from {stream_name}"},
            {stream_name: sub.name},
        ),
        html_body,
        on_click: unsubscribe_from_stream,
    });
}

function sub_or_unsub(sub, $stream_row) {
    if (sub.subscribed) {
        // TODO: This next line should allow guests to access web-public streams.
        if (sub.invite_only || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            unsubscribe_from_private_stream(sub);
            return;
        }
        ajaxUnsubscribe(sub, $stream_row);
    } else {
        ajaxSubscribe(sub.name, sub.color, $stream_row);
    }
}

function update_web_public_stream_privacy_option_state($container) {
    const $web_public_stream_elem = $container.find(
        `input[value='${CSS.escape(_stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values.web_public.code)}']`,
    );

    const for_stream_edit_panel = $container.attr("id") === "stream_permission_settings";
    if (for_stream_edit_panel) {
        const stream_id = Number.parseInt(
            $container.closest(".subscription_settings.show").attr("data-stream-id"),
            10,
        );
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        if (!_stream_data__WEBPACK_IMPORTED_MODULE_20__.can_change_permissions(sub)) {
            // We do not want to enable the already disabled web-public option
            // in stream-edit panel if user is not allowed to change stream
            // privacy at all.
            return;
        }
    }

    if (
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ||
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())
    ) {
        if (for_stream_edit_panel && $web_public_stream_elem.is(":checked")) {
            // We do not hide web-public option in the "Change privacy" modal if
            // stream is web-public already. The option is disabled in this case.
            $web_public_stream_elem.prop("disabled", true);
            return;
        }
        $web_public_stream_elem.closest(".settings-radio-input-parent").hide();
        $container
            .find(".stream-privacy-values .settings-radio-input-parent:visible")
            .last()
            .css("border-bottom", "none");
    } else {
        if (!$web_public_stream_elem.is(":visible")) {
            $container
                .find(".stream-privacy-values .settings-radio-input-parent:visible")
                .last()
                .css("border-bottom", "");
            $web_public_stream_elem.closest(".settings-radio-input-parent").show();
        }
        $web_public_stream_elem.prop(
            "disabled",
            !Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        );
    }
}

function update_public_stream_privacy_option_state($container) {
    const $public_stream_elem = $container.find(
        `input[value='${CSS.escape(_stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values["public"].code)}']`,
    );
    $public_stream_elem.prop("disabled", !Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())());
}

function update_private_stream_privacy_option_state($container) {
    // Disable both "Private, shared history" and "Private, protected history" options.
    const $private_stream_elem = $container.find(
        `input[value='${CSS.escape(_stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values["private"].code)}']`,
    );
    const $private_with_public_history_elem = $container.find(
        `input[value='${CSS.escape(
            _stream_data__WEBPACK_IMPORTED_MODULE_20__.stream_privacy_policy_values.private_with_public_history.code,
        )}']`,
    );

    $private_stream_elem.prop("disabled", !Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())());
    $private_with_public_history_elem.prop(
        "disabled",
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
    );
}

function hide_or_disable_stream_privacy_options_if_required($container) {
    update_web_public_stream_privacy_option_state($container);

    update_public_stream_privacy_option_state($container);

    update_private_stream_privacy_option_state($container);
}

function update_stream_privacy_choices(policy) {
    if (!_overlays__WEBPACK_IMPORTED_MODULE_16__.streams_open()) {
        return;
    }
    const stream_edit_panel_opened = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_permission_settings").is(":visible");
    const stream_creation_form_opened = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation").is(":visible");

    if (!stream_edit_panel_opened && !stream_creation_form_opened) {
        return;
    }
    let $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream-creation");
    if (stream_edit_panel_opened) {
        $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_permission_settings");
    }

    if (policy === "create_private_stream_policy") {
        update_private_stream_privacy_option_state($container);
    }
    if (policy === "create_public_stream_policy") {
        update_public_stream_privacy_option_state($container);
    }
    if (policy === "create_web_public_stream_policy") {
        update_web_public_stream_privacy_option_state($container);
    }
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on("click", ".create_stream_button", (e) => {
        e.preventDefault();
        open_create_stream();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on("click", "#stream_creation_form [data-dismiss]", (e) => {
        e.preventDefault();
        // we want to make sure that the click is not just a simulated
        // click; this fixes an issue where hitting "Enter" would
        // trigger this code path due to bootstrap magic.
        if (e.clientY !== 0) {
            show_subs_pane.nothing_selected();
        }
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on("click", ".email-address", function () {
        selectText(this);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on(
        "click",
        ".stream-row, .create_stream_button",
        show_right_section,
    );

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container").on("click", ".fa-chevron-left", () => {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right").removeClass("show");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".subscriptions-header").removeClass("slide-left");
    });
}


/***/ }),

/***/ "./static/js/stream_sort.js":
/*!**********************************!*\
  !*** ./static/js/stream_sort.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "first_stream_id": () => (/* binding */ first_stream_id),
/* harmony export */   "get_streams": () => (/* binding */ get_streams),
/* harmony export */   "next_stream_id": () => (/* binding */ next_stream_id),
/* harmony export */   "prev_stream_id": () => (/* binding */ prev_stream_id),
/* harmony export */   "sort_groups": () => (/* binding */ sort_groups)
/* harmony export */ });
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




let previous_pinned;
let previous_normal;
let previous_dormant;
let previous_muted_active;
let previous_muted_pinned;
let all_streams = [];

function get_streams() {
    const sorted_streams = all_streams.map((stream_id) =>
        _stream_data__WEBPACK_IMPORTED_MODULE_0__.maybe_get_stream_name(stream_id),
    );
    return sorted_streams;
}

function compare_function(a, b) {
    const stream_a = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a);
    const stream_b = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(b);

    const stream_name_a = stream_a ? stream_a.name : "";
    const stream_name_b = stream_b ? stream_b.name : "";

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_name_a, stream_name_b);
}

function sort_groups(streams, search_term) {
    const stream_id_to_name = (stream) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream).name;
    // Use -, _ and / as word separators apart from the default space character
    const word_separator_regex = /[\s/_-]/;
    streams = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
        streams,
        search_term,
        stream_id_to_name,
        word_separator_regex,
    );

    function is_normal(sub) {
        return _stream_data__WEBPACK_IMPORTED_MODULE_0__.is_active(sub);
    }

    const pinned_streams = [];
    const normal_streams = [];
    const muted_pinned_streams = [];
    const muted_active_streams = [];
    const dormant_streams = [];

    for (const stream of streams) {
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream);
        const pinned = sub.pin_to_top;
        if (pinned) {
            if (!sub.is_muted) {
                pinned_streams.push(stream);
            } else {
                muted_pinned_streams.push(stream);
            }
        } else if (is_normal(sub)) {
            if (!sub.is_muted) {
                normal_streams.push(stream);
            } else {
                muted_active_streams.push(stream);
            }
        } else {
            dormant_streams.push(stream);
        }
    }

    pinned_streams.sort(compare_function);
    normal_streams.sort(compare_function);
    muted_pinned_streams.sort(compare_function);
    muted_active_streams.sort(compare_function);
    dormant_streams.sort(compare_function);

    const same_as_before =
        previous_pinned !== undefined &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(previous_pinned, pinned_streams) &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(previous_normal, normal_streams) &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(previous_muted_pinned, muted_pinned_streams) &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(previous_muted_active, muted_active_streams) &&
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(previous_dormant, dormant_streams);

    if (!same_as_before) {
        previous_pinned = pinned_streams;
        previous_normal = normal_streams;
        previous_muted_pinned = muted_pinned_streams;
        previous_muted_active = muted_active_streams;
        previous_dormant = dormant_streams;

        all_streams = pinned_streams.concat(
            muted_pinned_streams,
            normal_streams,
            muted_active_streams,
            dormant_streams,
        );
    }

    return {
        same_as_before,
        pinned_streams,
        normal_streams,
        dormant_streams,
        muted_pinned_streams,
        muted_active_streams,
    };
}

function maybe_get_stream_id(i) {
    if (i < 0 || i >= all_streams.length) {
        return undefined;
    }

    return all_streams[i];
}

function first_stream_id() {
    return maybe_get_stream_id(0);
}

function prev_stream_id(stream_id) {
    const i = all_streams.indexOf(stream_id);

    if (i < 0) {
        return undefined;
    }

    return maybe_get_stream_id(i - 1);
}

function next_stream_id(stream_id) {
    const i = all_streams.indexOf(stream_id);

    if (i < 0) {
        return undefined;
    }

    return maybe_get_stream_id(i + 1);
}


/***/ }),

/***/ "./static/js/stream_topic_history.js":
/*!*******************************************!*\
  !*** ./static/js/stream_topic_history.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PerStreamHistory": () => (/* binding */ PerStreamHistory),
/* harmony export */   "add_history": () => (/* binding */ add_history),
/* harmony export */   "add_message": () => (/* binding */ add_message),
/* harmony export */   "all_topics_in_cache": () => (/* binding */ all_topics_in_cache),
/* harmony export */   "find_or_create": () => (/* binding */ find_or_create),
/* harmony export */   "get_max_message_id": () => (/* binding */ get_max_message_id),
/* harmony export */   "get_recent_topic_names": () => (/* binding */ get_recent_topic_names),
/* harmony export */   "has_history_for": () => (/* binding */ has_history_for),
/* harmony export */   "is_complete_for_stream_id": () => (/* binding */ is_complete_for_stream_id),
/* harmony export */   "remove_messages": () => (/* binding */ remove_messages),
/* harmony export */   "reset": () => (/* binding */ reset),
/* harmony export */   "stream_has_topics": () => (/* binding */ stream_has_topics)
/* harmony export */ });
/* harmony import */ var _all_messages_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./all_messages_data */ "./static/js/all_messages_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_util */ "./static/js/message_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");






const stream_dict = new Map(); // stream_id -> PerStreamHistory object
const fetched_stream_ids = new Set();

function all_topics_in_cache(sub) {
    // Checks whether this browser's cache of contiguous messages
    // (used to locally render narrows) in all_messages_data has all
    // messages from a given stream, and thus all historical topics
    // for it.  Because all_messages_data is a range, we just need to
    // compare it to the range of history on the stream.

    // If the cache isn't initialized, it's a clear false.
    if (_all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data === undefined || _all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.empty()) {
        return false;
    }

    // If the cache doesn't have the latest messages, we can't be sure
    // we have all topics.
    if (!_all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.fetch_status.has_found_newest()) {
        return false;
    }

    if (sub.first_message_id === null) {
        // If the stream has no message history, we have it all
        // vacuously.  This should be a very rare condition, since
        // stream creation sends a message.
        return true;
    }

    // Now, we can just compare the first cached message to the first
    // message ID in the stream; if it's older, we're good, otherwise,
    // we might be missing the oldest topics in this stream in our
    // cache.
    const first_cached_message = _all_messages_data__WEBPACK_IMPORTED_MODULE_0__.all_messages_data.first();
    return first_cached_message.id <= sub.first_message_id;
}

function is_complete_for_stream_id(stream_id) {
    if (fetched_stream_ids.has(stream_id)) {
        return true;
    }

    const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
    const in_cache = all_topics_in_cache(sub);

    if (in_cache) {
        /*
            If the stream is cached, we can add it to
            fetched_stream_ids.  Note that for the opposite
            scenario, we don't delete from
            fetched_stream_ids, because we may just be
            waiting for the initial message fetch.
        */
        fetched_stream_ids.add(stream_id);
    }

    return in_cache;
}

function stream_has_topics(stream_id) {
    if (!stream_dict.has(stream_id)) {
        return false;
    }

    const history = stream_dict.get(stream_id);

    return history.has_topics();
}

class PerStreamHistory {
    /*
        For a given stream, this structure has a dictionary of topics.
        The main getter of this object is get_recent_topic_names, and
        we just sort on the fly every time we are called.

        Attributes for a topic are:
        * message_id: The latest message_id in the topic.  Only usable
          for imprecise applications like sorting.  The message_id
          cannot be fully accurate given message editing and deleting
          (as we don't have a way to handle the latest message in a
          stream having its stream edited or deleted).

          TODO: We can probably fix this limitation by doing a
          single-message `GET /messages` query with anchor="latest",
          num_before=0, num_after=0, to update this field when its
          value becomes ambiguous.  Or probably better to avoid a
          thundering herd (of a fast query), having the server send
          the data needed to do this update in stream/topic-edit and
          delete events (just the new max_message_id for the relevant
          topic would likely suffice, though we need to think about
          private stream corner cases).
        * pretty_name: The topic_name, with original case.
        * historical: Whether the user actually received any messages in
          the topic (has UserMessage rows) or is just viewing the stream.
        * count: Number of known messages in the topic.  Used to detect
          when the last messages in a topic were moved to other topics or
          deleted.
    */

    topics = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    // Most recent message ID for the stream.
    max_message_id = 0;

    constructor(stream_id) {
        this.stream_id = stream_id;
    }

    has_topics() {
        return this.topics.size !== 0;
    }

    update_stream_max_message_id(message_id) {
        if (message_id > this.max_message_id) {
            this.max_message_id = message_id;
        }
    }

    add_or_update({topic_name, message_id = 0}) {
        message_id = Number.parseInt(message_id, 10);
        this.update_stream_max_message_id(message_id);

        const existing = this.topics.get(topic_name);

        if (!existing) {
            this.topics.set(topic_name, {
                message_id,
                pretty_name: topic_name,
                historical: false,
                count: 1,
            });
            return;
        }

        if (!existing.historical) {
            existing.count += 1;
        }

        if (message_id > existing.message_id) {
            existing.message_id = message_id;
            existing.pretty_name = topic_name;
        }
    }

    maybe_remove(topic_name, num_messages) {
        const existing = this.topics.get(topic_name);

        if (!existing) {
            return;
        }

        if (existing.historical) {
            // We can't trust that a topic rename applied to
            // the entire history of historical topic, so we
            // will always leave it in the sidebar.
            return;
        }

        if (existing.count <= num_messages) {
            this.topics.delete(topic_name);
            return;
        }

        existing.count -= num_messages;
    }

    add_history(server_history) {
        // This method populates historical topics from the
        // server.  We have less data about these than the
        // client can maintain for newer topics.

        for (const obj of server_history) {
            const topic_name = obj.name;
            const message_id = obj.max_id;

            const existing = this.topics.get(topic_name);

            if (existing && !existing.historical) {
                // Trust out local data more, since it
                // maintains counts.
                continue;
            }

            // If we get here, we are either finding out about
            // the topic for the first time, or we are getting
            // more current data for it.

            this.topics.set(topic_name, {
                message_id,
                pretty_name: topic_name,
                historical: true,
            });
            this.update_stream_max_message_id(message_id);
        }
    }

    get_recent_topic_names() {
        const my_recents = Array.from(this.topics.values());

        /* Add any older topics with unreads that may not be present
         * in our local cache. */
        const missing_topics = _unread__WEBPACK_IMPORTED_MODULE_3__.get_missing_topics({
            stream_id: this.stream_id,
            topic_dict: this.topics,
        });

        const recents = my_recents.concat(missing_topics);

        recents.sort((a, b) => b.message_id - a.message_id);

        const names = recents.map((obj) => obj.pretty_name);

        return names;
    }

    get_max_message_id() {
        return this.max_message_id;
    }
}

function remove_messages(opts) {
    const stream_id = opts.stream_id;
    const topic_name = opts.topic_name;
    const num_messages = opts.num_messages;
    const max_removed_msg_id = opts.max_removed_msg_id;
    const history = stream_dict.get(stream_id);

    // This is the special case of "removing" a message from
    // a topic, which happens when we edit topics.

    if (!history) {
        return;
    }

    // This is the normal case of an incoming message.
    history.maybe_remove(topic_name, num_messages);

    const existing_topic = history.topics.get(topic_name);
    if (!existing_topic) {
        return;
    }

    // Update max_message_id in topic
    if (existing_topic.message_id <= max_removed_msg_id) {
        const msgs_in_topic = _message_util__WEBPACK_IMPORTED_MODULE_2__.get_messages_in_topic(stream_id, topic_name);
        let max_message_id = 0;
        for (const msg of msgs_in_topic) {
            if (msg.id > max_message_id) {
                max_message_id = msg.id;
            }
        }
        existing_topic.message_id = max_message_id;
    }

    // Update max_message_id in stream
    if (history.max_message_id <= max_removed_msg_id) {
        history.max_message_id = _message_util__WEBPACK_IMPORTED_MODULE_2__.get_max_message_id_in_stream(stream_id);
    }
}

function find_or_create(stream_id) {
    let history = stream_dict.get(stream_id);

    if (!history) {
        history = new PerStreamHistory(stream_id);
        stream_dict.set(stream_id, history);
    }

    return history;
}

function add_message(opts) {
    const stream_id = opts.stream_id;
    const message_id = opts.message_id;
    const topic_name = opts.topic_name;

    const history = find_or_create(stream_id);

    history.add_or_update({
        topic_name,
        message_id,
    });
}

function add_history(stream_id, server_history) {
    const history = find_or_create(stream_id);
    history.add_history(server_history);
    fetched_stream_ids.add(stream_id);
}

function has_history_for(stream_id) {
    return fetched_stream_ids.has(stream_id);
}

function get_recent_topic_names(stream_id) {
    const history = find_or_create(stream_id);

    return history.get_recent_topic_names();
}

function get_max_message_id(stream_id) {
    const history = find_or_create(stream_id);

    return history.get_max_message_id();
}

function reset() {
    // This is only used by tests.
    stream_dict.clear();
    fetched_stream_ids.clear();
}


/***/ }),

/***/ "./static/js/stream_topic_history_util.js":
/*!************************************************!*\
  !*** ./static/js/stream_topic_history_util.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_server_history": () => (/* binding */ get_server_history)
/* harmony export */ });
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");



function get_server_history(stream_id, on_success) {
    if (_stream_topic_history__WEBPACK_IMPORTED_MODULE_1__.has_history_for(stream_id)) {
        on_success();
        return;
    }

    const url = "/json/users/me/" + stream_id + "/topics";

    _channel__WEBPACK_IMPORTED_MODULE_0__.get({
        url,
        data: {},
        success(data) {
            const server_history = data.topics;
            _stream_topic_history__WEBPACK_IMPORTED_MODULE_1__.add_history(stream_id, server_history);
            on_success();
        },
    });
}


/***/ }),

/***/ "./static/js/stream_ui_updates.js":
/*!****************************************!*\
  !*** ./static/js/stream_ui_updates.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "enable_or_disable_permission_settings_in_edit_panel": () => (/* binding */ enable_or_disable_permission_settings_in_edit_panel),
/* harmony export */   "enable_or_disable_subscribers_tab": () => (/* binding */ enable_or_disable_subscribers_tab),
/* harmony export */   "initialize_cant_subscribe_popover": () => (/* binding */ initialize_cant_subscribe_popover),
/* harmony export */   "initialize_disable_btn_hint_popover": () => (/* binding */ initialize_disable_btn_hint_popover),
/* harmony export */   "update_add_subscriptions_elements": () => (/* binding */ update_add_subscriptions_elements),
/* harmony export */   "update_notification_setting_checkbox": () => (/* binding */ update_notification_setting_checkbox),
/* harmony export */   "update_permissions_banner": () => (/* binding */ update_permissions_banner),
/* harmony export */   "update_regular_sub_settings": () => (/* binding */ update_regular_sub_settings),
/* harmony export */   "update_setting_element": () => (/* binding */ update_setting_element),
/* harmony export */   "update_settings_button_for_sub": () => (/* binding */ update_settings_button_for_sub),
/* harmony export */   "update_stream_privacy_icon_in_settings": () => (/* binding */ update_stream_privacy_icon_in_settings),
/* harmony export */   "update_stream_row_in_settings_tab": () => (/* binding */ update_stream_row_in_settings_tab),
/* harmony export */   "update_toggler_for_sub": () => (/* binding */ update_toggler_for_sub)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_stream_settings_stream_privacy_icon_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/stream_settings/stream_privacy_icon.hbs */ "./static/templates/stream_settings/stream_privacy_icon.hbs");
/* harmony import */ var _templates_stream_settings_stream_privacy_icon_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_privacy_icon_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_stream_settings_stream_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/stream_settings/stream_settings_tip.hbs */ "./static/templates/stream_settings/stream_settings_tip.hbs");
/* harmony import */ var _templates_stream_settings_stream_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_stream_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_edit__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_edit */ "./static/js/stream_edit.js");
/* harmony import */ var _stream_settings_containers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_settings_containers */ "./static/js/stream_settings_containers.js");
/* harmony import */ var _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_settings_ui */ "./static/js/stream_settings_ui.js");














function initialize_disable_btn_hint_popover(
    $btn_wrapper,
    $popover_btn,
    $disabled_btn,
    hint_text,
) {
    // Disabled button blocks mouse events(hover) from reaching
    // to it's parent div element, so popover don't get triggered.
    // Add css to prevent this.
    $disabled_btn.css("pointer-events", "none");
    $popover_btn.popover({
        placement: "bottom",
        content: jquery__WEBPACK_IMPORTED_MODULE_0___default()("<div>").addClass("sub_disable_btn_hint").text(hint_text).prop("outerHTML"),
        trigger: "manual",
        html: true,
        animation: false,
    });

    $btn_wrapper.on("mouseover", (e) => {
        $popover_btn.popover("show");
        e.stopPropagation();
    });

    $btn_wrapper.on("mouseout", (e) => {
        $popover_btn.popover("hide");
        e.stopPropagation();
    });
}

function initialize_cant_subscribe_popover(sub) {
    const $button_wrapper = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_8__.get_edit_container(sub)
        .find(".sub_unsub_button_wrapper");
    const $settings_button = _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.settings_button_for_sub(sub);
    initialize_disable_btn_hint_popover(
        $button_wrapper,
        $settings_button,
        $settings_button,
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Only stream members can add users to a private stream"}),
    );
}

function update_toggler_for_sub(sub) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }
    if (sub.subscribed) {
        _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.enable_tab("personal_settings");
        _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.goto(_stream_edit__WEBPACK_IMPORTED_MODULE_7__.select_tab);
    } else {
        if (_stream_edit__WEBPACK_IMPORTED_MODULE_7__.select_tab === "personal_settings") {
            // Go to the general settings tab, if the user is not
            // subscribed. Also preserve the previous selected tab,
            // to render next time a stream row is selected.
            _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.goto("general_settings");
        } else {
            _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.goto(_stream_edit__WEBPACK_IMPORTED_MODULE_7__.select_tab);
        }
        _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.disable_tab("personal_settings");
    }
    enable_or_disable_subscribers_tab(sub);
}

function enable_or_disable_subscribers_tab(sub) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }

    if (!_stream_data__WEBPACK_IMPORTED_MODULE_6__.can_view_subscribers(sub)) {
        _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.disable_tab("subscriber_settings");
        if (_stream_edit__WEBPACK_IMPORTED_MODULE_7__.select_tab === "subscriber_settings") {
            _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.goto("general_settings");
        }
        return;
    }

    _stream_edit__WEBPACK_IMPORTED_MODULE_7__.toggler.enable_tab("subscriber_settings");
}

function update_settings_button_for_sub(sub) {
    // This is for the Subscribe/Unsubscribe button in the right panel.
    const $settings_button = _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.settings_button_for_sub(sub);
    if (sub.subscribed) {
        $settings_button.text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unsubscribe"})).removeClass("unsubscribed");
    } else {
        $settings_button.text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Subscribe"})).addClass("unsubscribed");
    }
    if (_stream_data__WEBPACK_IMPORTED_MODULE_6__.can_toggle_subscription(sub)) {
        $settings_button.prop("disabled", false);
        $settings_button.popover("destroy");
        $settings_button.css("pointer-events", "");
    } else {
        $settings_button.attr("title", "");
        initialize_cant_subscribe_popover(sub);
        $settings_button.prop("disabled", true);
    }
}

function update_regular_sub_settings(sub) {
    // These are in the right panel.
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }
    const $settings = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.subscription_settings[data-stream-id='${CSS.escape(sub.stream_id)}']`);
    if (sub.subscribed) {
        $settings.find(".personal_settings").addClass("in");
        $settings.find(".stream-email-box").show();
    } else {
        $settings.find(".personal_settings").removeClass("in");
        $settings.find(".stream-email-box").hide();
    }
}

function enable_or_disable_permission_settings_in_edit_panel(sub) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }

    const $stream_settings = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_8__.get_edit_container(sub);

    const $general_settings_container = $stream_settings.find(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_permission_settings"));
    $general_settings_container
        .find("input, select")
        .prop("disabled", !sub.can_change_stream_permissions);

    if (!sub.can_change_stream_permissions) {
        return;
    }

    const disable_message_retention_setting =
        !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || !Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    $stream_settings
        .find(".stream_message_retention_setting")
        .prop("disabled", disable_message_retention_setting);
    $stream_settings
        .find(".message-retention-setting-custom-input")
        .prop("disabled", disable_message_retention_setting);

    _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.update_web_public_stream_privacy_option_state(
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_permission_settings"),
    );
}

function update_stream_privacy_icon_in_settings(sub) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }

    const $stream_settings = _stream_settings_containers__WEBPACK_IMPORTED_MODULE_8__.get_edit_container(sub);

    $stream_settings.find(".general_settings .large-icon").replaceWith(
        _templates_stream_settings_stream_privacy_icon_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
            invite_only: sub.invite_only,
            color: sub.color,
            is_web_public: sub.is_web_public,
        }),
    );
}

function update_permissions_banner(sub) {
    const $settings = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.subscription_settings[data-stream-id='${CSS.escape(sub.stream_id)}']`);

    const rendered_tip = _templates_stream_settings_stream_settings_tip_hbs__WEBPACK_IMPORTED_MODULE_2___default()(sub);
    $settings.find(".stream-settings-tip-container").html(rendered_tip);
}

function update_notification_setting_checkbox(notification_name) {
    // This is in the right panel (Personal settings).
    const $stream_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_streams_container .stream-row.active");
    if (!$stream_row.length) {
        return;
    }
    const stream_id = $stream_row.data("stream-id");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape(notification_name)}_${CSS.escape(stream_id)}`).prop(
        "checked",
        _stream_data__WEBPACK_IMPORTED_MODULE_6__.receives_notifications(stream_id, notification_name),
    );
}

function update_stream_row_in_settings_tab(sub) {
    // This is in the left panel.
    // This function display/hide stream row in stream settings tab,
    // used to display immediate effect of add/removal subscription event.
    // If user is subscribed to stream, it will show sub row under
    // "Subscribed" tab, otherwise if stream is not public hide
    // stream row under tab.
    if (_stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.is_subscribed_stream_tab_active()) {
        const $sub_row = _stream_settings_ui__WEBPACK_IMPORTED_MODULE_9__.row_for_stream_id(sub.stream_id);
        if (sub.subscribed) {
            $sub_row.removeClass("notdisplayed");
        } else if (sub.invite_only || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            $sub_row.addClass("notdisplayed");
        }
    }
}

function update_add_subscriptions_elements(sub) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }

    // We are only concerned with the Subscribers tab for editing streams.
    const $add_subscribers_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".edit_subscribers_for_stream .add_subscribers_container");

    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // For guest users, we just hide the add_subscribers feature.
        $add_subscribers_container.hide();
        return;
    }

    // Otherwise, we adjust whether the widgets are disabled based on
    // whether this user is authorized to add subscribers.
    const $input_element = $add_subscribers_container.find(".input").expectOne();
    const $button_element = $add_subscribers_container
        .find('button[name="add_subscriber"]')
        .expectOne();
    const allow_user_to_add_subs = sub.can_add_subscribers;

    if (allow_user_to_add_subs) {
        $input_element.prop("disabled", false);
        $button_element.prop("disabled", false);
        $button_element.css("pointer-events", "");
        $input_element.popover("destroy");
    } else {
        $input_element.prop("disabled", true);
        $button_element.prop("disabled", true);

        initialize_disable_btn_hint_popover(
            $add_subscribers_container,
            $input_element,
            $button_element,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Only stream members can add users to a private stream"}),
        );
    }
}

function update_setting_element(sub, setting_name) {
    if (!_hash_util__WEBPACK_IMPORTED_MODULE_3__.is_editing_stream(sub.stream_id)) {
        return;
    }

    const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#id_${CSS.escape(setting_name)}`);
    _settings_org__WEBPACK_IMPORTED_MODULE_5__.discard_property_element_changes($elem, false, sub);
}


/***/ }),

/***/ "./static/js/submessage.js":
/*!*********************************!*\
  !*** ./static/js/submessage.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "do_process_submessages": () => (/* binding */ do_process_submessages),
/* harmony export */   "get_message_events": () => (/* binding */ get_message_events),
/* harmony export */   "handle_event": () => (/* binding */ handle_event),
/* harmony export */   "make_server_callback": () => (/* binding */ make_server_callback),
/* harmony export */   "process_submessages": () => (/* binding */ process_submessages),
/* harmony export */   "update_message": () => (/* binding */ update_message)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _widgetize__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./widgetize */ "./static/js/widgetize.js");





function get_message_events(message) {
    if (message.locally_echoed) {
        return undefined;
    }

    if (!message.submessages) {
        return undefined;
    }

    if (message.submessages.length === 0) {
        return undefined;
    }

    message.submessages.sort((m1, m2) => Number.parseInt(m1.id, 10) - Number.parseInt(m2.id, 10));

    const events = message.submessages.map((obj) => ({
        sender_id: obj.sender_id,
        data: JSON.parse(obj.content),
    }));

    return events;
}

function process_submessages(in_opts) {
    // This happens in our rendering path, so we try to limit any
    // damage that may be triggered by one rogue message.
    try {
        return do_process_submessages(in_opts);
    } catch (error) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("in process_submessages: " + error.message);
        return undefined;
    }
}

function do_process_submessages(in_opts) {
    const message_id = in_opts.message_id;
    const message = _message_store__WEBPACK_IMPORTED_MODULE_2__.get(message_id);

    if (!message) {
        return;
    }

    const events = get_message_events(message);

    if (!events) {
        return;
    }

    if (events[0].sender_id !== message.sender_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`User ${events[0].sender_id} tried to hijack message ${message.id}`);
        return;
    }

    const $row = in_opts.$row;

    // Right now, our only use of submessages is widgets.

    const data = events[0].data;

    if (data === undefined) {
        return;
    }

    const widget_type = data.widget_type;

    if (widget_type === undefined) {
        return;
    }

    const post_to_server = make_server_callback(message_id);

    _widgetize__WEBPACK_IMPORTED_MODULE_3__.activate({
        widget_type,
        extra_data: data.extra_data,
        events,
        $row,
        message,
        post_to_server,
    });
}

function update_message(submsg) {
    const message = _message_store__WEBPACK_IMPORTED_MODULE_2__.get(submsg.message_id);

    if (message === undefined) {
        // This is generally not a problem--the server
        // can send us events without us having received
        // the original message, since the server doesn't
        // track that.
        return;
    }

    if (message.submessages === undefined) {
        message.submessages = [];
    }

    const existing = message.submessages.find((sm) => sm.id === submsg.id);

    if (existing !== undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Got submessage multiple times: " + submsg.id);
        return;
    }

    message.submessages.push(submsg);
}

function handle_event(submsg) {
    // Update message.submessages in case we haven't actually
    // activated the widget yet, so that when the message does
    // come in view, the data will be complete.
    update_message(submsg);

    // Right now, our only use of submessages is widgets.
    const msg_type = submsg.msg_type;

    if (msg_type !== "widget") {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("unknown msg_type: " + msg_type);
        return;
    }

    let data;

    try {
        data = JSON.parse(submsg.content);
    } catch {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("server sent us invalid json in handle_event: " + submsg.content);
        return;
    }

    _widgetize__WEBPACK_IMPORTED_MODULE_3__.handle_event({
        sender_id: submsg.sender_id,
        message_id: submsg.message_id,
        data,
    });
}

function make_server_callback(message_id) {
    return function (opts) {
        const url = "/json/submessage";

        _channel__WEBPACK_IMPORTED_MODULE_1__.post({
            url,
            data: {
                message_id,
                msg_type: opts.msg_type,
                content: JSON.stringify(opts.data),
            },
        });
    };
}


/***/ }),

/***/ "./static/js/subscriber_api.js":
/*!*************************************!*\
  !*** ./static/js/subscriber_api.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_user_ids_to_stream": () => (/* binding */ add_user_ids_to_stream),
/* harmony export */   "remove_user_id_from_stream": () => (/* binding */ remove_user_id_from_stream)
/* harmony export */ });
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");


/*
    This module simply encapsulates our legacy API for subscribing
    or unsubscribing users from streams. Callers don't need to
    know the strange names of "subscriptions" and "principals",
    nor how to JSON.stringify things, nor the URL scheme.
*/

function add_user_ids_to_stream(user_ids, sub, success, failure) {
    // TODO: use stream_id when backend supports it
    const stream_name = sub.name;
    return _channel__WEBPACK_IMPORTED_MODULE_0__.post({
        url: "/json/users/me/subscriptions",
        data: {
            subscriptions: JSON.stringify([{name: stream_name}]),
            principals: JSON.stringify(user_ids),
        },
        success,
        error: failure,
    });
}

function remove_user_id_from_stream(user_id, sub, success, failure) {
    // TODO: use stream_id when backend supports it
    const stream_name = sub.name;
    return _channel__WEBPACK_IMPORTED_MODULE_0__.del({
        url: "/json/users/me/subscriptions",
        data: {subscriptions: JSON.stringify([stream_name]), principals: JSON.stringify([user_id])},
        success,
        error: failure,
    });
}


/***/ }),

/***/ "./static/js/todo_widget.js":
/*!**********************************!*\
  !*** ./static/js/todo_widget.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "TaskData": () => (/* binding */ TaskData),
/* harmony export */   "activate": () => (/* binding */ activate)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_widgets_todo_widget_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/widgets/todo_widget.hbs */ "./static/templates/widgets/todo_widget.hbs");
/* harmony import */ var _templates_widgets_todo_widget_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_widgets_todo_widget_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_widgets_todo_widget_tasks_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/widgets/todo_widget_tasks.hbs */ "./static/templates/widgets/todo_widget_tasks.hbs");
/* harmony import */ var _templates_widgets_todo_widget_tasks_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_widgets_todo_widget_tasks_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());











// Any single user should send add a finite number of tasks
// to a todo list. We arbitrarily pick this value.
const MAX_IDX = 1000;

class TaskData {
    task_map = new Map();
    my_idx = 1;

    constructor({current_user_id}) {
        this.me = current_user_id;
    }

    get_widget_data() {
        const all_tasks = Array.from(this.task_map.values());
        all_tasks.sort((a, b) => Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.task, b.task));

        const pending_tasks = [];
        const completed_tasks = [];

        for (const item of all_tasks) {
            if (item.completed) {
                completed_tasks.push(item);
            } else {
                pending_tasks.push(item);
            }
        }

        const widget_data = {
            pending_tasks,
            completed_tasks,
        };

        return widget_data;
    }

    name_in_use(name) {
        for (const item of this.task_map.values()) {
            if (item.task === name) {
                return true;
            }
        }

        return false;
    }

    handle = {
        new_task: {
            outbound: (task, desc) => {
                this.my_idx += 1;
                const event = {
                    type: "new_task",
                    key: this.my_idx,
                    task,
                    desc,
                    completed: false,
                };

                if (!this.name_in_use(task)) {
                    return event;
                }
                return undefined;
            },

            inbound: (sender_id, data) => {
                // All messages readers may add tasks.
                // for legacy reasons, the inbound idx is
                // called key in the event
                const idx = data.key;
                const task = data.task;
                const desc = data.desc;

                if (!Number.isInteger(idx) || idx < 0 || idx > MAX_IDX) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("todo widget: bad type for inbound task idx");
                    return;
                }

                if (typeof task !== "string") {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("todo widget: bad type for inbound task title");
                    return;
                }

                if (typeof desc !== "string") {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("todo widget: bad type for inbound task desc");
                    return;
                }

                const key = idx + "," + sender_id;
                const completed = data.completed;

                const task_data = {
                    task,
                    desc,
                    idx,
                    key,
                    completed,
                };

                if (!this.name_in_use(task)) {
                    this.task_map.set(key, task_data);
                }

                // I may have added a task from another device.
                if (sender_id === this.me && this.my_idx <= idx) {
                    this.my_idx = idx + 1;
                }
            },
        },

        strike: {
            outbound(key) {
                const event = {
                    type: "strike",
                    key,
                };

                return event;
            },

            inbound: (sender_id, data) => {
                // All message readers may strike/unstrike todo tasks.
                const key = data.key;
                if (typeof key !== "string") {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("todo widget: bad type for inbound strike key");
                    return;
                }

                const item = this.task_map.get(key);

                if (item === undefined) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Do we have legacy data? unknown key for tasks: " + key);
                    return;
                }

                item.completed = !item.completed;
            },
        },
    };

    handle_event(sender_id, data) {
        const type = data.type;
        if (this.handle[type] && this.handle[type].inbound) {
            this.handle[type].inbound(sender_id, data);
        } else {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`todo widget: unknown inbound type: ${type}`);
        }
    }
}

function activate(opts) {
    const $elem = opts.$elem;
    const callback = opts.callback;

    const task_data = new TaskData({
        current_user_id: _people__WEBPACK_IMPORTED_MODULE_4__.my_current_user_id(),
    });

    function render() {
        const html = _templates_widgets_todo_widget_hbs__WEBPACK_IMPORTED_MODULE_1___default()();
        $elem.html(html);

        $elem.find("button.add-task").on("click", (e) => {
            e.stopPropagation();
            $elem.find(".widget-error").text("");
            const task = $elem.find("input.add-task").val().trim();
            const desc = $elem.find("input.add-desc").val().trim();

            if (task === "") {
                return;
            }

            $elem.find(".add-task").val("").trigger("focus");
            $elem.find(".add-desc").val("").trigger("focus");

            const task_exists = task_data.name_in_use(task);
            if (task_exists) {
                $elem.find(".widget-error").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Task already exists"}));
                return;
            }

            const data = task_data.handle.new_task.outbound(task, desc);
            callback(data);
        });
    }

    function render_results() {
        const widget_data = task_data.get_widget_data();
        const html = _templates_widgets_todo_widget_tasks_hbs__WEBPACK_IMPORTED_MODULE_2___default()(widget_data);
        $elem.find("ul.todo-widget").html(html);
        $elem.find(".widget-error").text("");

        $elem.find("input.task").on("click", (e) => {
            e.stopPropagation();

            if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
                // Logically, spectators should not be able to toggle
                // TODO checkboxes. However, the browser changes the
                // checkbox's state before calling handlers like this,
                // so we need to just toggle the checkbox back to its
                // previous state.
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).prop("checked", !jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).is(":checked"));
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).trigger("blur");
                return;
            }
            const key = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).attr("data-key");

            const data = task_data.handle.strike.outbound(key);
            callback(data);
        });
    }

    $elem.handle_events = function (events) {
        for (const event of events) {
            task_data.handle_event(event.sender_id, event.data);
        }

        render_results();
    };

    render();
    render_results();
}


/***/ }),

/***/ "./static/js/top_left_corner.js":
/*!**************************************!*\
  !*** ./static/js/top_left_corner.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "deselect_top_left_corner_items": () => (/* binding */ deselect_top_left_corner_items),
/* harmony export */   "handle_narrow_activated": () => (/* binding */ handle_narrow_activated),
/* harmony export */   "handle_narrow_deactivated": () => (/* binding */ handle_narrow_deactivated),
/* harmony export */   "narrow_to_recent_topics": () => (/* binding */ narrow_to_recent_topics),
/* harmony export */   "update_dom_with_unread_counts": () => (/* binding */ update_dom_with_unread_counts),
/* harmony export */   "update_starred_count": () => (/* binding */ update_starred_count)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");






function update_starred_count(count) {
    const $starred_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_starred_messages");
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($starred_li, count);
}

function update_dom_with_unread_counts(counts) {
    // Note that "Private messages" counts are handled in pm_list.js.

    // mentioned/home have simple integer counts
    const $mentioned_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_mentions");
    const $home_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_all_messages");

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($mentioned_li, counts.mentioned_message_count);
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())($home_li, counts.home_unread_messages);

    _unread_ui__WEBPACK_IMPORTED_MODULE_3__.animate_mention_changes($mentioned_li, counts.mentioned_message_count);
}

function remove($elem) {
    $elem.removeClass("active-filter active-sub-filter");
}

function deselect_top_left_corner_items() {
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_all_messages"));
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_starred_messages"));
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_mentions"));
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_recent_topics"));
}

function handle_narrow_activated(filter) {
    deselect_top_left_corner_items();

    let ops;
    let filter_name;
    let $filter_li;

    // TODO: handle confused filters like "in:all stream:foo"
    ops = filter.operands("in");
    if (ops.length >= 1) {
        filter_name = ops[0];
        if (filter_name === "home") {
            $filter_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_all_messages");
            $filter_li.addClass("active-filter");
        }
    }
    ops = filter.operands("is");
    if (ops.length >= 1) {
        filter_name = ops[0];
        if (filter_name === "starred") {
            $filter_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_starred_messages");
            $filter_li.addClass("active-filter");
        } else if (filter_name === "mentioned") {
            $filter_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_mentions");
            $filter_li.addClass("active-filter");
        }
    }
}

function handle_narrow_deactivated() {
    deselect_top_left_corner_items();

    const $filter_li = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_all_messages");
    $filter_li.addClass("active-filter");
}

function narrow_to_recent_topics() {
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_all_messages"));
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_starred_messages"));
    remove(jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_mentions"));
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".top_left_recent_topics").addClass("active-filter");
    setTimeout(() => {
        _resize__WEBPACK_IMPORTED_MODULE_1__.resize_stream_filters_container();
    }, 0);
}


/***/ }),

/***/ "./static/js/topic_generator.js":
/*!**************************************!*\
  !*** ./static/js/topic_generator.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_next_stream": () => (/* binding */ get_next_stream),
/* harmony export */   "get_next_topic": () => (/* binding */ get_next_topic),
/* harmony export */   "get_next_unread_pm_string": () => (/* binding */ get_next_unread_pm_string),
/* harmony export */   "get_prev_stream": () => (/* binding */ get_prev_stream),
/* harmony export */   "next_topic": () => (/* binding */ next_topic)
/* harmony export */ });
/* harmony import */ var _pm_conversations__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pm_conversations */ "./static/js/pm_conversations.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
/* harmony import */ var _stream_sort__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./stream_sort */ "./static/js/stream_sort.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");







function next_topic(streams, get_topics, has_unread_messages, curr_stream, curr_topic) {
    const curr_stream_index = streams.indexOf(curr_stream); // -1 if not found

    if (curr_stream_index >= 0) {
        const stream = streams[curr_stream_index];
        const topics = get_topics(stream);
        const curr_topic_index = topics.indexOf(curr_topic); // -1 if not found

        for (let i = curr_topic_index + 1; i < topics.length; i += 1) {
            const topic = topics[i];
            if (has_unread_messages(stream, topic)) {
                return {stream, topic};
            }
        }

        for (let i = 0; i < curr_topic_index; i += 1) {
            const topic = topics[i];
            if (has_unread_messages(stream, topic)) {
                return {stream, topic};
            }
        }
    }

    for (let i = curr_stream_index + 1; i < streams.length; i += 1) {
        const stream = streams[i];
        for (const topic of get_topics(stream)) {
            if (has_unread_messages(stream, topic)) {
                return {stream, topic};
            }
        }
    }

    for (let i = 0; i < curr_stream_index; i += 1) {
        const stream = streams[i];
        for (const topic of get_topics(stream)) {
            if (has_unread_messages(stream, topic)) {
                return {stream, topic};
            }
        }
    }

    return undefined;
}

function get_next_topic(curr_stream, curr_topic) {
    let my_streams = _stream_sort__WEBPACK_IMPORTED_MODULE_2__.get_streams();

    my_streams = my_streams.filter((stream_name) => {
        if (!_stream_data__WEBPACK_IMPORTED_MODULE_1__.is_stream_muted_by_name(stream_name)) {
            return true;
        }
        if (stream_name === curr_stream) {
            // We can use n within a muted stream if we are
            // currently narrowed to it.
            return true;
        }
        return false;
    });

    function get_unmuted_topics(stream_name) {
        const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_1__.get_stream_id(stream_name);
        let topics = _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__.get_recent_topic_names(stream_id);
        topics = topics.filter((topic) => !_user_topics__WEBPACK_IMPORTED_MODULE_5__.is_topic_muted(stream_id, topic));
        return topics;
    }

    function has_unread_messages(stream_name, topic) {
        const stream_id = _stream_data__WEBPACK_IMPORTED_MODULE_1__.get_stream_id(stream_name);
        return _unread__WEBPACK_IMPORTED_MODULE_4__.topic_has_any_unread(stream_id, topic);
    }

    return next_topic(my_streams, get_unmuted_topics, has_unread_messages, curr_stream, curr_topic);
}

function get_next_unread_pm_string(curr_pm) {
    const my_pm_strings = _pm_conversations__WEBPACK_IMPORTED_MODULE_0__.recent.get_strings();
    const curr_pm_index = my_pm_strings.indexOf(curr_pm); // -1 if not found

    for (let i = curr_pm_index + 1; i < my_pm_strings.length; i += 1) {
        if (_unread__WEBPACK_IMPORTED_MODULE_4__.num_unread_for_user_ids_string(my_pm_strings[i]) > 0) {
            return my_pm_strings[i];
        }
    }

    for (let i = 0; i < curr_pm_index; i += 1) {
        if (_unread__WEBPACK_IMPORTED_MODULE_4__.num_unread_for_user_ids_string(my_pm_strings[i]) > 0) {
            return my_pm_strings[i];
        }
    }

    return undefined;
}

function get_next_stream(curr_stream) {
    const my_streams = _stream_sort__WEBPACK_IMPORTED_MODULE_2__.get_streams();
    const curr_stream_index = my_streams.indexOf(curr_stream);
    return my_streams[
        curr_stream_index < 0 || curr_stream_index === my_streams.length - 1
            ? 0
            : curr_stream_index + 1
    ];
}

function get_prev_stream(curr_stream) {
    const my_streams = _stream_sort__WEBPACK_IMPORTED_MODULE_2__.get_streams();
    const curr_stream_index = my_streams.indexOf(curr_stream);
    return my_streams[curr_stream_index <= 0 ? my_streams.length - 1 : curr_stream_index - 1];
}


/***/ }),

/***/ "./static/js/topic_list.js":
/*!*********************************!*\
  !*** ./static/js/topic_list.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "TopicListWidget": () => (/* binding */ TopicListWidget),
/* harmony export */   "active_stream_id": () => (/* binding */ active_stream_id),
/* harmony export */   "clear": () => (/* binding */ clear),
/* harmony export */   "clear_topic_search": () => (/* binding */ clear_topic_search),
/* harmony export */   "close": () => (/* binding */ close),
/* harmony export */   "get_stream_li": () => (/* binding */ get_stream_li),
/* harmony export */   "get_topic_search_term": () => (/* binding */ get_topic_search_term),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "keyed_topic_li": () => (/* binding */ keyed_topic_li),
/* harmony export */   "more_li": () => (/* binding */ more_li),
/* harmony export */   "rebuild": () => (/* binding */ rebuild),
/* harmony export */   "spinner_li": () => (/* binding */ spinner_li),
/* harmony export */   "update": () => (/* binding */ update),
/* harmony export */   "zoom_in": () => (/* binding */ zoom_in),
/* harmony export */   "zoom_out": () => (/* binding */ zoom_out)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_more_topics_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/more_topics.hbs */ "./static/templates/more_topics.hbs");
/* harmony import */ var _templates_more_topics_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_more_topics_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_more_topics_spinner_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/more_topics_spinner.hbs */ "./static/templates/more_topics_spinner.hbs");
/* harmony import */ var _templates_more_topics_spinner_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_more_topics_spinner_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _templates_topic_list_item_hbs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../templates/topic_list_item.hbs */ "./static/templates/topic_list_item.hbs");
/* harmony import */ var _templates_topic_list_item_hbs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_templates_topic_list_item_hbs__WEBPACK_IMPORTED_MODULE_4__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _narrow__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./narrow */ "./static/js/narrow.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./stream_topic_history_util */ "./static/js/stream_topic_history_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _topic_list_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./topic_list_data */ "./static/js/topic_list_data.js");
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _vdom__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./vdom */ "./static/js/vdom.js");

















/*
    Track all active widgets with a Map.

    (We have at max one for now, but we may
    eventually allow multiple streams to be
    expanded.)
*/

const active_widgets = new Map();

// We know whether we're zoomed or not.
let zoomed = false;

function update() {
    for (const widget of active_widgets.values()) {
        widget.build();
    }
}

function clear() {
    _stream_popover__WEBPACK_IMPORTED_MODULE_7__.hide_topic_popover();

    for (const widget of active_widgets.values()) {
        widget.remove();
    }

    active_widgets.clear();
}

function close() {
    zoomed = false;
    clear();
}

function zoom_out() {
    zoomed = false;

    const stream_ids = Array.from(active_widgets.keys());

    if (stream_ids.length !== 1) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected number of topic lists to zoom out.");
        return;
    }

    const stream_id = stream_ids[0];
    const widget = active_widgets.get(stream_id);
    const parent_widget = widget.get_parent();

    rebuild(parent_widget, stream_id);
}

function keyed_topic_li(conversation) {
    const render = () => _templates_topic_list_item_hbs__WEBPACK_IMPORTED_MODULE_4___default()(conversation);

    const eq = (other) => lodash__WEBPACK_IMPORTED_MODULE_1___default().isEqual(conversation, other.conversation);

    const key = "t:" + conversation.topic_name;

    return {
        key,
        render,
        conversation,
        eq,
    };
}

function more_li(more_topics_unreads, more_topics_have_unread_mention_messages) {
    const render = () =>
        _templates_more_topics_hbs__WEBPACK_IMPORTED_MODULE_2___default()({
            more_topics_unreads,
            more_topics_have_unread_mention_messages,
        });

    const eq = (other) => other.more_items && more_topics_unreads === other.more_topics_unreads;

    const key = "more";

    return {
        key,
        more_items: true,
        more_topics_unreads,
        render,
        eq,
    };
}

function spinner_li() {
    const render = () => _templates_more_topics_spinner_hbs__WEBPACK_IMPORTED_MODULE_3___default()();

    const eq = (other) => other.spinner;

    const key = "more";

    return {
        key,
        spinner: true,
        render,
        eq,
    };
}

class TopicListWidget {
    prior_dom = undefined;

    constructor($parent_elem, my_stream_id) {
        this.$parent_elem = $parent_elem;
        this.my_stream_id = my_stream_id;
    }

    build_list(spinner) {
        const list_info = _topic_list_data__WEBPACK_IMPORTED_MODULE_10__.get_list_info(this.my_stream_id, zoomed);

        const num_possible_topics = list_info.num_possible_topics;
        const more_topics_unreads = list_info.more_topics_unreads;
        const more_topics_have_unread_mention_messages =
            list_info.more_topics_have_unread_mention_messages;

        const is_showing_all_possible_topics =
            list_info.items.length === num_possible_topics &&
            _stream_topic_history__WEBPACK_IMPORTED_MODULE_8__.is_complete_for_stream_id(this.my_stream_id);

        const attrs = [["class", "topic-list"]];

        const nodes = list_info.items.map((conversation) => keyed_topic_li(conversation));

        if (spinner) {
            nodes.push(spinner_li());
        } else if (!is_showing_all_possible_topics) {
            nodes.push(more_li(more_topics_unreads, more_topics_have_unread_mention_messages));
        }

        const dom = _vdom__WEBPACK_IMPORTED_MODULE_12__.ul({
            attrs,
            keyed_nodes: nodes,
        });

        return dom;
    }

    get_parent() {
        return this.$parent_elem;
    }

    get_stream_id() {
        return this.my_stream_id;
    }

    remove() {
        this.$parent_elem.find(".topic-list").remove();
        this.prior_dom = undefined;
    }

    build(spinner) {
        const new_dom = this.build_list(spinner);

        const replace_content = (html) => {
            this.remove();
            this.$parent_elem.append(html);
        };

        const find = () => this.$parent_elem.find(".topic-list");

        _vdom__WEBPACK_IMPORTED_MODULE_12__.update(replace_content, find, new_dom, this.prior_dom);

        this.prior_dom = new_dom;

        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()("#filter-topic-input").val() !== "") {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_topic_button").show();
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_topic_button").hide();
        }
    }
}

function clear_topic_search(e) {
    e.stopPropagation();
    const $input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#filter-topic-input");
    if ($input.length) {
        $input.val("");
        $input.trigger("blur");

        // Since this changes the contents of the search input, we
        // need to rerender the topic list.
        const stream_ids = Array.from(active_widgets.keys());

        const stream_id = stream_ids[0];
        const widget = active_widgets.get(stream_id);
        const parent_widget = widget.get_parent();

        rebuild(parent_widget, stream_id);
    }
}

function active_stream_id() {
    const stream_ids = Array.from(active_widgets.keys());

    if (stream_ids.length !== 1) {
        return undefined;
    }

    return stream_ids[0];
}

function get_stream_li() {
    const widgets = Array.from(active_widgets.values());

    if (widgets.length !== 1) {
        return undefined;
    }

    const $stream_li = widgets[0].get_parent();
    return $stream_li;
}

function rebuild($stream_li, stream_id) {
    const active_widget = active_widgets.get(stream_id);

    if (active_widget) {
        active_widget.build();
        return;
    }

    clear();
    const widget = new TopicListWidget($stream_li, stream_id);
    widget.build();

    active_widgets.set(stream_id, widget);
}

// For zooming, we only do topic-list stuff here...let stream_list
// handle hiding/showing the non-narrowed streams
function zoom_in() {
    zoomed = true;

    const stream_id = active_stream_id();
    if (!stream_id) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cannot find widget for topic history zooming.");
        return;
    }

    const active_widget = active_widgets.get(stream_id);

    function on_success() {
        if (!active_widgets.has(stream_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("User re-narrowed before topic history was returned.");
            return;
        }

        if (!zoomed) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("User zoomed out before topic history was returned.");
            // Note that we could attempt to re-draw the zoomed out topic list
            // here, given that we have more history, but that might be more
            // confusing than helpful to a user who is likely trying to browse
            // other streams.
            return;
        }

        active_widget.build();
    }

    _ui__WEBPACK_IMPORTED_MODULE_11__.get_scroll_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#left_sidebar_scroll_container")).scrollTop(0);

    const spinner = true;
    active_widget.build(spinner);

    _stream_topic_history_util__WEBPACK_IMPORTED_MODULE_9__.get_server_history(stream_id, on_success);
}

function get_topic_search_term() {
    const $filter = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#filter-topic-input");
    if ($filter.val() === undefined) {
        return "";
    }
    return $filter.val().trim();
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters").on("click", ".topic-box", (e) => {
        if (e.metaKey || e.ctrlKey) {
            return;
        }
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).closest(".show-more-topics").length > 0) {
            return;
        }

        // In a more componentized world, we would delegate some
        // of this stuff back up to our parents.

        const $stream_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).parents(".narrow-filter");
        const stream_id = Number.parseInt($stream_row.attr("data-stream-id"), 10);
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const topic = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).parents("li").attr("data-topic-name");

        _narrow__WEBPACK_IMPORTED_MODULE_6__.activate(
            [
                {operator: "stream", operand: sub.name},
                {operator: "topic", operand: topic},
            ],
            {trigger: "sidebar"},
        );

        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("input", "#filter-topic-input", () => {
        active_widgets.get(active_stream_id()).build();
    });
}


/***/ }),

/***/ "./static/js/topic_list_data.js":
/*!**************************************!*\
  !*** ./static/js/topic_list_data.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_list_info": () => (/* binding */ get_list_info)
/* harmony export */ });
/* harmony import */ var _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/js/resolved_topic */ "./static/shared/js/resolved_topic.js");
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_topic_history */ "./static/js/stream_topic_history.js");
/* harmony import */ var _topic_list__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./topic_list */ "./static/js/topic_list.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());










const max_topics = 5;
const max_topics_with_unread = 8;

function get_list_info(stream_id, zoomed) {
    let topics_selected = 0;
    let more_topics_unreads = 0;
    let more_topics_have_unread_mention_messages = false;

    let active_topic = _narrow_state__WEBPACK_IMPORTED_MODULE_2__.topic();

    if (active_topic) {
        active_topic = active_topic.toLowerCase();
    }

    let topic_names = _stream_topic_history__WEBPACK_IMPORTED_MODULE_3__.get_recent_topic_names(stream_id);
    if (zoomed) {
        const search_term = _topic_list__WEBPACK_IMPORTED_MODULE_4__.get_topic_search_term();
        topic_names = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(topic_names, search_term, (item) => item);
    }

    const items = [];

    const topics_with_unread_mentions = _unread__WEBPACK_IMPORTED_MODULE_5__.get_topics_with_unread_mentions(stream_id);

    for (const [idx, topic_name] of topic_names.entries()) {
        const num_unread = _unread__WEBPACK_IMPORTED_MODULE_5__.num_unread_for_topic(stream_id, topic_name);
        const is_active_topic = active_topic === topic_name.toLowerCase();
        const is_topic_muted = _user_topics__WEBPACK_IMPORTED_MODULE_6__.is_topic_muted(stream_id, topic_name);
        const [topic_resolved_prefix, topic_display_name] =
            _shared_js_resolved_topic__WEBPACK_IMPORTED_MODULE_0__.display_parts(topic_name);
        // Important: Topics are lower-case in this set.
        const contains_unread_mention = topics_with_unread_mentions.has(topic_name.toLowerCase());

        if (!zoomed) {
            function should_show_topic(topics_selected) {
                // This function exists just for readability, to
                // avoid long chained conditionals to determine
                // which topics to include.

                // We always show the active topic.  Ideally, this
                // logic would first check whether the active
                // topic is in the set of those with unreads to
                // avoid ending up with max_topics_with_unread + 1
                // total topics if the active topic comes after
                // the first several topics with unread messages.
                if (is_active_topic) {
                    return true;
                }

                // We unconditionally skip showing muted topics
                // when not zoomed, even if they have unread
                // messages.
                if (is_topic_muted) {
                    return false;
                }

                // We include the most recent max_topics topics,
                // even if there are no unread messages.
                if (idx < max_topics) {
                    return true;
                }

                // We include older topics with unread messages up
                // until max_topics_with_unread total topics have
                // been included.
                if (num_unread > 0 && topics_selected < max_topics_with_unread) {
                    return true;
                }

                // Otherwise, we don't show the topic in the
                // unzoomed view.  We might display its unread
                // count in in "more topics" if it is not muted.
                return false;
            }

            const show_topic = should_show_topic(topics_selected);
            if (!show_topic) {
                if (!is_topic_muted) {
                    // The "more topics" unread count, like
                    // stream-level counts, only counts messages
                    // on unmuted topics.
                    more_topics_unreads += num_unread;
                    if (contains_unread_mention) {
                        more_topics_have_unread_mention_messages = true;
                    }
                }
                continue;
            }
            topics_selected += 1;
            // We fall through to rendering the topic, using the
            // same code we do when zoomed.
        }

        const topic_info = {
            topic_name,
            topic_resolved_prefix,
            topic_display_name,
            unread: num_unread,
            is_zero: num_unread === 0,
            is_muted: is_topic_muted,
            is_active_topic,
            url: _hash_util__WEBPACK_IMPORTED_MODULE_1__.by_stream_topic_url(stream_id, topic_name),
            contains_unread_mention,
        };

        items.push(topic_info);
    }

    return {
        items,
        num_possible_topics: topic_names.length,
        more_topics_unreads,
        more_topics_have_unread_mention_messages,
    };
}


/***/ }),

/***/ "./static/js/topic_zoom.js":
/*!*********************************!*\
  !*** ./static/js/topic_zoom.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_topics": () => (/* binding */ clear_topics),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_zoomed_in": () => (/* binding */ is_zoomed_in),
/* harmony export */   "zoom_out": () => (/* binding */ zoom_out)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _topic_list__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./topic_list */ "./static/js/topic_list.js");






let zoomed_in = false;

function is_zoomed_in() {
    return zoomed_in;
}

function zoom_in() {
    const stream_id = _topic_list__WEBPACK_IMPORTED_MODULE_3__.active_stream_id();

    _popovers__WEBPACK_IMPORTED_MODULE_1__.hide_all_except_sidebars();
    _topic_list__WEBPACK_IMPORTED_MODULE_3__.zoom_in();
    _stream_list__WEBPACK_IMPORTED_MODULE_2__.zoom_in_topics({
        stream_id,
    });

    zoomed_in = true;
}

function zoom_out() {
    const $stream_li = _topic_list__WEBPACK_IMPORTED_MODULE_3__.get_stream_li();

    _popovers__WEBPACK_IMPORTED_MODULE_1__.hide_all_except_sidebars();
    _topic_list__WEBPACK_IMPORTED_MODULE_3__.zoom_out();
    _stream_list__WEBPACK_IMPORTED_MODULE_2__.zoom_out_topics();

    if ($stream_li) {
        _stream_list__WEBPACK_IMPORTED_MODULE_2__.scroll_stream_into_view($stream_li);
    }

    zoomed_in = false;
}

function clear_topics() {
    const $stream_li = _topic_list__WEBPACK_IMPORTED_MODULE_3__.get_stream_li();

    _topic_list__WEBPACK_IMPORTED_MODULE_3__.close();

    if (zoomed_in) {
        _stream_list__WEBPACK_IMPORTED_MODULE_2__.zoom_out_topics();

        if ($stream_li) {
            _stream_list__WEBPACK_IMPORTED_MODULE_2__.scroll_stream_into_view($stream_li);
        }
    }

    zoomed_in = false;
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#stream_filters").on("click", ".show-more-topics", (e) => {
        zoom_in();

        e.preventDefault();
        e.stopPropagation();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".show-all-streams").on("click", (e) => {
        zoom_out();

        e.preventDefault();
        e.stopPropagation();
    });
}


/***/ }),

/***/ "./static/js/transmit.js":
/*!*******************************!*\
  !*** ./static/js/transmit.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "reply_message": () => (/* binding */ reply_message),
/* harmony export */   "send_message": () => (/* binding */ send_message)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _reload__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./reload */ "./static/js/reload.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _sent_messages__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sent_messages */ "./static/js/sent_messages.js");








function send_message(request, on_success, error, future_message) {
    _channel__WEBPACK_IMPORTED_MODULE_1__.post({
        url: "/json/messages",
        data: request,
        success: function success(data) {
            // Call back to our callers to do things like closing the compose
            // box and turning off spinners and reifying locally echoed messages.
            on_success(data);

            // For /schedule or /reminder messages don't ack.
            if (!future_message) {
                // Once everything is done, get ready to report times to the server.
                _sent_messages__WEBPACK_IMPORTED_MODULE_4__.report_server_ack(request.local_id);
            }
        },
        error(xhr, error_type) {
            if (error_type !== "timeout" && Object(function webpackMissingModule() { var e = new Error("Cannot find module './reload_state'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())()) {
                // The error might be due to the server changing
                _reload__WEBPACK_IMPORTED_MODULE_3__.initiate({
                    immediate: true,
                    save_pointer: true,
                    save_narrow: true,
                    save_compose: true,
                    send_after_reload: true,
                });
                return;
            }

            const response = _channel__WEBPACK_IMPORTED_MODULE_1__.xhr_error_message("Error sending message", xhr);
            error(response);
        },
    });
}

function reply_message(opts) {
    // This code does an application-triggered reply to a message (as
    // opposed to the user themselves doing it).  Its only use case
    // for now is experimental widget-aware bots, so treat this as
    // somewhat beta code.  To understand the use case, think of a
    // bot that wants to give users 3 or 4 canned replies to some
    // choice, but it wants to front-end each of these options
    // with a one-click button.  This function is part of that architecture.
    const message = opts.message;
    let content = opts.content;

    function success() {
        // TODO: If server response comes back before the message event,
        //       we could show it earlier, although that creates some
        //       complexity.  For now do nothing.  (Note that send_message
        //       already handles things like reporting times to the server.)
    }

    function error() {
        // TODO: In our current use case, which is widgets, to meaningfully
        //       handle errors, we would want the widget to provide some
        //       kind of callback to us so it can do some appropriate UI.
        //       For now do nothing.
    }

    const locally_echoed = false;
    const local_id = _sent_messages__WEBPACK_IMPORTED_MODULE_4__.get_new_local_id();

    const reply = {
        sender_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        queue_id: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
        local_id,
    };

    _sent_messages__WEBPACK_IMPORTED_MODULE_4__.start_tracking_message({
        local_id,
        locally_echoed,
    });

    if (message.type === "stream") {
        const stream = message.stream;

        const mention = _people__WEBPACK_IMPORTED_MODULE_2__.get_mention_syntax(message.sender_full_name, message.sender_id);

        content = mention + " " + content;

        reply.type = "stream";
        reply.to = stream;
        reply.content = content;
        reply.topic = message.topic;

        send_message(reply, success, error);
        return;
    }

    if (message.type === "private") {
        const pm_recipient = _people__WEBPACK_IMPORTED_MODULE_2__.pm_reply_to(message);

        reply.type = "private";
        reply.to = JSON.stringify(pm_recipient.split(","));
        reply.content = content;

        send_message(reply, success, error);
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("unknown message type: " + message.type);
}


/***/ }),

/***/ "./static/js/typeahead_helper.js":
/*!***************************************!*\
  !*** ./static/js/typeahead_helper.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_highlight_regex": () => (/* binding */ build_highlight_regex),
/* harmony export */   "compare_by_activity": () => (/* binding */ compare_by_activity),
/* harmony export */   "compare_by_pms": () => (/* binding */ compare_by_pms),
/* harmony export */   "compare_by_popularity": () => (/* binding */ compare_by_popularity),
/* harmony export */   "compare_people_for_relevance": () => (/* binding */ compare_people_for_relevance),
/* harmony export */   "get_cleaned_pm_recipients": () => (/* binding */ get_cleaned_pm_recipients),
/* harmony export */   "highlight_with_escaping_and_regex": () => (/* binding */ highlight_with_escaping_and_regex),
/* harmony export */   "make_query_highlighter": () => (/* binding */ make_query_highlighter),
/* harmony export */   "render_emoji": () => (/* binding */ render_emoji),
/* harmony export */   "render_person": () => (/* binding */ render_person),
/* harmony export */   "render_person_or_user_group": () => (/* binding */ render_person_or_user_group),
/* harmony export */   "render_stream": () => (/* binding */ render_stream),
/* harmony export */   "render_typeahead_item": () => (/* binding */ render_typeahead_item),
/* harmony export */   "render_user_group": () => (/* binding */ render_user_group),
/* harmony export */   "sort_languages": () => (/* binding */ sort_languages),
/* harmony export */   "sort_people_for_relevance": () => (/* binding */ sort_people_for_relevance),
/* harmony export */   "sort_recipients": () => (/* binding */ sort_recipients),
/* harmony export */   "sort_slash_commands": () => (/* binding */ sort_slash_commands),
/* harmony export */   "sort_streams": () => (/* binding */ sort_streams),
/* harmony export */   "sorter": () => (/* binding */ sorter)
/* harmony export */ });
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! handlebars/runtime */ "./node_modules/handlebars/dist/cjs/handlebars.runtime.js");
/* harmony import */ var handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(handlebars_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../shared/js/typeahead */ "./static/shared/js/typeahead.js");
/* harmony import */ var _templates_typeahead_list_item_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/typeahead_list_item.hbs */ "./static/templates/typeahead_list_item.hbs");
/* harmony import */ var _templates_typeahead_list_item_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_typeahead_list_item_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_conversations__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./pm_conversations */ "./static/js/pm_conversations.js");
/* harmony import */ var _recent_senders__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./recent_senders */ "./static/js/recent_senders.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



// import pygments_data from "../generated/pygments_data.json";













// Returns an array of private message recipients, removing empty elements.
// For example, "a,,b, " => ["a", "b"]
function get_cleaned_pm_recipients(query_string) {
    let recipients = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(query_string);
    recipients = recipients.filter((elem) => elem.match(/\S/));
    return recipients;
}

function build_highlight_regex(query) {
    const regex = new RegExp("(" + lodash__WEBPACK_IMPORTED_MODULE_1___default().escapeRegExp(query) + ")", "ig");
    return regex;
}

function highlight_with_escaping_and_regex(regex, item) {
    // We need to assemble this manually (as opposed to doing 'join') because we need to
    // (1) escape all the pieces and (2) the regex is case-insensitive, and we need
    // to know the case of the content we're replacing (you can't just use a bolded
    // version of 'query')

    const pieces = item.split(regex);
    let result = "";

    for (const piece of pieces) {
        if (regex.test(piece)) {
            result += "<strong>" + handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().Utils.escapeExpression(piece) + "</strong>";
        } else {
            result += handlebars_runtime__WEBPACK_IMPORTED_MODULE_0___default().Utils.escapeExpression(piece);
        }
    }

    return result;
}

function make_query_highlighter(query) {
    let i;
    query = query.toLowerCase();

    const regex = build_highlight_regex(query);

    return function (phrase) {
        let result = "";
        const parts = phrase.split(" ");
        for (i = 0; i < parts.length; i += 1) {
            if (i > 0) {
                result += " ";
            }
            result += highlight_with_escaping_and_regex(regex, parts[i]);
        }
        return result;
    };
}

function render_typeahead_item(args) {
    args.has_image = args.img_src !== undefined;
    args.has_status = args.status_emoji_info !== undefined;
    args.has_secondary = args.secondary !== undefined;
    return _templates_typeahead_list_item_hbs__WEBPACK_IMPORTED_MODULE_3___default()(args);
}

function render_person(person) {
    const user_circle_class = _buddy_data__WEBPACK_IMPORTED_MODULE_4__.get_user_circle_class(person.user_id);
    if (person.special_item_text) {
        return render_typeahead_item({
            primary: person.special_item_text,
            is_person: true,
        });
    }

    const avatar_url = _people__WEBPACK_IMPORTED_MODULE_6__.small_avatar_url_for_person(person);

    const status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_11__.get_status_emoji(person.user_id);

    const typeahead_arguments = {
        primary: person.full_name,
        img_src: avatar_url,
        user_circle_class,
        is_person: true,
        status_emoji_info,
    };

    typeahead_arguments.secondary = Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(person);
    return render_typeahead_item(typeahead_arguments);
}

function render_user_group(user_group) {
    return render_typeahead_item({
        primary: user_group.name,
        secondary: user_group.description,
        is_user_group: true,
    });
}

function render_person_or_user_group(item) {
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(item)) {
        return render_user_group(item);
    }

    return render_person(item);
}

function render_stream(stream) {
    let desc = stream.description;
    const short_desc = desc.slice(0, 35);

    if (desc !== short_desc) {
        desc = short_desc + "...";
    }

    return render_typeahead_item({
        primary: stream.name,
        secondary: desc,
        is_unsubscribed: !stream.subscribed,
    });
}

function render_emoji(item) {
    const args = {
        is_emoji: true,
        primary: item.emoji_name.replace(/_/g, " "),
    };

    if (item.emoji_url) {
        args.img_src = item.emoji_url;
    } else {
        args.emoji_code = item.emoji_code;
    }

    return render_typeahead_item(args);
}

function sorter(query, objs, get_item) {
    const results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, objs, get_item);
    return results.matches.concat(results.rest);
}

function compare_by_pms(user_a, user_b) {
    const count_a = _people__WEBPACK_IMPORTED_MODULE_6__.get_recipient_count(user_a);
    const count_b = _people__WEBPACK_IMPORTED_MODULE_6__.get_recipient_count(user_b);

    if (count_a > count_b) {
        return -1;
    } else if (count_a < count_b) {
        return 1;
    }

    if (!user_a.is_bot && user_b.is_bot) {
        return -1;
    } else if (user_a.is_bot && !user_b.is_bot) {
        return 1;
    }

    // We use alpha sort as a tiebreaker, which might be helpful for
    // new users.
    if (user_a.full_name < user_b.full_name) {
        return -1;
    } else if (user_a === user_b) {
        return 0;
    }
    return 1;
}

function compare_people_for_relevance(
    person_a,
    person_b,
    tertiary_compare,
    current_stream_id,
) {
    // give preference to "all", "everyone" or "stream"
    // We use is_broadcast for a quick check.  It will
    // true for all/everyone/stream and undefined (falsy)
    // for actual people.
    if (_compose_state__WEBPACK_IMPORTED_MODULE_5__.get_message_type() !== "private") {
        if (person_a.is_broadcast) {
            if (person_b.is_broadcast) {
                return person_a.idx - person_b.idx;
            }
            return -1;
        } else if (person_b.is_broadcast) {
            return 1;
        }
    } else {
        if (person_a.is_broadcast) {
            if (person_b.is_broadcast) {
                return person_a.idx - person_b.idx;
            }
            return 1;
        } else if (person_b.is_broadcast) {
            return -1;
        }
    }

    // Now handle actual people users.

    // give preference to subscribed users first
    if (current_stream_id !== undefined) {
        const a_is_sub = _stream_data__WEBPACK_IMPORTED_MODULE_10__.is_user_subscribed(current_stream_id, person_a.user_id);
        const b_is_sub = _stream_data__WEBPACK_IMPORTED_MODULE_10__.is_user_subscribed(current_stream_id, person_b.user_id);

        if (a_is_sub && !b_is_sub) {
            return -1;
        } else if (!a_is_sub && b_is_sub) {
            return 1;
        }
    }

    // give preference to pm partners if both (are)/(are not) subscribers
    const a_is_partner = _pm_conversations__WEBPACK_IMPORTED_MODULE_7__.is_partner(person_a.user_id);
    const b_is_partner = _pm_conversations__WEBPACK_IMPORTED_MODULE_7__.is_partner(person_b.user_id);

    if (a_is_partner && !b_is_partner) {
        return -1;
    } else if (!a_is_partner && b_is_partner) {
        return 1;
    }

    return tertiary_compare(person_a, person_b);
}

function sort_people_for_relevance(objs, current_stream_name, current_topic) {
    // If sorting for recipientbox typeahead or compose state is private, then current_stream = ""
    let current_stream = false;
    if (current_stream_name) {
        current_stream = _stream_data__WEBPACK_IMPORTED_MODULE_10__.get_sub(current_stream_name);
    }
    if (!current_stream) {
        objs.sort((person_a, person_b) =>
            compare_people_for_relevance(person_a, person_b, compare_by_pms),
        );
    } else {
        const stream_id = current_stream.stream_id;

        objs.sort((person_a, person_b) =>
            compare_people_for_relevance(
                person_a,
                person_b,
                (user_a, user_b) =>
                    _recent_senders__WEBPACK_IMPORTED_MODULE_8__.compare_by_recency(user_a, user_b, stream_id, current_topic),
                current_stream.stream_id,
            ),
        );
    }

    return objs;
}

function compare_by_popularity(lang_a, lang_b) {
    const diff = pygments_data.langs[lang_b].priority - pygments_data.langs[lang_a].priority;
    if (diff !== 0) {
        return diff;
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(lang_a, lang_b);
}

function retain_unique_language_aliases(matches) {
    // We make the typeahead a little more nicer but only showing one alias per language.
    // For example if the user searches for prefix "j", then the typeahead list should contain
    // "javascript" only, and not "js" and "javascript".
    const seen_aliases = new Set();
    const unique_aliases = [];
    for (const lang of matches) {
        // The matched list is already sorted based on popularity and has exact matches
        // at the top, so we don't need to worry about sorting again.
        const canonical_name = pygments_data.langs[lang]?.pretty_name ?? lang;
        if (!seen_aliases.has(canonical_name)) {
            seen_aliases.add(canonical_name);
            unique_aliases.push(lang);
        }
    }
    return unique_aliases;
}

function sort_languages(matches, query) {
    const results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, matches);

    // Languages that start with the query
    results.matches = results.matches.sort(compare_by_popularity);

    // Push exact matches to top.
    const match_index = results.matches.indexOf(query);
    if (match_index > -1) {
        results.matches.splice(match_index, 1);
        results.matches.unshift(query);
    }

    // Languages that have the query somewhere in their name
    results.rest = results.rest.sort(compare_by_popularity);
    return retain_unique_language_aliases(results.matches.concat(results.rest));
}

function sort_recipients({
    users,
    query,
    current_stream,
    current_topic,
    groups = [],
    max_num_items = 20,
}) {
    function sort_relevance(items) {
        return sort_people_for_relevance(items, current_stream, current_topic);
    }

    const users_name_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, users, (p) => p.full_name);

    const email_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, users_name_results.rest, (p) => p.email);

    const groups_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, groups, (g) => g.name);

    const best_users = () => sort_relevance(users_name_results.matches);
    const best_groups = () => groups_results.matches;
    const ok_users = () => sort_relevance(email_results.matches);
    const worst_users = () => sort_relevance(email_results.rest);
    const worst_groups = () => groups_results.rest;

    const getters = [best_users, best_groups, ok_users, worst_users, worst_groups];

    /*
        The following optimization is important for large realms.
        If we know we're only showing 5 suggestions, and we
        get 5 matches from `best_users`, then we want to avoid
        calling the expensive sorts for `ok_users` and `worst_users`,
        since they just get dropped.
    */

    let items = [];

    for (const getter of getters) {
        if (items.length < max_num_items) {
            items = items.concat(getter());
        }
    }

    return items.slice(0, max_num_items);
}

function slash_command_comparator(slash_command_a, slash_command_b) {
    if (slash_command_a.name < slash_command_b.name) {
        return -1;
    } else if (slash_command_a.name > slash_command_b.name) {
        return 1;
    }
    /* istanbul ignore next */
    return 0;
}

function sort_slash_commands(matches, query) {
    // We will likely want to in the future make this sort the
    // just-`/` commands by something approximating usefulness.
    const results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, matches, (x) => x.name);

    results.matches = results.matches.sort(slash_command_comparator);
    results.rest = results.rest.sort(slash_command_comparator);
    return results.matches.concat(results.rest);
}

// Gives stream a score from 0 to 3 based on its activity
function activity_score(sub) {
    let stream_score = 0;
    if (!sub.subscribed) {
        stream_score = -1;
    } else {
        if (sub.pin_to_top) {
            stream_score += 2;
        }
        // Note: A pinned stream may accumulate a 3rd point if it is active
        if (_stream_data__WEBPACK_IMPORTED_MODULE_10__.is_active(sub)) {
            stream_score += 1;
        }
    }
    return stream_score;
}

// Sort streams by ranking them by activity. If activity is equal,
// as defined bv activity_score, decide based on our weekly traffic
// stats.
function compare_by_activity(stream_a, stream_b) {
    let diff = activity_score(stream_b) - activity_score(stream_a);
    if (diff !== 0) {
        return diff;
    }
    diff = (stream_b.stream_weekly_traffic || 0) - (stream_a.stream_weekly_traffic || 0);
    if (diff !== 0) {
        return diff;
    }
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_a.name, stream_b.name);
}

function sort_streams(matches, query) {
    const name_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, matches, (x) => x.name);

    const desc_results = _shared_js_typeahead__WEBPACK_IMPORTED_MODULE_2__.triage(query, name_results.rest, (x) => x.description);

    // Streams that start with the query.
    name_results.matches = name_results.matches.sort(compare_by_activity);
    // Streams with descriptions that start with the query.
    desc_results.matches = desc_results.matches.sort(compare_by_activity);
    // Streams with names and descriptions that don't start with the query.
    desc_results.rest = desc_results.rest.sort(compare_by_activity);

    return name_results.matches.concat(desc_results.matches.concat(desc_results.rest));
}


/***/ }),

/***/ "./static/js/typing_data.js":
/*!**********************************!*\
  !*** ./static/js/typing_data.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_typist": () => (/* binding */ add_typist),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "clear_inbound_timer": () => (/* binding */ clear_inbound_timer),
/* harmony export */   "get_all_typists": () => (/* binding */ get_all_typists),
/* harmony export */   "get_group_typists": () => (/* binding */ get_group_typists),
/* harmony export */   "kickstart_inbound_timer": () => (/* binding */ kickstart_inbound_timer),
/* harmony export */   "remove_typist": () => (/* binding */ remove_typist)
/* harmony export */ });
/* harmony import */ var _muted_users__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./muted_users */ "./static/js/muted_users.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());



// See docs/subsystems/typing-indicators.md for details on typing indicators.

const typist_dct = new Map();
const inbound_timer_dict = new Map();

function clear_for_testing() {
    typist_dct.clear();
    inbound_timer_dict.clear();
}

function to_int(s) {
    return Number.parseInt(s, 10);
}

function get_key(group) {
    const ids = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(group);
    return ids.join(",");
}

function add_typist(group, typist) {
    const key = get_key(group);
    const current = typist_dct.get(key) || [];
    typist = to_int(typist);
    if (!current.includes(typist)) {
        current.push(typist);
    }
    typist_dct.set(key, Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(current));
}

function remove_typist(group, typist) {
    const key = get_key(group);
    let current = typist_dct.get(key) || [];

    typist = to_int(typist);
    if (!current.includes(typist)) {
        return false;
    }

    current = current.filter((user_id) => to_int(user_id) !== to_int(typist));

    typist_dct.set(key, current);
    return true;
}

function get_group_typists(group) {
    const key = get_key(group);
    const user_ids = typist_dct.get(key) || [];
    return _muted_users__WEBPACK_IMPORTED_MODULE_0__.filter_muted_user_ids(user_ids);
}

function get_all_typists() {
    let typists = Array.from(typist_dct.values()).flat();
    typists = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(typists);
    return _muted_users__WEBPACK_IMPORTED_MODULE_0__.filter_muted_user_ids(typists);
}

// The next functions aren't pure data, but it is easy
// enough to mock the setTimeout/clearTimeout functions.
function clear_inbound_timer(group) {
    const key = get_key(group);
    const timer = inbound_timer_dict.get(key);
    if (timer) {
        clearTimeout(timer);
        inbound_timer_dict.set(key, undefined);
    }
}

function kickstart_inbound_timer(group, delay, callback) {
    const key = get_key(group);
    clear_inbound_timer(group);
    const timer = setTimeout(callback, delay);
    inbound_timer_dict.set(key, timer);
}


/***/ }),

/***/ "./static/js/typing_events.js":
/*!************************************!*\
  !*** ./static/js/typing_events.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "display_notification": () => (/* binding */ display_notification),
/* harmony export */   "hide_notification": () => (/* binding */ hide_notification),
/* harmony export */   "render_notifications_for_narrow": () => (/* binding */ render_notifications_for_narrow)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_typing_notifications_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/typing_notifications.hbs */ "./static/templates/typing_notifications.hbs");
/* harmony import */ var _templates_typing_notifications_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_typing_notifications_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _typing_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./typing_data */ "./static/js/typing_data.js");









// See docs/subsystems/typing-indicators.md for details on typing indicators.

// This code handles the inbound side of typing notifications.
// When another user is typing, we process the events here.
//
// We also handle the local event of re-narrowing.
// (For the outbound code, see typing.js.)

// How long before we assume a client has gone away
// and expire its typing status
const TYPING_STARTED_EXPIRY_PERIOD = 15000; // 15s

// If number of users typing exceed this,
// we render "Several people are typing..."
const MAX_USERS_TO_DISPLAY_NAME = 3;

// Note!: There are also timing constants in typing_status.js
// that make typing indicators work.

function get_users_typing_for_narrow() {
    if (!_narrow_state__WEBPACK_IMPORTED_MODULE_2__.narrowed_to_pms()) {
        // Narrow is neither pm-with nor is: private
        return [];
    }

    const first_term = _narrow_state__WEBPACK_IMPORTED_MODULE_2__.operators()[0];
    if (first_term.operator === "pm-with") {
        // Get list of users typing in this conversation
        const narrow_emails_string = first_term.operand;
        // TODO: Create people.emails_strings_to_user_ids.
        const narrow_user_ids_string = _people__WEBPACK_IMPORTED_MODULE_4__.reply_to_to_user_ids_string(narrow_emails_string);
        if (!narrow_user_ids_string) {
            return [];
        }
        const narrow_user_ids = narrow_user_ids_string
            .split(",")
            .map((user_id_string) => Number.parseInt(user_id_string, 10));
        const group = narrow_user_ids.concat([Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())]);
        return _typing_data__WEBPACK_IMPORTED_MODULE_5__.get_group_typists(group);
    }
    // Get all users typing (in all private conversations with current user)
    return _typing_data__WEBPACK_IMPORTED_MODULE_5__.get_all_typists();
}

function render_notifications_for_narrow() {
    const user_ids = get_users_typing_for_narrow();
    const users_typing = user_ids.map((user_id) => _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(user_id));
    const num_of_users_typing = users_typing.length;

    if (num_of_users_typing === 0) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#typing_notifications").hide();
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#typing_notifications").html(
            _templates_typing_notifications_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
                users: users_typing,
                several_users: num_of_users_typing > MAX_USERS_TO_DISPLAY_NAME,
            }),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#typing_notifications").show();
    }
}

function hide_notification(event) {
    const recipients = event.recipients.map((user) => user.user_id);
    recipients.sort();

    _typing_data__WEBPACK_IMPORTED_MODULE_5__.clear_inbound_timer(recipients);

    const removed = _typing_data__WEBPACK_IMPORTED_MODULE_5__.remove_typist(recipients, event.sender.user_id);

    if (removed) {
        render_notifications_for_narrow();
    }
}

function display_notification(event) {
    const recipients = event.recipients.map((user) => user.user_id);
    recipients.sort();

    const sender_id = event.sender.user_id;
    event.sender.name = _people__WEBPACK_IMPORTED_MODULE_4__.get_by_user_id(sender_id).full_name;

    _typing_data__WEBPACK_IMPORTED_MODULE_5__.add_typist(recipients, sender_id);

    render_notifications_for_narrow();

    _typing_data__WEBPACK_IMPORTED_MODULE_5__.kickstart_inbound_timer(recipients, TYPING_STARTED_EXPIRY_PERIOD, () => {
        hide_notification(event);
    });
}


/***/ }),

/***/ "./static/js/ui.js":
/*!*************************!*\
  !*** ./static/js/ui.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_content_element": () => (/* binding */ get_content_element),
/* harmony export */   "get_scroll_element": () => (/* binding */ get_scroll_element),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "replace_emoji_with_text": () => (/* binding */ replace_emoji_with_text),
/* harmony export */   "reset_scrollbar": () => (/* binding */ reset_scrollbar),
/* harmony export */   "restore_compose_cursor": () => (/* binding */ restore_compose_cursor),
/* harmony export */   "set_compose_textarea_handlers": () => (/* binding */ set_compose_textarea_handlers),
/* harmony export */   "show_failed_message_success": () => (/* binding */ show_failed_message_success),
/* harmony export */   "show_message_failed": () => (/* binding */ show_message_failed),
/* harmony export */   "update_starred_view": () => (/* binding */ update_starred_view)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var simplebar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! simplebar */ "./node_modules/simplebar/dist/simplebar.esm.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");






// What, if anything, obscures the home tab?

function replace_emoji_with_text($element) {
    $element.find(".emoji").replaceWith(function () {
        if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).is("img")) {
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).attr("alt");
        }
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).text();
    });
}

function get_content_element($element) {
    const element = $element.expectOne()[0];
    const sb = simplebar__WEBPACK_IMPORTED_MODULE_1__["default"].instances.get(element);
    if (sb) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(sb.getContentElement());
    }
    return $element;
}

function get_scroll_element($element) {
    const element = $element.expectOne()[0];
    const sb = simplebar__WEBPACK_IMPORTED_MODULE_1__["default"].instances.get(element);
    if (sb) {
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(sb.getScrollElement());
    } else if ("simplebar" in element.dataset) {
        // The SimpleBar mutation observer hasn’t processed this element yet.
        // Create the SimpleBar early in case we need to add event listeners.
        return jquery__WEBPACK_IMPORTED_MODULE_0___default()(new simplebar__WEBPACK_IMPORTED_MODULE_1__["default"](element).getScrollElement());
    }
    return $element;
}

function reset_scrollbar($element) {
    const element = $element.expectOne()[0];
    const sb = simplebar__WEBPACK_IMPORTED_MODULE_1__["default"].instances.get(element);
    if (sb) {
        sb.getScrollElement().scrollTop = 0;
    } else {
        element.scrollTop = 0;
    }
}

function update_message_in_all_views(message_id, callback) {
    for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_3__.all_rendered_message_lists()) {
        const $row = msg_list.get_row(message_id);
        if ($row === undefined) {
            // The row may not exist, e.g. if you do an action on a message in
            // a narrowed view
            continue;
        }
        callback($row);
    }
}

function update_starred_view(message_id, new_value) {
    const starred = new_value;

    // Avoid a full re-render, but update the star in each message
    // table in which it is visible.
    update_message_in_all_views(message_id, ($row) => {
        const $elt = $row.find(".star");
        const $star_container = $row.find(".star_container");
        if (starred) {
            $elt.addClass("fa-star").removeClass("fa-star-o");
            $star_container.removeClass("empty-star");
        } else {
            $elt.removeClass("fa-star").addClass("fa-star-o");
            $star_container.addClass("empty-star");
        }
        const title_state = starred ? Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unstar"}) : Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Star"});
        $star_container.attr(
            "data-tippy-content",
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                {defaultMessage: "{starred_status} this message (Ctrl + s)"},
                {starred_status: title_state},
            ),
        );
    });
}

function show_message_failed(message_id, failed_msg) {
    // Failed to send message, so display inline retry/cancel
    update_message_in_all_views(message_id, ($row) => {
        const $failed_div = $row.find(".message_failed");
        $failed_div.toggleClass("notvisible", false);
        $failed_div.find(".failed_text").attr("title", failed_msg);
    });
}

function show_failed_message_success(message_id) {
    // Previously failed message succeeded
    update_message_in_all_views(message_id, ($row) => {
        $row.find(".message_failed").toggleClass("notvisible", true);
    });
}

// Save the compose content cursor position and restore when we
// shift-tab back in (see hotkey.js).
let saved_compose_cursor = 0;

function set_compose_textarea_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").on("blur", function () {
        saved_compose_cursor = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).caret();
    });

    // on the end of the modified-message fade in, remove the fade-in-message class.
    const animationEnd = "webkitAnimationEnd oanimationend msAnimationEnd animationend";
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on(animationEnd, ".fade-in-message", function () {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this).removeClass("fade-in-message");
    });
}

function restore_compose_cursor() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#compose-textarea").trigger("focus").caret(saved_compose_cursor);
}

function initialize() {
    set_compose_textarea_handlers();
}


/***/ }),

/***/ "./static/js/unread.js":
/*!*****************************!*\
  !*** ./static/js/unread.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "calculate_notifiable_count": () => (/* binding */ calculate_notifiable_count),
/* harmony export */   "clear_and_populate_unread_mention_topics": () => (/* binding */ clear_and_populate_unread_mention_topics),
/* harmony export */   "clear_old_unreads_missing": () => (/* binding */ clear_old_unreads_missing),
/* harmony export */   "declare_bankruptcy": () => (/* binding */ declare_bankruptcy),
/* harmony export */   "get_all_msg_ids": () => (/* binding */ get_all_msg_ids),
/* harmony export */   "get_counts": () => (/* binding */ get_counts),
/* harmony export */   "get_missing_topics": () => (/* binding */ get_missing_topics),
/* harmony export */   "get_msg_ids_for_mentions": () => (/* binding */ get_msg_ids_for_mentions),
/* harmony export */   "get_msg_ids_for_private": () => (/* binding */ get_msg_ids_for_private),
/* harmony export */   "get_msg_ids_for_starred": () => (/* binding */ get_msg_ids_for_starred),
/* harmony export */   "get_msg_ids_for_stream": () => (/* binding */ get_msg_ids_for_stream),
/* harmony export */   "get_msg_ids_for_topic": () => (/* binding */ get_msg_ids_for_topic),
/* harmony export */   "get_msg_ids_for_user_ids_string": () => (/* binding */ get_msg_ids_for_user_ids_string),
/* harmony export */   "get_notifiable_count": () => (/* binding */ get_notifiable_count),
/* harmony export */   "get_read_message_ids": () => (/* binding */ get_read_message_ids),
/* harmony export */   "get_topics_with_unread_mentions": () => (/* binding */ get_topics_with_unread_mentions),
/* harmony export */   "get_unread_message_count": () => (/* binding */ get_unread_message_count),
/* harmony export */   "get_unread_message_ids": () => (/* binding */ get_unread_message_ids),
/* harmony export */   "get_unread_messages": () => (/* binding */ get_unread_messages),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "mark_as_read": () => (/* binding */ mark_as_read),
/* harmony export */   "message_unread": () => (/* binding */ message_unread),
/* harmony export */   "messages_read_in_narrow": () => (/* binding */ messages_read_in_narrow),
/* harmony export */   "num_unread_for_stream": () => (/* binding */ num_unread_for_stream),
/* harmony export */   "num_unread_for_topic": () => (/* binding */ num_unread_for_topic),
/* harmony export */   "num_unread_for_user_ids_string": () => (/* binding */ num_unread_for_user_ids_string),
/* harmony export */   "old_unreads_missing": () => (/* binding */ old_unreads_missing),
/* harmony export */   "process_loaded_messages": () => (/* binding */ process_loaded_messages),
/* harmony export */   "process_unread_message": () => (/* binding */ process_unread_message),
/* harmony export */   "set_messages_read_in_narrow": () => (/* binding */ set_messages_read_in_narrow),
/* harmony export */   "stream_has_any_unread_mentions": () => (/* binding */ stream_has_any_unread_mentions),
/* harmony export */   "topic_has_any_unread": () => (/* binding */ topic_has_any_unread),
/* harmony export */   "topic_has_any_unread_mentions": () => (/* binding */ topic_has_any_unread_mentions),
/* harmony export */   "unread_mention_topics": () => (/* binding */ unread_mention_topics),
/* harmony export */   "unread_mentions_counter": () => (/* binding */ unread_mentions_counter),
/* harmony export */   "update_message_for_mention": () => (/* binding */ update_message_for_mention),
/* harmony export */   "update_unread_topics": () => (/* binding */ update_unread_topics)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_topics__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./user_topics */ "./static/js/user_topics.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());













// The unread module tracks the message IDs and locations of the
// user's unread messages.  The tracking is initialized with
// server-provided data of the total set of unread messages in the
// user's history via page_params.unread_msgs (well, it cuts off at
// MAX_UNREAD_MESSAGES unreads for performance reasons).  As a result,
// it can contain many thousands of messages that we don't have full
// data for in `message_store`, so we cannot in general look these
// messages up there.

// See https://zulip.readthedocs.io/en/latest/subsystems/pointer.html
// for more details on how this system is designed.

let messages_read_in_narrow = false;

function set_messages_read_in_narrow(value) {
    messages_read_in_narrow = value;
}

let old_unreads_missing = false;

function clear_old_unreads_missing() {
    old_unreads_missing = false;
}

const unread_mentions_counter = new Set();
const unread_messages = new Set();

// Map with keys of the form "{stream_id}:{topic.toLowerCase()}" and
// values being Sets of message IDs for unread messages mentioning the
// user within that topic. Use `recent_topics_util.get_topic_key` to
// calculate keys.
//
// Functionally a cache; see clear_and_populate_unread_mention_topics
// for how we can refresh it efficiently.
const unread_mention_topics = new Map();

class Bucketer {
    // Maps item_id => bucket_key for items present in a bucket.
    reverse_lookup = new Map();

    constructor(options) {
        this.key_to_bucket = new options.KeyDict();
        this.make_bucket = options.make_bucket;
    }

    clear() {
        this.key_to_bucket.clear();
        this.reverse_lookup.clear();
    }

    add(opts) {
        const bucket_key = opts.bucket_key;
        const item_id = opts.item_id;
        const add_callback = opts.add_callback;

        let bucket = this.key_to_bucket.get(bucket_key);
        if (!bucket) {
            bucket = this.make_bucket();
            this.key_to_bucket.set(bucket_key, bucket);
        }
        if (add_callback) {
            add_callback(bucket, item_id);
        } else {
            bucket.add(item_id);
        }
        this.reverse_lookup.set(item_id, bucket_key);
    }

    delete(item_id) {
        const bucket_key = this.reverse_lookup.get(item_id);
        if (bucket_key) {
            const bucket = this.get_bucket(bucket_key);
            bucket.delete(item_id);
            this.reverse_lookup.delete(item_id);
        }
    }

    get_bucket(bucket_key) {
        return this.key_to_bucket.get(bucket_key);
    }

    keys() {
        return this.key_to_bucket.keys();
    }

    values() {
        return this.key_to_bucket.values();
    }

    [Symbol.iterator]() {
        return this.key_to_bucket[Symbol.iterator]();
    }
}

class UnreadPMCounter {
    bucketer = new Bucketer({
        KeyDict: Map,
        make_bucket: () => new Set(),
    });

    clear() {
        this.bucketer.clear();
    }

    set_pms(pms) {
        for (const obj of pms) {
            const user_ids_string = obj.other_user_id.toString();
            this.set_message_ids(user_ids_string, obj.unread_message_ids);
        }
    }

    set_huddles(huddles) {
        for (const obj of huddles) {
            const user_ids_string = _people__WEBPACK_IMPORTED_MODULE_2__.pm_lookup_key(obj.user_ids_string);
            this.set_message_ids(user_ids_string, obj.unread_message_ids);
        }
    }

    set_message_ids(user_ids_string, unread_message_ids) {
        for (const msg_id of unread_message_ids) {
            this.bucketer.add({
                bucket_key: user_ids_string,
                item_id: msg_id,
            });
        }
    }

    add({message_id, user_ids_string}) {
        if (user_ids_string) {
            this.bucketer.add({
                bucket_key: user_ids_string,
                item_id: message_id,
            });
        }
    }

    delete(message_id) {
        this.bucketer.delete(message_id);
    }

    get_counts() {
        const pm_dict = new Map(); // Hash by user_ids_string -> count
        let total_count = 0;
        for (const [user_ids_string, id_set] of this.bucketer) {
            const count = id_set.size;
            pm_dict.set(user_ids_string, count);
            total_count += count;
        }
        return {
            total_count,
            pm_dict,
        };
    }

    num_unread(user_ids_string) {
        if (!user_ids_string) {
            return 0;
        }

        const bucket = this.bucketer.get_bucket(user_ids_string);

        if (!bucket) {
            return 0;
        }
        return bucket.size;
    }

    get_msg_ids() {
        const ids = [];

        for (const id_set of this.bucketer.values()) {
            for (const id of id_set) {
                ids.push(id);
            }
        }

        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
    }

    get_msg_ids_for_user_ids_string(user_ids_string) {
        if (!user_ids_string) {
            return [];
        }

        const bucket = this.bucketer.get_bucket(user_ids_string);

        if (!bucket) {
            return [];
        }

        const ids = Array.from(bucket);
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
    }
}
const unread_pm_counter = new UnreadPMCounter();

function make_per_stream_bucketer() {
    return new Bucketer({
        KeyDict: Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()), // bucket keys are topics
        make_bucket: () => new Set(),
    });
}

class UnreadTopicCounter {
    bucketer = new Bucketer({
        KeyDict: Map, // bucket keys are stream_ids
        make_bucket: make_per_stream_bucketer,
    });

    clear() {
        this.bucketer.clear();
    }

    set_streams(objs) {
        for (const obj of objs) {
            const stream_id = obj.stream_id;
            const topic = obj.topic;
            const unread_message_ids = obj.unread_message_ids;

            for (const message_id of unread_message_ids) {
                this.add({message_id, stream_id, topic});
            }
        }
    }

    add({message_id, stream_id, topic}) {
        this.bucketer.add({
            bucket_key: stream_id,
            item_id: message_id,
            add_callback(per_stream_bucketer) {
                per_stream_bucketer.add({
                    bucket_key: topic,
                    item_id: message_id,
                });
            },
        });
    }

    delete(msg_id) {
        this.bucketer.delete(msg_id);
    }

    get_counts() {
        const res = {};
        res.stream_unread_messages = 0;
        res.stream_count = new Map(); // hash by stream_id -> count
        for (const [stream_id, per_stream_bucketer] of this.bucketer) {
            // We track unread counts for streams that may be currently
            // unsubscribed.  Since users may re-subscribe, we don't
            // completely throw away the data.  But we do ignore it here,
            // so that callers have a view of the **current** world.
            const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
            if (!sub || !_stream_data__WEBPACK_IMPORTED_MODULE_5__.is_subscribed(stream_id)) {
                continue;
            }

            let stream_count = 0;
            for (const [topic, msgs] of per_stream_bucketer) {
                const topic_count = msgs.size;
                if (!_user_topics__WEBPACK_IMPORTED_MODULE_6__.is_topic_muted(stream_id, topic)) {
                    stream_count += topic_count;
                }
            }
            res.stream_count.set(stream_id, stream_count);
            if (!_stream_data__WEBPACK_IMPORTED_MODULE_5__.is_muted(stream_id)) {
                res.stream_unread_messages += stream_count;
            }
        }

        return res;
    }

    get_missing_topics(opts) {
        /* Clients have essentially complete unread data, but
         * stream_topic_history.is_complete_for_stream_id() can be
         * false. In that situation, this function helps ensure that
         * we include all topics with unread messages in data that.
         *
         * It will return all topics in the provided stream with a
         * nonzero unread count that are not already present in the
         * topic_dict parameter.
         */
        const stream_id = opts.stream_id;
        const topic_dict = opts.topic_dict;

        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);
        if (!per_stream_bucketer) {
            return [];
        }

        let topic_names = Array.from(per_stream_bucketer.keys());

        /* Include topics that have at least one unread. It would likely
         * be better design for buckets to be deleted when emptied. */
        topic_names = topic_names.filter((topic_name) => {
            const messages = Array.from(per_stream_bucketer.get_bucket(topic_name));
            return messages.length > 0;
        });
        /* And aren't already present in topic_dict. */
        topic_names = topic_names.filter((topic_name) => !topic_dict.has(topic_name));

        const result = topic_names.map((topic_name) => {
            const msgs = per_stream_bucketer.get_bucket(topic_name);

            return {
                pretty_name: topic_name,
                message_id: Math.max(...Array.from(msgs)),
            };
        });

        return result;
    }

    get_stream_count(stream_id) {
        let stream_count = 0;

        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);

        if (!per_stream_bucketer) {
            return 0;
        }

        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        for (const [topic, msgs] of per_stream_bucketer) {
            if (sub && !_user_topics__WEBPACK_IMPORTED_MODULE_6__.is_topic_muted(stream_id, topic)) {
                stream_count += msgs.size;
            }
        }

        return stream_count;
    }

    get(stream_id, topic) {
        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);
        if (!per_stream_bucketer) {
            return 0;
        }

        const topic_bucket = per_stream_bucketer.get_bucket(topic);
        if (!topic_bucket) {
            return 0;
        }

        return topic_bucket.size;
    }

    get_msg_ids_for_stream(stream_id) {
        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);

        if (!per_stream_bucketer) {
            return [];
        }

        const ids = [];
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        for (const [topic, id_set] of per_stream_bucketer) {
            if (sub && !_user_topics__WEBPACK_IMPORTED_MODULE_6__.is_topic_muted(stream_id, topic)) {
                for (const id of id_set) {
                    ids.push(id);
                }
            }
        }

        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
    }

    get_msg_ids_for_topic(stream_id, topic) {
        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);
        if (!per_stream_bucketer) {
            return [];
        }

        const topic_bucket = per_stream_bucketer.get_bucket(topic);
        if (!topic_bucket) {
            return [];
        }

        const ids = Array.from(topic_bucket);
        return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
    }

    get_streams_with_unread_mentions() {
        const streams_with_mentions = new Set();
        // Collect the set of streams containing at least one mention.
        // We can do this efficiently, since unread_mentions_counter
        // contains all unread message IDs, and we use stream_ids as
        // bucket keys in our outer bucketer.

        for (const message_id of unread_mentions_counter) {
            const stream_id = this.bucketer.reverse_lookup.get(message_id);
            streams_with_mentions.add(stream_id);
        }

        return streams_with_mentions;
    }

    topic_has_any_unread(stream_id, topic) {
        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);

        if (!per_stream_bucketer) {
            return false;
        }

        const id_set = per_stream_bucketer.get_bucket(topic);
        if (!id_set) {
            return false;
        }

        return id_set.size !== 0;
    }

    get_topics_with_unread_mentions(stream_id) {
        // Returns the set of lower cased topics with unread mentions
        // in the given stream.
        const result = new Set();
        const per_stream_bucketer = this.bucketer.get_bucket(stream_id);

        if (!per_stream_bucketer) {
            return result;
        }

        for (const message_id of unread_mentions_counter) {
            // Because bucket keys in per_stream_bucketer are topics,
            // we can just directly use reverse_lookup to find the
            // topic in this stream containing a given unread message
            // ID. If it's not in this stream, we'll get undefined.
            const topic_match = per_stream_bucketer.reverse_lookup.get(message_id);
            if (topic_match !== undefined) {
                // Important: We lower-case topics here before adding them
                // to this set, to support case-insensitive checks.
                result.add(topic_match.toLowerCase());
            }
        }

        return result;
    }
}
const unread_topic_counter = new UnreadTopicCounter();

function add_message_to_unread_mention_topics(message_id) {
    const message = _message_store__WEBPACK_IMPORTED_MODULE_1__.get(message_id);
    if (message.type !== "stream") {
        return;
    }
    const topic_key = _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__.get_topic_key(message.stream_id, message.topic);
    if (unread_mention_topics.has(topic_key)) {
        unread_mention_topics.get(topic_key).add(message_id);
    }
    unread_mention_topics.set(topic_key, new Set([message_id]));
}

function remove_message_from_unread_mention_topics(message_id) {
    const stream_id = unread_topic_counter.bucketer.reverse_lookup.get(message_id);
    if (!stream_id) {
        // Private messages and messages that were already not unread
        // exit here.
        return;
    }

    const per_stream_bucketer = unread_topic_counter.bucketer.get_bucket(stream_id);
    if (!per_stream_bucketer) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`Could not find per_stream_bucketer for ${message_id}.`);
        return;
    }

    const topic = per_stream_bucketer.reverse_lookup.get(message_id);
    const topic_key = _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__.get_topic_key(stream_id, topic);
    if (unread_mention_topics.has(topic_key)) {
        unread_mention_topics.get(topic_key).delete(message_id);
    }
}

function clear_and_populate_unread_mention_topics() {
    // The unread_mention_topics is an important data structure for
    // efficiently querying whether a given stream/topic pair contains
    // unread mentions.
    //
    // It is effectively a cache, since it can be reconstructed from
    // unread_mentions_counter (IDs for all unread mentions) and
    // unread_topic_counter (Streams/topics for all unread messages).
    //
    // Since this function runs in O(unread mentions) time, we can use
    // it in topic editing code paths where it might be onerous to
    // write custom live-update code; but we should avoid calling it
    // in loops.
    unread_mention_topics.clear();

    for (const message_id of unread_mentions_counter) {
        const stream_id = unread_topic_counter.bucketer.reverse_lookup.get(message_id);
        if (!stream_id) {
            continue;
        }
        const per_stream_bucketer = unread_topic_counter.bucketer.get_bucket(stream_id);
        const topic = per_stream_bucketer.reverse_lookup.get(message_id);
        const topic_key = _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__.get_topic_key(stream_id, topic);
        if (unread_mention_topics.has(topic_key)) {
            unread_mention_topics.get(topic_key).add(message_id);
        }
        unread_mention_topics.set(topic_key, new Set([message_id]));
    }
}

function message_unread(message) {
    if (message === undefined) {
        return false;
    }
    return message.unread;
}

function get_read_message_ids(message_ids) {
    return message_ids.filter((message_id) => !unread_messages.has(message_id));
}

function get_unread_message_ids(message_ids) {
    return message_ids.filter((message_id) => unread_messages.has(message_id));
}

function get_unread_messages(messages) {
    return messages.filter((message) => unread_messages.has(message.id));
}

function get_unread_message_count() {
    return unread_messages.size;
}

function update_unread_topics(msg, event) {
    const new_topic = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event);
    const {new_stream_id} = event;

    if (new_topic === undefined && new_stream_id === undefined) {
        return;
    }

    if (!unread_messages.has(msg.id)) {
        return;
    }

    unread_topic_counter.delete(msg.id);

    unread_topic_counter.add({
        message_id: msg.id,
        stream_id: new_stream_id || msg.stream_id,
        topic: new_topic || msg.topic,
    });
}

function process_loaded_messages(messages, expect_no_new_unreads = false) {
    // Process a set of messages that we have full copies of from the
    // server for whether any are unread but not tracked as such by
    // our data structures. This can occur due to old_unreads_missing,
    // changes in muting configuration, innocent races, or potentially bugs.
    //
    // Returns whether there were any new unread messages; in that
    // case, the caller will need to trigger a rerender of UI
    // displaying unread counts.

    let any_untracked_unread_messages = false;
    for (const message of messages) {
        if (message.unread) {
            if (unread_messages.has(message.id)) {
                // If we're already tracking this message as unread, there's nothing to do.
                continue;
            }

            if (expect_no_new_unreads && !old_unreads_missing) {
                // This may happen due to races, where someone narrows
                // to a view and the message_fetch request returns
                // before server_events system delivers the message to
                // the client.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(`New unread ${message.id} discovered in process_loaded_messages.`);
            }

            const user_ids_string =
                message.type === "private" ? _people__WEBPACK_IMPORTED_MODULE_2__.pm_reply_user_string(message) : undefined;

            process_unread_message({
                id: message.id,
                mentioned: message.mentioned,
                mentioned_me_directly: message.mentioned_me_directly,
                stream_id: message.stream_id,
                topic: message.topic,
                type: message.type,
                unread: true,
                user_ids_string,
            });
            any_untracked_unread_messages = true;
        }
    }

    return any_untracked_unread_messages;
}

function process_unread_message(message) {
    // The `message` here just needs to require certain fields. For example,
    // the "message" may actually be constructed from a Zulip event that doesn't
    // include fields like "content".  The caller must verify that the message
    // is actually unread--we don't defend against that.
    unread_messages.add(message.id);

    if (message.type === "private") {
        unread_pm_counter.add({
            message_id: message.id,
            user_ids_string: message.user_ids_string,
        });
    }

    if (message.type === "stream") {
        unread_topic_counter.add({
            message_id: message.id,
            stream_id: message.stream_id,
            topic: message.topic,
        });
    }

    update_message_for_mention(message);
}

function update_message_for_mention(message, content_edited = false) {
    if (!message.unread) {
        unread_mentions_counter.delete(message.id);
        remove_message_from_unread_mention_topics(message.id);
        return;
    }

    const is_unmuted_mention =
        message.type === "stream" &&
        message.mentioned &&
        !_user_topics__WEBPACK_IMPORTED_MODULE_6__.is_topic_muted(message.stream_id, message.topic);

    if (is_unmuted_mention || message.mentioned_me_directly) {
        unread_mentions_counter.add(message.id);
        add_message_to_unread_mention_topics(message.id);
    } else {
        unread_mentions_counter.delete(message.id);
        remove_message_from_unread_mention_topics(message.id);
    }

    if (content_edited && message.type === "stream") {
        // We only need to update recent topics here if this was a content change in an unread
        // mention, since in other cases recent topics gets rerendered by other functions.
        const topic_key = _recent_topics_util__WEBPACK_IMPORTED_MODULE_4__.get_topic_key(message.stream_id, message.topic);
        _recent_topics_ui__WEBPACK_IMPORTED_MODULE_3__.inplace_rerender(topic_key);
    }
}

function mark_as_read(message_id) {
    // We don't need to check anything about the message, since all
    // the following methods are cheap and work fine even if message_id
    // was never set to unread.
    unread_pm_counter.delete(message_id);

    // Important: This function uses `unread_topic_counter` to look up
    // the stream/topic for this previously unread message, so much
    // happen before the message is removed from that data structure.
    remove_message_from_unread_mention_topics(message_id);
    unread_topic_counter.delete(message_id);
    unread_mentions_counter.delete(message_id);
    unread_messages.delete(message_id);

    const message = _message_store__WEBPACK_IMPORTED_MODULE_1__.get(message_id);
    if (message) {
        message.unread = false;
    }
}

function declare_bankruptcy() {
    // Only used in tests.
    unread_pm_counter.clear();
    unread_topic_counter.clear();
    unread_mentions_counter.clear();
    unread_messages.clear();
    unread_mention_topics.clear();
}

function get_counts() {
    const res = {};

    // Return a data structure with various counts.  This function should be
    // pretty cheap, even if you don't care about all the counts, and you
    // should strive to keep it free of side effects on globals or DOM.
    res.private_message_count = 0;
    res.mentioned_message_count = unread_mentions_counter.size;

    // This sets stream_count, topic_count, and home_unread_messages
    const topic_res = unread_topic_counter.get_counts();
    const streams_with_mentions = unread_topic_counter.get_streams_with_unread_mentions();
    res.home_unread_messages = topic_res.stream_unread_messages;
    res.stream_count = topic_res.stream_count;
    res.streams_with_mentions = Array.from(streams_with_mentions);

    const pm_res = unread_pm_counter.get_counts();
    res.pm_count = pm_res.pm_dict;
    res.private_message_count = pm_res.total_count;
    res.home_unread_messages += pm_res.total_count;

    return res;
}

// Saves us from calling to get_counts() when we can avoid it.
function calculate_notifiable_count(res) {
    let new_message_count = 0;

    const only_show_notifiable =
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const no_notifications =
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) ===
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    if (only_show_notifiable) {
        // DESKTOP_ICON_COUNT_DISPLAY_NOTIFIABLE
        new_message_count = res.mentioned_message_count + res.private_message_count;
    } else if (no_notifications) {
        // DESKTOP_ICON_COUNT_DISPLAY_NONE
        new_message_count = 0;
    } else {
        // DESKTOP_ICON_COUNT_DISPLAY_MESSAGES
        new_message_count = res.home_unread_messages;
    }
    return new_message_count;
}

function get_notifiable_count() {
    const res = get_counts();
    return calculate_notifiable_count(res);
}

function num_unread_for_stream(stream_id) {
    return unread_topic_counter.get_stream_count(stream_id);
}

function num_unread_for_topic(stream_id, topic_name) {
    return unread_topic_counter.get(stream_id, topic_name);
}

function stream_has_any_unread_mentions(stream_id) {
    // This function is somewhat inefficient and thus should not be
    // called in loops, since runs in O(total unread mentions) time.
    const streams_with_mentions = unread_topic_counter.get_streams_with_unread_mentions();
    return streams_with_mentions.has(stream_id);
}

function topic_has_any_unread_mentions(stream_id, topic) {
    // Because this function is called in a loop for every displayed
    // Recent Topics row, it's important for it to run in O(1) time.
    const topic_key = stream_id + ":" + topic.toLowerCase();
    return unread_mention_topics.get(topic_key) && unread_mention_topics.get(topic_key).size > 0;
}

function topic_has_any_unread(stream_id, topic) {
    return unread_topic_counter.topic_has_any_unread(stream_id, topic);
}

function get_topics_with_unread_mentions(stream_id) {
    return unread_topic_counter.get_topics_with_unread_mentions(stream_id);
}

function num_unread_for_user_ids_string(user_ids_string) {
    return unread_pm_counter.num_unread(user_ids_string);
}

function get_msg_ids_for_stream(stream_id) {
    return unread_topic_counter.get_msg_ids_for_stream(stream_id);
}

function get_msg_ids_for_topic(stream_id, topic_name) {
    return unread_topic_counter.get_msg_ids_for_topic(stream_id, topic_name);
}

function get_msg_ids_for_user_ids_string(user_ids_string) {
    return unread_pm_counter.get_msg_ids_for_user_ids_string(user_ids_string);
}

function get_msg_ids_for_private() {
    return unread_pm_counter.get_msg_ids();
}

function get_msg_ids_for_mentions() {
    const ids = Array.from(unread_mentions_counter);

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
}

function get_all_msg_ids() {
    const ids = Array.from(unread_messages);

    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(ids);
}

function get_missing_topics(opts) {
    return unread_topic_counter.get_missing_topics(opts);
}

function get_msg_ids_for_starred() {
    // This is here for API consistency sake--we never
    // have unread starred messages.  (Some day we may ironically
    // want to make starring the same as mark-as-unread, but
    // for now starring === reading.)
    return [];
}

function initialize(params) {
    const unread_msgs = params.unread_msgs;

    old_unreads_missing = unread_msgs.old_unreads_missing;
    unread_pm_counter.set_huddles(unread_msgs.huddles);
    unread_pm_counter.set_pms(unread_msgs.pms);
    unread_topic_counter.set_streams(unread_msgs.streams);

    for (const message_id of unread_msgs.mentions) {
        unread_mentions_counter.add(message_id);
    }
    clear_and_populate_unread_mention_topics();

    for (const obj of unread_msgs.huddles) {
        for (const message_id of obj.unread_message_ids) {
            unread_messages.add(message_id);
        }
    }

    for (const obj of unread_msgs.pms) {
        for (const message_id of obj.unread_message_ids) {
            unread_messages.add(message_id);
        }
    }

    for (const obj of unread_msgs.streams) {
        for (const message_id of obj.unread_message_ids) {
            unread_messages.add(message_id);
        }
    }

    for (const message_id of unread_msgs.mentions) {
        unread_messages.add(message_id);
    }
}


/***/ }),

/***/ "./static/js/unread_ops.js":
/*!*********************************!*\
  !*** ./static/js/unread_ops.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "mark_all_as_read": () => (/* binding */ mark_all_as_read),
/* harmony export */   "mark_as_unread_from_here": () => (/* binding */ mark_as_unread_from_here),
/* harmony export */   "mark_current_list_as_read": () => (/* binding */ mark_current_list_as_read),
/* harmony export */   "mark_pm_as_read": () => (/* binding */ mark_pm_as_read),
/* harmony export */   "mark_stream_as_read": () => (/* binding */ mark_stream_as_read),
/* harmony export */   "mark_topic_as_read": () => (/* binding */ mark_topic_as_read),
/* harmony export */   "notify_server_message_read": () => (/* binding */ notify_server_message_read),
/* harmony export */   "notify_server_messages_read": () => (/* binding */ notify_server_messages_read),
/* harmony export */   "process_read_messages_event": () => (/* binding */ process_read_messages_event),
/* harmony export */   "process_scrolled_to_bottom": () => (/* binding */ process_scrolled_to_bottom),
/* harmony export */   "process_unread_messages_event": () => (/* binding */ process_unread_messages_event),
/* harmony export */   "process_visible": () => (/* binding */ process_visible),
/* harmony export */   "resume_reading": () => (/* binding */ resume_reading)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_flags__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_flags */ "./static/js/message_flags.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _message_live_update__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_live_update */ "./static/js/message_live_update.js");
/* harmony import */ var _message_store__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message_store */ "./static/js/message_store.js");
/* harmony import */ var _message_viewport__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message_viewport */ "./static/js/message_viewport.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _recent_topics_ui__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./recent_topics_ui */ "./static/js/recent_topics_ui.js");
/* harmony import */ var _recent_topics_util__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./recent_topics_util */ "./static/js/recent_topics_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ui__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./unread_ui */ "./static/js/unread_ui.js");



















let loading_indicator_displayed = false;

// We might want to use a slightly smaller batch for the first
// request, because empirically, the first request can be
// significantly slower, likely due to the database warming up its
// cache with your UserMessage rows. We don't do that, just because
// the progress indicator experience of 1000, 3000, etc. feels weird.
const INITIAL_BATCH_SIZE = 1000;
const FOLLOWUP_BATCH_SIZE = 1000;

function mark_all_as_read(args = {}) {
    args = {
        // We use an anchor of "oldest", not "first_unread", because
        // "first_unread" will be the oldest non-muted unread message,
        // which would result in muted unreads older than the first
        // unread not being processed.
        anchor: "oldest",
        messages_read_till_now: 0,
        num_after: INITIAL_BATCH_SIZE,
        ...args,
    };
    const request = {
        anchor: args.anchor,
        // anchor="oldest" is an anchor ID lower than any valid
        // message ID; and follow-up requests will have already
        // processed the anchor ID, so we just want this to be
        // unconditionally false.
        include_anchor: false,
        num_before: 0,
        num_after: args.num_after,
        op: "add",
        flag: "read",
        // Since there's a database index on is:unread, it's a fast
        // search query and thus worth including here as an optimization.
        narrow: JSON.stringify([{operator: "is", operand: "unread", negated: false}]),
    };
    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/messages/flags/narrow",
        data: request,
        success(data) {
            const messages_read_till_now = args.messages_read_till_now + data.updated_count;

            if (!data.found_newest) {
                // If we weren't able to make everything as read in a
                // single API request, then show a loading indicator.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage:
                                "{N, plural, one {Working… {N} message marked as read so far.} other {Working… {N} messages marked as read so far.}}",
                        },
                        {N: messages_read_till_now},
                    ),
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner"),
                );
                if (!loading_indicator_displayed) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner .loading-indicator"),
                        {abs_positioned: true},
                    );
                    loading_indicator_displayed = true;
                }

                mark_all_as_read({
                    anchor: data.last_processed_id,
                    messages_read_till_now,
                    num_after: FOLLOWUP_BATCH_SIZE,
                });
            } else {
                if (loading_indicator_displayed) {
                    // Only show the success message if a progress banner was displayed.
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                            {
                                defaultMessage:
                                    "{N, plural, one {Done! {N} message marked as read.} other {Done! {N} messages marked as read.}}",
                            },
                            {N: messages_read_till_now},
                        ),
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner"),
                        true,
                    );
                    loading_indicator_displayed = false;
                }

                if (_unread__WEBPACK_IMPORTED_MODULE_12__.old_unreads_missing) {
                    // In the rare case that the user had more than
                    // 50K total unreads on the server, the client
                    // won't have known about all of them; this was
                    // communicated to the client via
                    // unread.old_unreads_missing.
                    //
                    // However, since we know we just marked
                    // **everything** as read, we know that we now
                    // have a correct data set of unreads.
                    _unread__WEBPACK_IMPORTED_MODULE_12__.clear_old_unreads_missing();
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Cleared old_unreads_missing after bankruptcy.");
                }
            }
        },
        error(xhr) {
            // If we hit the rate limit, just continue without showing any error.
            if (xhr.responseJSON.code === "RATE_LIMIT_HIT") {
                const milliseconds_to_wait = 1000 * xhr.responseJSON["retry-after"];
                setTimeout(() => mark_all_as_read(args), milliseconds_to_wait);
            } else {
                // TODO: Ideally this would be a ui_report.error();
                // the user needs to know that our operation failed.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Failed to mark messages as read: " + xhr.responseText);
            }
        },
    });
}

function process_newly_read_message(message, options) {
    for (const msg_list of _message_lists__WEBPACK_IMPORTED_MODULE_4__.all_rendered_message_lists()) {
        msg_list.show_message_as_read(message, options);
    }
    _notifications__WEBPACK_IMPORTED_MODULE_8__.close_notification(message);
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_10__.update_topic_unread_count(message);
}

function mark_as_unread_from_here(
    message_id,
    include_anchor = true,
    messages_marked_unread_till_now = 0,
    num_after = INITIAL_BATCH_SIZE - 1,
    narrow,
) {
    if (narrow === undefined) {
        narrow = JSON.stringify(_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.data.filter.operators());
    }
    _message_lists__WEBPACK_IMPORTED_MODULE_4__.current.prevent_reading();
    const opts = {
        anchor: message_id,
        include_anchor,
        num_before: 0,
        num_after,
        narrow,
        op: "remove",
        flag: "read",
    };
    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/messages/flags/narrow",
        data: opts,
        success(data) {
            messages_marked_unread_till_now += data.updated_count;

            if (!data.found_newest) {
                // If we weren't able to complete the request fully in
                // the current batch, show a progress indicator.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage:
                                "{N, plural, one {Working… {N} message marked as unread so far.} other {Working… {N} messages marked as unread so far.}}",
                        },
                        {N: messages_marked_unread_till_now},
                    ),
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner"),
                );
                if (!loading_indicator_displayed) {
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner .loading-indicator"),
                        {abs_positioned: true},
                    );
                    loading_indicator_displayed = true;
                }
                mark_as_unread_from_here(
                    data.last_processed_id,
                    false,
                    messages_marked_unread_till_now,
                    FOLLOWUP_BATCH_SIZE,
                    narrow,
                );
            } else if (loading_indicator_displayed) {
                // If we were showing a loading indicator, then
                // display that we finished. For the common case where
                // the operation succeeds in a single batch, we don't
                // bother distracting the user with the indication;
                // the success will be obvious from the UI updating.
                loading_indicator_displayed = false;
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                        {
                            defaultMessage:
                                "{N, plural, one {Done! {N} message marked as unread.} other {Done! {N} messages marked as unread.}}",
                        },
                        {N: messages_marked_unread_till_now},
                    ),
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#request-progress-status-banner"),
                    true,
                );
            }
        },
        error(xhr) {
            // If we hit the rate limit, just continue without showing any error.
            if (xhr.responseJSON.code === "RATE_LIMIT_HIT") {
                const milliseconds_to_wait = 1000 * xhr.responseJSON["retry-after"];
                setTimeout(
                    () =>
                        mark_as_unread_from_here(
                            message_id,
                            false,
                            messages_marked_unread_till_now,
                            narrow,
                        ),
                    milliseconds_to_wait,
                );
            } else {
                // TODO: Ideally, this case would communicate the
                // failure to the user, with some manual retry
                // offered, since the most likely cause is a 502.
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unexpected error marking messages as unread: " + xhr.responseText);
            }
        },
    });
}

function resume_reading() {
    _message_lists__WEBPACK_IMPORTED_MODULE_4__.current.resume_reading();
}

function process_read_messages_event(message_ids) {
    /*
        This code has a lot in common with notify_server_messages_read,
        but there are subtle differences due to the fact that the
        server can tell us about unread messages that we didn't
        actually read locally (and which we may not have even
        loaded locally).
    */
    const options = {from: "server"};

    message_ids = _unread__WEBPACK_IMPORTED_MODULE_12__.get_unread_message_ids(message_ids);
    if (message_ids.length === 0) {
        return;
    }

    for (const message_id of message_ids) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.narrowed) {
            // I'm not sure this entirely makes sense for all server
            // notifications.
            _unread__WEBPACK_IMPORTED_MODULE_12__.set_messages_read_in_narrow(true);
        }

        _unread__WEBPACK_IMPORTED_MODULE_12__.mark_as_read(message_id);

        const message = _message_store__WEBPACK_IMPORTED_MODULE_6__.get(message_id);

        // TODO: This ends up doing one in-place rerender operation on
        // recent conversations per message, not a single global
        // rerender or one per conversation.
        if (message) {
            process_newly_read_message(message, options);
        }
    }

    _unread_ui__WEBPACK_IMPORTED_MODULE_13__.update_unread_counts();
}

function process_unread_messages_event({message_ids, message_details}) {
    // This is the reverse of  process_unread_messages_event.
    message_ids = _unread__WEBPACK_IMPORTED_MODULE_12__.get_read_message_ids(message_ids);
    if (message_ids.length === 0) {
        return;
    }

    if (_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.narrowed) {
        _unread__WEBPACK_IMPORTED_MODULE_12__.set_messages_read_in_narrow(false);
    }

    for (const message_id of message_ids) {
        const message = _message_store__WEBPACK_IMPORTED_MODULE_6__.get(message_id);

        if (message) {
            message.unread = true;
        }

        const message_info = message_details[message_id];

        let user_ids_string;

        if (message_info.type === "private") {
            user_ids_string = _people__WEBPACK_IMPORTED_MODULE_9__.pm_lookup_key_from_user_ids(message_info.user_ids);
        }

        _unread__WEBPACK_IMPORTED_MODULE_12__.process_unread_message({
            id: message_id,
            mentioned: message_info.mentioned,
            stream_id: message_info.stream_id,
            topic: message_info.topic,
            type: message_info.type,
            unread: true,
            user_ids_string,
        });
    }

    /*
        A batch of messages marked as unread can be 1000+ messages, so
        we do want to do a bulk operation for these UI updates.

        We use a big-hammer approach now to updating the message view.
        This is relatively harmless, since the only time we are called is
        when the user herself marks her message as unread.  But we
        do eventually want to be more surgical here, especially once we
        have a final scheme for how best to structure the HTML within
        the message to indicate read-vs.-unread.  Currently we use a
        green border, but that may change.

        The main downside of doing a full rerender is that it can be
        user-visible in the form of users' avatars flickering.
    */
    _message_live_update__WEBPACK_IMPORTED_MODULE_5__.rerender_messages_view();
    _recent_topics_ui__WEBPACK_IMPORTED_MODULE_10__.complete_rerender();

    if (
        !_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.can_mark_messages_read() &&
        _message_lists__WEBPACK_IMPORTED_MODULE_4__.current.has_unread_messages()
    ) {
        _unread_ui__WEBPACK_IMPORTED_MODULE_13__.notify_messages_remain_unread();
    }

    _unread_ui__WEBPACK_IMPORTED_MODULE_13__.update_unread_counts();
}

// Takes a list of messages and marks them as read.
// Skips any messages that are already marked as read.
function notify_server_messages_read(messages, options = {}) {
    messages = _unread__WEBPACK_IMPORTED_MODULE_12__.get_unread_messages(messages);
    if (messages.length === 0) {
        return;
    }

    _message_flags__WEBPACK_IMPORTED_MODULE_3__.send_read(messages);

    for (const message of messages) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.narrowed) {
            _unread__WEBPACK_IMPORTED_MODULE_12__.set_messages_read_in_narrow(true);
        }

        _unread__WEBPACK_IMPORTED_MODULE_12__.mark_as_read(message.id);
        process_newly_read_message(message, options);
    }

    _unread_ui__WEBPACK_IMPORTED_MODULE_13__.update_unread_counts();
}

function notify_server_message_read(message, options) {
    notify_server_messages_read([message], options);
}

function process_scrolled_to_bottom() {
    if (_recent_topics_util__WEBPACK_IMPORTED_MODULE_11__.is_visible()) {
        // First, verify the current message list is visible.
        return;
    }

    if (_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.can_mark_messages_read()) {
        mark_current_list_as_read();
        return;
    }

    // For message lists that don't support marking messages as read
    // automatically, we display a banner offering to let you mark
    // them as read manually, only if there are unreads present.
    if (_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.has_unread_messages()) {
        _unread_ui__WEBPACK_IMPORTED_MODULE_13__.notify_messages_remain_unread();
    }
}

// If we ever materially change the algorithm for this function, we
// may need to update notifications.received_messages as well.
function process_visible() {
    if (_message_viewport__WEBPACK_IMPORTED_MODULE_7__.is_visible_and_focused() && _message_viewport__WEBPACK_IMPORTED_MODULE_7__.bottom_message_visible()) {
        process_scrolled_to_bottom();
    }
}

function mark_current_list_as_read(options) {
    notify_server_messages_read(_message_lists__WEBPACK_IMPORTED_MODULE_4__.current.all_messages(), options);
}

function mark_stream_as_read(stream_id, cont) {
    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/mark_stream_as_read",
        data: {stream_id},
        success: cont,
    });
}

function mark_topic_as_read(stream_id, topic, cont) {
    _channel__WEBPACK_IMPORTED_MODULE_2__.post({
        url: "/json/mark_topic_as_read",
        data: {stream_id, topic_name: topic},
        success: cont,
    });
}

function mark_pm_as_read(user_ids_string) {
    // user_ids_string is a stringified list of user ids which are
    // participants in the conversation other than the current
    // user. Eg: "123,124" or "123"
    const unread_msg_ids = _unread__WEBPACK_IMPORTED_MODULE_12__.get_msg_ids_for_user_ids_string(user_ids_string);
    _message_flags__WEBPACK_IMPORTED_MODULE_3__.mark_as_read(unread_msg_ids);
}


/***/ }),

/***/ "./static/js/unread_ui.js":
/*!********************************!*\
  !*** ./static/js/unread_ui.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "animate_mention_changes": () => (/* binding */ animate_mention_changes),
/* harmony export */   "hide_mark_as_read_turned_off_banner": () => (/* binding */ hide_mark_as_read_turned_off_banner),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "notify_messages_remain_unread": () => (/* binding */ notify_messages_remain_unread),
/* harmony export */   "reset_mark_as_read_turned_off_banner": () => (/* binding */ reset_mark_as_read_turned_off_banner),
/* harmony export */   "set_count_toggle_button": () => (/* binding */ set_count_toggle_button),
/* harmony export */   "should_display_bankruptcy_banner": () => (/* binding */ should_display_bankruptcy_banner),
/* harmony export */   "update_unread_counts": () => (/* binding */ update_unread_counts)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_mark_as_read_turned_off_banner_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/mark_as_read_turned_off_banner.hbs */ "./static/templates/mark_as_read_turned_off_banner.hbs");
/* harmony import */ var _templates_mark_as_read_turned_off_banner_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_mark_as_read_turned_off_banner_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./notifications */ "./static/js/notifications.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _stream_list__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stream_list */ "./static/js/stream_list.js");
/* harmony import */ var _top_left_corner__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./top_left_corner */ "./static/js/top_left_corner.js");
/* harmony import */ var _topic_list__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./topic_list */ "./static/js/topic_list.js");
/* harmony import */ var _unread__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./unread */ "./static/js/unread.js");
/* harmony import */ var _unread_ops__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./unread_ops */ "./static/js/unread_ops.js");















let last_mention_count = 0;
let user_closed_mark_as_read_turned_off_banner = false;
function hide_mark_as_read_turned_off_banner() {
    // Use visibility instead of hide() to prevent messages on the screen from
    // shifting vertically.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#mark_as_read_turned_off_banner").toggleClass("invisible", true);
}

function reset_mark_as_read_turned_off_banner() {
    hide_mark_as_read_turned_off_banner();
    user_closed_mark_as_read_turned_off_banner = false;
}

function notify_messages_remain_unread() {
    if (!user_closed_mark_as_read_turned_off_banner) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#mark_as_read_turned_off_banner").toggleClass("invisible", false);
    }
}

function do_new_messages_animation($li) {
    $li.addClass("new_messages");
    function mid_animation() {
        $li.removeClass("new_messages");
        $li.addClass("new_messages_fadeout");
    }
    function end_animation() {
        $li.removeClass("new_messages_fadeout");
    }
    setTimeout(mid_animation, 3000);
    setTimeout(end_animation, 6000);
}

function animate_mention_changes($li, new_mention_count) {
    if (new_mention_count > last_mention_count) {
        do_new_messages_animation($li);
    }
    last_mention_count = new_mention_count;
}

function set_count_toggle_button($elem, count) {
    if (count === 0) {
        if ($elem.is(":animated")) {
            return $elem.stop(true, true).hide();
        }
        return $elem.hide(500);
    } else if (count > 0 && count < 1000) {
        $elem.show(500);
        return $elem.text(count);
    }
    $elem.show(500);
    return $elem.text("1k+");
}

function update_unread_counts() {
    // Pure computation:
    const res = _unread__WEBPACK_IMPORTED_MODULE_10__.get_counts();

    // Side effects from here down:
    // This updates some DOM elements directly, so try to
    // avoid excessive calls to this.
    _activity__WEBPACK_IMPORTED_MODULE_2__.update_dom_with_unread_counts(res);
    _top_left_corner__WEBPACK_IMPORTED_MODULE_8__.update_dom_with_unread_counts(res);
    _stream_list__WEBPACK_IMPORTED_MODULE_7__.update_dom_with_unread_counts(res);
    _pm_list__WEBPACK_IMPORTED_MODULE_6__.update_dom_with_unread_counts(res);
    _topic_list__WEBPACK_IMPORTED_MODULE_9__.update();
    const notifiable_unread_count = _unread__WEBPACK_IMPORTED_MODULE_10__.calculate_notifiable_count(res);
    _notifications__WEBPACK_IMPORTED_MODULE_4__.update_unread_counts(notifiable_unread_count, res.private_message_count);

    // Set the unread counts that we show in the buttons that
    // toggle open the sidebar menus when we have a thin window.
    set_count_toggle_button(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#streamlist-toggle-unreadcount"), res.home_unread_messages);
    set_count_toggle_button(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#userlist-toggle-unreadcount"), res.private_message_count);
}

function should_display_bankruptcy_banner() {
    // Until we've handled possibly declaring bankruptcy, don't show
    // unread counts since they only consider messages that are loaded
    // client side and may be different from the numbers reported by
    // the server.

    if (!Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
        // We've never read a message.
        return false;
    }

    const now = Date.now() / 1000;
    if (
        _unread__WEBPACK_IMPORTED_MODULE_10__.get_unread_message_count() > 500 &&
        now - Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) > 60 * 60 * 24 * 2
    ) {
        // 2 days.
        return true;
    }

    return false;
}

function initialize() {
    update_unread_counts();

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#mark_as_read_turned_off_banner").html(_templates_mark_as_read_turned_off_banner_hbs__WEBPACK_IMPORTED_MODULE_1___default()());
    hide_mark_as_read_turned_off_banner();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#mark_view_read").on("click", () => {
        // Mark all messages in the current view as read.
        //
        // BUG: This logic only supports marking messages visible in
        // the present view as read; we need a server API to mark
        // every message matching the current search as read.
        const unread_messages = _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.data.all_messages()
            .filter((message) => _unread__WEBPACK_IMPORTED_MODULE_10__.message_unread(message));
        (0,_unread_ops__WEBPACK_IMPORTED_MODULE_11__.notify_server_messages_read)(unread_messages);
        // New messages received may be marked as read based on narrow type.
        _message_lists__WEBPACK_IMPORTED_MODULE_3__.current.resume_reading();

        hide_mark_as_read_turned_off_banner();
    });
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#mark_as_read_close").on("click", () => {
        hide_mark_as_read_turned_off_banner();
        user_closed_mark_as_read_turned_off_banner = true;
    });
}


/***/ }),

/***/ "./static/js/upload.js":
/*!*****************************!*\
  !*** ./static/js/upload.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "feature_check": () => (/* binding */ feature_check),
/* harmony export */   "get_item": () => (/* binding */ get_item),
/* harmony export */   "get_translated_status": () => (/* binding */ get_translated_status),
/* harmony export */   "hide_upload_status": () => (/* binding */ hide_upload_status),
/* harmony export */   "setup_upload": () => (/* binding */ setup_upload),
/* harmony export */   "show_error_message": () => (/* binding */ show_error_message),
/* harmony export */   "upload_files": () => (/* binding */ upload_files)
/* harmony export */ });
/* harmony import */ var _uppy_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uppy/core */ "./node_modules/@uppy/core/lib/index.js");
/* harmony import */ var _uppy_progress_bar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @uppy/progress-bar */ "./node_modules/@uppy/progress-bar/lib/index.js");
/* harmony import */ var _uppy_xhr_upload__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @uppy/xhr-upload */ "./node_modules/@uppy/xhr-upload/lib/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _compose_actions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./compose_actions */ "./static/js/compose_actions.js");
/* harmony import */ var _compose_state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./compose_state */ "./static/js/compose_state.js");
/* harmony import */ var _compose_ui__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./compose_ui */ "./static/js/compose_ui.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());












// Show the upload button only if the browser supports it.
function feature_check($upload_button) {
    if (window.XMLHttpRequest && new window.XMLHttpRequest().upload) {
        $upload_button.removeClass("notdisplayed");
    }
}

function get_translated_status(file) {
    const status = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Uploading {filename}…"}, {filename: file.name});
    return "[" + status + "]()";
}

function get_item(key, config) {
    if (!config) {
        throw new Error("Missing config");
    }
    if (config.mode === "compose") {
        switch (key) {
            case "textarea":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose-textarea");
            case "send_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose-send-button");
            case "send_status_identifier":
                return "#compose-send-status";
            case "send_status":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose-send-status");
            case "send_status_close_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(".compose-send-status-close");
            case "send_status_message":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose-error-msg");
            case "file_input_identifier":
                return "#compose .file_input";
            case "source":
                return "compose-file-input";
            case "drag_drop_container":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose");
            case "markdown_preview_hide_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()("#compose .undo_markdown_preview");
            default:
                throw new Error(`Invalid key name for mode "${config.mode}"`);
        }
    } else if (config.mode === "edit") {
        if (!config.row) {
            throw new Error("Missing row in config");
        }
        switch (key) {
            case "textarea":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#edit_form_${CSS.escape(config.row)} .message_edit_content`);
            case "send_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#edit_form_${CSS.escape(config.row)} .message_edit_content`)
                    .closest(".message_edit_form")
                    .find(".message_edit_save");
            case "send_status_identifier":
                return `#message-edit-send-status-${CSS.escape(config.row)}`;
            case "send_status":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#message-edit-send-status-${CSS.escape(config.row)}`);
            case "send_status_close_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#message-edit-send-status-${CSS.escape(config.row)}`).find(
                    ".send-status-close",
                );
            case "send_status_message":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#message-edit-send-status-${CSS.escape(config.row)}`).find(".error-msg");
            case "file_input_identifier":
                return `#edit_form_${CSS.escape(config.row)} .file_input`;
            case "source":
                return "message-edit-file-input";
            case "drag_drop_container":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#zfilt${CSS.escape(config.row)} .message_edit_form`);
            case "markdown_preview_hide_button":
                return jquery__WEBPACK_IMPORTED_MODULE_3___default()(`#edit_form_${CSS.escape(config.row)} .undo_markdown_preview`);
            default:
                throw new Error(`Invalid key name for mode "${config.mode}"`);
        }
    } else {
        throw new Error("Invalid upload mode!");
    }
}

function hide_upload_status(config) {
    get_item("send_button", config).prop("disabled", false);
    get_item("send_status", config).removeClass("alert-info").hide();
}

function show_error_message(
    config,
    message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "An unknown error occurred."}),
) {
    get_item("send_button", config).prop("disabled", false);
    get_item("send_status", config).addClass("alert-error").removeClass("alert-info").show();
    get_item("send_status_message", config).text(message);
}

function upload_files(uppy, config, files) {
    if (files.length === 0) {
        return;
    }
    if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === 0) {
        show_error_message(
            config,
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                defaultMessage: "File and image uploads have been disabled for this organization.",
            }),
        );
        return;
    }

    // If we're looking at a markdown preview, switch back to the edit
    // UI.  This is important for all the later logic around focus
    // (etc.) to work correctly.
    //
    // We implement this transition through triggering a click on the
    // toggle button to take advantage of the existing plumbing for
    // handling the compose and edit UIs.
    if (get_item("markdown_preview_hide_button", config).is(":visible")) {
        get_item("markdown_preview_hide_button", config).trigger("click");
    }

    get_item("send_button", config).prop("disabled", true);
    get_item("send_status", config).addClass("alert-info").removeClass("alert-error").show();
    get_item("send_status_message", config).html(jquery__WEBPACK_IMPORTED_MODULE_3___default()("<p>").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Uploading…"})));
    get_item("send_status_close_button", config).one("click", () => {
        for (const file of uppy.getFiles()) {
            _compose_ui__WEBPACK_IMPORTED_MODULE_6__.replace_syntax(
                get_translated_status(file),
                "",
                get_item("textarea", config),
            );
        }
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea(get_item("textarea", config));
        uppy.cancelAll();
        get_item("textarea", config).trigger("focus");
        setTimeout(() => {
            hide_upload_status(config);
        }, 500);
    });

    for (const file of files) {
        try {
            _compose_ui__WEBPACK_IMPORTED_MODULE_6__.insert_syntax_and_focus(
                get_translated_status(file),
                get_item("textarea", config),
            );
            _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea(get_item("textarea", config));
            uppy.addFile({
                source: get_item("source", config),
                name: file.name,
                type: file.type,
                data: file,
            });
        } catch {
            // Errors are handled by info-visible and upload-error event callbacks.
            break;
        }
    }
}

function setup_upload(config) {
    const uppy = new _uppy_core__WEBPACK_IMPORTED_MODULE_0__.Uppy({
        debug: false,
        autoProceed: true,
        restrictions: {
            maxFileSize: Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) * 1024 * 1024,
        },
        locale: {
            strings: {
                exceedsSize: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {
                        defaultMessage:
                            "%'{file}' exceeds the maximum file size for attachments ({variable} MB).",
                    },
                    {variable: `${Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())}`},
                ),
                failedToUpload: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Failed to upload %'{file}'"}),
            },
        },
    });
    uppy.setMeta({
        csrfmiddlewaretoken: Object(function webpackMissingModule() { var e = new Error("Cannot find module './csrf'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()),
    });
    uppy.use(_uppy_xhr_upload__WEBPACK_IMPORTED_MODULE_2__["default"], {
        endpoint: "/json/user_uploads",
        formData: true,
        fieldName: "file",
        // Number of concurrent uploads
        limit: 5,
        locale: {
            strings: {
                timedOut: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({
                    defaultMessage: "Upload stalled for %'{seconds}' seconds, aborting.",
                }),
            },
        },
    });

    uppy.use(_uppy_progress_bar__WEBPACK_IMPORTED_MODULE_1__["default"], {
        target: get_item("send_status_identifier", config),
        hideAfterFinish: false,
    });

    jquery__WEBPACK_IMPORTED_MODULE_3___default()("body").on("change", get_item("file_input_identifier", config), (event) => {
        const files = event.target.files;
        upload_files(uppy, config, files);
        get_item("textarea", config).trigger("focus");
        event.target.value = "";
    });

    const $drag_drop_container = get_item("drag_drop_container", config);
    $drag_drop_container.on("dragover", (event) => event.preventDefault());
    $drag_drop_container.on("dragenter", (event) => event.preventDefault());

    $drag_drop_container.on("drop", (event) => {
        event.preventDefault();
        const files = event.originalEvent.dataTransfer.files;
        upload_files(uppy, config, files);
    });

    $drag_drop_container.on("paste", (event) => {
        const clipboard_data = event.clipboardData || event.originalEvent.clipboardData;
        if (!clipboard_data) {
            return;
        }
        const items = clipboard_data.items;
        const files = [];
        for (const item of items) {
            if (item.kind !== "file") {
                continue;
            }
            const file = item.getAsFile();
            files.push(file);
        }
        upload_files(uppy, config, files);
    });

    uppy.on("upload-success", (file, response) => {
        const uri = response.body.uri;
        if (uri === undefined) {
            return;
        }
        const split_uri = uri.split("/");
        const filename = split_uri.at(-1);
        if (config.mode === "compose" && !_compose_state__WEBPACK_IMPORTED_MODULE_5__.composing()) {
            _compose_actions__WEBPACK_IMPORTED_MODULE_4__.start("stream");
        }
        const filename_uri = "[" + filename + "](" + uri + ")";
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.replace_syntax(
            get_translated_status(file),
            filename_uri,
            get_item("textarea", config),
        );
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea(get_item("textarea", config));
    });

    uppy.on("complete", () => {
        let uploads_in_progress = false;
        for (const file of uppy.getFiles()) {
            if (file.progress.uploadComplete) {
                // The uploaded files should be removed since uppy don't allow files in the store
                // to be re-uploaded again.
                uppy.removeFile(file.id);
            } else {
                // Happens when user tries to upload files when there is already an existing batch
                // being uploaded. So when the first batch of files complete, the second batch would
                // still be in progress.
                uploads_in_progress = true;
            }
        }

        const has_errors = get_item("send_status", config).hasClass("alert-error");
        if (!uploads_in_progress && !has_errors) {
            setTimeout(() => {
                hide_upload_status(config);
            }, 500);
        }
    });

    uppy.on("info-visible", () => {
        // Uppy's `info-visible` event is issued after prepending the
        // notice details into the list of event events accessed via
        // uppy.getState().info. Extract the notice details so that we
        // can potentially act on the error.
        //
        // TODO: Ideally, we'd be using the `.error()` hook or
        // something, not parsing error message strings.
        const info = uppy.getState().info[0];
        if (info.type === "error" && info.message === "No Internet connection") {
            // server_events already handles the case of no internet.
            return;
        }

        if (info.type === "error" && info.details === "Upload Error") {
            // The server errors come under 'Upload Error'. But we can't handle them
            // here because info object don't contain response.body.msg received from
            // the server. Server errors are hence handled by on('upload-error').
            return;
        }

        if (info.type === "error") {
            // The remaining errors are mostly frontend errors like file being too large
            // for upload.
            uppy.cancelAll();
            show_error_message(config, info.message);
        }
    });

    uppy.on("upload-error", (file, error, response) => {
        const message = response ? response.body.msg : undefined;
        uppy.cancelAll();
        show_error_message(config, message);
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.replace_syntax(get_translated_status(file), "", get_item("textarea", config));
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea(get_item("textarea", config));
    });

    uppy.on("restriction-failed", (file) => {
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.replace_syntax(get_translated_status(file), "", get_item("textarea", config));
        _compose_ui__WEBPACK_IMPORTED_MODULE_6__.autosize_textarea(get_item("textarea", config));
    });

    return uppy;
}


/***/ }),

/***/ "./static/js/user_events.js":
/*!**********************************!*\
  !*** ./static/js/user_events.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "update_person": () => (/* binding */ update_person)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _activity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./activity */ "./static/js/activity.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _compose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./compose */ "./static/js/compose.js");
/* harmony import */ var _gear_menu__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./gear_menu */ "./static/js/gear_menu.js");
/* harmony import */ var _message_live_update__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message_live_update */ "./static/js/message_live_update.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _pm_list__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./pm_list */ "./static/js/pm_list.js");
/* harmony import */ var _settings_account__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_account */ "./static/js/settings_account.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_linkifiers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./settings_linkifiers */ "./static/js/settings_linkifiers.js");
/* harmony import */ var _settings_org__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./settings_org */ "./static/js/settings_org.js");
/* harmony import */ var _settings_profile_fields__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./settings_profile_fields */ "./static/js/settings_profile_fields.js");
/* harmony import */ var _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./settings_realm_user_settings_defaults */ "./static/js/settings_realm_user_settings_defaults.js");
/* harmony import */ var _settings_streams__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./settings_streams */ "./static/js/settings_streams.js");
/* harmony import */ var _settings_users__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_users */ "./static/js/settings_users.js");
// This module is kind of small, but it will help us keep
// server_events.js simple while breaking some circular
// dependencies that existed when this code was in people.js.
// (We should do bot updates here too.)




















const update_person = function update(person) {
    const person_obj = _people__WEBPACK_IMPORTED_MODULE_7__.get_by_user_id(person.user_id);

    if (!person_obj) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Got update_person event for unexpected user " + person.user_id);
        return;
    }

    if (Object.hasOwn(person, "new_email")) {
        const user_id = person.user_id;
        const new_email = person.new_email;

        _narrow_state__WEBPACK_IMPORTED_MODULE_6__.update_email(user_id, new_email);
        _compose__WEBPACK_IMPORTED_MODULE_3__.update_email(user_id, new_email);

        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = new_email;
        }

        _people__WEBPACK_IMPORTED_MODULE_7__.update_email(user_id, new_email);
    }

    if (Object.hasOwn(person, "delivery_email")) {
        const delivery_email = person.delivery_email;

        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id)) {
            _settings_account__WEBPACK_IMPORTED_MODULE_9__.update_email(delivery_email);
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = delivery_email;
            _settings_account__WEBPACK_IMPORTED_MODULE_9__.hide_confirm_email_banner();
        }
    }

    if (Object.hasOwn(person, "full_name")) {
        _people__WEBPACK_IMPORTED_MODULE_7__.set_full_name(person_obj, person.full_name);

        _settings_users__WEBPACK_IMPORTED_MODULE_15__.update_user_data(person.user_id, person);
        _activity__WEBPACK_IMPORTED_MODULE_1__.redraw();
        _message_live_update__WEBPACK_IMPORTED_MODULE_5__.update_user_full_name(person.user_id, person.full_name);
        _pm_list__WEBPACK_IMPORTED_MODULE_8__.update_private_messages();
        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person.full_name;
            _settings_account__WEBPACK_IMPORTED_MODULE_9__.update_full_name(person.full_name);
        }
    }

    if (Object.hasOwn(person, "role")) {
        person_obj.role = person.role;
        person_obj.is_owner = person.role === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        person_obj.is_admin =
            person.role === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) || person_obj.is_owner;
        person_obj.is_guest = person.role === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        person_obj.is_moderator = person.role === Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_config'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
        _settings_users__WEBPACK_IMPORTED_MODULE_15__.update_user_data(person.user_id, person);

        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id) && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== person_obj.is_owner) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person_obj.is_owner;
            _settings_org__WEBPACK_IMPORTED_MODULE_11__.maybe_disable_widgets();
        }

        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id) && Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== person_obj.is_admin) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person_obj.is_admin;
            _gear_menu__WEBPACK_IMPORTED_MODULE_4__.update_org_settings_menu_item();
            _settings_linkifiers__WEBPACK_IMPORTED_MODULE_10__.maybe_disable_widgets();
            _settings_org__WEBPACK_IMPORTED_MODULE_11__.maybe_disable_widgets();
            _settings_profile_fields__WEBPACK_IMPORTED_MODULE_12__.maybe_disable_widgets();
            _settings_streams__WEBPACK_IMPORTED_MODULE_14__.maybe_disable_widgets();
            _settings_realm_user_settings_defaults__WEBPACK_IMPORTED_MODULE_13__.maybe_disable_widgets();
        }

        if (
            _people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id) &&
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) !== person_obj.is_moderator
        ) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person_obj.is_moderator;
        }
    }

    if (Object.hasOwn(person, "is_billing_admin")) {
        person_obj.is_billing_admin = person.is_billing_admin;
        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person_obj.is_billing_admin;
        }
    }

    if (Object.hasOwn(person, "avatar_url")) {
        const url = person.avatar_url;
        person_obj.avatar_url = url;
        person_obj.avatar_version = person.avatar_version;

        if (_people__WEBPACK_IMPORTED_MODULE_7__.is_my_user_id(person.user_id)) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person.avatar_source;
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = url;
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) = person.avatar_url_medium;
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-avatar-upload-widget .image-block").attr("src", person.avatar_url_medium);
        }

        _message_live_update__WEBPACK_IMPORTED_MODULE_5__.update_avatar(person_obj.user_id, person.avatar_url);
    }

    if (Object.hasOwn(person, "custom_profile_field")) {
        _people__WEBPACK_IMPORTED_MODULE_7__.set_custom_profile_field_data(person.user_id, person.custom_profile_field);
    }

    if (Object.hasOwn(person, "timezone")) {
        person_obj.timezone = person.timezone;
    }

    if (Object.hasOwn(person, "bot_owner_id")) {
        person_obj.bot_owner_id = person.bot_owner_id;
    }
};


/***/ }),

/***/ "./static/js/user_group_create.js":
/*!****************************************!*\
  !*** ./static/js/user_group_create.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "create_user_group_clicked": () => (/* binding */ create_user_group_clicked),
/* harmony export */   "set_up_handlers": () => (/* binding */ set_up_handlers),
/* harmony export */   "show_new_user_group_modal": () => (/* binding */ show_new_user_group_modal)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_group_create_members__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./user_group_create_members */ "./static/js/user_group_create_members.js");
/* harmony import */ var _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./user_group_create_members_data */ "./static/js/user_group_create_members_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_groups_settings_ui__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user_groups_settings_ui */ "./static/js/user_groups_settings_ui.js");












class UserGroupMembershipError {
    report_no_members_to_user_group() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_membership_error").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "You cannot create a user_group with no members!"}),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_membership_error").show();
    }

    clear_errors() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_membership_error").hide();
    }
}
const user_group_membership_error = new UserGroupMembershipError();

class UserGroupNameError {
    report_already_exists() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name_error").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "A user group with this name already exists"}),
        );
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name_error").show();
    }

    clear_errors() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name_error").hide();
    }

    report_empty_user_group() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name_error").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "A user group needs to have a name"}));
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_name_error").show();
    }

    select() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").trigger("focus").trigger("select");
    }

    pre_validate(user_group_name) {
        if (user_group_name && Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_group_name)) {
            this.report_already_exists();
            return;
        }

        this.clear_errors();
    }

    validate_for_submit(user_group_name) {
        if (!user_group_name) {
            this.report_empty_user_group();
            this.select();
            return false;
        }

        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user_group_name)) {
            this.report_already_exists();
            this.select();
            return false;
        }

        return true;
    }
}
const user_group_name_error = new UserGroupNameError();

function create_user_group_clicked() {
    // this changes the tab switcher (settings/preview) which isn't necessary
    // to a add new stream title.
    _user_groups_settings_ui__WEBPACK_IMPORTED_MODULE_5__.show_user_group_settings_pane.create_user_group();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".group-row.active").removeClass("active");

    show_new_user_group_modal();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").trigger("focus");
}

function clear_error_display() {
    user_group_name_error.clear_errors();
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user_group_create_info").hide();
    user_group_membership_error.clear_errors();
}

function show_new_user_group_modal() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-group-creation").removeClass("hide");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right .settings").hide();

    _user_group_create_members__WEBPACK_IMPORTED_MODULE_3__.build_widgets();

    clear_error_display();
}

function create_user_group() {
    const data = {};
    const group_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").val().trim();
    const description = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_description").val().trim();

    // Even though we already check to make sure that while typing the user cannot enter
    // newline characters (by pressing the Enter key) it would still be possible to copy
    // and paste over a description with newline characters in it. Prevent that.
    if (description.includes("\n")) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "The group description cannot contain newline characters."}),
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user_group_create_info"),
        );
        return undefined;
    }
    data.name = group_name;
    data.description = description;

    const user_ids = _user_group_create_members__WEBPACK_IMPORTED_MODULE_3__.get_principals();
    data.members = JSON.stringify(user_ids);

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_creating_indicator"), {
        text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Creating group..."}),
    });

    return _channel__WEBPACK_IMPORTED_MODULE_1__.post({
        url: "/json/user_groups/create",
        data,
        success() {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").val("");
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_description").val("");
            _user_group_create_members__WEBPACK_IMPORTED_MODULE_3__.clear_member_list();
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User group successfully created!"}),
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user_group_create_info"),
            );
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_creating_indicator"));
            // TODO: The rest of the work should be done via the create event we will get for user group.
        },
        error(xhr) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Error creating user group."}),
                xhr,
                jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user_group_create_info"),
            );
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './loading'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_group_creating_indicator"));
        },
    });
}

function set_up_handlers() {
    const $people_to_add_holder = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add_in_group").expectOne();
    _user_group_create_members__WEBPACK_IMPORTED_MODULE_3__.create_handlers($people_to_add_holder);

    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-group-creation").expectOne();

    $container.on("click", ".finalize_create_user_group", (e) => {
        e.preventDefault();
        clear_error_display();

        const group_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").val().trim();
        const name_ok = user_group_name_error.validate_for_submit(group_name);

        if (!name_ok) {
            return;
        }

        const principals = _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_4__.get_principals();
        if (principals.length === 0) {
            user_group_membership_error.report_no_members_to_user_group();
            return;
        }

        create_user_group();
    });

    $container.on("input", "#create_user_group_name", () => {
        const user_group_name = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").val().trim();

        // This is an inexpensive check.
        user_group_name_error.pre_validate(user_group_name);
    });

    // Do not allow the user to enter newline characters while typing out the
    // group's description during it's creation.
    $container.on("keydown", "#create_user_group_description", (e) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(e)) {
            e.preventDefault();
        }
    });
}


/***/ }),

/***/ "./static/js/user_group_create_members.js":
/*!************************************************!*\
  !*** ./static/js/user_group_create_members.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "build_widgets": () => (/* binding */ build_widgets),
/* harmony export */   "clear_member_list": () => (/* binding */ clear_member_list),
/* harmony export */   "create_handlers": () => (/* binding */ create_handlers),
/* harmony export */   "get_principals": () => (/* binding */ get_principals)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/stream_settings/new_stream_user.hbs */ "./static/templates/stream_settings/new_stream_user.hbs");
/* harmony import */ var _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_user_group_settings_new_user_group_users_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/user_group_settings/new_user_group_users.hbs */ "./static/templates/user_group_settings/new_user_group_users.hbs");
/* harmony import */ var _templates_user_group_settings_new_user_group_users_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_settings_new_user_group_users_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./add_subscribers_pill */ "./static/js/add_subscribers_pill.js");
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user_group_create_members_data */ "./static/js/user_group_create_members_data.js");












let pill_widget;
let all_users_list_widget;

function get_principals() {
    return _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.get_principals();
}

function redraw_member_list() {
    all_users_list_widget.replace_list_data(_user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.sorted_user_ids());
}

function add_user_ids(user_ids) {
    _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.add_user_ids(user_ids);
    redraw_member_list();
}

function add_all_users() {
    const user_ids = _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.get_all_user_ids();
    add_user_ids(user_ids);
}

function remove_user_ids(user_ids) {
    _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.remove_user_ids(user_ids);
    redraw_member_list();
}

function clear_member_list() {
    _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.initialize_with_current_user();
    redraw_member_list();
}

function build_pill_widget({$parent_container}) {
    const $pill_container = $parent_container.find(".pill-container");
    const get_potential_members = _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.get_potential_members;

    pill_widget = _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__.create({
        $pill_container,
        get_potential_subscribers: get_potential_members,
    });
}

function create_handlers($container) {
    $container.on("click", ".add_all_users_to_user_group", (e) => {
        e.preventDefault();
        add_all_users();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".add-user-list-filter").trigger("focus");
    });

    $container.on("click", ".remove_potential_subscriber", (e) => {
        e.preventDefault();
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target);
        const user_id = Number.parseInt($elem.attr("data-user-id"), 10);
        remove_user_ids([user_id]);
    });

    function add_users({pill_user_ids}) {
        add_user_ids(pill_user_ids);
        pill_widget.clear();
    }

    _add_subscribers_pill__WEBPACK_IMPORTED_MODULE_3__.set_up_handlers({
        get_pill_widget: () => pill_widget,
        $parent_container: $container,
        pill_selector: ".add_subscribers_container .input",
        button_selector: ".add_subscribers_container button.add-subscriber-button",
        action: add_users,
    });
}

function build_widgets() {
    const $add_people_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add_in_group");
    $add_people_container.html(_templates_user_group_settings_new_user_group_users_hbs__WEBPACK_IMPORTED_MODULE_2___default()({}));

    const $simplebar_container = $add_people_container.find(".member_list_container");

    build_pill_widget({$parent_container: $add_people_container});

    _user_group_create_members_data__WEBPACK_IMPORTED_MODULE_7__.initialize_with_current_user();
    const current_user_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

    all_users_list_widget = _list_widget__WEBPACK_IMPORTED_MODULE_4__.create(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_members"), [current_user_id], {
        name: "new_user_group_add_users",
        $parent_container: $add_people_container,
        modifier(user_id) {
            const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
            const item = {
                show_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
                email: _people__WEBPACK_IMPORTED_MODULE_6__.get_visible_email(user),
                user_id,
                full_name: user.full_name,
                is_current_user: user_id === current_user_id,
                disabled: user_id === current_user_id,
            };
            return _templates_stream_settings_new_stream_user_hbs__WEBPACK_IMPORTED_MODULE_1___default()(item);
        },
        filter: {
            $element: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#people_to_add_in_group .add-user-list-filter"),
            predicate(user_id, search_term) {
                const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
                return _people__WEBPACK_IMPORTED_MODULE_6__.build_person_matcher(search_term)(user);
            },
        },
        $simplebar_container,
        html_selector(user_id) {
            const user = _people__WEBPACK_IMPORTED_MODULE_6__.get_by_user_id(user_id);
            return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${CSS.escape("user_checkbox_" + user.user_id)}`);
        },
    });
}


/***/ }),

/***/ "./static/js/user_group_create_members_data.js":
/*!*****************************************************!*\
  !*** ./static/js/user_group_create_members_data.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_user_ids": () => (/* binding */ add_user_ids),
/* harmony export */   "get_all_user_ids": () => (/* binding */ get_all_user_ids),
/* harmony export */   "get_potential_members": () => (/* binding */ get_potential_members),
/* harmony export */   "get_principals": () => (/* binding */ get_principals),
/* harmony export */   "initialize_with_current_user": () => (/* binding */ initialize_with_current_user),
/* harmony export */   "remove_user_ids": () => (/* binding */ remove_user_ids),
/* harmony export */   "sorted_user_ids": () => (/* binding */ sorted_user_ids)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./people */ "./static/js/people.js");



let user_id_set;

function initialize_with_current_user() {
    const current_user_id = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    user_id_set = new Set();
    user_id_set.add(current_user_id);
}

function sorted_user_ids() {
    const users = _people__WEBPACK_IMPORTED_MODULE_1__.get_users_from_ids(Array.from(user_id_set));
    _people__WEBPACK_IMPORTED_MODULE_1__.sort_but_pin_current_user_on_top(users);
    return users.map((user) => user.user_id);
}

function get_all_user_ids() {
    const potential_members = _people__WEBPACK_IMPORTED_MODULE_1__.get_realm_users();
    const user_ids = potential_members.map((user) => user.user_id);
    // sort for determinism
    user_ids.sort((a, b) => a - b);
    return user_ids;
}

function get_principals() {
    // Return list of user ids which were selected by user.
    return Array.from(user_id_set);
}

function get_potential_members() {
    const potential_members = _people__WEBPACK_IMPORTED_MODULE_1__.get_realm_users();
    return potential_members.filter((user) => !user_id_set.has(user.user_id));
}

function add_user_ids(user_ids) {
    for (const user_id of user_ids) {
        if (!user_id_set.has(user_id)) {
            const user = _people__WEBPACK_IMPORTED_MODULE_1__.get_by_user_id(user_id);
            if (user) {
                user_id_set.add(user_id);
            }
        }
    }
}

function remove_user_ids(user_ids) {
    for (const user_id of user_ids) {
        user_id_set.delete(user_id);
    }
}


/***/ }),

/***/ "./static/js/user_group_pill.js":
/*!**************************************!*\
  !*** ./static/js/user_group_pill.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "append_user_group": () => (/* binding */ append_user_group),
/* harmony export */   "create_item_from_group_name": () => (/* binding */ create_item_from_group_name),
/* harmony export */   "filter_taken_groups": () => (/* binding */ filter_taken_groups),
/* harmony export */   "get_group_ids": () => (/* binding */ get_group_ids),
/* harmony export */   "get_group_name_from_item": () => (/* binding */ get_group_name_from_item),
/* harmony export */   "get_user_ids": () => (/* binding */ get_user_ids),
/* harmony export */   "typeahead_source": () => (/* binding */ typeahead_source)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());


function display_pill(group) {
    return group.name + ": " + group.members.size + " users";
}

function create_item_from_group_name(group_name, current_items) {
    group_name = group_name.trim();
    const group = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(group_name);
    if (!group) {
        return undefined;
    }

    const in_current_items = current_items.find((item) => item.id === group.id);
    if (in_current_items !== undefined) {
        return undefined;
    }

    const item = {
        type: "user_group",
        display_value: display_pill(group),
        id: group.id,
        group_name: group.name,
    };

    return item;
}

function get_group_name_from_item(item) {
    return item.group_name;
}

function get_user_ids_from_user_groups(items) {
    let user_ids = [];
    const group_ids = items.map((item) => item.id).filter(Boolean);
    for (const group_id of group_ids) {
        const user_group = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(group_id);
        user_ids = user_ids.concat(Array.from(user_group.members));
    }
    return user_ids;
}

function get_user_ids(pill_widget) {
    const items = pill_widget.items();
    let user_ids = get_user_ids_from_user_groups(items);
    user_ids = Array.from(new Set(user_ids));
    user_ids.sort((a, b) => a - b);

    user_ids = user_ids.filter(Boolean);
    return user_ids;
}

function append_user_group(group, pill_widget) {
    if (group !== undefined && group !== null) {
        pill_widget.appendValidatedData({
            type: "user_group",
            display_value: display_pill(group),
            id: group.id,
        });
        pill_widget.clear_text();
    }
}

function get_group_ids(pill_widget) {
    const items = pill_widget.items();
    let group_ids = items.map((item) => item.id);
    group_ids = group_ids.filter(Boolean);

    return group_ids;
}

function filter_taken_groups(items, pill_widget) {
    const taken_group_ids = get_group_ids(pill_widget);
    items = items.filter((item) => !taken_group_ids.includes(item.id));
    return items;
}

function typeahead_source(pill_widget) {
    const groups = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    return filter_taken_groups(groups, pill_widget);
}


/***/ }),

/***/ "./static/js/user_groups_settings_ui.js":
/*!**********************************************!*\
  !*** ./static/js/user_groups_settings_ui.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "change_state": () => (/* binding */ change_state),
/* harmony export */   "do_open_create_user_group": () => (/* binding */ do_open_create_user_group),
/* harmony export */   "get_active_data": () => (/* binding */ get_active_data),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "launch": () => (/* binding */ launch),
/* harmony export */   "open_create_user_group": () => (/* binding */ open_create_user_group),
/* harmony export */   "row_for_group_id": () => (/* binding */ row_for_group_id),
/* harmony export */   "set_up_click_handlers": () => (/* binding */ set_up_click_handlers),
/* harmony export */   "setup_page": () => (/* binding */ setup_page),
/* harmony export */   "show_user_group_settings_pane": () => (/* binding */ show_user_group_settings_pane),
/* harmony export */   "switch_to_group_row": () => (/* binding */ switch_to_group_row)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_user_group_settings_browse_user_groups_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/user_group_settings/browse_user_groups_list_item.hbs */ "./static/templates/user_group_settings/browse_user_groups_list_item.hbs");
/* harmony import */ var _templates_user_group_settings_browse_user_groups_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_settings_browse_user_groups_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_user_group_settings_user_group_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/user_group_settings/user_group_settings_overlay.hbs */ "./static/templates/user_group_settings/user_group_settings_overlay.hbs");
/* harmony import */ var _templates_user_group_settings_user_group_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_settings_user_group_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_2__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _scroll_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./scroll_util */ "./static/js/scroll_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui */ "./static/js/ui.js");
/* harmony import */ var _user_group_create__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./user_group_create */ "./static/js/user_group_create.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());

















function set_up_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay").on("click", ".left #clear_search_group_name", (e) => {
        const $input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay .left #search_group_name");
        $input.val("");

        // This is a hack to rerender complete
        // stream list once the text is cleared.
        $input.trigger("input");

        e.stopPropagation();
        e.preventDefault();
    });
}

const show_user_group_settings_pane = {
    nothing_selected() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings, #user-group-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".nothing-selected").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay .user-group-info-title").text(
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User group settings"}),
        );
    },
    settings(group) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".settings, #user-group-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay .settings").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay .user-group-info-title").text(group.name);
    },
    create_user_group() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".nothing-selected, .settings, #user-group-creation").hide();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-group-creation").show();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay .user-group-info-title").text(Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Create user group"}));
    },
};

function do_open_create_user_group() {
    _user_group_create__WEBPACK_IMPORTED_MODULE_10__.create_user_group_clicked();
}

function open_create_user_group() {
    do_open_create_user_group();
    _browser_history__WEBPACK_IMPORTED_MODULE_4__.update("#groups/new");
}

function row_for_group_id(group_id) {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()(`.group-row[data-group-id='${CSS.escape(group_id)}']`);
}

function get_active_data() {
    const $active_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()("div.group-row.active");
    const valid_active_id = Number.parseInt($active_row.attr("data-group-id"), 10);
    const $active_tabs = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-groups-container").find("div.ind-tab.selected");
    return {
        $row: $active_row,
        id: valid_active_id,
        $tabs: $active_tabs,
    };
}

function switch_to_group_row(group_id) {
    const $group_row = row_for_group_id(group_id);
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-groups-list");

    get_active_data().$row.removeClass("active");
    $group_row.addClass("active");

    _scroll_util__WEBPACK_IMPORTED_MODULE_8__.scroll_element_into_container($group_row, $container);

    // It's dubious that this timeout is needed.
    setTimeout(() => {
        if (group_id === get_active_data().id) {
            $group_row.trigger("click");
        }
    }, 100);
}

function show_right_section() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right").addClass("show");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-groups-header").addClass("slide-left");
}

function change_state(section) {
    if (!section) {
        show_user_group_settings_pane.nothing_selected();
        return;
    }
    if (section === "new") {
        do_open_create_user_group();
        return;
    }

    // if the section is a valid number.
    if (/\d+/.test(section)) {
        const group_id = Number.parseInt(section, 10);
        show_right_section();
        switch_to_group_row(group_id);
        return;
    }

    Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("invalid section for groups: " + section);
    show_user_group_settings_pane.nothing_selected();
}

function setup_page(callback) {
    function populate_and_fill() {
        const template_data = {
            can_create_or_edit_user_groups: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        };

        const rendered = _templates_user_group_settings_user_group_settings_overlay_hbs__WEBPACK_IMPORTED_MODULE_2___default()(template_data);

        const $manage_groups_container = _ui__WEBPACK_IMPORTED_MODULE_9__.get_content_element(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container"));
        $manage_groups_container.empty();
        $manage_groups_container.append(rendered);

        const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container .user-groups-list");
        const user_groups_list = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();

        _list_widget__WEBPACK_IMPORTED_MODULE_5__.create($container, user_groups_list, {
            name: "user-groups-overlay",
            modifier(item) {
                item.is_member = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    _people__WEBPACK_IMPORTED_MODULE_7__.my_current_user_id(),
                    item.id,
                );
                return _templates_user_group_settings_browse_user_groups_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default()(item);
            },
            filter: {
                $element: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container .left #search_group_name"),
                predicate(item, value) {
                    return (
                        item &&
                        (item.name.toLocaleLowerCase().includes(value) ||
                            item.description.toLocaleLowerCase().includes(value))
                    );
                },
            },
            $simplebar_container: $container,
        });

        set_up_click_handlers();
        _user_group_create__WEBPACK_IMPORTED_MODULE_10__.set_up_handlers();

        // show the "User group settings" header by default.
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".display-type #user_group_settings_title").show();

        if (callback) {
            callback();
        }
    }

    populate_and_fill();
}

function initialize() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container").on("click", ".create_user_group_button", (e) => {
        e.preventDefault();
        open_create_user_group();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container").on("click", ".group-row", show_right_section);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#manage_groups_container").on("click", ".fa-chevron-left", () => {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".right").removeClass("show");
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-groups-header").removeClass("slide-left");
    });
}

function launch(section) {
    setup_page(() => {
        _overlays__WEBPACK_IMPORTED_MODULE_6__.open_overlay({
            name: "group_subscriptions",
            $overlay: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#groups_overlay"),
            on_close() {
                _browser_history__WEBPACK_IMPORTED_MODULE_4__.exit_overlay();
            },
        });
        change_state(section);
    });
    if (!get_active_data().id) {
        if (section === "new") {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#create_user_group_name").trigger("focus");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#search_group_name").trigger("focus");
        }
    }
}


/***/ }),

/***/ "./static/js/user_pill.js":
/*!********************************!*\
  !*** ./static/js/user_pill.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "append_person": () => (/* binding */ append_person),
/* harmony export */   "append_user": () => (/* binding */ append_user),
/* harmony export */   "create_item_from_email": () => (/* binding */ create_item_from_email),
/* harmony export */   "create_pills": () => (/* binding */ create_pills),
/* harmony export */   "filter_taken_users": () => (/* binding */ filter_taken_users),
/* harmony export */   "get_email_from_item": () => (/* binding */ get_email_from_item),
/* harmony export */   "get_user_ids": () => (/* binding */ get_user_ids),
/* harmony export */   "has_unconverted_data": () => (/* binding */ has_unconverted_data),
/* harmony export */   "typeahead_source": () => (/* binding */ typeahead_source)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _input_pill__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./input_pill */ "./static/js/input_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");






// This will be used for pills for things like composing PMs
// or adding users to a stream/group.

function create_item_from_email(email, current_items) {
    // For normal Zulip use, we need to validate the email for our realm.
    const user = _people__WEBPACK_IMPORTED_MODULE_2__.get_by_email(email);

    if (!user) {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())) {
            const existing_emails = current_items.map((item) => item.email);

            if (existing_emails.includes(email)) {
                return undefined;
            }

            // For Zephyr we can't assume any emails are invalid,
            // so we just create a pill where the display value
            // is the email itself.
            return {
                type: "user",
                display_value: email,
                email,
            };
        }

        // The email is not allowed, so return.
        return undefined;
    }

    const existing_ids = current_items.map((item) => item.user_id);

    if (existing_ids.includes(user.user_id)) {
        return undefined;
    }

    const avatar_url = _people__WEBPACK_IMPORTED_MODULE_2__.small_avatar_url_for_person(user);

    const status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_3__.get_status_emoji(user.user_id);

    // We must supply display_value for the widget to work.  Everything
    // else is for our own use in callbacks.
    const item = {
        type: "user",
        display_value: user.full_name,
        user_id: user.user_id,
        email: user.email,
        img_src: avatar_url,
        deactivated: false,
        status_emoji_info,
    };

    // We pass deactivated true for a deactivated user
    if (!_people__WEBPACK_IMPORTED_MODULE_2__.is_person_active(user.user_id)) {
        item.deactivated = true;
        item.display_value = user.full_name + " (deactivated)";
    }

    return item;
}

function get_email_from_item(item) {
    return item.email;
}

function append_person(opts) {
    const person = opts.person;
    const pill_widget = opts.pill_widget;
    const avatar_url = _people__WEBPACK_IMPORTED_MODULE_2__.small_avatar_url_for_person(person);
    const status_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_3__.get_status_emoji(opts.person.user_id);

    const pill_data = {
        type: "user",
        display_value: person.full_name,
        user_id: person.user_id,
        email: person.email,
        img_src: avatar_url,
        status_emoji_info,
    };

    pill_widget.appendValidatedData(pill_data);
    pill_widget.clear_text();
}

function get_user_ids(pill_widget) {
    const items = pill_widget.items();
    let user_ids = items.map((item) => item.user_id);
    user_ids = user_ids.filter(Boolean); // be defensive about undefined users

    return user_ids;
}

function has_unconverted_data(pill_widget) {
    // This returns true if we either have text that hasn't been
    // turned into pills or email-only pills (for Zephyr).
    if (pill_widget.is_pending()) {
        return true;
    }

    const items = pill_widget.items();
    const has_unknown_items = items.some((item) => item.user_id === undefined);

    return has_unknown_items;
}

function typeahead_source(pill_widget) {
    const persons = _people__WEBPACK_IMPORTED_MODULE_2__.get_realm_users();
    return filter_taken_users(persons, pill_widget);
}

function filter_taken_users(items, pill_widget) {
    const taken_user_ids = get_user_ids(pill_widget);
    items = items.filter((item) => !taken_user_ids.includes(item.user_id));
    return items;
}

function append_user(user, pills) {
    if (user) {
        append_person({
            pill_widget: pills,
            person: user,
        });
    } else {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Undefined user in function append_user");
    }
}

function create_pills($pill_container, pill_config) {
    const pills = _input_pill__WEBPACK_IMPORTED_MODULE_1__.create({
        $container: $pill_container,
        pill_config,
        create_item_from_text: create_item_from_email,
        get_text_from_item: get_email_from_item,
    });
    return pills;
}


/***/ }),

/***/ "./static/js/user_profile.js":
/*!***********************************!*\
  !*** ./static/js/user_profile.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_custom_profile_field_data": () => (/* binding */ get_custom_profile_field_data),
/* harmony export */   "hide_user_profile": () => (/* binding */ hide_user_profile),
/* harmony export */   "register_click_handlers": () => (/* binding */ register_click_handlers),
/* harmony export */   "show_user_profile": () => (/* binding */ show_user_profile)
/* harmony export */ });
/* harmony import */ var date_fns__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! date-fns */ "./node_modules/date-fns/esm/parseISO/index.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_user_group_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/user_group_list_item.hbs */ "./static/templates/user_group_list_item.hbs");
/* harmony import */ var _templates_user_group_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_user_group_list_item_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_user_profile_modal_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/user_profile_modal.hbs */ "./static/templates/user_profile_modal.hbs");
/* harmony import */ var _templates_user_profile_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_user_profile_modal_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _templates_user_stream_list_item_hbs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../templates/user_stream_list_item.hbs */ "./static/templates/user_stream_list_item.hbs");
/* harmony import */ var _templates_user_stream_list_item_hbs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_templates_user_stream_list_item_hbs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _browser_history__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./browser_history */ "./static/js/browser_history.js");
/* harmony import */ var _buddy_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./buddy_data */ "./static/js/buddy_data.js");
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _hash_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./hash_util */ "./static/js/hash_util.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _list_widget__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./list_widget */ "./static/js/list_widget.js");
/* harmony import */ var _overlays__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./overlays */ "./static/js/overlays.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _settings_account__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./settings_account */ "./static/js/settings_account.js");
/* harmony import */ var _settings_bots__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./settings_bots */ "./static/js/settings_bots.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _settings_profile_fields__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./settings_profile_fields */ "./static/js/settings_profile_fields.js");
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _subscriber_api__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./subscriber_api */ "./static/js/subscriber_api.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _user_pill__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./user_pill */ "./static/js/user_pill.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());






























function compare_by_name(a, b) {
    return Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(a.name, b.name);
}

function initialize_bot_owner(element_id, bot_id) {
    const user_pills = new Map();
    const bot = _people__WEBPACK_IMPORTED_MODULE_11__.get_by_user_id(bot_id);
    const bot_owner = _people__WEBPACK_IMPORTED_MODULE_11__.get_bot_owner_user(bot);
    // Bot owner's pill displaying on bot's profile modal.
    if (bot_owner) {
        const $pill_container = jquery__WEBPACK_IMPORTED_MODULE_0___default()(element_id)
            .find(
                `.bot_owner_user_field[data-field-id="${CSS.escape(
                    bot_owner.user_id,
                )}"] .pill-container`,
            )
            .expectOne();
        const pills = _user_pill__WEBPACK_IMPORTED_MODULE_18__.create_pills($pill_container);

        _user_pill__WEBPACK_IMPORTED_MODULE_18__.append_user(bot_owner, pills);
        user_pills.set(bot_owner.user_id, pills);
    }
    return user_pills;
}

function format_user_stream_list_item(stream, user) {
    const show_unsubscribe_button =
        _people__WEBPACK_IMPORTED_MODULE_11__.can_admin_user(user) || Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
    const show_private_stream_unsub_tooltip =
        _people__WEBPACK_IMPORTED_MODULE_11__.is_my_user_id(user.user_id) && stream.invite_only;
    return _templates_user_stream_list_item_hbs__WEBPACK_IMPORTED_MODULE_3___default()({
        name: stream.name,
        stream_id: stream.stream_id,
        stream_color: stream.color,
        invite_only: stream.invite_only,
        is_web_public: stream.is_web_public,
        show_unsubscribe_button,
        show_private_stream_unsub_tooltip,
        stream_edit_url: _hash_util__WEBPACK_IMPORTED_MODULE_8__.stream_edit_url(stream),
    });
}

function format_user_group_list_item(group) {
    return _templates_user_group_list_item_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        group_id: group.id,
        name: group.name,
    });
}

function render_user_stream_list(streams, user) {
    streams.sort(compare_by_name);
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal .user-stream-list");
    $container.empty();
    _list_widget__WEBPACK_IMPORTED_MODULE_9__.create($container, streams, {
        name: `user-${user.user_id}-stream-list`,
        modifier(item) {
            return format_user_stream_list_item(item, user);
        },
        filter: {
            $element: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab .stream-search"),
            predicate(item, value) {
                return item && item.name.toLocaleLowerCase().includes(value);
            },
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal .modal__body"),
    });
}

function render_user_group_list(groups, user) {
    groups.sort(compare_by_name);
    const $container = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal .user-group-list");
    $container.empty();
    _list_widget__WEBPACK_IMPORTED_MODULE_9__.create($container, groups, {
        name: `user-${user.user_id}-group-list`,
        modifier(item) {
            return format_user_group_list_item(item);
        },
        $simplebar_container: jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal .modal__body"),
    });
}

function get_custom_profile_field_data(user, field, field_types, dateFormat) {
    const field_value = _people__WEBPACK_IMPORTED_MODULE_11__.get_custom_profile_data(user.user_id, field.id);
    const field_type = field.type;
    const profile_field = {};

    if (!field_value) {
        return profile_field;
    }
    if (!field_value.value) {
        return profile_field;
    }
    profile_field.name = field.name;
    profile_field.is_user_field = false;
    profile_field.is_link = field_type === field_types.URL.id;
    profile_field.is_external_account = field_type === field_types.EXTERNAL_ACCOUNT.id;
    profile_field.type = field_type;
    profile_field.display_in_profile_summary = field.display_in_profile_summary;

    switch (field_type) {
        case field_types.DATE.id:
            profile_field.value = dateFormat.format((0,date_fns__WEBPACK_IMPORTED_MODULE_19__["default"])(field_value.value));
            break;
        case field_types.USER.id:
            profile_field.id = field.id;
            profile_field.is_user_field = true;
            profile_field.value = field_value.value;
            break;
        case field_types.SELECT.id: {
            const field_choice_dict = JSON.parse(field.field_data);
            profile_field.value = field_choice_dict[field_value.value].text;
            break;
        }
        case field_types.SHORT_TEXT.id:
        case field_types.LONG_TEXT.id:
            profile_field.value = field_value.value;
            profile_field.rendered_value = field_value.rendered_value;
            break;
        case field_types.EXTERNAL_ACCOUNT.id:
            profile_field.value = field_value.value;
            profile_field.field_data = JSON.parse(field.field_data);
            profile_field.subtype = profile_field.field_data.subtype;
            profile_field.link = _settings_profile_fields__WEBPACK_IMPORTED_MODULE_15__.get_external_account_link(profile_field);
            break;
        default:
            profile_field.value = field_value.value;
    }
    return profile_field;
}

function hide_user_profile() {
    _overlays__WEBPACK_IMPORTED_MODULE_10__.close_modal("user-profile-modal");
}

function initialize_user_type_fields(user) {
    // Avoid duplicate pill fields, by removing existing ones.
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal .pill").remove();
    if (!user.is_bot) {
        _settings_account__WEBPACK_IMPORTED_MODULE_13__.initialize_custom_user_type_fields(
            "#user-profile-modal #content",
            user.user_id,
            false,
            false,
        );
    } else {
        initialize_bot_owner("#user-profile-modal #content", user.user_id);
    }
}

function show_user_profile(user, default_tab_key = "profile-tab") {
    _popovers__WEBPACK_IMPORTED_MODULE_12__.hide_all();

    const dateFormat = new Intl.DateTimeFormat("default", {dateStyle: "long"});
    const field_types = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
    const profile_data = Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())((f) => get_custom_profile_field_data(user, f, field_types, dateFormat))
        .filter((f) => f.name !== undefined);
    const user_streams = _stream_data__WEBPACK_IMPORTED_MODULE_16__.get_subscribed_streams_for_user(user.user_id);
    const groups_of_user = Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_groups'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(user.user_id);
    const args = {
        user_id: user.user_id,
        full_name: user.full_name,
        email: _people__WEBPACK_IMPORTED_MODULE_11__.get_visible_email(user),
        profile_data,
        user_avatar: _people__WEBPACK_IMPORTED_MODULE_11__.medium_avatar_url_for_person(user),
        is_me: _people__WEBPACK_IMPORTED_MODULE_11__.is_current_user(user.email),
        is_bot: user.is_bot,
        date_joined: dateFormat.format((0,date_fns__WEBPACK_IMPORTED_MODULE_19__["default"])(user.date_joined)),
        user_circle_class: _buddy_data__WEBPACK_IMPORTED_MODULE_5__.get_user_circle_class(user.user_id),
        last_seen: _buddy_data__WEBPACK_IMPORTED_MODULE_5__.user_last_seen_time_status(user.user_id),
        show_email: Object(function webpackMissingModule() { var e = new Error("Cannot find module './settings_data'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(),
        user_time: _people__WEBPACK_IMPORTED_MODULE_11__.get_user_time(user.user_id),
        user_type: _people__WEBPACK_IMPORTED_MODULE_11__.get_user_type(user.user_id),
        user_is_guest: user.is_guest,
    };

    if (user.is_bot) {
        const is_system_bot = user.is_system_bot;
        const bot_owner_id = user.bot_owner_id;
        if (is_system_bot) {
            args.is_system_bot = is_system_bot;
        } else if (bot_owner_id) {
            const bot_owner = _people__WEBPACK_IMPORTED_MODULE_11__.get_by_user_id(bot_owner_id);
            args.bot_owner = bot_owner;
            args.show_email = true;
        }
        args.bot_type = _settings_bots__WEBPACK_IMPORTED_MODULE_14__.type_id_to_string(user.bot_type);
    }

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-modal-holder").html(_templates_user_profile_modal_hbs__WEBPACK_IMPORTED_MODULE_2___default()(args));
    _overlays__WEBPACK_IMPORTED_MODULE_10__.open_modal("user-profile-modal", {autoremove: true});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()(".tabcontent").hide();

    let default_tab = 0;
    // Only checking this tab key as currently we only open this tab directly
    // other than profile-tab.
    if (default_tab_key === "user-profile-streams-tab") {
        default_tab = 1;
    }

    const opts = {
        selected: default_tab,
        child_wants_focus: true,
        values: [
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Profile"}), key: "profile-tab"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Streams"}), key: "user-profile-streams-tab"},
            {label: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "User groups"}), key: "user-profile-groups-tab"},
        ],
        callback(name, key) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()(".tabcontent").hide();
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#" + key).show();
            switch (key) {
                case "profile-tab":
                    initialize_user_type_fields(user);
                    break;
                case "user-profile-groups-tab":
                    render_user_group_list(groups_of_user, user);
                    break;
                case "user-profile-streams-tab":
                    render_user_stream_list(user_streams, user);
                    break;
            }
        },
    };

    const $elem = Object(function webpackMissingModule() { var e = new Error("Cannot find module './components'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(opts).get();
    $elem.addClass("large allow-overflow");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#tab-toggle").append($elem);
}

function handle_remove_stream_subscription(target_user_id, sub, success, failure) {
    if (_people__WEBPACK_IMPORTED_MODULE_11__.is_my_user_id(target_user_id)) {
        // Self unsubscribe.
        _channel__WEBPACK_IMPORTED_MODULE_6__.del({
            url: "/json/users/me/subscriptions",
            data: {subscriptions: JSON.stringify([sub.name])},
            success,
            error: failure,
        });
    } else {
        _subscriber_api__WEBPACK_IMPORTED_MODULE_17__.remove_user_id_from_stream(target_user_id, sub, success, failure);
    }
}

function register_click_handlers() {
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", ".info_popover_actions .view_full_user_profile", (e) => {
        const user_id = _popovers__WEBPACK_IMPORTED_MODULE_12__.elem_to_user_id(jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).parents("ul"));
        const user = _people__WEBPACK_IMPORTED_MODULE_11__.get_by_user_id(user_id);
        show_user_profile(user);
        e.stopPropagation();
        e.preventDefault();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#user-profile-modal .remove-subscription-button", (e) => {
        e.preventDefault();
        const $stream_row = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.currentTarget).closest("[data-stream-id]");
        const stream_id = Number.parseInt($stream_row.attr("data-stream-id"), 10);
        const sub = Object(function webpackMissingModule() { var e = new Error("Cannot find module './sub_store'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(stream_id);
        const target_user_id = Number.parseInt(
            $stream_row.closest("#user-profile-modal").attr("data-user-id"),
            10,
        );
        const $alert_box = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab .stream_list_info");

        function removal_success(data) {
            if (data.removed.length > 0) {
                // Most of the work for handling the unsubscribe is done
                // by the subscription -> remove event we will get.
                // However, the user profile component has not yet
                // implemented live update, so we do update its
                // UI manually here by removing the stream from this list.
                $stream_row.remove();

                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Unsubscribed successfully!"}),
                    $alert_box,
                    1200,
                );
            } else {
                Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Already not subscribed."}),
                    $alert_box,
                    1200,
                );
            }
        }

        function removal_failure() {
            let error_message;
            if (_people__WEBPACK_IMPORTED_MODULE_11__.is_my_user_id(target_user_id)) {
                error_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: "Error in unsubscribing from #{stream_name}"},
                    {stream_name: sub.name},
                );
            } else {
                error_message = Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(
                    {defaultMessage: "Error removing user from #{stream_name}"},
                    {stream_name: sub.name},
                );
            }

            Object(function webpackMissingModule() { var e = new Error("Cannot find module './ui_report'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(error_message, $alert_box, 1200);
        }

        if (sub.invite_only && _people__WEBPACK_IMPORTED_MODULE_11__.is_my_user_id(target_user_id)) {
            const new_hash = _hash_util__WEBPACK_IMPORTED_MODULE_8__.stream_edit_url(sub);
            hide_user_profile();
            _browser_history__WEBPACK_IMPORTED_MODULE_4__.go_to_location(new_hash);
            return;
        }
        handle_remove_stream_subscription(target_user_id, sub, removal_success, removal_failure);
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#user-profile-modal #clear_stream_search", (e) => {
        const $input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab .stream-search");
        $input.val("");

        // This is a hack to rerender complete
        // stream list once the text is cleared.
        $input.trigger("input");

        e.stopPropagation();
        e.preventDefault();
    });
    /* These click handlers are implemented as just deep links to the
     * relevant part of the Zulip UI, so we don't want preventDefault,
     * but we do want to close the modal when you click them. */
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#user-profile-modal #name #edit-button", () => {
        hide_user_profile();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("click", "#user-profile-modal .stream_list_item", () => {
        hide_user_profile();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("body").on("input", "#user-profile-streams-tab .stream-search", () => {
        const $input = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab .stream-search");
        if ($input.val().trim().length > 0) {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab #clear_stream_search").show();
            $input.css("margin-right", "-20px");
        } else {
            jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user-profile-streams-tab #clear_stream_search").hide();
            $input.css("margin-right", "0");
        }
    });
}


/***/ }),

/***/ "./static/js/user_search.js":
/*!**********************************!*\
  !*** ./static/js/user_search.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "UserSearch": () => (/* binding */ UserSearch)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _popovers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./popovers */ "./static/js/popovers.js");
/* harmony import */ var _resize__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./resize */ "./static/js/resize.js");
/* harmony import */ var _stream_popover__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./stream_popover */ "./static/js/stream_popover.js");






class UserSearch {
    // This is mostly view code to manage the user search widget
    // above the buddy list.  We rely on other code to manage the
    // details of populating the list when we change.

    $widget = jquery__WEBPACK_IMPORTED_MODULE_0___default()("#user_search_section").expectOne();
    $input = jquery__WEBPACK_IMPORTED_MODULE_0___default()(".user-list-filter").expectOne();

    constructor(opts) {
        this._reset_items = opts.reset_items;
        this._update_list = opts.update_list;
        this._on_focus = opts.on_focus;

        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_search_people_button").on("click", () => this.clear_search());
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#userlist-header").on("click", () => this.toggle_filter_displayed());

        this.$input.on("input", opts.update_list);
        this.$input.on("focus", (e) => this.on_focus(e));
    }

    input_field() {
        return this.$input;
    }

    text() {
        return this.$input.val().trim();
    }

    searching() {
        return this.$input.is(":focus");
    }

    empty() {
        return this.text() === "";
    }

    clear_search() {
        if (this.empty()) {
            this.close_widget();
            return;
        }

        this.$input.val("");
        this.$input.trigger("blur");
        this._reset_items();
    }

    escape_search() {
        if (this.empty()) {
            this.close_widget();
            return;
        }

        this.$input.val("");
        this._update_list();
    }

    hide_widget() {
        this.$widget.addClass("notdisplayed");
        _resize__WEBPACK_IMPORTED_MODULE_2__.resize_sidebars();
    }

    show_widget() {
        // Hide all the popovers but not userlist sidebar
        // when the user wants to search.
        _popovers__WEBPACK_IMPORTED_MODULE_1__.hide_all_except_sidebars();
        this.$widget.removeClass("notdisplayed");
        _resize__WEBPACK_IMPORTED_MODULE_2__.resize_sidebars();
    }

    widget_shown() {
        return this.$widget.hasClass("notdisplayed");
    }

    clear_and_hide_search() {
        if (!this.empty()) {
            this.$input.val("");
            this._update_list();
        }
        this.close_widget();
    }

    close_widget() {
        this.$input.trigger("blur");
        this.hide_widget();
        this._reset_items();
    }

    expand_column() {
        const $column = this.$input.closest(".app-main [class^='column-']");
        if (!$column.hasClass("expanded")) {
            _popovers__WEBPACK_IMPORTED_MODULE_1__.hide_all();
            if ($column.hasClass("column-left")) {
                _stream_popover__WEBPACK_IMPORTED_MODULE_3__.show_streamlist_sidebar();
            } else if ($column.hasClass("column-right")) {
                _popovers__WEBPACK_IMPORTED_MODULE_1__.show_userlist_sidebar();
            }
        }
    }

    initiate_search() {
        this.expand_column();
        this.show_widget();
        this.$input.trigger("focus");
    }

    toggle_filter_displayed() {
        if (this.widget_shown()) {
            this.initiate_search();
        } else {
            this.clear_and_hide_search();
        }
    }

    on_focus(e) {
        this._on_focus();
        e.stopPropagation();
    }
}


/***/ }),

/***/ "./static/js/user_status.js":
/*!**********************************!*\
  !*** ./static/js/user_status.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_status_emoji": () => (/* binding */ get_status_emoji),
/* harmony export */   "get_status_text": () => (/* binding */ get_status_text),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "server_invisible_mode_off": () => (/* binding */ server_invisible_mode_off),
/* harmony export */   "server_invisible_mode_on": () => (/* binding */ server_invisible_mode_on),
/* harmony export */   "server_update_status": () => (/* binding */ server_update_status),
/* harmony export */   "set_status_emoji": () => (/* binding */ set_status_emoji),
/* harmony export */   "set_status_text": () => (/* binding */ set_status_text)
/* harmony export */ });
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




const user_info = new Map();
const user_status_emoji_info = new Map();

function server_update_status(opts) {
    _channel__WEBPACK_IMPORTED_MODULE_0__.post({
        url: "/json/users/me/status",
        data: {
            status_text: opts.status_text,
            emoji_name: opts.emoji_name,
            emoji_code: opts.emoji_code,
            reaction_type: opts.reaction_type,
        },
        success() {
            if (opts.success) {
                opts.success();
            }
        },
    });
}

function server_invisible_mode_on() {
    _channel__WEBPACK_IMPORTED_MODULE_0__.patch({
        url: "/json/settings",
        data: {
            presence_enabled: false,
        },
    });
}

function server_invisible_mode_off() {
    _channel__WEBPACK_IMPORTED_MODULE_0__.patch({
        url: "/json/settings",
        data: {
            presence_enabled: true,
        },
    });
}

function get_status_text(user_id) {
    return user_info.get(user_id);
}

function set_status_text(opts) {
    if (!opts.status_text) {
        user_info.delete(opts.user_id);
        return;
    }

    user_info.set(opts.user_id, opts.status_text);
}

function get_status_emoji(user_id) {
    return user_status_emoji_info.get(user_id);
}

function set_status_emoji(opts) {
    if (!opts.emoji_name) {
        user_status_emoji_info.delete(opts.user_id);
        return;
    }

    user_status_emoji_info.set(opts.user_id, {
        emoji_alt_code: Object(function webpackMissingModule() { var e = new Error("Cannot find module './user_settings'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()) === "text",
        ..._emoji__WEBPACK_IMPORTED_MODULE_1__.get_emoji_details_for_rendering({
            emoji_name: opts.emoji_name,
            emoji_code: opts.emoji_code,
            reaction_type: opts.reaction_type,
        }),
    });
}

function initialize(params) {
    user_info.clear();

    for (const [str_user_id, dct] of Object.entries(params.user_status)) {
        // JSON does not allow integer keys, so we
        // convert them here.
        const user_id = Number.parseInt(str_user_id, 10);

        if (dct.status_text) {
            user_info.set(user_id, dct.status_text);
        }

        if (dct.emoji_name) {
            user_status_emoji_info.set(user_id, {
                ..._emoji__WEBPACK_IMPORTED_MODULE_1__.get_emoji_details_for_rendering(dct),
            });
        }
    }
}


/***/ }),

/***/ "./static/js/user_status_ui.js":
/*!*************************************!*\
  !*** ./static/js/user_status_ui.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clear_message": () => (/* binding */ clear_message),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "input_field": () => (/* binding */ input_field),
/* harmony export */   "open_user_status_modal": () => (/* binding */ open_user_status_modal),
/* harmony export */   "set_selected_emoji_info": () => (/* binding */ set_selected_emoji_info),
/* harmony export */   "submit_button": () => (/* binding */ submit_button),
/* harmony export */   "submit_new_status": () => (/* binding */ submit_new_status),
/* harmony export */   "toggle_clear_message_button": () => (/* binding */ toggle_clear_message_button),
/* harmony export */   "update_button": () => (/* binding */ update_button),
/* harmony export */   "user_status_picker_open": () => (/* binding */ user_status_picker_open)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_set_status_overlay_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/set_status_overlay.hbs */ "./static/templates/set_status_overlay.hbs");
/* harmony import */ var _templates_set_status_overlay_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_set_status_overlay_hbs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _templates_status_emoji_selector_hbs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../templates/status_emoji_selector.hbs */ "./static/templates/status_emoji_selector.hbs");
/* harmony import */ var _templates_status_emoji_selector_hbs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_templates_status_emoji_selector_hbs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _dialog_widget__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dialog_widget */ "./static/js/dialog_widget.js");
/* harmony import */ var _emoji__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./emoji */ "./static/js/emoji.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _people__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./people */ "./static/js/people.js");
/* harmony import */ var _user_status__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./user_status */ "./static/js/user_status.js");












let selected_emoji_info = {};
let default_status_messages_and_emoji_info;

function set_selected_emoji_info(emoji_info) {
    selected_emoji_info = {...emoji_info};
    rebuild_status_emoji_selector_ui(selected_emoji_info);
}
function input_field() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#set_user_status_modal input.user_status");
}

function submit_button() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#set_user_status_modal .dialog_submit_button");
}

function open_user_status_modal() {
    const user_id = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id();
    const selected_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(user_id) || {};
    const rendered_set_status_overlay = _templates_set_status_overlay_hbs__WEBPACK_IMPORTED_MODULE_1___default()({
        default_status_messages_and_emoji_info,
        selected_emoji_info,
    });

    _dialog_widget__WEBPACK_IMPORTED_MODULE_3__.launch({
        html_heading: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Set status"}),
        html_body: rendered_set_status_overlay,
        html_submit_button: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Save"}),
        id: "set_user_status_modal",
        on_click: submit_new_status,
        post_render: user_status_post_render,
        on_shown() {
            input_field().trigger("focus");
        },
    });
}

function submit_new_status() {
    const user_id = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id();
    let old_status_text = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id) || "";
    old_status_text = old_status_text.trim();
    const old_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(user_id) || {};
    const new_status_text = input_field().val().trim();

    if (
        old_status_text === new_status_text &&
        old_emoji_info.emoji_name === selected_emoji_info.emoji_name &&
        old_emoji_info.reaction_type === selected_emoji_info.reaction_type &&
        old_emoji_info.emoji_code === selected_emoji_info.emoji_code
    ) {
        _dialog_widget__WEBPACK_IMPORTED_MODULE_3__.close_modal();
        return;
    }

    _user_status__WEBPACK_IMPORTED_MODULE_7__.server_update_status({
        status_text: new_status_text,
        emoji_name: selected_emoji_info.emoji_name || "",
        emoji_code: selected_emoji_info.emoji_code || "",
        reaction_type: selected_emoji_info.reaction_type || "",
        success() {
            _dialog_widget__WEBPACK_IMPORTED_MODULE_3__.close_modal();
        },
    });
}

function update_button() {
    const user_id = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id();
    let old_status_text = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id) || "";
    old_status_text = old_status_text.trim();
    const old_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(user_id) || {};
    const new_status_text = input_field().val().trim();
    const $button = submit_button();

    if (
        old_status_text === new_status_text &&
        old_emoji_info.emoji_name === selected_emoji_info.emoji_name &&
        old_emoji_info.reaction_type === selected_emoji_info.reaction_type &&
        old_emoji_info.emoji_code === selected_emoji_info.emoji_code
    ) {
        $button.prop("disabled", true);
    } else {
        $button.prop("disabled", false);
    }
}

function toggle_clear_message_button() {
    if (input_field().val() !== "" || selected_emoji_info.emoji_name) {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_status_message_button").prop("disabled", false);
    } else {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_status_message_button").prop("disabled", true);
    }
}

function clear_message() {
    const $field = input_field();
    $field.val("");
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_status_message_button").prop("disabled", true);
}

function user_status_picker_open() {
    return jquery__WEBPACK_IMPORTED_MODULE_0___default()("#set_user_status_modal").length !== 0;
}

function rebuild_status_emoji_selector_ui(selected_emoji_info) {
    let selected_emoji = null;
    if (selected_emoji_info && Object.keys(selected_emoji_info).length) {
        selected_emoji = selected_emoji_info;
    }
    const rendered_status_emoji_selector = _templates_status_emoji_selector_hbs__WEBPACK_IMPORTED_MODULE_2___default()({selected_emoji});
    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#set_user_status_modal .status_emoji_wrapper").html(rendered_status_emoji_selector);
}

function user_status_post_render() {
    const user_id = _people__WEBPACK_IMPORTED_MODULE_6__.my_current_user_id();
    const old_status_text = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_text(user_id);
    const old_emoji_info = _user_status__WEBPACK_IMPORTED_MODULE_7__.get_status_emoji(user_id) || {};
    set_selected_emoji_info(old_emoji_info);
    const $field = input_field();
    $field.val(old_status_text);
    toggle_clear_message_button();

    const $button = submit_button();
    $button.prop("disabled", true);

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#set_user_status_modal .user-status-value").on("click", (event) => {
        event.stopPropagation();
        const user_status_value = jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.currentTarget).text().trim();
        jquery__WEBPACK_IMPORTED_MODULE_0___default()("input.user_status").val(user_status_value);

        const emoji_info = default_status_messages_and_emoji_info.find(
            (status) => status.status_text === user_status_value,
        ).emoji;
        set_selected_emoji_info(emoji_info);
        toggle_clear_message_button();
        update_button();
    });

    input_field().on("keypress", (event) => {
        if (Object(function webpackMissingModule() { var e = new Error("Cannot find module './keydown_util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(event)) {
            event.preventDefault();

            submit_new_status();
        }
    });

    input_field().on("keyup", () => {
        update_button();
        toggle_clear_message_button();
    });

    jquery__WEBPACK_IMPORTED_MODULE_0___default()("#clear_status_message_button").on("click", () => {
        clear_message();
        set_selected_emoji_info();
        update_button();
    });
}

function initialize() {
    default_status_messages_and_emoji_info = [
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Busy"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("working_on_it"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "In a meeting"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("calendar"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Commuting"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("bus"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Out sick"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("hurt"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Vacationing"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("palm_tree"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Working remotely"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("house"),
        },
        {
            status_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "At the office"}),
            emoji: _emoji__WEBPACK_IMPORTED_MODULE_4__.get_emoji_details_by_name("office"),
        },
    ];
}


/***/ }),

/***/ "./static/js/user_topics.js":
/*!**********************************!*\
  !*** ./static/js/user_topics.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "add_muted_topic": () => (/* binding */ add_muted_topic),
/* harmony export */   "get_muted_topics": () => (/* binding */ get_muted_topics),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "is_topic_muted": () => (/* binding */ is_topic_muted),
/* harmony export */   "remove_muted_topic": () => (/* binding */ remove_muted_topic),
/* harmony export */   "set_user_topic": () => (/* binding */ set_user_topic),
/* harmony export */   "set_user_topics": () => (/* binding */ set_user_topics),
/* harmony export */   "visibility_policy": () => (/* binding */ visibility_policy)
/* harmony export */ });
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _stream_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stream_data */ "./static/js/stream_data.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());







const muted_topics = new Map();

const visibility_policy = {
    VISIBILITY_POLICY_INHERIT: 0,
    MUTED: 1,
    UNMUTED: 2,
    FOLLOWED: 3,
};

function add_muted_topic(stream_id, topic, date_muted) {
    let sub_dict = muted_topics.get(stream_id);
    if (!sub_dict) {
        sub_dict = new Object(function webpackMissingModule() { var e = new Error("Cannot find module './fold_dict'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())();
        muted_topics.set(stream_id, sub_dict);
    }
    const time = Object(function webpackMissingModule() { var e = new Error("Cannot find module './util'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(date_muted);
    sub_dict.set(topic, time);
}

function remove_muted_topic(stream_id, topic) {
    const sub_dict = muted_topics.get(stream_id);
    if (sub_dict) {
        sub_dict.delete(topic);
    }
}

function is_topic_muted(stream_id, topic) {
    if (stream_id === undefined) {
        return false;
    }
    const sub_dict = muted_topics.get(stream_id);
    return (sub_dict && sub_dict.get(topic)) || false;
}

function get_muted_topics() {
    const topics = [];
    for (const [stream_id, sub_dict] of muted_topics) {
        const stream = _stream_data__WEBPACK_IMPORTED_MODULE_1__.maybe_get_stream_name(stream_id);
        for (const topic of sub_dict.keys()) {
            const date_muted = sub_dict.get(topic);
            const date_muted_str = Object(function webpackMissingModule() { var e = new Error("Cannot find module './timerender'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(new Date(date_muted)).time_str;
            topics.push({
                stream_id,
                stream,
                topic,
                date_muted,
                date_muted_str,
            });
        }
    }
    return topics;
}

function set_user_topic(user_topic) {
    const stream_id = user_topic.stream_id;
    const topic = user_topic.topic_name;
    const date_muted = user_topic.last_updated;

    const stream_name = _stream_data__WEBPACK_IMPORTED_MODULE_1__.maybe_get_stream_name(stream_id);

    if (!stream_name) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("Unknown stream ID in set_user_topic: " + stream_id);
        return;
    }

    switch (user_topic.visibility_policy) {
        case visibility_policy.MUTED:
            add_muted_topic(stream_id, topic, date_muted);
            break;
        case visibility_policy.VISIBILITY_POLICY_INHERIT:
            remove_muted_topic(stream_id, topic);
            break;
    }
}

function set_user_topics(user_topics) {
    muted_topics.clear();

    for (const user_topic of user_topics) {
        set_user_topic(user_topic);
    }
}

function initialize() {
    set_user_topics(Object(function webpackMissingModule() { var e = new Error("Cannot find module './page_params'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}


/***/ }),

/***/ "./static/js/vdom.js":
/*!***************************!*\
  !*** ./static/js/vdom.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "eq_array": () => (/* binding */ eq_array),
/* harmony export */   "render_tag": () => (/* binding */ render_tag),
/* harmony export */   "ul": () => (/* binding */ ul),
/* harmony export */   "update": () => (/* binding */ update),
/* harmony export */   "update_attrs": () => (/* binding */ update_attrs)
/* harmony export */ });
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());




function eq_array(a, b, eq) {
    if (a === b) {
        // either both are undefined, or they
        // are referentially equal
        return true;
    }

    if (a === undefined || b === undefined) {
        return false;
    }

    if (a.length !== b.length) {
        return false;
    }

    return a.every((item, i) => eq(item, b[i]));
}

function ul(opts) {
    return {
        tag_name: "ul",
        opts,
    };
}

function render_tag(tag) {
    /*
        This renders a tag into a string.  It will
        automatically escape attributes, but it's your
        responsibility to make sure keyed_nodes provide
        a `render` method that escapes HTML properly.
        (One option is to use templates.)

        Do NOT call this method directly, except for
        testing.  The vdom scheme expects you to use
        the `update` method.
    */
    const opts = tag.opts;
    const tag_name = tag.tag_name;
    const attr_str = opts.attrs
        .map((attr) => " " + attr[0] + '="' + lodash__WEBPACK_IMPORTED_MODULE_0___default().escape(attr[1]) + '"')
        .join("");

    const start_tag = "<" + tag_name + attr_str + ">";
    const end_tag = "</" + tag_name + ">";

    if (opts.keyed_nodes === undefined) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We need keyed_nodes to render innards.");
        return undefined;
    }

    const innards = opts.keyed_nodes.map((node) => node.render()).join("\n");
    return start_tag + "\n" + innards + "\n" + end_tag;
}

function update_attrs($elem, new_attrs, old_attrs) {
    const new_dict = new Map(new_attrs);
    const old_dict = new Map(old_attrs);

    for (const [k, v] of new_attrs) {
        if (v !== old_dict.get(k)) {
            $elem.attr(k, v);
        }
    }

    for (const [k] of old_attrs) {
        if (!new_dict.has(k)) {
            $elem.removeAttr(k);
        }
    }
}

function update(replace_content, find, new_dom, old_dom) {
    /*
        The update method allows you to continually
        update a "virtual" representation of your DOM,
        and then this method actually updates the
        real DOM using jQuery.  The caller will pass
        in a method called `replace_content` that will replace
        the entire html and a method called `find` to
        find the existing DOM for more surgical updates.

        The first "update" will be more like a create,
        because your `old_dom` should be undefined.
        After that initial call, it is important that
        you always pass in a correct value of `old_dom`;
        otherwise, things will be incredibly confusing.

        The basic scheme here is simple:

            1) If old_dom is undefined, we render
               everything for the first time.

            2) If the keys of your new children are no
               longer the same order as the old
               children, then we just render
               everything anew.
               (We may refine this in the future.)

            3) If your key structure remains the same,
               then we update your child nodes on
               a child-by-child basis, and we avoid
               updates where the data had remained
               the same.

        The key to making this all work is that
        `new_dom` should include a `keyed_nodes` option
        where each `keyed_node` has a `key` and supports
        these methods:

            eq - can compare itself to similar nodes
                 for data equality

            render - can create an HTML representation
                     of itself

        The `new_dom` should generally be created with
        something like `vdom.ul`, which will set a
        tag field internally and which will want options
        like `attrs` for attributes.

        For examples of creating vdom objects, look at
        `pm_list_dom.js`.
    */
    function do_full_update() {
        const rendered_dom = render_tag(new_dom);
        replace_content(rendered_dom);
    }

    if (old_dom === undefined) {
        do_full_update();
        return;
    }

    const new_opts = new_dom.opts;
    const old_opts = old_dom.opts;

    if (new_opts.keyed_nodes === undefined) {
        // We generally want to use vdom on lists, and
        // adding keys for children lets us avoid unnecessary
        // redraws (or lets us know we should just rebuild
        // the dom).
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("We need keyed_nodes for updates.");
        return;
    }

    const same_structure = eq_array(
        new_opts.keyed_nodes,
        old_opts.keyed_nodes,
        (a, b) => a.key === b.key,
    );

    if (!same_structure) {
        /* We could do something smarter like detecting row
           moves, but it's overkill for small lists.
        */
        do_full_update();
        return;
    }

    /*
        DO "QUICK" UPDATES:

        We've gotten this far, so we know we have the
        same overall structure for our parent tag, and
        the only thing left to do with our child nodes
        is to possibly update them in place (via jQuery).
        We will only update nodes whose data has changed.
    */

    const $child_elems = find().children();

    for (const [i, new_node] of new_opts.keyed_nodes.entries()) {
        const old_node = old_opts.keyed_nodes[i];
        if (new_node.eq(old_node)) {
            continue;
        }
        const rendered_dom = new_node.render();
        $child_elems.eq(i).replaceWith(rendered_dom);
    }

    update_attrs(find(), new_opts.attrs, old_opts.attrs);
}


/***/ }),

/***/ "./static/js/widgetize.js":
/*!********************************!*\
  !*** ./static/js/widgetize.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "activate": () => (/* binding */ activate),
/* harmony export */   "clear_for_testing": () => (/* binding */ clear_for_testing),
/* harmony export */   "handle_event": () => (/* binding */ handle_event),
/* harmony export */   "set_widgets_for_list": () => (/* binding */ set_widgets_for_list),
/* harmony export */   "widget_contents": () => (/* binding */ widget_contents)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _message_lists__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_lists */ "./static/js/message_lists.js");
/* harmony import */ var _narrow_state__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./narrow_state */ "./static/js/narrow_state.js");
/* harmony import */ var _poll_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./poll_widget */ "./static/js/poll_widget.js");
/* harmony import */ var _todo_widget__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./todo_widget */ "./static/js/todo_widget.js");
/* harmony import */ var _zform__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./zform */ "./static/js/zform.js");









const widgets = new Map([
    ["poll", _poll_widget__WEBPACK_IMPORTED_MODULE_4__],
    ["todo", _todo_widget__WEBPACK_IMPORTED_MODULE_5__],
    ["zform", _zform__WEBPACK_IMPORTED_MODULE_6__],
]);

const widget_contents = new Map();

function clear_for_testing() {
    widget_contents.clear();
}

function set_widget_in_message($row, $widget_elem) {
    const $content_holder = $row.find(".message_content");

    // Avoid adding the $widget_elem if it already exists.
    // This can happen when the app loads in the "Recent topics"
    // view and the user changes the view to "All messages".
    // This is important since jQuery removes all the event handlers
    // on `empty()`ing an element.
    if ($content_holder.find(".widget-content").length === 0) {
        $content_holder.empty().append($widget_elem);
    }
}

function activate(in_opts) {
    const widget_type = in_opts.widget_type;
    const extra_data = in_opts.extra_data;
    const events = in_opts.events;
    const $row = in_opts.$row;
    const message = in_opts.message;
    const post_to_server = in_opts.post_to_server;

    events.shift();

    if (!widgets.has(widget_type)) {
        if (widget_type === "tictactoe") {
            return; // don't warn for deleted legacy widget
        }
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("unknown widget_type", widget_type);
        return;
    }

    const callback = function (data) {
        post_to_server({
            msg_type: "widget",
            data,
        });
    };

    if ($row.attr("id").startsWith("zhome") && _narrow_state__WEBPACK_IMPORTED_MODULE_3__.active()) {
        // Don't place widget in a home message row if we are narrowed
        // to active state
        return;
    }

    let $widget_elem = widget_contents.get(message.id);
    if ($widget_elem) {
        set_widget_in_message($row, $widget_elem);
        return;
    }

    // We depend on our widgets to use templates to build
    // the HTML that will eventually go in this div.
    $widget_elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()("<div>").addClass("widget-content");

    widgets.get(widget_type).activate({
        $elem: $widget_elem,
        callback,
        message,
        extra_data,
    });

    widget_contents.set(message.id, $widget_elem);
    set_widget_in_message($row, $widget_elem);

    // Replay any events that already happened.  (This is common
    // when you narrow to a message after other users have already
    // interacted with it.)
    if (events.length > 0) {
        $widget_elem.handle_events(events);
    }
}

function set_widgets_for_list() {
    for (const [idx, $widget_elem] of widget_contents) {
        if (_message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get(idx) !== undefined) {
            const $row = _message_lists__WEBPACK_IMPORTED_MODULE_2__.current.get_row(idx);
            set_widget_in_message($row, $widget_elem);
        }
    }
}

function handle_event(widget_event) {
    const $widget_elem = widget_contents.get(widget_event.message_id);

    if (!$widget_elem) {
        // It is common for submessage events to arrive on
        // messages that we don't yet have in view. We
        // just ignore them completely here.
        return;
    }

    const events = [widget_event];

    $widget_elem.handle_events(events);
}


/***/ }),

/***/ "./static/js/zcommand.js":
/*!*******************************!*\
  !*** ./static/js/zcommand.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "enter_fixed_mode": () => (/* binding */ enter_fixed_mode),
/* harmony export */   "enter_fluid_mode": () => (/* binding */ enter_fluid_mode),
/* harmony export */   "process": () => (/* binding */ process),
/* harmony export */   "send": () => (/* binding */ send),
/* harmony export */   "switch_to_dark_theme": () => (/* binding */ switch_to_dark_theme),
/* harmony export */   "switch_to_light_theme": () => (/* binding */ switch_to_light_theme),
/* harmony export */   "tell_user": () => (/* binding */ tell_user)
/* harmony export */ });
/* harmony import */ var _channel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./channel */ "./static/js/channel.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _dark_theme__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dark_theme */ "./static/js/dark_theme.js");
/* harmony import */ var _feedback_widget__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./feedback_widget */ "./static/js/feedback_widget.js");
Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./markdown */ "./static/js/markdown.js");
/* harmony import */ var _scroll_bar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./scroll_bar */ "./static/js/scroll_bar.js");








/*

What in the heck is a zcommand?

    A zcommand is basically a specific type of slash
    command where the client does almost no work and
    the server just does something pretty simple like
    flip a setting.

    The first zcommand we wrote is for "/ping", and
    the server just responds with a 200 for that.

    Not all slash commands use zcommand under the hood.
    For more exotic things like /poll see submessage.js
    and widgetize.js

*/

function send(opts) {
    const command = opts.command;
    const on_success = opts.on_success;
    const data = {
        command,
    };

    _channel__WEBPACK_IMPORTED_MODULE_0__.post({
        url: "/json/zcommand",
        data,
        success(data) {
            if (on_success) {
                on_success(data);
            }
        },
        error() {
            tell_user("server did not respond");
        },
    });
}

function tell_user(msg) {
    // This is a bit hacky, but we don't have a super easy API now
    // for just telling users stuff.
    Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg, Object(function webpackMissingModule() { var e = new Error("Cannot find module './compose_banner'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));
}

function switch_to_light_theme() {
    send({
        command: "/day",
        on_success(data) {
            _dark_theme__WEBPACK_IMPORTED_MODULE_2__.disable();
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.show({
                populate($container) {
                    const rendered_msg = _markdown__WEBPACK_IMPORTED_MODULE_4__.parse_non_message(data.msg);
                    $container.html(rendered_msg);
                },
                on_undo() {
                    send({
                        command: "/night",
                    });
                },
                title_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Light theme"}),
                undo_button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Dark theme"}),
            });
        },
    });
}

function switch_to_dark_theme() {
    send({
        command: "/night",
        on_success(data) {
            _dark_theme__WEBPACK_IMPORTED_MODULE_2__.enable();
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.show({
                populate($container) {
                    const rendered_msg = _markdown__WEBPACK_IMPORTED_MODULE_4__.parse_non_message(data.msg);
                    $container.html(rendered_msg);
                },
                on_undo() {
                    send({
                        command: "/day",
                    });
                },
                title_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Dark theme"}),
                undo_button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Light theme"}),
            });
        },
    });
}

function enter_fluid_mode() {
    send({
        command: "/fluid-width",
        on_success(data) {
            _scroll_bar__WEBPACK_IMPORTED_MODULE_5__.set_layout_width();
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.show({
                populate($container) {
                    const rendered_msg = _markdown__WEBPACK_IMPORTED_MODULE_4__.parse_non_message(data.msg);
                    $container.html(rendered_msg);
                },
                on_undo() {
                    send({
                        command: "/fixed-width",
                    });
                },
                title_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Fluid width mode"}),
                undo_button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Fixed width"}),
            });
        },
    });
}

function enter_fixed_mode() {
    send({
        command: "/fixed-width",
        on_success(data) {
            _scroll_bar__WEBPACK_IMPORTED_MODULE_5__.set_layout_width();
            _feedback_widget__WEBPACK_IMPORTED_MODULE_3__.show({
                populate($container) {
                    const rendered_msg = _markdown__WEBPACK_IMPORTED_MODULE_4__.parse_non_message(data.msg);
                    $container.html(rendered_msg);
                },
                on_undo() {
                    send({
                        command: "/fluid-width",
                    });
                },
                title_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Fixed width mode"}),
                undo_button_text: Object(function webpackMissingModule() { var e = new Error("Cannot find module './i18n'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())({defaultMessage: "Fluid width"}),
            });
        },
    });
}

function process(message_content) {
    const content = message_content.trim();

    if (content === "/ping") {
        const start_time = new Date();

        send({
            command: content,
            on_success() {
                const end_time = new Date();
                let diff = end_time - start_time;
                diff = Math.round(diff);
                const msg = "ping time: " + diff + "ms";
                tell_user(msg);
            },
        });
        return true;
    }

    const day_commands = ["/day", "/light"];
    if (day_commands.includes(content)) {
        switch_to_light_theme();
        return true;
    }

    const night_commands = ["/night", "/dark"];
    if (night_commands.includes(content)) {
        switch_to_dark_theme();
        return true;
    }

    if (content === "/fluid-width") {
        enter_fluid_mode();
        return true;
    }

    if (content === "/fixed-width") {
        enter_fixed_mode();
        return true;
    }

    // It is incredibly important here to return false
    // if we don't see an actual zcommand, so that compose.js
    // knows this is a normal message.
    return false;
}


/***/ }),

/***/ "./static/js/zform.js":
/*!****************************!*\
  !*** ./static/js/zform.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "activate": () => (/* binding */ activate),
/* harmony export */   "validate_extra_data": () => (/* binding */ validate_extra_data)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _templates_widgets_zform_choices_hbs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../templates/widgets/zform_choices.hbs */ "./static/templates/widgets/zform_choices.hbs");
/* harmony import */ var _templates_widgets_zform_choices_hbs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_templates_widgets_zform_choices_hbs__WEBPACK_IMPORTED_MODULE_1__);
Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }());
/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./schema */ "./static/js/schema.js");
/* harmony import */ var _transmit__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./transmit */ "./static/js/transmit.js");








function validate_extra_data(data) {
    function check(data) {
        function check_choice_data(data) {
            function check_choice_item(field_name, val) {
                return _schema__WEBPACK_IMPORTED_MODULE_3__.check_record(field_name, val, {
                    short_name: _schema__WEBPACK_IMPORTED_MODULE_3__.check_string,
                    long_name: _schema__WEBPACK_IMPORTED_MODULE_3__.check_string,
                    reply: _schema__WEBPACK_IMPORTED_MODULE_3__.check_string,
                });
            }

            function check_choices(field_name, val) {
                return _schema__WEBPACK_IMPORTED_MODULE_3__.check_array(field_name, val, check_choice_item);
            }

            return _schema__WEBPACK_IMPORTED_MODULE_3__.check_record("zform data", data, {
                heading: _schema__WEBPACK_IMPORTED_MODULE_3__.check_string,
                choices: check_choices,
            });
        }

        if (data.type === "choices") {
            return check_choice_data(data);
        }

        return "unknown zform type: " + data.type;
    }

    const msg = check(data);

    if (msg) {
        Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())(msg);
        return false;
    }

    return true;
}

function activate(opts) {
    const self = {};

    const $outer_elem = opts.$elem;
    const data = opts.extra_data;

    if (!validate_extra_data(data)) {
        // callee will log reason we fail
        return undefined;
    }

    function make_choices(data) {
        // Assign idx values to each of our choices so that
        // our template can create data-idx values for our
        // JS code to use later.
        for (const [idx, choice] of data.choices.entries()) {
            choice.idx = idx;
        }

        const html = _templates_widgets_zform_choices_hbs__WEBPACK_IMPORTED_MODULE_1___default()(data);
        const $elem = jquery__WEBPACK_IMPORTED_MODULE_0___default()(html);

        $elem.find("button").on("click", (e) => {
            e.stopPropagation();

            // Grab our index from the markup.
            const idx = jquery__WEBPACK_IMPORTED_MODULE_0___default()(e.target).attr("data-idx");

            // Use the index from the markup to dereference our
            // data structure.
            const reply_content = data.choices[idx].reply;

            _transmit__WEBPACK_IMPORTED_MODULE_4__.reply_message({
                message: opts.message,
                content: reply_content,
            });
        });

        return $elem;
    }

    function render() {
        let rendered_widget;

        if (data.type === "choices") {
            rendered_widget = make_choices(data);
            $outer_elem.html(rendered_widget);
        }
    }

    self.handle_events = function (events) {
        if (events) {
            Object(function webpackMissingModule() { var e = new Error("Cannot find module './blueslip'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())("unexpected");
        }
        render();
    };

    render();

    return self;
}


/***/ }),

/***/ "./static/shared/js/fenced_code.js":
/*!*****************************************!*\
  !*** ./static/shared/js/fenced_code.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "get_unused_fence": () => (/* binding */ get_unused_fence),
/* harmony export */   "initialize": () => (/* binding */ initialize),
/* harmony export */   "process_fenced_code": () => (/* binding */ process_fenced_code),
/* harmony export */   "set_stash_func": () => (/* binding */ set_stash_func),
/* harmony export */   "wrap_code": () => (/* binding */ wrap_code)
/* harmony export */ });
/* harmony import */ var katex__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! katex */ "./node_modules/katex/dist/katex.mjs");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var mermaid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mermaid */ "./node_modules/mermaid/dist/mermaid.core.mjs");
/* eslint-disable import/no-unresolved */
/* eslint-disable no-console */
 // eslint-disable-line import/no-unresolved

 // Added MrChaos 2023.1.20

// Parsing routine that can be dropped in to message parsing
// and formats code blocks
//
// This supports arbitrarily nested code blocks as well as
// auto-completing code blocks missing a trailing close.

// See backend fenced_code.py:71 for associated regexp
const fencestr =
    "^(~{3,}|`{3,})" + // Opening fence
    "[ ]*" + // Spaces
    "(" +
    "\\{?\\.?" +
    "([a-zA-Z0-9_+-./#]*)" + // Language
    "\\}?" +
    ")" +
    "[ ]*" + // Spaces
    "(" +
    "\\{?\\.?" +
    "([^~`]*)" + // Header (see fenced_code.py)
    "\\}?" +
    ")" +
    "$";
const fence_re = new RegExp(fencestr);

// Default stashing function does nothing
let stash_func = function (text) {
    return text;
};

// We fill up the actual values when initializing.
let pygments_data = {};

function initialize(generated_pygments_data) {
    pygments_data = generated_pygments_data.langs;
}

function wrap_code(code, lang) {
    let header = '<div class="codehilite"><pre><span></span><code>';
    // Mimics the backend logic of adding a data-attribute (data-code-language)
    // to know what Pygments language was used to highlight this code block.
    //
    // NOTE: Clients like zulip-mobile wouldn't receive the pygments data since that comes from outside
    // the `/shared` folder. To handle such a case we check if pygments data is empty and fallback to
    // using the default header if it is.
    if (lang !== undefined && lang !== "" && Object.keys(pygments_data).length > 0) {
        const code_language = pygments_data[lang]?.pretty_name ?? lang;
        header = `<div class="codehilite" data-code-language="${lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(
            code_language,
        )}"><pre><span></span><code>`;
    }
    // Trim trailing \n until there's just one left
    // This mirrors how pygments handles code input
    return header + lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(code.replace(/^\n+|\n+$/g, "")) + "\n</code></pre></div>";
}

function wrap_quote(text) {
    const paragraphs = text.split("\n");
    const quoted_paragraphs = [];

    // Prefix each quoted paragraph with > at the
    // beginning of each line
    for (const paragraph of paragraphs) {
        const lines = paragraph.split("\n");
        quoted_paragraphs.push(lines.map((line) => "> " + line).join("\n"));
    }

    return quoted_paragraphs.join("\n");
}

function wrap_tex(tex) {
    try {
        return "<p>" + katex__WEBPACK_IMPORTED_MODULE_0__["default"].renderToString(tex, {displayMode: true}) + "</p>";
    } catch {
        return '<p><span class="tex-error">' + lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(tex) + "</span></p>";
    }
}

function wrap_spoiler(header, text, stash_func) {
    const header_div_open_html = '<div class="spoiler-block"><div class="spoiler-header">';
    const end_header_start_content_html = '</div><div class="spoiler-content" aria-hidden="true">';
    const footer_html = "</div></div>";

    const output = [
        stash_func(header_div_open_html),
        header,
        stash_func(end_header_start_content_html),
        text,
        stash_func(footer_html),
    ];
    return output.join("\n\n");
}


function wrap_mermaid(text) {
    try {
        const id = "mmd" + Math.round(Math.random() * 10000);        
        if (mermaid__WEBPACK_IMPORTED_MODULE_2__["default"].parse(text)) {
            return "<p>" + mermaid__WEBPACK_IMPORTED_MODULE_2__["default"].render(id,text,undefined) + "</p>";
        }
        return text;
    } catch(error) {
        console.err(error);
        return '<p><span class="mermaid-error">' + lodash__WEBPACK_IMPORTED_MODULE_1___default().escape(text) + "</span></p>";
    }
}

function set_stash_func(stash_handler) {
    stash_func = stash_handler;
}

function process_fenced_code(content) {
    const input = content.split("\n");
    const output = [];
    const handler_stack = [];
    let consume_line;

    function handler_for_fence(output_lines, fence, lang, header) {
        // lang is ignored except for 'quote', as we
        // don't do syntax highlighting yet
        const lines = [];
        if (lang === "quote") {
            return {
                handle_line(line) {
                    if (line === fence) {
                        this.done();
                    } else {
                        consume_line(lines, line);
                    }
                },

                done() {
                    const text = wrap_quote(lines.join("\n"));
                    output_lines.push("", text, "");
                    handler_stack.pop();
                },
            };
        }

        if (lang === "math") {
            return {
                handle_line(line) {
                    if (line === fence) {
                        this.done();
                    } else {
                        lines.push(line);
                    }
                },

                done() {
                    const text = wrap_tex(lines.join("\n"));
                    const placeholder = stash_func(text, true);
                    output_lines.push("", placeholder, "");
                    handler_stack.pop();
                },
            };
        }

        if (lang === "spoiler") {
            return {
                handle_line(line) {
                    if (line === fence) {
                        this.done();
                    } else {
                        lines.push(line);
                    }
                },

                done() {
                    const text = wrap_spoiler(header, lines.join("\n"), stash_func);
                    output_lines.push("", text, "");
                    handler_stack.pop();
                },
            };
        }
        if (lang === "mermaid") {
            return {
                handle_line(line) {
                    if (line === fence) {
                        this.done();
                    } else {
                        lines.push(line);
                    }
                },

                done() {
                    const text = wrap_mermaid(lines.join("\n"));
                    output_lines.push("", text, "");
                    handler_stack.pop();
                },
            };
        }
        return {
            handle_line(line) {
                if (line === fence) {
                    this.done();
                } else {
                    lines.push(line.trimEnd());
                }
            },

            done() {
                const text = wrap_code(lines.join("\n"), lang);
                // insert safe HTML that is passed through the parsing
                const placeholder = stash_func(text, true);
                output_lines.push("", placeholder, "");
                handler_stack.pop();
            },
        };
    }

    function default_handler() {
        return {
            handle_line(line) {
                consume_line(output, line);
            },
            done() {
                handler_stack.pop();
            },
        };
    }

    consume_line = function consume_line(output_lines, line) {
        const match = fence_re.exec(line);
        if (match) {
            const fence = match[1];
            const lang = match[3];
            const header = match[5];
            const handler = handler_for_fence(output_lines, fence, lang, header);
            handler_stack.push(handler);
        } else {
            output_lines.push(line);
        }
    };

    const current_handler = default_handler();
    handler_stack.push(current_handler);

    for (const line of input) {
        const handler = handler_stack.at(-1);
        handler.handle_line(line);
    }

    // Clean up all trailing blocks by letting them
    // insert closing fences
    while (handler_stack.length !== 0) {
        const handler = handler_stack.at(-1);
        handler.done();
    }

    if (output.length > 2 && output.at(-2) !== "") {
        output.push("");
    }

    return output.join("\n");
}

const fence_length_re = /^ {0,3}(`{3,})/gm;
function get_unused_fence(content) {
    // we only return ``` fences, not ~~~.
    let length = 3;
    let match;
    fence_length_re.lastIndex = 0;
    while ((match = fence_length_re.exec(content)) !== null) {
        length = Math.max(length, match[1].length + 1);
    }
    return "`".repeat(length);
}


/***/ }),

/***/ "./static/shared/js/internal_url.js":
/*!******************************************!*\
  !*** ./static/shared/js/internal_url.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "by_stream_topic_url": () => (/* binding */ by_stream_topic_url),
/* harmony export */   "by_stream_url": () => (/* binding */ by_stream_url),
/* harmony export */   "decodeHashComponent": () => (/* binding */ decodeHashComponent),
/* harmony export */   "encodeHashComponent": () => (/* binding */ encodeHashComponent),
/* harmony export */   "encode_stream_id": () => (/* binding */ encode_stream_id),
/* harmony export */   "stream_id_to_slug": () => (/* binding */ stream_id_to_slug)
/* harmony export */ });
const hashReplacements = new Map([
    ["%", "."],
    ["(", ".28"],
    [")", ".29"],
    [".", ".2E"],
]);

// Some browsers zealously URI-decode the contents of
// window.location.hash.  So we hide our URI-encoding
// by replacing % with . (like MediaWiki).
function encodeHashComponent(str) {
    return encodeURIComponent(str).replace(/[%().]/g, (matched) => hashReplacements.get(matched));
}

function decodeHashComponent(str) {
    // This fails for URLs containing
    // foo.foo or foo%foo due to our fault in special handling
    // of such characters when encoding. This can also,
    // fail independent of our fault.
    // Here we let the calling code handle the exception.
    return decodeURIComponent(str.replace(/\./g, "%"));
}

function stream_id_to_slug(stream_id, maybe_get_stream_name) {
    let name = maybe_get_stream_name(stream_id) || "unknown";

    // The name part of the URL doesn't really matter, so we try to
    // make it pretty.

    // TODO: Convert this to replaceAll once mobile no longer supports
    // browsers that don't have it.
    name = name.replace(/ /g, "-");

    return stream_id + "-" + name;
}

function encode_stream_id(stream_id, maybe_get_stream_name) {
    // stream_id_to_slug appends the stream name, but it does not do the
    // URI encoding piece.
    const slug = stream_id_to_slug(stream_id, maybe_get_stream_name);

    return encodeHashComponent(slug);
}

function by_stream_url(stream_id, maybe_get_stream_name) {
    return "#narrow/stream/" + encode_stream_id(stream_id, maybe_get_stream_name);
}

function by_stream_topic_url(stream_id, topic, maybe_get_stream_name) {
    return (
        "#narrow/stream/" +
        encode_stream_id(stream_id, maybe_get_stream_name) +
        "/topic/" +
        encodeHashComponent(topic)
    );
}


/***/ }),

/***/ "./static/shared/js/poll_data.js":
/*!***************************************!*\
  !*** ./static/shared/js/poll_data.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PollData": () => (/* binding */ PollData)
/* harmony export */ });
// Any single user should send add a finite number of options
// to a poll. We arbitrarily pick this value.
const MAX_IDX = 1000;

class PollData {
    // This object just holds data for a poll, although it
    // works closely with the widget's concept of how data
    // should be represented for rendering, plus how the
    // server sends us data.

    key_to_option = new Map();
    my_idx = 1;

    constructor({
        message_sender_id,
        current_user_id,
        is_my_poll,
        question,
        options,
        comma_separated_names,
        report_error_function,
    }) {
        this.message_sender_id = message_sender_id;
        this.me = current_user_id;
        this.is_my_poll = is_my_poll;
        this.poll_question = question;
        this.input_mode = is_my_poll; // for now
        this.comma_separated_names = comma_separated_names;
        this.report_error_function = report_error_function;

        if (question) {
            this.set_question(question);
        }

        for (const [i, option] of options.entries()) {
            this.handle.new_option.inbound("canned", {
                idx: i,
                option,
            });
        }
    }

    set_question(new_question) {
        this.input_mode = false;
        this.poll_question = new_question;
    }

    get_question() {
        return this.poll_question;
    }

    set_input_mode() {
        this.input_mode = true;
    }

    clear_input_mode() {
        this.input_mode = false;
    }

    get_input_mode() {
        return this.input_mode;
    }

    get_widget_data() {
        const options = [];

        for (const [key, obj] of this.key_to_option) {
            const voters = Array.from(obj.votes.keys());
            const current_user_vote = voters.includes(this.me);

            options.push({
                option: obj.option,
                names: this.comma_separated_names(voters),
                count: voters.length,
                key,
                current_user_vote,
            });
        }

        const widget_data = {
            options,
            question: this.poll_question,
        };

        return widget_data;
    }

    handle = {
        new_option: {
            outbound: (option) => {
                const event = {
                    type: "new_option",
                    idx: this.my_idx,
                    option,
                };

                this.my_idx += 1;

                return event;
            },

            inbound: (sender_id, data) => {
                // All message readers may add a new option to the poll.
                const idx = data.idx;
                const option = data.option;
                const options = this.get_widget_data().options;

                // While the UI doesn't allow adding duplicate options
                // to an existing poll, the /poll command syntax to create
                // them does not prevent duplicates, so we suppress them here.
                if (this.is_option_present(options, option)) {
                    return;
                }

                if (!Number.isInteger(idx) || idx < 0 || idx > MAX_IDX) {
                    this.report_error_function("poll widget: bad type for inbound option idx");
                    return;
                }

                if (typeof option !== "string") {
                    this.report_error_function("poll widget: bad type for inbound option");
                    return;
                }

                const key = sender_id + "," + idx;
                const votes = new Map();

                this.key_to_option.set(key, {
                    option,
                    user_id: sender_id,
                    votes,
                });

                // I may have added a poll option from another device.
                if (sender_id === this.me && this.my_idx <= idx) {
                    this.my_idx = idx + 1;
                }
            },
        },

        question: {
            outbound: (question) => {
                const event = {
                    type: "question",
                    question,
                };
                if (this.is_my_poll) {
                    return event;
                }
                return undefined;
            },

            inbound: (sender_id, data) => {
                // Only the message author can edit questions.
                if (sender_id !== this.message_sender_id) {
                    this.report_error_function(
                        `user ${sender_id} is not allowed to edit the question`,
                    );
                    return;
                }

                if (typeof data.question !== "string") {
                    this.report_error_function("poll widget: bad type for inbound question");
                    return;
                }

                this.set_question(data.question);
            },
        },

        vote: {
            outbound: (key) => {
                let vote = 1;

                // toggle
                if (this.key_to_option.get(key).votes.get(this.me)) {
                    vote = -1;
                }

                const event = {
                    type: "vote",
                    key,
                    vote,
                };

                return event;
            },

            inbound: (sender_id, data) => {
                // All message readers may vote on poll options.
                const key = data.key;
                const vote = data.vote;

                if (typeof key !== "string") {
                    this.report_error_function("poll widget: bad type for inbound vote key");
                    return;
                }

                if (!Number.isInteger(vote) || !(vote === 1 || vote === -1)) {
                    this.report_error_function("poll widget: bad value for inbound vote count");
                    return;
                }

                const option = this.key_to_option.get(key);

                if (option === undefined) {
                    this.report_error_function("unknown key for poll: " + key);
                    return;
                }

                const votes = option.votes;

                if (vote === 1) {
                    votes.set(sender_id, 1);
                } else {
                    votes.delete(sender_id);
                }
            },
        },
    };

    handle_event(sender_id, data) {
        const type = data.type;
        if (this.handle[type] && this.handle[type].inbound) {
            this.handle[type].inbound(sender_id, data);
        } else {
            this.report_error_function(`poll widget: unknown inbound type: ${type}`);
        }
    }

    // function to check whether option already exists
    is_option_present(data, latest_option) {
        return data.some((el) => el.option === latest_option);
    }
}


/***/ }),

/***/ "./static/shared/js/resolved_topic.js":
/*!********************************************!*\
  !*** ./static/shared/js/resolved_topic.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "RESOLVED_TOPIC_PREFIX": () => (/* binding */ RESOLVED_TOPIC_PREFIX),
/* harmony export */   "display_parts": () => (/* binding */ display_parts),
/* harmony export */   "is_resolved": () => (/* binding */ is_resolved),
/* harmony export */   "resolve_name": () => (/* binding */ resolve_name),
/* harmony export */   "unresolve_name": () => (/* binding */ unresolve_name)
/* harmony export */ });
/** The canonical form of the resolved-topic prefix. */
const RESOLVED_TOPIC_PREFIX = "✔ ";

/**
 * Pattern for an arbitrary resolved-topic prefix.
 *
 * These always begin with the canonical prefix, but can go on longer.
 */
// The class has the same characters as RESOLVED_TOPIC_PREFIX.
// It's designed to remove a weird "✔ ✔✔ " prefix, if present.
// Compare maybe_send_resolve_topic_notifications in zerver/actions/message_edit.py.
const RESOLVED_TOPIC_PREFIX_RE = /^✔ [ ✔]*/;

function is_resolved(topic_name) {
    return topic_name.startsWith(RESOLVED_TOPIC_PREFIX);
}

function resolve_name(topic_name) {
    return RESOLVED_TOPIC_PREFIX + topic_name;
}

/**
 * The un-resolved form of this topic name.
 *
 * If the topic is already not a resolved topic, this is the identity.
 */
function unresolve_name(topic_name) {
    return topic_name.replace(RESOLVED_TOPIC_PREFIX_RE, "");
}

/**
 * Split the topic name for display, into a "resolved" prefix and remainder.
 *
 * The prefix is always the canonical resolved-topic prefix, or empty.
 *
 * This function is injective: different topics never produce the same
 * result, even when `unresolve_name` would give the same result.  That's a
 * property we want when listing topics in the UI, so that we don't end up
 * showing what look like several identical topics.
 */
function display_parts(topic_name) {
    return is_resolved(topic_name)
        ? [RESOLVED_TOPIC_PREFIX, topic_name.slice(RESOLVED_TOPIC_PREFIX.length)]
        : ["", topic_name];
}


/***/ }),

/***/ "./static/shared/js/typeahead.js":
/*!***************************************!*\
  !*** ./static/shared/js/typeahead.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "clean_query_lowercase": () => (/* binding */ clean_query_lowercase),
/* harmony export */   "get_emoji_matcher": () => (/* binding */ get_emoji_matcher),
/* harmony export */   "is_unicode_emoji": () => (/* binding */ is_unicode_emoji),
/* harmony export */   "parse_unicode_emoji_code": () => (/* binding */ parse_unicode_emoji_code),
/* harmony export */   "popular_emojis": () => (/* binding */ popular_emojis),
/* harmony export */   "query_matches_string": () => (/* binding */ query_matches_string),
/* harmony export */   "remove_diacritics": () => (/* binding */ remove_diacritics),
/* harmony export */   "sort_emojis": () => (/* binding */ sort_emojis),
/* harmony export */   "triage": () => (/* binding */ triage)
/* harmony export */ });
/*
    We hand selected the following emojis a few years
    ago to be given extra precedence in our typeahead
    algorithms and emoji picker UIs.  We call them "popular"
    emojis for historical reasons, although we've never
    technically measured their popularity (and any
    results now would be biased in favor of the ones
    below, since they've easier to submit).  Nonetheless, it
    is often convenient to quickly find these.  We can
    adjust this list over time; we just need to make
    sure it works well with the emoji picker's layout
    if you increase the number of them.

    For typeahead we'll favor any of these as long as
    the emoji code matches.  For example, we'll show the
    emoji with code 1f44d at the top of your suggestions
    whether you type "+" as a prefix for "+1"
    or "th" as a prefix for "thumbs up".  The caveat is
    that other factors still may matter more, such as
    prefix matches trumping "popularity".
*/
const popular_emojis = [
    "1f44d", // +1
    "1f389", // tada
    "1f642", // smile
    "2764", // heart
    "1f6e0", // working_on_it
    "1f419", // octopus
];

const unicode_marks = /\p{M}/gu;

function remove_diacritics(s) {
    return s.normalize("NFKD").replace(unicode_marks, "");
}

// This function attempts to match a query with a source text.
// * query is the user-entered search query
// * source_str is the string we're matching in, e.g. a user's name
// * split_char is the separator for this syntax (e.g. ' ').
function query_matches_string(query, source_str, split_char) {
    source_str = source_str.toLowerCase();
    source_str = remove_diacritics(source_str);

    if (!query.includes(split_char)) {
        // If query is a single token (doesn't contain a separator),
        // the match can be anywhere in the string.
        return source_str.includes(query);
    }

    // If there is a separator character in the query, then we
    // require the match to start at the start of a token.
    // (E.g. for 'ab cd ef', query could be 'ab c' or 'cd ef',
    // but not 'b cd ef'.)
    return source_str.startsWith(query) || source_str.includes(split_char + query);
}

function clean_query(query) {
    query = remove_diacritics(query);
    // When `abc ` with a space at the end is typed in a
    // contenteditable widget such as the composebox PM section, the
    // space at the end was a `no break-space (U+00A0)` instead of
    // `space (U+0020)`, which lead to no matches in those cases.
    query = query.replace(/\u00A0/g, " ");

    return query;
}

function clean_query_lowercase(query) {
    query = query.toLowerCase();
    query = clean_query(query);
    return query;
}

const is_unicode_emoji = (emoji) =>
    emoji.reaction_type === "unicode_emoji" && emoji.emoji_code;

const parse_unicode_emoji_code = (code) =>
    code
        .split("-")
        .map((hex) => String.fromCodePoint(Number.parseInt(hex, 16)))
        .join("");

function get_emoji_matcher(query) {
    // replace spaces with underscores for emoji matching
    query = query.replace(/ /g, "_");
    query = clean_query_lowercase(query);

    return function (emoji) {
        const matches_emoji_literal =
            is_unicode_emoji(emoji) && parse_unicode_emoji_code(emoji.emoji_code) === query;
        return matches_emoji_literal || query_matches_string(query, emoji.emoji_name, "_");
    };
}

function triage(query, objs, get_item = (x) => x) {
    /*
        We split objs into four groups:

            - entire string exact match
            - match prefix exactly with `query`
            - match prefix case-insensitively
            - other

        Then we concat the first three groups into
        `matches` and then call the rest `rest`.
    */

    const exactMatch = [];
    const beginswithCaseSensitive = [];
    const beginswithCaseInsensitive = [];
    const noMatch = [];
    const lowerQuery = query ? query.toLowerCase() : "";

    for (const obj of objs) {
        const item = get_item(obj);
        const lowerItem = item.toLowerCase();

        if (lowerItem === lowerQuery) {
            exactMatch.push(obj);
        } else if (item.startsWith(query)) {
            beginswithCaseSensitive.push(obj);
        } else if (lowerItem.startsWith(lowerQuery)) {
            beginswithCaseInsensitive.push(obj);
        } else {
            noMatch.push(obj);
        }
    }
    return {
        matches: exactMatch.concat(beginswithCaseSensitive.concat(beginswithCaseInsensitive)),
        rest: noMatch,
    };
}

function sort_emojis(objs, query) {
    // replace spaces with underscores for emoji matching
    query = query.replace(/ /g, "_");
    query = query.toLowerCase();

    function decent_match(name) {
        const pieces = name.toLowerCase().split("_");
        return pieces.some((piece) => piece.startsWith(query));
    }

    const popular_set = new Set(popular_emojis);

    function is_popular(obj) {
        return popular_set.has(obj.emoji_code) && decent_match(obj.emoji_name);
    }

    const popular_emoji_matches = objs.filter((obj) => is_popular(obj));
    const others = objs.filter((obj) => !is_popular(obj));

    const triage_results = triage(query, others, (x) => x.emoji_name);

    return [...popular_emoji_matches, ...triage_results.matches, ...triage_results.rest];
}


/***/ }),

/***/ "./static/templates/about_zulip.hbs":
/*!******************************************!*\
  !*** ./static/templates/about_zulip.hbs ***!
  \******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"about-zulip\" class=\"overlay flex new-style\" tabindex=\"-1\" role=\"dialog\" data-overlay=\"about-zulip\" aria-hidden=\"true\">\n|     <div class=\"overlay-content modal-bg\">\n|         <button type=\"button\" class=\"exit\" aria-label=\"{{t 'Close' }}\"><span aria-hidden=\"true\">&times;</span></button>");

/***/ }),

/***/ "./static/templates/actions_popover_content.hbs":
/*!******************************************************!*\
  !*** ./static/templates/actions_popover_content.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"message actions\" popup }}\n| <ul class=\"nav nav-list actions_popover\">\n|     {{#if should_display_quote_and_reply}}");

/***/ }),

/***/ "./static/templates/all_messages_sidebar_actions.hbs":
/*!***********************************************************!*\
  !*** ./static/templates/all_messages_sidebar_actions.hbs ***!
  \***********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"all messages sidebar\" popup }}\n| <ul class=\"nav nav-list\">\n|     <li>");

/***/ }),

/***/ "./static/templates/announce_stream_docs.hbs":
/*!***************************************************!*\
  !*** ./static/templates/announce_stream_docs.hbs ***!
  \***************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Explanation of what \"announce stream\" does when creating a stream }}\n| <div>\n| ");

/***/ }),

/***/ "./static/templates/bookend.hbs":
/*!**************************************!*\
  !*** ./static/templates/bookend.hbs ***!
  \**************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering the trailing bookend.}}\n| <div class=\"{{#if is_trailing_bookend}}trailing_bookend {{/if}}bookend sub-unsub-message\">\n|     {{#if is_spectator}}");

/***/ }),

/***/ "./static/templates/change_email_modal.hbs":
/*!*************************************************!*\
  !*** ./static/templates/change_email_modal.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form id=\"change_email_container\" class=\"new-style\">\n|     <label for=\"email\">{{t \"New email\" }}</label>\n|     <input type=\"text\" name=\"email\" value=\"{{ page_params.delivery_email }}\" autocomplete=\"off\" spellcheck=\"false\" autofocus=\"autofocus\"/>");

/***/ }),

/***/ "./static/templates/compose_banner/compose_banner.hbs":
/*!************************************************************!*\
  !*** ./static/templates/compose_banner/compose_banner.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div\n|   class=\"compose_banner {{banner_type}} {{classname}}\"\n|   {{#if user_id}}data-user-id=\"{{user_id}}\"{{/if}}");

/***/ }),

/***/ "./static/templates/compose_banner/message_sent_banner.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/compose_banner/message_sent_banner.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"compose-notifications-content\">\n|     {{note}} {{#if link_class}}<a href=\"{{above_composebox_narrow_url}}\" class=\"{{link_class}}\" data-message-id=\"{{link_msg_id}}\">{{link_text}}</a>{{/if}}\n|     <button type=\"button\" class=\"out-of-view-notification-close close\">&times;</button>");

/***/ }),

/***/ "./static/templates/compose_banner/not_subscribed_warning.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/compose_banner/not_subscribed_warning.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected character '>' (1:3)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#> compose_banner }}\n|     {{#if can_subscribe_other_users}}\n|         <p>{{#tr}}<strong>{name}</strong> is not subscribed to this stream. They will not be notified unless you subscribe them.{{/tr}}</p>");

/***/ }),

/***/ "./static/templates/compose_banner/private_stream_warning.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/compose_banner/private_stream_warning.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected character '>' (1:3)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#> compose_banner }}\n|     <p>{{#tr}}Warning: <strong>#{stream_name}</strong> is a private stream.{{/tr}}</p>\n| {{/compose_banner}}");

/***/ }),

/***/ "./static/templates/compose_banner/wildcard_warning.hbs":
/*!**************************************************************!*\
  !*** ./static/templates/compose_banner/wildcard_warning.hbs ***!
  \**************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected character '>' (1:3)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#> compose_banner }}\n|     <p>\n|         {{#tr}}");

/***/ }),

/***/ "./static/templates/compose_control_buttons_popover.hbs":
/*!**************************************************************!*\
  !*** ./static/templates/compose_control_buttons_popover.hbs ***!
  \**************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"compose_control_buttons_container order-1\">\n|     {{> compose_control_buttons_in_popover}}\n| </div>");

/***/ }),

/***/ "./static/templates/compose_select_enter_behaviour_popover.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/compose_select_enter_behaviour_popover.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"enter_sends_choices grey-box\">\n|     <label class=\"enter_sends_choice\">\n|         <input type=\"radio\" class=\"prop-element\" value=\"true\"{{#if enter_sends_true }} checked{{/if}} />");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_bot.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_bot.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"A deactivated bot cannot send messages, access data, or take any other action.\" }}</p>\n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_custom_emoji.hbs":
/*!*****************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_custom_emoji.hbs ***!
  \*****************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"A deactivated emoji will remain visible in existing messages and emoji reactions, but cannot be used on new messages.\"}}</p>\n| <p>{{t \"This action cannot be undone.\"}}</p>\n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_own_user.hbs":
/*!*************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_own_user.hbs ***!
  \*************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{#tr}}By deactivating your account, you will be logged out immediately.{{/tr}}</p>\n| <p>{{t \"Note that any bots that you maintain will be disabled.\" }}</p>\n| <p>{{t \"Are you sure you want to deactivate your account?\"}}</p>");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_realm.hbs":
/*!**********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_realm.hbs ***!
  \**********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"This action is permanent and cannot be undone. All users will permanently lose access to their Zulip accounts.\" }}</p>\n| <p>{{t \"Are you sure you want to deactivate this organization?\"}}</p>\n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_stream.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_stream.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#tr}}\n|     Archiving stream <z-stream></z-stream> will immediately unsubscribe everyone. This action cannot be undone.\n|     {{#*inline \"z-stream\"}}<strong>{{{stream_privacy_symbol_html}}}{{stream_name}}</strong>{{/inline}}");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_deactivate_user.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_deactivate_user.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|         When you deactivate <z-user></z-user>, they will be immediately logged out.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_all_drafts.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_all_drafts.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Are you sure you want to delete all drafts?  This action cannot be undone.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_attachment.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_attachment.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#tr}}\n|     <p><strong>{file_name}</strong> will be removed from the messages where it was shared. This action cannot be undone.</p>\n| {{/tr}}");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_data_export.hbs":
/*!************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_data_export.hbs ***!
  \************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"This action cannot be undone.\"}}</p>\n| \n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_linkifier.hbs":
/*!**********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_linkifier.hbs ***!
  \**********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"This action cannot be undone.\"}}</p>\n| \n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_message.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_message.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"Deleting a message permanently removes it for everyone.\"}}</p>\n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_playground.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_playground.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{t \"This action cannot be undone.\"}}</p>\n| \n| ");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_profile_field.hbs":
/*!**************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_profile_field.hbs ***!
  \**************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if (eq count 1)}}\n|     {{#tr}}\n|         This will delete the <z-profile-field-name></z-profile-field-name> profile field for 1 user.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_profile_field_option.hbs":
/*!*********************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_profile_field_option.hbs ***!
  \*********************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#if (eq count 1)}}\n|         {{#tr}}");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_topic.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_topic.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{t \"Deleting a topic will immediately remove it and its messages for everyone. Other users may find this confusing, especially if they had received an email or push notification related to the deleted messages.\" }}\n| </p>");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_user.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_user.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     This action cannot be undone.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_delete_user_avatar.hbs":
/*!************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_delete_user_avatar.hbs ***!
  \************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Are you sure you want to delete your profile picture?");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_emoji_settings_warning.hbs":
/*!****************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_emoji_settings_warning.hbs ***!
  \****************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Uploading a custom emoji with this name will override the built-in emoji.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_mute_user.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_mute_user.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Are you sure you want to mute <b>{user_name}</b>?  Messages sent by muted users will never trigger notifications, will be marked as read, and will be hidden.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_reactivate_bot.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_reactivate_bot.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     <z-user></z-user> will have the same properties as it did prior to deactivation,");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_reactivate_user.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_reactivate_user.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     <z-user></z-user> will have the same role, stream subscriptions,");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_resend_invite.hbs":
/*!*******************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_resend_invite.hbs ***!
  \*******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|         Are you sure you want to resend the invitation to <z-email></z-email>?");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_revoke_invite.hbs":
/*!*******************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_revoke_invite.hbs ***!
  \*******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if is_multiuse}}\n| <p>{{#tr}}Are you sure you want to revoke this invitation link created by <strong>{referred_by}</strong>?{{/tr}}</p>\n| {{else}}");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_subscription_invites_warning.hbs":
/*!**********************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_subscription_invites_warning.hbs ***!
  \**********************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Are you sure you want to create stream ''''{stream_name}'''' and subscribe {count} users to it?");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_unstar_all_messages.hbs":
/*!*************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_unstar_all_messages.hbs ***!
  \*************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     Are you sure you want to unstar all starred messages?  This action cannot be undone.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_unstar_all_messages_in_topic.hbs":
/*!**********************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_unstar_all_messages_in_topic.hbs ***!
  \**********************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|         Are you sure you want to unstar all messages in <stream-topic></stream-topic>?  This action cannot be undone.");

/***/ }),

/***/ "./static/templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs":
/*!********************************************************************************!*\
  !*** ./static/templates/confirm_dialog/confirm_unsubscribe_private_stream.hbs ***!
  \********************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>{{message}}</p>\n| ");

/***/ }),

/***/ "./static/templates/copy_code_button.hbs":
/*!***********************************************!*\
  !*** ./static/templates/copy_code_button.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <button class=\"btn pull-left copy_button_base copy_codeblock\" data-tippy-content=\"{{t 'Copy code' }}\" aria-label=\"{{t 'Copy code' }}\">\n|     {{> copy_to_clipboard_svg }}\n| </button>");

/***/ }),

/***/ "./static/templates/copy_invite_link.hbs":
/*!***********************************************!*\
  !*** ./static/templates/copy_invite_link.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:4)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{t \"Link:\" }}\n| <a href=\"{{ invite_link }}\" id=\"multiuse_invite_link\">{{ invite_link }}</a>\n| &nbsp;");

/***/ }),

/***/ "./static/templates/default_language_modal.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/default_language_modal.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p>\n|     {{#tr}}\n|     A language is marked as 100% translated only if every string in the web, desktop,");

/***/ }),

/***/ "./static/templates/dialog_change_password.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/dialog_change_password.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form id=\"change_password_container\">\n|     <div class=\"field password-div\">\n|         <label for=\"old_password\" class=\"title\">{{t \"Old password\" }}</label>");

/***/ }),

/***/ "./static/templates/dialog_widget.hbs":
/*!********************************************!*\
  !*** ./static/templates/dialog_widget.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"micromodal\" id=\"dialog_widget_modal\" aria-hidden=\"true\">\n|     <div class=\"modal__overlay\" tabindex=\"-1\">\n|         <div {{#if id}}id=\"{{id}}\" {{/if}}class=\"modal__container\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"dialog_title\" data-simplebar>");

/***/ }),

/***/ "./static/templates/draft_table_body.hbs":
/*!***********************************************!*\
  !*** ./static/templates/draft_table_body.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"draft_overlay\" class=\"overlay new-style\" data-overlay=\"drafts\">\n|     <div class=\"flex overlay-content\">\n|         <div class=\"drafts-container modal-bg\">");

/***/ }),

/***/ "./static/templates/drafts_sidebar_action.hbs":
/*!****************************************************!*\
  !*** ./static/templates/drafts_sidebar_action.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"drafts sidebar\" popup }}\n| <ul class=\"nav nav-list\">\n|     <li>");

/***/ }),

/***/ "./static/templates/emoji_popover.hbs":
/*!********************************************!*\
  !*** ./static/templates/emoji_popover.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"popover {{class}}\">\n|     <div class=\"arrow\"></div>\n|     <div class=\"popover-content\">");

/***/ }),

/***/ "./static/templates/emoji_popover_content.hbs":
/*!****************************************************!*\
  !*** ./static/templates/emoji_popover_content.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"emoji-popover\">\n|     <div class=\"emoji-popover-top\">\n|         <input class=\"emoji-popover-filter\" type=\"text\" autofocus placeholder=\"{{t 'Search' }}\" />");

/***/ }),

/***/ "./static/templates/emoji_popover_search_results.hbs":
/*!***********************************************************!*\
  !*** ./static/templates/emoji_popover_search_results.hbs ***!
  \***********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#each search_results}}\n|     {{> emoji_popover_emoji type=\"emoji_search_result\" section=\"0\" index=@index message_id=../message_id is_status_emoji_popover=../is_status_emoji_popover emoji_dict=this }}\n| {{/each}}");

/***/ }),

/***/ "./static/templates/emoji_showcase.hbs":
/*!*********************************************!*\
  !*** ./static/templates/emoji_showcase.hbs ***!
  \*********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with emoji_dict}}\n| <div class=\"emoji-showcase\">\n|     {{#if is_realm_emoji}}");

/***/ }),

/***/ "./static/templates/empty_feed_notice.hbs":
/*!************************************************!*\
  !*** ./static/templates/empty_feed_notice.hbs ***!
  \************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"empty_feed_notice\">\n|     <h4> {{ title }} </h4>\n|     {{#if (or search_data.query_words search.topic_query search_data.stream_query)}}");

/***/ }),

/***/ "./static/templates/favicon.svg.hbs":
/*!******************************************!*\
  !*** ./static/templates/favicon.svg.hbs ***!
  \******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\">\n|     <style>\n|         @font-face {");

/***/ }),

/***/ "./static/templates/feedback_container.hbs":
/*!*************************************************!*\
  !*** ./static/templates/feedback_container.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"float-header\">\n|     <h3 class=\"light no-margin small-line-height float-left feedback_title\"></h3>\n|     <div class=\"exit-me float-right\">&#215;</div>");

/***/ }),

/***/ "./static/templates/filter_topics.hbs":
/*!********************************************!*\
  !*** ./static/templates/filter_topics.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"input-append topic_search_section filter-topics\">\n|     <input class=\"topic-list-filter home-page-input\" id=\"filter-topic-input\" type=\"text\" autocomplete=\"off\" placeholder=\"{{t 'Filter topics'}}\" />\n|     <button type=\"button\" class=\"btn clear_search_button\" id=\"clear_search_topic_button\">");

/***/ }),

/***/ "./static/templates/gear_menu.hbs":
/*!****************************************!*\
  !*** ./static/templates/gear_menu.hbs ***!
  \****************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul class=\"nav\" role=\"navigation\">\n|     <li class=\"dropdown actual-dropdown-menu\" id=\"gear-menu\">\n|         <a id=\"settings-dropdown\" tabindex=\"0\" role=\"button\" class=\"dropdown-toggle\" data-target=\"nada\" data-toggle=\"dropdown\" title=\"{{t 'Menu' }} (g)\">");

/***/ }),

/***/ "./static/templates/giphy_picker.hbs":
/*!*******************************************!*\
  !*** ./static/templates/giphy_picker.hbs ***!
  \*******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"popover\" id=\"giphy_grid_in_popover\">\n|     <div class=\"arrow\"></div>\n|     <div class=\"popover-inner\">");

/***/ }),

/***/ "./static/templates/giphy_picker_mobile.hbs":
/*!**************************************************!*\
  !*** ./static/templates/giphy_picker_mobile.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class='popover-flex'>\n|     {{> giphy_picker }}\n| </div>");

/***/ }),

/***/ "./static/templates/hotspot_icon.hbs":
/*!*******************************************!*\
  !*** ./static/templates/hotspot_icon.hbs ***!
  \*******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"hotspot-icon\" id=\"hotspot_{{name}}_icon\">\n|     <span class=\"dot\"></span>\n|     <span class=\"pulse\"></span>");

/***/ }),

/***/ "./static/templates/hotspot_overlay.hbs":
/*!**********************************************!*\
  !*** ./static/templates/hotspot_overlay.hbs ***!
  \**********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"hotspot_{{name}}_overlay\" class=\"hotspot overlay\" data-overlay=\"hotspot_{{name}}_overlay\">\n|     <div class=\"hotspot-popover\">\n|         <div class=\"hotspot-popover-top\">");

/***/ }),

/***/ "./static/templates/input_pill.hbs":
/*!*****************************************!*\
  !*** ./static/templates/input_pill.hbs ***!
  \*****************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class='pill {{#if deactivated}} deactivated-pill {{/if}}' tabindex=0>\n|     {{#if has_image}}\n|     <img class=\"pill-image\" src=\"{{img_src}}\" />");

/***/ }),

/***/ "./static/templates/invitation_failed_error.hbs":
/*!******************************************************!*\
  !*** ./static/templates/invitation_failed_error.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p id=\"invitation_error_message\">{{ error_message }}</p>\n| {{#if daily_limit_reached}}\n|     {{#tr}}");

/***/ }),

/***/ "./static/templates/invite_subscription.hbs":
/*!**************************************************!*\
  !*** ./static/templates/invite_subscription.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering subscriptions in the \"invite user\" form.}}\n| <div class=\"invite-stream-controls\">\n|     <button class=\"btn btn-link\" type=\"button\" id=\"invite_check_all_button\">{{t \"Check all\" }}</button> |");

/***/ }),

/***/ "./static/templates/invite_user.hbs":
/*!******************************************!*\
  !*** ./static/templates/invite_user.hbs ***!
  \******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"invite-user\" class=\"overlay flex new-style\" tabindex=\"-1\" role=\"dialog\" data-overlay=\"invite\"\n|   aria-labelledby=\"invite-user-label\" aria-hidden=\"true\">\n|     <div class=\"overlay-content modal-bg\">");

/***/ }),

/***/ "./static/templates/keyboard_shortcuts.hbs":
/*!*************************************************!*\
  !*** ./static/templates/keyboard_shortcuts.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"overlay-modal\" id=\"keyboard-shortcuts\" tabindex=\"-1\" role=\"dialog\"\n|   aria-label=\"{{t 'Keyboard shortcuts' }}\">\n|     <div class=\"modal-body\" data-simplebar data-simplebar-auto-hide=\"false\">");

/***/ }),

/***/ "./static/templates/left_sidebar_stream_setting_popover.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/left_sidebar_stream_setting_popover.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul class=\"nav nav-list\">\n|     <li>\n|         <a href=\"#streams/all\" class=\"navigate_and_close_popover\">");

/***/ }),

/***/ "./static/templates/lightbox_overlay.hbs":
/*!***********************************************!*\
  !*** ./static/templates/lightbox_overlay.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"lightbox_overlay\" class=\"overlay new-style\" data-overlay=\"lightbox\" data-noclose=\"false\">\n|     <div class=\"image-info-wrapper\">\n|         <div class=\"image-description\">");

/***/ }),

/***/ "./static/templates/login_to_access.hbs":
/*!**********************************************!*\
  !*** ./static/templates/login_to_access.hbs ***!
  \**********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"micromodal\" id=\"login_to_access_modal\" aria-hidden=\"true\">\n|     <div class=\"modal__overlay\" tabindex=\"-1\">\n|         <div class=\"modal__container\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"login_to_access_modal_label\">");

/***/ }),

/***/ "./static/templates/login_to_view_image_button.hbs":
/*!*********************************************************!*\
  !*** ./static/templates/login_to_view_image_button.hbs ***!
  \*********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"spectator_login_for_image_button\">\n|     <a class=\"login_button color_animated_button\" href=\"/login/\">\n|         <i class='fa fa-sign-in'></i>");

/***/ }),

/***/ "./static/templates/mark_as_read_turned_off_banner.hbs":
/*!*************************************************************!*\
  !*** ./static/templates/mark_as_read_turned_off_banner.hbs ***!
  \*************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <p id=\"mark_as_read_turned_off_content\">\n|     {{t 'To preserve your reading state, this view does not mark messages as read.' }}\n| </p>");

/***/ }),

/***/ "./static/templates/markdown_help.hbs":
/*!********************************************!*\
  !*** ./static/templates/markdown_help.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"overlay-modal hide\" id=\"message-formatting\" tabindex=\"-1\" role=\"dialog\"\n|   aria-label=\"{{t 'Message formatting' }}\">\n|     <div class=\"modal-body\" data-simplebar data-simplebar-auto-hide=\"false\">");

/***/ }),

/***/ "./static/templates/markdown_timestamp.hbs":
/*!*************************************************!*\
  !*** ./static/templates/markdown_timestamp.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <i class=\"fa fa-clock-o\"></i>\n| {{ text }}\n| ");

/***/ }),

/***/ "./static/templates/message_edit_form.hbs":
/*!************************************************!*\
  !*** ./static/templates/message_edit_form.hbs ***!
  \************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering the message edit form. }}\n| \n| <form id=\"edit_form_{{message_id}}\" class=\"new-style\">");

/***/ }),

/***/ "./static/templates/message_edit_history.hbs":
/*!***************************************************!*\
  !*** ./static/templates/message_edit_history.hbs ***!
  \***************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for viewing message edit history.}}\n| \n| {{#each edited_messages}}");

/***/ }),

/***/ "./static/templates/message_group.hbs":
/*!********************************************!*\
  !*** ./static/templates/message_group.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering messages.}}\n| \n| {{#each message_groups}}");

/***/ }),

/***/ "./static/templates/message_history_modal.hbs":
/*!****************************************************!*\
  !*** ./static/templates/message_history_modal.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"controls\" id=\"message-history\"></div>\n| ");

/***/ }),

/***/ "./static/templates/message_reaction.hbs":
/*!***********************************************!*\
  !*** ./static/templates/message_reaction.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"{{this.class}}\" aria-label=\"{{this.label}}\" data-reaction-id=\"{{this.local_id}}\">\n|     {{#if this.emoji_alt_code}}\n|         <div class=\"emoji_alt_code\">&nbsp:{{this.emoji_name}}:</div>");

/***/ }),

/***/ "./static/templates/message_view_header.hbs":
/*!**************************************************!*\
  !*** ./static/templates/message_view_header.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if stream_settings_link}}\n| <a class=\"stream\" href=\"{{stream_settings_link}}\">\n|     {{> navbar_icon_and_title }}");

/***/ }),

/***/ "./static/templates/mobile_message_buttons_popover_content.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/mobile_message_buttons_popover_content.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul class=\"nav nav-list\">\n|     <li>\n|         <a class=\"compose_mobile_stream_button\">");

/***/ }),

/***/ "./static/templates/more_pms.hbs":
/*!***************************************!*\
  !*** ./static/templates/more_pms.hbs ***!
  \***************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li id=\"show_more_private_messages\" class=\"pm-list-item bottom_left_row {{#unless more_conversations_unread_count}}zero-pm-unreads{{/unless}}\">\n|     <span>\n|         <a class=\"pm-name\" tabindex=\"0\">{{t \"more conversations\" }}</a>");

/***/ }),

/***/ "./static/templates/more_topics.hbs":
/*!******************************************!*\
  !*** ./static/templates/more_topics.hbs ***!
  \******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li class=\"topic-list-item show-more-topics bottom_left_row {{#unless more_topics_unreads}}zero-topic-unreads{{/unless}}\">\n|     <span class='topic-box'>\n|         <a class=\"topic-name\" tabindex=\"0\">{{t \"more topics\" }}</a>");

/***/ }),

/***/ "./static/templates/more_topics_spinner.hbs":
/*!**************************************************!*\
  !*** ./static/templates/more_topics_spinner.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li class=\"searching-for-more-topics\">\n|     <img src=\"/static/images/loading/loading-ellipsis.svg\" alt=\"\" />\n| </li>");

/***/ }),

/***/ "./static/templates/move_topic_to_stream.hbs":
/*!***************************************************!*\
  !*** ./static/templates/move_topic_to_stream.hbs ***!
  \***************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#unless from_message_actions_popover}}\n| <p>{{#tr}}Move all messages in <strong>{topic_name}</strong>{{/tr}} to:</p>\n| {{/unless}}");

/***/ }),

/***/ "./static/templates/muted_topic_ui_row.hbs":
/*!*************************************************!*\
  !*** ./static/templates/muted_topic_ui_row.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with muted_topic}}\n| <tr data-stream-id=\"{{stream_id}}\" data-stream=\"{{stream}}\" data-topic=\"{{topic}}\" data-date-muted=\"{{date_muted_str}}\">\n|     <td>{{stream}}</td>");

/***/ }),

/***/ "./static/templates/muted_user_ui_row.hbs":
/*!************************************************!*\
  !*** ./static/templates/muted_user_ui_row.hbs ***!
  \************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with muted_user}}\n| <tr data-user-id=\"{{user_id}}\" data-user-name=\"{{user_name}}\" data-date-muted=\"{{date_muted_str}}\">\n|     <td>{{user_name}}</td>");

/***/ }),

/***/ "./static/templates/navbar_alerts/bankruptcy.hbs":
/*!*******************************************************!*\
  !*** ./static/templates/navbar_alerts/bankruptcy.hbs ***!
  \*******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{#tr}}\n|         Welcome back!  You have <z-link>{unread_msgs_count}</z-link> unread messages.");

/***/ }),

/***/ "./static/templates/navbar_alerts/configure_outgoing_email.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/navbar_alerts/configure_outgoing_email.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{t \"Zulip needs to send email to confirm users' addresses and send notifications.\"}}\n|     <a class=\"alert-link\" href=\"https://zulip.readthedocs.io/en/latest/production/email.html\" target=\"_blank\" rel=\"noopener noreferrer\">");

/***/ }),

/***/ "./static/templates/navbar_alerts/demo_organization_deadline.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/navbar_alerts/demo_organization_deadline.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{#tr}}\n|         This is a <z-link>demo organization</z-link> and will be automatically deleted in {days_remaining} days.");

/***/ }),

/***/ "./static/templates/navbar_alerts/desktop_notifications.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/navbar_alerts/desktop_notifications.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{#tr}}Zulip needs your permission to <z-link>enable desktop notifications.</z-link>\n|         {{#*inline \"z-link\"}}<a class=\"request-desktop-notifications alert-link\" role=\"button\" tabindex=0>{{> @partial-block}}</a>{{/inline}}");

/***/ }),

/***/ "./static/templates/navbar_alerts/insecure_desktop_app.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/navbar_alerts/insecure_desktop_app.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{t \"You are using an old version of the Zulip desktop app with known security bugs.\" }}\n|     <a class=\"alert-link\" href=\"https://zulip.com/apps\" target=\"_blank\" rel=\"noopener noreferrer\">");

/***/ }),

/***/ "./static/templates/navbar_alerts/navbar_alert_wrapper.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/navbar_alerts/navbar_alert_wrapper.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-process=\"{{data_process}}\" class=\"alert alert-info {{custom_class}}\">\n|     {{{rendered_alert_content_html}}}\n|     <span class=\"close\" data-dismiss=\"alert\" aria-label=\"{{t 'Close' }}\" role=\"button\" tabindex=0>&times;</span>");

/***/ }),

/***/ "./static/templates/navbar_alerts/profile_incomplete.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/navbar_alerts/profile_incomplete.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{#tr}}\n|         Complete the <z-link>organization profile</z-link>");

/***/ }),

/***/ "./static/templates/navbar_alerts/server_needs_upgrade.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/navbar_alerts/server_needs_upgrade.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div data-step=\"1\">\n|     {{t \"This Zulip server is running an old version and should be upgraded.\" }}\n|     <span class=\"buttons\">");

/***/ }),

/***/ "./static/templates/no_arrow_popover.hbs":
/*!***********************************************!*\
  !*** ./static/templates/no_arrow_popover.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"popover {{class}}\">\n|     <div class=\"popover-inner\">\n|         <div class=\"popover-title\"></div>");

/***/ }),

/***/ "./static/templates/playground_links_popover_content.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/playground_links_popover_content.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of \"view code in playground\" popover for code blocks}}\n| <ul class=\"nav nav-list\">\n|     {{#each playground_info}}");

/***/ }),

/***/ "./static/templates/pm_list_item.hbs":
/*!*******************************************!*\
  !*** ./static/templates/pm_list_item.hbs ***!
  \*******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li class='{{#if is_active}}active-sub-filter{{/if}} {{#if is_zero}}zero-pm-unreads{{/if}} pm-list-item bottom_left_row' data-user-ids-string='{{user_ids_string}}'>\n|     <span class='pm-box' id='pm_user_status' data-user-ids-string='{{user_ids_string}}' data-is-group='{{is_group}}'>\n| ");

/***/ }),

/***/ "./static/templates/presence_row.hbs":
/*!*******************************************!*\
  !*** ./static/templates/presence_row.hbs ***!
  \*******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li data-user-id=\"{{user_id}}\" class=\"user_sidebar_entry {{#if is_current_user}}user_sidebar_entry_me {{/if}}{{#if num_unread}} user-with-count {{/if}} narrow-filter {{#if faded}} user-fade {{/if}}\">\n|     <div class=\"selectable_sidebar_block\">\n|         <span class=\"{{user_circle_class}} user_circle\"></span>");

/***/ }),

/***/ "./static/templates/presence_rows.hbs":
/*!********************************************!*\
  !*** ./static/templates/presence_rows.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#each presence_rows}}\n|     {{> presence_row}}\n| {{/each}}");

/***/ }),

/***/ "./static/templates/read_receipts.hbs":
/*!********************************************!*\
  !*** ./static/templates/read_receipts.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul id=\"read_receipts_list\">\n|     {{#each users}}\n|         <li class=\"view_user_profile\" data-user-id=\"{{user_id}}\" tabindex=\"0\" role=\"button\">");

/***/ }),

/***/ "./static/templates/read_receipts_modal.hbs":
/*!**************************************************!*\
  !*** ./static/templates/read_receipts_modal.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"micromodal\" id=\"read_receipts_modal\" aria-hidden=\"true\">\n|     <div class=\"modal__overlay\" tabindex=\"-1\">\n|         <div class=\"modal__container\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"read_receipts_modal_label\">");

/***/ }),

/***/ "./static/templates/recent_topic_row.hbs":
/*!***********************************************!*\
  !*** ./static/templates/recent_topic_row.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr id=\"recent_conversation:{{conversation_key}}\" class=\"{{#if unread_count}}unread_topic{{/if}} {{#if is_private}}private_conversation_row{{/if}}\" data-unread-count=\"{{unread_count}}\" data-muted=\"{{muted}}\" data-participated=\"{{participated}}\" data-private=\"{{is_private}}\">\n|     <td class=\"recent_topic_stream\">\n|         <div class=\"flex_container flex_container_pm\">");

/***/ }),

/***/ "./static/templates/recent_topics_filters.hbs":
/*!****************************************************!*\
  !*** ./static/templates/recent_topics_filters.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <button data-filter=\"all\" type=\"button\" class=\"btn btn-default btn-recent-filters\">{{t 'All' }}</button>\n| <button data-filter=\"include_private\" type=\"button\" class=\"btn btn-default btn-recent-filters {{#if is_spectator}}fake_disabled_button{{/if}}\" role=\"checkbox\" aria-checked=\"true\">\n|     {{#if filter_pm}}");

/***/ }),

/***/ "./static/templates/recent_topics_table.hbs":
/*!**************************************************!*\
  !*** ./static/templates/recent_topics_table.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"recent_topics_filter_buttons\" class=\"btn-group\" role=\"group\">\n|     <div id=\"recent_filters_group\">\n|         {{> recent_topics_filters}}");

/***/ }),

/***/ "./static/templates/recipient_row.hbs":
/*!********************************************!*\
  !*** ./static/templates/recipient_row.hbs ***!
  \********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if is_stream}}\n| <div class=\"message_header message_header_stream right_part\">\n|     <div class=\"message-header-wrapper\">");

/***/ }),

/***/ "./static/templates/search_list_item.hbs":
/*!***********************************************!*\
  !*** ./static/templates/search_list_item.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"search_list_item\">\n|     <span>{{{ description_html }}}</span>\n|     {{#if is_person}}");

/***/ }),

/***/ "./static/templates/search_operators.hbs":
/*!***********************************************!*\
  !*** ./static/templates/search_operators.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"overlay-modal hide\" id=\"search-operators\" tabindex=\"-1\" role=\"dialog\" aria-label=\"{{t 'Search filters' }}\">\n|     <div class=\"modal-body\" data-simplebar data-simplebar-auto-hide=\"false\">\n|         <div id=\"operators-instructions\">");

/***/ }),

/***/ "./static/templates/set_status_overlay.hbs":
/*!*************************************************!*\
  !*** ./static/templates/set_status_overlay.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"new-style user_status_content_wrapper\">\n|     <div class=\"status_emoji_wrapper tippy-zulip-tooltip\"  data-tippy-content=\"{{t 'Select emoji' }}\" data-tippy-placement=\"top\" aria-label=\"{{t 'Select emoji' }}\"  tabindex=\"0\" id=\"selected_emoji\">\n|         {{> status_emoji_selector}}");

/***/ }),

/***/ "./static/templates/settings/add_alert_word.hbs":
/*!******************************************************!*\
  !*** ./static/templates/settings/add_alert_word.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form id=\"add-alert-word-form\" class=\"form-horizontal\">\n|     <label for=\"add-alert-word-name\">{{t \"Alert word\" }}</label>\n|     <input type=\"text\" name=\"alert-word-name\" id=\"add-alert-word-name\" class=\"required\" maxlength=100 placeholder=\"{{t 'Alert word' }}\" value=\"\" />");

/***/ }),

/***/ "./static/templates/settings/add_new_bot_form.hbs":
/*!********************************************************!*\
  !*** ./static/templates/settings/add_new_bot_form.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form id=\"create_bot_form\" class=\"form-horizontal new-style\">\n|     <div class=\"new-bot-form\">\n|         <div class=\"input-group\">");

/***/ }),

/***/ "./static/templates/settings/add_new_custom_profile_field_form.hbs":
/*!*************************************************************************!*\
  !*** ./static/templates/settings/add_new_custom_profile_field_form.hbs ***!
  \*************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form class=\"form-horizontal admin-profile-field-form new-style\" id=\"add-new-custom-profile-field-form\">\n|     <div class=\"new-profile-field-form wrapper\">\n|         <div class=\"input-group\">");

/***/ }),

/***/ "./static/templates/settings/add_user_group_modal.hbs":
/*!************************************************************!*\
  !*** ./static/templates/settings/add_user_group_modal.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <form id=\"add-user-group-form\">\n|     <div>\n|         <label for=\"user_group_name\">{{t \"Name\" }}</label>");

/***/ }),

/***/ "./static/templates/settings/admin_auth_methods_list.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/settings/admin_auth_methods_list.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"method_row\" data-method=\"{{method}}\">\n|     {{> settings_checkbox\n|       setting_name=\"realm_authentication_methods\"");

/***/ }),

/***/ "./static/templates/settings/admin_default_streams_list.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/settings/admin_default_streams_list.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with stream}}\n| <tr class=\"default_stream_row\" data-stream-id=\"{{stream_id}}\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_emoji_list.hbs":
/*!********************************************************!*\
  !*** ./static/templates/settings/admin_emoji_list.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with emoji}}\n| <tr class=\"emoji_row\" id=\"emoji_{{name}}\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_export_list.hbs":
/*!*********************************************************!*\
  !*** ./static/templates/settings/admin_export_list.hbs ***!
  \*********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with realm_export}}\n| <tr class=\"export_row\" id=\"export_{{id}}\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_human_form.hbs":
/*!********************************************************!*\
  !*** ./static/templates/settings/admin_human_form.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"edit-user-form\" data-user-id=\"{{user_id}}\">\n|     <form class=\"form-horizontal name-setting\">\n|         <input type=\"hidden\" name=\"is_full_name\" value=\"true\" />");

/***/ }),

/***/ "./static/templates/settings/admin_invites_list.hbs":
/*!**********************************************************!*\
  !*** ./static/templates/settings/admin_invites_list.hbs ***!
  \**********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with invite}}\n| <tr class=\"invite_row\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_linkifier_edit_form.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/settings/admin_linkifier_edit_form.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"edit-linkifier-form\">\n|     <form class=\"form-horizontal linkifier-edit-form\">\n|         <div class=\"input-group name_change_container\">");

/***/ }),

/***/ "./static/templates/settings/admin_linkifier_list.hbs":
/*!************************************************************!*\
  !*** ./static/templates/settings/admin_linkifier_list.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with linkifier}}\n| <tr class=\"linkifier_row\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_playground_list.hbs":
/*!*************************************************************!*\
  !*** ./static/templates/settings/admin_playground_list.hbs ***!
  \*************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with playground}}\n| <tr class=\"playground_row\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_profile_field_list.hbs":
/*!****************************************************************!*\
  !*** ./static/templates/settings/admin_profile_field_list.hbs ***!
  \****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with profile_field}}\n| <tr class=\"profile-field-row movable-profile-field-row\" data-profile-field-id=\"{{id}}\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings/admin_realm_domains_list.hbs":
/*!****************************************************************!*\
  !*** ./static/templates/settings/admin_realm_domains_list.hbs ***!
  \****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with realm_domain}}\n| <tr>\n|     <td class=\"domain\">{{domain}}</td>");

/***/ }),

/***/ "./static/templates/settings/admin_tab.hbs":
/*!*************************************************!*\
  !*** ./static/templates/settings/admin_tab.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"alert\" id=\"organization-status\"></div>\n| <div id=\"revoke_invite_modal_holder\"></div>\n| ");

/***/ }),

/***/ "./static/templates/settings/admin_user_group_list.hbs":
/*!*************************************************************!*\
  !*** ./static/templates/settings/admin_user_group_list.hbs ***!
  \*************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with user_group}}\n| <div class=\"user-group white-box\" id=\"{{id}}\">\n|     <div class=\"alert user-group-status\"></div>");

/***/ }),

/***/ "./static/templates/settings/admin_user_list.hbs":
/*!*******************************************************!*\
  !*** ./static/templates/settings/admin_user_list.hbs ***!
  \*******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr class=\"user_row{{#unless is_active}} deactivated_user{{/unless}}\" data-user-id=\"{{user_id}}\">\n|     <td>\n|         <span class=\"user_name\" >{{full_name}} {{#if is_current_user}}<span class=\"my_user_status\">{{t '(you)' }}</span>{{/if}}</span>");

/***/ }),

/***/ "./static/templates/settings/alert_word_settings_item.hbs":
/*!****************************************************************!*\
  !*** ./static/templates/settings/alert_word_settings_item.hbs ***!
  \****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:10)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Alert word in the settings page that can be removed }}\n| {{#with alert_word}}\n| <tr class=\"alert-word-item\" data-word='{{word}}'>");

/***/ }),

/***/ "./static/templates/settings/api_key_modal.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/settings/api_key_modal.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"micromodal\" id=\"api_key_modal\" aria-hidden=\"true\">\n|     <div class=\"modal__overlay\" tabindex=\"-1\">\n|         <div class=\"modal__container\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"api_key_modal_label\">");

/***/ }),

/***/ "./static/templates/settings/bot_avatar_row.hbs":
/*!******************************************************!*\
  !*** ./static/templates/settings/bot_avatar_row.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li class=\"bot-information-box white-box\">\n|     <div class=\"image overflow-hidden\">\n|         <img src=\"{{avatar_url}}\" class=\"avatar\" />");

/***/ }),

/***/ "./static/templates/settings/custom_user_profile_field.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/settings/custom_user_profile_field.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"custom_user_field\" name=\"{{ field.name }}\" data-field-id=\"{{ field.id }}\">\n|     <label class=\"inline-block\" for=\"{{ field.name }}\" class=\"title\">{{ field.name }}</label>\n|     <div class=\"alert-notification custom-field-status\"></div>");

/***/ }),

/***/ "./static/templates/settings/dev_env_email_access.hbs":
/*!************************************************************!*\
  !*** ./static/templates/settings/dev_env_email_access.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:3)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> In the development environment, outgoing emails are logged to\n| <a href=\"/emails\">/emails</a>.\n| ");

/***/ }),

/***/ "./static/templates/settings/dropdown_list.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/settings/dropdown_list.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with item}}\n| <li class=\"list_item\" role=\"presentation\" data-value=\"{{value}}\">\n|     <a role=\"menuitem\" tabindex=\"0\">");

/***/ }),

/***/ "./static/templates/settings/edit_bot_form.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/settings/edit_bot_form.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"bot-edit-form\" data-user-id=\"{{user_id}}\" data-email=\"{{email}}\">\n|     <form class=\"new-style edit_bot_form form-horizontal name-setting\">\n|         <div class=\"input-group name_change_container\">");

/***/ }),

/***/ "./static/templates/settings/edit_custom_profile_field_form.hbs":
/*!**********************************************************************!*\
  !*** ./static/templates/settings/edit_custom_profile_field_form.hbs ***!
  \**********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with profile_field_info}}\n| <form class=\"form-horizontal name-setting profile-field-form new-style\" id=\"edit-custom-profile-field-form-{{id}}\">\n|     <div class=\"input-group\">");

/***/ }),

/***/ "./static/templates/settings/edit_embedded_bot_service.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/settings/edit_embedded_bot_service.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"config_edit_inputbox\">\n|     {{#each service.config_data}}\n|         <div class=\"input-group\">");

/***/ }),

/***/ "./static/templates/settings/edit_outgoing_webhook_service.hbs":
/*!*********************************************************************!*\
  !*** ./static/templates/settings/edit_outgoing_webhook_service.hbs ***!
  \*********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"input-group\">\n|     <label for=\"edit_service_base_url\">{{t \"Endpoint URL\" }}</label>\n|     <input id=\"edit_service_base_url\" type=\"text\" name=\"service_payload_url\" class=\"edit_service_base_url required\" value=\"{{service.base_url}}\" maxlength=2083 />");

/***/ }),

/***/ "./static/templates/settings/emoji_settings_tip.hbs":
/*!**********************************************************!*\
  !*** ./static/templates/settings/emoji_settings_tip.hbs ***!
  \**********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if is_guest}}\n|     <div class='tip'>{{t \"Guests cannot edit custom emoji.\" }}</div>\n| {{else if (eq realm_add_custom_emoji_policy policy_values.by_admins_only.code) }}");

/***/ }),

/***/ "./static/templates/settings/organization_settings_tip.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/settings/organization_settings_tip.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#unless is_admin}}\n| <div class='tip'>{{t \"Only organization administrators can edit these settings.\"}}</div>\n| {{/unless}}");

/***/ }),

/***/ "./static/templates/settings/profile_field_choice.hbs":
/*!************************************************************!*\
  !*** ./static/templates/settings/profile_field_choice.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class='choice-row movable-profile-field-row' data-value=\"{{value}}\">\n|     <i class=\"fa fa-ellipsis-v\" aria-hidden=\"true\"></i>\n|     <i class=\"fa fa-ellipsis-v\" aria-hidden=\"true\"></i>");

/***/ }),

/***/ "./static/templates/settings/realm_domains_modal.hbs":
/*!***********************************************************!*\
  !*** ./static/templates/settings/realm_domains_modal.hbs ***!
  \***********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <table class=\"table table-condensed table-stripped new-style\" id=\"realm_domains_table\">\n|     <thead>\n|         <th>{{t \"Domain\" }}</th>");

/***/ }),

/***/ "./static/templates/settings/stream_specific_notification_row.hbs":
/*!************************************************************************!*\
  !*** ./static/templates/settings/stream_specific_notification_row.hbs ***!
  \************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr class=\"stream-notifications-row {{#if muted}}control-label-disabled{{/if}}\" data-stream-id=\"{{stream.stream_id}}\">\n|     <td>\n|         <span id=\"stream_privacy_swatch_{{stream.stream_id}}\" class=\"stream-privacy filter-icon\">");

/***/ }),

/***/ "./static/templates/settings/upload_space_stats.hbs":
/*!**********************************************************!*\
  !*** ./static/templates/settings/upload_space_stats.hbs ***!
  \**********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <span>\n|     {{#tr}}Organization using {percent_used}% of {upload_quota}.{{/tr}}\n|     {{#if show_upgrade_message}}");

/***/ }),

/***/ "./static/templates/settings/uploaded_files_list.hbs":
/*!***********************************************************!*\
  !*** ./static/templates/settings/uploaded_files_list.hbs ***!
  \***********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#with attachment}}\n| <tr class=\"uploaded_file_row\" id=\"{{name}}\" data-attachment-id=\"{{id}}\">\n|     <td>");

/***/ }),

/***/ "./static/templates/settings_overlay.hbs":
/*!***********************************************!*\
  !*** ./static/templates/settings_overlay.hbs ***!
  \***********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"settings_page\" class=\"new-style overlay-content modal-bg\">\n|     <div class=\"settings-header mobile\">\n|         <i class=\"fa fa-chevron-left\" aria-hidden=\"true\"></i>");

/***/ }),

/***/ "./static/templates/settings_tab.hbs":
/*!*******************************************!*\
  !*** ./static/templates/settings_tab.hbs ***!
  \*******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"settings-change-box\" class=\"new-style\">\n|     {{> settings/profile_settings }}\n| ");

/***/ }),

/***/ "./static/templates/single_message.hbs":
/*!*********************************************!*\
  !*** ./static/templates/single_message.hbs ***!
  \*********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div zid=\"{{msg/id}}\" id=\"{{table_name}}{{msg/id}}\"\n|   class=\"message_row{{^msg/is_stream}} private-message{{/msg/is_stream}}{{#include_sender}} include-sender{{/include_sender}}{{#if mention_classname}} {{mention_classname}}{{/if}}{{#include_footer}} last_message{{/include_footer}}{{#msg.unread}} unread{{/msg.unread}} {{#if msg.locally_echoed}}local{{/if}} selectable_row\"\n|   role=\"listitem\">");

/***/ }),

/***/ "./static/templates/starred_messages_sidebar_actions.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/starred_messages_sidebar_actions.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"starred messages sidebar\" popup }}\n| <ul class=\"nav nav-list\">\n|     {{! tabindex=\"0\" Makes anchor tag focusable. Needed for keyboard support. }}");

/***/ }),

/***/ "./static/templates/status_emoji_selector.hbs":
/*!****************************************************!*\
  !*** ./static/templates/status_emoji_selector.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if selected_emoji}}\n|     {{#if selected_emoji.emoji_alt_code}}\n|         <div class=\"emoji_alt_code\">&nbsp:{{selected_emoji.emoji_name}}:</div>");

/***/ }),

/***/ "./static/templates/stream_privacy.hbs":
/*!*********************************************!*\
  !*** ./static/templates/stream_privacy.hbs ***!
  \*********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:9)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! This controls whether the swatch next to streams in the left sidebar has a lock icon. }}\n| {{#if invite_only}}\n| <i class=\"fa fa-lock\" aria-hidden=\"true\"></i>");

/***/ }),

/***/ "./static/templates/stream_settings/browse_streams_list.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/stream_settings/browse_streams_list.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#each subscriptions}}\n|     {{> browse_streams_list_item }}\n| {{/each}}");

/***/ }),

/***/ "./static/templates/stream_settings/browse_streams_list_item.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/stream_settings/browse_streams_list_item.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering subscriptions.}}\n| {{#with this}}\n| <div class=\"stream-row\" data-stream-id=\"{{stream_id}}\" data-stream-name=\"{{name}}\">");

/***/ }),

/***/ "./static/templates/stream_settings/change_stream_info_modal.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/stream_settings/change_stream_info_modal.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div>\n|     <label for=\"change_stream_name\">\n|         {{t 'Stream name' }}");

/***/ }),

/***/ "./static/templates/stream_settings/copy_email_address_modal.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/stream_settings/copy_email_address_modal.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"copy-email-modal\">\n|     <div class=\"new-style\">\n|         <p class=\"question-which-parts\">");

/***/ }),

/***/ "./static/templates/stream_settings/new_stream_user.hbs":
/*!**************************************************************!*\
  !*** ./static/templates/stream_settings/new_stream_user.hbs ***!
  \**************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr>\n|     <td>\n|         {{full_name}}{{#if is_current_user}} <span class=\"my_user_status\">{{t \"(you)\"}}</span>{{/if}}");

/***/ }),

/***/ "./static/templates/stream_settings/new_stream_users.hbs":
/*!***************************************************************!*\
  !*** ./static/templates/stream_settings/new_stream_users.hbs ***!
  \***************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"subscriber_list_add float-left\">\n|     {{> add_subscribers_form}}\n| </div>");

/***/ }),

/***/ "./static/templates/stream_settings/selected_stream_title.hbs":
/*!********************************************************************!*\
  !*** ./static/templates/stream_settings/selected_stream_title.hbs ***!
  \********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{> stream_privacy_icon\n|   invite_only=sub.invite_only\n|   is_web_public=sub.is_web_public");

/***/ }),

/***/ "./static/templates/stream_settings/stream_description.hbs":
/*!*****************************************************************!*\
  !*** ./static/templates/stream_settings/stream_description.hbs ***!
  \*****************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if rendered_description}}\n| <span class=\"sub-stream-description rendered_markdown\">\n|     {{rendered_markdown rendered_description}}");

/***/ }),

/***/ "./static/templates/stream_settings/stream_member_list_entry.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/stream_settings/stream_member_list_entry.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr data-subscriber-id=\"{{user_id}}\">\n|     <td class=\"subscriber-name\">\n|         {{name}}{{#if is_current_user}} <span class=\"my_user_status\">{{t \"(you)\"}}</span>{{/if}}");

/***/ }),

/***/ "./static/templates/stream_settings/stream_privacy_icon.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/stream_settings/stream_privacy_icon.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:9)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! This controls whether the swatch next to streams in the stream edit page has a lock icon. }}\n| {{#if invite_only}}\n| <div class=\"large-icon lock\" style=\"color: {{color}}\">");

/***/ }),

/***/ "./static/templates/stream_settings/stream_settings.hbs":
/*!**************************************************************!*\
  !*** ./static/templates/stream_settings/stream_settings.hbs ***!
  \**************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"stream_settings_header\" data-stream-id=\"{{sub.stream_id}}\">\n|     <div class=\"tab-container\"></div>\n|     {{#with sub}}");

/***/ }),

/***/ "./static/templates/stream_settings/stream_settings_overlay.hbs":
/*!**********************************************************************!*\
  !*** ./static/templates/stream_settings/stream_settings_overlay.hbs ***!
  \**********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"subscription_overlay\" class=\"overlay new-style\" data-overlay=\"subscriptions\">\n|     <div class=\"flex overlay-content\">\n|         <div class=\"subscriptions-container modal-bg\">");

/***/ }),

/***/ "./static/templates/stream_settings/stream_settings_tip.hbs":
/*!******************************************************************!*\
  !*** ./static/templates/stream_settings/stream_settings_tip.hbs ***!
  \******************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#unless can_change_stream_permissions}}\n|     {{#if can_change_name_description}}\n|         <div class=\"tip\">{{t \"Only subscribers to this stream can edit stream permissions.\"}}</div>");

/***/ }),

/***/ "./static/templates/stream_settings/stream_subscription_request_result.hbs":
/*!*********************************************************************************!*\
  !*** ./static/templates/stream_settings/stream_subscription_request_result.hbs ***!
  \*********************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if message}}\n| {{message}}\n| <br />");

/***/ }),

/***/ "./static/templates/stream_sidebar_actions.hbs":
/*!*****************************************************!*\
  !*** ./static/templates/stream_sidebar_actions.hbs ***!
  \*****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"stream actions\" popup }}\n| <ul class=\"nav nav-list streams_popover\" data-stream-id=\"{{ stream.stream_id }}\" data-name=\"{{ stream.name }}\">\n|     <li>");

/***/ }),

/***/ "./static/templates/stream_sidebar_row.hbs":
/*!*************************************************!*\
  !*** ./static/templates/stream_sidebar_row.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:11)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Stream sidebar rows }}\n| \n| <li class=\"narrow-filter{{#if is_muted}} out_of_home_view{{/if}}\" data-stream-id=\"{{id}}\">");

/***/ }),

/***/ "./static/templates/streams_subheader.hbs":
/*!************************************************!*\
  !*** ./static/templates/streams_subheader.hbs ***!
  \************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"streams_subheader\">\n|     <span>{{ subheader_name }}</span>\n| </div>");

/***/ }),

/***/ "./static/templates/subscribe_to_more_streams.hbs":
/*!********************************************************!*\
  !*** ./static/templates/subscribe_to_more_streams.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if exactly_one_unsubscribed_stream}}\n|     <a href=\"#streams/all\">\n|         <i class=\"fa fa-plus-circle\" aria-hidden=\"true\"></i>");

/***/ }),

/***/ "./static/templates/topic_edit_form.hbs":
/*!**********************************************!*\
  !*** ./static/templates/topic_edit_form.hbs ***!
  \**********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:16)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Client-side Mustache template for rendering the topic edit form. }}\n| \n| <form id=\"topic_edit_form\" class=\"form-horizontal\">");

/***/ }),

/***/ "./static/templates/topic_list_item.hbs":
/*!**********************************************!*\
  !*** ./static/templates/topic_list_item.hbs ***!
  \**********************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <li class='bottom_left_row {{#if is_active_topic}}active-sub-filter{{/if}} {{#if is_zero}}zero-topic-unreads{{/if}} {{#if is_muted}}muted_topic{{/if}} topic-list-item' data-topic-name='{{topic_name}}'>\n|     <span class='topic-box'>\n|         <span class=\"sidebar-topic-check\">");

/***/ }),

/***/ "./static/templates/topic_muted.hbs":
/*!******************************************!*\
  !*** ./static/templates/topic_muted.hbs ***!
  \******************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#tr}}\n|     You have muted <z-stream-topic></z-stream-topic>.\n|     {{#*inline \"z-stream-topic\"}}<strong><span class=\"stream\"></span> &gt; <span class=\"topic\"></span></strong>{{/inline}}");

/***/ }),

/***/ "./static/templates/topic_sidebar_actions.hbs":
/*!****************************************************!*\
  !*** ./static/templates/topic_sidebar_actions.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul class=\"nav nav-list topics_popover\">\n|     <li>\n|         <p class=\"topic-name\">");

/***/ }),

/***/ "./static/templates/typeahead_list_item.hbs":
/*!**************************************************!*\
  !*** ./static/templates/typeahead_list_item.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#if is_emoji}}\n|     {{#if has_image}}\n|         <img class=\"emoji\" src=\"{{ img_src }}\" />");

/***/ }),

/***/ "./static/templates/typing_notifications.hbs":
/*!***************************************************!*\
  !*** ./static/templates/typing_notifications.hbs ***!
  \***************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:11)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Typing notifications }}\n| <ul id=\"typing_notification_list\">\n|     {{#if several_users}}");

/***/ }),

/***/ "./static/templates/user_group_info_popover.hbs":
/*!******************************************************!*\
  !*** ./static/templates/user_group_info_popover.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"popover message-info-popover group-info-popover\">\n|     <div class=\"popover-inner\">\n|         <div class=\"popover-content\">");

/***/ }),

/***/ "./static/templates/user_group_info_popover_content.hbs":
/*!**************************************************************!*\
  !*** ./static/templates/user_group_info_popover_content.hbs ***!
  \**************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"user group info\" popup }}\n| <div class=\"group-info\">\n|     <div class=\"group-name\"> {{group_name}} </div>");

/***/ }),

/***/ "./static/templates/user_group_list_item.hbs":
/*!***************************************************!*\
  !*** ./static/templates/user_group_list_item.hbs ***!
  \***************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr data-group-id=\"{{group_id}}\">\n|     <td class=\"group_list_item\">\n|         {{name}}");

/***/ }),

/***/ "./static/templates/user_group_settings/browse_user_groups_list_item.hbs":
/*!*******************************************************************************!*\
  !*** ./static/templates/user_group_settings/browse_user_groups_list_item.hbs ***!
  \*******************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"group-row\" data-group-id=\"{{id}}\" data-group-name=\"{{name}}\">\n|     <div class=\"check {{#if is_member }} checked {{else}} disabled {{/if}} sub_unsub_button\">\n|         <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\" xml:space=\"preserve\">");

/***/ }),

/***/ "./static/templates/user_group_settings/new_user_group_users.hbs":
/*!***********************************************************************!*\
  !*** ./static/templates/user_group_settings/new_user_group_users.hbs ***!
  \***********************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"member_list_add float-left\">\n|     {{> ../stream_settings/add_subscribers_form}}\n| </div>");

/***/ }),

/***/ "./static/templates/user_group_settings/user_group_settings_overlay.hbs":
/*!******************************************************************************!*\
  !*** ./static/templates/user_group_settings/user_group_settings_overlay.hbs ***!
  \******************************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div id=\"groups_overlay\" class=\"overlay new-style\" data-overlay=\"group_subscriptions\">\n|     <div class=\"flex overlay-content\">\n|         <div class=\"user-groups-container modal-bg\">");

/***/ }),

/***/ "./static/templates/user_info_popover_content.hbs":
/*!********************************************************!*\
  !*** ./static/templates/user_info_popover_content.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:13)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Contents of the \"message info\" popup }}\n| <ul class=\"nav nav-list info_popover_actions\" id=\"user_info_popover\" data-user-id=\"{{user_id}}\">\n|     <li class=\"popover_user_name_row\">");

/***/ }),

/***/ "./static/templates/user_info_popover_manage_menu.hbs":
/*!************************************************************!*\
  !*** ./static/templates/user_info_popover_manage_menu.hbs ***!
  \************************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <ul class=\"nav nav-list user_info_popover_manage_menu\" data-user-id=\"{{user_id}}\">\n|     {{#if can_mute }}\n|     <li>");

/***/ }),

/***/ "./static/templates/user_info_popover_title.hbs":
/*!******************************************************!*\
  !*** ./static/templates/user_info_popover_title.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"popover-avatar{{#if user_is_guest}} guest-avatar{{/if}}\" style=\"background-image: url('{{user_avatar}}');\" >\n| </div>\n| ");

/***/ }),

/***/ "./static/templates/user_profile_modal.hbs":
/*!*************************************************!*\
  !*** ./static/templates/user_profile_modal.hbs ***!
  \*************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"micromodal\" id=\"user-profile-modal\" data-user-id=\"{{user_id}}\" aria-hidden=\"true\">\n|     <div class=\"modal__overlay\" tabindex=\"-1\">\n|         <div class=\"modal__container new-style\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"dialog_title\">");

/***/ }),

/***/ "./static/templates/user_stream_list_item.hbs":
/*!****************************************************!*\
  !*** ./static/templates/user_stream_list_item.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <tr data-stream-id=\"{{stream_id}}\">\n|     <td class=\"subscription_list_stream\">\n|         <span id=\"stream_sidebar_privacy_swatch_{{stream_id}}\" class=\"stream-privacy filter-icon\" style=\"color: {{stream_color}}\">");

/***/ }),

/***/ "./static/templates/user_with_status_icon.hbs":
/*!****************************************************!*\
  !*** ./static/templates/user_with_status_icon.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"user_status_icon_wrapper\">\n|     <span class=\"user-name\">{{name}}</span>\n|     {{> status_emoji status_emoji_info}}");

/***/ }),

/***/ "./static/templates/view_code_in_playground.hbs":
/*!******************************************************!*\
  !*** ./static/templates/view_code_in_playground.hbs ***!
  \******************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:12)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{! Display the \"view code in playground\" option for code blocks}}\n| <a target=\"_blank\" rel=\"noopener noreferrer\" class=\"code_external_link\"><i class=\"fa fa-external-link\"></i></a>\n| ");

/***/ }),

/***/ "./static/templates/widgets/poll_widget.hbs":
/*!**************************************************!*\
  !*** ./static/templates/widgets/poll_widget.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"poll-widget\">\n|     <h4 class=\"poll-question-header\"></h4>\n|     <div class=\"poll-please-wait\">");

/***/ }),

/***/ "./static/templates/widgets/poll_widget_results.hbs":
/*!**********************************************************!*\
  !*** ./static/templates/widgets/poll_widget_results.hbs ***!
  \**********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:2)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> {{#each options}}\n|     <li>\n|         <button class=\"poll-vote {{#if current_user_vote}}current-user-vote{{/if}}\" data-key=\"{{ key }}\">");

/***/ }),

/***/ "./static/templates/widgets/todo_widget.hbs":
/*!**************************************************!*\
  !*** ./static/templates/widgets/todo_widget.hbs ***!
  \**************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"todo-widget\">\n|     <h4>{{t \"Task list\" }}</h4>\n|     <div class=\"add-task-bar\">");

/***/ }),

/***/ "./static/templates/widgets/todo_widget_tasks.hbs":
/*!********************************************************!*\
  !*** ./static/templates/widgets/todo_widget_tasks.hbs ***!
  \********************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <br />\n| {{#each pending_tasks}}\n|     <li>");

/***/ }),

/***/ "./static/templates/widgets/zform_choices.hbs":
/*!****************************************************!*\
  !*** ./static/templates/widgets/zform_choices.hbs ***!
  \****************************************************/
/***/ (() => {

throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> <div class=\"widget-choices\">\n|     <div class=\"widget-choices-heading\">{{ heading }}</div>\n|     <ul>");

/***/ }),

/***/ "./static/third/marked/lib/marked.cjs":
/*!********************************************!*\
  !*** ./static/third/marked/lib/marked.cjs ***!
  \********************************************/
/***/ ((__unused_webpack_module, exports) => {

"use strict";
/**
 * marked - a markdown parser
 * Copyright (c) 2011-2022, Christopher Jeffrey. (MIT Licensed)
 * https://github.com/markedjs/marked
 */

/**
 * DO NOT EDIT THIS FILE
 * The code in this file is generated from files in ./src/
 */



function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}
function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;
  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
  return arr2;
}
function _createForOfIteratorHelperLoose(o, allowArrayLike) {
  var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
  if (it) return (it = it.call(o)).next.bind(it);
  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
    if (it) o = it;
    var i = 0;
    return function () {
      if (i >= o.length) return {
        done: true
      };
      return {
        done: false,
        value: o[i++]
      };
    };
  }
  throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toPrimitive(input, hint) {
  if (typeof input !== "object" || input === null) return input;
  var prim = input[Symbol.toPrimitive];
  if (prim !== undefined) {
    var res = prim.call(input, hint || "default");
    if (typeof res !== "object") return res;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return (hint === "string" ? String : Number)(input);
}
function _toPropertyKey(arg) {
  var key = _toPrimitive(arg, "string");
  return typeof key === "symbol" ? key : String(key);
}

function getDefaults() {
  return {
    async: false,
    baseUrl: null,
    breaks: false,
    extensions: null,
    gfm: true,
    headerIds: true,
    headerPrefix: '',
    highlight: null,
    langPrefix: 'language-',
    mangle: true,
    pedantic: false,
    renderer: null,
    sanitize: false,
    sanitizer: null,
    silent: false,
    smartypants: false,
    tokenizer: null,
    walkTokens: null,
    xhtml: false
  };
}
exports.defaults = getDefaults();
function changeDefaults(newDefaults) {
  exports.defaults = newDefaults;
}

/**
 * Helpers
 */
var escapeTest = /[&<>"']/;
var escapeReplace = new RegExp(escapeTest.source, 'g');
var escapeTestNoEncode = /[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/;
var escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');
var escapeReplacements = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;'
};
var getEscapeReplacement = function getEscapeReplacement(ch) {
  return escapeReplacements[ch];
};
function escape(html, encode) {
  if (encode) {
    if (escapeTest.test(html)) {
      return html.replace(escapeReplace, getEscapeReplacement);
    }
  } else {
    if (escapeTestNoEncode.test(html)) {
      return html.replace(escapeReplaceNoEncode, getEscapeReplacement);
    }
  }
  return html;
}
var unescapeTest = /&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;

/**
 * @param {string} html
 */
function unescape(html) {
  // explicitly match decimal, hex, and named HTML entities
  return html.replace(unescapeTest, function (_, n) {
    n = n.toLowerCase();
    if (n === 'colon') return ':';
    if (n.charAt(0) === '#') {
      return n.charAt(1) === 'x' ? String.fromCharCode(parseInt(n.substring(2), 16)) : String.fromCharCode(+n.substring(1));
    }
    return '';
  });
}
var caret = /(^|[^\[])\^/g;

/**
 * @param {string | RegExp} regex
 * @param {string} opt
 */
function edit(regex, opt) {
  regex = typeof regex === 'string' ? regex : regex.source;
  opt = opt || '';
  var obj = {
    replace: function replace(name, val) {
      val = val.source || val;
      val = val.replace(caret, '$1');
      regex = regex.replace(name, val);
      return obj;
    },
    getRegex: function getRegex() {
      return new RegExp(regex, opt);
    }
  };
  return obj;
}
var nonWordAndColonTest = /[^\w:]/g;
var originIndependentUrl = /^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;

/**
 * @param {boolean} sanitize
 * @param {string} base
 * @param {string} href
 */
function cleanUrl(sanitize, base, href) {
  if (sanitize) {
    var prot;
    try {
      prot = decodeURIComponent(unescape(href)).replace(nonWordAndColonTest, '').toLowerCase();
    } catch (e) {
      return null;
    }
    if (prot.indexOf('javascript:') === 0 || prot.indexOf('vbscript:') === 0 || prot.indexOf('data:') === 0) {
      return null;
    }
  }
  if (base && !originIndependentUrl.test(href)) {
    href = resolveUrl(base, href);
  }
  try {
    href = encodeURI(href).replace(/%25/g, '%');
  } catch (e) {
    return null;
  }
  return href;
}
var baseUrls = {};
var justDomain = /^[^:]+:\/*[^/]*$/;
var protocol = /^([^:]+:)[\s\S]*$/;
var domain = /^([^:]+:\/*[^/]*)[\s\S]*$/;

/**
 * @param {string} base
 * @param {string} href
 */
function resolveUrl(base, href) {
  if (!baseUrls[' ' + base]) {
    // we can ignore everything in base after the last slash of its path component,
    // but we might need to add _that_
    // https://tools.ietf.org/html/rfc3986#section-3
    if (justDomain.test(base)) {
      baseUrls[' ' + base] = base + '/';
    } else {
      baseUrls[' ' + base] = rtrim(base, '/', true);
    }
  }
  base = baseUrls[' ' + base];
  var relativeBase = base.indexOf(':') === -1;
  if (href.substring(0, 2) === '//') {
    if (relativeBase) {
      return href;
    }
    return base.replace(protocol, '$1') + href;
  } else if (href.charAt(0) === '/') {
    if (relativeBase) {
      return href;
    }
    return base.replace(domain, '$1') + href;
  } else {
    return base + href;
  }
}
var noopTest = {
  exec: function noopTest() {}
};
function merge(obj) {
  var i = 1,
    target,
    key;
  for (; i < arguments.length; i++) {
    target = arguments[i];
    for (key in target) {
      if (Object.prototype.hasOwnProperty.call(target, key)) {
        obj[key] = target[key];
      }
    }
  }
  return obj;
}
function splitCells(tableRow, count) {
  // ensure that every cell-delimiting pipe has a space
  // before it to distinguish it from an escaped pipe
  var row = tableRow.replace(/\|/g, function (match, offset, str) {
      var escaped = false,
        curr = offset;
      while (--curr >= 0 && str[curr] === '\\') {
        escaped = !escaped;
      }
      if (escaped) {
        // odd number of slashes means | is escaped
        // so we leave it alone
        return '|';
      } else {
        // add space before unescaped |
        return ' |';
      }
    }),
    cells = row.split(/ \|/);
  var i = 0;

  // First/last cell in a row cannot be empty if it has no leading/trailing pipe
  if (!cells[0].trim()) {
    cells.shift();
  }
  if (cells.length > 0 && !cells[cells.length - 1].trim()) {
    cells.pop();
  }
  if (cells.length > count) {
    cells.splice(count);
  } else {
    while (cells.length < count) {
      cells.push('');
    }
  }
  for (; i < cells.length; i++) {
    // leading or trailing whitespace is ignored per the gfm spec
    cells[i] = cells[i].trim().replace(/\\\|/g, '|');
  }
  return cells;
}

/**
 * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').
 * /c*$/ is vulnerable to REDOS.
 *
 * @param {string} str
 * @param {string} c
 * @param {boolean} invert Remove suffix of non-c chars instead. Default falsey.
 */
function rtrim(str, c, invert) {
  var l = str.length;
  if (l === 0) {
    return '';
  }

  // Length of suffix matching the invert condition.
  var suffLen = 0;

  // Step left until we fail to match the invert condition.
  while (suffLen < l) {
    var currChar = str.charAt(l - suffLen - 1);
    if (currChar === c && !invert) {
      suffLen++;
    } else if (currChar !== c && invert) {
      suffLen++;
    } else {
      break;
    }
  }
  return str.slice(0, l - suffLen);
}
function findClosingBracket(str, b) {
  if (str.indexOf(b[1]) === -1) {
    return -1;
  }
  var l = str.length;
  var level = 0,
    i = 0;
  for (; i < l; i++) {
    if (str[i] === '\\') {
      i++;
    } else if (str[i] === b[0]) {
      level++;
    } else if (str[i] === b[1]) {
      level--;
      if (level < 0) {
        return i;
      }
    }
  }
  return -1;
}
function checkSanitizeDeprecation(opt) {
  if (opt && opt.sanitize && !opt.silent) {
    console.warn('marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options');
  }
}

// copied from https://stackoverflow.com/a/5450113/806777
/**
 * @param {string} pattern
 * @param {number} count
 */
function repeatString(pattern, count) {
  if (count < 1) {
    return '';
  }
  var result = '';
  while (count > 1) {
    if (count & 1) {
      result += pattern;
    }
    count >>= 1;
    pattern += pattern;
  }
  return result + pattern;
}

function outputLink(cap, link, raw, lexer) {
  var href = link.href;
  var title = link.title ? escape(link.title) : null;
  var text = cap[1].replace(/\\([\[\]])/g, '$1');
  if (cap[0].charAt(0) !== '!') {
    lexer.state.inLink = true;
    var token = {
      type: 'link',
      raw: raw,
      href: href,
      title: title,
      text: text,
      tokens: lexer.inlineTokens(text)
    };
    lexer.state.inLink = false;
    return token;
  }
  return {
    type: 'image',
    raw: raw,
    href: href,
    title: title,
    text: escape(text)
  };
}
function indentCodeCompensation(raw, text) {
  var matchIndentToCode = raw.match(/^(\s+)(?:```)/);
  if (matchIndentToCode === null) {
    return text;
  }
  var indentToCode = matchIndentToCode[1];
  return text.split('\n').map(function (node) {
    var matchIndentInNode = node.match(/^\s+/);
    if (matchIndentInNode === null) {
      return node;
    }
    var indentInNode = matchIndentInNode[0];
    if (indentInNode.length >= indentToCode.length) {
      return node.slice(indentToCode.length);
    }
    return node;
  }).join('\n');
}

/**
 * Tokenizer
 */
var Tokenizer = /*#__PURE__*/function () {
  function Tokenizer(options) {
    this.options = options || exports.defaults;
  }
  var _proto = Tokenizer.prototype;
  _proto.space = function space(src) {
    var cap = this.rules.block.newline.exec(src);
    if (cap && cap[0].length > 0) {
      return {
        type: 'space',
        raw: cap[0]
      };
    }
  };
  _proto.code = function code(src) {
    var cap = this.rules.block.code.exec(src);
    if (cap) {
      var text = cap[0].replace(/^ {1,4}/gm, '');
      return {
        type: 'code',
        raw: cap[0],
        codeBlockStyle: 'indented',
        text: !this.options.pedantic ? rtrim(text, '\n') : text
      };
    }
  };
  _proto.fences = function fences(src) {
    var cap = this.rules.block.fences.exec(src);
    if (cap) {
      var raw = cap[0];
      var text = indentCodeCompensation(raw, cap[3] || '');
      return {
        type: 'code',
        raw: raw,
        lang: cap[2] ? cap[2].trim().replace(this.rules.inline._escapes, '$1') : cap[2],
        text: text
      };
    }
  };
  _proto.heading = function heading(src) {
    var cap = this.rules.block.heading.exec(src);
    if (cap) {
      var text = cap[2].trim();

      // remove trailing #s
      if (/#$/.test(text)) {
        var trimmed = rtrim(text, '#');
        if (this.options.pedantic) {
          text = trimmed.trim();
        } else if (!trimmed || / $/.test(trimmed)) {
          // CommonMark requires space before trailing #s
          text = trimmed.trim();
        }
      }
      return {
        type: 'heading',
        raw: cap[0],
        depth: cap[1].length,
        text: text,
        tokens: this.lexer.inline(text)
      };
    }
  };
  _proto.hr = function hr(src) {
    var cap = this.rules.block.hr.exec(src);
    if (cap) {
      return {
        type: 'hr',
        raw: cap[0]
      };
    }
  };
  _proto.blockquote = function blockquote(src) {
    var cap = this.rules.block.blockquote.exec(src);
    if (cap) {
      var text = cap[0].replace(/^ *>[ \t]?/gm, '');
      var top = this.lexer.state.top;
      this.lexer.state.top = true;
      var tokens = this.lexer.blockTokens(text);
      this.lexer.state.top = top;
      return {
        type: 'blockquote',
        raw: cap[0],
        tokens: tokens,
        text: text
      };
    }
  };
  _proto.list = function list(src) {
    var cap = this.rules.block.list.exec(src);
    if (cap) {
      var raw, istask, ischecked, indent, i, blankLine, endsWithBlankLine, line, nextLine, rawLine, itemContents, endEarly;
      var bull = cap[1].trim();
      var isordered = bull.length > 1;
      var list = {
        type: 'list',
        raw: '',
        ordered: isordered,
        start: isordered ? +bull.slice(0, -1) : '',
        loose: false,
        items: []
      };
      bull = isordered ? "\\d{1,9}\\" + bull.slice(-1) : "\\" + bull;
      if (this.options.pedantic) {
        bull = isordered ? bull : '[*+-]';
      }

      // Get next list item
      var itemRegex = new RegExp("^( {0,3}" + bull + ")((?:[\t ][^\\n]*)?(?:\\n|$))");

      // Check if current bullet point can start a new List Item
      while (src) {
        endEarly = false;
        if (!(cap = itemRegex.exec(src))) {
          break;
        }
        if (this.rules.block.hr.test(src)) {
          // End list if bullet was actually HR (possibly move into itemRegex?)
          break;
        }
        raw = cap[0];
        src = src.substring(raw.length);
        line = cap[2].split('\n', 1)[0].replace(/^\t+/, function (t) {
          return ' '.repeat(3 * t.length);
        });
        nextLine = src.split('\n', 1)[0];
        if (this.options.pedantic) {
          indent = 2;
          itemContents = line.trimLeft();
        } else {
          indent = cap[2].search(/[^ ]/); // Find first non-space char
          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent
          itemContents = line.slice(indent);
          indent += cap[1].length;
        }
        blankLine = false;
        if (!line && /^ *$/.test(nextLine)) {
          // Items begin with at most one blank line
          raw += nextLine + '\n';
          src = src.substring(nextLine.length + 1);
          endEarly = true;
        }
        if (!endEarly) {
          var nextBulletRegex = new RegExp("^ {0," + Math.min(3, indent - 1) + "}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))");
          var hrRegex = new RegExp("^ {0," + Math.min(3, indent - 1) + "}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)");
          var fencesBeginRegex = new RegExp("^ {0," + Math.min(3, indent - 1) + "}(?:```|~~~)");
          var headingBeginRegex = new RegExp("^ {0," + Math.min(3, indent - 1) + "}#");

          // Check if following lines should be included in List Item
          while (src) {
            rawLine = src.split('\n', 1)[0];
            nextLine = rawLine;

            // Re-align to follow commonmark nesting rules
            if (this.options.pedantic) {
              nextLine = nextLine.replace(/^ {1,4}(?=( {4})*[^ ])/g, '  ');
            }

            // End list item if found code fences
            if (fencesBeginRegex.test(nextLine)) {
              break;
            }

            // End list item if found start of new heading
            if (headingBeginRegex.test(nextLine)) {
              break;
            }

            // End list item if found start of new bullet
            if (nextBulletRegex.test(nextLine)) {
              break;
            }

            // Horizontal rule found
            if (hrRegex.test(src)) {
              break;
            }
            if (nextLine.search(/[^ ]/) >= indent || !nextLine.trim()) {
              // Dedent if possible
              itemContents += '\n' + nextLine.slice(indent);
            } else {
              // not enough indentation
              if (blankLine) {
                break;
              }

              // paragraph continuation unless last line was a different block level element
              if (line.search(/[^ ]/) >= 4) {
                // indented code block
                break;
              }
              if (fencesBeginRegex.test(line)) {
                break;
              }
              if (headingBeginRegex.test(line)) {
                break;
              }
              if (hrRegex.test(line)) {
                break;
              }
              itemContents += '\n' + nextLine;
            }
            if (!blankLine && !nextLine.trim()) {
              // Check if current line is blank
              blankLine = true;
            }
            raw += rawLine + '\n';
            src = src.substring(rawLine.length + 1);
            line = nextLine.slice(indent);
          }
        }
        if (!list.loose) {
          // If the previous item ended with a blank line, the list is loose
          if (endsWithBlankLine) {
            list.loose = true;
          } else if (/\n *\n *$/.test(raw)) {
            endsWithBlankLine = true;
          }
        }

        // Check for task list items
        if (this.options.gfm) {
          istask = /^\[[ xX]\] /.exec(itemContents);
          if (istask) {
            ischecked = istask[0] !== '[ ] ';
            itemContents = itemContents.replace(/^\[[ xX]\] +/, '');
          }
        }
        list.items.push({
          type: 'list_item',
          raw: raw,
          task: !!istask,
          checked: ischecked,
          loose: false,
          text: itemContents
        });
        list.raw += raw;
      }

      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic
      list.items[list.items.length - 1].raw = raw.trimRight();
      list.items[list.items.length - 1].text = itemContents.trimRight();
      list.raw = list.raw.trimRight();
      var l = list.items.length;

      // Item child tokens handled here at end because we needed to have the final item to trim it first
      for (i = 0; i < l; i++) {
        this.lexer.state.top = false;
        list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);
        if (!list.loose) {
          // Check if list should be loose
          var spacers = list.items[i].tokens.filter(function (t) {
            return t.type === 'space';
          });
          var hasMultipleLineBreaks = spacers.length > 0 && spacers.some(function (t) {
            return /\n.*\n/.test(t.raw);
          });
          list.loose = hasMultipleLineBreaks;
        }
      }

      // Set all items to loose if list is loose
      if (list.loose) {
        for (i = 0; i < l; i++) {
          list.items[i].loose = true;
        }
      }
      return list;
    }
  };
  _proto.html = function html(src) {
    var cap = this.rules.block.html.exec(src);
    if (cap) {
      var token = {
        type: 'html',
        raw: cap[0],
        pre: !this.options.sanitizer && (cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style'),
        text: cap[0]
      };
      if (this.options.sanitize) {
        var text = this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape(cap[0]);
        token.type = 'paragraph';
        token.text = text;
        token.tokens = this.lexer.inline(text);
      }
      return token;
    }
  };
  _proto.def = function def(src) {
    var cap = this.rules.block.def.exec(src);
    if (cap) {
      var tag = cap[1].toLowerCase().replace(/\s+/g, ' ');
      var href = cap[2] ? cap[2].replace(/^<(.*)>$/, '$1').replace(this.rules.inline._escapes, '$1') : '';
      var title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline._escapes, '$1') : cap[3];
      return {
        type: 'def',
        tag: tag,
        raw: cap[0],
        href: href,
        title: title
      };
    }
  };
  _proto.table = function table(src) {
    var cap = this.rules.block.table.exec(src);
    if (cap) {
      var item = {
        type: 'table',
        header: splitCells(cap[1]).map(function (c) {
          return {
            text: c
          };
        }),
        align: cap[2].replace(/^ *|\| *$/g, '').split(/ *\| */),
        rows: cap[3] && cap[3].trim() ? cap[3].replace(/\n[ \t]*$/, '').split('\n') : []
      };
      if (item.header.length === item.align.length) {
        item.raw = cap[0];
        var l = item.align.length;
        var i, j, k, row;
        for (i = 0; i < l; i++) {
          if (/^ *-+: *$/.test(item.align[i])) {
            item.align[i] = 'right';
          } else if (/^ *:-+: *$/.test(item.align[i])) {
            item.align[i] = 'center';
          } else if (/^ *:-+ *$/.test(item.align[i])) {
            item.align[i] = 'left';
          } else {
            item.align[i] = null;
          }
        }
        l = item.rows.length;
        for (i = 0; i < l; i++) {
          item.rows[i] = splitCells(item.rows[i], item.header.length).map(function (c) {
            return {
              text: c
            };
          });
        }

        // parse child tokens inside headers and cells

        // header child tokens
        l = item.header.length;
        for (j = 0; j < l; j++) {
          item.header[j].tokens = this.lexer.inline(item.header[j].text);
        }

        // cell child tokens
        l = item.rows.length;
        for (j = 0; j < l; j++) {
          row = item.rows[j];
          for (k = 0; k < row.length; k++) {
            row[k].tokens = this.lexer.inline(row[k].text);
          }
        }
        return item;
      }
    }
  };
  _proto.lheading = function lheading(src) {
    var cap = this.rules.block.lheading.exec(src);
    if (cap) {
      return {
        type: 'heading',
        raw: cap[0],
        depth: cap[2].charAt(0) === '=' ? 1 : 2,
        text: cap[1],
        tokens: this.lexer.inline(cap[1])
      };
    }
  };
  _proto.paragraph = function paragraph(src) {
    var cap = this.rules.block.paragraph.exec(src);
    if (cap) {
      var text = cap[1].charAt(cap[1].length - 1) === '\n' ? cap[1].slice(0, -1) : cap[1];
      return {
        type: 'paragraph',
        raw: cap[0],
        text: text,
        tokens: this.lexer.inline(text)
      };
    }
  };
  _proto.text = function text(src) {
    var cap = this.rules.block.text.exec(src);
    if (cap) {
      return {
        type: 'text',
        raw: cap[0],
        text: cap[0],
        tokens: this.lexer.inline(cap[0])
      };
    }
  };
  _proto.escape = function escape$1(src) {
    var cap = this.rules.inline.escape.exec(src);
    if (cap) {
      return {
        type: 'escape',
        raw: cap[0],
        text: escape(cap[1])
      };
    }
  };
  _proto.tag = function tag(src) {
    var cap = this.rules.inline.tag.exec(src);
    if (cap) {
      if (!this.lexer.state.inLink && /^<a /i.test(cap[0])) {
        this.lexer.state.inLink = true;
      } else if (this.lexer.state.inLink && /^<\/a>/i.test(cap[0])) {
        this.lexer.state.inLink = false;
      }
      if (!this.lexer.state.inRawBlock && /^<(pre|code|kbd|script)(\s|>)/i.test(cap[0])) {
        this.lexer.state.inRawBlock = true;
      } else if (this.lexer.state.inRawBlock && /^<\/(pre|code|kbd|script)(\s|>)/i.test(cap[0])) {
        this.lexer.state.inRawBlock = false;
      }
      return {
        type: this.options.sanitize ? 'text' : 'html',
        raw: cap[0],
        inLink: this.lexer.state.inLink,
        inRawBlock: this.lexer.state.inRawBlock,
        text: this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape(cap[0]) : cap[0]
      };
    }
  };
  _proto.link = function link(src) {
    var cap = this.rules.inline.link.exec(src);
    if (cap) {
      var trimmedUrl = cap[2].trim();
      if (!this.options.pedantic && /^</.test(trimmedUrl)) {
        // commonmark requires matching angle brackets
        if (!/>$/.test(trimmedUrl)) {
          return;
        }

        // ending angle bracket cannot be escaped
        var rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\');
        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {
          return;
        }
      } else {
        // find closing parenthesis
        var lastParenIndex = findClosingBracket(cap[2], '()');
        if (lastParenIndex > -1) {
          var start = cap[0].indexOf('!') === 0 ? 5 : 4;
          var linkLen = start + cap[1].length + lastParenIndex;
          cap[2] = cap[2].substring(0, lastParenIndex);
          cap[0] = cap[0].substring(0, linkLen).trim();
          cap[3] = '';
        }
      }
      var href = cap[2];
      var title = '';
      if (this.options.pedantic) {
        // split pedantic href and title
        var link = /^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(href);
        if (link) {
          href = link[1];
          title = link[3];
        }
      } else {
        title = cap[3] ? cap[3].slice(1, -1) : '';
      }
      href = href.trim();
      if (/^</.test(href)) {
        if (this.options.pedantic && !/>$/.test(trimmedUrl)) {
          // pedantic allows starting angle bracket without ending angle bracket
          href = href.slice(1);
        } else {
          href = href.slice(1, -1);
        }
      }
      return outputLink(cap, {
        href: href ? href.replace(this.rules.inline._escapes, '$1') : href,
        title: title ? title.replace(this.rules.inline._escapes, '$1') : title
      }, cap[0], this.lexer);
    }
  };
  _proto.reflink = function reflink(src, links) {
    var cap;
    if ((cap = this.rules.inline.reflink.exec(src)) || (cap = this.rules.inline.nolink.exec(src))) {
      var link = (cap[2] || cap[1]).replace(/\s+/g, ' ');
      link = links[link.toLowerCase()];
      if (!link) {
        var text = cap[0].charAt(0);
        return {
          type: 'text',
          raw: text,
          text: text
        };
      }
      return outputLink(cap, link, cap[0], this.lexer);
    }
  };
  _proto.emStrong = function emStrong(src, maskedSrc, prevChar) {
    if (prevChar === void 0) {
      prevChar = '';
    }
    var match = this.rules.inline.emStrong.lDelim.exec(src);
    if (!match) return;

    // _ can't be between two alphanumerics. \p{L}\p{N} includes non-english alphabet/numbers as well
    if (match[3] && prevChar.match(/(?:[0-9A-Za-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B50-\u1B59\u1B83-\u1BA0\u1BAE-\u1BE5\u1C00-\u1C23\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF-\uA9D9\uA9E0-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD23\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/)) return;
    var nextChar = match[1] || match[2] || '';
    if (!nextChar || nextChar && (prevChar === '' || this.rules.inline.punctuation.exec(prevChar))) {
      var lLength = match[0].length - 1;
      var rDelim,
        rLength,
        delimTotal = lLength,
        midDelimTotal = 0;
      var endReg = match[0][0] === '*' ? this.rules.inline.emStrong.rDelimAst : this.rules.inline.emStrong.rDelimUnd;
      endReg.lastIndex = 0;

      // Clip maskedSrc to same section of string as src (move to lexer?)
      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);
      while ((match = endReg.exec(maskedSrc)) != null) {
        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];
        if (!rDelim) continue; // skip single * in __abc*abc__

        rLength = rDelim.length;
        if (match[3] || match[4]) {
          // found another Left Delim
          delimTotal += rLength;
          continue;
        } else if (match[5] || match[6]) {
          // either Left or Right Delim
          if (lLength % 3 && !((lLength + rLength) % 3)) {
            midDelimTotal += rLength;
            continue; // CommonMark Emphasis Rules 9-10
          }
        }

        delimTotal -= rLength;
        if (delimTotal > 0) continue; // Haven't found enough closing delimiters

        // Remove extra characters. *a*** -> *a*
        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);
        var raw = src.slice(0, lLength + match.index + (match[0].length - rDelim.length) + rLength);

        // Create `em` if smallest delimiter has odd char count. *a***
        if (Math.min(lLength, rLength) % 2) {
          var _text = raw.slice(1, -1);
          return {
            type: 'em',
            raw: raw,
            text: _text,
            tokens: this.lexer.inlineTokens(_text)
          };
        }

        // Create 'strong' if smallest delimiter has even char count. **a***
        var text = raw.slice(2, -2);
        return {
          type: 'strong',
          raw: raw,
          text: text,
          tokens: this.lexer.inlineTokens(text)
        };
      }
    }
  };
  _proto.codespan = function codespan(src) {
    var cap = this.rules.inline.code.exec(src);
    if (cap) {
      var text = cap[2].replace(/\n/g, ' ');
      var hasNonSpaceChars = /[^ ]/.test(text);
      var hasSpaceCharsOnBothEnds = /^ /.test(text) && / $/.test(text);
      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {
        text = text.substring(1, text.length - 1);
      }
      text = escape(text, true);
      return {
        type: 'codespan',
        raw: cap[0],
        text: text
      };
    }
  };
  _proto.br = function br(src) {
    var cap = this.rules.inline.br.exec(src);
    if (cap) {
      return {
        type: 'br',
        raw: cap[0]
      };
    }
  };
  _proto.del = function del(src) {
    var cap = this.rules.inline.del.exec(src);
    if (cap) {
      return {
        type: 'del',
        raw: cap[0],
        text: cap[2],
        tokens: this.lexer.inlineTokens(cap[2])
      };
    }
  };
  _proto.autolink = function autolink(src, mangle) {
    var cap = this.rules.inline.autolink.exec(src);
    if (cap) {
      var text, href;
      if (cap[2] === '@') {
        text = escape(this.options.mangle ? mangle(cap[1]) : cap[1]);
        href = 'mailto:' + text;
      } else {
        text = escape(cap[1]);
        href = text;
      }
      return {
        type: 'link',
        raw: cap[0],
        text: text,
        href: href,
        tokens: [{
          type: 'text',
          raw: text,
          text: text
        }]
      };
    }
  };
  _proto.url = function url(src, mangle) {
    var cap;
    if (cap = this.rules.inline.url.exec(src)) {
      var text, href;
      if (cap[2] === '@') {
        text = escape(this.options.mangle ? mangle(cap[0]) : cap[0]);
        href = 'mailto:' + text;
      } else {
        // do extended autolink path validation
        var prevCapZero;
        do {
          prevCapZero = cap[0];
          cap[0] = this.rules.inline._backpedal.exec(cap[0])[0];
        } while (prevCapZero !== cap[0]);
        text = escape(cap[0]);
        if (cap[1] === 'www.') {
          href = 'http://' + cap[0];
        } else {
          href = cap[0];
        }
      }
      return {
        type: 'link',
        raw: cap[0],
        text: text,
        href: href,
        tokens: [{
          type: 'text',
          raw: text,
          text: text
        }]
      };
    }
  };
  _proto.inlineText = function inlineText(src, smartypants) {
    var cap = this.rules.inline.text.exec(src);
    if (cap) {
      var text;
      if (this.lexer.state.inRawBlock) {
        text = this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape(cap[0]) : cap[0];
      } else {
        text = escape(this.options.smartypants ? smartypants(cap[0]) : cap[0]);
      }
      return {
        type: 'text',
        raw: cap[0],
        text: text
      };
    }
  };
  return Tokenizer;
}();

/**
 * Block-Level Grammar
 */
var block = {
  newline: /^(?: *(?:\n|$))+/,
  code: /^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,
  fences: /^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,
  hr: /^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,
  heading: /^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,
  blockquote: /^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,
  list: /^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,
  html: '^ {0,3}(?:' // optional indentation
  + '<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)' // (1)
  + '|comment[^\\n]*(\\n+|$)' // (2)
  + '|<\\?[\\s\\S]*?(?:\\?>\\n*|$)' // (3)
  + '|<![A-Z][\\s\\S]*?(?:>\\n*|$)' // (4)
  + '|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)' // (5)
  + '|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)' // (6)
  + '|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)' // (7) open tag
  + '|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)' // (7) closing tag
  + ')',
  def: /^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,
  table: noopTest,
  lheading: /^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,
  // regex template, placeholders will be replaced according to different paragraph
  // interruption rules of commonmark and the original markdown spec:
  _paragraph: /^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,
  text: /^[^\n]+/
};
block._label = /(?!\s*\])(?:\\.|[^\[\]\\])+/;
block._title = /(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;
block.def = edit(block.def).replace('label', block._label).replace('title', block._title).getRegex();
block.bullet = /(?:[*+-]|\d{1,9}[.)])/;
block.listItemStart = edit(/^( *)(bull) */).replace('bull', block.bullet).getRegex();
block.list = edit(block.list).replace(/bull/g, block.bullet).replace('hr', '\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))').replace('def', '\\n+(?=' + block.def.source + ')').getRegex();
block._tag = 'address|article|aside|base|basefont|blockquote|body|caption' + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption' + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe' + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option' + '|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr' + '|track|ul';
block._comment = /<!--(?!-?>)[\s\S]*?(?:-->|$)/;
block.html = edit(block.html, 'i').replace('comment', block._comment).replace('tag', block._tag).replace('attribute', / +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();
block.paragraph = edit(block._paragraph).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('|lheading', '') // setex headings don't interrupt commonmark paragraphs
.replace('|table', '').replace('blockquote', ' {0,3}>').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt
.replace('html', '</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)').replace('tag', block._tag) // pars can be interrupted by type (6) html blocks
.getRegex();
block.blockquote = edit(block.blockquote).replace('paragraph', block.paragraph).getRegex();

/**
 * Normal Block Grammar
 */

block.normal = merge({}, block);

/**
 * GFM Block Grammar
 */

block.gfm = merge({}, block.normal, {
  table: '^ *([^\\n ].*\\|.*)\\n' // Header
  + ' {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?' // Align
  + '(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)' // Cells
});

block.gfm.table = edit(block.gfm.table).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('blockquote', ' {0,3}>').replace('code', ' {4}[^\\n]').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt
.replace('html', '</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)').replace('tag', block._tag) // tables can be interrupted by type (6) html blocks
.getRegex();
block.gfm.paragraph = edit(block._paragraph).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('|lheading', '') // setex headings don't interrupt commonmark paragraphs
.replace('table', block.gfm.table) // interrupt paragraphs with table
.replace('blockquote', ' {0,3}>').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt
.replace('html', '</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)').replace('tag', block._tag) // pars can be interrupted by type (6) html blocks
.getRegex();
/**
 * Pedantic grammar (original John Gruber's loose markdown specification)
 */

block.pedantic = merge({}, block.normal, {
  html: edit('^ *(?:comment *(?:\\n|\\s*$)' + '|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)' // closed tag
  + '|<tag(?:"[^"]*"|\'[^\']*\'|\\s[^\'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))').replace('comment', block._comment).replace(/tag/g, '(?!(?:' + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub' + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)' + '\\b)\\w+(?!:|[^\\w\\s@]*@)\\b').getRegex(),
  def: /^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,
  heading: /^(#{1,6})(.*)(?:\n+|$)/,
  fences: noopTest,
  // fences not supported
  lheading: /^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,
  paragraph: edit(block.normal._paragraph).replace('hr', block.hr).replace('heading', ' *#{1,6} *[^\n]').replace('lheading', block.lheading).replace('blockquote', ' {0,3}>').replace('|fences', '').replace('|list', '').replace('|html', '').getRegex()
});

/**
 * Inline-Level Grammar
 */
var inline = {
  escape: /^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,
  autolink: /^<(scheme:[^\s\x00-\x1f<>]*|email)>/,
  url: noopTest,
  tag: '^comment' + '|^</[a-zA-Z][\\w:-]*\\s*>' // self-closing tag
  + '|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>' // open tag
  + '|^<\\?[\\s\\S]*?\\?>' // processing instruction, e.g. <?php ?>
  + '|^<![a-zA-Z]+\\s[\\s\\S]*?>' // declaration, e.g. <!DOCTYPE html>
  + '|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>',
  // CDATA section
  link: /^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,
  reflink: /^!?\[(label)\]\[(ref)\]/,
  nolink: /^!?\[(ref)\](?:\[\])?/,
  reflinkSearch: 'reflink|nolink(?!\\()',
  emStrong: {
    lDelim: /^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,
    //        (1) and (2) can only be a Right Delimiter. (3) and (4) can only be Left.  (5) and (6) can be either Left or Right.
    //          () Skip orphan inside strong                                      () Consume to delim     (1) #***                (2) a***#, a***                             (3) #***a, ***a                 (4) ***#              (5) #***#                 (6) a***a
    rDelimAst: /^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,
    rDelimUnd: /^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/ // ^- Not allowed for _
  },

  code: /^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,
  br: /^( {2,}|\\)\n(?!\s*$)/,
  del: noopTest,
  text: /^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,
  punctuation: /^([\spunctuation])/
};

// list of punctuation marks from CommonMark spec
// without * and _ to handle the different emphasis markers * and _
inline._punctuation = '!"#$%&\'()+\\-.,/:;<=>?@\\[\\]`^{|}~';
inline.punctuation = edit(inline.punctuation).replace(/punctuation/g, inline._punctuation).getRegex();

// sequences em should skip over [title](link), `code`, <html>
inline.blockSkip = /\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;
// lookbehind is not available on Safari as of version 16
// inline.escapedEmSt = /(?<=(?:^|[^\\)(?:\\[^])*)\\[*_]/g;
inline.escapedEmSt = /(?:^|[^\\])(?:\\\\)*\\[*_]/g;
inline._comment = edit(block._comment).replace('(?:-->|$)', '-->').getRegex();
inline.emStrong.lDelim = edit(inline.emStrong.lDelim).replace(/punct/g, inline._punctuation).getRegex();
inline.emStrong.rDelimAst = edit(inline.emStrong.rDelimAst, 'g').replace(/punct/g, inline._punctuation).getRegex();
inline.emStrong.rDelimUnd = edit(inline.emStrong.rDelimUnd, 'g').replace(/punct/g, inline._punctuation).getRegex();
inline._escapes = /\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;
inline._scheme = /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;
inline._email = /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;
inline.autolink = edit(inline.autolink).replace('scheme', inline._scheme).replace('email', inline._email).getRegex();
inline._attribute = /\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;
inline.tag = edit(inline.tag).replace('comment', inline._comment).replace('attribute', inline._attribute).getRegex();
inline._label = /(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;
inline._href = /<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;
inline._title = /"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;
inline.link = edit(inline.link).replace('label', inline._label).replace('href', inline._href).replace('title', inline._title).getRegex();
inline.reflink = edit(inline.reflink).replace('label', inline._label).replace('ref', block._label).getRegex();
inline.nolink = edit(inline.nolink).replace('ref', block._label).getRegex();
inline.reflinkSearch = edit(inline.reflinkSearch, 'g').replace('reflink', inline.reflink).replace('nolink', inline.nolink).getRegex();

/**
 * Normal Inline Grammar
 */

inline.normal = merge({}, inline);

/**
 * Pedantic Inline Grammar
 */

inline.pedantic = merge({}, inline.normal, {
  strong: {
    start: /^__|\*\*/,
    middle: /^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,
    endAst: /\*\*(?!\*)/g,
    endUnd: /__(?!_)/g
  },
  em: {
    start: /^_|\*/,
    middle: /^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,
    endAst: /\*(?!\*)/g,
    endUnd: /_(?!_)/g
  },
  link: edit(/^!?\[(label)\]\((.*?)\)/).replace('label', inline._label).getRegex(),
  reflink: edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace('label', inline._label).getRegex()
});

/**
 * GFM Inline Grammar
 */

inline.gfm = merge({}, inline.normal, {
  escape: edit(inline.escape).replace('])', '~|])').getRegex(),
  _extended_email: /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,
  url: /^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,
  _backpedal: /(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,
  del: /^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,
  text: /^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/
});
inline.gfm.url = edit(inline.gfm.url, 'i').replace('email', inline.gfm._extended_email).getRegex();
/**
 * GFM + Line Breaks Inline Grammar
 */

inline.breaks = merge({}, inline.gfm, {
  br: edit(inline.br).replace('{2,}', '*').getRegex(),
  text: edit(inline.gfm.text).replace('\\b_', '\\b_| {2,}\\n').replace(/\{2,\}/g, '*').getRegex()
});

/**
 * smartypants text replacement
 * @param {string} text
 */
function smartypants(text) {
  return text
  // em-dashes
  .replace(/---/g, "\u2014")
  // en-dashes
  .replace(/--/g, "\u2013")
  // opening singles
  .replace(/(^|[-\u2014/(\[{"\s])'/g, "$1\u2018")
  // closing singles & apostrophes
  .replace(/'/g, "\u2019")
  // opening doubles
  .replace(/(^|[-\u2014/(\[{\u2018\s])"/g, "$1\u201C")
  // closing doubles
  .replace(/"/g, "\u201D")
  // ellipses
  .replace(/\.{3}/g, "\u2026");
}

/**
 * mangle email addresses
 * @param {string} text
 */
function mangle(text) {
  var out = '',
    i,
    ch;
  var l = text.length;
  for (i = 0; i < l; i++) {
    ch = text.charCodeAt(i);
    if (Math.random() > 0.5) {
      ch = 'x' + ch.toString(16);
    }
    out += '&#' + ch + ';';
  }
  return out;
}

/**
 * Block Lexer
 */
var Lexer = /*#__PURE__*/function () {
  function Lexer(options) {
    this.tokens = [];
    this.tokens.links = Object.create(null);
    this.options = options || exports.defaults;
    this.options.tokenizer = this.options.tokenizer || new Tokenizer();
    this.tokenizer = this.options.tokenizer;
    this.tokenizer.options = this.options;
    this.tokenizer.lexer = this;
    this.inlineQueue = [];
    this.state = {
      inLink: false,
      inRawBlock: false,
      top: true
    };
    var rules = {
      block: block.normal,
      inline: inline.normal
    };
    if (this.options.pedantic) {
      rules.block = block.pedantic;
      rules.inline = inline.pedantic;
    } else if (this.options.gfm) {
      rules.block = block.gfm;
      if (this.options.breaks) {
        rules.inline = inline.breaks;
      } else {
        rules.inline = inline.gfm;
      }
    }
    this.tokenizer.rules = rules;
  }

  /**
   * Expose Rules
   */
  /**
   * Static Lex Method
   */
  Lexer.lex = function lex(src, options) {
    var lexer = new Lexer(options);
    return lexer.lex(src);
  }

  /**
   * Static Lex Inline Method
   */;
  Lexer.lexInline = function lexInline(src, options) {
    var lexer = new Lexer(options);
    return lexer.inlineTokens(src);
  }

  /**
   * Preprocessing
   */;
  var _proto = Lexer.prototype;
  _proto.lex = function lex(src) {
    src = src.replace(/\r\n|\r/g, '\n');
    this.blockTokens(src, this.tokens);
    var next;
    while (next = this.inlineQueue.shift()) {
      this.inlineTokens(next.src, next.tokens);
    }
    return this.tokens;
  }

  /**
   * Lexing
   */;
  _proto.blockTokens = function blockTokens(src, tokens) {
    var _this = this;
    if (tokens === void 0) {
      tokens = [];
    }
    if (this.options.pedantic) {
      src = src.replace(/\t/g, '    ').replace(/^ +$/gm, '');
    } else {
      src = src.replace(/^( *)(\t+)/gm, function (_, leading, tabs) {
        return leading + '    '.repeat(tabs.length);
      });
    }
    var token, lastToken, cutSrc, lastParagraphClipped;
    while (src) {
      if (this.options.extensions && this.options.extensions.block && this.options.extensions.block.some(function (extTokenizer) {
        if (token = extTokenizer.call({
          lexer: _this
        }, src, tokens)) {
          src = src.substring(token.raw.length);
          tokens.push(token);
          return true;
        }
        return false;
      })) {
        continue;
      }

      // newline
      if (token = this.tokenizer.space(src)) {
        src = src.substring(token.raw.length);
        if (token.raw.length === 1 && tokens.length > 0) {
          // if there's a single \n as a spacer, it's terminating the last line,
          // so move it there so that we don't get unecessary paragraph tags
          tokens[tokens.length - 1].raw += '\n';
        } else {
          tokens.push(token);
        }
        continue;
      }

      // code
      if (token = this.tokenizer.code(src)) {
        src = src.substring(token.raw.length);
        lastToken = tokens[tokens.length - 1];
        // An indented code block cannot interrupt a paragraph.
        if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {
          lastToken.raw += '\n' + token.raw;
          lastToken.text += '\n' + token.text;
          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;
        } else {
          tokens.push(token);
        }
        continue;
      }

      // fences
      if (token = this.tokenizer.fences(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // heading
      if (token = this.tokenizer.heading(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // hr
      if (token = this.tokenizer.hr(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // blockquote
      if (token = this.tokenizer.blockquote(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // list
      if (token = this.tokenizer.list(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // html
      if (token = this.tokenizer.html(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // def
      if (token = this.tokenizer.def(src)) {
        src = src.substring(token.raw.length);
        lastToken = tokens[tokens.length - 1];
        if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {
          lastToken.raw += '\n' + token.raw;
          lastToken.text += '\n' + token.raw;
          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;
        } else if (!this.tokens.links[token.tag]) {
          this.tokens.links[token.tag] = {
            href: token.href,
            title: token.title
          };
        }
        continue;
      }

      // table (gfm)
      if (token = this.tokenizer.table(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // lheading
      if (token = this.tokenizer.lheading(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // top-level paragraph
      // prevent paragraph consuming extensions by clipping 'src' to extension start
      cutSrc = src;
      if (this.options.extensions && this.options.extensions.startBlock) {
        (function () {
          var startIndex = Infinity;
          var tempSrc = src.slice(1);
          var tempStart = void 0;
          _this.options.extensions.startBlock.forEach(function (getStartIndex) {
            tempStart = getStartIndex.call({
              lexer: this
            }, tempSrc);
            if (typeof tempStart === 'number' && tempStart >= 0) {
              startIndex = Math.min(startIndex, tempStart);
            }
          });
          if (startIndex < Infinity && startIndex >= 0) {
            cutSrc = src.substring(0, startIndex + 1);
          }
        })();
      }
      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {
        lastToken = tokens[tokens.length - 1];
        if (lastParagraphClipped && lastToken.type === 'paragraph') {
          lastToken.raw += '\n' + token.raw;
          lastToken.text += '\n' + token.text;
          this.inlineQueue.pop();
          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;
        } else {
          tokens.push(token);
        }
        lastParagraphClipped = cutSrc.length !== src.length;
        src = src.substring(token.raw.length);
        continue;
      }

      // text
      if (token = this.tokenizer.text(src)) {
        src = src.substring(token.raw.length);
        lastToken = tokens[tokens.length - 1];
        if (lastToken && lastToken.type === 'text') {
          lastToken.raw += '\n' + token.raw;
          lastToken.text += '\n' + token.text;
          this.inlineQueue.pop();
          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;
        } else {
          tokens.push(token);
        }
        continue;
      }
      if (src) {
        var errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);
        if (this.options.silent) {
          console.error(errMsg);
          break;
        } else {
          throw new Error(errMsg);
        }
      }
    }
    this.state.top = true;
    return tokens;
  };
  _proto.inline = function inline(src, tokens) {
    if (tokens === void 0) {
      tokens = [];
    }
    this.inlineQueue.push({
      src: src,
      tokens: tokens
    });
    return tokens;
  }

  /**
   * Lexing/Compiling
   */;
  _proto.inlineTokens = function inlineTokens(src, tokens) {
    var _this2 = this;
    if (tokens === void 0) {
      tokens = [];
    }
    var token, lastToken, cutSrc;

    // String with links masked to avoid interference with em and strong
    var maskedSrc = src;
    var match;
    var keepPrevChar, prevChar;

    // Mask out reflinks
    if (this.tokens.links) {
      var links = Object.keys(this.tokens.links);
      if (links.length > 0) {
        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {
          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {
            maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);
          }
        }
      }
    }
    // Mask out other blocks
    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {
      maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);
    }

    // Mask out escaped em & strong delimiters
    while ((match = this.tokenizer.rules.inline.escapedEmSt.exec(maskedSrc)) != null) {
      maskedSrc = maskedSrc.slice(0, match.index + match[0].length - 2) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);
      this.tokenizer.rules.inline.escapedEmSt.lastIndex--;
    }
    while (src) {
      if (!keepPrevChar) {
        prevChar = '';
      }
      keepPrevChar = false;

      // extensions
      if (this.options.extensions && this.options.extensions.inline && this.options.extensions.inline.some(function (extTokenizer) {
        if (token = extTokenizer.call({
          lexer: _this2
        }, src, tokens)) {
          src = src.substring(token.raw.length);
          tokens.push(token);
          return true;
        }
        return false;
      })) {
        continue;
      }

      // escape
      if (token = this.tokenizer.escape(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // tag
      if (token = this.tokenizer.tag(src)) {
        src = src.substring(token.raw.length);
        lastToken = tokens[tokens.length - 1];
        if (lastToken && token.type === 'text' && lastToken.type === 'text') {
          lastToken.raw += token.raw;
          lastToken.text += token.text;
        } else {
          tokens.push(token);
        }
        continue;
      }

      // link
      if (token = this.tokenizer.link(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // reflink, nolink
      if (token = this.tokenizer.reflink(src, this.tokens.links)) {
        src = src.substring(token.raw.length);
        lastToken = tokens[tokens.length - 1];
        if (lastToken && token.type === 'text' && lastToken.type === 'text') {
          lastToken.raw += token.raw;
          lastToken.text += token.text;
        } else {
          tokens.push(token);
        }
        continue;
      }

      // em & strong
      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // code
      if (token = this.tokenizer.codespan(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // br
      if (token = this.tokenizer.br(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // del (gfm)
      if (token = this.tokenizer.del(src)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // autolink
      if (token = this.tokenizer.autolink(src, mangle)) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // url (gfm)
      if (!this.state.inLink && (token = this.tokenizer.url(src, mangle))) {
        src = src.substring(token.raw.length);
        tokens.push(token);
        continue;
      }

      // text
      // prevent inlineText consuming extensions by clipping 'src' to extension start
      cutSrc = src;
      if (this.options.extensions && this.options.extensions.startInline) {
        (function () {
          var startIndex = Infinity;
          var tempSrc = src.slice(1);
          var tempStart = void 0;
          _this2.options.extensions.startInline.forEach(function (getStartIndex) {
            tempStart = getStartIndex.call({
              lexer: this
            }, tempSrc);
            if (typeof tempStart === 'number' && tempStart >= 0) {
              startIndex = Math.min(startIndex, tempStart);
            }
          });
          if (startIndex < Infinity && startIndex >= 0) {
            cutSrc = src.substring(0, startIndex + 1);
          }
        })();
      }
      if (token = this.tokenizer.inlineText(cutSrc, smartypants)) {
        src = src.substring(token.raw.length);
        if (token.raw.slice(-1) !== '_') {
          // Track prevChar before string of ____ started
          prevChar = token.raw.slice(-1);
        }
        keepPrevChar = true;
        lastToken = tokens[tokens.length - 1];
        if (lastToken && lastToken.type === 'text') {
          lastToken.raw += token.raw;
          lastToken.text += token.text;
        } else {
          tokens.push(token);
        }
        continue;
      }
      if (src) {
        var errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);
        if (this.options.silent) {
          console.error(errMsg);
          break;
        } else {
          throw new Error(errMsg);
        }
      }
    }
    return tokens;
  };
  _createClass(Lexer, null, [{
    key: "rules",
    get: function get() {
      return {
        block: block,
        inline: inline
      };
    }
  }]);
  return Lexer;
}();

/**
 * Renderer
 */
var Renderer = /*#__PURE__*/function () {
  function Renderer(options) {
    this.options = options || exports.defaults;
  }
  var _proto = Renderer.prototype;
  _proto.code = function code(_code, infostring, escaped) {
    var lang = (infostring || '').match(/\S*/)[0];
    if (this.options.highlight) {
      var out = this.options.highlight(_code, lang);
      if (out != null && out !== _code) {
        escaped = true;
        _code = out;
      }
    }
    _code = _code.replace(/\n$/, '') + '\n';
    if (!lang) {
      return '<pre><code>' + (escaped ? _code : escape(_code, true)) + '</code></pre>\n';
    }
    return '<pre><code class="' + this.options.langPrefix + escape(lang) + '">' + (escaped ? _code : escape(_code, true)) + '</code></pre>\n';
  }

  /**
   * @param {string} quote
   */;
  _proto.blockquote = function blockquote(quote) {
    return "<blockquote>\n" + quote + "</blockquote>\n";
  };
  _proto.html = function html(_html) {
    return _html;
  }

  /**
   * @param {string} text
   * @param {string} level
   * @param {string} raw
   * @param {any} slugger
   */;
  _proto.heading = function heading(text, level, raw, slugger) {
    if (this.options.headerIds) {
      var id = this.options.headerPrefix + slugger.slug(raw);
      return "<h" + level + " id=\"" + id + "\">" + text + "</h" + level + ">\n";
    }

    // ignore IDs
    return "<h" + level + ">" + text + "</h" + level + ">\n";
  };
  _proto.hr = function hr() {
    return this.options.xhtml ? '<hr/>\n' : '<hr>\n';
  };
  _proto.list = function list(body, ordered, start) {
    var type = ordered ? 'ol' : 'ul',
      startatt = ordered && start !== 1 ? ' start="' + start + '"' : '';
    return '<' + type + startatt + '>\n' + body + '</' + type + '>\n';
  }

  /**
   * @param {string} text
   */;
  _proto.listitem = function listitem(text) {
    return "<li>" + text + "</li>\n";
  };
  _proto.checkbox = function checkbox(checked) {
    return '<input ' + (checked ? 'checked="" ' : '') + 'disabled="" type="checkbox"' + (this.options.xhtml ? ' /' : '') + '> ';
  }

  /**
   * @param {string} text
   */;
  _proto.paragraph = function paragraph(text) {
    return "<p>" + text + "</p>\n";
  }

  /**
   * @param {string} header
   * @param {string} body
   */;
  _proto.table = function table(header, body) {
    if (body) body = "<tbody>" + body + "</tbody>";
    return '<table>\n' + '<thead>\n' + header + '</thead>\n' + body + '</table>\n';
  }

  /**
   * @param {string} content
   */;
  _proto.tablerow = function tablerow(content) {
    return "<tr>\n" + content + "</tr>\n";
  };
  _proto.tablecell = function tablecell(content, flags) {
    var type = flags.header ? 'th' : 'td';
    var tag = flags.align ? "<" + type + " align=\"" + flags.align + "\">" : "<" + type + ">";
    return tag + content + ("</" + type + ">\n");
  }

  /**
   * span level renderer
   * @param {string} text
   */;
  _proto.strong = function strong(text) {
    return "<strong>" + text + "</strong>";
  }

  /**
   * @param {string} text
   */;
  _proto.em = function em(text) {
    return "<em>" + text + "</em>";
  }

  /**
   * @param {string} text
   */;
  _proto.codespan = function codespan(text) {
    return "<code>" + text + "</code>";
  };
  _proto.br = function br() {
    return this.options.xhtml ? '<br/>' : '<br>';
  }

  /**
   * @param {string} text
   */;
  _proto.del = function del(text) {
    return "<del>" + text + "</del>";
  }

  /**
   * @param {string} href
   * @param {string} title
   * @param {string} text
   */;
  _proto.link = function link(href, title, text) {
    href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);
    if (href === null) {
      return text;
    }
    var out = '<a href="' + href + '"';
    if (title) {
      out += ' title="' + title + '"';
    }
    out += '>' + text + '</a>';
    return out;
  }

  /**
   * @param {string} href
   * @param {string} title
   * @param {string} text
   */;
  _proto.image = function image(href, title, text) {
    href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);
    if (href === null) {
      return text;
    }
    var out = "<img src=\"" + href + "\" alt=\"" + text + "\"";
    if (title) {
      out += " title=\"" + title + "\"";
    }
    out += this.options.xhtml ? '/>' : '>';
    return out;
  };
  _proto.text = function text(_text) {
    return _text;
  };
  return Renderer;
}();

/**
 * TextRenderer
 * returns only the textual part of the token
 */
var TextRenderer = /*#__PURE__*/function () {
  function TextRenderer() {}
  var _proto = TextRenderer.prototype;
  // no need for block level renderers
  _proto.strong = function strong(text) {
    return text;
  };
  _proto.em = function em(text) {
    return text;
  };
  _proto.codespan = function codespan(text) {
    return text;
  };
  _proto.del = function del(text) {
    return text;
  };
  _proto.html = function html(text) {
    return text;
  };
  _proto.text = function text(_text) {
    return _text;
  };
  _proto.link = function link(href, title, text) {
    return '' + text;
  };
  _proto.image = function image(href, title, text) {
    return '' + text;
  };
  _proto.br = function br() {
    return '';
  };
  return TextRenderer;
}();

/**
 * Slugger generates header id
 */
var Slugger = /*#__PURE__*/function () {
  function Slugger() {
    this.seen = {};
  }

  /**
   * @param {string} value
   */
  var _proto = Slugger.prototype;
  _proto.serialize = function serialize(value) {
    return value.toLowerCase().trim()
    // remove html tags
    .replace(/<[!\/a-z].*?>/ig, '')
    // remove unwanted chars
    .replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g, '').replace(/\s/g, '-');
  }

  /**
   * Finds the next safe (unique) slug to use
   * @param {string} originalSlug
   * @param {boolean} isDryRun
   */;
  _proto.getNextSafeSlug = function getNextSafeSlug(originalSlug, isDryRun) {
    var slug = originalSlug;
    var occurenceAccumulator = 0;
    if (this.seen.hasOwnProperty(slug)) {
      occurenceAccumulator = this.seen[originalSlug];
      do {
        occurenceAccumulator++;
        slug = originalSlug + '-' + occurenceAccumulator;
      } while (this.seen.hasOwnProperty(slug));
    }
    if (!isDryRun) {
      this.seen[originalSlug] = occurenceAccumulator;
      this.seen[slug] = 0;
    }
    return slug;
  }

  /**
   * Convert string to unique id
   * @param {object} [options]
   * @param {boolean} [options.dryrun] Generates the next unique slug without
   * updating the internal accumulator.
   */;
  _proto.slug = function slug(value, options) {
    if (options === void 0) {
      options = {};
    }
    var slug = this.serialize(value);
    return this.getNextSafeSlug(slug, options.dryrun);
  };
  return Slugger;
}();

/**
 * Parsing & Compiling
 */
var Parser = /*#__PURE__*/function () {
  function Parser(options) {
    this.options = options || exports.defaults;
    this.options.renderer = this.options.renderer || new Renderer();
    this.renderer = this.options.renderer;
    this.renderer.options = this.options;
    this.textRenderer = new TextRenderer();
    this.slugger = new Slugger();
  }

  /**
   * Static Parse Method
   */
  Parser.parse = function parse(tokens, options) {
    var parser = new Parser(options);
    return parser.parse(tokens);
  }

  /**
   * Static Parse Inline Method
   */;
  Parser.parseInline = function parseInline(tokens, options) {
    var parser = new Parser(options);
    return parser.parseInline(tokens);
  }

  /**
   * Parse Loop
   */;
  var _proto = Parser.prototype;
  _proto.parse = function parse(tokens, top) {
    if (top === void 0) {
      top = true;
    }
    var out = '',
      i,
      j,
      k,
      l2,
      l3,
      row,
      cell,
      header,
      body,
      token,
      ordered,
      start,
      loose,
      itemBody,
      item,
      checked,
      task,
      checkbox,
      ret;
    var l = tokens.length;
    for (i = 0; i < l; i++) {
      token = tokens[i];

      // Run any renderer extensions
      if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {
        ret = this.options.extensions.renderers[token.type].call({
          parser: this
        }, token);
        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(token.type)) {
          out += ret || '';
          continue;
        }
      }
      switch (token.type) {
        case 'space':
          {
            continue;
          }
        case 'hr':
          {
            out += this.renderer.hr();
            continue;
          }
        case 'heading':
          {
            out += this.renderer.heading(this.parseInline(token.tokens), token.depth, unescape(this.parseInline(token.tokens, this.textRenderer)), this.slugger);
            continue;
          }
        case 'code':
          {
            out += this.renderer.code(token.text, token.lang, token.escaped);
            continue;
          }
        case 'table':
          {
            header = '';

            // header
            cell = '';
            l2 = token.header.length;
            for (j = 0; j < l2; j++) {
              cell += this.renderer.tablecell(this.parseInline(token.header[j].tokens), {
                header: true,
                align: token.align[j]
              });
            }
            header += this.renderer.tablerow(cell);
            body = '';
            l2 = token.rows.length;
            for (j = 0; j < l2; j++) {
              row = token.rows[j];
              cell = '';
              l3 = row.length;
              for (k = 0; k < l3; k++) {
                cell += this.renderer.tablecell(this.parseInline(row[k].tokens), {
                  header: false,
                  align: token.align[k]
                });
              }
              body += this.renderer.tablerow(cell);
            }
            out += this.renderer.table(header, body);
            continue;
          }
        case 'blockquote':
          {
            body = this.parse(token.tokens);
            out += this.renderer.blockquote(body);
            continue;
          }
        case 'list':
          {
            ordered = token.ordered;
            start = token.start;
            loose = token.loose;
            l2 = token.items.length;
            body = '';
            for (j = 0; j < l2; j++) {
              item = token.items[j];
              checked = item.checked;
              task = item.task;
              itemBody = '';
              if (item.task) {
                checkbox = this.renderer.checkbox(checked);
                if (loose) {
                  if (item.tokens.length > 0 && item.tokens[0].type === 'paragraph') {
                    item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;
                    if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {
                      item.tokens[0].tokens[0].text = checkbox + ' ' + item.tokens[0].tokens[0].text;
                    }
                  } else {
                    item.tokens.unshift({
                      type: 'text',
                      text: checkbox
                    });
                  }
                } else {
                  itemBody += checkbox;
                }
              }
              itemBody += this.parse(item.tokens, loose);
              body += this.renderer.listitem(itemBody, task, checked);
            }
            out += this.renderer.list(body, ordered, start);
            continue;
          }
        case 'html':
          {
            // TODO parse inline content if parameter markdown=1
            out += this.renderer.html(token.text);
            continue;
          }
        case 'paragraph':
          {
            out += this.renderer.paragraph(this.parseInline(token.tokens));
            continue;
          }
        case 'text':
          {
            body = token.tokens ? this.parseInline(token.tokens) : token.text;
            while (i + 1 < l && tokens[i + 1].type === 'text') {
              token = tokens[++i];
              body += '\n' + (token.tokens ? this.parseInline(token.tokens) : token.text);
            }
            out += top ? this.renderer.paragraph(body) : body;
            continue;
          }
        default:
          {
            var errMsg = 'Token with "' + token.type + '" type was not found.';
            if (this.options.silent) {
              console.error(errMsg);
              return;
            } else {
              throw new Error(errMsg);
            }
          }
      }
    }
    return out;
  }

  /**
   * Parse Inline Tokens
   */;
  _proto.parseInline = function parseInline(tokens, renderer) {
    renderer = renderer || this.renderer;
    var out = '',
      i,
      token,
      ret;
    var l = tokens.length;
    for (i = 0; i < l; i++) {
      token = tokens[i];

      // Run any renderer extensions
      if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {
        ret = this.options.extensions.renderers[token.type].call({
          parser: this
        }, token);
        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(token.type)) {
          out += ret || '';
          continue;
        }
      }
      switch (token.type) {
        case 'escape':
          {
            out += renderer.text(token.text);
            break;
          }
        case 'html':
          {
            out += renderer.html(token.text);
            break;
          }
        case 'link':
          {
            out += renderer.link(token.href, token.title, this.parseInline(token.tokens, renderer));
            break;
          }
        case 'image':
          {
            out += renderer.image(token.href, token.title, token.text);
            break;
          }
        case 'strong':
          {
            out += renderer.strong(this.parseInline(token.tokens, renderer));
            break;
          }
        case 'em':
          {
            out += renderer.em(this.parseInline(token.tokens, renderer));
            break;
          }
        case 'codespan':
          {
            out += renderer.codespan(token.text);
            break;
          }
        case 'br':
          {
            out += renderer.br();
            break;
          }
        case 'del':
          {
            out += renderer.del(this.parseInline(token.tokens, renderer));
            break;
          }
        case 'text':
          {
            out += renderer.text(token.text);
            break;
          }
        default:
          {
            var errMsg = 'Token with "' + token.type + '" type was not found.';
            if (this.options.silent) {
              console.error(errMsg);
              return;
            } else {
              throw new Error(errMsg);
            }
          }
      }
    }
    return out;
  };
  return Parser;
}();

/**
 * Marked
 */
function marked(src, opt, callback) {
  // throw error in case of non string input
  if (typeof src === 'undefined' || src === null) {
    throw new Error('marked(): input parameter is undefined or null');
  }
  if (typeof src !== 'string') {
    throw new Error('marked(): input parameter is of type ' + Object.prototype.toString.call(src) + ', string expected');
  }
  if (typeof opt === 'function') {
    callback = opt;
    opt = null;
  }
  opt = merge({}, marked.defaults, opt || {});
  checkSanitizeDeprecation(opt);
  if (callback) {
    var highlight = opt.highlight;
    var tokens;
    try {
      tokens = Lexer.lex(src, opt);
    } catch (e) {
      return callback(e);
    }
    var done = function done(err) {
      var out;
      if (!err) {
        try {
          if (opt.walkTokens) {
            marked.walkTokens(tokens, opt.walkTokens);
          }
          out = Parser.parse(tokens, opt);
        } catch (e) {
          err = e;
        }
      }
      opt.highlight = highlight;
      return err ? callback(err) : callback(null, out);
    };
    if (!highlight || highlight.length < 3) {
      return done();
    }
    delete opt.highlight;
    if (!tokens.length) return done();
    var pending = 0;
    marked.walkTokens(tokens, function (token) {
      if (token.type === 'code') {
        pending++;
        setTimeout(function () {
          highlight(token.text, token.lang, function (err, code) {
            if (err) {
              return done(err);
            }
            if (code != null && code !== token.text) {
              token.text = code;
              token.escaped = true;
            }
            pending--;
            if (pending === 0) {
              done();
            }
          });
        }, 0);
      }
    });
    if (pending === 0) {
      done();
    }
    return;
  }
  function onError(e) {
    e.message += '\nPlease report this to https://github.com/markedjs/marked.';
    if (opt.silent) {
      return '<p>An error occurred:</p><pre>' + escape(e.message + '', true) + '</pre>';
    }
    throw e;
  }
  try {
    var _tokens = Lexer.lex(src, opt);
    if (opt.walkTokens) {
      if (opt.async) {
        return Promise.all(marked.walkTokens(_tokens, opt.walkTokens)).then(function () {
          return Parser.parse(_tokens, opt);
        })["catch"](onError);
      }
      marked.walkTokens(_tokens, opt.walkTokens);
    }
    return Parser.parse(_tokens, opt);
  } catch (e) {
    onError(e);
  }
}

/**
 * Options
 */

marked.options = marked.setOptions = function (opt) {
  merge(marked.defaults, opt);
  changeDefaults(marked.defaults);
  return marked;
};
marked.getDefaults = getDefaults;
marked.defaults = exports.defaults;

/**
 * Use Extension
 */

marked.use = function () {
  var extensions = marked.defaults.extensions || {
    renderers: {},
    childTokens: {}
  };
  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
    args[_key] = arguments[_key];
  }
  args.forEach(function (pack) {
    // copy options to new object
    var opts = merge({}, pack);

    // set async to true if it was set to true before
    opts.async = marked.defaults.async || opts.async;

    // ==-- Parse "addon" extensions --== //
    if (pack.extensions) {
      pack.extensions.forEach(function (ext) {
        if (!ext.name) {
          throw new Error('extension name required');
        }
        if (ext.renderer) {
          // Renderer extensions
          var prevRenderer = extensions.renderers[ext.name];
          if (prevRenderer) {
            // Replace extension with func to run new extension but fall back if false
            extensions.renderers[ext.name] = function () {
              for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
                args[_key2] = arguments[_key2];
              }
              var ret = ext.renderer.apply(this, args);
              if (ret === false) {
                ret = prevRenderer.apply(this, args);
              }
              return ret;
            };
          } else {
            extensions.renderers[ext.name] = ext.renderer;
          }
        }
        if (ext.tokenizer) {
          // Tokenizer Extensions
          if (!ext.level || ext.level !== 'block' && ext.level !== 'inline') {
            throw new Error("extension level must be 'block' or 'inline'");
          }
          if (extensions[ext.level]) {
            extensions[ext.level].unshift(ext.tokenizer);
          } else {
            extensions[ext.level] = [ext.tokenizer];
          }
          if (ext.start) {
            // Function to check for start of token
            if (ext.level === 'block') {
              if (extensions.startBlock) {
                extensions.startBlock.push(ext.start);
              } else {
                extensions.startBlock = [ext.start];
              }
            } else if (ext.level === 'inline') {
              if (extensions.startInline) {
                extensions.startInline.push(ext.start);
              } else {
                extensions.startInline = [ext.start];
              }
            }
          }
        }
        if (ext.childTokens) {
          // Child tokens to be visited by walkTokens
          extensions.childTokens[ext.name] = ext.childTokens;
        }
      });
      opts.extensions = extensions;
    }

    // ==-- Parse "overwrite" extensions --== //
    if (pack.renderer) {
      (function () {
        var renderer = marked.defaults.renderer || new Renderer();
        var _loop = function _loop(prop) {
          var prevRenderer = renderer[prop];
          // Replace renderer with func to run extension, but fall back if false
          renderer[prop] = function () {
            for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
              args[_key3] = arguments[_key3];
            }
            var ret = pack.renderer[prop].apply(renderer, args);
            if (ret === false) {
              ret = prevRenderer.apply(renderer, args);
            }
            return ret;
          };
        };
        for (var prop in pack.renderer) {
          _loop(prop);
        }
        opts.renderer = renderer;
      })();
    }
    if (pack.tokenizer) {
      (function () {
        var tokenizer = marked.defaults.tokenizer || new Tokenizer();
        var _loop2 = function _loop2(prop) {
          var prevTokenizer = tokenizer[prop];
          // Replace tokenizer with func to run extension, but fall back if false
          tokenizer[prop] = function () {
            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
              args[_key4] = arguments[_key4];
            }
            var ret = pack.tokenizer[prop].apply(tokenizer, args);
            if (ret === false) {
              ret = prevTokenizer.apply(tokenizer, args);
            }
            return ret;
          };
        };
        for (var prop in pack.tokenizer) {
          _loop2(prop);
        }
        opts.tokenizer = tokenizer;
      })();
    }

    // ==-- Parse WalkTokens extensions --== //
    if (pack.walkTokens) {
      var _walkTokens = marked.defaults.walkTokens;
      opts.walkTokens = function (token) {
        var values = [];
        values.push(pack.walkTokens.call(this, token));
        if (_walkTokens) {
          values = values.concat(_walkTokens.call(this, token));
        }
        return values;
      };
    }
    marked.setOptions(opts);
  });
};

/**
 * Run callback for every token
 */

marked.walkTokens = function (tokens, callback) {
  var values = [];
  var _loop3 = function _loop3() {
    var token = _step.value;
    values = values.concat(callback.call(marked, token));
    switch (token.type) {
      case 'table':
        {
          for (var _iterator2 = _createForOfIteratorHelperLoose(token.header), _step2; !(_step2 = _iterator2()).done;) {
            var cell = _step2.value;
            values = values.concat(marked.walkTokens(cell.tokens, callback));
          }
          for (var _iterator3 = _createForOfIteratorHelperLoose(token.rows), _step3; !(_step3 = _iterator3()).done;) {
            var row = _step3.value;
            for (var _iterator4 = _createForOfIteratorHelperLoose(row), _step4; !(_step4 = _iterator4()).done;) {
              var _cell = _step4.value;
              values = values.concat(marked.walkTokens(_cell.tokens, callback));
            }
          }
          break;
        }
      case 'list':
        {
          values = values.concat(marked.walkTokens(token.items, callback));
          break;
        }
      default:
        {
          if (marked.defaults.extensions && marked.defaults.extensions.childTokens && marked.defaults.extensions.childTokens[token.type]) {
            // Walk any extensions
            marked.defaults.extensions.childTokens[token.type].forEach(function (childTokens) {
              values = values.concat(marked.walkTokens(token[childTokens], callback));
            });
          } else if (token.tokens) {
            values = values.concat(marked.walkTokens(token.tokens, callback));
          }
        }
    }
  };
  for (var _iterator = _createForOfIteratorHelperLoose(tokens), _step; !(_step = _iterator()).done;) {
    _loop3();
  }
  return values;
};

/**
 * Parse Inline
 * @param {string} src
 */
marked.parseInline = function (src, opt) {
  // throw error in case of non string input
  if (typeof src === 'undefined' || src === null) {
    throw new Error('marked.parseInline(): input parameter is undefined or null');
  }
  if (typeof src !== 'string') {
    throw new Error('marked.parseInline(): input parameter is of type ' + Object.prototype.toString.call(src) + ', string expected');
  }
  opt = merge({}, marked.defaults, opt || {});
  checkSanitizeDeprecation(opt);
  try {
    var tokens = Lexer.lexInline(src, opt);
    if (opt.walkTokens) {
      marked.walkTokens(tokens, opt.walkTokens);
    }
    return Parser.parseInline(tokens, opt);
  } catch (e) {
    e.message += '\nPlease report this to https://github.com/markedjs/marked.';
    if (opt.silent) {
      return '<p>An error occurred:</p><pre>' + escape(e.message + '', true) + '</pre>';
    }
    throw e;
  }
};

/**
 * Expose
 */
marked.Parser = Parser;
marked.parser = Parser.parse;
marked.Renderer = Renderer;
marked.TextRenderer = TextRenderer;
marked.Lexer = Lexer;
marked.lexer = Lexer.lex;
marked.Tokenizer = Tokenizer;
marked.Slugger = Slugger;
marked.parse = marked;
var options = marked.options;
var setOptions = marked.setOptions;
var use = marked.use;
var walkTokens = marked.walkTokens;
var parseInline = marked.parseInline;
var parse = marked;
var parser = Parser.parse;
var lexer = Lexer.lex;

exports.Lexer = Lexer;
exports.Parser = Parser;
exports.Renderer = Renderer;
exports.Slugger = Slugger;
exports.TextRenderer = TextRenderer;
exports.Tokenizer = Tokenizer;
exports.getDefaults = getDefaults;
exports.lexer = lexer;
exports.marked = marked;
exports.options = options;
exports.parse = parse;
exports.parseInline = parseInline;
exports.parser = parser;
exports.setOptions = setOptions;
exports.use = use;
exports.walkTokens = walkTokens;


/***/ })

}]);
//# sourceMappingURL=node_modules_moment-mini_locale_sync_recursive_-static_js_channel_js.js.map